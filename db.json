{"meta":{"version":1,"warehouse":"4.0.2"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"themes/spfk/source/apple-touch-icon.png","path":"apple-touch-icon.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-1.jpg","path":"background/bg-1.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-10.jpg","path":"background/bg-10.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-109.jpg","path":"background/bg-109.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-11.jpg","path":"background/bg-11.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-111.jpg","path":"background/bg-111.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-12.jpg","path":"background/bg-12.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-13.jpg","path":"background/bg-13.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-14.jpg","path":"background/bg-14.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-15.jpg","path":"background/bg-15.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-16.jpg","path":"background/bg-16.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-17.jpg","path":"background/bg-17.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-18.jpg","path":"background/bg-18.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-19.jpg","path":"background/bg-19.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-2.jpg","path":"background/bg-2.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-20.jpg","path":"background/bg-20.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-21.jpg","path":"background/bg-21.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-22.jpg","path":"background/bg-22.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-23.jpg","path":"background/bg-23.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-24.jpg","path":"background/bg-24.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-3.jpg","path":"background/bg-3.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-4.jpg","path":"background/bg-4.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-5.jpg","path":"background/bg-5.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-6.jpg","path":"background/bg-6.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-7.jpg","path":"background/bg-7.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-8.jpg","path":"background/bg-8.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg-9.jpg","path":"background/bg-9.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/background/bg.jpg","path":"background/bg.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/css/animate.min.css","path":"css/animate.min.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/css/gitment.css","path":"css/gitment.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/css/loading-style.css","path":"css/loading-style.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/css/showshare.css","path":"css/showshare.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/css/style.styl","path":"css/style.styl","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/blank.gif","path":"fancybox/blank.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/fancybox_loading.gif","path":"fancybox/fancybox_loading.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/fancybox_loading@2x.gif","path":"fancybox/fancybox_loading@2x.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/fancybox_overlay.png","path":"fancybox/fancybox_overlay.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/fancybox_sprite.png","path":"fancybox/fancybox_sprite.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/fancybox_sprite@2x.png","path":"fancybox/fancybox_sprite@2x.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/jquery.fancybox.css","path":"fancybox/jquery.fancybox.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/jquery.fancybox.js","path":"fancybox/jquery.fancybox.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/jquery.fancybox.pack.js","path":"fancybox/jquery.fancybox.pack.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/bg.jpg","path":"img/bg.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/coderwall.png","path":"img/coderwall.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/delicious.png","path":"img/delicious.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/douban.png","path":"img/douban.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/facebook.png","path":"img/facebook.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/favicon.ico","path":"img/favicon.ico","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/github.png","path":"img/github.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/google.png","path":"img/google.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/head.gif","path":"img/head.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/head.png","path":"img/head.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/img-err.png","path":"img/img-err.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/img-loading.png","path":"img/img-loading.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/instagram.png","path":"img/instagram.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/linkedin.png","path":"img/linkedin.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/mail.png","path":"img/mail.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/pinboard.png","path":"img/pinboard.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/pinterest.png","path":"img/pinterest.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/qq.png","path":"img/qq.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/rss.png","path":"img/rss.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/scrollbar_arrow.png","path":"img/scrollbar_arrow.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/segmentfault.png","path":"img/segmentfault.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/stackoverflow.png","path":"img/stackoverflow.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/twitter.png","path":"img/twitter.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/wechat.png","path":"img/wechat.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/weibo.png","path":"img/weibo.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/img/zhihu.png","path":"img/zhihu.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/L2Dwidget.0.min.js","path":"js/L2Dwidget.0.min.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/L2Dwidget.min.js","path":"js/L2Dwidget.min.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/TweenMax.js","path":"js/TweenMax.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/TweenMax.min.js","path":"js/TweenMax.min.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/busuanzi.pure.mini.js","path":"js/busuanzi.pure.mini.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/clipboard.min.js","path":"js/clipboard.min.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/embed.js","path":"js/embed.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/gitment.js","path":"js/gitment.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/instagram.js","path":"js/instagram.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/jquery-1.9.1.min.js","path":"js/jquery-1.9.1.min.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/jquery.lazyload.js","path":"js/jquery.lazyload.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/main.js","path":"js/main.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/mobile.js","path":"js/mobile.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/pace.js","path":"js/pace.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/pc.js","path":"js/pc.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/plugins.js","path":"js/plugins.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/require-2.1.6.js","path":"js/require-2.1.6.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/search.js","path":"js/search.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/snow.js","path":"js/snow.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/etcd-external.png","path":"pics/etcd-external.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/etcd-stacked.png","path":"pics/etcd-stacked.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/gc-area-4008.png","path":"pics/gc-area-4008.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/gc-yg-3223.png","path":"pics/gc-yg-3223.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/harbor-01.png","path":"pics/harbor-01.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/harbor-02.png","path":"pics/harbor-02.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/inode-1-2848.png","path":"pics/inode-1-2848.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/inode-2-4723.png","path":"pics/inode-2-4723.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/inode-3-4837.png","path":"pics/inode-3-4837.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/iptable-01-1.png","path":"pics/iptable-01-1.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/iptable-01-2.png","path":"pics/iptable-01-2.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/iptable-01.png","path":"pics/iptable-01.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/iptable-02.png","path":"pics/iptable-02.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/jvm-area-4346.png","path":"pics/jvm-area-4346.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/jvm-work-4037.png","path":"pics/jvm-work-4037.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/k8s-get-cs-01.png","path":"pics/k8s-get-cs-01.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/k8s-get-cs-02.png","path":"pics/k8s-get-cs-02.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/k8s-get-node-01.png","path":"pics/k8s-get-node-01.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/k8s-get-node-02.png","path":"pics/k8s-get-node-02.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/k8s-get-pend-01.png","path":"pics/k8s-get-pend-01.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/k8s-more-cluster.png","path":"pics/k8s-more-cluster.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/k8s-not-ipvs-02.png","path":"pics/k8s-not-ipvs-02.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/k8s-not-ipvs.png","path":"pics/k8s-not-ipvs.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/k8s-redis-c-set01.png","path":"pics/k8s-redis-c-set01.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/k8s-redis-c-set02.png","path":"pics/k8s-redis-c-set02.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/k8s-redis-timeout.png","path":"pics/k8s-redis-timeout.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/k8s-view-cluster.png","path":"pics/k8s-view-cluster.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/mathjax.png","path":"pics/mathjax.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/mathjax01.png","path":"pics/mathjax01.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/md_flow.png","path":"pics/md_flow.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/new-area-3239.png","path":"pics/new-area-3239.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/nvidia.png","path":"pics/nvidia.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/saw-2.png","path":"pics/saw-2.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/sjq-3917.png","path":"pics/sjq-3917.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/stream-1.png","path":"pics/stream-1.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/stream-type2.png","path":"pics/stream-type2.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/tcp-3-num.jpg","path":"pics/tcp-3-num.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/tcp-4-num.jpg","path":"pics/tcp-4-num.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/test-2022-08-28-14-48.gif","path":"pics/test-2022-08-28-14-48.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/top-4834.png","path":"pics/top-4834.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/top-M-5210.png","path":"pics/top-M-5210.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/vim-4855.png","path":"pics/vim-4855.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/was-1.png","path":"pics/was-1.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/zk_flow_2232.png","path":"pics/zk_flow_2232.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/css/pace/pace-theme-flash.css","path":"css/pace/pace-theme-flash.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/css/sreach/sreach.css","path":"css/sreach/sreach.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/helpers/fancybox_buttons.png","path":"fancybox/helpers/fancybox_buttons.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/helpers/jquery.fancybox-buttons.css","path":"fancybox/helpers/jquery.fancybox-buttons.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/helpers/jquery.fancybox-buttons.js","path":"fancybox/helpers/jquery.fancybox-buttons.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/helpers/jquery.fancybox-media.js","path":"fancybox/helpers/jquery.fancybox-media.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/helpers/jquery.fancybox-thumbs.css","path":"fancybox/helpers/jquery.fancybox-thumbs.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/fancybox/helpers/jquery.fancybox-thumbs.js","path":"fancybox/helpers/jquery.fancybox-thumbs.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/font-awesome/css/font-awesome.css","path":"font-awesome/css/font-awesome.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/font-awesome/css/font-awesome.min.css","path":"font-awesome/css/font-awesome.min.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/font-awesome/fonts/FontAwesome.otf","path":"font-awesome/fonts/FontAwesome.otf","modified":0,"renderable":1},{"_id":"themes/spfk/source/font-awesome/fonts/fontawesome-webfont.eot","path":"font-awesome/fonts/fontawesome-webfont.eot","modified":0,"renderable":1},{"_id":"themes/spfk/source/font-awesome/fonts/fontawesome-webfont.svg","path":"font-awesome/fonts/fontawesome-webfont.svg","modified":0,"renderable":1},{"_id":"themes/spfk/source/font-awesome/fonts/fontawesome-webfont.ttf","path":"font-awesome/fonts/fontawesome-webfont.ttf","modified":0,"renderable":1},{"_id":"themes/spfk/source/font-awesome/fonts/fontawesome-webfont.woff","path":"font-awesome/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/spfk/source/font-awesome/fonts/fontawesome-webfont.woff2","path":"font-awesome/fonts/fontawesome-webfont.woff2","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/404/jquery-2.0.3.min.js","path":"js/404/jquery-2.0.3.min.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/404/jquery.parallaxify-0.0.2.min.js","path":"js/404/jquery.parallaxify-0.0.2.min.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/Mathjax/MathJax.js","path":"js/Mathjax/MathJax.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/haru01.model.json","path":"models/haru01/haru01.model.json","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/haru01.physics.json","path":"models/haru01/haru01.physics.json","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/haru01.pose.json","path":"models/haru01/haru01.pose.json","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/Mathjax/config/TeX-AMS-MML_HTMLorMML.js","path":"js/Mathjax/config/TeX-AMS-MML_HTMLorMML.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/exp/f01.exp.json","path":"models/haru01/exp/f01.exp.json","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/exp/f02.exp.json","path":"models/haru01/exp/f02.exp.json","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/exp/f03.exp.json","path":"models/haru01/exp/f03.exp.json","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/exp/f04.exp.json","path":"models/haru01/exp/f04.exp.json","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/exp/f05.exp.json","path":"models/haru01/exp/f05.exp.json","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/exp/f06.exp.json","path":"models/haru01/exp/f06.exp.json","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/exp/f07.exp.json","path":"models/haru01/exp/f07.exp.json","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/exp/f08.exp.json","path":"models/haru01/exp/f08.exp.json","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/moc/haru01.moc","path":"models/haru01/moc/haru01.moc","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/mtn/flickHead_00.mtn","path":"models/haru01/mtn/flickHead_00.mtn","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/mtn/idle_00.mtn","path":"models/haru01/mtn/idle_00.mtn","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/mtn/idle_01.mtn","path":"models/haru01/mtn/idle_01.mtn","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/mtn/idle_02.mtn","path":"models/haru01/mtn/idle_02.mtn","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/mtn/pinchIn_00.mtn","path":"models/haru01/mtn/pinchIn_00.mtn","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/mtn/pinchOut_00.mtn","path":"models/haru01/mtn/pinchOut_00.mtn","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/mtn/shake_00.mtn","path":"models/haru01/mtn/shake_00.mtn","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/mtn/tapBody_00.mtn","path":"models/haru01/mtn/tapBody_00.mtn","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/mtn/tapBody_01.mtn","path":"models/haru01/mtn/tapBody_01.mtn","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/mtn/tapBody_02.mtn","path":"models/haru01/mtn/tapBody_02.mtn","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/mtn/tapBody_03.mtn","path":"models/haru01/mtn/tapBody_03.mtn","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/mtn/tapBody_04.mtn","path":"models/haru01/mtn/tapBody_04.mtn","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/mtn/tapBody_05.mtn","path":"models/haru01/mtn/tapBody_05.mtn","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/mtn/tapBody_06.mtn","path":"models/haru01/mtn/tapBody_06.mtn","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/mtn/tapBody_07.mtn","path":"models/haru01/mtn/tapBody_07.mtn","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/mtn/tapBody_08.mtn","path":"models/haru01/mtn/tapBody_08.mtn","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/mtn/tapBody_09.mtn","path":"models/haru01/mtn/tapBody_09.mtn","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/imgshare.css","path":"static/api/css/imgshare.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/like.css","path":"static/api/css/like.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/select_share.css","path":"static/api/css/select_share.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_popup.css","path":"static/api/css/share_popup.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_style0_16.css","path":"static/api/css/share_style0_16.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_style0_24.css","path":"static/api/css/share_style0_24.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_style0_32.css","path":"static/api/css/share_style0_32.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_style1_16.css","path":"static/api/css/share_style1_16.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_style1_24.css","path":"static/api/css/share_style1_24.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_style1_32.css","path":"static/api/css/share_style1_32.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_style2.css","path":"static/api/css/share_style2.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_style2_16.css","path":"static/api/css/share_style2_16.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_style2_24.css","path":"static/api/css/share_style2_24.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_style2_32.css","path":"static/api/css/share_style2_32.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/share_style4.css","path":"static/api/css/share_style4.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/slide_share.css","path":"static/api/css/slide_share.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/css/weixin_popup.css","path":"static/api/css/weixin_popup.css","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/share.js","path":"static/api/js/share.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/moc/haru01.1024/texture_00.png","path":"models/haru01/moc/haru01.1024/texture_00.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/moc/haru01.1024/texture_01.png","path":"models/haru01/moc/haru01.1024/texture_01.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/models/haru01/moc/haru01.1024/texture_02.png","path":"models/haru01/moc/haru01.1024/texture_02.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/icons_0_16.png","path":"static/api/img/share/icons_0_16.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/icons_0_24.png","path":"static/api/img/share/icons_0_24.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/icons_0_32.png","path":"static/api/img/share/icons_0_32.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/icons_1_16.png","path":"static/api/img/share/icons_1_16.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/icons_1_24.png","path":"static/api/img/share/icons_1_24.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/icons_1_32.png","path":"static/api/img/share/icons_1_32.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/icons_2_16.png","path":"static/api/img/share/icons_2_16.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/icons_2_24.png","path":"static/api/img/share/icons_2_24.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/icons_2_32.png","path":"static/api/img/share/icons_2_32.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/l0.gif","path":"static/api/img/share/l0.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/l1.gif","path":"static/api/img/share/l1.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/l2.gif","path":"static/api/img/share/l2.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/l3.gif","path":"static/api/img/share/l3.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/l4.gif","path":"static/api/img/share/l4.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/l5.gif","path":"static/api/img/share/l5.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/l6.gif","path":"static/api/img/share/l6.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/l7.gif","path":"static/api/img/share/l7.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/l8.gif","path":"static/api/img/share/l8.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/pop_c.gif","path":"static/api/img/share/pop_c.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/r0.gif","path":"static/api/img/share/r0.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/r1.gif","path":"static/api/img/share/r1.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/r2.gif","path":"static/api/img/share/r2.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/r3.gif","path":"static/api/img/share/r3.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/r4.gif","path":"static/api/img/share/r4.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/r5.gif","path":"static/api/img/share/r5.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/r6.gif","path":"static/api/img/share/r6.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/r7.gif","path":"static/api/img/share/r7.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/r8.gif","path":"static/api/img/share/r8.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/sc.png","path":"static/api/img/share/sc.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/selectshare_close.png","path":"static/api/img/share/selectshare_close.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/img/share/share-search-icon.png","path":"static/api/img/share/share-search-icon.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/base/class.js","path":"static/api/js/base/class.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/base/tangram.js","path":"static/api/js/base/tangram.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/component/animate.js","path":"static/api/js/component/animate.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/component/anticheat.js","path":"static/api/js/component/anticheat.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/component/comm_tools.js","path":"static/api/js/component/comm_tools.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/component/partners.js","path":"static/api/js/component/partners.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/component/pop_base.js","path":"static/api/js/component/pop_base.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/component/pop_dialog.js","path":"static/api/js/component/pop_dialog.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/component/pop_popup.js","path":"static/api/js/component/pop_popup.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/component/pop_popup_slide.js","path":"static/api/js/component/pop_popup_slide.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/component/qrcode.js","path":"static/api/js/component/qrcode.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/conf/const.js","path":"static/api/js/conf/const.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/conf/define.js","path":"static/api/js/conf/define.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/share/api_base.js","path":"static/api/js/share/api_base.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/share/combine_api.js","path":"static/api/js/share/combine_api.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/share/image_api.js","path":"static/api/js/share/image_api.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/share/like_api.js","path":"static/api/js/share/like_api.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/share/likeshare.js","path":"static/api/js/share/likeshare.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/share/select_api.js","path":"static/api/js/share/select_api.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/share/share_api.js","path":"static/api/js/share/share_api.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/share/slide_api.js","path":"static/api/js/share/slide_api.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/start/router.js","path":"static/api/js/start/router.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/trans/data.js","path":"static/api/js/trans/data.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/trans/logger.js","path":"static/api/js/trans/logger.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/trans/trans.js","path":"static/api/js/trans/trans.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/trans/trans_bdxc.js","path":"static/api/js/trans/trans_bdxc.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/trans/trans_bdysc.js","path":"static/api/js/trans/trans_bdysc.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/trans/trans_weixin.js","path":"static/api/js/trans/trans_weixin.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/view/image_view.js","path":"static/api/js/view/image_view.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/view/like_view.js","path":"static/api/js/view/like_view.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/view/select_view.js","path":"static/api/js/view/select_view.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/view/share_view.js","path":"static/api/js/view/share_view.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/view/slide_view.js","path":"static/api/js/view/slide_view.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/static/api/js/view/view_base.js","path":"static/api/js/view/view_base.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/Mathjax/jax/output/HTML-CSS/jax.js","path":"js/Mathjax/jax/output/HTML-CSS/jax.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/Mathjax/fonts/HTML-CSS/Tex/woff/MathJax_Main-Regular.woff","path":"js/Mathjax/fonts/HTML-CSS/Tex/woff/MathJax_Main-Regular.woff","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/Mathjax/fonts/HTML-CSS/Tex/woff/MathJax_Math-Italic.woff","path":"js/Mathjax/fonts/HTML-CSS/Tex/woff/MathJax_Math-Italic.woff","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/Mathjax/fonts/HTML-CSS/Tex/woff/MathJax_Size1-Regular.woff","path":"js/Mathjax/fonts/HTML-CSS/Tex/woff/MathJax_Size1-Regular.woff","modified":0,"renderable":1},{"_id":"themes/spfk/source/js/Mathjax/jax/output/HTML-CSS/fonts/TeX/fontdata.js","path":"js/Mathjax/jax/output/HTML-CSS/fonts/TeX/fontdata.js","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/test-2022-08-31-21-02.gif","path":"pics/test-2022-08-31-21-02.gif","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/1133594981.png","path":"pics/1133594981.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/11d578d1-b5cf-4f49-8623-aab65adb0837.png","path":"pics/11d578d1-b5cf-4f49-8623-aab65adb0837.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/1cb72990-ff22-4fae-a1ee-3d03e9edf07c.png","path":"pics/1cb72990-ff22-4fae-a1ee-3d03e9edf07c.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/30c314a6-b022-4758-9b80-a152853dd1c5.png","path":"pics/30c314a6-b022-4758-9b80-a152853dd1c5.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/450575164.png","path":"pics/450575164.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/5541b376-5ba9-4fa7-bd9e-8ca929bae9e1.png","path":"pics/5541b376-5ba9-4fa7-bd9e-8ca929bae9e1.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/6a7e416d-f5a0-4558-8737-6a2c90ff0515.png","path":"pics/6a7e416d-f5a0-4558-8737-6a2c90ff0515.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/6fda574f-0050-43f7-84b2-e281a0b62989.png","path":"pics/6fda574f-0050-43f7-84b2-e281a0b62989.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/d4853c95-e416-4ffe-b0c9-e8d921971a0e.png","path":"pics/d4853c95-e416-4ffe-b0c9-e8d921971a0e.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/pl-sql-4659.png","path":"pics/pl-sql-4659.png","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/cd88f35d-6766-4f73-8890-4b7fb44b3361.jpg","path":"pics/cd88f35d-6766-4f73-8890-4b7fb44b3361.jpg","modified":0,"renderable":1},{"_id":"themes/spfk/source/pics/1882599998.png","path":"pics/1882599998.png","modified":1,"renderable":1}],"Cache":[{"_id":"source/404.html","hash":"edead60e326152ef343efd9c7f81cd88ed7fda9c","modified":1661048938590},{"_id":"source/CNAME","hash":"86ee0a2b16b71b044225c4ab51b5160e948a9230","modified":1654248025669},{"_id":"source/_posts/draft.md","hash":"09b8ff5f24fe51a7ca5957a4f9974232f66df0c2","modified":1662292263603},{"_id":"source/categories/index.md","hash":"1a116b07abf547005c7f640b55659dad800a7b27","modified":1600503735253},{"_id":"source/other/index.md","hash":"98296367be20e8187b786e60040569d3d191c338","modified":1655730327265},{"_id":"source/tags/index.md","hash":"21d21e2e459397d6616fe4e4a7b44e6a11af2bd4","modified":1600503735253},{"_id":"source/_posts/design-pattern/singleton.md","hash":"b0d52c3e42fca5206c841529b660912c8288e848","modified":1661677800928},{"_id":"source/_posts/lang/sawtl.md","hash":"9f5b6b84864ad1c4ebbe0c63b89b0f21dbbad0a7","modified":1661677800932},{"_id":"source/_posts/markdown/flow.md","hash":"f4f1f7dd3263cdf4226fbba526715dd115be0f0c","modified":1661677800932},{"_id":"source/_posts/markdown/formula.md","hash":"37206f9901b7b1ecb36cfd67ef600fbc6d7e03e8","modified":1661677800932},{"_id":"source/_posts/markdown/mdgrammar.md","hash":"3f4809c6e91b480130e545527b53b8a58e7ff2c9","modified":1661677800932},{"_id":"source/_posts/network/network.md","hash":"f96b5a95bb03a254a5b52bbe484a589c30e99057","modified":1661677800932},{"_id":"source/_posts/network/https自己签名.md","hash":"6969da5974f2d6e9df370a60d4431c2943d63bb6","modified":1654245425139},{"_id":"source/_posts/network/on-line.md","hash":"0b4a0c633faa4be2e265050c2525861ca16b0ad4","modified":1660656507418},{"_id":"source/_posts/network/内网穿透.md","hash":"5ba851ca5c773600e316d58195e3f6eb156b1473","modified":1654244967560},{"_id":"source/_posts/other/avd.md","hash":"26ef44650890631097214e953ccfa89293afdc97","modified":1654245267475},{"_id":"source/_posts/tool/git-pull.md","hash":"0d0336964d602ea0fa992894457189cde75a027b","modified":1661077360047},{"_id":"source/_posts/tool/git-server.md","hash":"90a8c52d0f1963efd12b2ba9e43e219c0ba9a1aa","modified":1661077351639},{"_id":"source/_posts/tool/maven.md","hash":"e61c29505f139657d816bc3f80e673b6ccca53c9","modified":1661677800936},{"_id":"source/_posts/tool/redis-live.md","hash":"d65b390878340c58c984d2740002a53fa79fdecd","modified":1654245444087},{"_id":"source/_posts/lang/gc/jvm-gc0.md","hash":"046ee264164d5f7b17d1b494476eb222e68dfc9d","modified":1661677800932},{"_id":"source/_posts/lang/go/go初识.md","hash":"920b41772db1a58a63e130c50009933113581e2a","modified":1661677800932},{"_id":"source/_posts/lang/java/stream.md","hash":"c8dbf55a6bb26c4bf0626632de04763f4ef96a2d","modified":1661677800932},{"_id":"source/_posts/lang/python/pip.md","hash":"4a41a407eb94f17f22999dec20eb92ef11785b31","modified":1661677800932},{"_id":"source/_posts/lang/test/tests.md","hash":"ffabe5e1fe3b5a410b2a54970b4c93a966d752ce","modified":1661951667778},{"_id":"source/_posts/linux/debian/apt.md","hash":"c0f4de0675d726e12471d2ac94b1d3d53cbfd119","modified":1661677800948},{"_id":"source/_posts/linux/debian/dpkg.md","hash":"5803d8e1ec06cc2aaad885864ead6d5e4c4d1aa1","modified":1661592126401},{"_id":"source/_posts/linux/k8s/compose.md","hash":"c51dc71661368b53041a7a1c80e6e2a803308421","modified":1659861243144},{"_id":"source/_posts/linux/k8s/docker.md","hash":"723a7431b433f9c8fad4c57ad49d72f6244d56c4","modified":1660656400694},{"_id":"source/_posts/linux/k8s/docker1.md","hash":"61256a9903efffdd6b7dbbcb42ebc525bed3f554","modified":1661677800940},{"_id":"source/_posts/linux/k8s/etcd.md","hash":"12f07fb40824b46171928c9dcabaf956ca4d0ef6","modified":1661677800940},{"_id":"source/_posts/linux/k8s/flanneld.md","hash":"cbc2dc30f6863669ad4621bdbc032d39abc163ef","modified":1661677800936},{"_id":"source/_posts/linux/k8s/harbor.md","hash":"e7fe3e5a9df817fc92c8a320eba2a75ea5a8f485","modified":1661677800936},{"_id":"source/_posts/linux/k8s/helm.md","hash":"3f260d0e90ac1da96575a7cb058576cce8f0f032","modified":1661780721964},{"_id":"source/_posts/linux/k8s/k8s.md","hash":"2d8666205c393911a806d5094e90e82015bfeb22","modified":1661677800944},{"_id":"source/_posts/linux/k8s/k8s01.md","hash":"b9514b5b33b5684fd7699d8952ee0a7bd7b33547","modified":1661677800940},{"_id":"source/_posts/linux/k8s/kubeadm.md","hash":"9df5b81cd4404736e6dcf859d79a6ac731f87772","modified":1661677800944},{"_id":"source/_posts/linux/k8s/kubelet.md","hash":"c68c95954be38e7490333c62ea551675c8425391","modified":1661677800936},{"_id":"source/_posts/linux/k8s/redis.md","hash":"0cf44573ffe1cb3e8fbdc9351d76070180fd581d","modified":1661677800944},{"_id":"source/_posts/linux/k8s/traefik.md","hash":"23c4422365cc46dbbe64cf1992d90581292e167b","modified":1661677800940},{"_id":"source/_posts/linux/k8s/初识K8S.md","hash":"2b6490ae340edfd844aabf785e2501528f4076dc","modified":1658406032885},{"_id":"source/_posts/linux/shell/decompress.md","hash":"8b5b621a14f5f7c716d823f1bffd0bca1e926778","modified":1661677800944},{"_id":"source/_posts/linux/shell/find.md","hash":"9bf09cfbbe171dd9ebd204573fd6725943d0fd51","modified":1662193977932},{"_id":"source/_posts/linux/shell/download.md","hash":"4940fdad957fb1f863017f729973154c0370f27a","modified":1661677800948},{"_id":"source/_posts/linux/shell/grep.md","hash":"fd3694b8cfb7ad967402b6ec21d1ebe7cce06111","modified":1661677800948},{"_id":"source/_posts/linux/shell/iptable.md","hash":"f3fdcbbc95031d384b08747cc892b433d11feb60","modified":1661677800944},{"_id":"source/_posts/linux/shell/ps.md","hash":"ba2bdd6df85951e349adc94d8b006123e9339028","modified":1657806943621},{"_id":"source/_posts/linux/shell/sed.md","hash":"b264e986472379b6c4a191dd6d75e18056113beb","modified":1661677800948},{"_id":"source/_posts/linux/shell/top.md","hash":"59fc9be63d7273933edf6d7504c99ec782652cc6","modified":1661677800948},{"_id":"source/_posts/linux/shell/tree.md","hash":"7fbc81a6c8756cb3ffc0b76fc3a0c273377d95ce","modified":1661677800944},{"_id":"source/_posts/linux/shell/usage_high.md","hash":"d4c29924a5c47b38534544cc0fa34e3d2296cb4d","modified":1661677800944},{"_id":"source/_posts/linux/shell/vim.md","hash":"00844b634550bf8603600d7b0ab5d2b0f6cbbb28","modified":1661677800948},{"_id":"source/_posts/services/container/tomcat.md","hash":"3449bf698aa8068f4bf9bd622af8758036075df2","modified":1661677800936},{"_id":"source/_posts/services/database/mongo.md","hash":"9abd676f3457a5778d662b2af3504a1c265ce2f3","modified":1661677800936},{"_id":"source/_posts/services/elk/es-shield.md","hash":"93097d9cbc4f584e688dd78a81aead69c17e5cd1","modified":1654245330095},{"_id":"source/_posts/services/elk/kibana.md","hash":"94b0a837879bfd130666b3cb07a4bca3e6d60b20","modified":1654245436059},{"_id":"source/_posts/services/elk/logstash.md","hash":"3f446a814b2e15636df51f49c515170277cebee9","modified":1654245452535},{"_id":"source/_posts/services/elk/安装ElasticSearch.md","hash":"3686e677ae87ed17740b37a927ac9abdc31afc4a","modified":1654245553675},{"_id":"source/_posts/services/zookeeper/选举机制.md","hash":"b39151ba961e0473ea3cb89ac06650586a9259b4","modified":1661677800936},{"_id":"source/_posts/lang/node/hexo/hexo.md","hash":"e66ec9955948cf7fe1c304c54ce40ba3297d448f","modified":1661780611836},{"_id":"source/_posts/lang/node/hexo/搭建hexo.md","hash":"60853143463aff2a2d72b59e680c344028203981","modified":1661780512593},{"_id":"source/_posts/lang/node/hexo/评论.md","hash":"db734b2d02c6c29d3e30bdf39ef58404c4084418","modified":1661077562928},{"_id":"source/_posts/lang/node/npm/npm初始.md","hash":"bf8ac4292031e9549ae7a76b443f024d7ffd36de","modified":1661677800932},{"_id":"source/_posts/services/database/mysql/install.md","hash":"d201dcf27ae855faaf20495e428b86afa3ab7870","modified":1661677800936},{"_id":"source/_posts/services/database/mysql/my.md","hash":"5c896501a9dcdca5cc52af6d4bd0282ecd2bf47d","modified":1662215741261},{"_id":"source/_posts/services/database/redis/redis-cluster.md","hash":"f3bb56051a59a08cec0bc75eba7b36ee9cc2a06d","modified":1661677800936},{"_id":"themes/spfk/source/static/api/img/share/l8.gif","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1600503735289},{"_id":"themes/spfk/source/static/api/js/trans/data.js","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/trans/logger.js","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1600503735293},{"_id":"themes/spfk/README.md","hash":"228961ab390b883cb441fec95fd2ae6ab1f423ba","modified":1600503735253},{"_id":"themes/spfk/package.json","hash":"00357ef6f24eb049074da81809e98f973f528cca","modified":1600503735253},{"_id":"themes/spfk/languages/en.yml","hash":"8fa0a7482188ca56fd3cf19c4a87320f85a76846","modified":1600503735253},{"_id":"themes/spfk/languages/default.yml","hash":"9e59cd11b290be84909612beb12d0f93ce737f53","modified":1600503735253},{"_id":"themes/spfk/languages/de.yml","hash":"ecb13af8af81ccc033ae7494cb2f94f84f6466ad","modified":1600503735253},{"_id":"themes/spfk/languages/fr-FR.yml","hash":"12cfa96dc412ecb6f8bf4de2690575929464906e","modified":1600503735253},{"_id":"themes/spfk/languages/ru.yml","hash":"9997425292031ee8a58a93346ac6d3f38f18e566","modified":1600503735253},{"_id":"themes/spfk/languages/pt-BR","hash":"922b6d836cc690742b2d55a725e3886c5d0cbb75","modified":1600503735253},{"_id":"themes/spfk/languages/zh-Hans.yml","hash":"0d7e8da60fd5e5db217e1733ac273ae00fd752ea","modified":1600503735253},{"_id":"themes/spfk/languages/zh-hk.yml","hash":"606dfb34d3fec1d7895a654ff7a5a1de0c6a5c55","modified":1600503735253},{"_id":"themes/spfk/languages/zh-tw.yml","hash":"9e4034870b57d2bb3063c91f8d206a6c4d7b3789","modified":1600503735253},{"_id":"themes/spfk/languages/zh.yml","hash":"0d7e8da60fd5e5db217e1733ac273ae00fd752ea","modified":1600503735253},{"_id":"themes/spfk/_config.yml","hash":"1b8f574380d244e9c4ad13d63c4005d949b63d23","modified":1661953496029},{"_id":"themes/spfk/layout/archive.ejs","hash":"2703b07cc8ac64ae46d1d263f4653013c7e1666b","modified":1600503735253},{"_id":"themes/spfk/layout/category.ejs","hash":"765426a9c8236828dc34759e604cc2c52292835a","modified":1600503735253},{"_id":"themes/spfk/layout/index.ejs","hash":"aa1b4456907bdb43e629be3931547e2d29ac58c8","modified":1600503735253},{"_id":"themes/spfk/layout/page.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1660987582155},{"_id":"themes/spfk/layout/plugins.swig","hash":"f809b5e62e968a80921c56e5d7658325b48b7263","modified":1600503735253},{"_id":"themes/spfk/layout/layout.ejs","hash":"5c12163e2ced4341790880a4d78a193edd945920","modified":1661590953317},{"_id":"themes/spfk/layout/post.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1600503735253},{"_id":"themes/spfk/layout/tag.ejs","hash":"eaa7b4ccb2ca7befb90142e4e68995fb1ea68b2e","modified":1600503735253},{"_id":"themes/spfk/layout/_partial/archive.ejs","hash":"a6e94061ac55b9eb55275f87b608d62f6ea35659","modified":1600503735253},{"_id":"themes/spfk/layout/_partial/archive-post.ejs","hash":"8af583c5f60c69ffdc97bee4e8fdac1ba34ebecd","modified":1600503735253},{"_id":"themes/spfk/layout/_partial/after-footer.ejs","hash":"6dff32cfdc5fa1234998e6e0a441697c512fd64f","modified":1661866893384},{"_id":"themes/spfk/layout/_partial/background.ejs","hash":"cb656037dae582272c748c68a174f2da622d5a12","modified":1600503735253},{"_id":"themes/spfk/layout/_partial/article.ejs","hash":"f2848a9aca90788e76eb7f2429417044c7ea10fe","modified":1661076365121},{"_id":"themes/spfk/layout/_partial/bodybackground.ejs","hash":"931700a928b84577cc33dfff68a009188885f6c0","modified":1600503735253},{"_id":"themes/spfk/layout/_partial/case.swig","hash":"a2a7ec0e4c203e49fd32335c60c3b9851ed6e4a5","modified":1600503735253},{"_id":"themes/spfk/layout/_partial/header.ejs","hash":"6387a93dad7c3d778eb91e3821852fbf6813880c","modified":1600503735253},{"_id":"themes/spfk/layout/_partial/head.ejs","hash":"180195c0a6518d518712f8aaa8124f2eba2049c1","modified":1661082350327},{"_id":"themes/spfk/layout/_partial/hide-labels.ejs","hash":"f1707aa373edb83f29cedb99f7a1f28ef9e37b1c","modified":1660572176432},{"_id":"themes/spfk/layout/_partial/mathjax.ejs","hash":"9493e8f13611af757d4e421b8f2d4fca9865c119","modified":1660652451752},{"_id":"themes/spfk/source/apple-touch-icon.png","hash":"ba4cfb985b3490efda9b77da5d972dda55ef4c95","modified":1654244940324},{"_id":"themes/spfk/layout/_partial/footer.ejs","hash":"8bdea14ea0de21fdf6faf8552d3b0ea3f1a0ca6c","modified":1661866664794},{"_id":"themes/spfk/layout/_partial/mobile-nav.ejs","hash":"320de58b166710d02963d80f27bcd50478841401","modified":1600503735253},{"_id":"themes/spfk/layout/_partial/left-col.ejs","hash":"b70b9b29f66a20f28fc731c3eda8b86a59a27da4","modified":1661010552718},{"_id":"themes/spfk/layout/_partial/plugin.swig","hash":"17b6c6945e4b1b41dbb10d851f85ca10100c28ea","modified":1600503735253},{"_id":"themes/spfk/layout/_partial/post-nav-button.ejs","hash":"e2346c1decdbfd78e9233ce0823207a97d5fbf4c","modified":1660571896907},{"_id":"themes/spfk/layout/_partial/page.ejs","hash":"7fd5e886e66219fb4cf79e2982c88016619ba245","modified":1661077414487},{"_id":"themes/spfk/layout/_partial/theme.swig","hash":"5a279ad8f6c6b7c104cce495faa563d8b7a7c74a","modified":1600503735253},{"_id":"themes/spfk/layout/_partial/scrolling-button.ejs","hash":"b3a28974f37375796687e6100b48c3da6f662640","modified":1600503735253},{"_id":"themes/spfk/layout/_partial/toc.ejs","hash":"8a75fd133f3055f6cf315def3c264ea5b8b8df15","modified":1660572183920},{"_id":"themes/spfk/layout/_partial/work.swig","hash":"6bdb6ec45f6179875e5a33bfdc7568a3831638fd","modified":1600503735253},{"_id":"themes/spfk/source/css/_extend.styl","hash":"222fbe6d222531d61c1ef0f868c90f747b1c2ced","modified":1600503735281},{"_id":"themes/spfk/source/css/_variables.styl","hash":"a753c14f409a294188f2e99575f2c10b82fd56a2","modified":1600503735281},{"_id":"themes/spfk/source/css/loading-style.css","hash":"1f67362d809e85edc9f122db7bc3711af1ed1d8b","modified":1600503735281},{"_id":"themes/spfk/source/css/showshare.css","hash":"d5288601c95acd7fea993ac8cc3d04efcbdd1559","modified":1600503735281},{"_id":"themes/spfk/source/css/gitment.css","hash":"5f89b47a2e4ae88e793f2f1ad641acad32025769","modified":1661346775655},{"_id":"themes/spfk/source/css/style.styl","hash":"806fc5c30a2ba90b80ba5387e5c3ff0cda004a5c","modified":1660984494249},{"_id":"themes/spfk/source/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1600503735281},{"_id":"themes/spfk/source/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1600503735281},{"_id":"themes/spfk/source/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1600503735281},{"_id":"themes/spfk/source/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1600503735281},{"_id":"themes/spfk/source/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1600503735281},{"_id":"themes/spfk/source/fancybox/jquery.fancybox.css","hash":"b6aa6692c2e5f8bd74d96827b78570f0c5683c20","modified":1600503735281},{"_id":"themes/spfk/source/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1600503735281},{"_id":"themes/spfk/source/css/animate.min.css","hash":"1c82cb6234b6d3a51c2e8c6e7d8c4eb98ecbd2a0","modified":1660652909069},{"_id":"themes/spfk/source/img/coderwall.png","hash":"fa84676c4d654e040e51fd34bfcd9f9348cd5331","modified":1600503735285},{"_id":"themes/spfk/source/img/delicious.png","hash":"9553a5f5189e4a953e04a58a49dbfa74b86b73dd","modified":1600503735285},{"_id":"themes/spfk/source/img/douban.png","hash":"e2ade003ffadd5826ee66ec23901c2d6e8607e4e","modified":1600503735285},{"_id":"themes/spfk/source/img/facebook.png","hash":"d19ad7a0903daf26817afd8753cd97e0cc714f54","modified":1600503735285},{"_id":"themes/spfk/source/fancybox/jquery.fancybox.pack.js","hash":"9e0d51ca1dbe66f6c0c7aefd552dc8122e694a6e","modified":1600503735281},{"_id":"themes/spfk/source/img/github.png","hash":"b84d03b32fa388dcbf149296ebd16dce6223d48d","modified":1600503735285},{"_id":"themes/spfk/source/img/google.png","hash":"61a21fec7346fa3400b747ac9a201cf3d5bc013d","modified":1600503735285},{"_id":"themes/spfk/source/img/head.gif","hash":"285e9578704830b82a36b57552a88fcae5652b14","modified":1600503735285},{"_id":"themes/spfk/source/fancybox/jquery.fancybox.js","hash":"a82597493d75ea989ca586e09173cff332efe41e","modified":1600503735281},{"_id":"themes/spfk/source/img/img-err.png","hash":"23a63ea26eb3c1d5e677d9883cf36cc1a1a1228b","modified":1600503735285},{"_id":"themes/spfk/source/img/img-loading.png","hash":"a9cd5cd11866824f31e3d1c5e23badfeb3f73031","modified":1600503735285},{"_id":"themes/spfk/source/img/linkedin.png","hash":"e203138fb53c257cb214e97f4e30091b9c568d2c","modified":1600503735285},{"_id":"themes/spfk/source/img/mail.png","hash":"fca8199cc77fdbd700a45bf56d091c82f4a67fe7","modified":1600503735285},{"_id":"themes/spfk/source/img/pinboard.png","hash":"0891fbb6d092fa012bf936019923383d84c6aeb0","modified":1600503735285},{"_id":"themes/spfk/source/img/pinterest.png","hash":"9c72917f8779c083157c6ce7a5d62ed4874f0630","modified":1600503735285},{"_id":"themes/spfk/source/img/instagram.png","hash":"3c148a3882a8d141d7d405be8c4815d0dcb03561","modified":1600503735285},{"_id":"themes/spfk/source/img/qq.png","hash":"fd741764c5528fe371f053beac99839a97900eef","modified":1600503735285},{"_id":"themes/spfk/source/img/rss.png","hash":"430fd47340e75214c081abd05cd7410cf7c71b86","modified":1600503735285},{"_id":"themes/spfk/source/img/scrollbar_arrow.png","hash":"d64a33c4ddfbdb89deeb6f4e3d36eb84dc4777c0","modified":1600503735285},{"_id":"themes/spfk/source/img/stackoverflow.png","hash":"da5dfe9043055c95e479d49c78cd3b020de608f2","modified":1600503735285},{"_id":"themes/spfk/source/img/twitter.png","hash":"14dbb8e62d056525253bc0de13acd1723da7a934","modified":1600503735285},{"_id":"themes/spfk/source/img/wechat.png","hash":"7ca41b6e32ca4dac419225261ab4fee5a88f73a9","modified":1600503735285},{"_id":"themes/spfk/source/img/segmentfault.png","hash":"4483ab273423deb65021111fc8ad9512b69e45b2","modified":1600503735285},{"_id":"themes/spfk/source/img/weibo.png","hash":"280dae3fd38086158b4a1b57edb94c06b1a5014b","modified":1600503735285},{"_id":"themes/spfk/source/img/zhihu.png","hash":"a6d6ef65e9ac82e613a311810391ebb90d9b1c1d","modified":1600503735285},{"_id":"themes/spfk/source/js/TweenMax.js","hash":"0ba64564a4fde4085fa3971dd53b7d64a41751e1","modified":1600503735285},{"_id":"themes/spfk/source/js/busuanzi.pure.mini.js","hash":"a30fcd42f277944e6524b99f2412b1f01880b813","modified":1661076627913},{"_id":"themes/spfk/source/js/clipboard.min.js","hash":"c13b4bb8fee46447284590d2afc0efca0ea3cb7b","modified":1600503735285},{"_id":"themes/spfk/source/js/L2Dwidget.min.js","hash":"3d2871f7e2197dec1d6cb152b18e8e51a1a5da45","modified":1661085527866},{"_id":"themes/spfk/source/js/instagram.js","hash":"f19adbcc0dac33536bc6660598059048ec901882","modified":1600503735289},{"_id":"themes/spfk/source/js/jquery.lazyload.js","hash":"8e4ad3e17f8e82be311b6b6e87811762e2b2d764","modified":1600503735289},{"_id":"themes/spfk/source/js/main.js","hash":"06547b8258c1ae76d423bc0cb22e3557d36c9da1","modified":1661074370677},{"_id":"themes/spfk/source/js/mobile.js","hash":"d3847e5bcaf39108931724ecb02770c62b10889f","modified":1600503735289},{"_id":"themes/spfk/source/js/pc.js","hash":"ab375af6e3bcd054b1e87e1a8dcd3d7d25c2db40","modified":1600503735289},{"_id":"themes/spfk/source/js/plugins.js","hash":"c1cf96b2d852b5803228a34d99014b005623bc06","modified":1600503735289},{"_id":"themes/spfk/source/js/pace.js","hash":"b49c10cd65d9488f7338e3c778e55ac6628650f3","modified":1600503735289},{"_id":"themes/spfk/source/js/snow.js","hash":"59eb010aa02886a3b34da907d9bccb606f0e81bd","modified":1661580369717},{"_id":"themes/spfk/source/js/search.js","hash":"c2fa230edb2da0cb7cc59a47c40c58dd72d6ea9d","modified":1661870241721},{"_id":"themes/spfk/source/pics/etcd-stacked.png","hash":"8c3e90699e01ee5966b4674289ec3863439595ca","modified":1659277546689},{"_id":"themes/spfk/source/pics/etcd-external.png","hash":"b1600554e7bf41465efb21210c659e14d045063e","modified":1659277574309},{"_id":"themes/spfk/source/pics/harbor-01.png","hash":"d178459bdbd85a5302e80f84e4e54a74bc819a60","modified":1660376523678},{"_id":"themes/spfk/source/pics/iptable-01-2.png","hash":"d6564bc1af9f6e19afedc749c5de807a5a214c26","modified":1659260760892},{"_id":"themes/spfk/source/pics/mathjax.png","hash":"3ad170ea6da6e12bee385df5a4fd91a97cd8204e","modified":1660652305930},{"_id":"themes/spfk/source/pics/mathjax01.png","hash":"b91a4ca94fc7353c8ef12bdc5076d53e3e1acb9d","modified":1660653754208},{"_id":"themes/spfk/source/pics/md_flow.png","hash":"2dcc57416b4e1a14a46ac34338c05aeff8d106cd","modified":1654269859255},{"_id":"themes/spfk/source/pics/new-area-3239.png","hash":"c1cf749d4874dc94fb0948e9987d5ee97a4a9e38","modified":1654939975343},{"_id":"themes/spfk/source/pics/stream-type2.png","hash":"75e66bcc8f0caa5ecdbafe9770b60b6d534e261d","modified":1659163753718},{"_id":"themes/spfk/source/pics/tcp-3-num.jpg","hash":"7eb24a0508789b2ad1222522d1c21f42b8b636e1","modified":1655731382792},{"_id":"themes/spfk/source/pics/tcp-4-num.jpg","hash":"ea44ab0f22c7db3e3104f8eb3f4d1133826cc9c4","modified":1655731365336},{"_id":"themes/spfk/source/pics/was-1.png","hash":"915414e468c12a181789df5bd542185cb69dcfee","modified":1657808218176},{"_id":"themes/spfk/layout/_partial/analytics/baidu-analytics.ejs","hash":"b21500b87d79a0068e3ca0408b4e125e3e749d01","modified":1600503735253},{"_id":"themes/spfk/layout/_partial/analytics/google-analytics.ejs","hash":"f921e7f9223d7c95165e0f835f353b2938e40c45","modified":1600503735253},{"_id":"themes/spfk/layout/_partial/post/TipTitle.ejs","hash":"65b0956edca84e0bc0eb616ec236309822d5f803","modified":1600503735253},{"_id":"themes/spfk/layout/_partial/comments/gitment.ejs","hash":"e5e3d1c7e0ee19578aec918886d96cf0bad16af6","modified":1661783746931},{"_id":"themes/spfk/layout/_partial/post/date.ejs","hash":"1cfcf2e06ab9b1c6dcd44f41825dfe98d400c7ea","modified":1600503735253},{"_id":"themes/spfk/layout/_partial/post/category.ejs","hash":"595ea1ce6c4d5f0be840905115145c7100819caa","modified":1600503735253},{"_id":"themes/spfk/layout/_partial/post/loading.ejs","hash":"52a576a8afee08d33c6f69a61c496e1820132e91","modified":1600503735253},{"_id":"themes/spfk/layout/_partial/post/nav.ejs","hash":"4779c17cf76bf4560e52708102467bb8ec7a2781","modified":1600503735253},{"_id":"themes/spfk/source/pics/zk_flow_2232.png","hash":"e2e90b9520c1191482d52f15d0a696fb13bae1f3","modified":1654320171709},{"_id":"themes/spfk/layout/_partial/post/swiftype.ejs","hash":"76374e601d911e1279e1944d2a6b7eb3391c7c7c","modified":1600503735253},{"_id":"themes/spfk/layout/_partial/post/tag.ejs","hash":"9dad471e27de9e066666f3082137eccaede2e67b","modified":1600503735253},{"_id":"themes/spfk/layout/_partial/share/baidu-share.ejs","hash":"993b7d231881601ba79aab1e78d75dcb271b3500","modified":1600503735253},{"_id":"themes/spfk/layout/_partial/post/title.ejs","hash":"2f275739b6f1193c123646a5a31f37d48644c667","modified":1600503735253},{"_id":"themes/spfk/layout/_partial/share/share.ejs","hash":"62467610ba6df9b63350d163e806be774dcf5a00","modified":1600503735253},{"_id":"themes/spfk/layout/_partial/share/showshare.ejs","hash":"410b809eb6c50bacfd9e1e573f1e0251841bc79d","modified":1600503735253},{"_id":"themes/spfk/source/css/_partial/archive.styl","hash":"a8bc2e2458bcc51fa68122274a41f5e4e52a8ebd","modified":1600503735281},{"_id":"themes/spfk/source/css/_partial/baidushare.styl","hash":"fe36e3d8933b1b0b674aaf16e50dbf6090099912","modified":1600503735281},{"_id":"themes/spfk/source/css/_partial/footer.styl","hash":"cbf916a5338e69e05d0815c53aeb818d636b6d99","modified":1600503735281},{"_id":"themes/spfk/source/css/_partial/header.styl","hash":"85ab11e082f4dd86dde72bed653d57ec5381f30c","modified":1600503735281},{"_id":"themes/spfk/source/css/_partial/instagram.styl","hash":"db9cc156c7df27f7f54b0e7ff34b5949f55f99eb","modified":1600503735281},{"_id":"themes/spfk/source/css/_partial/article.styl","hash":"e4cfd779fbf6ea7687d4b86ff157df69a322ce85","modified":1600503735281},{"_id":"themes/spfk/source/css/_partial/mobile-slider.styl","hash":"3bf9f2359f68c700e21618ad6262db81038c3d96","modified":1600503735281},{"_id":"themes/spfk/source/css/_partial/highlight.styl","hash":"62d7930e9556f893088c65c5fc4229a10ebc7671","modified":1600503735281},{"_id":"themes/spfk/source/css/_partial/page.styl","hash":"46b9c91428c1e1f42cc8a1010f600f70fb8edc82","modified":1600503735281},{"_id":"themes/spfk/source/css/_partial/plugins.styl","hash":"629ae10dfc053dbfc074966f0bf7f0115acf65e2","modified":1600503735281},{"_id":"themes/spfk/source/css/_partial/mobile.styl","hash":"53b1a06e08df81427505cbc76cc8eb02bea54356","modified":1600503735281},{"_id":"themes/spfk/source/css/_partial/scroll.styl","hash":"1932774d30b8706919342f9cf36ea2d99987ce14","modified":1600503735281},{"_id":"themes/spfk/source/css/_partial/share.styl","hash":"2dde7c9ea40c71fce3dbd8d5e2bcc8d9682141b8","modified":1600503735281},{"_id":"themes/spfk/source/css/_util/grid.styl","hash":"0bf55ee5d09f193e249083602ac5fcdb1e571aed","modified":1600503735281},{"_id":"themes/spfk/source/css/_partial/wheelmenu.styl","hash":"74630c56944e27bef53ef0c0e391611a2eec2ed0","modified":1600503735281},{"_id":"themes/spfk/source/css/_util/mixin.styl","hash":"44f32767d9fd3c1c08a60d91f181ee53c8f0dbb3","modified":1600503735281},{"_id":"themes/spfk/source/css/_partial/main.styl","hash":"6e3d15fbe2663bb6fc408df4a771925c3eac65cf","modified":1600503735281},{"_id":"themes/spfk/source/css/sreach/sreach.css","hash":"337cb45a14b60bb42d9bfede39068a1b9ea5206e","modified":1661590021216},{"_id":"themes/spfk/source/css/pace/pace-theme-flash.css","hash":"69baa198ae459372b7e08b1c31544367da76a5a6","modified":1600503735281},{"_id":"themes/spfk/source/fancybox/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1600503735281},{"_id":"themes/spfk/source/fancybox/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1600503735281},{"_id":"themes/spfk/source/css/_partial/tagcloud.styl","hash":"91e6553775ca931a1b3db1ab11c4cf227df68c21","modified":1600503735281},{"_id":"themes/spfk/source/fancybox/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1600503735281},{"_id":"themes/spfk/source/fancybox/helpers/jquery.fancybox-buttons.js","hash":"dc3645529a4bf72983a39fa34c1eb9146e082019","modified":1600503735281},{"_id":"themes/spfk/source/fancybox/helpers/jquery.fancybox-media.js","hash":"294420f9ff20f4e3584d212b0c262a00a96ecdb3","modified":1600503735281},{"_id":"themes/spfk/source/fancybox/helpers/jquery.fancybox-thumbs.js","hash":"47da1ae5401c24b5c17cc18e2730780f5c1a7a0c","modified":1600503735281},{"_id":"themes/spfk/source/font-awesome/css/font-awesome.min.css","hash":"12d6861075de8e293265ff6ff03b1f3adcb44c76","modified":1600503735281},{"_id":"themes/spfk/source/font-awesome/css/font-awesome.css","hash":"b488600451227b445414796e9b8550e7c1bd6d29","modified":1600503735281},{"_id":"themes/spfk/source/models/haru01/haru01.model.json","hash":"1f131079ff5ee6abe50d56c8332823052bd734f9","modified":1661347015743},{"_id":"themes/spfk/source/models/haru01/haru01.physics.json","hash":"490ab4735f5cddca766344468591c0eb90cda1f7","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/haru01.pose.json","hash":"4fb902065bd3f309fa0029fe2505424851fd489f","modified":1511678673000},{"_id":"themes/spfk/source/css/_partial/customise/blockquote.styl","hash":"83179f1d0e12b025cd433a6071b2826c2b4168cc","modified":1600503735281},{"_id":"themes/spfk/source/css/_partial/customise/code-block.styl","hash":"1f05c0558b2970c369fe19bafbc8a1821c09bce0","modified":1600503735281},{"_id":"themes/spfk/source/js/404/jquery.parallaxify-0.0.2.min.js","hash":"b97e2dfcb210b76f7bdd6e1800b26128bf4fad99","modified":1600503735285},{"_id":"themes/spfk/source/css/_partial/customise/inline-code.styl","hash":"ac2fcef8823d5566c0e27f23b2a46beecbd71c72","modified":1600503735281},{"_id":"themes/spfk/source/css/_partial/post/youyan.styl","hash":"ac2869e2e0fb3a1ee0df4b0c0a233a2b1923ea20","modified":1600503735281},{"_id":"themes/spfk/source/models/haru01/exp/f01.exp.json","hash":"84073a497ddb6e56c6cfc244a0fb217ba473abf9","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/exp/f04.exp.json","hash":"3156286d7e0281e15c637a889aa415eef3224fa7","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/exp/f05.exp.json","hash":"1123786fb0bb9c31f7d30cf14b2299f898cdc207","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/exp/f06.exp.json","hash":"d962889ec7c563d818ddb5ab1e58cd337b5e62db","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/exp/f03.exp.json","hash":"a65382a1a8d8f7034eac2c811b9f122a8b3f1403","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/exp/f07.exp.json","hash":"d55366c9bcf382e8273cf1803f65cdb8a4a0d336","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/exp/f08.exp.json","hash":"4a9ba4b11d9797f59c7b043d2b807ed8253f3cc4","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/mtn/flickHead_00.mtn","hash":"66577f6dde2bec905930fba0dd5f06de939c8f1e","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/mtn/idle_01.mtn","hash":"035c196f276ed177239ea05eeaece68b0fda2935","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/mtn/idle_00.mtn","hash":"bbaaafe4de159dd4fb73d137d283c640d3fede53","modified":1511678673000},{"_id":"themes/spfk/source/js/Mathjax/MathJax.js","hash":"9b6f31afab6fe8257dd6f6a88c9537d13bb58a13","modified":1660572644157},{"_id":"themes/spfk/source/models/haru01/mtn/idle_02.mtn","hash":"82291b3b78339d52f559a65d02b78e0b30180503","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/mtn/pinchOut_00.mtn","hash":"db831991287e3a4724578f068a68e48168081d5a","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/mtn/pinchIn_00.mtn","hash":"ed792ed8226aa5a3e5bf059285b2c95855c11303","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/mtn/shake_00.mtn","hash":"7e938c4abe83273766c4562a571301811dea1de6","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/mtn/tapBody_00.mtn","hash":"4041b2f1f2f4a84454180f9dab14e46d99e135c0","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/mtn/tapBody_01.mtn","hash":"91fbfe1870f7a0a5f5fdb87c213c41b2a8cb5648","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/mtn/tapBody_02.mtn","hash":"e93a2163cbb85525338e11a520e317329b11fb65","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/mtn/tapBody_03.mtn","hash":"fcd573576112ad5f4e4b7dc0b750de79f150f971","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/mtn/tapBody_05.mtn","hash":"5f48e50e938f98636519c370745a39b921907719","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/mtn/tapBody_04.mtn","hash":"557811c5f4ddbd393542366ef95794b19fc60387","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/mtn/tapBody_06.mtn","hash":"3d06ac66c04eb12c64d36551dd85389f0b0ee51f","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/mtn/tapBody_08.mtn","hash":"64a03a904d701039bf81e1296ee79537c2e8800e","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/mtn/tapBody_07.mtn","hash":"d299747aaf27377d552ef1f8b4fce9871a65c37d","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/mtn/tapBody_09.mtn","hash":"4f50c17dcf352995e51a4d462b9ca7a9e9197d5c","modified":1511678673000},{"_id":"themes/spfk/source/static/api/css/select_share.css","hash":"d0259abdb410193cf761e42bffaa51e70327a0cd","modified":1600503735289},{"_id":"themes/spfk/source/static/api/css/imgshare.css","hash":"c3624a2dde649ed28b2e5d1f050fd971fbaf71a0","modified":1600503735289},{"_id":"themes/spfk/source/static/api/css/like.css","hash":"2024d58206df01b858c38f07957f928b44e14cb3","modified":1600503735289},{"_id":"themes/spfk/source/static/api/css/share_popup.css","hash":"338ba2b30ef8ce0c84cd36b37d7f8482996291dc","modified":1600503735289},{"_id":"themes/spfk/source/static/api/css/share_style0_16.css","hash":"090e77e9e6e9b8ee0d73a233cbe46499de935bdd","modified":1600503735289},{"_id":"themes/spfk/source/static/api/css/share_style0_24.css","hash":"7d1f9f32b80f91001f4f951aa045180cde22d82e","modified":1600503735289},{"_id":"themes/spfk/source/static/api/css/share_style0_32.css","hash":"7c2d12ea532c8a55c102b649bb23ef5bf53b3ed3","modified":1600503735289},{"_id":"themes/spfk/source/static/api/css/share_style1_16.css","hash":"aeb4e9fa96cfa0167481e1f4007079dc3f3c6c27","modified":1600503735289},{"_id":"themes/spfk/source/static/api/css/share_style1_32.css","hash":"626d67a4c0bb72a152e90d25dbf281c0c35a2140","modified":1600503735289},{"_id":"themes/spfk/source/static/api/css/share_style1_24.css","hash":"3ee5f745c863b4f68299fe5dc125f913ca619c07","modified":1600503735289},{"_id":"themes/spfk/source/static/api/css/share_style2.css","hash":"1ad451187cde8a74843fd398b924ca0ac911e9be","modified":1600503735289},{"_id":"themes/spfk/source/static/api/css/share_style2_16.css","hash":"572c8e856988e463eb865f38d33ba003cc20d083","modified":1600503735289},{"_id":"themes/spfk/source/static/api/css/share_style2_24.css","hash":"917d963d3be111064cbb1d122963da91ee3724a0","modified":1600503735289},{"_id":"themes/spfk/source/static/api/css/share_style2_32.css","hash":"3657bbc4b5bbc66ebca4906ee0a1cbf9f98be883","modified":1600503735289},{"_id":"themes/spfk/source/static/api/css/share_style4.css","hash":"0a9e2ed712a5ef5c4699c038cd001a0d688a0fdf","modified":1600503735289},{"_id":"themes/spfk/source/models/haru01/exp/f02.exp.json","hash":"461fe8077a2289e309ffc7edf561501a7edcce88","modified":1511678673000},{"_id":"themes/spfk/source/static/api/js/share.js","hash":"5e71147fe4a93bc99387a5cc1c6894d8b6ab2d5e","modified":1600503735293},{"_id":"themes/spfk/source/static/api/css/slide_share.css","hash":"3898feaf45559b039f885bee8f9e831f48adb20c","modified":1600503735289},{"_id":"themes/spfk/source/models/haru01/moc/haru01.1024/texture_00.png","hash":"f3c4103630bbf0660f793f90a14b51fdb7dfb7ea","modified":1511678673000},{"_id":"themes/spfk/source/static/api/css/weixin_popup.css","hash":"5e6c5084bfd16051de5776c2e136a5462b08a32c","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/icons_1_16.png","hash":"3793c3265429ab7b830bfaf18322259cd0b4c4ef","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/icons_0_24.png","hash":"a89223f9714c8c4fa169430a327963ca6a1c9a6e","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/icons_0_32.png","hash":"c20521634fdacef39631031671528713e6ba6081","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/icons_0_16.png","hash":"0eec1e81a04664b2032bd389513349e9bd5d5b0f","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/icons_1_24.png","hash":"9f1d472095dbe138ef7aff069b1d18cae6ffa942","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/icons_2_16.png","hash":"07340442cb61aabb419dd226f4bfb206a7577f52","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/icons_2_24.png","hash":"e47fb87c533f2be89f22901f0864d9b5ef83412d","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/icons_1_32.png","hash":"09825de5f238c97e4374d545961d6e0d5bbfb3e2","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/icons_2_32.png","hash":"deba62865245a6b5aafa446787d72165c703b943","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/l0.gif","hash":"738b92632b0a9789a9eb568b8d101eb64f55f6e0","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/l1.gif","hash":"70e1932ca7a622ed3322b683eceb7a590860a55e","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/l3.gif","hash":"26c0dd37d98df63abb9d3d83e01bb47c34ee3f0f","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/l2.gif","hash":"e6a5d6104c226a686d48759e0268e09d762e242e","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/l4.gif","hash":"8a9c3cf99766d3f07a9c480cfdffdc3197b9a6b9","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/l5.gif","hash":"148706f56b8ef4fd9d8483d0ac3a6730e72fc0ad","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/l6.gif","hash":"f4b8e3188f744f13aca46b27b451d55d9e209c48","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/l7.gif","hash":"e4f7e5e56c8f4eb026b5cb0affe3bd69c31af261","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/pop_c.gif","hash":"e8b9ece6ddaa47ccb2c15f2396d1cd3020740603","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/r0.gif","hash":"882f255fbafc0136a3917c1dd40db88879c1b1c1","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/r1.gif","hash":"96064d132ee2477c0e444c2e18162f9d1dc9e9c2","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/r3.gif","hash":"ecdd21f1457be54afc96e2d005524eef93d7bf85","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/r4.gif","hash":"517435e69a2215a0f003e75a4861154ca963c30e","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/r2.gif","hash":"67c84a67be3b039892e9cb8c7c29ed29813bf60f","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/r5.gif","hash":"e61b32d1830390303927bdab21823959f8dc7023","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/r6.gif","hash":"4bc01e08ef0015fddf5b8c7257c094ec584ca3ee","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/r7.gif","hash":"3c596c924910c93cf3e37cc1b2870dbf271151e2","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/sc.png","hash":"e5a2ca56973a3d6608e7e3a48ebd9fa5ebda9991","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/r8.gif","hash":"c068ece54a72a3f2428d4f1b5ca7c176f027dd4e","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/selectshare_close.png","hash":"6f3666278268890a153c85fb9f04ac848c442561","modified":1600503735289},{"_id":"themes/spfk/source/static/api/img/share/share-search-icon.png","hash":"0629677a7eb5aa3e8bab3faa310c6d8c467a3287","modified":1600503735289},{"_id":"themes/spfk/source/static/api/js/base/class.js","hash":"ad1e5a3011e30b83ac8aaeabffc3311dcb151bf5","modified":1600503735289},{"_id":"themes/spfk/source/static/api/js/component/animate.js","hash":"00b6f74ed82e5a21a9295dd2dc963e892734b7f6","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/component/anticheat.js","hash":"ee6b11a7ed39ae67c1c2aeeef96b4a0f40f8083c","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/component/comm_tools.js","hash":"e651fbb1a85ab9c615ee833f4d042c203ef430bc","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/component/pop_base.js","hash":"eae6e120c149a21caa2883c533ccc40bc07fda51","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/component/partners.js","hash":"a4c275ffb4d3557280211e6bf0573485b397ffd8","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/component/pop_popup.js","hash":"aface5a8c3f71e9e024bf0df5b361ed8f5452f50","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/component/pop_dialog.js","hash":"4417d2fa9ad8ff6c79a2352ef07e9d10a1313ee0","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/component/qrcode.js","hash":"2e3cc4cc5545556dd97ab899ff32d3ab7ccee808","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/component/pop_popup_slide.js","hash":"1119fc14abd34ffb8e1f653cd30ca26adaafa3bf","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/conf/const.js","hash":"e2269411b129b847eca265fbc73f0d573f2474bb","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/conf/define.js","hash":"1393906ec26b7cf711c18e569a64f7d0c1951fc7","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/share/combine_api.js","hash":"c45d76df1707b4fd739dae7022dc4a015632a81a","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/share/api_base.js","hash":"cbacd664451f80955c2ff4caccd4b9110062c714","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/share/image_api.js","hash":"43a93415f2a5dd34760042c2bcd9f4692feecb5d","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/share/like_api.js","hash":"3526047b7f9f7446b883e2fa5ebcf143526449be","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/share/likeshare.js","hash":"d088ffe7b6451cedf202280d16e85f75a8c3bfd3","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/share/select_api.js","hash":"bf259a7912ee6124d741dbb5e45cab40bfa45e90","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/share/share_api.js","hash":"f7b86d0cc063f692a73a174d04e77cbe3c5facc7","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/share/slide_api.js","hash":"c317e3f7fec13d89178e475f26a689bb94e5aa76","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/start/router.js","hash":"97c195ae0d30dd8c7aac55a0555f082eeed4eee0","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/trans/trans_bdysc.js","hash":"1be632b99fdd67ba5279aa6c56db7d528fd094c3","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/trans/trans.js","hash":"2bf87aff540cba3bee6cc05a7a8e9a2bc8b5d907","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/trans/trans_bdxc.js","hash":"da78025de5717315252d2d33b4252c89b891c71c","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/trans/trans_weixin.js","hash":"e68e9bc91ee6fbcd64ac788463870f01602a8562","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/view/image_view.js","hash":"bb66297a5bd2c7dd931b9145f5d4a616876f3373","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/view/select_view.js","hash":"2611efec1d31d85609feea0c57e14d3f817a6220","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/view/like_view.js","hash":"42b51bd3ee4815b9ca8df6dacb9c81a8a34d762a","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/view/slide_view.js","hash":"973ded5cd15eb119e79ffd9326af3a44167b26bd","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/view/share_view.js","hash":"f445ce9cbbcf887da5e248b1cfadc03ab7df76d0","modified":1600503735293},{"_id":"themes/spfk/source/static/api/js/view/view_base.js","hash":"b3fd7dafde05d63af3dfe9e0a59f9367f81402c5","modified":1600503735293},{"_id":"themes/spfk/source/js/Mathjax/fonts/HTML-CSS/Tex/woff/MathJax_Math-Italic.woff","hash":"6cc213bb1e4258652cdb3508f7dcfbbc4800293f","modified":1660575121814},{"_id":"themes/spfk/source/js/Mathjax/fonts/HTML-CSS/Tex/woff/MathJax_Main-Regular.woff","hash":"2b823c581a4a2d2de4b055ad234f3235cfdaff5e","modified":1660575065794},{"_id":"themes/spfk/source/js/Mathjax/fonts/HTML-CSS/Tex/woff/MathJax_Size1-Regular.woff","hash":"6c89030b6b5fa42eaac88517c43bb24b0ccaba89","modified":1660575127382},{"_id":"themes/spfk/source/js/Mathjax/jax/output/HTML-CSS/fonts/TeX/fontdata.js","hash":"93b4c809f0a40ce806b6a1448816f5aed4d06c2c","modified":1660574960459},{"_id":"themes/spfk/source/js/TweenMax.min.js","hash":"eaa4e4a08400da3f22dedda706ba56cdce5b0b7a","modified":1600503735285},{"_id":"themes/spfk/source/js/embed.js","hash":"8d2d4a812ab639bc02fdd8749d3a39f6b9406c54","modified":1600503735285},{"_id":"themes/spfk/source/js/jquery-1.9.1.min.js","hash":"b82d238d4e31fdf618bae8ac11a6c812c03dd0d4","modified":1660569620145},{"_id":"themes/spfk/source/js/require-2.1.6.js","hash":"33bc97e78f4905e72b4c1eb2ca0a4662588443e3","modified":1660569472271},{"_id":"themes/spfk/source/pics/gc-area-4008.png","hash":"52248686d03ed8331d552bebce6d4a3fb328da20","modified":1654940424946},{"_id":"themes/spfk/source/pics/gc-yg-3223.png","hash":"a1d19b199204e9ae0194ee1c82c2ecaf630283ba","modified":1654943593714},{"_id":"themes/spfk/source/pics/harbor-02.png","hash":"4376544a6a0dae3b1c5a4c123c033ab185935f19","modified":1660376565954},{"_id":"themes/spfk/source/pics/jvm-work-4037.png","hash":"7be535d4a73d95c71e7a1d7ef8a022d00af63b29","modified":1654936866652},{"_id":"themes/spfk/source/pics/k8s-get-cs-02.png","hash":"9804b0fd18aa7b04268e41bc8ee8408e8d04bb86","modified":1660052842334},{"_id":"themes/spfk/source/pics/saw-2.png","hash":"8625f66fc0b344669e90c832147ff83c3174eff0","modified":1657810385389},{"_id":"themes/spfk/source/font-awesome/fonts/fontawesome-webfont.eot","hash":"986eed8dca049714e43eeebcb3932741a4bec76d","modified":1600503735281},{"_id":"themes/spfk/source/font-awesome/fonts/FontAwesome.otf","hash":"42c179eef588854b5ec151bcf6a3f58aa8b79b11","modified":1600503735281},{"_id":"themes/spfk/source/js/404/jquery-2.0.3.min.js","hash":"fbf9c77d0c4e3c34a485980c1e5316b6212160c8","modified":1600503735285},{"_id":"themes/spfk/source/font-awesome/fonts/fontawesome-webfont.woff2","hash":"638c652d623280a58144f93e7b552c66d1667a11","modified":1600503735281},{"_id":"themes/spfk/source/font-awesome/fonts/fontawesome-webfont.woff","hash":"4a313eb93b959cc4154c684b915b0a31ddb68d84","modified":1600503735281},{"_id":"themes/spfk/source/models/haru01/moc/haru01.1024/texture_01.png","hash":"dd05d6b7f8f0d0c167b040f41ffd7c10a3747d96","modified":1511678673000},{"_id":"themes/spfk/source/models/haru01/moc/haru01.1024/texture_02.png","hash":"6a1e0b336da79557325da9f58a69a380d67ecbb1","modified":1511678673000},{"_id":"themes/spfk/source/static/api/js/base/tangram.js","hash":"e1952e27f6dc3d6339128cec157acef8cc0a775f","modified":1600503735293},{"_id":"themes/spfk/source/js/Mathjax/jax/output/HTML-CSS/jax.js","hash":"eca392696415343a94399aa2a2286347fb95b93e","modified":1660574871719},{"_id":"themes/spfk/source/background/bg-1.jpg","hash":"f0617756387d74f99afe0087c7b93a32f3c7096b","modified":1600503735253},{"_id":"themes/spfk/source/background/bg-109.jpg","hash":"6171c1e921c8cc9bdcd7276cf7f0bee5295f4672","modified":1600503735257},{"_id":"themes/spfk/source/background/bg-11.jpg","hash":"d69a0447e91f62977b144737f08620d77037c76a","modified":1600503735257},{"_id":"themes/spfk/source/background/bg-17.jpg","hash":"6ab5e470059e8ccb0c8bc6786abfb5db7e9a1826","modified":1600503735265},{"_id":"themes/spfk/source/background/bg-20.jpg","hash":"9d428ac435198b2a0107102a2e9ae71e53afe364","modified":1600503735269},{"_id":"themes/spfk/source/background/bg-3.jpg","hash":"f1347eddd07bdae93ab6bebad8627eddc5baeb44","modified":1600503735273},{"_id":"themes/spfk/source/background/bg.jpg","hash":"f0617756387d74f99afe0087c7b93a32f3c7096b","modified":1600503735281},{"_id":"themes/spfk/source/js/L2Dwidget.0.min.js","hash":"e705419c47814ac220e63608d93db3a4a1ed71f1","modified":1661175124841},{"_id":"themes/spfk/source/js/gitment.js","hash":"3e5d69ac35261662339ef76e6c9b456ae43d8f46","modified":1661862453169},{"_id":"themes/spfk/source/pics/iptable-01-1.png","hash":"b82478aa76818d7da159b132630f73c4fc2573d1","modified":1659260274600},{"_id":"themes/spfk/source/pics/k8s-get-cs-01.png","hash":"1cf832f76b5626cb4d5f62c52558fd0b3456d187","modified":1660050130427},{"_id":"themes/spfk/source/pics/k8s-get-pend-01.png","hash":"a9be4e6246575a991835ba050ceb6114edd6ca76","modified":1660137461292},{"_id":"themes/spfk/source/pics/k8s-not-ipvs.png","hash":"7cfe905ab8560f6ec736e236b1c4c06c2d118e25","modified":1659777388005},{"_id":"themes/spfk/source/pics/sjq-3917.png","hash":"1d88aae890e7f3af115eb675b4bad6b80976192c","modified":1654943983820},{"_id":"themes/spfk/source/pics/test-2022-08-28-14-30.gif","hash":"8d3a05214fa9d851e36b2cd2cc4facfcec2bf06b","modified":1661668245724},{"_id":"themes/spfk/source/font-awesome/fonts/fontawesome-webfont.ttf","hash":"6484f1af6b485d5096b71b344e67f4164c33dd1f","modified":1600503735281},{"_id":"themes/spfk/source/background/bg-15.jpg","hash":"ce5760578eb814fe951c56200e81c6f47b6468d4","modified":1600503735261},{"_id":"themes/spfk/source/background/bg-23.jpg","hash":"050937d649be2c02ef8a66a0ffe7d320b236d1b0","modified":1600503735269},{"_id":"themes/spfk/source/background/bg-7.jpg","hash":"acbe0946a47ba16b79f062dbee14c4c9ff9a48da","modified":1600503735277},{"_id":"themes/spfk/source/img/head.png","hash":"c29a71923b064585b8b9a6f41431bedb5b8acbb1","modified":1600503735285},{"_id":"themes/spfk/source/pics/inode-3-4837.png","hash":"032190d236925cdccb3539d65ee6124d8fd11fbd","modified":1655988527188},{"_id":"themes/spfk/source/pics/jvm-area-4346.png","hash":"04e797e6ac54f27fe567d8f9f234c3cff6740326","modified":1654938062937},{"_id":"themes/spfk/source/pics/iptable-02.png","hash":"3f83ddf12d1078bbd39132370d6df20cefd91109","modified":1659259189962},{"_id":"themes/spfk/source/pics/stream-1.png","hash":"a39570b12aa9d9e2bc63afe8b5eeb327e6ba5f21","modified":1658756797314},{"_id":"themes/spfk/source/pics/test-2022-08-28-14-48.gif","hash":"3ec371029b8e0929325360d49ba6c1c23e86ef80","modified":1661669317969},{"_id":"themes/spfk/source/models/haru01/moc/haru01.moc","hash":"d2223b555b3bdbbd955301c4c5bcbe7ebe19bec1","modified":1511678673000},{"_id":"themes/spfk/source/js/Mathjax/config/TeX-AMS-MML_HTMLorMML.js","hash":"7ac29ea9cbea2f9754bd3de3310a817fccce92d7","modified":1660574832775},{"_id":"themes/spfk/source/background/bg-14.jpg","hash":"2fd6ede2bc9de2d26d910ea4e45d28b2350881eb","modified":1600503735261},{"_id":"themes/spfk/source/background/bg-9.jpg","hash":"df731da0fe0de9a05d99d017e747252c990f972d","modified":1600503735281},{"_id":"themes/spfk/source/img/favicon.ico","hash":"3c24bddde194127262767ceafe92e3f79aa0974f","modified":1654245149193},{"_id":"themes/spfk/source/pics/inode-2-4723.png","hash":"9d86f7e10ea6cd6416fc3b881c12e35ac5025a0f","modified":1655988453512},{"_id":"themes/spfk/source/pics/iptable-01.png","hash":"083c74f0c79c55a77b690bfb1ea3be38438c4fd3","modified":1659259370825},{"_id":"themes/spfk/source/pics/k8s-get-node-02.png","hash":"4d74f91e601148319fcd31761cf2590fddf98b29","modified":1660138735366},{"_id":"themes/spfk/source/pics/k8s-redis-c-set01.png","hash":"bba4acc64a62475af1fa5da80742928168fcf070","modified":1658062964575},{"_id":"themes/spfk/source/pics/k8s-redis-c-set02.png","hash":"8aeb9700c73c819bb63b38e4fe42dcac40dcc389","modified":1659255314302},{"_id":"themes/spfk/source/pics/k8s-redis-timeout.png","hash":"d33b4b22340eeb68a46a8c199c7e0f088046aa69","modified":1658410690670},{"_id":"themes/spfk/source/pics/top-4834.png","hash":"453a92ca4e31c8fe1ca7c65aeafdd2d400bb080f","modified":1655041729003},{"_id":"themes/spfk/source/background/bg-19.jpg","hash":"d77504412d28432643fc61ed9fd9f7c57096bdd9","modified":1600503735265},{"_id":"themes/spfk/source/background/bg-21.jpg","hash":"7c4c6cd5d75115093fa29bba7372fa198f04b0f1","modified":1600503735269},{"_id":"themes/spfk/source/background/bg-22.jpg","hash":"7a055391fa4188d9c22fdc1d34a10b26e2f0826d","modified":1600503735269},{"_id":"themes/spfk/source/background/bg-24.jpg","hash":"796fa5262d7714e8ce9496a2d03864429cfc5b45","modified":1600503735273},{"_id":"themes/spfk/source/background/bg-4.jpg","hash":"da47f889e02241c8b095f852fb7efd89c114599d","modified":1600503735273},{"_id":"themes/spfk/source/background/bg-6.jpg","hash":"1a4f4c8875b2c56e7992000979a7fca7856eec35","modified":1600503735277},{"_id":"themes/spfk/source/background/bg-8.jpg","hash":"dbecc189e28d00fa23e397eb512e039c2ff03c87","modified":1600503735277},{"_id":"themes/spfk/source/pics/top-M-5210.png","hash":"0bdf2ccd64eda69ad0f8bef89cfdcb8340ec5db6","modified":1655041942657},{"_id":"themes/spfk/source/font-awesome/fonts/fontawesome-webfont.svg","hash":"b06b5c8f67fd632cdc62a33b62ae4f74194131b3","modified":1600503735281},{"_id":"themes/spfk/source/background/bg-10.jpg","hash":"dfb23c1c3cf8a3dcb8dc0ea10cf06501c151a2a2","modified":1600503735257},{"_id":"themes/spfk/source/background/bg-12.jpg","hash":"2e0815591309863d8130881681cde32ec4bfebf1","modified":1600503735257},{"_id":"themes/spfk/source/background/bg-18.jpg","hash":"4d61dc41a781a9c1d37c9e5e413ac0d8a9538f6a","modified":1600503735265},{"_id":"themes/spfk/source/img/bg.jpg","hash":"1bcba3c6348e2190a42bff762800bf846cf9239c","modified":1600503735285},{"_id":"themes/spfk/source/pics/vim-4855.png","hash":"89dfb5a2f0003e9716a68deba044672655951887","modified":1655124545234},{"_id":"themes/spfk/source/background/bg-111.jpg","hash":"e1631b47fede8da6c03582ceed648668547c4f09","modified":1600503735257},{"_id":"themes/spfk/source/background/bg-13.jpg","hash":"d7237c6014e28c90f53287f48f718d0759af104b","modified":1600503735261},{"_id":"themes/spfk/source/background/bg-16.jpg","hash":"d1a34d0c4b69262169b543922e4aeb4dae997ad8","modified":1600503735261},{"_id":"themes/spfk/source/pics/inode-1-2848.png","hash":"6e4974ef9e236bbd96df92d0a8c0005b071084a6","modified":1655987347152},{"_id":"themes/spfk/source/pics/k8s-not-ipvs-02.png","hash":"d60eb85e9f7fd153ac8ca98105f67d3175568adf","modified":1659873197819},{"_id":"themes/spfk/source/pics/k8s-view-cluster.png","hash":"39a695291661a3d064fb419935e5768e9ab63223","modified":1660142052967},{"_id":"themes/spfk/source/background/bg-2.jpg","hash":"40a6db13e9c461f80e2c4efee7fb63bbd594e751","modified":1600503735269},{"_id":"themes/spfk/source/pics/k8s-more-cluster.png","hash":"2aed9c6297fe820a4d8b2c34c2ccaf65bf6b0a8a","modified":1660141935371},{"_id":"themes/spfk/source/background/bg-5.jpg","hash":"2d5da2a209732cce0abf2ca234c0bef0516b65ff","modified":1600503735277},{"_id":"themes/spfk/source/pics/k8s-get-node-01.png","hash":"e78b5d521f4dad6fd38e69cdeb5a7479abfab5bb","modified":1660054248707},{"_id":"themes/spfk/source/pics/nvidia.png","hash":"1d956fe25f8b8693f4bf855ed818abf10d51080c","modified":1657633918256},{"_id":"public/404.html","hash":"64fdb6159d76dbb9d655c84bc95d9d788227ffbe","modified":1661863298488},{"_id":"public/baidusitemap.xml","hash":"8998aaacdf1b1c20b96f92930fa11934d665a28a","modified":1662295210351},{"_id":"public/search.json","hash":"734cea58fb184aedf745b45aa9f94466d59fba64","modified":1662295210351},{"_id":"public/categories/index.html","hash":"344663e709d1bd110284887e0756d7901df0f25c","modified":1662295210351},{"_id":"public/other/index.html","hash":"61af3046b9f902e6f4ab5fa12f9451934a0bfee6","modified":1662295210351},{"_id":"public/tags/index.html","hash":"836ea81b82a90657554e20d3f1e94a46a88698fa","modified":1662295210351},{"_id":"public/lang/test/tests/index.html","hash":"9654b765cf2b7efd2dfc14fa50d6e53d8cae9418","modified":1662295210351},{"_id":"public/draft/index.html","hash":"133e2a9fbc31f7363fe91fb2fad025ba80fce3b3","modified":1662295210351},{"_id":"public/node/npm/hexo/index.html","hash":"89cfbc54146dee64e0e86e334953a554f4940b3a","modified":1662295210351},{"_id":"public/linux/shell/decompress/index.html","hash":"23fb16ac21f15614299dc0344b66114873f178ed","modified":1662295210351},{"_id":"public/linux/k8s/download/index.html","hash":"1a52f110cb827aee788c61d956f024dc6af43214","modified":1662295210351},{"_id":"public/linux/k8s/helm/index.html","hash":"2090a6b1d0b4dd87e58803631e752b435f3a98c4","modified":1662295210351},{"_id":"public/linux/k8s/kubelet/index.html","hash":"ed8c941ecda29a8ad7c82550b2cbcc0ca397ce2e","modified":1662295210351},{"_id":"public/markdown/formula/index.html","hash":"288ae23729474b684845c8a5fb3951f87e3017d6","modified":1662295210351},{"_id":"public/linux/k8s/harbor/index.html","hash":"9f63f2a8b0466c38a2fa007b125da759d9429304","modified":1662295210351},{"_id":"public/linux/k8s/kubeadm//index.html","hash":"cd1b15f8d5d253c2aeb5bafa971c2cf310be9996","modified":1662295210351},{"_id":"public/linux/k8s/flanneld/index.html","hash":"056c38029578c6f170bbfa22c8308c97dfeae33b","modified":1662295210351},{"_id":"public/linux/k8s/k8s/index.html","hash":"e3f067ab5e15d0be06675d4673a927c92cbc0b9e","modified":1662295210351},{"_id":"public/linux/shell/iptable/index.html","hash":"fa671e52648ebed3b4b7a757fe547610cdf38cf1","modified":1662295210351},{"_id":"public/linux/shell/grep/index.html","hash":"e315e35e54f8c6b6b724f36c01fa762ada3b36f0","modified":1662295210351},{"_id":"public/linux/shell/tree/index.html","hash":"6c8e7a59d2049e8dd71ca8d16dd07ca6bd33574b","modified":1662295210351},{"_id":"public/tool/maven/index.html","hash":"dc66dc518f994e51688ce6b7bcaea5efe0b73251","modified":1662295210351},{"_id":"public/linux/k8s/k8s01/index.html","hash":"2987e603ac6fb8da4ba7f2f54807caf7121451a3","modified":1662295210351},{"_id":"public/linux/k8s/traefik/index.html","hash":"98ff0a9ec729387ba6f8cadd69da45c6fd183a12","modified":1662295210351},{"_id":"public/linux/k8s/etcd/index.html","hash":"3373b3ec79787a81a0a6cdb929984fb8ecfd71ba","modified":1662295210351},{"_id":"public/linux/k8s/redis/index.html","hash":"1b17f4ffe70c3cbe08b9b7c4f2210fb4c9f15c8b","modified":1662295210351},{"_id":"public/services/database/redis/redis-cluster/index.html","hash":"bff7d40fef4994d34257a857ad7e93a0244a88e8","modified":1662295210351},{"_id":"public/services/database/mysql/my/index.html","hash":"b641951be7f1751ebafc5ee360d8b1767657229b","modified":1662295210351},{"_id":"public/services/database/mysql/install/index.html","hash":"cec2fa28b682f3275bb4525d40d4c0539d115a7f","modified":1662295210351},{"_id":"public/lang/python/pip/index.html","hash":"6c6066ff5a614ceb99ff3567e1f9dbd4c172f6cd","modified":1662295210351},{"_id":"public/services/container/tomcat/index.html","hash":"f2c52dc7225e6a2eb49d53ec28e8f69a21646c0b","modified":1662295210351},{"_id":"public/linux/debian/apt/index.html","hash":"56d117b93cea81c6eb30ba208d0c85872097b0e9","modified":1662295210351},{"_id":"public/lang/sawtl/index.html","hash":"24607f602716e40be4958db13dc082b08f16aa75","modified":1662295210351},{"_id":"public/database/mongo/index.html","hash":"01315e1be85891073809e380c899775f8fc55da9","modified":1662295210351},{"_id":"public/design-pattern/singleton/index.html","hash":"f0d50730ba0d5d7f8fea90fbaecdbe89e83224fe","modified":1662295210351},{"_id":"public/linux/k8s/docker1/index.html","hash":"522d014f124c0e2a33fe3b871484069618a482e1","modified":1662295210351},{"_id":"public/linux/shell/sed/index.html","hash":"608ce040647eac81ec8cb5e68501c10a8f617078","modified":1662295210351},{"_id":"public/linux/shell/usage_high/index.html","hash":"cc5510b1c4e376c000f9ecbecdf177e970799925","modified":1662295210351},{"_id":"public/network/network/index.html","hash":"f6bb3fdc5b057f01fc89386c10bea684ce54f263","modified":1662295210351},{"_id":"public/lang/npm/npm初始/index.html","hash":"c5a8c811b729db171b3bbd23afd423048d0cc5af","modified":1662295210351},{"_id":"public/linux/shell/vim/index.html","hash":"429916f1d8fd92da6e70b73f9fafaa978708ddcd","modified":1662295210351},{"_id":"public/linux/shell/find/index.html","hash":"8368504ed0feb87337ac8d4e19824a0fb5ebc811","modified":1662295210351},{"_id":"public/linux/shell/top/index.html","hash":"a237c4baab5cef962447d8f3ea72cd24468148fa","modified":1662295210351},{"_id":"public/lang/gc/index.html","hash":"f3f4d54ef378b78b964ede0cf12671671cdda297","modified":1662295210351},{"_id":"public/markdown/flow/index.html","hash":"3456cebaa02556d92266d1730c9dce8b79ba6db4","modified":1662295210351},{"_id":"public/services/zookeeper/选举机制/index.html","hash":"c6526a96f251ce4fe438463794adc6287b36f908","modified":1662295210351},{"_id":"public/lang/java/stream/index.html","hash":"89dd49852af69a9898218e53a42c0a9b02079255","modified":1662295210351},{"_id":"public/lang/go/index.html","hash":"285304fd129c318c3e1102fd89ed4efae324caaa","modified":1662295210351},{"_id":"public/linux/shell/ps/index.html","hash":"b8272955b33c8c04d1f0fe05b71d035bda2800f2","modified":1662295210351},{"_id":"public/markdown/mdgrammar/index.html","hash":"815b97c81353126aa5264a27899caefa6c0b7cf8","modified":1662295210351},{"_id":"public/linux/k8s/初识K8S/index.html","hash":"1e807e4a85c9ce2e814809b2710da12bde9e578c","modified":1662295210351},{"_id":"public/network/内网穿透/index.html","hash":"33cac37a8ed30ffb8db8833b3ff2a61a1d9549cc","modified":1662295210351},{"_id":"public/lang/node/hexo/评论/index.html","hash":"9fbdf1dc3f4e74faefe507793c89cb0c59552916","modified":1662295210351},{"_id":"public/network/on-line/index.html","hash":"1a972c1a5593e790a2357958980ebd372895492f","modified":1662295210351},{"_id":"public/services/elk/es-shield/index.html","hash":"02981780fe9f0013d209e8f07cb8fd22c0fbb216","modified":1662295210351},{"_id":"public/tool/git-server/index.html","hash":"0ccac2e6526103088bc544f27258648e6d0e7e29","modified":1662295210351},{"_id":"public/tool/git-pull/index.html","hash":"ad5348609bcef7b4a4586ab18f8af4e1218f5297","modified":1662295210351},{"_id":"public/other/avd/index.html","hash":"30998aad1d3bb768b5cb5963c5df77113a6d3432","modified":1662295210351},{"_id":"public/linux/k8s/compose/index.html","hash":"e8e0c5d1d3910ebe2592fbf543a00b7eaa46c7b2","modified":1662295210351},{"_id":"public/linux/k8s/docker/index.html","hash":"ba0c10e877ab827ba6beee9127bf699f6198fdfc","modified":1662295210351},{"_id":"public/linux/debian/dpkg/index.html","hash":"8765f540cd15624d9b0bcaa4cba8defe66cc48a2","modified":1662295210351},{"_id":"public/tool/redis-live/index.html","hash":"709d1a53d37f99e4703f14874052a996223cc82c","modified":1662295210351},{"_id":"public/services/elk/kibana/index.html","hash":"c4462a7b743f8a951d213429fb56c5bddf8d20df","modified":1662295210351},{"_id":"public/services/elk/logstash/index.html","hash":"2d38218d7a6976cbea40fc14f52fb0689d617cbb","modified":1662295210351},{"_id":"public/services/elk/安装ElasticSearch/index.html","hash":"775775d890043a27e073c74ed5dbb882225fb576","modified":1662295210351},{"_id":"public/lang/node/hexo/搭建hexo/index.html","hash":"bcebec40db0282024636fc5cbfa7f301b45d9d5a","modified":1662295210351},{"_id":"public/network/https自己签名/index.html","hash":"83cdc68cb195a9d8ab4f26957a357c1a15ec8f7e","modified":1662295210351},{"_id":"public/archives/index.html","hash":"32241f9b6b73f83f0029a415dc5d1e0660b28464","modified":1662295210351},{"_id":"public/archives/page/2/index.html","hash":"e6098552c14a880c0f7cb089929a8cbb5c5360c0","modified":1662295210351},{"_id":"public/archives/page/3/index.html","hash":"4721140f31eb88c8df8202c4b6703a2bfafd50df","modified":1662295210351},{"_id":"public/archives/page/4/index.html","hash":"6a4665d4fed636b338f8531d98507040f374c5ff","modified":1662295210351},{"_id":"public/archives/page/5/index.html","hash":"71391ac6b5df572dc02746f38bf1a89584e2744d","modified":1662295210351},{"_id":"public/archives/page/6/index.html","hash":"1f99d89b136baaa1902bf23fbf97dc1e286fe44d","modified":1662295210351},{"_id":"public/archives/page/7/index.html","hash":"3443c5d53a135358e2a9ccf8c6e8e8c67da6e17d","modified":1662295210351},{"_id":"public/archives/2016/index.html","hash":"7a239eab513e833f5f6d956afaf604c97b0c29d1","modified":1662295210351},{"_id":"public/archives/2016/12/index.html","hash":"e0244b60b75e9197b3115f01620808ad69c30b01","modified":1662295210351},{"_id":"public/archives/2017/index.html","hash":"0c99177be7701caa8fe408b62c9395d09af044d9","modified":1662295210351},{"_id":"public/archives/2017/page/2/index.html","hash":"b15b4646b22f63aa47e440d1b33d29c37dc27efd","modified":1662295210351},{"_id":"public/archives/2017/01/index.html","hash":"9f9b0e4d6c4a1e333de27857a019922cc76193f7","modified":1662295210351},{"_id":"public/archives/2017/02/index.html","hash":"a53ecbae958ee488b7cc0fcf82e904a490da840b","modified":1662295210351},{"_id":"public/archives/2017/08/index.html","hash":"5165fe4e9d7470e0018246a1792463e1f9e86a99","modified":1662295210351},{"_id":"public/archives/2017/10/index.html","hash":"6e9d5e6f77ec56857d381a34cdf5b906909612d3","modified":1662295210351},{"_id":"public/archives/2017/11/index.html","hash":"f765161253aba16daf67f256336366d550599b5e","modified":1662295210351},{"_id":"public/archives/2018/index.html","hash":"d38035747e073fc0d53cf0d601bc1e47699d9369","modified":1662295210351},{"_id":"public/archives/2018/09/index.html","hash":"7957b2ddd0c87c7498d6dbcee9c71e4079089519","modified":1662295210351},{"_id":"public/archives/2022/index.html","hash":"ba9d479878085fb81c0fd502ccb7988f590555a2","modified":1662295210351},{"_id":"public/archives/2022/page/2/index.html","hash":"c145ab68f257159f543cc760cbaad716d4973bed","modified":1662295210351},{"_id":"public/archives/2022/page/3/index.html","hash":"0c0812d4e4c9ac47ba96ed7b0dc6e1fa4c2d5f8e","modified":1662295210351},{"_id":"public/archives/2022/page/4/index.html","hash":"be5171588bce598eb5b19ae22904a30682f9f938","modified":1662295210351},{"_id":"public/archives/2022/page/5/index.html","hash":"5d66d88607551a966d2f931aa71f79bc1c89ddaf","modified":1662295210351},{"_id":"public/archives/2022/02/index.html","hash":"9469fa69c7b8bc58c00dbedbc28069d53979fdfb","modified":1662295210351},{"_id":"public/archives/2022/06/index.html","hash":"98db0a5b6b88fe8bd8cc9c2ea35135567d519088","modified":1662295210351},{"_id":"public/archives/2022/06/page/2/index.html","hash":"edac1166e28b69f45752f303b6202dcb662dc483","modified":1662295210351},{"_id":"public/archives/2022/07/index.html","hash":"a9a967a67ce61f53299701e9053ea7aaecc73066","modified":1662295210351},{"_id":"public/archives/2022/07/page/2/index.html","hash":"a9466aefd46e893c0f1b55fe6d00c87b5fd26c28","modified":1662295210351},{"_id":"public/archives/2022/08/index.html","hash":"2219153b589c1c4853acdad93f31d5a3b320f6b7","modified":1662295210351},{"_id":"public/archives/2022/08/page/2/index.html","hash":"a5393dd732f785b3991916fc49ce99dc7f60f8e0","modified":1662295210351},{"_id":"public/categories/draft/index.html","hash":"f6b3e4f0214a2bb32f96dd8e7bb0f60dbd0bd7d5","modified":1662295210351},{"_id":"public/categories/design-pattern/index.html","hash":"7f5056db86a7eda5cae5236c735ecc6871922c80","modified":1662295210351},{"_id":"public/categories/lang/index.html","hash":"d15c0751199e9ed96d7c2d56c1fc8acbb642ce92","modified":1662295210351},{"_id":"public/categories/markdown/index.html","hash":"702cdc507abbe1e7aa9f895c324cb4c1f55f7435","modified":1662295210351},{"_id":"public/categories/network/index.html","hash":"20e567b3f541229607620a21d62aeb0f90679c82","modified":1662295210351},{"_id":"public/categories/http协议/index.html","hash":"887720b4e8fa126ec118b5ef7c75292f9006e5d9","modified":1662295210351},{"_id":"public/categories/other/index.html","hash":"bc066a0806b96ab62568bef404358cafbca7f149","modified":1662295210351},{"_id":"public/categories/linux/index.html","hash":"65f5240cf1994228db38dd281637422ba3020b8e","modified":1662295210351},{"_id":"public/categories/linux/page/2/index.html","hash":"262e7dd92436d2642db8e7496c4545227910bf29","modified":1662295210351},{"_id":"public/categories/linux/page/3/index.html","hash":"cc31ddddddbabe3975525c1f5aa2f000a64bed17","modified":1662295210351},{"_id":"public/categories/tool/index.html","hash":"4f55c391ad40497bbf1eba0160d878f11bd3db37","modified":1662295210351},{"_id":"public/categories/nosql/index.html","hash":"77d22e8b646d34076d87646385adebd6a7e18849","modified":1662295210351},{"_id":"public/categories/lang/gc/index.html","hash":"fe5aa215c5d53bce61e5a09f13bef5e2fc596c19","modified":1662295210351},{"_id":"public/categories/lang/go/index.html","hash":"ffb6511a18fb386c816fc76e8bd812e104eab9a2","modified":1662295210351},{"_id":"public/categories/lang/java/index.html","hash":"f40ae83765911298a5b6201150032987159e9a7b","modified":1662295210351},{"_id":"public/categories/lang/python/index.html","hash":"cb109ad7e996487992487980c7cd77d664c1b95c","modified":1662295210351},{"_id":"public/categories/http协议/https/index.html","hash":"4a8dfd8840a380d5fc99a493cf302cfd4d476f1e","modified":1662295210351},{"_id":"public/categories/lang/test/index.html","hash":"73f0c0028cab9b444e04616cc00dfea572e8ae98","modified":1662295210351},{"_id":"public/categories/other/network/index.html","hash":"0f3b665b06693eb4f08a69fcf6d1b6c266756780","modified":1662295210351},{"_id":"public/categories/linux/k8s/index.html","hash":"10ed4d72645f216dbc7064566dd231f3e0a7ce97","modified":1662295210351},{"_id":"public/categories/linux/k8s/page/2/index.html","hash":"6f2bce1c31f25e750270ae844dbdc47235758e5a","modified":1662295210351},{"_id":"public/categories/linux/install/index.html","hash":"42c5b6502d9e867a5194cd59807ebc185c6b0738","modified":1662295210351},{"_id":"public/categories/nosql/redis/index.html","hash":"47403ff6a618ba47f3b2c1d5f456321baba4c5dd","modified":1662295210351},{"_id":"public/categories/linux/docker/index.html","hash":"c8409990a613dfd3bf7801cb738602c77352aa9c","modified":1662295210351},{"_id":"public/categories/linux/shell/index.html","hash":"fcd0de2be1839c90793dcc211e65ff0093e667c4","modified":1662295210351},{"_id":"public/categories/linux/shell/page/2/index.html","hash":"fc27aa0359ed9d58cf8b1360d0a0340204a75069","modified":1662295210351},{"_id":"public/categories/services/index.html","hash":"cc82a55bd629f333feaa2f827e5714434de47dea","modified":1662295210351},{"_id":"public/categories/database/index.html","hash":"fce80d5ed5b12952152f26bb4de8d6c252caf4ee","modified":1662295210351},{"_id":"public/categories/ELK/index.html","hash":"6102e304fa9ac82c8e12cde7f8c75265f1fb1f44","modified":1662295210351},{"_id":"public/categories/linux/debian/index.html","hash":"5fd08184bde157d5930a80ed3010b5f39f05a4e0","modified":1662295210351},{"_id":"public/categories/lang/npm/index.html","hash":"efd48d0eefe45cdde91abc3e384f8edbcd783505","modified":1662295210351},{"_id":"public/categories/npm/index.html","hash":"209c91506f21851a7198db9085bf01673a8062d1","modified":1662295210351},{"_id":"public/categories/hexo/index.html","hash":"0aef55baec9c7d124f26782c502c3b578d02d6c5","modified":1662295210351},{"_id":"public/categories/services/container/index.html","hash":"52820be294ec3b28552aa7513af1d4a4c73537a4","modified":1662295210351},{"_id":"public/categories/ELK/elasticsearch/index.html","hash":"f8eabbf4617a2084f7d0da31a40d53b96ff8b68a","modified":1662295210351},{"_id":"public/categories/ELK/kibana/index.html","hash":"c6b66803ca66bdd79f990b45d46bcef9ca6dc6a1","modified":1662295210351},{"_id":"public/categories/ELK/logstash/index.html","hash":"f04d0d2856ee9f3504ac0bc60883eb3254f02771","modified":1662295210351},{"_id":"public/categories/linux/debian/tools/index.html","hash":"c4f136d1b3df6634b0eb5256f42b79b0845c77c4","modified":1662295210351},{"_id":"public/categories/services/zookeeper/index.html","hash":"bbafb891bea39f3a556e4350abbb0fe480793954","modified":1662295210351},{"_id":"public/categories/linux/k8s/docker/index.html","hash":"a4071ebe66d63a0970d6600acdb4a769b350bf67","modified":1662295210351},{"_id":"public/categories/npm/hexo/index.html","hash":"6fef41b0559b76863d608f5848a076270d4c6169","modified":1662295210351},{"_id":"public/categories/linux/debian/docker/index.html","hash":"deb9a6528ea51a55f5a3725f2aaae675061961bc","modified":1662295210351},{"_id":"public/categories/services/database/index.html","hash":"33212c0e936836278c44d5fb7ae1b345045bed62","modified":1662295210351},{"_id":"public/categories/services/database/redis/index.html","hash":"5f9c840562388e5d8f857c77c58bf7dd3cec93a2","modified":1662295210351},{"_id":"public/index.html","hash":"934c185ddd85a655f43b66e644bec9f59e418bc2","modified":1662295210351},{"_id":"public/page/2/index.html","hash":"33412a3a97098ccc73f9dbc89bd612214a3e4ff9","modified":1662295210351},{"_id":"public/page/3/index.html","hash":"24518e79ac3aa0202200da4c22f411c9b6153b5c","modified":1662295210351},{"_id":"public/page/4/index.html","hash":"608e3afe3736b9e52cb4a901e170f7ba182bdac5","modified":1662295210351},{"_id":"public/page/5/index.html","hash":"7fe927aa5d06d57cdb84fc22b4aae422633873ab","modified":1662295210351},{"_id":"public/page/6/index.html","hash":"08ef5ae98b4cbee89ea001881acabe3161560274","modified":1662295210351},{"_id":"public/page/7/index.html","hash":"33b42d78e6c685d5f2fbf5bd024e5a7b216bf48d","modified":1662295210351},{"_id":"public/tags/草稿/index.html","hash":"a1f44a92e5beb7c161fd696c1abdd9483032ab08","modified":1662295210351},{"_id":"public/tags/singleton/index.html","hash":"e2f2918daf15ded8f7e3205c249ba09e648bc6ff","modified":1662295210351},{"_id":"public/tags/强弱类型/index.html","hash":"34f367c2d6100fa9f1339e2ccd95ea1e313996b3","modified":1662295210351},{"_id":"public/tags/流程图/index.html","hash":"2e75d61fff95e944b2bac46cebd21ee3324072fc","modified":1662295210351},{"_id":"public/tags/flow/index.html","hash":"635b9e0ff8a94d6e6b8be1d3759d3932e4029bde","modified":1662295210351},{"_id":"public/tags/formula/index.html","hash":"537f5ebe3a8a1ea3e0c682d6c848271de4bcfbfb","modified":1662295210351},{"_id":"public/tags/grammar/index.html","hash":"a5dc591252077404aad6bc2de7b7a8483959a3f4","modified":1662295210351},{"_id":"public/tags/tcp/index.html","hash":"93b30c959b8f54e185f5fc5571cf687ba9fecc07","modified":1662295210351},{"_id":"public/tags/http/index.html","hash":"a8f5e890181f1d41e9944ceabf0d2c6bcf3c543a","modified":1662295210351},{"_id":"public/tags/https/index.html","hash":"1b6953d787449267e94715f23b9705a2375caecd","modified":1662295210351},{"_id":"public/tags/签名/index.html","hash":"df2604c0b1398a1b64443467dce8162fef3e2e7d","modified":1662295210351},{"_id":"public/tags/online/index.html","hash":"a360e9ff0920ab98bf2b65cfc42ed32c5aadd4f0","modified":1662295210351},{"_id":"public/tags/ngrok/index.html","hash":"e38f3cb658bde045d130ca7123d96e5dd4eebe24","modified":1662295210351},{"_id":"public/tags/内网穿透/index.html","hash":"4c2fb2d93e5688907ab075b002b1d936bb0601da","modified":1662295210351},{"_id":"public/tags/android/index.html","hash":"c847bb0b8ab95de78d8b883a534c79bb3550431f","modified":1662295210351},{"_id":"public/tags/Simulator/index.html","hash":"d72ead98ce59876db69fbd845ee1cd06224590b8","modified":1662295210351},{"_id":"public/tags/git/index.html","hash":"e6dc1562927723ad700bc1afaedb20091f41f42a","modified":1662295210351},{"_id":"public/tags/maven/index.html","hash":"e360478f4b307c9405d38de6b27fada7441d7b31","modified":1662295210351},{"_id":"public/tags/mvn/index.html","hash":"7e49dd244ab2f844cb8d1e3019881061db7031c8","modified":1662295210351},{"_id":"public/tags/redis/index.html","hash":"8e811049b53a0468c116681f7c30bda3ad71f491","modified":1662295210351},{"_id":"public/tags/监控工具/index.html","hash":"3e48d02e619f95cf0fe50f08476247072a33b01c","modified":1662295210351},{"_id":"public/tags/install/index.html","hash":"1999811157c82d11cd13b68ffe6a8f0eeaffe24c","modified":1662295210351},{"_id":"public/tags/jvm/index.html","hash":"484639c70c02f0da3b1285af3b8b2f1c991e3c9b","modified":1662295210351},{"_id":"public/tags/规则/index.html","hash":"5d95e7f6f70ca8d7604827899190454551f5f1a1","modified":1662295210351},{"_id":"public/tags/语法/index.html","hash":"8ab65091c3d5d19da0e260885a0549f51542fc0e","modified":1662295210351},{"_id":"public/tags/stream/index.html","hash":"04fc102f783a35585c0cc47ebb7673ba4ca04674","modified":1662295210351},{"_id":"public/tags/pip/index.html","hash":"97347a91876b0a61409321554bc533d2c87998f8","modified":1662295210351},{"_id":"public/tags/api/index.html","hash":"7bf7f6e1a19a01a5ae98e17ff15cfc913d5ba53d","modified":1662295210351},{"_id":"public/tags/request/index.html","hash":"51aa3aa919d14c7597bdc2b183f623b1611cc47b","modified":1662295210351},{"_id":"public/tags/response/index.html","hash":"12a1db49ce5fcf7adb5ed9b5d43970c9f915c0c1","modified":1662295210351},{"_id":"public/tags/apt/index.html","hash":"5786ad8cf36b9d5be7ca66bbcff38e149c323b1d","modified":1662295210351},{"_id":"public/tags/dpkg/index.html","hash":"4e7f2c3e6923e7f8d21b21b0644a46675e64be16","modified":1662295210351},{"_id":"public/tags/docker-engine/index.html","hash":"e1934f15bd28961213be4b188823d0fc77498e5c","modified":1662295210351},{"_id":"public/tags/docker-compose/index.html","hash":"4a520c843dd2eef2f7c8abb36a846b07ff3e122f","modified":1662295210351},{"_id":"public/tags/docker/index.html","hash":"b169874f4726db7ad592c7e07c780a915c67b1d2","modified":1662295210351},{"_id":"public/tags/etcd/index.html","hash":"8432eb2a28102d8d14c5e57b971a29e1346a598f","modified":1662295210351},{"_id":"public/tags/flanneld/index.html","hash":"c392556f0305fa5b09444c0655dd5296b2d2cad3","modified":1662295210351},{"_id":"public/tags/harbor/index.html","hash":"6d43826157d09672c36deb94d486b49b1432ed5b","modified":1662295210351},{"_id":"public/tags/helm/index.html","hash":"ae45d882c180e5c40855dd4ef25fbc7390722303","modified":1662295210351},{"_id":"public/tags/kubernetes/index.html","hash":"7617e0cfaec846342ab6b6a6f45a4dc16e5375dc","modified":1662295210351},{"_id":"public/tags/kubectl/index.html","hash":"19c01f5253db65b54c2fb314fc12239e9e76f761","modified":1662295210351},{"_id":"public/tags/kubeadm/index.html","hash":"cfff291ff9a6826b758668d603e3448d2374d8e0","modified":1662295210351},{"_id":"public/tags/kubelet/index.html","hash":"c15c1355a44e350f382e6a8b853399294c29aa09","modified":1662295210351},{"_id":"public/tags/redis-cluster/index.html","hash":"348403f6b708916e6d2f6317ee4f6764411fd65a","modified":1662295210351},{"_id":"public/tags/traefik/index.html","hash":"765378e2a96e73250d581182b7d101fa8b3f4b2f","modified":1662295210351},{"_id":"public/tags/ingress/index.html","hash":"b727a96a3b9088a5968c0421a4c7681658d33203","modified":1662295210351},{"_id":"public/tags/k8s/index.html","hash":"f71a71c2e8b5903997bd3db5c32f968e114b8681","modified":1662295210351},{"_id":"public/tags/tar/index.html","hash":"688602a70c198162d3b988542c9e89adf40d5fa8","modified":1662295210351},{"_id":"public/tags/unzip/index.html","hash":"3d4c107fa9d243b741094b2366e792a42875d376","modified":1662295210351},{"_id":"public/tags/xz/index.html","hash":"a5b7be194ad6771e92d45cadb289107e8b492ce1","modified":1662295210351},{"_id":"public/tags/download/index.html","hash":"21e46792798016ca76272f2c416258f6ad7a9402","modified":1662295210351},{"_id":"public/tags/wget/index.html","hash":"c8d357e4174d1ad5c1ed0113845d4cbca229dd5a","modified":1662295210351},{"_id":"public/tags/curl/index.html","hash":"4599c9c65459a53614dd8e7696fd8c585009b0bb","modified":1662295210351},{"_id":"public/tags/find/index.html","hash":"530ba725baae23fdc00596ae0fdc426b849e6953","modified":1662295210351},{"_id":"public/tags/grep/index.html","hash":"93a5cd3234df82d9936bf5fd650ca2dbca356bd7","modified":1662295210351},{"_id":"public/tags/iptable/index.html","hash":"fcf62c337f5069740a5635e35e790996f108ab1a","modified":1662295210351},{"_id":"public/tags/shell/index.html","hash":"b60faf630c721ba80fc6858c3aed999aad4c4e61","modified":1662295210351},{"_id":"public/tags/sed/index.html","hash":"7f68ff294865b1411463a9a4252f216286133a5b","modified":1662295210351},{"_id":"public/tags/tree/index.html","hash":"3a64b8fb959988f3d360cf220c48f8c60f886641","modified":1662295210351},{"_id":"public/tags/usage-high/index.html","hash":"bbb1c1691e4ef1347fb51f4ef823524e4d5f91cc","modified":1662295210351},{"_id":"public/tags/vim/index.html","hash":"7d3340b3844638689d2f5bb007ae5896f0bcc5ee","modified":1662295210351},{"_id":"public/tags/tomcat/index.html","hash":"6580446f8e04fcb9fdd431082c0e8cf90e955c95","modified":1662295210351},{"_id":"public/tags/mongodb/index.html","hash":"afaf3eea1f094d6c1fd89a2cd15d41c6d79881ae","modified":1662295210351},{"_id":"public/tags/auth/index.html","hash":"bb02c91f8ad9e5e7e2047a03c8a87b483cf4ed50","modified":1662295210351},{"_id":"public/tags/safe/index.html","hash":"289a18346776c4d0d1aee5ddef248236919aaa10","modified":1662295210351},{"_id":"public/tags/win/index.html","hash":"0c94fb2223c48203b50a5fd9914dedb5efa0034d","modified":1662295210351},{"_id":"public/tags/log/index.html","hash":"92ce0f12e599a62c7261d3e1e2b674e1978cadd5","modified":1662295210351},{"_id":"public/tags/search/index.html","hash":"19a818f79c7d146389b4b58d8a7d6d8924f76003","modified":1662295210351},{"_id":"public/tags/服务发现/index.html","hash":"500c93a76c5816c676360aceeec29460e2936e06","modified":1662295210351},{"_id":"public/tags/选举/index.html","hash":"37056741f4c50d30f98c6f14b6f4e5ce68b50929","modified":1662295210351},{"_id":"public/tags/hexo/index.html","hash":"a752e398dc5f2383c41c5fb8c4a0a4a3901cbd96","modified":1662295210351},{"_id":"public/tags/issues/index.html","hash":"8b4e38b5958f34016ad8db1691167df4f6d06033","modified":1662295210351},{"_id":"public/tags/源/index.html","hash":"9b13a83a3efd2052482caddfe114f3fc867cb4b2","modified":1662295210351},{"_id":"public/tags/mysql/index.html","hash":"0d83195fdd7e1e054af90beec6496bcd6dc20793","modified":1662295210351},{"_id":"public/static/api/img/share/l8.gif","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1661863298488},{"_id":"public/CNAME","hash":"86ee0a2b16b71b044225c4ab51b5160e948a9230","modified":1661863298488},{"_id":"public/apple-touch-icon.png","hash":"ba4cfb985b3490efda9b77da5d972dda55ef4c95","modified":1661863298488},{"_id":"public/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1661863298488},{"_id":"public/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1661863298488},{"_id":"public/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1661863298488},{"_id":"public/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1661863298488},{"_id":"public/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1661863298488},{"_id":"public/img/coderwall.png","hash":"fa84676c4d654e040e51fd34bfcd9f9348cd5331","modified":1661863298488},{"_id":"public/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1661863298488},{"_id":"public/img/delicious.png","hash":"9553a5f5189e4a953e04a58a49dbfa74b86b73dd","modified":1661863298488},{"_id":"public/img/facebook.png","hash":"d19ad7a0903daf26817afd8753cd97e0cc714f54","modified":1661863298488},{"_id":"public/img/github.png","hash":"b84d03b32fa388dcbf149296ebd16dce6223d48d","modified":1661863298488},{"_id":"public/img/douban.png","hash":"e2ade003ffadd5826ee66ec23901c2d6e8607e4e","modified":1661863298488},{"_id":"public/img/google.png","hash":"61a21fec7346fa3400b747ac9a201cf3d5bc013d","modified":1661863298488},{"_id":"public/img/img-err.png","hash":"23a63ea26eb3c1d5e677d9883cf36cc1a1a1228b","modified":1661863298488},{"_id":"public/img/head.gif","hash":"285e9578704830b82a36b57552a88fcae5652b14","modified":1661863298488},{"_id":"public/img/img-loading.png","hash":"a9cd5cd11866824f31e3d1c5e23badfeb3f73031","modified":1661863298488},{"_id":"public/img/linkedin.png","hash":"e203138fb53c257cb214e97f4e30091b9c568d2c","modified":1661863298488},{"_id":"public/img/mail.png","hash":"fca8199cc77fdbd700a45bf56d091c82f4a67fe7","modified":1661863298488},{"_id":"public/img/pinboard.png","hash":"0891fbb6d092fa012bf936019923383d84c6aeb0","modified":1661863298488},{"_id":"public/img/instagram.png","hash":"3c148a3882a8d141d7d405be8c4815d0dcb03561","modified":1661863298488},{"_id":"public/img/pinterest.png","hash":"9c72917f8779c083157c6ce7a5d62ed4874f0630","modified":1661863298488},{"_id":"public/img/qq.png","hash":"fd741764c5528fe371f053beac99839a97900eef","modified":1661863298488},{"_id":"public/img/rss.png","hash":"430fd47340e75214c081abd05cd7410cf7c71b86","modified":1661863298488},{"_id":"public/img/scrollbar_arrow.png","hash":"d64a33c4ddfbdb89deeb6f4e3d36eb84dc4777c0","modified":1661863298488},{"_id":"public/img/stackoverflow.png","hash":"da5dfe9043055c95e479d49c78cd3b020de608f2","modified":1661863298488},{"_id":"public/img/twitter.png","hash":"14dbb8e62d056525253bc0de13acd1723da7a934","modified":1661863298488},{"_id":"public/img/wechat.png","hash":"7ca41b6e32ca4dac419225261ab4fee5a88f73a9","modified":1661863298488},{"_id":"public/img/weibo.png","hash":"280dae3fd38086158b4a1b57edb94c06b1a5014b","modified":1661863298488},{"_id":"public/img/segmentfault.png","hash":"4483ab273423deb65021111fc8ad9512b69e45b2","modified":1661863298488},{"_id":"public/img/zhihu.png","hash":"a6d6ef65e9ac82e613a311810391ebb90d9b1c1d","modified":1661863298488},{"_id":"public/pics/etcd-external.png","hash":"b1600554e7bf41465efb21210c659e14d045063e","modified":1661863298488},{"_id":"public/pics/etcd-stacked.png","hash":"8c3e90699e01ee5966b4674289ec3863439595ca","modified":1661863298488},{"_id":"public/pics/harbor-01.png","hash":"d178459bdbd85a5302e80f84e4e54a74bc819a60","modified":1661863298488},{"_id":"public/pics/iptable-01-2.png","hash":"d6564bc1af9f6e19afedc749c5de807a5a214c26","modified":1661863298488},{"_id":"public/pics/mathjax.png","hash":"3ad170ea6da6e12bee385df5a4fd91a97cd8204e","modified":1661863298488},{"_id":"public/pics/mathjax01.png","hash":"b91a4ca94fc7353c8ef12bdc5076d53e3e1acb9d","modified":1661863298488},{"_id":"public/pics/md_flow.png","hash":"2dcc57416b4e1a14a46ac34338c05aeff8d106cd","modified":1661863298488},{"_id":"public/pics/new-area-3239.png","hash":"c1cf749d4874dc94fb0948e9987d5ee97a4a9e38","modified":1661863298488},{"_id":"public/pics/tcp-4-num.jpg","hash":"ea44ab0f22c7db3e3104f8eb3f4d1133826cc9c4","modified":1661863298488},{"_id":"public/pics/tcp-3-num.jpg","hash":"7eb24a0508789b2ad1222522d1c21f42b8b636e1","modified":1661863298488},{"_id":"public/pics/stream-type2.png","hash":"75e66bcc8f0caa5ecdbafe9770b60b6d534e261d","modified":1661863298488},{"_id":"public/pics/was-1.png","hash":"915414e468c12a181789df5bd542185cb69dcfee","modified":1661863298488},{"_id":"public/fancybox/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1661863298488},{"_id":"public/pics/zk_flow_2232.png","hash":"e2e90b9520c1191482d52f15d0a696fb13bae1f3","modified":1661863298488},{"_id":"public/models/haru01/mtn/flickHead_00.mtn","hash":"66577f6dde2bec905930fba0dd5f06de939c8f1e","modified":1661863298488},{"_id":"public/models/haru01/mtn/idle_00.mtn","hash":"bbaaafe4de159dd4fb73d137d283c640d3fede53","modified":1661863298488},{"_id":"public/models/haru01/mtn/idle_01.mtn","hash":"035c196f276ed177239ea05eeaece68b0fda2935","modified":1661863298488},{"_id":"public/models/haru01/mtn/idle_02.mtn","hash":"82291b3b78339d52f559a65d02b78e0b30180503","modified":1661863298488},{"_id":"public/models/haru01/mtn/pinchOut_00.mtn","hash":"db831991287e3a4724578f068a68e48168081d5a","modified":1661863298488},{"_id":"public/models/haru01/mtn/pinchIn_00.mtn","hash":"ed792ed8226aa5a3e5bf059285b2c95855c11303","modified":1661863298488},{"_id":"public/models/haru01/mtn/tapBody_00.mtn","hash":"4041b2f1f2f4a84454180f9dab14e46d99e135c0","modified":1661863298488},{"_id":"public/models/haru01/mtn/shake_00.mtn","hash":"7e938c4abe83273766c4562a571301811dea1de6","modified":1661863298488},{"_id":"public/models/haru01/mtn/tapBody_01.mtn","hash":"91fbfe1870f7a0a5f5fdb87c213c41b2a8cb5648","modified":1661863298488},{"_id":"public/models/haru01/mtn/tapBody_02.mtn","hash":"e93a2163cbb85525338e11a520e317329b11fb65","modified":1661863298488},{"_id":"public/models/haru01/mtn/tapBody_03.mtn","hash":"fcd573576112ad5f4e4b7dc0b750de79f150f971","modified":1661863298488},{"_id":"public/models/haru01/mtn/tapBody_04.mtn","hash":"557811c5f4ddbd393542366ef95794b19fc60387","modified":1661863298488},{"_id":"public/models/haru01/mtn/tapBody_05.mtn","hash":"5f48e50e938f98636519c370745a39b921907719","modified":1661863298488},{"_id":"public/models/haru01/mtn/tapBody_07.mtn","hash":"d299747aaf27377d552ef1f8b4fce9871a65c37d","modified":1661863298488},{"_id":"public/models/haru01/mtn/tapBody_06.mtn","hash":"3d06ac66c04eb12c64d36551dd85389f0b0ee51f","modified":1661863298488},{"_id":"public/models/haru01/mtn/tapBody_08.mtn","hash":"64a03a904d701039bf81e1296ee79537c2e8800e","modified":1661863298488},{"_id":"public/models/haru01/mtn/tapBody_09.mtn","hash":"4f50c17dcf352995e51a4d462b9ca7a9e9197d5c","modified":1661863298488},{"_id":"public/static/api/img/share/icons_0_16.png","hash":"0eec1e81a04664b2032bd389513349e9bd5d5b0f","modified":1661863298488},{"_id":"public/models/haru01/moc/haru01.1024/texture_00.png","hash":"f3c4103630bbf0660f793f90a14b51fdb7dfb7ea","modified":1661863298488},{"_id":"public/static/api/img/share/icons_0_24.png","hash":"a89223f9714c8c4fa169430a327963ca6a1c9a6e","modified":1661863298488},{"_id":"public/static/api/img/share/icons_0_32.png","hash":"c20521634fdacef39631031671528713e6ba6081","modified":1661863298488},{"_id":"public/static/api/img/share/icons_1_16.png","hash":"3793c3265429ab7b830bfaf18322259cd0b4c4ef","modified":1661863298488},{"_id":"public/static/api/img/share/icons_1_24.png","hash":"9f1d472095dbe138ef7aff069b1d18cae6ffa942","modified":1661863298488},{"_id":"public/static/api/img/share/icons_1_32.png","hash":"09825de5f238c97e4374d545961d6e0d5bbfb3e2","modified":1661863298488},{"_id":"public/static/api/img/share/icons_2_16.png","hash":"07340442cb61aabb419dd226f4bfb206a7577f52","modified":1661863298488},{"_id":"public/static/api/img/share/icons_2_24.png","hash":"e47fb87c533f2be89f22901f0864d9b5ef83412d","modified":1661863298488},{"_id":"public/static/api/img/share/icons_2_32.png","hash":"deba62865245a6b5aafa446787d72165c703b943","modified":1661863298488},{"_id":"public/static/api/img/share/l0.gif","hash":"738b92632b0a9789a9eb568b8d101eb64f55f6e0","modified":1661863298488},{"_id":"public/static/api/img/share/l1.gif","hash":"70e1932ca7a622ed3322b683eceb7a590860a55e","modified":1661863298488},{"_id":"public/static/api/img/share/l3.gif","hash":"26c0dd37d98df63abb9d3d83e01bb47c34ee3f0f","modified":1661863298488},{"_id":"public/static/api/img/share/l4.gif","hash":"8a9c3cf99766d3f07a9c480cfdffdc3197b9a6b9","modified":1661863298488},{"_id":"public/static/api/img/share/l5.gif","hash":"148706f56b8ef4fd9d8483d0ac3a6730e72fc0ad","modified":1661863298488},{"_id":"public/static/api/img/share/l6.gif","hash":"f4b8e3188f744f13aca46b27b451d55d9e209c48","modified":1661863298488},{"_id":"public/static/api/img/share/l7.gif","hash":"e4f7e5e56c8f4eb026b5cb0affe3bd69c31af261","modified":1661863298488},{"_id":"public/static/api/img/share/l2.gif","hash":"e6a5d6104c226a686d48759e0268e09d762e242e","modified":1661863298488},{"_id":"public/static/api/img/share/pop_c.gif","hash":"e8b9ece6ddaa47ccb2c15f2396d1cd3020740603","modified":1661863298488},{"_id":"public/static/api/img/share/r0.gif","hash":"882f255fbafc0136a3917c1dd40db88879c1b1c1","modified":1661863298488},{"_id":"public/static/api/img/share/r1.gif","hash":"96064d132ee2477c0e444c2e18162f9d1dc9e9c2","modified":1661863298488},{"_id":"public/static/api/img/share/r2.gif","hash":"67c84a67be3b039892e9cb8c7c29ed29813bf60f","modified":1661863298488},{"_id":"public/static/api/img/share/r3.gif","hash":"ecdd21f1457be54afc96e2d005524eef93d7bf85","modified":1661863298488},{"_id":"public/static/api/img/share/r4.gif","hash":"517435e69a2215a0f003e75a4861154ca963c30e","modified":1661863298488},{"_id":"public/static/api/img/share/r5.gif","hash":"e61b32d1830390303927bdab21823959f8dc7023","modified":1661863298488},{"_id":"public/static/api/img/share/r6.gif","hash":"4bc01e08ef0015fddf5b8c7257c094ec584ca3ee","modified":1661863298488},{"_id":"public/static/api/img/share/r7.gif","hash":"3c596c924910c93cf3e37cc1b2870dbf271151e2","modified":1661863298488},{"_id":"public/static/api/img/share/sc.png","hash":"e5a2ca56973a3d6608e7e3a48ebd9fa5ebda9991","modified":1661863298488},{"_id":"public/static/api/img/share/r8.gif","hash":"c068ece54a72a3f2428d4f1b5ca7c176f027dd4e","modified":1661863298488},{"_id":"public/static/api/img/share/share-search-icon.png","hash":"0629677a7eb5aa3e8bab3faa310c6d8c467a3287","modified":1661863298488},{"_id":"public/static/api/img/share/selectshare_close.png","hash":"6f3666278268890a153c85fb9f04ac848c442561","modified":1661863298488},{"_id":"public/js/Mathjax/fonts/HTML-CSS/Tex/woff/MathJax_Main-Regular.woff","hash":"2b823c581a4a2d2de4b055ad234f3235cfdaff5e","modified":1661863298488},{"_id":"public/js/Mathjax/fonts/HTML-CSS/Tex/woff/MathJax_Math-Italic.woff","hash":"6cc213bb1e4258652cdb3508f7dcfbbc4800293f","modified":1661863298488},{"_id":"public/js/Mathjax/fonts/HTML-CSS/Tex/woff/MathJax_Size1-Regular.woff","hash":"6c89030b6b5fa42eaac88517c43bb24b0ccaba89","modified":1661863298488},{"_id":"public/pics/gc-area-4008.png","hash":"52248686d03ed8331d552bebce6d4a3fb328da20","modified":1661863298488},{"_id":"public/pics/gc-yg-3223.png","hash":"a1d19b199204e9ae0194ee1c82c2ecaf630283ba","modified":1661863298488},{"_id":"public/pics/harbor-02.png","hash":"4376544a6a0dae3b1c5a4c123c033ab185935f19","modified":1661863298488},{"_id":"public/pics/jvm-work-4037.png","hash":"7be535d4a73d95c71e7a1d7ef8a022d00af63b29","modified":1661863298488},{"_id":"public/pics/k8s-get-cs-02.png","hash":"9804b0fd18aa7b04268e41bc8ee8408e8d04bb86","modified":1661863298488},{"_id":"public/pics/saw-2.png","hash":"8625f66fc0b344669e90c832147ff83c3174eff0","modified":1661863298488},{"_id":"public/font-awesome/fonts/FontAwesome.otf","hash":"42c179eef588854b5ec151bcf6a3f58aa8b79b11","modified":1661863298488},{"_id":"public/font-awesome/fonts/fontawesome-webfont.eot","hash":"986eed8dca049714e43eeebcb3932741a4bec76d","modified":1661863298488},{"_id":"public/font-awesome/fonts/fontawesome-webfont.woff2","hash":"638c652d623280a58144f93e7b552c66d1667a11","modified":1661863298488},{"_id":"public/font-awesome/fonts/fontawesome-webfont.woff","hash":"4a313eb93b959cc4154c684b915b0a31ddb68d84","modified":1661863298488},{"_id":"public/css/loading-style.css","hash":"1f67362d809e85edc9f122db7bc3711af1ed1d8b","modified":1661863298488},{"_id":"public/css/showshare.css","hash":"3efc4afd0d136fb5dec993e9cd9ce85b9d1cf589","modified":1661863298488},{"_id":"public/fancybox/jquery.fancybox.css","hash":"b6aa6692c2e5f8bd74d96827b78570f0c5683c20","modified":1661863298488},{"_id":"public/js/TweenMax.js","hash":"0ba64564a4fde4085fa3971dd53b7d64a41751e1","modified":1661863298488},{"_id":"public/js/busuanzi.pure.mini.js","hash":"a30fcd42f277944e6524b99f2412b1f01880b813","modified":1661863298488},{"_id":"public/js/clipboard.min.js","hash":"c13b4bb8fee46447284590d2afc0efca0ea3cb7b","modified":1661863298488},{"_id":"public/js/instagram.js","hash":"f19adbcc0dac33536bc6660598059048ec901882","modified":1661863298488},{"_id":"public/js/jquery.lazyload.js","hash":"8e4ad3e17f8e82be311b6b6e87811762e2b2d764","modified":1661863298488},{"_id":"public/js/mobile.js","hash":"d3847e5bcaf39108931724ecb02770c62b10889f","modified":1661863298488},{"_id":"public/js/main.js","hash":"06547b8258c1ae76d423bc0cb22e3557d36c9da1","modified":1661863298488},{"_id":"public/js/pc.js","hash":"ab375af6e3bcd054b1e87e1a8dcd3d7d25c2db40","modified":1661863298488},{"_id":"public/js/plugins.js","hash":"c1cf96b2d852b5803228a34d99014b005623bc06","modified":1661863298488},{"_id":"public/js/snow.js","hash":"59eb010aa02886a3b34da907d9bccb606f0e81bd","modified":1661863298488},{"_id":"public/js/search.js","hash":"12d86143503b5b27ab2d6b41d899ee1cb65ab28b","modified":1661866313821},{"_id":"public/css/pace/pace-theme-flash.css","hash":"69baa198ae459372b7e08b1c31544367da76a5a6","modified":1661863298488},{"_id":"public/css/sreach/sreach.css","hash":"337cb45a14b60bb42d9bfede39068a1b9ea5206e","modified":1661863298488},{"_id":"public/fancybox/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1661863298488},{"_id":"public/fancybox/helpers/jquery.fancybox-buttons.js","hash":"dc3645529a4bf72983a39fa34c1eb9146e082019","modified":1661863298488},{"_id":"public/fancybox/helpers/jquery.fancybox-media.js","hash":"294420f9ff20f4e3584d212b0c262a00a96ecdb3","modified":1661863298488},{"_id":"public/fancybox/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1661863298488},{"_id":"public/fancybox/helpers/jquery.fancybox-thumbs.js","hash":"47da1ae5401c24b5c17cc18e2730780f5c1a7a0c","modified":1661863298488},{"_id":"public/js/404/jquery.parallaxify-0.0.2.min.js","hash":"b97e2dfcb210b76f7bdd6e1800b26128bf4fad99","modified":1661863298488},{"_id":"public/models/haru01/haru01.model.json","hash":"1f131079ff5ee6abe50d56c8332823052bd734f9","modified":1661863298488},{"_id":"public/models/haru01/haru01.physics.json","hash":"490ab4735f5cddca766344468591c0eb90cda1f7","modified":1661863298488},{"_id":"public/models/haru01/haru01.pose.json","hash":"4fb902065bd3f309fa0029fe2505424851fd489f","modified":1661863298488},{"_id":"public/models/haru01/exp/f01.exp.json","hash":"84073a497ddb6e56c6cfc244a0fb217ba473abf9","modified":1661863298488},{"_id":"public/models/haru01/exp/f02.exp.json","hash":"461fe8077a2289e309ffc7edf561501a7edcce88","modified":1661863298488},{"_id":"public/models/haru01/exp/f03.exp.json","hash":"a65382a1a8d8f7034eac2c811b9f122a8b3f1403","modified":1661863298488},{"_id":"public/models/haru01/exp/f04.exp.json","hash":"3156286d7e0281e15c637a889aa415eef3224fa7","modified":1661863298488},{"_id":"public/models/haru01/exp/f05.exp.json","hash":"1123786fb0bb9c31f7d30cf14b2299f898cdc207","modified":1661863298488},{"_id":"public/models/haru01/exp/f06.exp.json","hash":"d962889ec7c563d818ddb5ab1e58cd337b5e62db","modified":1661863298488},{"_id":"public/models/haru01/exp/f07.exp.json","hash":"d55366c9bcf382e8273cf1803f65cdb8a4a0d336","modified":1661863298488},{"_id":"public/models/haru01/exp/f08.exp.json","hash":"4a9ba4b11d9797f59c7b043d2b807ed8253f3cc4","modified":1661863298488},{"_id":"public/static/api/css/imgshare.css","hash":"c3624a2dde649ed28b2e5d1f050fd971fbaf71a0","modified":1661863298488},{"_id":"public/static/api/css/like.css","hash":"2024d58206df01b858c38f07957f928b44e14cb3","modified":1661863298488},{"_id":"public/static/api/css/select_share.css","hash":"d0259abdb410193cf761e42bffaa51e70327a0cd","modified":1661863298488},{"_id":"public/static/api/css/share_popup.css","hash":"338ba2b30ef8ce0c84cd36b37d7f8482996291dc","modified":1661863298488},{"_id":"public/static/api/css/share_style0_24.css","hash":"7d1f9f32b80f91001f4f951aa045180cde22d82e","modified":1661863298488},{"_id":"public/static/api/css/share_style0_16.css","hash":"090e77e9e6e9b8ee0d73a233cbe46499de935bdd","modified":1661863298488},{"_id":"public/static/api/css/share_style0_32.css","hash":"7c2d12ea532c8a55c102b649bb23ef5bf53b3ed3","modified":1661863298488},{"_id":"public/static/api/css/share_style1_16.css","hash":"aeb4e9fa96cfa0167481e1f4007079dc3f3c6c27","modified":1661863298488},{"_id":"public/static/api/css/share_style1_24.css","hash":"3ee5f745c863b4f68299fe5dc125f913ca619c07","modified":1661863298488},{"_id":"public/static/api/css/share_style1_32.css","hash":"626d67a4c0bb72a152e90d25dbf281c0c35a2140","modified":1661863298488},{"_id":"public/static/api/css/share_style2.css","hash":"1ad451187cde8a74843fd398b924ca0ac911e9be","modified":1661863298488},{"_id":"public/static/api/css/share_style2_16.css","hash":"572c8e856988e463eb865f38d33ba003cc20d083","modified":1661863298488},{"_id":"public/static/api/css/share_style2_24.css","hash":"917d963d3be111064cbb1d122963da91ee3724a0","modified":1661863298488},{"_id":"public/static/api/css/share_style4.css","hash":"0a9e2ed712a5ef5c4699c038cd001a0d688a0fdf","modified":1661863298488},{"_id":"public/static/api/css/slide_share.css","hash":"3898feaf45559b039f885bee8f9e831f48adb20c","modified":1661863298488},{"_id":"public/static/api/css/weixin_popup.css","hash":"5e6c5084bfd16051de5776c2e136a5462b08a32c","modified":1661863298488},{"_id":"public/static/api/css/share_style2_32.css","hash":"3657bbc4b5bbc66ebca4906ee0a1cbf9f98be883","modified":1661863298488},{"_id":"public/static/api/js/base/class.js","hash":"ad1e5a3011e30b83ac8aaeabffc3311dcb151bf5","modified":1661863298488},{"_id":"public/static/api/js/component/animate.js","hash":"00b6f74ed82e5a21a9295dd2dc963e892734b7f6","modified":1661863298488},{"_id":"public/static/api/js/component/comm_tools.js","hash":"e651fbb1a85ab9c615ee833f4d042c203ef430bc","modified":1661863298488},{"_id":"public/static/api/js/component/anticheat.js","hash":"ee6b11a7ed39ae67c1c2aeeef96b4a0f40f8083c","modified":1661863298488},{"_id":"public/static/api/js/component/pop_base.js","hash":"eae6e120c149a21caa2883c533ccc40bc07fda51","modified":1661863298488},{"_id":"public/static/api/js/component/partners.js","hash":"a4c275ffb4d3557280211e6bf0573485b397ffd8","modified":1661863298488},{"_id":"public/static/api/js/component/pop_popup.js","hash":"aface5a8c3f71e9e024bf0df5b361ed8f5452f50","modified":1661863298488},{"_id":"public/static/api/js/component/pop_dialog.js","hash":"4417d2fa9ad8ff6c79a2352ef07e9d10a1313ee0","modified":1661863298488},{"_id":"public/static/api/js/component/pop_popup_slide.js","hash":"1119fc14abd34ffb8e1f653cd30ca26adaafa3bf","modified":1661863298488},{"_id":"public/static/api/js/component/qrcode.js","hash":"2e3cc4cc5545556dd97ab899ff32d3ab7ccee808","modified":1661863298488},{"_id":"public/static/api/js/conf/const.js","hash":"e2269411b129b847eca265fbc73f0d573f2474bb","modified":1661863298488},{"_id":"public/static/api/js/conf/define.js","hash":"1393906ec26b7cf711c18e569a64f7d0c1951fc7","modified":1661863298488},{"_id":"public/static/api/js/share/combine_api.js","hash":"c45d76df1707b4fd739dae7022dc4a015632a81a","modified":1661863298488},{"_id":"public/static/api/js/share/image_api.js","hash":"43a93415f2a5dd34760042c2bcd9f4692feecb5d","modified":1661863298488},{"_id":"public/static/api/js/share/api_base.js","hash":"cbacd664451f80955c2ff4caccd4b9110062c714","modified":1661863298488},{"_id":"public/static/api/js/share/like_api.js","hash":"3526047b7f9f7446b883e2fa5ebcf143526449be","modified":1661863298488},{"_id":"public/static/api/js/share/likeshare.js","hash":"d088ffe7b6451cedf202280d16e85f75a8c3bfd3","modified":1661863298488},{"_id":"public/static/api/js/share/select_api.js","hash":"bf259a7912ee6124d741dbb5e45cab40bfa45e90","modified":1661863298488},{"_id":"public/static/api/js/share/share_api.js","hash":"f7b86d0cc063f692a73a174d04e77cbe3c5facc7","modified":1661863298488},{"_id":"public/static/api/js/share/slide_api.js","hash":"c317e3f7fec13d89178e475f26a689bb94e5aa76","modified":1661863298488},{"_id":"public/static/api/js/trans/data.js","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1661863298488},{"_id":"public/static/api/js/start/router.js","hash":"97c195ae0d30dd8c7aac55a0555f082eeed4eee0","modified":1661863298488},{"_id":"public/static/api/js/trans/logger.js","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1661863298488},{"_id":"public/static/api/js/trans/trans.js","hash":"2bf87aff540cba3bee6cc05a7a8e9a2bc8b5d907","modified":1661863298488},{"_id":"public/static/api/js/trans/trans_bdxc.js","hash":"da78025de5717315252d2d33b4252c89b891c71c","modified":1661863298488},{"_id":"public/static/api/js/trans/trans_bdysc.js","hash":"1be632b99fdd67ba5279aa6c56db7d528fd094c3","modified":1661863298488},{"_id":"public/static/api/js/trans/trans_weixin.js","hash":"e68e9bc91ee6fbcd64ac788463870f01602a8562","modified":1661863298488},{"_id":"public/static/api/js/view/like_view.js","hash":"42b51bd3ee4815b9ca8df6dacb9c81a8a34d762a","modified":1661863298488},{"_id":"public/static/api/js/view/select_view.js","hash":"2611efec1d31d85609feea0c57e14d3f817a6220","modified":1661863298488},{"_id":"public/static/api/js/view/image_view.js","hash":"bb66297a5bd2c7dd931b9145f5d4a616876f3373","modified":1661863298488},{"_id":"public/static/api/js/view/slide_view.js","hash":"973ded5cd15eb119e79ffd9326af3a44167b26bd","modified":1661863298488},{"_id":"public/static/api/js/view/view_base.js","hash":"b3fd7dafde05d63af3dfe9e0a59f9367f81402c5","modified":1661863298488},{"_id":"public/static/api/js/view/share_view.js","hash":"f445ce9cbbcf887da5e248b1cfadc03ab7df76d0","modified":1661863298488},{"_id":"public/css/style.css","hash":"fb15986ac9b0e904f6b0fa7aafee5a13c9b1a3bf","modified":1661863298488},{"_id":"public/css/animate.min.css","hash":"1c82cb6234b6d3a51c2e8c6e7d8c4eb98ecbd2a0","modified":1661863298488},{"_id":"public/css/gitment.css","hash":"5f89b47a2e4ae88e793f2f1ad641acad32025769","modified":1661863298488},{"_id":"public/fancybox/jquery.fancybox.pack.js","hash":"9e0d51ca1dbe66f6c0c7aefd552dc8122e694a6e","modified":1661863298488},{"_id":"public/fancybox/jquery.fancybox.js","hash":"a82597493d75ea989ca586e09173cff332efe41e","modified":1661863298488},{"_id":"public/js/L2Dwidget.min.js","hash":"3d2871f7e2197dec1d6cb152b18e8e51a1a5da45","modified":1661863298488},{"_id":"public/js/L2Dwidget.0.min.js","hash":"e705419c47814ac220e63608d93db3a4a1ed71f1","modified":1661863298488},{"_id":"public/js/TweenMax.min.js","hash":"eaa4e4a08400da3f22dedda706ba56cdce5b0b7a","modified":1661863298488},{"_id":"public/js/embed.js","hash":"8d2d4a812ab639bc02fdd8749d3a39f6b9406c54","modified":1661863298488},{"_id":"public/js/gitment.js","hash":"3e5d69ac35261662339ef76e6c9b456ae43d8f46","modified":1661863298488},{"_id":"public/js/pace.js","hash":"b49c10cd65d9488f7338e3c778e55ac6628650f3","modified":1661863298488},{"_id":"public/js/jquery-1.9.1.min.js","hash":"b82d238d4e31fdf618bae8ac11a6c812c03dd0d4","modified":1661863298488},{"_id":"public/js/require-2.1.6.js","hash":"33bc97e78f4905e72b4c1eb2ca0a4662588443e3","modified":1661863298488},{"_id":"public/font-awesome/css/font-awesome.css","hash":"b488600451227b445414796e9b8550e7c1bd6d29","modified":1661863298488},{"_id":"public/font-awesome/css/font-awesome.min.css","hash":"12d6861075de8e293265ff6ff03b1f3adcb44c76","modified":1661863298488},{"_id":"public/js/404/jquery-2.0.3.min.js","hash":"fbf9c77d0c4e3c34a485980c1e5316b6212160c8","modified":1661863298488},{"_id":"public/js/Mathjax/MathJax.js","hash":"9b6f31afab6fe8257dd6f6a88c9537d13bb58a13","modified":1661863298488},{"_id":"public/js/Mathjax/config/TeX-AMS-MML_HTMLorMML.js","hash":"7ac29ea9cbea2f9754bd3de3310a817fccce92d7","modified":1661863298488},{"_id":"public/static/api/js/share.js","hash":"5e71147fe4a93bc99387a5cc1c6894d8b6ab2d5e","modified":1661863298488},{"_id":"public/static/api/js/base/tangram.js","hash":"e1952e27f6dc3d6339128cec157acef8cc0a775f","modified":1661863298488},{"_id":"public/js/Mathjax/jax/output/HTML-CSS/fonts/TeX/fontdata.js","hash":"93b4c809f0a40ce806b6a1448816f5aed4d06c2c","modified":1661863298488},{"_id":"public/js/Mathjax/jax/output/HTML-CSS/jax.js","hash":"eca392696415343a94399aa2a2286347fb95b93e","modified":1661863298488},{"_id":"public/models/haru01/moc/haru01.1024/texture_02.png","hash":"6a1e0b336da79557325da9f58a69a380d67ecbb1","modified":1661863298488},{"_id":"public/models/haru01/moc/haru01.1024/texture_01.png","hash":"dd05d6b7f8f0d0c167b040f41ffd7c10a3747d96","modified":1661863298488},{"_id":"public/background/bg-109.jpg","hash":"6171c1e921c8cc9bdcd7276cf7f0bee5295f4672","modified":1661863298488},{"_id":"public/background/bg-1.jpg","hash":"f0617756387d74f99afe0087c7b93a32f3c7096b","modified":1661863298488},{"_id":"public/background/bg-11.jpg","hash":"d69a0447e91f62977b144737f08620d77037c76a","modified":1661863298488},{"_id":"public/background/bg-17.jpg","hash":"6ab5e470059e8ccb0c8bc6786abfb5db7e9a1826","modified":1661863298488},{"_id":"public/background/bg-20.jpg","hash":"9d428ac435198b2a0107102a2e9ae71e53afe364","modified":1661863298488},{"_id":"public/background/bg-3.jpg","hash":"f1347eddd07bdae93ab6bebad8627eddc5baeb44","modified":1661863298488},{"_id":"public/background/bg.jpg","hash":"f0617756387d74f99afe0087c7b93a32f3c7096b","modified":1661863298488},{"_id":"public/pics/iptable-01-1.png","hash":"b82478aa76818d7da159b132630f73c4fc2573d1","modified":1661863298488},{"_id":"public/pics/k8s-get-cs-01.png","hash":"1cf832f76b5626cb4d5f62c52558fd0b3456d187","modified":1661863298488},{"_id":"public/pics/k8s-get-pend-01.png","hash":"a9be4e6246575a991835ba050ceb6114edd6ca76","modified":1661863298488},{"_id":"public/pics/k8s-not-ipvs.png","hash":"7cfe905ab8560f6ec736e236b1c4c06c2d118e25","modified":1661863298488},{"_id":"public/pics/sjq-3917.png","hash":"1d88aae890e7f3af115eb675b4bad6b80976192c","modified":1661863298488},{"_id":"public/pics/test-2022-08-28-14-30.gif","hash":"8d3a05214fa9d851e36b2cd2cc4facfcec2bf06b","modified":1661863298488},{"_id":"public/font-awesome/fonts/fontawesome-webfont.ttf","hash":"6484f1af6b485d5096b71b344e67f4164c33dd1f","modified":1661863298488},{"_id":"public/background/bg-15.jpg","hash":"ce5760578eb814fe951c56200e81c6f47b6468d4","modified":1661863298488},{"_id":"public/background/bg-23.jpg","hash":"050937d649be2c02ef8a66a0ffe7d320b236d1b0","modified":1661863298488},{"_id":"public/background/bg-7.jpg","hash":"acbe0946a47ba16b79f062dbee14c4c9ff9a48da","modified":1661863298488},{"_id":"public/img/head.png","hash":"c29a71923b064585b8b9a6f41431bedb5b8acbb1","modified":1661863298488},{"_id":"public/pics/inode-3-4837.png","hash":"032190d236925cdccb3539d65ee6124d8fd11fbd","modified":1661863298488},{"_id":"public/pics/iptable-02.png","hash":"3f83ddf12d1078bbd39132370d6df20cefd91109","modified":1661863298488},{"_id":"public/pics/jvm-area-4346.png","hash":"04e797e6ac54f27fe567d8f9f234c3cff6740326","modified":1661863298488},{"_id":"public/pics/stream-1.png","hash":"a39570b12aa9d9e2bc63afe8b5eeb327e6ba5f21","modified":1661863298488},{"_id":"public/pics/test-2022-08-28-14-48.gif","hash":"3ec371029b8e0929325360d49ba6c1c23e86ef80","modified":1661863298488},{"_id":"public/models/haru01/moc/haru01.moc","hash":"d2223b555b3bdbbd955301c4c5bcbe7ebe19bec1","modified":1661863298488},{"_id":"public/background/bg-14.jpg","hash":"2fd6ede2bc9de2d26d910ea4e45d28b2350881eb","modified":1661863298488},{"_id":"public/background/bg-9.jpg","hash":"df731da0fe0de9a05d99d017e747252c990f972d","modified":1661863298488},{"_id":"public/img/favicon.ico","hash":"3c24bddde194127262767ceafe92e3f79aa0974f","modified":1661863298488},{"_id":"public/pics/inode-2-4723.png","hash":"9d86f7e10ea6cd6416fc3b881c12e35ac5025a0f","modified":1661863298488},{"_id":"public/pics/iptable-01.png","hash":"083c74f0c79c55a77b690bfb1ea3be38438c4fd3","modified":1661863298488},{"_id":"public/pics/k8s-get-node-02.png","hash":"4d74f91e601148319fcd31761cf2590fddf98b29","modified":1661863298488},{"_id":"public/pics/k8s-redis-c-set01.png","hash":"bba4acc64a62475af1fa5da80742928168fcf070","modified":1661863298488},{"_id":"public/pics/k8s-redis-c-set02.png","hash":"8aeb9700c73c819bb63b38e4fe42dcac40dcc389","modified":1661863298488},{"_id":"public/pics/k8s-redis-timeout.png","hash":"d33b4b22340eeb68a46a8c199c7e0f088046aa69","modified":1661863298488},{"_id":"public/pics/top-4834.png","hash":"453a92ca4e31c8fe1ca7c65aeafdd2d400bb080f","modified":1661863298488},{"_id":"public/background/bg-19.jpg","hash":"d77504412d28432643fc61ed9fd9f7c57096bdd9","modified":1661863298488},{"_id":"public/background/bg-21.jpg","hash":"7c4c6cd5d75115093fa29bba7372fa198f04b0f1","modified":1661863298488},{"_id":"public/background/bg-22.jpg","hash":"7a055391fa4188d9c22fdc1d34a10b26e2f0826d","modified":1661863298488},{"_id":"public/background/bg-24.jpg","hash":"796fa5262d7714e8ce9496a2d03864429cfc5b45","modified":1661863298488},{"_id":"public/background/bg-4.jpg","hash":"da47f889e02241c8b095f852fb7efd89c114599d","modified":1661863298488},{"_id":"public/background/bg-6.jpg","hash":"1a4f4c8875b2c56e7992000979a7fca7856eec35","modified":1661863298488},{"_id":"public/background/bg-8.jpg","hash":"dbecc189e28d00fa23e397eb512e039c2ff03c87","modified":1661863298488},{"_id":"public/pics/top-M-5210.png","hash":"0bdf2ccd64eda69ad0f8bef89cfdcb8340ec5db6","modified":1661863298488},{"_id":"public/font-awesome/fonts/fontawesome-webfont.svg","hash":"b06b5c8f67fd632cdc62a33b62ae4f74194131b3","modified":1661863298488},{"_id":"public/background/bg-10.jpg","hash":"dfb23c1c3cf8a3dcb8dc0ea10cf06501c151a2a2","modified":1661863298488},{"_id":"public/background/bg-12.jpg","hash":"2e0815591309863d8130881681cde32ec4bfebf1","modified":1661863298488},{"_id":"public/background/bg-18.jpg","hash":"4d61dc41a781a9c1d37c9e5e413ac0d8a9538f6a","modified":1661863298488},{"_id":"public/img/bg.jpg","hash":"1bcba3c6348e2190a42bff762800bf846cf9239c","modified":1661863298488},{"_id":"public/pics/vim-4855.png","hash":"89dfb5a2f0003e9716a68deba044672655951887","modified":1661863298488},{"_id":"public/background/bg-111.jpg","hash":"e1631b47fede8da6c03582ceed648668547c4f09","modified":1661863298488},{"_id":"public/background/bg-13.jpg","hash":"d7237c6014e28c90f53287f48f718d0759af104b","modified":1661863298488},{"_id":"public/background/bg-16.jpg","hash":"d1a34d0c4b69262169b543922e4aeb4dae997ad8","modified":1661863298488},{"_id":"public/pics/inode-1-2848.png","hash":"6e4974ef9e236bbd96df92d0a8c0005b071084a6","modified":1661863298488},{"_id":"public/pics/k8s-not-ipvs-02.png","hash":"d60eb85e9f7fd153ac8ca98105f67d3175568adf","modified":1661863298488},{"_id":"public/pics/k8s-view-cluster.png","hash":"39a695291661a3d064fb419935e5768e9ab63223","modified":1661863298488},{"_id":"public/background/bg-2.jpg","hash":"40a6db13e9c461f80e2c4efee7fb63bbd594e751","modified":1661863298488},{"_id":"public/pics/k8s-more-cluster.png","hash":"2aed9c6297fe820a4d8b2c34c2ccaf65bf6b0a8a","modified":1661863298488},{"_id":"public/background/bg-5.jpg","hash":"2d5da2a209732cce0abf2ca234c0bef0516b65ff","modified":1661863298488},{"_id":"public/pics/k8s-get-node-01.png","hash":"e78b5d521f4dad6fd38e69cdeb5a7479abfab5bb","modified":1661863298488},{"_id":"public/pics/nvidia.png","hash":"1d956fe25f8b8693f4bf855ed818abf10d51080c","modified":1661863298488},{"_id":"themes/spfk/source/pics/test-2022-08-31-21-02.gif","hash":"c5e8df8c0da3a3da4597f8ec5dd20aa86ba61df9","modified":1661950953521},{"_id":"source/_posts/tool/codetool/idea-jpa.md","hash":"a97f2208ee611ef90ba34d4e66517177271c9f72","modified":1662039523909},{"_id":"source/_posts/tool/codetool/sublime01.md","hash":"4103f1cd5d37d0f595e8be52d031aaa879e6fd2a","modified":1662038604117},{"_id":"source/_posts/tool/codetool/sublime02.md","hash":"689d3ebc501ff3fb9658f025a287ef265dab2503","modified":1662038125305},{"_id":"source/_posts/tool/codetool/sublime03.md","hash":"f0fb86a5c84b1b0c396bc514dc126c3700287d41","modified":1662038581989},{"_id":"source/_posts/tool/databasetool/pl-sql.md","hash":"1e3e2070d614cc821f7b1da83075c7852c418bb7","modified":1662040161485},{"_id":"themes/spfk/source/pics/11d578d1-b5cf-4f49-8623-aab65adb0837.png","hash":"633ee9064fd8e916f565de1468e9c7ca665922c0","modified":1662038865855},{"_id":"themes/spfk/source/pics/1cb72990-ff22-4fae-a1ee-3d03e9edf07c.png","hash":"22ba72e2c77e55c4628009cf22b3dd715069a153","modified":1662038865855},{"_id":"themes/spfk/source/pics/30c314a6-b022-4758-9b80-a152853dd1c5.png","hash":"7a361922b2ae50520a44ca2428838c1853f06412","modified":1662038865855},{"_id":"themes/spfk/source/pics/450575164.png","hash":"56f9ce980ea196b802f92114552e759cf9c57d53","modified":1662035421910},{"_id":"themes/spfk/source/pics/5541b376-5ba9-4fa7-bd9e-8ca929bae9e1.png","hash":"a8334f73a164f6a82044f19381b440f03cb12a06","modified":1662038865855},{"_id":"themes/spfk/source/pics/6a7e416d-f5a0-4558-8737-6a2c90ff0515.png","hash":"0dac3a8c5c9c2f26cd9459eb8c742b0eee3ed0e2","modified":1662038865855},{"_id":"themes/spfk/source/pics/6fda574f-0050-43f7-84b2-e281a0b62989.png","hash":"203d7ffeff0fa641445488b39e5b0be943908fe8","modified":1662038865855},{"_id":"themes/spfk/source/pics/d4853c95-e416-4ffe-b0c9-e8d921971a0e.png","hash":"e7a2b375e4dbe55efdc003bcff6698a1015ba277","modified":1662038865855},{"_id":"themes/spfk/source/pics/pl-sql-4659.png","hash":"7f743b1715dbe2a31b3a6442f3537ad590b41555","modified":1662040038804},{"_id":"themes/spfk/source/pics/1133594981.png","hash":"d960b3f416bf8fdd13952d1e7996230c4f26e09d","modified":1662035421910},{"_id":"source/_posts/markdown/pandoc.md","hash":"5539861d4d2611a2c1597cf4c335069808204cfc","modified":1662294548913},{"_id":"source/_posts/services/database/mysql/explain.md","hash":"46738a3bce2e03414b0b0595ef23189b2b00e171","modified":1662293216733},{"_id":"source/_posts/services/database/mysql/function.md","hash":"9aa65ca1d6f2387cbeb18f4908094f42b807e384","modified":1662215972216},{"_id":"source/_posts/services/database/mysql/my-conf.md","hash":"3fce4f36db8c2619387ae59b6c44058582137e9a","modified":1662214899205},{"_id":"source/_posts/services/database/mysql/mysql-query.md","hash":"a3f06dbed837d38ad822ec58773e41d27c3a1229","modified":1662212585259},{"_id":"themes/spfk/source/pics/cd88f35d-6766-4f73-8890-4b7fb44b3361.jpg","hash":"22919b583a621c628d7f96d2c3ab5511347bd75b","modified":1662185865847},{"_id":"themes/spfk/source/pics/1882599998.png","hash":"1e25705ea71c175f1e03d4828e025042793699c0","modified":1662216175729},{"_id":"public/services/database/mysql/explain/index.html","hash":"456cb0fa9eedef7bf32f7e86f6b80e8b2d6c04fb","modified":1662295210351},{"_id":"public/services/database/mysql/function/index.html","hash":"1f4a508eb17db6b28341cbb166ee593b676a45e4","modified":1662295210351},{"_id":"public/services/database/mysql/my-conf/index.html","hash":"d04c839df335a38d23b85dd0bb6d9ef39cdba1c3","modified":1662295210351},{"_id":"public/markdown/pandoc/index.html","hash":"5e25063b7a2fbd335bf86a65f892b94507ce7a2b","modified":1662295210351},{"_id":"public/services/database/mysql/mysql-query/index.html","hash":"0e267aa11c73b9382db91d567517016f3124a5a2","modified":1662295210351},{"_id":"public/tool/databasetool/pl-sql/index.html","hash":"69c34070b29177dc7b9d2e2c117e8cc6fe868697","modified":1662295210351},{"_id":"public/tool/codetool/idea-jpa/index.html","hash":"2375739a9204163c8a9249cef49f6e1f5307bf14","modified":1662295210351},{"_id":"public/tool/codetool/sublime03/index.html","hash":"2f8276292bd2a3a62a906bccc71e07621c0f1ae3","modified":1662295210351},{"_id":"public/tool/codetool/sublime02/index.html","hash":"c6cf4bbce32fb58a54e451f9125bdb8ff65c1044","modified":1662295210351},{"_id":"public/tool/codetool/sublime01/index.html","hash":"b5124367c83ba1e60be1a65039ffbecd7a8b7a13","modified":1662295210351},{"_id":"public/archives/page/8/index.html","hash":"c1160534f4b826acbf97325569d4b30d67044289","modified":1662295210351},{"_id":"public/archives/2022/page/6/index.html","hash":"5b8bdcf4f5db95286676de840b992dac3c7a4da0","modified":1662295210351},{"_id":"public/archives/2022/09/index.html","hash":"d3450dfd62ced6b45d923e6c624e8bad97180798","modified":1662295210351},{"_id":"public/categories/tool/idea/index.html","hash":"85378a39b76916793f1a5c3f902f466c8b3a44d0","modified":1662295210351},{"_id":"public/categories/tool/sublime/index.html","hash":"216817f5953e2406a8bbb3025540fcbe744d4dcd","modified":1662295210351},{"_id":"public/categories/tool/databasetool/index.html","hash":"891a75f4a3f39971d98d3894cce4c38321a37d41","modified":1662295210351},{"_id":"public/categories/services/database/mysql/index.html","hash":"27513df0cd6fe443d29b800b138a72d8b99d9633","modified":1662295210351},{"_id":"public/categories/markdown/pandoc/index.html","hash":"a91d019743d4e449932f9b3714a5373c05c26ae7","modified":1662295210351},{"_id":"public/categories/services/database/mysql/explain/index.html","hash":"0204cbc3778e50e67edc163c285b2579145c06ad","modified":1662295210351},{"_id":"public/page/8/index.html","hash":"db633a927df097fba2e99f1b051baad17561dd6f","modified":1662295210351},{"_id":"public/tags/jpa/index.html","hash":"48309e2e2bd6a73c23e1d699c8df32c356bbb57b","modified":1662295210351},{"_id":"public/tags/中文/index.html","hash":"95fc17700c073e775a9dfce2f29cac069db1b8eb","modified":1662295210351},{"_id":"public/tags/zh-cn/index.html","hash":"cf6c2536cb0faf4d09eca1eb7e68a4854eaff0de","modified":1662295210351},{"_id":"public/tags/linux/index.html","hash":"4026e490de36990e091ab8348dd1c92a3613d251","modified":1662295210351},{"_id":"public/tags/脚本/index.html","hash":"b0b5d5e7230e859426767e25c2ba5632945e5468","modified":1662295210351},{"_id":"public/tags/lua/index.html","hash":"8510268c3deb599170a82a4c16e7f83e3ea4b992","modified":1662295210351},{"_id":"public/tags/插件/index.html","hash":"dfa39467bea68434e84f18d32707dcccd3a150ce","modified":1662295210351},{"_id":"public/tags/设置/index.html","hash":"399b292d8d3e7d2c7ab2a7cc240c24697bd9e0df","modified":1662295210351},{"_id":"public/tags/xxx/index.html","hash":"eb928ce6e7126ad0c13499c4f3a391b0d9b150ea","modified":1662295210351},{"_id":"public/tags/PL-SQL/index.html","hash":"c8643839a256a570263d2cedfc405351983d9c29","modified":1662295210351},{"_id":"public/tags/oracle/index.html","hash":"6f830baf64d0855ddf4ea55149153f2c4db0b48e","modified":1662295210351},{"_id":"public/tags/xx/index.html","hash":"045b2b181a4b6f253e7bcc8547346c4c4b5dea37","modified":1662295210351},{"_id":"public/tags/query/index.html","hash":"1c83366085063e10f1532aa1321be7b51191e796","modified":1662295210351},{"_id":"public/tags/format/index.html","hash":"2dcc5175e8c4ae1e0535325e87ab0d95073dc6ac","modified":1662295210351},{"_id":"public/tags/md/index.html","hash":"e1881eb0b66bb706a4a926994c5ec207717163cd","modified":1662295210351},{"_id":"public/tags/html/index.html","hash":"0e8b2bd9fdc36fa1d8c862ecf2e2d3f0d9cc169a","modified":1662295210351},{"_id":"public/tags/explain执行计划/index.html","hash":"a94c7e2a051058398d006f24449b06a0d5bd896c","modified":1662295210351},{"_id":"public/tags/函数/index.html","hash":"3e03ecc1bf91d8adcbf6dd4b89e104922f81fa5f","modified":1662295210351},{"_id":"public/tags/function/index.html","hash":"b59b5e6020a50e09b2b969c815b72071ea640374","modified":1662295210351},{"_id":"public/tags/config/index.html","hash":"904923290937ac3b4261d69039bbc55435f1d918","modified":1662295210351},{"_id":"public/pics/450575164.png","hash":"56f9ce980ea196b802f92114552e759cf9c57d53","modified":1662295210351},{"_id":"public/pics/11d578d1-b5cf-4f49-8623-aab65adb0837.png","hash":"633ee9064fd8e916f565de1468e9c7ca665922c0","modified":1662295210351},{"_id":"public/pics/1cb72990-ff22-4fae-a1ee-3d03e9edf07c.png","hash":"22ba72e2c77e55c4628009cf22b3dd715069a153","modified":1662295210351},{"_id":"public/pics/6fda574f-0050-43f7-84b2-e281a0b62989.png","hash":"203d7ffeff0fa641445488b39e5b0be943908fe8","modified":1662295210351},{"_id":"public/pics/30c314a6-b022-4758-9b80-a152853dd1c5.png","hash":"7a361922b2ae50520a44ca2428838c1853f06412","modified":1662295210351},{"_id":"public/pics/6a7e416d-f5a0-4558-8737-6a2c90ff0515.png","hash":"0dac3a8c5c9c2f26cd9459eb8c742b0eee3ed0e2","modified":1662295210351},{"_id":"public/pics/5541b376-5ba9-4fa7-bd9e-8ca929bae9e1.png","hash":"a8334f73a164f6a82044f19381b440f03cb12a06","modified":1662295210351},{"_id":"public/pics/pl-sql-4659.png","hash":"7f743b1715dbe2a31b3a6442f3537ad590b41555","modified":1662295210351},{"_id":"public/pics/d4853c95-e416-4ffe-b0c9-e8d921971a0e.png","hash":"e7a2b375e4dbe55efdc003bcff6698a1015ba277","modified":1662295210351},{"_id":"public/pics/1133594981.png","hash":"d960b3f416bf8fdd13952d1e7996230c4f26e09d","modified":1662295210351},{"_id":"public/pics/cd88f35d-6766-4f73-8890-4b7fb44b3361.jpg","hash":"22919b583a621c628d7f96d2c3ab5511347bd75b","modified":1662295210351},{"_id":"public/pics/1882599998.png","hash":"1e25705ea71c175f1e03d4828e025042793699c0","modified":1662295210351},{"_id":"public/pics/test-2022-08-31-21-02.gif","hash":"c5e8df8c0da3a3da4597f8ec5dd20aa86ba61df9","modified":1662295210351}],"Category":[{"name":"draft","_id":"cl7g6gtsd0004gwi5coe6217t"},{"name":"design-pattern","_id":"cl7g6gtsi000bgwi54t3z9u8d"},{"name":"lang","_id":"cl7g6gtsk000hgwi5h2kx5b3l"},{"name":"markdown","_id":"cl7g6gtso000ngwi55o0ldhvk"},{"name":"network","_id":"cl7g6gtsw0013gwi58a55fqge"},{"name":"http协议","_id":"cl7g6gtt0001cgwi53vzvcig3"},{"name":"other","_id":"cl7g6gtt1001igwi51vluhoff"},{"name":"linux","_id":"cl7g6gtt6001rgwi53w7wdb6k"},{"name":"tool","_id":"cl7g6gtt8001xgwi54o0fb176"},{"name":"nosql","_id":"cl7g6gtte002egwi59pssf03f"},{"name":"gc","parent":"cl7g6gtsk000hgwi5h2kx5b3l","_id":"cl7g6gttf002lgwi59j2y5isv"},{"name":"go","parent":"cl7g6gtsk000hgwi5h2kx5b3l","_id":"cl7g6gtth002qgwi58w0wdhuc"},{"name":"java","parent":"cl7g6gtsk000hgwi5h2kx5b3l","_id":"cl7g6gttp002wgwi5589f3k2z"},{"name":"python","parent":"cl7g6gtsk000hgwi5h2kx5b3l","_id":"cl7g6gttr0035gwi5a75mbexo"},{"name":"https","parent":"cl7g6gtt0001cgwi53vzvcig3","_id":"cl7g6gttt003cgwi5bsbvfec9"},{"name":"test","parent":"cl7g6gtsk000hgwi5h2kx5b3l","_id":"cl7g6gttu003igwi58dbjh1z7"},{"name":"network","parent":"cl7g6gtt1001igwi51vluhoff","_id":"cl7g6gtu10045gwi5crsc35jw"},{"name":"k8s","parent":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtu4004igwi5hopi2fk2"},{"name":"install","parent":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtu5004ogwi53a2j8opk"},{"name":"redis","parent":"cl7g6gtte002egwi59pssf03f","_id":"cl7g6gtud005zgwi55gnjaj6x"},{"name":"docker","parent":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtuf0067gwi59mh6gs6u"},{"name":"shell","parent":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtuf006egwi5b3pb64tl"},{"name":"services","_id":"cl7g6gtup007vgwi545yt6fll"},{"name":"database","_id":"cl7g6gtuq0082gwi5c7wsbgq4"},{"name":"ELK","_id":"cl7g6gtur0086gwi5hn7vgiyn"},{"name":"debian","parent":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtur0089gwi578e87bx8"},{"name":"npm","parent":"cl7g6gtsk000hgwi5h2kx5b3l","_id":"cl7g6gtuv008vgwi5aenc3314"},{"name":"npm","_id":"cl7g6gtuv008xgwi5e8d6dso6"},{"name":"hexo","_id":"cl7g6gtuw0092gwi50k2679ko"},{"name":"container","parent":"cl7g6gtup007vgwi545yt6fll","_id":"cl7g6gtuz009ogwi5c21yfmk4"},{"name":"elasticsearch","parent":"cl7g6gtur0086gwi5hn7vgiyn","_id":"cl7g6gtuz009rgwi59cn2exc8"},{"name":"kibana","parent":"cl7g6gtur0086gwi5hn7vgiyn","_id":"cl7g6gtv0009vgwi5gxi96r39"},{"name":"logstash","parent":"cl7g6gtur0086gwi5hn7vgiyn","_id":"cl7g6gtv000a0gwi5ecaeg8ad"},{"name":"tools","parent":"cl7g6gtur0089gwi578e87bx8","_id":"cl7g6gtv100a5gwi59tax0ytr"},{"name":"zookeeper","parent":"cl7g6gtup007vgwi545yt6fll","_id":"cl7g6gtv200aegwi5fx0pd1gy"},{"name":"docker","parent":"cl7g6gtu4004igwi5hopi2fk2","_id":"cl7g6gtv300akgwi5c2sh24fi"},{"name":"hexo","parent":"cl7g6gtuv008xgwi5e8d6dso6","_id":"cl7g6gtv300apgwi52u9ghfcp"},{"name":"docker","parent":"cl7g6gtur0089gwi578e87bx8","_id":"cl7g6gtv400atgwi56g9k27qg"},{"name":"database","parent":"cl7g6gtup007vgwi545yt6fll","_id":"cl7g6gtv400aygwi59r1h100c"},{"name":"redis","parent":"cl7g6gtv400aygwi59r1h100c","_id":"cl7g6gtv600bfgwi57acjd5wj"},{"name":"idea","parent":"cl7g6gtt8001xgwi54o0fb176","_id":"cl7j3sxei0004lri5e0zu7ud0"},{"name":"sublime","parent":"cl7g6gtt8001xgwi54o0fb176","_id":"cl7j3sxel0008lri5ct81fzsv"},{"name":"databasetool","parent":"cl7g6gtt8001xgwi54o0fb176","_id":"cl7j3sxeq000ilri5gbiqa8jh"},{"name":"mysql","parent":"cl7g6gtv400aygwi59r1h100c","_id":"cl7lok4bv0002j3i5a32fhz28"},{"name":"mysql-query","parent":"cl7lok4bv0002j3i5a32fhz28","_id":"cl7lok4bw0004j3i5cjv7430j"},{"name":"pandoc","parent":"cl7g6gtso000ngwi55o0ldhvk","_id":"cl7m1l25k000376i58c9lhazg"},{"name":"explain","parent":"cl7lok4bv0002j3i5a32fhz28","_id":"cl7m1l25n000776i5d91qb33p"}],"Data":[],"Page":[{"layout":"false","title":"404","_content":"<html>\n<head>\n<!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset=\"utf-8\">\n<title>404页面</title>\n<style>\n*{margin:0;padding:0;outline:none;font-family:\\5FAE\\8F6F\\96C5\\9ED1,宋体;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-khtml-user-select:none;user-select:none;cursor:default;font-weight:lighter;}\n.center{margin:0 auto;}\n.whole{width:100%;height:100%;line-height:100%;position:fixed;bottom:0;left:0;z-index:-1000;overflow:hidden;}\n.whole img{width:100%;height:100%;}\n.mask{width:100%;height:100%;position:absolute;top:0;left:0;background:#000;opacity:0.6;filter:alpha(opacity=60);}\n.b{width:100%;text-align:center;height:400px;position:absolute;top:50%;margin-top:-230px}.a{width:150px;height:50px;margin-top:30px}.a a{display:block;float:left;width:150px;height:50px;background:#fff;text-align:center;line-height:50px;font-size:18px;border-radius:25px;color:#333}.a a:hover{color:#000;box-shadow:#fff 0 0 20px}\np{color:#fff;margin-top:40px;font-size:24px;}\n#num{margin:0 5px;font-weight:bold;}\n</style>\n<script type=\"text/javascript\">\n\tvar num=4;\n\tfunction redirect(){\n\t\tnum--;\n\t\tdocument.getElementById(\"num\").innerHTML=num;\n\t\tif(num<0){\n\t\t\tdocument.getElementById(\"num\").innerHTML=0;\n\t\t\tlocation.href=\"https://cheng.vercel.app\";\n\t\t\t}\n\t\t}\n\tsetInterval(\"redirect()\", 1000);\n</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->\n</head>\n\n<body onload=\"redirect();\">\n<!-- hexo-inject:begin --><!-- hexo-inject:end --><div class=\"whole\">\n\t<img src=\"http://7xowaa.com1.z0.glb.clouddn.com/back.jpg\">\n    <div class=\"mask\"></div>\n</div>\n<div class=\"b\">\n\t\t<img src=\"http://7xowaa.com1.z0.glb.clouddn.com/404.png\" class=\"center\">\n\t\t<p>\n\t\t\t暂时未能找到您查找的页面<br>\n\t\t\t可能输入的网址错误或此页面不存在<br>\n            <span id=\"num\"></span>秒后自动跳转到主页\n\t\t</p>\n\t</div><!-- hexo-inject:begin --><!-- hexo-inject:end -->\n\n</body>\n</html> ","source":"404.html","raw":"---\nlayout: false\ntitle: \"404\"\n---\n<html>\n<head>\n<!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset=\"utf-8\">\n<title>404页面</title>\n<style>\n*{margin:0;padding:0;outline:none;font-family:\\5FAE\\8F6F\\96C5\\9ED1,宋体;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-khtml-user-select:none;user-select:none;cursor:default;font-weight:lighter;}\n.center{margin:0 auto;}\n.whole{width:100%;height:100%;line-height:100%;position:fixed;bottom:0;left:0;z-index:-1000;overflow:hidden;}\n.whole img{width:100%;height:100%;}\n.mask{width:100%;height:100%;position:absolute;top:0;left:0;background:#000;opacity:0.6;filter:alpha(opacity=60);}\n.b{width:100%;text-align:center;height:400px;position:absolute;top:50%;margin-top:-230px}.a{width:150px;height:50px;margin-top:30px}.a a{display:block;float:left;width:150px;height:50px;background:#fff;text-align:center;line-height:50px;font-size:18px;border-radius:25px;color:#333}.a a:hover{color:#000;box-shadow:#fff 0 0 20px}\np{color:#fff;margin-top:40px;font-size:24px;}\n#num{margin:0 5px;font-weight:bold;}\n</style>\n<script type=\"text/javascript\">\n\tvar num=4;\n\tfunction redirect(){\n\t\tnum--;\n\t\tdocument.getElementById(\"num\").innerHTML=num;\n\t\tif(num<0){\n\t\t\tdocument.getElementById(\"num\").innerHTML=0;\n\t\t\tlocation.href=\"https://cheng.vercel.app\";\n\t\t\t}\n\t\t}\n\tsetInterval(\"redirect()\", 1000);\n</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->\n</head>\n\n<body onload=\"redirect();\">\n<!-- hexo-inject:begin --><!-- hexo-inject:end --><div class=\"whole\">\n\t<img src=\"http://7xowaa.com1.z0.glb.clouddn.com/back.jpg\">\n    <div class=\"mask\"></div>\n</div>\n<div class=\"b\">\n\t\t<img src=\"http://7xowaa.com1.z0.glb.clouddn.com/404.png\" class=\"center\">\n\t\t<p>\n\t\t\t暂时未能找到您查找的页面<br>\n\t\t\t可能输入的网址错误或此页面不存在<br>\n            <span id=\"num\"></span>秒后自动跳转到主页\n\t\t</p>\n\t</div><!-- hexo-inject:begin --><!-- hexo-inject:end -->\n\n</body>\n</html> ","date":"2022-08-21T02:28:58.590Z","updated":"2022-08-21T02:28:58.590Z","path":"404.html","comments":1,"_id":"cl7g6gts70000gwi56ljq0slq","content":"<html>\n<head>\n<!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset=\"utf-8\">\n<title>404页面</title>\n<style>\n*{margin:0;padding:0;outline:none;font-family:\\5FAE\\8F6F\\96C5\\9ED1,宋体;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-khtml-user-select:none;user-select:none;cursor:default;font-weight:lighter;}\n.center{margin:0 auto;}\n.whole{width:100%;height:100%;line-height:100%;position:fixed;bottom:0;left:0;z-index:-1000;overflow:hidden;}\n.whole img{width:100%;height:100%;}\n.mask{width:100%;height:100%;position:absolute;top:0;left:0;background:#000;opacity:0.6;filter:alpha(opacity=60);}\n.b{width:100%;text-align:center;height:400px;position:absolute;top:50%;margin-top:-230px}.a{width:150px;height:50px;margin-top:30px}.a a{display:block;float:left;width:150px;height:50px;background:#fff;text-align:center;line-height:50px;font-size:18px;border-radius:25px;color:#333}.a a:hover{color:#000;box-shadow:#fff 0 0 20px}\np{color:#fff;margin-top:40px;font-size:24px;}\n#num{margin:0 5px;font-weight:bold;}\n</style>\n<script type=\"text/javascript\">\n\tvar num=4;\n\tfunction redirect(){\n\t\tnum--;\n\t\tdocument.getElementById(\"num\").innerHTML=num;\n\t\tif(num<0){\n\t\t\tdocument.getElementById(\"num\").innerHTML=0;\n\t\t\tlocation.href=\"https://cheng.vercel.app\";\n\t\t\t}\n\t\t}\n\tsetInterval(\"redirect()\", 1000);\n</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->\n</head>\n\n<body onload=\"redirect();\">\n<!-- hexo-inject:begin --><!-- hexo-inject:end --><div class=\"whole\">\n\t<img src=\"http://7xowaa.com1.z0.glb.clouddn.com/back.jpg\">\n    <div class=\"mask\"></div>\n</div>\n<div class=\"b\">\n\t\t<img src=\"http://7xowaa.com1.z0.glb.clouddn.com/404.png\" class=\"center\">\n\t\t<p>\n\t\t\t暂时未能找到您查找的页面<br>\n\t\t\t可能输入的网址错误或此页面不存在<br>\n            <span id=\"num\"></span>秒后自动跳转到主页\n\t\t</p>\n\t</div><!-- hexo-inject:begin --><!-- hexo-inject:end -->\n\n</body>\n</html> ","site":{"data":{}},"excerpt":"","more":"<html>\n<head>\n<!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset=\"utf-8\">\n<title>404页面</title>\n<style>\n*{margin:0;padding:0;outline:none;font-family:\\5FAE\\8F6F\\96C5\\9ED1,宋体;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-khtml-user-select:none;user-select:none;cursor:default;font-weight:lighter;}\n.center{margin:0 auto;}\n.whole{width:100%;height:100%;line-height:100%;position:fixed;bottom:0;left:0;z-index:-1000;overflow:hidden;}\n.whole img{width:100%;height:100%;}\n.mask{width:100%;height:100%;position:absolute;top:0;left:0;background:#000;opacity:0.6;filter:alpha(opacity=60);}\n.b{width:100%;text-align:center;height:400px;position:absolute;top:50%;margin-top:-230px}.a{width:150px;height:50px;margin-top:30px}.a a{display:block;float:left;width:150px;height:50px;background:#fff;text-align:center;line-height:50px;font-size:18px;border-radius:25px;color:#333}.a a:hover{color:#000;box-shadow:#fff 0 0 20px}\np{color:#fff;margin-top:40px;font-size:24px;}\n#num{margin:0 5px;font-weight:bold;}\n</style>\n<script type=\"text/javascript\">\n\tvar num=4;\n\tfunction redirect(){\n\t\tnum--;\n\t\tdocument.getElementById(\"num\").innerHTML=num;\n\t\tif(num<0){\n\t\t\tdocument.getElementById(\"num\").innerHTML=0;\n\t\t\tlocation.href=\"https://cheng.vercel.app\";\n\t\t\t}\n\t\t}\n\tsetInterval(\"redirect()\", 1000);\n</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->\n</head>\n\n<body onload=\"redirect();\">\n<!-- hexo-inject:begin --><!-- hexo-inject:end --><div class=\"whole\">\n\t<img src=\"http://7xowaa.com1.z0.glb.clouddn.com/back.jpg\">\n    <div class=\"mask\"></div>\n</div>\n<div class=\"b\">\n\t\t<img src=\"http://7xowaa.com1.z0.glb.clouddn.com/404.png\" class=\"center\">\n\t\t<p>\n\t\t\t暂时未能找到您查找的页面<br>\n\t\t\t可能输入的网址错误或此页面不存在<br>\n            <span id=\"num\"></span>秒后自动跳转到主页\n\t\t</p>\n\t</div><!-- hexo-inject:begin --><!-- hexo-inject:end -->\n\n</body>\n</html> "},{"title":"categories","date":"2017-01-25T08:58:39.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2017-01-25 16:58:39\ntype: \"categories\"\n---\n","updated":"2020-09-19T08:22:15.253Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cl7g6gtsb0002gwi51iwjd0j9","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"其他","date":"2017-01-25T08:58:39.000Z","type":"other","_content":"","source":"other/index.md","raw":"---\n\ntitle: 其他\n\ndate: 2017-01-25 16:58:39\n\ntype: \"other\"\n\n---","updated":"2022-06-20T13:05:27.265Z","path":"other/index.html","comments":1,"layout":"page","_id":"cl7g6gtsf0006gwi53nfids0a","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"分类 & 标签","date":"2017-01-16T15:53:40.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: 分类 & 标签\ndate: 2017-01-16 23:53:40\ntype: \"tags\"\n---\n","updated":"2020-09-19T08:22:15.253Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cl7g6gtsg0008gwi5ascc8xah","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"草稿","date":"2022-08-21T10:48:03.000Z","_content":"\n\n\n测试搜索display:none :vs:<a id=\"sc_index\" style=\"display:none\"/>\n\n```\nlive2d-widget-model-hijiki  黑猫\n```\n\n[4.2.1](https://www.npmjs.com/package/hexo/v/4.2.1)\n\n```shell\ngrep L2Dwidget.init -rl --include=\\*.{ejs,js} /home/cs/oss/hexo/themes/spfk\n```\n\n\n\n```shell\nchrome -type=gpu-process --enable-crashp\n```\n\n\n\n```\nscp -r  ./themes   root@36.138.204.26:/opt/hexo/   #L2Dwidget;\n```\n\n> scp  -r /dir   user@ip:/dir  #复制文件夹\n\n\n\n```\nuseradd -r -m -s /bin/bash  cs\n```\n\n\n\n\n\n```\nsed -i \"/^permalink/s/$/\\//\"  `grep 'permalink:'  -rl --include=\\*.md  ./source/_posts/`\nsed -n \"/^permalink/s/\\/$//\"p  `grep 'permalink:'  -rl --include=\\*.md  ./source/_posts/`\n```\n\n\n\n\n\n```\n\n                                                                                                                          \n                                                                                                                          \n            ,---,                                                           ,---,                                         \n          ,--.' |                                                         ,--.' |                                 ,--,    \n          |  |  :                    ,---,                                |  |  :             ,--,              ,--.'|    \n          :  :  :                ,-+-. /  |  ,----._,.          .--.--.   :  :  :           ,'_ /|              |  |,     \n   ,---.  :  |  |,--.   ,---.   ,--.'|'   | /   /  ' /         /  /    '  :  |  |,--.  .--. |  | :    ,--.--.   `--'_     \n  /     \\ |  :  '   |  /     \\ |   |  ,\"' ||   :     |        |  :  /`./  |  :  '   |,'_ /| :  . |   /       \\  ,' ,'|    \n /    / ' |  |   /' : /    /  ||   | /  | ||   | .\\  .        |  :  ;_    |  |   /' :|  ' | |  . .  .--.  .-. | '  | |    \n.    ' /  '  :  | | |.    ' / ||   | |  | |.   ; ';  |         \\  \\    `. '  :  | | ||  | ' |  | |   \\__\\/: . . |  | :    \n'   ; :__ |  |  ' | :'   ;   /||   | |  |/ '   .   . |          `----.   \\|  |  ' | ::  | : ;  ; |   ,\" .--.; | '  : |__  \n'   | '.'||  :  :_:,''   |  / ||   | |--'   `---`-'| |         /  /`--'  /|  :  :_:,''  :  `--'   \\ /  /  ,.  | |  | '.'| \n|   :    :|  | ,'    |   :    ||   |/       .'__/\\_: |        '--'.     / |  | ,'    :  ,      .-./;  :   .'   \\;  :    ; \n \\   \\  / `--''       \\   \\  / '---'        |   :    :          `--'---'  `--''       `--`----'    |  ,     .-./|  ,   /  \n  `----'               `----'                \\   \\  /                                               `--`---'     ---`-'   \n                                              `--`-'                                                                      \n\n```\n\n\n\n```\n\t    L2Dwidget.init({\n\t\t\"model\": {\n\t　　　　　　　//jsonpath控制显示那个小萝莉模型，haru01/haru01  haru02/haru02  hibiki/hibiki  hijiki/hijiki\n\t\t    //jsonPath: \"https://xxxxx/assets/hijiki.model.json\",\n\t\t     jsonPath: \"<%- config.root %>models/haru01/haru01.model.json\",\n\t\t    \"scale\": 1\n\t\t},\n\t\t\"display\": {\n\t\t    \"position\": \"right\", //看板娘的表现位置\n\t\t    \"width\": 150,  //小萝莉的宽度\n\t\t    \"height\": 330, //小萝莉的高度\n\t\t    \"hOffset\": 0,\n\t\t    \"vOffset\": -20\n\t\t},\n\t\t\"mobile\": {\n\t\t    \"show\": true,\n\t\t    \"scale\": 0.5\n\t\t},\n\t\t\"react\": {\n\t\t    \"opacityDefault\": 0.7,\n\t\t    \"opacityOnHover\": 0.2\n\t\t}\n\t    }); \n```\n\n","source":"_posts/draft.md","raw":"---\ntitle: 草稿\npermalink: draft/\ntags:\n  - 草稿\ncategories:\n  - draft\ndate: 2022-08-21 18:48:03\n---\n\n\n\n测试搜索display:none :vs:<a id=\"sc_index\" style=\"display:none\"/>\n\n```\nlive2d-widget-model-hijiki  黑猫\n```\n\n[4.2.1](https://www.npmjs.com/package/hexo/v/4.2.1)\n\n```shell\ngrep L2Dwidget.init -rl --include=\\*.{ejs,js} /home/cs/oss/hexo/themes/spfk\n```\n\n\n\n```shell\nchrome -type=gpu-process --enable-crashp\n```\n\n\n\n```\nscp -r  ./themes   root@36.138.204.26:/opt/hexo/   #L2Dwidget;\n```\n\n> scp  -r /dir   user@ip:/dir  #复制文件夹\n\n\n\n```\nuseradd -r -m -s /bin/bash  cs\n```\n\n\n\n\n\n```\nsed -i \"/^permalink/s/$/\\//\"  `grep 'permalink:'  -rl --include=\\*.md  ./source/_posts/`\nsed -n \"/^permalink/s/\\/$//\"p  `grep 'permalink:'  -rl --include=\\*.md  ./source/_posts/`\n```\n\n\n\n\n\n```\n\n                                                                                                                          \n                                                                                                                          \n            ,---,                                                           ,---,                                         \n          ,--.' |                                                         ,--.' |                                 ,--,    \n          |  |  :                    ,---,                                |  |  :             ,--,              ,--.'|    \n          :  :  :                ,-+-. /  |  ,----._,.          .--.--.   :  :  :           ,'_ /|              |  |,     \n   ,---.  :  |  |,--.   ,---.   ,--.'|'   | /   /  ' /         /  /    '  :  |  |,--.  .--. |  | :    ,--.--.   `--'_     \n  /     \\ |  :  '   |  /     \\ |   |  ,\"' ||   :     |        |  :  /`./  |  :  '   |,'_ /| :  . |   /       \\  ,' ,'|    \n /    / ' |  |   /' : /    /  ||   | /  | ||   | .\\  .        |  :  ;_    |  |   /' :|  ' | |  . .  .--.  .-. | '  | |    \n.    ' /  '  :  | | |.    ' / ||   | |  | |.   ; ';  |         \\  \\    `. '  :  | | ||  | ' |  | |   \\__\\/: . . |  | :    \n'   ; :__ |  |  ' | :'   ;   /||   | |  |/ '   .   . |          `----.   \\|  |  ' | ::  | : ;  ; |   ,\" .--.; | '  : |__  \n'   | '.'||  :  :_:,''   |  / ||   | |--'   `---`-'| |         /  /`--'  /|  :  :_:,''  :  `--'   \\ /  /  ,.  | |  | '.'| \n|   :    :|  | ,'    |   :    ||   |/       .'__/\\_: |        '--'.     / |  | ,'    :  ,      .-./;  :   .'   \\;  :    ; \n \\   \\  / `--''       \\   \\  / '---'        |   :    :          `--'---'  `--''       `--`----'    |  ,     .-./|  ,   /  \n  `----'               `----'                \\   \\  /                                               `--`---'     ---`-'   \n                                              `--`-'                                                                      \n\n```\n\n\n\n```\n\t    L2Dwidget.init({\n\t\t\"model\": {\n\t　　　　　　　//jsonpath控制显示那个小萝莉模型，haru01/haru01  haru02/haru02  hibiki/hibiki  hijiki/hijiki\n\t\t    //jsonPath: \"https://xxxxx/assets/hijiki.model.json\",\n\t\t     jsonPath: \"<%- config.root %>models/haru01/haru01.model.json\",\n\t\t    \"scale\": 1\n\t\t},\n\t\t\"display\": {\n\t\t    \"position\": \"right\", //看板娘的表现位置\n\t\t    \"width\": 150,  //小萝莉的宽度\n\t\t    \"height\": 330, //小萝莉的高度\n\t\t    \"hOffset\": 0,\n\t\t    \"vOffset\": -20\n\t\t},\n\t\t\"mobile\": {\n\t\t    \"show\": true,\n\t\t    \"scale\": 0.5\n\t\t},\n\t\t\"react\": {\n\t\t    \"opacityDefault\": 0.7,\n\t\t    \"opacityOnHover\": 0.2\n\t\t}\n\t    }); \n```\n\n","slug":"draft","published":1,"updated":"2022-09-04T11:51:03.603Z","__permalink":"draft/","_id":"cl7g6gtsa0001gwi5by46dfr0","comments":1,"layout":"post","photos":[],"link":"","content":"<p>测试搜索display:none :vs:<a id=\"sc_index\" style=\"display:none\"/></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">live2d-widget-model-hijiki  黑猫</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://www.npmjs.com/package/hexo/v/4.2.1\">4.2.1</a></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep L2Dwidget.init -rl --include=\\*.&#123;ejs,js&#125; /home/cs/oss/hexo/themes/spfk</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chrome -type=gpu-process --enable-crashp</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp -r  ./themes   root@36.138.204.26:/opt/hexo/   #L2Dwidget;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>scp  -r &#x2F;dir   user@ip:&#x2F;dir  #复制文件夹</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd -r -m -s /bin/bash  cs</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i &quot;/^permalink/s/$/\\//&quot;  `grep &#x27;permalink:&#x27;  -rl --include=\\*.md  ./source/_posts/`</span><br><span class=\"line\">sed -n &quot;/^permalink/s/\\/$//&quot;p  `grep &#x27;permalink:&#x27;  -rl --include=\\*.md  ./source/_posts/`</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">                                                                                                                          </span><br><span class=\"line\">                                                                                                                          </span><br><span class=\"line\">            ,---,                                                           ,---,                                         </span><br><span class=\"line\">          ,--.&#x27; |                                                         ,--.&#x27; |                                 ,--,    </span><br><span class=\"line\">          |  |  :                    ,---,                                |  |  :             ,--,              ,--.&#x27;|    </span><br><span class=\"line\">          :  :  :                ,-+-. /  |  ,----._,.          .--.--.   :  :  :           ,&#x27;_ /|              |  |,     </span><br><span class=\"line\">   ,---.  :  |  |,--.   ,---.   ,--.&#x27;|&#x27;   | /   /  &#x27; /         /  /    &#x27;  :  |  |,--.  .--. |  | :    ,--.--.   `--&#x27;_     </span><br><span class=\"line\">  /     \\ |  :  &#x27;   |  /     \\ |   |  ,&quot;&#x27; ||   :     |        |  :  /`./  |  :  &#x27;   |,&#x27;_ /| :  . |   /       \\  ,&#x27; ,&#x27;|    </span><br><span class=\"line\"> /    / &#x27; |  |   /&#x27; : /    /  ||   | /  | ||   | .\\  .        |  :  ;_    |  |   /&#x27; :|  &#x27; | |  . .  .--.  .-. | &#x27;  | |    </span><br><span class=\"line\">.    &#x27; /  &#x27;  :  | | |.    &#x27; / ||   | |  | |.   ; &#x27;;  |         \\  \\    `. &#x27;  :  | | ||  | &#x27; |  | |   \\__\\/: . . |  | :    </span><br><span class=\"line\">&#x27;   ; :__ |  |  &#x27; | :&#x27;   ;   /||   | |  |/ &#x27;   .   . |          `----.   \\|  |  &#x27; | ::  | : ;  ; |   ,&quot; .--.; | &#x27;  : |__  </span><br><span class=\"line\">&#x27;   | &#x27;.&#x27;||  :  :_:,&#x27;&#x27;   |  / ||   | |--&#x27;   `---`-&#x27;| |         /  /`--&#x27;  /|  :  :_:,&#x27;&#x27;  :  `--&#x27;   \\ /  /  ,.  | |  | &#x27;.&#x27;| </span><br><span class=\"line\">|   :    :|  | ,&#x27;    |   :    ||   |/       .&#x27;__/\\_: |        &#x27;--&#x27;.     / |  | ,&#x27;    :  ,      .-./;  :   .&#x27;   \\;  :    ; </span><br><span class=\"line\"> \\   \\  / `--&#x27;&#x27;       \\   \\  / &#x27;---&#x27;        |   :    :          `--&#x27;---&#x27;  `--&#x27;&#x27;       `--`----&#x27;    |  ,     .-./|  ,   /  </span><br><span class=\"line\">  `----&#x27;               `----&#x27;                \\   \\  /                                               `--`---&#x27;     ---`-&#x27;   </span><br><span class=\"line\">                                              `--`-&#x27;                                                                      </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   L2Dwidget.init(&#123;</span><br><span class=\"line\">&quot;model&quot;: &#123;</span><br><span class=\"line\">\t　　　　　　　//jsonpath控制显示那个小萝莉模型，haru01/haru01  haru02/haru02  hibiki/hibiki  hijiki/hijiki</span><br><span class=\"line\">    //jsonPath: &quot;https://xxxxx/assets/hijiki.model.json&quot;,</span><br><span class=\"line\">     jsonPath: &quot;&lt;%- config.root %&gt;models/haru01/haru01.model.json&quot;,</span><br><span class=\"line\">    &quot;scale&quot;: 1</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">&quot;display&quot;: &#123;</span><br><span class=\"line\">    &quot;position&quot;: &quot;right&quot;, //看板娘的表现位置</span><br><span class=\"line\">    &quot;width&quot;: 150,  //小萝莉的宽度</span><br><span class=\"line\">    &quot;height&quot;: 330, //小萝莉的高度</span><br><span class=\"line\">    &quot;hOffset&quot;: 0,</span><br><span class=\"line\">    &quot;vOffset&quot;: -20</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">&quot;mobile&quot;: &#123;</span><br><span class=\"line\">    &quot;show&quot;: true,</span><br><span class=\"line\">    &quot;scale&quot;: 0.5</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">&quot;react&quot;: &#123;</span><br><span class=\"line\">    &quot;opacityDefault&quot;: 0.7,</span><br><span class=\"line\">    &quot;opacityOnHover&quot;: 0.2</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">   &#125;); </span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<p>测试搜索display:none :vs:<a id=\"sc_index\" style=\"display:none\"/></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">live2d-widget-model-hijiki  黑猫</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://www.npmjs.com/package/hexo/v/4.2.1\">4.2.1</a></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep L2Dwidget.init -rl --include=\\*.&#123;ejs,js&#125; /home/cs/oss/hexo/themes/spfk</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chrome -type=gpu-process --enable-crashp</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp -r  ./themes   root@36.138.204.26:/opt/hexo/   #L2Dwidget;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>scp  -r &#x2F;dir   user@ip:&#x2F;dir  #复制文件夹</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd -r -m -s /bin/bash  cs</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i &quot;/^permalink/s/$/\\//&quot;  `grep &#x27;permalink:&#x27;  -rl --include=\\*.md  ./source/_posts/`</span><br><span class=\"line\">sed -n &quot;/^permalink/s/\\/$//&quot;p  `grep &#x27;permalink:&#x27;  -rl --include=\\*.md  ./source/_posts/`</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">                                                                                                                          </span><br><span class=\"line\">                                                                                                                          </span><br><span class=\"line\">            ,---,                                                           ,---,                                         </span><br><span class=\"line\">          ,--.&#x27; |                                                         ,--.&#x27; |                                 ,--,    </span><br><span class=\"line\">          |  |  :                    ,---,                                |  |  :             ,--,              ,--.&#x27;|    </span><br><span class=\"line\">          :  :  :                ,-+-. /  |  ,----._,.          .--.--.   :  :  :           ,&#x27;_ /|              |  |,     </span><br><span class=\"line\">   ,---.  :  |  |,--.   ,---.   ,--.&#x27;|&#x27;   | /   /  &#x27; /         /  /    &#x27;  :  |  |,--.  .--. |  | :    ,--.--.   `--&#x27;_     </span><br><span class=\"line\">  /     \\ |  :  &#x27;   |  /     \\ |   |  ,&quot;&#x27; ||   :     |        |  :  /`./  |  :  &#x27;   |,&#x27;_ /| :  . |   /       \\  ,&#x27; ,&#x27;|    </span><br><span class=\"line\"> /    / &#x27; |  |   /&#x27; : /    /  ||   | /  | ||   | .\\  .        |  :  ;_    |  |   /&#x27; :|  &#x27; | |  . .  .--.  .-. | &#x27;  | |    </span><br><span class=\"line\">.    &#x27; /  &#x27;  :  | | |.    &#x27; / ||   | |  | |.   ; &#x27;;  |         \\  \\    `. &#x27;  :  | | ||  | &#x27; |  | |   \\__\\/: . . |  | :    </span><br><span class=\"line\">&#x27;   ; :__ |  |  &#x27; | :&#x27;   ;   /||   | |  |/ &#x27;   .   . |          `----.   \\|  |  &#x27; | ::  | : ;  ; |   ,&quot; .--.; | &#x27;  : |__  </span><br><span class=\"line\">&#x27;   | &#x27;.&#x27;||  :  :_:,&#x27;&#x27;   |  / ||   | |--&#x27;   `---`-&#x27;| |         /  /`--&#x27;  /|  :  :_:,&#x27;&#x27;  :  `--&#x27;   \\ /  /  ,.  | |  | &#x27;.&#x27;| </span><br><span class=\"line\">|   :    :|  | ,&#x27;    |   :    ||   |/       .&#x27;__/\\_: |        &#x27;--&#x27;.     / |  | ,&#x27;    :  ,      .-./;  :   .&#x27;   \\;  :    ; </span><br><span class=\"line\"> \\   \\  / `--&#x27;&#x27;       \\   \\  / &#x27;---&#x27;        |   :    :          `--&#x27;---&#x27;  `--&#x27;&#x27;       `--`----&#x27;    |  ,     .-./|  ,   /  </span><br><span class=\"line\">  `----&#x27;               `----&#x27;                \\   \\  /                                               `--`---&#x27;     ---`-&#x27;   </span><br><span class=\"line\">                                              `--`-&#x27;                                                                      </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   L2Dwidget.init(&#123;</span><br><span class=\"line\">&quot;model&quot;: &#123;</span><br><span class=\"line\">\t　　　　　　　//jsonpath控制显示那个小萝莉模型，haru01/haru01  haru02/haru02  hibiki/hibiki  hijiki/hijiki</span><br><span class=\"line\">    //jsonPath: &quot;https://xxxxx/assets/hijiki.model.json&quot;,</span><br><span class=\"line\">     jsonPath: &quot;&lt;%- config.root %&gt;models/haru01/haru01.model.json&quot;,</span><br><span class=\"line\">    &quot;scale&quot;: 1</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">&quot;display&quot;: &#123;</span><br><span class=\"line\">    &quot;position&quot;: &quot;right&quot;, //看板娘的表现位置</span><br><span class=\"line\">    &quot;width&quot;: 150,  //小萝莉的宽度</span><br><span class=\"line\">    &quot;height&quot;: 330, //小萝莉的高度</span><br><span class=\"line\">    &quot;hOffset&quot;: 0,</span><br><span class=\"line\">    &quot;vOffset&quot;: -20</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">&quot;mobile&quot;: &#123;</span><br><span class=\"line\">    &quot;show&quot;: true,</span><br><span class=\"line\">    &quot;scale&quot;: 0.5</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">&quot;react&quot;: &#123;</span><br><span class=\"line\">    &quot;opacityDefault&quot;: 0.7,</span><br><span class=\"line\">    &quot;opacityOnHover&quot;: 0.2</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">   &#125;); </span><br></pre></td></tr></table></figure>\n\n"},{"title":"singleton单例模式","date":"2022-07-13T13:03:13.000Z","_content":"\n\n\n## 懒汉  \n\n **第一次调用时实例化**\n\n```\npublic class LHanDanli {\n//定义一个私有类变量来存放单例，私有的目的是指外部无法直接获取这个变量，而要使用提供的公共方法来获取\nprivate static LHanDanli dl = null;\n//定义私有构造器，表示只在类内部使用，亦指单例的实例只能在单例类内部创建\nprivate LHanDanli(){}\n//定义一个公共的公开的方法来返回该类的实例，由于是懒汉式，需要在第一次使用时生成实例，所以为了线程安全，使用synchronized关键字来确保只会生成单例\npublic static synchronized LHanDanli getInstance(){\nif(dl == null){\ndl = new LHanDanli();\n}\nreturn dl;\n}\n}\n```\n## 双重判断  \n\n不用每次获取对象都加锁\nvolatile  屏蔽虚拟机代码优化(代码执行顺序)，运行效率会成问题\n\n```\npublic class SLHanDanli {\nprivate static volatile SLHanDanli dl = null;\nprivate SLHanDanli(){}\npublic static SLHanDanli getInstance(){\nif(dl == null){\n          synchronized (SLHanDanli.class) {\n       if(dl == null){\n    dl = new SLHanDanli();\n}\n}\n }\nreturn dl;\n}\n}\n`\n\n```\n\n## 饿汉   \n\n加载类内就实例化\n\n<!--more-->\n\n```\npublic class EHanDanli {\n//此处定义类变量实例并直接实例化，在类加载的时候就完成了实例化并保存在类中\nprivate static EHanDanli dl = new EHanDanli();\n//定义无参构造器，用于单例实例\nprivate EHanDanli(){}\n//定义公开方法，返回已创建的单例\npublic static EHanDanli getInstance(){\n    return dl;\n}\n}\n\n```\n会有占用空间的问题存在\n\n\n\n\n\n\n\n## 静态内部类 \n\n类加载机制   只有在调用时，才会加载实例，\n静态实例化``jvm线程安全``\n\n```\npublic class ClassInnerClassDanli {\n    public static class DanliHolder{\n        private static ClassInnerClassDanli dl = new ClassInnerClassDanli();\n    }\n    private ClassInnerClassDanli(){}\n        public static ClassInnerClassDanli getInstance(){\n                return DanliHolder.dl;\n        }\n    }\n}\n```\n","source":"_posts/design-pattern/singleton.md","raw":"---\ntitle: singleton单例模式\npermalink: design-pattern/singleton/\ntags:\n  - singleton\ncategories:\n  - design-pattern\ndate: 2022-07-13 21:03:13\n---\n\n\n\n## 懒汉  \n\n **第一次调用时实例化**\n\n```\npublic class LHanDanli {\n//定义一个私有类变量来存放单例，私有的目的是指外部无法直接获取这个变量，而要使用提供的公共方法来获取\nprivate static LHanDanli dl = null;\n//定义私有构造器，表示只在类内部使用，亦指单例的实例只能在单例类内部创建\nprivate LHanDanli(){}\n//定义一个公共的公开的方法来返回该类的实例，由于是懒汉式，需要在第一次使用时生成实例，所以为了线程安全，使用synchronized关键字来确保只会生成单例\npublic static synchronized LHanDanli getInstance(){\nif(dl == null){\ndl = new LHanDanli();\n}\nreturn dl;\n}\n}\n```\n## 双重判断  \n\n不用每次获取对象都加锁\nvolatile  屏蔽虚拟机代码优化(代码执行顺序)，运行效率会成问题\n\n```\npublic class SLHanDanli {\nprivate static volatile SLHanDanli dl = null;\nprivate SLHanDanli(){}\npublic static SLHanDanli getInstance(){\nif(dl == null){\n          synchronized (SLHanDanli.class) {\n       if(dl == null){\n    dl = new SLHanDanli();\n}\n}\n }\nreturn dl;\n}\n}\n`\n\n```\n\n## 饿汉   \n\n加载类内就实例化\n\n<!--more-->\n\n```\npublic class EHanDanli {\n//此处定义类变量实例并直接实例化，在类加载的时候就完成了实例化并保存在类中\nprivate static EHanDanli dl = new EHanDanli();\n//定义无参构造器，用于单例实例\nprivate EHanDanli(){}\n//定义公开方法，返回已创建的单例\npublic static EHanDanli getInstance(){\n    return dl;\n}\n}\n\n```\n会有占用空间的问题存在\n\n\n\n\n\n\n\n## 静态内部类 \n\n类加载机制   只有在调用时，才会加载实例，\n静态实例化``jvm线程安全``\n\n```\npublic class ClassInnerClassDanli {\n    public static class DanliHolder{\n        private static ClassInnerClassDanli dl = new ClassInnerClassDanli();\n    }\n    private ClassInnerClassDanli(){}\n        public static ClassInnerClassDanli getInstance(){\n                return DanliHolder.dl;\n        }\n    }\n}\n```\n","slug":"design-pattern/singleton","published":1,"updated":"2022-08-28T09:10:00.928Z","__permalink":"design-pattern/singleton/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtsc0003gwi5fd4722r3","content":"<h2 id=\"懒汉\"><a href=\"#懒汉\" class=\"headerlink\" title=\"懒汉\"></a>懒汉</h2><p> <strong>第一次调用时实例化</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class LHanDanli &#123;</span><br><span class=\"line\">//定义一个私有类变量来存放单例，私有的目的是指外部无法直接获取这个变量，而要使用提供的公共方法来获取</span><br><span class=\"line\">private static LHanDanli dl = null;</span><br><span class=\"line\">//定义私有构造器，表示只在类内部使用，亦指单例的实例只能在单例类内部创建</span><br><span class=\"line\">private LHanDanli()&#123;&#125;</span><br><span class=\"line\">//定义一个公共的公开的方法来返回该类的实例，由于是懒汉式，需要在第一次使用时生成实例，所以为了线程安全，使用synchronized关键字来确保只会生成单例</span><br><span class=\"line\">public static synchronized LHanDanli getInstance()&#123;</span><br><span class=\"line\">if(dl == null)&#123;</span><br><span class=\"line\">dl = new LHanDanli();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">return dl;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"双重判断\"><a href=\"#双重判断\" class=\"headerlink\" title=\"双重判断\"></a>双重判断</h2><p>不用每次获取对象都加锁<br>volatile  屏蔽虚拟机代码优化(代码执行顺序)，运行效率会成问题</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class SLHanDanli &#123;</span><br><span class=\"line\">private static volatile SLHanDanli dl = null;</span><br><span class=\"line\">private SLHanDanli()&#123;&#125;</span><br><span class=\"line\">public static SLHanDanli getInstance()&#123;</span><br><span class=\"line\">if(dl == null)&#123;</span><br><span class=\"line\">          synchronized (SLHanDanli.class) &#123;</span><br><span class=\"line\">       if(dl == null)&#123;</span><br><span class=\"line\">    dl = new SLHanDanli();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">return dl;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">`</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"饿汉\"><a href=\"#饿汉\" class=\"headerlink\" title=\"饿汉\"></a>饿汉</h2><p>加载类内就实例化</p>\n<span id=\"more\"></span>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class EHanDanli &#123;</span><br><span class=\"line\">//此处定义类变量实例并直接实例化，在类加载的时候就完成了实例化并保存在类中</span><br><span class=\"line\">private static EHanDanli dl = new EHanDanli();</span><br><span class=\"line\">//定义无参构造器，用于单例实例</span><br><span class=\"line\">private EHanDanli()&#123;&#125;</span><br><span class=\"line\">//定义公开方法，返回已创建的单例</span><br><span class=\"line\">public static EHanDanli getInstance()&#123;</span><br><span class=\"line\">    return dl;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>会有占用空间的问题存在</p>\n<h2 id=\"静态内部类\"><a href=\"#静态内部类\" class=\"headerlink\" title=\"静态内部类\"></a>静态内部类</h2><p>类加载机制   只有在调用时，才会加载实例，<br>静态实例化<code>jvm线程安全</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class ClassInnerClassDanli &#123;</span><br><span class=\"line\">    public static class DanliHolder&#123;</span><br><span class=\"line\">        private static ClassInnerClassDanli dl = new ClassInnerClassDanli();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    private ClassInnerClassDanli()&#123;&#125;</span><br><span class=\"line\">        public static ClassInnerClassDanli getInstance()&#123;</span><br><span class=\"line\">                return DanliHolder.dl;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<h2 id=\"懒汉\"><a href=\"#懒汉\" class=\"headerlink\" title=\"懒汉\"></a>懒汉</h2><p> <strong>第一次调用时实例化</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class LHanDanli &#123;</span><br><span class=\"line\">//定义一个私有类变量来存放单例，私有的目的是指外部无法直接获取这个变量，而要使用提供的公共方法来获取</span><br><span class=\"line\">private static LHanDanli dl = null;</span><br><span class=\"line\">//定义私有构造器，表示只在类内部使用，亦指单例的实例只能在单例类内部创建</span><br><span class=\"line\">private LHanDanli()&#123;&#125;</span><br><span class=\"line\">//定义一个公共的公开的方法来返回该类的实例，由于是懒汉式，需要在第一次使用时生成实例，所以为了线程安全，使用synchronized关键字来确保只会生成单例</span><br><span class=\"line\">public static synchronized LHanDanli getInstance()&#123;</span><br><span class=\"line\">if(dl == null)&#123;</span><br><span class=\"line\">dl = new LHanDanli();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">return dl;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"双重判断\"><a href=\"#双重判断\" class=\"headerlink\" title=\"双重判断\"></a>双重判断</h2><p>不用每次获取对象都加锁<br>volatile  屏蔽虚拟机代码优化(代码执行顺序)，运行效率会成问题</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class SLHanDanli &#123;</span><br><span class=\"line\">private static volatile SLHanDanli dl = null;</span><br><span class=\"line\">private SLHanDanli()&#123;&#125;</span><br><span class=\"line\">public static SLHanDanli getInstance()&#123;</span><br><span class=\"line\">if(dl == null)&#123;</span><br><span class=\"line\">          synchronized (SLHanDanli.class) &#123;</span><br><span class=\"line\">       if(dl == null)&#123;</span><br><span class=\"line\">    dl = new SLHanDanli();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">return dl;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">`</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"饿汉\"><a href=\"#饿汉\" class=\"headerlink\" title=\"饿汉\"></a>饿汉</h2><p>加载类内就实例化</p>","more":"<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class EHanDanli &#123;</span><br><span class=\"line\">//此处定义类变量实例并直接实例化，在类加载的时候就完成了实例化并保存在类中</span><br><span class=\"line\">private static EHanDanli dl = new EHanDanli();</span><br><span class=\"line\">//定义无参构造器，用于单例实例</span><br><span class=\"line\">private EHanDanli()&#123;&#125;</span><br><span class=\"line\">//定义公开方法，返回已创建的单例</span><br><span class=\"line\">public static EHanDanli getInstance()&#123;</span><br><span class=\"line\">    return dl;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>会有占用空间的问题存在</p>\n<h2 id=\"静态内部类\"><a href=\"#静态内部类\" class=\"headerlink\" title=\"静态内部类\"></a>静态内部类</h2><p>类加载机制   只有在调用时，才会加载实例，<br>静态实例化<code>jvm线程安全</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class ClassInnerClassDanli &#123;</span><br><span class=\"line\">    public static class DanliHolder&#123;</span><br><span class=\"line\">        private static ClassInnerClassDanli dl = new ClassInnerClassDanli();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    private ClassInnerClassDanli()&#123;&#125;</span><br><span class=\"line\">        public static ClassInnerClassDanli getInstance()&#123;</span><br><span class=\"line\">                return DanliHolder.dl;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"强弱类型语言","date":"2022-07-14T14:01:23.000Z","_content":"\n\n\n## 弱类型语言\n\n是一种弱类型定义的语言,某一个变量被定义类型,该变量可以根据环境变化自动进行转换,不需要经过显性强制转换 代表js,php,lua\n\n\n\njs\n\n![](/pics/was-1.png)\n\n+操作是将A的类型转化为了字符串，然后进行拼接\n\n-操作是将B的类型转化为了数字，然后进行减法\n\n\n\nlua\n\n```\n> a=5 \n> b=\"5\"\n> print(b+a)\n10.0\n> print(b-a)\n0.0\n> print(a==b)\nfalse\n\n```\n\n<!--more-->\n\n![](/pics/saw-2.png)\n\n\n\n## 强类型语言\n\njava\n\n```\npublic class Main{\n    public static void main(String []args) {\n    int a=5;\n    String b=\"5\";\n       System.out.println(a+b);//55\n       // System.out.println(a-b);//编译不通过,错误：二元运算符“-”的操作数类型错误\n    }\n} \n```\n\n\n\ngo\n\n```\npackage main\nvar a = 5\nvar b string = \"5\"\n\n\nfunc main(){\n    println(a+b) //无效操作：a + b（不匹配的类型 int 和 string）\n    println(a-b) //无效操作：a - b（不匹配的类型 int 和 string）\n}\n```\n\n","source":"_posts/lang/sawtl.md","raw":"---\ntitle: 强弱类型语言\npermalink: lang/sawtl/\ntags:\n  - 强弱类型\ncategories:\n  - lang\ndate: 2022-07-14 22:01:23\n---\n\n\n\n## 弱类型语言\n\n是一种弱类型定义的语言,某一个变量被定义类型,该变量可以根据环境变化自动进行转换,不需要经过显性强制转换 代表js,php,lua\n\n\n\njs\n\n![](/pics/was-1.png)\n\n+操作是将A的类型转化为了字符串，然后进行拼接\n\n-操作是将B的类型转化为了数字，然后进行减法\n\n\n\nlua\n\n```\n> a=5 \n> b=\"5\"\n> print(b+a)\n10.0\n> print(b-a)\n0.0\n> print(a==b)\nfalse\n\n```\n\n<!--more-->\n\n![](/pics/saw-2.png)\n\n\n\n## 强类型语言\n\njava\n\n```\npublic class Main{\n    public static void main(String []args) {\n    int a=5;\n    String b=\"5\";\n       System.out.println(a+b);//55\n       // System.out.println(a-b);//编译不通过,错误：二元运算符“-”的操作数类型错误\n    }\n} \n```\n\n\n\ngo\n\n```\npackage main\nvar a = 5\nvar b string = \"5\"\n\n\nfunc main(){\n    println(a+b) //无效操作：a + b（不匹配的类型 int 和 string）\n    println(a-b) //无效操作：a - b（不匹配的类型 int 和 string）\n}\n```\n\n","slug":"lang/sawtl","published":1,"updated":"2022-08-28T09:10:00.932Z","__permalink":"lang/sawtl/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtsf0007gwi57o6y2qhm","content":"<h2 id=\"弱类型语言\"><a href=\"#弱类型语言\" class=\"headerlink\" title=\"弱类型语言\"></a>弱类型语言</h2><p>是一种弱类型定义的语言,某一个变量被定义类型,该变量可以根据环境变化自动进行转换,不需要经过显性强制转换 代表js,php,lua</p>\n<p>js</p>\n<p><img src=\"/pics/was-1.png\"></p>\n<p>+操作是将A的类型转化为了字符串，然后进行拼接</p>\n<p>-操作是将B的类型转化为了数字，然后进行减法</p>\n<p>lua</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; a=5 </span><br><span class=\"line\">&gt; b=&quot;5&quot;</span><br><span class=\"line\">&gt; print(b+a)</span><br><span class=\"line\">10.0</span><br><span class=\"line\">&gt; print(b-a)</span><br><span class=\"line\">0.0</span><br><span class=\"line\">&gt; print(a==b)</span><br><span class=\"line\">false</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n<p><img src=\"/pics/saw-2.png\"></p>\n<h2 id=\"强类型语言\"><a href=\"#强类型语言\" class=\"headerlink\" title=\"强类型语言\"></a>强类型语言</h2><p>java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Main&#123;</span><br><span class=\"line\">    public static void main(String []args) &#123;</span><br><span class=\"line\">    int a=5;</span><br><span class=\"line\">    String b=&quot;5&quot;;</span><br><span class=\"line\">       System.out.println(a+b);//55</span><br><span class=\"line\">       // System.out.println(a-b);//编译不通过,错误：二元运算符“-”的操作数类型错误</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>\n\n\n\n<p>go</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package main</span><br><span class=\"line\">var a = 5</span><br><span class=\"line\">var b string = &quot;5&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">func main()&#123;</span><br><span class=\"line\">    println(a+b) //无效操作：a + b（不匹配的类型 int 和 string）</span><br><span class=\"line\">    println(a-b) //无效操作：a - b（不匹配的类型 int 和 string）</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"弱类型语言\"><a href=\"#弱类型语言\" class=\"headerlink\" title=\"弱类型语言\"></a>弱类型语言</h2><p>是一种弱类型定义的语言,某一个变量被定义类型,该变量可以根据环境变化自动进行转换,不需要经过显性强制转换 代表js,php,lua</p>\n<p>js</p>\n<p><img src=\"/pics/was-1.png\"></p>\n<p>+操作是将A的类型转化为了字符串，然后进行拼接</p>\n<p>-操作是将B的类型转化为了数字，然后进行减法</p>\n<p>lua</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; a=5 </span><br><span class=\"line\">&gt; b=&quot;5&quot;</span><br><span class=\"line\">&gt; print(b+a)</span><br><span class=\"line\">10.0</span><br><span class=\"line\">&gt; print(b-a)</span><br><span class=\"line\">0.0</span><br><span class=\"line\">&gt; print(a==b)</span><br><span class=\"line\">false</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>","more":"<p><img src=\"/pics/saw-2.png\"></p>\n<h2 id=\"强类型语言\"><a href=\"#强类型语言\" class=\"headerlink\" title=\"强类型语言\"></a>强类型语言</h2><p>java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Main&#123;</span><br><span class=\"line\">    public static void main(String []args) &#123;</span><br><span class=\"line\">    int a=5;</span><br><span class=\"line\">    String b=&quot;5&quot;;</span><br><span class=\"line\">       System.out.println(a+b);//55</span><br><span class=\"line\">       // System.out.println(a-b);//编译不通过,错误：二元运算符“-”的操作数类型错误</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>\n\n\n\n<p>go</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package main</span><br><span class=\"line\">var a = 5</span><br><span class=\"line\">var b string = &quot;5&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">func main()&#123;</span><br><span class=\"line\">    println(a+b) //无效操作：a + b（不匹配的类型 int 和 string）</span><br><span class=\"line\">    println(a-b) //无效操作：a - b（不匹配的类型 int 和 string）</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"md流程图","date":"2022-06-03T10:46:58.000Z","_content":"\n```flow\nstart=>start: 接收到消息\ninfo=>operation: 读取信息\ncd=>condition: 是否存在\nsetC=>subroutine: 设置缓存\ngetC=>operation: 读取缓存\nxx=>inputoutput: 返回信息\nend=>end: 处理结束\n\nstart->info->cd\ncd(yes)->getC->xx\ncd(no)->setC->xx\nxx->end\n```\n\n<!--more-->\n\n![md_flow](/pics/md_flow.png)\n\n\n>基本语法：定义模块 id=>关键字: 描述 （“描述”的前面必须有空格，“=>” 两端不能有空格）\n>\n>关键字：\n>\n>start 流程开始，以圆角矩形绘制\n>\n>operation 操作，以直角矩形绘制\n>\n>condition 判断，以菱形绘制\n>\n>subroutine 子流程，以左右带空白框的矩形绘制\n>\n>inputoutput 输入输出，以平行四边形绘制\n>\n>end 流程结束，以圆角矩形绘制\n>\n>定义模块间的流向：\n>\n>模块1 id->模块2 id ：\n>\n>一般的箭头指向条件模块id (描述)->模块id(direction) ：条件模块跳转到对应的执行模块，并指定对应分支的布局方向\n\n\n","source":"_posts/markdown/flow.md","raw":"---\ntitle: md流程图\npermalink: markdown/flow/\ntags:\n  - 流程图\n  - flow\ncategories:\n  - markdown\ndate: 2022-06-03 18:46:58\n---\n\n```flow\nstart=>start: 接收到消息\ninfo=>operation: 读取信息\ncd=>condition: 是否存在\nsetC=>subroutine: 设置缓存\ngetC=>operation: 读取缓存\nxx=>inputoutput: 返回信息\nend=>end: 处理结束\n\nstart->info->cd\ncd(yes)->getC->xx\ncd(no)->setC->xx\nxx->end\n```\n\n<!--more-->\n\n![md_flow](/pics/md_flow.png)\n\n\n>基本语法：定义模块 id=>关键字: 描述 （“描述”的前面必须有空格，“=>” 两端不能有空格）\n>\n>关键字：\n>\n>start 流程开始，以圆角矩形绘制\n>\n>operation 操作，以直角矩形绘制\n>\n>condition 判断，以菱形绘制\n>\n>subroutine 子流程，以左右带空白框的矩形绘制\n>\n>inputoutput 输入输出，以平行四边形绘制\n>\n>end 流程结束，以圆角矩形绘制\n>\n>定义模块间的流向：\n>\n>模块1 id->模块2 id ：\n>\n>一般的箭头指向条件模块id (描述)->模块id(direction) ：条件模块跳转到对应的执行模块，并指定对应分支的布局方向\n\n\n","slug":"markdown/flow","published":1,"updated":"2022-08-28T09:10:00.932Z","__permalink":"markdown/flow/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtsg0009gwi5fkgj01j6","content":"<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">start=&gt;start: 接收到消息</span><br><span class=\"line\">info=&gt;operation: 读取信息</span><br><span class=\"line\">cd=&gt;condition: 是否存在</span><br><span class=\"line\">setC=&gt;subroutine: 设置缓存</span><br><span class=\"line\">getC=&gt;operation: 读取缓存</span><br><span class=\"line\">xx=&gt;inputoutput: 返回信息</span><br><span class=\"line\">end=&gt;end: 处理结束</span><br><span class=\"line\"></span><br><span class=\"line\">start-&gt;info-&gt;cd</span><br><span class=\"line\">cd(yes)-&gt;getC-&gt;xx</span><br><span class=\"line\">cd(no)-&gt;setC-&gt;xx</span><br><span class=\"line\">xx-&gt;end</span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n<p><img src=\"/pics/md_flow.png\" alt=\"md_flow\"></p>\n<blockquote>\n<p>基本语法：定义模块 id&#x3D;&gt;关键字: 描述 （“描述”的前面必须有空格，“&#x3D;&gt;” 两端不能有空格）</p>\n<p>关键字：</p>\n<p>start 流程开始，以圆角矩形绘制</p>\n<p>operation 操作，以直角矩形绘制</p>\n<p>condition 判断，以菱形绘制</p>\n<p>subroutine 子流程，以左右带空白框的矩形绘制</p>\n<p>inputoutput 输入输出，以平行四边形绘制</p>\n<p>end 流程结束，以圆角矩形绘制</p>\n<p>定义模块间的流向：</p>\n<p>模块1 id-&gt;模块2 id ：</p>\n<p>一般的箭头指向条件模块id (描述)-&gt;模块id(direction) ：条件模块跳转到对应的执行模块，并指定对应分支的布局方向</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">start=&gt;start: 接收到消息</span><br><span class=\"line\">info=&gt;operation: 读取信息</span><br><span class=\"line\">cd=&gt;condition: 是否存在</span><br><span class=\"line\">setC=&gt;subroutine: 设置缓存</span><br><span class=\"line\">getC=&gt;operation: 读取缓存</span><br><span class=\"line\">xx=&gt;inputoutput: 返回信息</span><br><span class=\"line\">end=&gt;end: 处理结束</span><br><span class=\"line\"></span><br><span class=\"line\">start-&gt;info-&gt;cd</span><br><span class=\"line\">cd(yes)-&gt;getC-&gt;xx</span><br><span class=\"line\">cd(no)-&gt;setC-&gt;xx</span><br><span class=\"line\">xx-&gt;end</span><br></pre></td></tr></table></figure>","more":"<p><img src=\"/pics/md_flow.png\" alt=\"md_flow\"></p>\n<blockquote>\n<p>基本语法：定义模块 id&#x3D;&gt;关键字: 描述 （“描述”的前面必须有空格，“&#x3D;&gt;” 两端不能有空格）</p>\n<p>关键字：</p>\n<p>start 流程开始，以圆角矩形绘制</p>\n<p>operation 操作，以直角矩形绘制</p>\n<p>condition 判断，以菱形绘制</p>\n<p>subroutine 子流程，以左右带空白框的矩形绘制</p>\n<p>inputoutput 输入输出，以平行四边形绘制</p>\n<p>end 流程结束，以圆角矩形绘制</p>\n<p>定义模块间的流向：</p>\n<p>模块1 id-&gt;模块2 id ：</p>\n<p>一般的箭头指向条件模块id (描述)-&gt;模块id(direction) ：条件模块跳转到对应的执行模块，并指定对应分支的布局方向</p>\n</blockquote>"},{"title":"Mathjax公式","date":"2022-08-15T14:25:18.000Z","mathjax":true,"_content":"\n\n\nWhen $a \\ne 0$, there are two solutions to \\(ax^2 + bx + c = 0\\) and they are\n\n$$x = {-b \\pm \\sqrt{b^2-4ac} \\over 2a}.$$\n\n![](/pics/mathjax01.png)\n\n\n\n<!--more-->\n\nhttp://mathjax.josephjctang.com/\n\n```shell\n$ grep theme.mathjax -rl --include=\\*.{ejs,js} /home/cs/oss/hexo/themes/spfk\n/home/cs/oss/hexo/themes/spfk/layout/_partial/head.ejs\n$ sed -i 's/theme.mathjax/page.mathjax/' /hexo/themes/spfk/layout/_partial/after-footer.ejs\n```\n\n> <% if (page.mathjax){ %>\n\n\n\n/hexo/public/js/MathJax.js 添加引入\n\n```\n  <script type=\"text/javascript\"\n     src=\"http://mathjax.josephjctang.com/MathJax.js?config=TeX-MML-AM_HTMLorMML\">\n  </script>\n```\n\n文章开头加入\n\n```\ntitle: xxxx\npermalink: xxxx/\ntags: xxxx\ndate: xxxx\nmathjax: true\n```\n\n> mathjax: true\n\n\n\n引入目录\n\n![](/pics/mathjax.png)\n","source":"_posts/markdown/formula.md","raw":"---\ntitle: Mathjax公式\npermalink: markdown/formula/\ntags:\n  - formula\ncategories:\n  - markdown\ndate: 2022-08-15 22:25:18\nmathjax: true\n---\n\n\n\nWhen $a \\ne 0$, there are two solutions to \\(ax^2 + bx + c = 0\\) and they are\n\n$$x = {-b \\pm \\sqrt{b^2-4ac} \\over 2a}.$$\n\n![](/pics/mathjax01.png)\n\n\n\n<!--more-->\n\nhttp://mathjax.josephjctang.com/\n\n```shell\n$ grep theme.mathjax -rl --include=\\*.{ejs,js} /home/cs/oss/hexo/themes/spfk\n/home/cs/oss/hexo/themes/spfk/layout/_partial/head.ejs\n$ sed -i 's/theme.mathjax/page.mathjax/' /hexo/themes/spfk/layout/_partial/after-footer.ejs\n```\n\n> <% if (page.mathjax){ %>\n\n\n\n/hexo/public/js/MathJax.js 添加引入\n\n```\n  <script type=\"text/javascript\"\n     src=\"http://mathjax.josephjctang.com/MathJax.js?config=TeX-MML-AM_HTMLorMML\">\n  </script>\n```\n\n文章开头加入\n\n```\ntitle: xxxx\npermalink: xxxx/\ntags: xxxx\ndate: xxxx\nmathjax: true\n```\n\n> mathjax: true\n\n\n\n引入目录\n\n![](/pics/mathjax.png)\n","slug":"markdown/formula","published":1,"updated":"2022-08-28T09:10:00.932Z","__permalink":"markdown/formula/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtsh000agwi52t8of12e","content":"<p>When $a \\ne 0$, there are two solutions to (ax^2 + bx + c &#x3D; 0) and they are</p>\n<p>$$x &#x3D; {-b \\pm \\sqrt{b^2-4ac} \\over 2a}.$$</p>\n<p><img src=\"/pics/mathjax01.png\"></p>\n<span id=\"more\"></span>\n\n<p><a href=\"http://mathjax.josephjctang.com/\">http://mathjax.josephjctang.com/</a></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">grep theme.mathjax -rl --include=\\*.&#123;ejs,js&#125; /home/cs/oss/hexo/themes/spfk</span></span><br><span class=\"line\">/home/cs/oss/hexo/themes/spfk/layout/_partial/head.ejs</span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">sed -i <span class=\"string\">&#x27;s/theme.mathjax/page.mathjax/&#x27;</span> /hexo/themes/spfk/layout/_partial/after-footer.ejs</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>&lt;% if (page.mathjax){ %&gt;</p>\n</blockquote>\n<p>&#x2F;hexo&#x2F;public&#x2F;js&#x2F;MathJax.js 添加引入</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script type=&quot;text/javascript&quot;</span><br><span class=\"line\">   src=&quot;http://mathjax.josephjctang.com/MathJax.js?config=TeX-MML-AM_HTMLorMML&quot;&gt;</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>文章开头加入</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">title: xxxx</span><br><span class=\"line\">permalink: xxxx/</span><br><span class=\"line\">tags: xxxx</span><br><span class=\"line\">date: xxxx</span><br><span class=\"line\">mathjax: true</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>mathjax: true</p>\n</blockquote>\n<p>引入目录</p>\n<p><img src=\"/pics/mathjax.png\"></p>\n","site":{"data":{}},"excerpt":"<p>When $a \\ne 0$, there are two solutions to (ax^2 + bx + c &#x3D; 0) and they are</p>\n<p>$$x &#x3D; {-b \\pm \\sqrt{b^2-4ac} \\over 2a}.$$</p>\n<p><img src=\"/pics/mathjax01.png\"></p>","more":"<p><a href=\"http://mathjax.josephjctang.com/\">http://mathjax.josephjctang.com/</a></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">grep theme.mathjax -rl --include=\\*.&#123;ejs,js&#125; /home/cs/oss/hexo/themes/spfk</span></span><br><span class=\"line\">/home/cs/oss/hexo/themes/spfk/layout/_partial/head.ejs</span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">sed -i <span class=\"string\">&#x27;s/theme.mathjax/page.mathjax/&#x27;</span> /hexo/themes/spfk/layout/_partial/after-footer.ejs</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>&lt;% if (page.mathjax){ %&gt;</p>\n</blockquote>\n<p>&#x2F;hexo&#x2F;public&#x2F;js&#x2F;MathJax.js 添加引入</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script type=&quot;text/javascript&quot;</span><br><span class=\"line\">   src=&quot;http://mathjax.josephjctang.com/MathJax.js?config=TeX-MML-AM_HTMLorMML&quot;&gt;</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>文章开头加入</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">title: xxxx</span><br><span class=\"line\">permalink: xxxx/</span><br><span class=\"line\">tags: xxxx</span><br><span class=\"line\">date: xxxx</span><br><span class=\"line\">mathjax: true</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>mathjax: true</p>\n</blockquote>\n<p>引入目录</p>\n<p><img src=\"/pics/mathjax.png\"></p>"},{"title":"md语法","date":"2022-02-16T12:49:21.000Z","_content":"\n\n\n/hexo/_config.yml<a id=\"id-sample\" style=\"display:none\"/>\n\n```\npermalink: :title//\n```\n\n### 站内文章链接\n\n#### 绝对路径\n\n/_posts\n\n```\n$ tree -L 2 ./_posts/\n./_posts/\n├── linux\n│   ├── debian\n│   ├── k8s\n│   └── shell\n├── markdown\n│   ├── flow.md\n│   ├── formula.md\n│   └── mdgrammar.md\n\n```\n\n\n\n```\n[点击查看md写flow文章](/markdown/flow)\n```\n\n>[点击查看md写flow文章](/markdown/flow)\n>\n>[] 自定义链接标题\n>\n>()绝对地址,permalink的值\n\n#### post_link\n\n```\n{% post_link markdown/flow '点击查看md写flow文章' %}\n```\n\n> {% post_link markdown/flow '点击查看md写flow文章' %}\n>\n> post_link 相对路径 '标题' \n\n\n\n### 跳转\n\n#### 页内跳转指定位置\n\n锚点链接\n\n```\n[跳到本页的开头](#id-sample)\n```\n\n[跳到开头](#id-sample)\n\n#### 其他页面跳转到指定位置\n\n锚点链接\n\n```\n[跳到其他页指定位置](permalink的值#id-sample)\n```\n\n\n\n#### 设置锚点\n\n```\n锚点<a id=\"id-sample\" style=\"display:none\"/>\n```\n\n","source":"_posts/markdown/mdgrammar.md","raw":"---\ntitle: md语法\npermalink: markdown/mdgrammar/\ntags:\n  - grammar\ncategories:\n  - markdown\ndate: 2022-02-16 20:49:21\n---\n\n\n\n/hexo/_config.yml<a id=\"id-sample\" style=\"display:none\"/>\n\n```\npermalink: :title//\n```\n\n### 站内文章链接\n\n#### 绝对路径\n\n/_posts\n\n```\n$ tree -L 2 ./_posts/\n./_posts/\n├── linux\n│   ├── debian\n│   ├── k8s\n│   └── shell\n├── markdown\n│   ├── flow.md\n│   ├── formula.md\n│   └── mdgrammar.md\n\n```\n\n\n\n```\n[点击查看md写flow文章](/markdown/flow)\n```\n\n>[点击查看md写flow文章](/markdown/flow)\n>\n>[] 自定义链接标题\n>\n>()绝对地址,permalink的值\n\n#### post_link\n\n```\n{% post_link markdown/flow '点击查看md写flow文章' %}\n```\n\n> {% post_link markdown/flow '点击查看md写flow文章' %}\n>\n> post_link 相对路径 '标题' \n\n\n\n### 跳转\n\n#### 页内跳转指定位置\n\n锚点链接\n\n```\n[跳到本页的开头](#id-sample)\n```\n\n[跳到开头](#id-sample)\n\n#### 其他页面跳转到指定位置\n\n锚点链接\n\n```\n[跳到其他页指定位置](permalink的值#id-sample)\n```\n\n\n\n#### 设置锚点\n\n```\n锚点<a id=\"id-sample\" style=\"display:none\"/>\n```\n\n","slug":"markdown/mdgrammar","published":1,"updated":"2022-08-28T09:10:00.932Z","__permalink":"markdown/mdgrammar/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtsi000egwi59j1p3wqx","content":"<p>&#x2F;hexo&#x2F;_config.yml<a id=\"id-sample\" style=\"display:none\"/></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">permalink: :title//</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"站内文章链接\"><a href=\"#站内文章链接\" class=\"headerlink\" title=\"站内文章链接\"></a>站内文章链接</h3><h4 id=\"绝对路径\"><a href=\"#绝对路径\" class=\"headerlink\" title=\"绝对路径\"></a>绝对路径</h4><p>&#x2F;_posts</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ tree -L 2 ./_posts/</span><br><span class=\"line\">./_posts/</span><br><span class=\"line\">├── linux</span><br><span class=\"line\">│   ├── debian</span><br><span class=\"line\">│   ├── k8s</span><br><span class=\"line\">│   └── shell</span><br><span class=\"line\">├── markdown</span><br><span class=\"line\">│   ├── flow.md</span><br><span class=\"line\">│   ├── formula.md</span><br><span class=\"line\">│   └── mdgrammar.md</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[点击查看md写flow文章](/markdown/flow)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p><a href=\"/markdown/flow\">点击查看md写flow文章</a></p>\n<p>[] 自定义链接标题</p>\n<p>()绝对地址,permalink的值</p>\n</blockquote>\n<h4 id=\"post-link\"><a href=\"#post-link\" class=\"headerlink\" title=\"post_link\"></a>post_link</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% post_link markdown/flow &#x27;点击查看md写flow文章&#x27; %&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<a href=\"/markdown/flow/\" title=\"点击查看md写flow文章\">点击查看md写flow文章</a>\n\n<p>post_link 相对路径 ‘标题’ </p>\n</blockquote>\n<h3 id=\"跳转\"><a href=\"#跳转\" class=\"headerlink\" title=\"跳转\"></a>跳转</h3><h4 id=\"页内跳转指定位置\"><a href=\"#页内跳转指定位置\" class=\"headerlink\" title=\"页内跳转指定位置\"></a>页内跳转指定位置</h4><p>锚点链接</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[跳到本页的开头](#id-sample)</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"#id-sample\">跳到开头</a></p>\n<h4 id=\"其他页面跳转到指定位置\"><a href=\"#其他页面跳转到指定位置\" class=\"headerlink\" title=\"其他页面跳转到指定位置\"></a>其他页面跳转到指定位置</h4><p>锚点链接</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[跳到其他页指定位置](permalink的值#id-sample)</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"设置锚点\"><a href=\"#设置锚点\" class=\"headerlink\" title=\"设置锚点\"></a>设置锚点</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">锚点&lt;a id=&quot;id-sample&quot; style=&quot;display:none&quot;/&gt;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<p>&#x2F;hexo&#x2F;_config.yml<a id=\"id-sample\" style=\"display:none\"/></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">permalink: :title//</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"站内文章链接\"><a href=\"#站内文章链接\" class=\"headerlink\" title=\"站内文章链接\"></a>站内文章链接</h3><h4 id=\"绝对路径\"><a href=\"#绝对路径\" class=\"headerlink\" title=\"绝对路径\"></a>绝对路径</h4><p>&#x2F;_posts</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ tree -L 2 ./_posts/</span><br><span class=\"line\">./_posts/</span><br><span class=\"line\">├── linux</span><br><span class=\"line\">│   ├── debian</span><br><span class=\"line\">│   ├── k8s</span><br><span class=\"line\">│   └── shell</span><br><span class=\"line\">├── markdown</span><br><span class=\"line\">│   ├── flow.md</span><br><span class=\"line\">│   ├── formula.md</span><br><span class=\"line\">│   └── mdgrammar.md</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[点击查看md写flow文章](/markdown/flow)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p><a href=\"/markdown/flow\">点击查看md写flow文章</a></p>\n<p>[] 自定义链接标题</p>\n<p>()绝对地址,permalink的值</p>\n</blockquote>\n<h4 id=\"post-link\"><a href=\"#post-link\" class=\"headerlink\" title=\"post_link\"></a>post_link</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% post_link markdown/flow &#x27;点击查看md写flow文章&#x27; %&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<a href=\"/markdown/flow/\" title=\"点击查看md写flow文章\">点击查看md写flow文章</a>\n\n<p>post_link 相对路径 ‘标题’ </p>\n</blockquote>\n<h3 id=\"跳转\"><a href=\"#跳转\" class=\"headerlink\" title=\"跳转\"></a>跳转</h3><h4 id=\"页内跳转指定位置\"><a href=\"#页内跳转指定位置\" class=\"headerlink\" title=\"页内跳转指定位置\"></a>页内跳转指定位置</h4><p>锚点链接</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[跳到本页的开头](#id-sample)</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"#id-sample\">跳到开头</a></p>\n<h4 id=\"其他页面跳转到指定位置\"><a href=\"#其他页面跳转到指定位置\" class=\"headerlink\" title=\"其他页面跳转到指定位置\"></a>其他页面跳转到指定位置</h4><p>锚点链接</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[跳到其他页指定位置](permalink的值#id-sample)</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"设置锚点\"><a href=\"#设置锚点\" class=\"headerlink\" title=\"设置锚点\"></a>设置锚点</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">锚点&lt;a id=&quot;id-sample&quot; style=&quot;display:none&quot;/&gt;</span><br></pre></td></tr></table></figure>\n\n"},{"title":"网络概念介绍","date":"2022-06-20T13:24:48.000Z","_content":"\n\n\n## http 应用层\n\n在两台计算机相互传递信息时，HTTP规定了每段数据以什么形式表达才是能够被另外一台计算机理解\n\n\n\n第一步：在浏览器输入内容（网址）\n\n第二步：浏览器把 域名 发送到DNS上 ，进行解析 得到IP之后链接到指定\n\n​    服务器 （服务器地址110,102.13.32:80 从浏览器到服务器使用底层TCP/IP）\n\n第三步：实现TCP/IP协议用Socket 用Socket套接字\n\n第四步：服务器端口80监听客户端链接（客户端到服务器端链接）\n\n\n\nHTTP 1.0 一个链接发送一个请求\n\nHTTP 1.1 一个链接发送多个请求\n\n\n\nget  向服务器 【索取】 数据的一种 请求\n\n  一般用于 获取/查询  资源信息\n\n  get用于信息获取，而且应该是安全（指非修改信息）和幂等\n\n  如：新闻头版不断更新，该操作被认为安全和幂等，从自身角度来看没有改变资源\n\n\n\npost  向服务器 【提交】 数据的一种 请求\n\n  一般用于 更新 资源信息\n\n​\tpost表示可能修改服务器上的资源请求\n\n​\t如：评论新闻，提交后站点资源不同，资源被修改\n\n\n\n表面现象\n\n​\tget请求数据附在URL上； post提交数据放在http包体中\n\n​\tget字节限制（1024） 实质是浏览器（和服务器）的限制 ； post理论没有限制\n\n​\tpost 安全（security）性比 get安全（security）性高\n\n\n\n\n\n## tpc/udp 传输层\n\n规定的是数据应该怎么传输才能稳定且高效的传递与计算机之间。\n\n\n\n| \\          | TCP                                    | UDP                                  |\n| ---------- | -------------------------------------- | ------------------------------------ |\n| 是否连接   | 面向连接                               | 面向非连接                           |\n| 传输可靠性 | 可靠                                   | 不可靠                               |\n| 应用场合   | 传输大量的数据，对可靠性要求较高的场合 | 传送少量数据、对可靠性要求不高的场景 |\n| 速度       | 慢                                     | 快                                   |\n\n\n\n## https\n\nHTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议","source":"_posts/network/network.md","raw":"---\ntitle: 网络概念介绍\npermalink: network/network/\ntags:\n  - tcp\n  - http\ncategories:\n  - network\ndate: 2022-06-20 21:24:48\n---\n\n\n\n## http 应用层\n\n在两台计算机相互传递信息时，HTTP规定了每段数据以什么形式表达才是能够被另外一台计算机理解\n\n\n\n第一步：在浏览器输入内容（网址）\n\n第二步：浏览器把 域名 发送到DNS上 ，进行解析 得到IP之后链接到指定\n\n​    服务器 （服务器地址110,102.13.32:80 从浏览器到服务器使用底层TCP/IP）\n\n第三步：实现TCP/IP协议用Socket 用Socket套接字\n\n第四步：服务器端口80监听客户端链接（客户端到服务器端链接）\n\n\n\nHTTP 1.0 一个链接发送一个请求\n\nHTTP 1.1 一个链接发送多个请求\n\n\n\nget  向服务器 【索取】 数据的一种 请求\n\n  一般用于 获取/查询  资源信息\n\n  get用于信息获取，而且应该是安全（指非修改信息）和幂等\n\n  如：新闻头版不断更新，该操作被认为安全和幂等，从自身角度来看没有改变资源\n\n\n\npost  向服务器 【提交】 数据的一种 请求\n\n  一般用于 更新 资源信息\n\n​\tpost表示可能修改服务器上的资源请求\n\n​\t如：评论新闻，提交后站点资源不同，资源被修改\n\n\n\n表面现象\n\n​\tget请求数据附在URL上； post提交数据放在http包体中\n\n​\tget字节限制（1024） 实质是浏览器（和服务器）的限制 ； post理论没有限制\n\n​\tpost 安全（security）性比 get安全（security）性高\n\n\n\n\n\n## tpc/udp 传输层\n\n规定的是数据应该怎么传输才能稳定且高效的传递与计算机之间。\n\n\n\n| \\          | TCP                                    | UDP                                  |\n| ---------- | -------------------------------------- | ------------------------------------ |\n| 是否连接   | 面向连接                               | 面向非连接                           |\n| 传输可靠性 | 可靠                                   | 不可靠                               |\n| 应用场合   | 传输大量的数据，对可靠性要求较高的场合 | 传送少量数据、对可靠性要求不高的场景 |\n| 速度       | 慢                                     | 快                                   |\n\n\n\n## https\n\nHTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议","slug":"network/network","published":1,"updated":"2022-08-28T09:10:00.932Z","__permalink":"network/network/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtsj000fgwi50ptegehe","content":"<h2 id=\"http-应用层\"><a href=\"#http-应用层\" class=\"headerlink\" title=\"http 应用层\"></a>http 应用层</h2><p>在两台计算机相互传递信息时，HTTP规定了每段数据以什么形式表达才是能够被另外一台计算机理解</p>\n<p>第一步：在浏览器输入内容（网址）</p>\n<p>第二步：浏览器把 域名 发送到DNS上 ，进行解析 得到IP之后链接到指定</p>\n<p>​    服务器 （服务器地址110,102.13.32:80 从浏览器到服务器使用底层TCP&#x2F;IP）</p>\n<p>第三步：实现TCP&#x2F;IP协议用Socket 用Socket套接字</p>\n<p>第四步：服务器端口80监听客户端链接（客户端到服务器端链接）</p>\n<p>HTTP 1.0 一个链接发送一个请求</p>\n<p>HTTP 1.1 一个链接发送多个请求</p>\n<p>get  向服务器 【索取】 数据的一种 请求</p>\n<p>  一般用于 获取&#x2F;查询  资源信息</p>\n<p>  get用于信息获取，而且应该是安全（指非修改信息）和幂等</p>\n<p>  如：新闻头版不断更新，该操作被认为安全和幂等，从自身角度来看没有改变资源</p>\n<p>post  向服务器 【提交】 数据的一种 请求</p>\n<p>  一般用于 更新 资源信息</p>\n<p>​\tpost表示可能修改服务器上的资源请求</p>\n<p>​\t如：评论新闻，提交后站点资源不同，资源被修改</p>\n<p>表面现象</p>\n<p>​\tget请求数据附在URL上； post提交数据放在http包体中</p>\n<p>​\tget字节限制（1024） 实质是浏览器（和服务器）的限制 ； post理论没有限制</p>\n<p>​\tpost 安全（security）性比 get安全（security）性高</p>\n<h2 id=\"tpc-x2F-udp-传输层\"><a href=\"#tpc-x2F-udp-传输层\" class=\"headerlink\" title=\"tpc&#x2F;udp 传输层\"></a>tpc&#x2F;udp 传输层</h2><p>规定的是数据应该怎么传输才能稳定且高效的传递与计算机之间。</p>\n<table>\n<thead>\n<tr>\n<th>\\</th>\n<th>TCP</th>\n<th>UDP</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>是否连接</td>\n<td>面向连接</td>\n<td>面向非连接</td>\n</tr>\n<tr>\n<td>传输可靠性</td>\n<td>可靠</td>\n<td>不可靠</td>\n</tr>\n<tr>\n<td>应用场合</td>\n<td>传输大量的数据，对可靠性要求较高的场合</td>\n<td>传送少量数据、对可靠性要求不高的场景</td>\n</tr>\n<tr>\n<td>速度</td>\n<td>慢</td>\n<td>快</td>\n</tr>\n</tbody></table>\n<h2 id=\"https\"><a href=\"#https\" class=\"headerlink\" title=\"https\"></a>https</h2><p>HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"http-应用层\"><a href=\"#http-应用层\" class=\"headerlink\" title=\"http 应用层\"></a>http 应用层</h2><p>在两台计算机相互传递信息时，HTTP规定了每段数据以什么形式表达才是能够被另外一台计算机理解</p>\n<p>第一步：在浏览器输入内容（网址）</p>\n<p>第二步：浏览器把 域名 发送到DNS上 ，进行解析 得到IP之后链接到指定</p>\n<p>​    服务器 （服务器地址110,102.13.32:80 从浏览器到服务器使用底层TCP&#x2F;IP）</p>\n<p>第三步：实现TCP&#x2F;IP协议用Socket 用Socket套接字</p>\n<p>第四步：服务器端口80监听客户端链接（客户端到服务器端链接）</p>\n<p>HTTP 1.0 一个链接发送一个请求</p>\n<p>HTTP 1.1 一个链接发送多个请求</p>\n<p>get  向服务器 【索取】 数据的一种 请求</p>\n<p>  一般用于 获取&#x2F;查询  资源信息</p>\n<p>  get用于信息获取，而且应该是安全（指非修改信息）和幂等</p>\n<p>  如：新闻头版不断更新，该操作被认为安全和幂等，从自身角度来看没有改变资源</p>\n<p>post  向服务器 【提交】 数据的一种 请求</p>\n<p>  一般用于 更新 资源信息</p>\n<p>​\tpost表示可能修改服务器上的资源请求</p>\n<p>​\t如：评论新闻，提交后站点资源不同，资源被修改</p>\n<p>表面现象</p>\n<p>​\tget请求数据附在URL上； post提交数据放在http包体中</p>\n<p>​\tget字节限制（1024） 实质是浏览器（和服务器）的限制 ； post理论没有限制</p>\n<p>​\tpost 安全（security）性比 get安全（security）性高</p>\n<h2 id=\"tpc-x2F-udp-传输层\"><a href=\"#tpc-x2F-udp-传输层\" class=\"headerlink\" title=\"tpc&#x2F;udp 传输层\"></a>tpc&#x2F;udp 传输层</h2><p>规定的是数据应该怎么传输才能稳定且高效的传递与计算机之间。</p>\n<table>\n<thead>\n<tr>\n<th>\\</th>\n<th>TCP</th>\n<th>UDP</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>是否连接</td>\n<td>面向连接</td>\n<td>面向非连接</td>\n</tr>\n<tr>\n<td>传输可靠性</td>\n<td>可靠</td>\n<td>不可靠</td>\n</tr>\n<tr>\n<td>应用场合</td>\n<td>传输大量的数据，对可靠性要求较高的场合</td>\n<td>传送少量数据、对可靠性要求不高的场景</td>\n</tr>\n<tr>\n<td>速度</td>\n<td>慢</td>\n<td>快</td>\n</tr>\n</tbody></table>\n<h2 id=\"https\"><a href=\"#https\" class=\"headerlink\" title=\"https\"></a>https</h2><p>HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议</p>\n"},{"title":"https签名","date":"2016-12-03T15:36:33.000Z","_content":"#### 为服务器端和客户端准备公钥、私钥\n```\n#私钥\n>openssl genrsa -out server.key 1024 -config E:\\Git\\mingw64\\ssl\\openssl.cnf\n```\n```\n#公钥\n>openssl rsa -in server.key -pubout -out server.pem\n```\n#### 生成 CA 证书\n```\n <!--more--> \n#ca私钥\n>openssl genrsa -out ca.key 1024 -config E:\\Git\\mingw64\\ssl\\openssl.cnf\n```\n **第一次填写信息**\n```\n>openssl req -new -key ca.key -out ca.csr -config E:\\Git\\mingw64\\ssl\\openssl.cnf\n```\n\nCountry Name (2 letter code) [AU]:\nState or Province Name (full name) [Some-State]:\nLocality Name (eg, city) []:\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:\nOrganizational Unit Name (eg, section) []:\n**Common Name** (e.g. server FQDN or YOUR name) []:localhost\nEmail Address []:\n\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:12345678\nAn optional company name []:cs\n\n```\n>openssl x509 -req -in ca.csr -signkey ca.key -out ca.crt -days 365\n```\n\n#### 生成服务器端证书\n服务器端需要向 CA 机构申请签名证书，在申请签名证书之前依然是创建自己的 CSR 文件  **与第一次信息填写一样**\n```\n>openssl req -new -key server.key -out server.csr -config E:\\Git\\mingw64\\ssl\\openssl.cnf\n```\n向自己的 CA 机构申请证书，签名过程需要 CA 的证书和私钥参与，最终颁发一个带有 CA 签名的证书\n```\n>openssl x509 -req -CA ca.crt -CAkey ca.key -CAcreateserial -in server.csr -out server.crt\n```\nSignature ok\nsubject=/C=AU/ST=Some-State/O=Internet Widgits Pty Ltd/CN=localhost\nGetting CA Private Key\n\n\n#### 生成cer文件\n使用openssl 进行转换\n```\n>openssl x509 -in server.crt -out server.cer -outform der\n```\n\n 生成p12\n```\nF:\\logs\\http>openssl pkcs12 -export -clcerts -in server.crt -inkey server.key -out client.p12\nWARNING: can't open config file: /usr/local/ssl/openssl.cnf\nLoading 'screen' into random state - done\nEnter Export Password:12345678\nVerifying - Enter Export Password:12345678\n```\n\n","source":"_posts/network/https自己签名.md","raw":"---\ntitle: https签名\ndate: 2016-12-03 23:36:33\ntags:\n    - https\n    - 签名\ncategories:\n    - http协议\n    - https\n    \n---\n#### 为服务器端和客户端准备公钥、私钥\n```\n#私钥\n>openssl genrsa -out server.key 1024 -config E:\\Git\\mingw64\\ssl\\openssl.cnf\n```\n```\n#公钥\n>openssl rsa -in server.key -pubout -out server.pem\n```\n#### 生成 CA 证书\n```\n <!--more--> \n#ca私钥\n>openssl genrsa -out ca.key 1024 -config E:\\Git\\mingw64\\ssl\\openssl.cnf\n```\n **第一次填写信息**\n```\n>openssl req -new -key ca.key -out ca.csr -config E:\\Git\\mingw64\\ssl\\openssl.cnf\n```\n\nCountry Name (2 letter code) [AU]:\nState or Province Name (full name) [Some-State]:\nLocality Name (eg, city) []:\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:\nOrganizational Unit Name (eg, section) []:\n**Common Name** (e.g. server FQDN or YOUR name) []:localhost\nEmail Address []:\n\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:12345678\nAn optional company name []:cs\n\n```\n>openssl x509 -req -in ca.csr -signkey ca.key -out ca.crt -days 365\n```\n\n#### 生成服务器端证书\n服务器端需要向 CA 机构申请签名证书，在申请签名证书之前依然是创建自己的 CSR 文件  **与第一次信息填写一样**\n```\n>openssl req -new -key server.key -out server.csr -config E:\\Git\\mingw64\\ssl\\openssl.cnf\n```\n向自己的 CA 机构申请证书，签名过程需要 CA 的证书和私钥参与，最终颁发一个带有 CA 签名的证书\n```\n>openssl x509 -req -CA ca.crt -CAkey ca.key -CAcreateserial -in server.csr -out server.crt\n```\nSignature ok\nsubject=/C=AU/ST=Some-State/O=Internet Widgits Pty Ltd/CN=localhost\nGetting CA Private Key\n\n\n#### 生成cer文件\n使用openssl 进行转换\n```\n>openssl x509 -in server.crt -out server.cer -outform der\n```\n\n 生成p12\n```\nF:\\logs\\http>openssl pkcs12 -export -clcerts -in server.crt -inkey server.key -out client.p12\nWARNING: can't open config file: /usr/local/ssl/openssl.cnf\nLoading 'screen' into random state - done\nEnter Export Password:12345678\nVerifying - Enter Export Password:12345678\n```\n\n","slug":"network/https自己签名","published":1,"updated":"2022-06-03T08:37:05.139Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtsl000jgwi537gg3n41","content":"<h4 id=\"为服务器端和客户端准备公钥、私钥\"><a href=\"#为服务器端和客户端准备公钥、私钥\" class=\"headerlink\" title=\"为服务器端和客户端准备公钥、私钥\"></a>为服务器端和客户端准备公钥、私钥</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#私钥</span><br><span class=\"line\">&gt;openssl genrsa -out server.key 1024 -config E:\\Git\\mingw64\\ssl\\openssl.cnf</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#公钥</span><br><span class=\"line\">&gt;openssl rsa -in server.key -pubout -out server.pem</span><br></pre></td></tr></table></figure>\n<h4 id=\"生成-CA-证书\"><a href=\"#生成-CA-证书\" class=\"headerlink\" title=\"生成 CA 证书\"></a>生成 CA 证书</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> &lt;!--more--&gt; </span><br><span class=\"line\">#ca私钥</span><br><span class=\"line\">&gt;openssl genrsa -out ca.key 1024 -config E:\\Git\\mingw64\\ssl\\openssl.cnf</span><br></pre></td></tr></table></figure>\n<p> <strong>第一次填写信息</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;openssl req -new -key ca.key -out ca.csr -config E:\\Git\\mingw64\\ssl\\openssl.cnf</span><br></pre></td></tr></table></figure>\n\n<p>Country Name (2 letter code) [AU]:<br>State or Province Name (full name) [Some-State]:<br>Locality Name (eg, city) []:<br>Organization Name (eg, company) [Internet Widgits Pty Ltd]:<br>Organizational Unit Name (eg, section) []:<br><strong>Common Name</strong> (e.g. server FQDN or YOUR name) []:localhost<br>Email Address []:</p>\n<p>Please enter the following ‘extra’ attributes<br>to be sent with your certificate request<br>A challenge password []:12345678<br>An optional company name []:cs</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;openssl x509 -req -in ca.csr -signkey ca.key -out ca.crt -days 365</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"生成服务器端证书\"><a href=\"#生成服务器端证书\" class=\"headerlink\" title=\"生成服务器端证书\"></a>生成服务器端证书</h4><p>服务器端需要向 CA 机构申请签名证书，在申请签名证书之前依然是创建自己的 CSR 文件  <strong>与第一次信息填写一样</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;openssl req -new -key server.key -out server.csr -config E:\\Git\\mingw64\\ssl\\openssl.cnf</span><br></pre></td></tr></table></figure>\n<p>向自己的 CA 机构申请证书，签名过程需要 CA 的证书和私钥参与，最终颁发一个带有 CA 签名的证书</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;openssl x509 -req -CA ca.crt -CAkey ca.key -CAcreateserial -in server.csr -out server.crt</span><br></pre></td></tr></table></figure>\n<p>Signature ok<br>subject&#x3D;&#x2F;C&#x3D;AU&#x2F;ST&#x3D;Some-State&#x2F;O&#x3D;Internet Widgits Pty Ltd&#x2F;CN&#x3D;localhost<br>Getting CA Private Key</p>\n<h4 id=\"生成cer文件\"><a href=\"#生成cer文件\" class=\"headerlink\" title=\"生成cer文件\"></a>生成cer文件</h4><p>使用openssl 进行转换</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;openssl x509 -in server.crt -out server.cer -outform der</span><br></pre></td></tr></table></figure>\n\n<p> 生成p12</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">F:\\logs\\http&gt;openssl pkcs12 -export -clcerts -in server.crt -inkey server.key -out client.p12</span><br><span class=\"line\">WARNING: can&#x27;t open config file: /usr/local/ssl/openssl.cnf</span><br><span class=\"line\">Loading &#x27;screen&#x27; into random state - done</span><br><span class=\"line\">Enter Export Password:12345678</span><br><span class=\"line\">Verifying - Enter Export Password:12345678</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<h4 id=\"为服务器端和客户端准备公钥、私钥\"><a href=\"#为服务器端和客户端准备公钥、私钥\" class=\"headerlink\" title=\"为服务器端和客户端准备公钥、私钥\"></a>为服务器端和客户端准备公钥、私钥</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#私钥</span><br><span class=\"line\">&gt;openssl genrsa -out server.key 1024 -config E:\\Git\\mingw64\\ssl\\openssl.cnf</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#公钥</span><br><span class=\"line\">&gt;openssl rsa -in server.key -pubout -out server.pem</span><br></pre></td></tr></table></figure>\n<h4 id=\"生成-CA-证书\"><a href=\"#生成-CA-证书\" class=\"headerlink\" title=\"生成 CA 证书\"></a>生成 CA 证书</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> &lt;!--more--&gt; </span><br><span class=\"line\">#ca私钥</span><br><span class=\"line\">&gt;openssl genrsa -out ca.key 1024 -config E:\\Git\\mingw64\\ssl\\openssl.cnf</span><br></pre></td></tr></table></figure>\n<p> <strong>第一次填写信息</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;openssl req -new -key ca.key -out ca.csr -config E:\\Git\\mingw64\\ssl\\openssl.cnf</span><br></pre></td></tr></table></figure>\n\n<p>Country Name (2 letter code) [AU]:<br>State or Province Name (full name) [Some-State]:<br>Locality Name (eg, city) []:<br>Organization Name (eg, company) [Internet Widgits Pty Ltd]:<br>Organizational Unit Name (eg, section) []:<br><strong>Common Name</strong> (e.g. server FQDN or YOUR name) []:localhost<br>Email Address []:</p>\n<p>Please enter the following ‘extra’ attributes<br>to be sent with your certificate request<br>A challenge password []:12345678<br>An optional company name []:cs</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;openssl x509 -req -in ca.csr -signkey ca.key -out ca.crt -days 365</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"生成服务器端证书\"><a href=\"#生成服务器端证书\" class=\"headerlink\" title=\"生成服务器端证书\"></a>生成服务器端证书</h4><p>服务器端需要向 CA 机构申请签名证书，在申请签名证书之前依然是创建自己的 CSR 文件  <strong>与第一次信息填写一样</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;openssl req -new -key server.key -out server.csr -config E:\\Git\\mingw64\\ssl\\openssl.cnf</span><br></pre></td></tr></table></figure>\n<p>向自己的 CA 机构申请证书，签名过程需要 CA 的证书和私钥参与，最终颁发一个带有 CA 签名的证书</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;openssl x509 -req -CA ca.crt -CAkey ca.key -CAcreateserial -in server.csr -out server.crt</span><br></pre></td></tr></table></figure>\n<p>Signature ok<br>subject&#x3D;&#x2F;C&#x3D;AU&#x2F;ST&#x3D;Some-State&#x2F;O&#x3D;Internet Widgits Pty Ltd&#x2F;CN&#x3D;localhost<br>Getting CA Private Key</p>\n<h4 id=\"生成cer文件\"><a href=\"#生成cer文件\" class=\"headerlink\" title=\"生成cer文件\"></a>生成cer文件</h4><p>使用openssl 进行转换</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;openssl x509 -in server.crt -out server.cer -outform der</span><br></pre></td></tr></table></figure>\n\n<p> 生成p12</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">F:\\logs\\http&gt;openssl pkcs12 -export -clcerts -in server.crt -inkey server.key -out client.p12</span><br><span class=\"line\">WARNING: can&#x27;t open config file: /usr/local/ssl/openssl.cnf</span><br><span class=\"line\">Loading &#x27;screen&#x27; into random state - done</span><br><span class=\"line\">Enter Export Password:12345678</span><br><span class=\"line\">Verifying - Enter Export Password:12345678</span><br></pre></td></tr></table></figure>\n\n"},{"title":"上网","date":"2017-10-27T04:36:33.000Z","_content":"\n### 准备\n  有时候因工作需要，查询资料，下载，就需要上网\n\n  **linux 环境下**\n  * pip \n  * shadowsocks\n\n\n### 安装\npip\n```\nwget https://bootstrap.pypa.io/get-pip.py\npython get-pip.py\n```\nshadowsocks\n```\n$sudo pip install shadowsocks \n```\n <!--more--> \n### 配置\n####  服务端\nss.json\n```json\n{\n    \"server\":\"server_ip\",\n    \"server_port\":8888,\n    \"local_address\": \"127.0.0.1\",\n    \"local_port\":1080,\n    \"password\":\"mypassword\",\n    \"timeout\":300,\n    \"method\":\"aes-256-cfb\",\n    \"fast_open\": false\n}\n```\n多号\n```json\n{\n    \"server\": \"server_ip\",\n    \"local_address\": \"127.0.0.1\",\n    \"local_port\": 1080,\n    \"port_password\": {\n        \"8881\": \"aaaa81\",  \n        \"8882\": \"aaaa82\",\n        \"8883\": \"aaaa83\",\n        \"8884\": \"aaa84\"\n    },\n    \"timeout\": 300,\n    \"method\": \"aes-256-cfb\",\n    \"fast_open\": false\n}\n```\n\n\n**ssserver --help**\n\n` -d start/stop/restart`\n```\nssserver  -c  /xx/ss.json  -d start\n```\n\n#### 客户端\nss.json\n```\n$cat  /xx/ss.json\n{\n    \"server\": \"server_ip\",\n    \"server_port\": 443,\n    \"password\": \"mypassword\",\n    \"method\": \"aes-256-cfb\",\n    \"remarks\": \"\"\n}\n```\n\n**sslocal --help**\n```\nsslocal -c  /xx/ss.json\n```\n\n### 运行原理\n![proxy](http://ojtd6k176.bkt.clouddn.com/proxy-12.56.png)\n* 首先通过SS Local和VPS进行通信，通过Socks5协议进行通信 <br/>\n* SS Local连接到VPS， 并对Socks5中传输的数据进行对称加密传输，传输的数据格式是SS的协议\n* SS Server收到请求后，对数据解密，按照SS协议来解析数据。\n* SS Server根据协议内容转发请求。\n* SS Server获取请求结果后回传给SS Local\n* SS Local获取结果回传给应用程序\n下面2者必须同时满足\n\n1.代理服务器本地可以访问到;\n\n2.代理服务器可以访问目标网站。\n\n### 启动\n小脚本，再次吐槽qt客户端，太重了\n```\n#!/bin/bash\n\nvar=''\ncd /opt/Shadowsocks\nname=`whoami`\n\nif [ ! -d '/home/$name/ss' ];then\n   mkdir ~/ss\nfi\n \nfunction state(){\n  var=$(ps -ef | grep sslocal | grep -v grep | awk '{print $2}')\n}\n\nstate\n\nif test -z $var ;then\n  sslocal -c  $PWD/ss.json >>~/ss/log 2>&1 &\nelse\n  echo \"kill ---$var\"\n  kill -9 $var\n  state\n  if test -z $var ;then rm -r ~/ss ;fi\nfi  \n```\n\n","source":"_posts/network/on-line.md","raw":"---\ntitle: 上网\ndate: 2017-10-27 12:36:33\ntags:\n  - online\ncategories:\n  - other\n---\n\n### 准备\n  有时候因工作需要，查询资料，下载，就需要上网\n\n  **linux 环境下**\n  * pip \n  * shadowsocks\n\n\n### 安装\npip\n```\nwget https://bootstrap.pypa.io/get-pip.py\npython get-pip.py\n```\nshadowsocks\n```\n$sudo pip install shadowsocks \n```\n <!--more--> \n### 配置\n####  服务端\nss.json\n```json\n{\n    \"server\":\"server_ip\",\n    \"server_port\":8888,\n    \"local_address\": \"127.0.0.1\",\n    \"local_port\":1080,\n    \"password\":\"mypassword\",\n    \"timeout\":300,\n    \"method\":\"aes-256-cfb\",\n    \"fast_open\": false\n}\n```\n多号\n```json\n{\n    \"server\": \"server_ip\",\n    \"local_address\": \"127.0.0.1\",\n    \"local_port\": 1080,\n    \"port_password\": {\n        \"8881\": \"aaaa81\",  \n        \"8882\": \"aaaa82\",\n        \"8883\": \"aaaa83\",\n        \"8884\": \"aaa84\"\n    },\n    \"timeout\": 300,\n    \"method\": \"aes-256-cfb\",\n    \"fast_open\": false\n}\n```\n\n\n**ssserver --help**\n\n` -d start/stop/restart`\n```\nssserver  -c  /xx/ss.json  -d start\n```\n\n#### 客户端\nss.json\n```\n$cat  /xx/ss.json\n{\n    \"server\": \"server_ip\",\n    \"server_port\": 443,\n    \"password\": \"mypassword\",\n    \"method\": \"aes-256-cfb\",\n    \"remarks\": \"\"\n}\n```\n\n**sslocal --help**\n```\nsslocal -c  /xx/ss.json\n```\n\n### 运行原理\n![proxy](http://ojtd6k176.bkt.clouddn.com/proxy-12.56.png)\n* 首先通过SS Local和VPS进行通信，通过Socks5协议进行通信 <br/>\n* SS Local连接到VPS， 并对Socks5中传输的数据进行对称加密传输，传输的数据格式是SS的协议\n* SS Server收到请求后，对数据解密，按照SS协议来解析数据。\n* SS Server根据协议内容转发请求。\n* SS Server获取请求结果后回传给SS Local\n* SS Local获取结果回传给应用程序\n下面2者必须同时满足\n\n1.代理服务器本地可以访问到;\n\n2.代理服务器可以访问目标网站。\n\n### 启动\n小脚本，再次吐槽qt客户端，太重了\n```\n#!/bin/bash\n\nvar=''\ncd /opt/Shadowsocks\nname=`whoami`\n\nif [ ! -d '/home/$name/ss' ];then\n   mkdir ~/ss\nfi\n \nfunction state(){\n  var=$(ps -ef | grep sslocal | grep -v grep | awk '{print $2}')\n}\n\nstate\n\nif test -z $var ;then\n  sslocal -c  $PWD/ss.json >>~/ss/log 2>&1 &\nelse\n  echo \"kill ---$var\"\n  kill -9 $var\n  state\n  if test -z $var ;then rm -r ~/ss ;fi\nfi  \n```\n\n","slug":"network/on-line","published":1,"updated":"2022-08-16T13:28:27.418Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtsm000lgwi56qahcx34","content":"<h3 id=\"准备\"><a href=\"#准备\" class=\"headerlink\" title=\"准备\"></a>准备</h3><p>  有时候因工作需要，查询资料，下载，就需要上网</p>\n<p>  <strong>linux 环境下</strong></p>\n<ul>\n<li>pip </li>\n<li>shadowsocks</li>\n</ul>\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><p>pip</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://bootstrap.pypa.io/get-pip.py</span><br><span class=\"line\">python get-pip.py</span><br></pre></td></tr></table></figure>\n<p>shadowsocks</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$sudo pip install shadowsocks </span><br></pre></td></tr></table></figure>\n <span id=\"more\"></span> \n<h3 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h3><h4 id=\"服务端\"><a href=\"#服务端\" class=\"headerlink\" title=\"服务端\"></a>服务端</h4><p>ss.json</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;server&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;server_ip&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;server_port&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">8888</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;local_address&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;127.0.0.1&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;local_port&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">1080</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;password&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;mypassword&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;timeout&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">300</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;method&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;aes-256-cfb&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;fast_open&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<p>多号</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;server&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;server_ip&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;local_address&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;127.0.0.1&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;local_port&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1080</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;port_password&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;8881&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;aaaa81&quot;</span><span class=\"punctuation\">,</span>  </span><br><span class=\"line\">        <span class=\"attr\">&quot;8882&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;aaaa82&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;8883&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;aaaa83&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;8884&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;aaa84&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;timeout&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">300</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;method&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;aes-256-cfb&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;fast_open&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n\n<p><strong>ssserver –help</strong></p>\n<p><code> -d start/stop/restart</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssserver  -c  /xx/ss.json  -d start</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"客户端\"><a href=\"#客户端\" class=\"headerlink\" title=\"客户端\"></a>客户端</h4><p>ss.json</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$cat  /xx/ss.json</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;server&quot;: &quot;server_ip&quot;,</span><br><span class=\"line\">    &quot;server_port&quot;: 443,</span><br><span class=\"line\">    &quot;password&quot;: &quot;mypassword&quot;,</span><br><span class=\"line\">    &quot;method&quot;: &quot;aes-256-cfb&quot;,</span><br><span class=\"line\">    &quot;remarks&quot;: &quot;&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>sslocal –help</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sslocal -c  /xx/ss.json</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"运行原理\"><a href=\"#运行原理\" class=\"headerlink\" title=\"运行原理\"></a>运行原理</h3><p><img src=\"http://ojtd6k176.bkt.clouddn.com/proxy-12.56.png\" alt=\"proxy\"></p>\n<ul>\n<li>首先通过SS Local和VPS进行通信，通过Socks5协议进行通信 <br/></li>\n<li>SS Local连接到VPS， 并对Socks5中传输的数据进行对称加密传输，传输的数据格式是SS的协议</li>\n<li>SS Server收到请求后，对数据解密，按照SS协议来解析数据。</li>\n<li>SS Server根据协议内容转发请求。</li>\n<li>SS Server获取请求结果后回传给SS Local</li>\n<li>SS Local获取结果回传给应用程序<br>下面2者必须同时满足</li>\n</ul>\n<p>1.代理服务器本地可以访问到;</p>\n<p>2.代理服务器可以访问目标网站。</p>\n<h3 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h3><p>小脚本，再次吐槽qt客户端，太重了</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\">var=&#x27;&#x27;</span><br><span class=\"line\">cd /opt/Shadowsocks</span><br><span class=\"line\">name=`whoami`</span><br><span class=\"line\"></span><br><span class=\"line\">if [ ! -d &#x27;/home/$name/ss&#x27; ];then</span><br><span class=\"line\">   mkdir ~/ss</span><br><span class=\"line\">fi</span><br><span class=\"line\"> </span><br><span class=\"line\">function state()&#123;</span><br><span class=\"line\">  var=$(ps -ef | grep sslocal | grep -v grep | awk &#x27;&#123;print $2&#125;&#x27;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">state</span><br><span class=\"line\"></span><br><span class=\"line\">if test -z $var ;then</span><br><span class=\"line\">  sslocal -c  $PWD/ss.json &gt;&gt;~/ss/log 2&gt;&amp;1 &amp;</span><br><span class=\"line\">else</span><br><span class=\"line\">  echo &quot;kill ---$var&quot;</span><br><span class=\"line\">  kill -9 $var</span><br><span class=\"line\">  state</span><br><span class=\"line\">  if test -z $var ;then rm -r ~/ss ;fi</span><br><span class=\"line\">fi  </span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h3 id=\"准备\"><a href=\"#准备\" class=\"headerlink\" title=\"准备\"></a>准备</h3><p>  有时候因工作需要，查询资料，下载，就需要上网</p>\n<p>  <strong>linux 环境下</strong></p>\n<ul>\n<li>pip </li>\n<li>shadowsocks</li>\n</ul>\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><p>pip</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://bootstrap.pypa.io/get-pip.py</span><br><span class=\"line\">python get-pip.py</span><br></pre></td></tr></table></figure>\n<p>shadowsocks</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$sudo pip install shadowsocks </span><br></pre></td></tr></table></figure>","more":"<h3 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h3><h4 id=\"服务端\"><a href=\"#服务端\" class=\"headerlink\" title=\"服务端\"></a>服务端</h4><p>ss.json</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;server&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;server_ip&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;server_port&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">8888</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;local_address&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;127.0.0.1&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;local_port&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">1080</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;password&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;mypassword&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;timeout&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">300</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;method&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;aes-256-cfb&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;fast_open&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<p>多号</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;server&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;server_ip&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;local_address&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;127.0.0.1&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;local_port&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1080</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;port_password&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;8881&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;aaaa81&quot;</span><span class=\"punctuation\">,</span>  </span><br><span class=\"line\">        <span class=\"attr\">&quot;8882&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;aaaa82&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;8883&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;aaaa83&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;8884&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;aaa84&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;timeout&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">300</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;method&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;aes-256-cfb&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;fast_open&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n\n<p><strong>ssserver –help</strong></p>\n<p><code> -d start/stop/restart</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssserver  -c  /xx/ss.json  -d start</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"客户端\"><a href=\"#客户端\" class=\"headerlink\" title=\"客户端\"></a>客户端</h4><p>ss.json</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$cat  /xx/ss.json</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;server&quot;: &quot;server_ip&quot;,</span><br><span class=\"line\">    &quot;server_port&quot;: 443,</span><br><span class=\"line\">    &quot;password&quot;: &quot;mypassword&quot;,</span><br><span class=\"line\">    &quot;method&quot;: &quot;aes-256-cfb&quot;,</span><br><span class=\"line\">    &quot;remarks&quot;: &quot;&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>sslocal –help</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sslocal -c  /xx/ss.json</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"运行原理\"><a href=\"#运行原理\" class=\"headerlink\" title=\"运行原理\"></a>运行原理</h3><p><img src=\"http://ojtd6k176.bkt.clouddn.com/proxy-12.56.png\" alt=\"proxy\"></p>\n<ul>\n<li>首先通过SS Local和VPS进行通信，通过Socks5协议进行通信 <br/></li>\n<li>SS Local连接到VPS， 并对Socks5中传输的数据进行对称加密传输，传输的数据格式是SS的协议</li>\n<li>SS Server收到请求后，对数据解密，按照SS协议来解析数据。</li>\n<li>SS Server根据协议内容转发请求。</li>\n<li>SS Server获取请求结果后回传给SS Local</li>\n<li>SS Local获取结果回传给应用程序<br>下面2者必须同时满足</li>\n</ul>\n<p>1.代理服务器本地可以访问到;</p>\n<p>2.代理服务器可以访问目标网站。</p>\n<h3 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h3><p>小脚本，再次吐槽qt客户端，太重了</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\">var=&#x27;&#x27;</span><br><span class=\"line\">cd /opt/Shadowsocks</span><br><span class=\"line\">name=`whoami`</span><br><span class=\"line\"></span><br><span class=\"line\">if [ ! -d &#x27;/home/$name/ss&#x27; ];then</span><br><span class=\"line\">   mkdir ~/ss</span><br><span class=\"line\">fi</span><br><span class=\"line\"> </span><br><span class=\"line\">function state()&#123;</span><br><span class=\"line\">  var=$(ps -ef | grep sslocal | grep -v grep | awk &#x27;&#123;print $2&#125;&#x27;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">state</span><br><span class=\"line\"></span><br><span class=\"line\">if test -z $var ;then</span><br><span class=\"line\">  sslocal -c  $PWD/ss.json &gt;&gt;~/ss/log 2&gt;&amp;1 &amp;</span><br><span class=\"line\">else</span><br><span class=\"line\">  echo &quot;kill ---$var&quot;</span><br><span class=\"line\">  kill -9 $var</span><br><span class=\"line\">  state</span><br><span class=\"line\">  if test -z $var ;then rm -r ~/ss ;fi</span><br><span class=\"line\">fi  </span><br></pre></td></tr></table></figure>"},{"title":"内网穿透","date":"2017-11-19T07:12:22.000Z","_content":"\n### ngrok\n\n提供内网穿透服务，可以在自己主机部署服务供外网访问\n\n同类产品： [花生壳](https://hsk.oray.com/download/) ，[nat123](http://www.nat123.com/Pages_2_32.jsp)\n\n官网 https://ngrok.com/\n\ngithub https://github.com/inconshreveable/ngrok\n\n### 安装\n\n官网注册[获取authtoken](https://dashboard.ngrok.com/get-started)\n\n生成配置\n\n```\n./ngrok authtoken   ********\n`\n```\n\n <!--more--> \n\n> Authtoken saved to configuration file:***.ngrok2/ngrok.yml\n>\n> 默认路径 https://ngrok.com/docs#default-config-location\n>\n> 运行\n>\n> ```\n> ./ngrok http 8010\n> ```\n>\n> \n>\n> 访问 http://localhost:4040/\n\n### 自定义\n\n隧道定义参数详解 https://ngrok.com/docs#tunnel-definitions\n\n每个隧道都必须定义\n\n- proto 需要 所有 隧道协议名称，中的一个http，tcp，tls\n- addr 需要 所有 转发流量到这个本地端口号或网络地址\n\n示例配置 https://ngrok.com/docs#config-examples\n\n**ngrok.cfg**\n\n```\nauthtoken: **************\ntunnels:\n  httpbin:\n    proto: http\n    addr: 8090\n    #subdomain: dev.com #子域名请求 收费\n```\n\n\n\n启动\n\n```\n#默认配置\n./ngrok start httpbin\n#指定额外配置文件\n./ngrok start  -config ./ngrok.cfg   httpbin\n```","source":"_posts/network/内网穿透.md","raw":"---\ntitle: 内网穿透\ndate: 2017-11-19 15:12:22\ntags:\n - ngrok\n - 内网穿透\ncategories:\n  - other\n  - network\n---\n\n### ngrok\n\n提供内网穿透服务，可以在自己主机部署服务供外网访问\n\n同类产品： [花生壳](https://hsk.oray.com/download/) ，[nat123](http://www.nat123.com/Pages_2_32.jsp)\n\n官网 https://ngrok.com/\n\ngithub https://github.com/inconshreveable/ngrok\n\n### 安装\n\n官网注册[获取authtoken](https://dashboard.ngrok.com/get-started)\n\n生成配置\n\n```\n./ngrok authtoken   ********\n`\n```\n\n <!--more--> \n\n> Authtoken saved to configuration file:***.ngrok2/ngrok.yml\n>\n> 默认路径 https://ngrok.com/docs#default-config-location\n>\n> 运行\n>\n> ```\n> ./ngrok http 8010\n> ```\n>\n> \n>\n> 访问 http://localhost:4040/\n\n### 自定义\n\n隧道定义参数详解 https://ngrok.com/docs#tunnel-definitions\n\n每个隧道都必须定义\n\n- proto 需要 所有 隧道协议名称，中的一个http，tcp，tls\n- addr 需要 所有 转发流量到这个本地端口号或网络地址\n\n示例配置 https://ngrok.com/docs#config-examples\n\n**ngrok.cfg**\n\n```\nauthtoken: **************\ntunnels:\n  httpbin:\n    proto: http\n    addr: 8090\n    #subdomain: dev.com #子域名请求 收费\n```\n\n\n\n启动\n\n```\n#默认配置\n./ngrok start httpbin\n#指定额外配置文件\n./ngrok start  -config ./ngrok.cfg   httpbin\n```","slug":"network/内网穿透","published":1,"updated":"2022-06-03T08:29:27.560Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtsp000pgwi52qm966ib","content":"<h3 id=\"ngrok\"><a href=\"#ngrok\" class=\"headerlink\" title=\"ngrok\"></a>ngrok</h3><p>提供内网穿透服务，可以在自己主机部署服务供外网访问</p>\n<p>同类产品： <a href=\"https://hsk.oray.com/download/\">花生壳</a> ，<a href=\"http://www.nat123.com/Pages_2_32.jsp\">nat123</a></p>\n<p>官网 <a href=\"https://ngrok.com/\">https://ngrok.com/</a></p>\n<p>github <a href=\"https://github.com/inconshreveable/ngrok\">https://github.com/inconshreveable/ngrok</a></p>\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><p>官网注册<a href=\"https://dashboard.ngrok.com/get-started\">获取authtoken</a></p>\n<p>生成配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./ngrok authtoken   ********</span><br><span class=\"line\">`</span><br></pre></td></tr></table></figure>\n\n <span id=\"more\"></span> \n\n<blockquote>\n<p>Authtoken saved to configuration file:***.ngrok2&#x2F;ngrok.yml</p>\n<p>默认路径 <a href=\"https://ngrok.com/docs#default-config-location\">https://ngrok.com/docs#default-config-location</a></p>\n<p>运行</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./ngrok http 8010</span><br></pre></td></tr></table></figure>\n\n\n\n<p>访问 <a href=\"http://localhost:4040/\">http://localhost:4040/</a></p>\n</blockquote>\n<h3 id=\"自定义\"><a href=\"#自定义\" class=\"headerlink\" title=\"自定义\"></a>自定义</h3><p>隧道定义参数详解 <a href=\"https://ngrok.com/docs#tunnel-definitions\">https://ngrok.com/docs#tunnel-definitions</a></p>\n<p>每个隧道都必须定义</p>\n<ul>\n<li>proto 需要 所有 隧道协议名称，中的一个http，tcp，tls</li>\n<li>addr 需要 所有 转发流量到这个本地端口号或网络地址</li>\n</ul>\n<p>示例配置 <a href=\"https://ngrok.com/docs#config-examples\">https://ngrok.com/docs#config-examples</a></p>\n<p><strong>ngrok.cfg</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">authtoken: **************</span><br><span class=\"line\">tunnels:</span><br><span class=\"line\">  httpbin:</span><br><span class=\"line\">    proto: http</span><br><span class=\"line\">    addr: 8090</span><br><span class=\"line\">    #subdomain: dev.com #子域名请求 收费</span><br></pre></td></tr></table></figure>\n\n\n\n<p>启动</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#默认配置</span><br><span class=\"line\">./ngrok start httpbin</span><br><span class=\"line\">#指定额外配置文件</span><br><span class=\"line\">./ngrok start  -config ./ngrok.cfg   httpbin</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<h3 id=\"ngrok\"><a href=\"#ngrok\" class=\"headerlink\" title=\"ngrok\"></a>ngrok</h3><p>提供内网穿透服务，可以在自己主机部署服务供外网访问</p>\n<p>同类产品： <a href=\"https://hsk.oray.com/download/\">花生壳</a> ，<a href=\"http://www.nat123.com/Pages_2_32.jsp\">nat123</a></p>\n<p>官网 <a href=\"https://ngrok.com/\">https://ngrok.com/</a></p>\n<p>github <a href=\"https://github.com/inconshreveable/ngrok\">https://github.com/inconshreveable/ngrok</a></p>\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><p>官网注册<a href=\"https://dashboard.ngrok.com/get-started\">获取authtoken</a></p>\n<p>生成配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./ngrok authtoken   ********</span><br><span class=\"line\">`</span><br></pre></td></tr></table></figure>","more":"<blockquote>\n<p>Authtoken saved to configuration file:***.ngrok2&#x2F;ngrok.yml</p>\n<p>默认路径 <a href=\"https://ngrok.com/docs#default-config-location\">https://ngrok.com/docs#default-config-location</a></p>\n<p>运行</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./ngrok http 8010</span><br></pre></td></tr></table></figure>\n\n\n\n<p>访问 <a href=\"http://localhost:4040/\">http://localhost:4040/</a></p>\n</blockquote>\n<h3 id=\"自定义\"><a href=\"#自定义\" class=\"headerlink\" title=\"自定义\"></a>自定义</h3><p>隧道定义参数详解 <a href=\"https://ngrok.com/docs#tunnel-definitions\">https://ngrok.com/docs#tunnel-definitions</a></p>\n<p>每个隧道都必须定义</p>\n<ul>\n<li>proto 需要 所有 隧道协议名称，中的一个http，tcp，tls</li>\n<li>addr 需要 所有 转发流量到这个本地端口号或网络地址</li>\n</ul>\n<p>示例配置 <a href=\"https://ngrok.com/docs#config-examples\">https://ngrok.com/docs#config-examples</a></p>\n<p><strong>ngrok.cfg</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">authtoken: **************</span><br><span class=\"line\">tunnels:</span><br><span class=\"line\">  httpbin:</span><br><span class=\"line\">    proto: http</span><br><span class=\"line\">    addr: 8090</span><br><span class=\"line\">    #subdomain: dev.com #子域名请求 收费</span><br></pre></td></tr></table></figure>\n\n\n\n<p>启动</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#默认配置</span><br><span class=\"line\">./ngrok start httpbin</span><br><span class=\"line\">#指定额外配置文件</span><br><span class=\"line\">./ngrok start  -config ./ngrok.cfg   httpbin</span><br></pre></td></tr></table></figure>"},{"title":"avd","date":"2017-08-12T04:54:48.000Z","_content":"\n### 创建AVD失败\n \n see log 查看日志\n ```\n WARN - vdmanager.AvdManagerConnection - Failed to create the SD card. \n WARN - vdmanager.AvdManagerConnection - Failed to create sdcard in the     AVD folder.\n ```\n \n#### 目录权限\n```\ncs@debian:~/repository/Android/sdk$ chmod +x tools/*\ncs@debian:~/repository/Android/sdk$ chmod +x platform-tools/*\n```\n\n#### 安装\n```\nsudo apt-get install  lib32z1 lib32ncurses5 #代替ia32-libs  \n```\n创建提示\n>/sdk/emulator/mksdcard: error while loading shared libraries: libgcc_s.so.1: cannot open shared object file: No such file or directory \n\n```\ncs@debian:~$ locate libgcc_s.so.1\n/lib/x86_64-linux-gnu/libgcc_s.so.1\n```\n 可以看到系统x86_64 不支持32\n> WARN - vdmanager.AvdManagerConnection - /home/cs/repository/Android/sdk/emulator/mksdcard: error while loading shared libraries: libgcc_s.so.1: cannot open shared object file: No such file or directory \nerror while loading shared libraries: libgcc_s.so.1: wrong ELF class: ELFCLASS64 \n\n <!--more--> \n\n搜索[libgcc_s.so.1](https://pkgs.org/download/libgcc_s.so.1)\n\n没有找到deb,下载的rpm\n```\nrpm2cpio  libgcc-4.1.2-55.el5.i386.rpm  | cpio -div\n```\n解压后\n```\nsudo ln -s /home/cs/repository/Android/sdk/lib32/libgcc_s.so.1  /lib/\n```\n创建AVD成功**等待近2分钟后出现**\n>Error while waiting for device: Timed out after 300seconds waiting for emulator to come online.\n\n#### 最终解决方法\n**SDK tools > SDK Tools** 勾选 **Android Emulator** \n\n**虚拟化应用** *VirtualBox* *docker* 等，与avd不能同时开启\n\n **Tools - Android** 勾选取消 *Enable ADB Integration* （对我无用）\n \nGraphics选项，**Software**而不是Automatic或Hardware","source":"_posts/other/avd.md","raw":"---\ntitle: avd\ndate: 2017-08-12 12:54:48\ntags: \n - android\n - Simulator\ncategories:\n - linux \n - install\n---\n\n### 创建AVD失败\n \n see log 查看日志\n ```\n WARN - vdmanager.AvdManagerConnection - Failed to create the SD card. \n WARN - vdmanager.AvdManagerConnection - Failed to create sdcard in the     AVD folder.\n ```\n \n#### 目录权限\n```\ncs@debian:~/repository/Android/sdk$ chmod +x tools/*\ncs@debian:~/repository/Android/sdk$ chmod +x platform-tools/*\n```\n\n#### 安装\n```\nsudo apt-get install  lib32z1 lib32ncurses5 #代替ia32-libs  \n```\n创建提示\n>/sdk/emulator/mksdcard: error while loading shared libraries: libgcc_s.so.1: cannot open shared object file: No such file or directory \n\n```\ncs@debian:~$ locate libgcc_s.so.1\n/lib/x86_64-linux-gnu/libgcc_s.so.1\n```\n 可以看到系统x86_64 不支持32\n> WARN - vdmanager.AvdManagerConnection - /home/cs/repository/Android/sdk/emulator/mksdcard: error while loading shared libraries: libgcc_s.so.1: cannot open shared object file: No such file or directory \nerror while loading shared libraries: libgcc_s.so.1: wrong ELF class: ELFCLASS64 \n\n <!--more--> \n\n搜索[libgcc_s.so.1](https://pkgs.org/download/libgcc_s.so.1)\n\n没有找到deb,下载的rpm\n```\nrpm2cpio  libgcc-4.1.2-55.el5.i386.rpm  | cpio -div\n```\n解压后\n```\nsudo ln -s /home/cs/repository/Android/sdk/lib32/libgcc_s.so.1  /lib/\n```\n创建AVD成功**等待近2分钟后出现**\n>Error while waiting for device: Timed out after 300seconds waiting for emulator to come online.\n\n#### 最终解决方法\n**SDK tools > SDK Tools** 勾选 **Android Emulator** \n\n**虚拟化应用** *VirtualBox* *docker* 等，与avd不能同时开启\n\n **Tools - Android** 勾选取消 *Enable ADB Integration* （对我无用）\n \nGraphics选项，**Software**而不是Automatic或Hardware","slug":"other/avd","published":1,"updated":"2022-06-03T08:34:27.475Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtsq000rgwi58of44yca","content":"<h3 id=\"创建AVD失败\"><a href=\"#创建AVD失败\" class=\"headerlink\" title=\"创建AVD失败\"></a>创建AVD失败</h3><p> see log 查看日志<br> <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">WARN - vdmanager.AvdManagerConnection - Failed to create the SD card. </span><br><span class=\"line\">WARN - vdmanager.AvdManagerConnection - Failed to create sdcard in the     AVD folder.</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"目录权限\"><a href=\"#目录权限\" class=\"headerlink\" title=\"目录权限\"></a>目录权限</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/repository/Android/sdk$ chmod +x tools/*</span><br><span class=\"line\">cs@debian:~/repository/Android/sdk$ chmod +x platform-tools/*</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install  lib32z1 lib32ncurses5 #代替ia32-libs  </span><br></pre></td></tr></table></figure>\n<p>创建提示</p>\n<blockquote>\n<p>&#x2F;sdk&#x2F;emulator&#x2F;mksdcard: error while loading shared libraries: libgcc_s.so.1: cannot open shared object file: No such file or directory </p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ locate libgcc_s.so.1</span><br><span class=\"line\">/lib/x86_64-linux-gnu/libgcc_s.so.1</span><br></pre></td></tr></table></figure>\n<p> 可以看到系统x86_64 不支持32</p>\n<blockquote>\n<p>WARN - vdmanager.AvdManagerConnection - &#x2F;home&#x2F;cs&#x2F;repository&#x2F;Android&#x2F;sdk&#x2F;emulator&#x2F;mksdcard: error while loading shared libraries: libgcc_s.so.1: cannot open shared object file: No such file or directory<br>error while loading shared libraries: libgcc_s.so.1: wrong ELF class: ELFCLASS64 </p>\n</blockquote>\n <span id=\"more\"></span> \n\n<p>搜索<a href=\"https://pkgs.org/download/libgcc_s.so.1\">libgcc_s.so.1</a></p>\n<p>没有找到deb,下载的rpm</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm2cpio  libgcc-4.1.2-55.el5.i386.rpm  | cpio -div</span><br></pre></td></tr></table></figure>\n<p>解压后</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ln -s /home/cs/repository/Android/sdk/lib32/libgcc_s.so.1  /lib/</span><br></pre></td></tr></table></figure>\n<p>创建AVD成功<strong>等待近2分钟后出现</strong></p>\n<blockquote>\n<p>Error while waiting for device: Timed out after 300seconds waiting for emulator to come online.</p>\n</blockquote>\n<h4 id=\"最终解决方法\"><a href=\"#最终解决方法\" class=\"headerlink\" title=\"最终解决方法\"></a>最终解决方法</h4><p><strong>SDK tools &gt; SDK Tools</strong> 勾选 <strong>Android Emulator</strong> </p>\n<p><strong>虚拟化应用</strong> <em>VirtualBox</em> <em>docker</em> 等，与avd不能同时开启</p>\n<p> <strong>Tools - Android</strong> 勾选取消 <em>Enable ADB Integration</em> （对我无用）</p>\n<p>Graphics选项，<strong>Software</strong>而不是Automatic或Hardware</p>\n","site":{"data":{}},"excerpt":"<h3 id=\"创建AVD失败\"><a href=\"#创建AVD失败\" class=\"headerlink\" title=\"创建AVD失败\"></a>创建AVD失败</h3><p> see log 查看日志<br> <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">WARN - vdmanager.AvdManagerConnection - Failed to create the SD card. </span><br><span class=\"line\">WARN - vdmanager.AvdManagerConnection - Failed to create sdcard in the     AVD folder.</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"目录权限\"><a href=\"#目录权限\" class=\"headerlink\" title=\"目录权限\"></a>目录权限</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/repository/Android/sdk$ chmod +x tools/*</span><br><span class=\"line\">cs@debian:~/repository/Android/sdk$ chmod +x platform-tools/*</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install  lib32z1 lib32ncurses5 #代替ia32-libs  </span><br></pre></td></tr></table></figure>\n<p>创建提示</p>\n<blockquote>\n<p>&#x2F;sdk&#x2F;emulator&#x2F;mksdcard: error while loading shared libraries: libgcc_s.so.1: cannot open shared object file: No such file or directory </p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ locate libgcc_s.so.1</span><br><span class=\"line\">/lib/x86_64-linux-gnu/libgcc_s.so.1</span><br></pre></td></tr></table></figure>\n<p> 可以看到系统x86_64 不支持32</p>\n<blockquote>\n<p>WARN - vdmanager.AvdManagerConnection - &#x2F;home&#x2F;cs&#x2F;repository&#x2F;Android&#x2F;sdk&#x2F;emulator&#x2F;mksdcard: error while loading shared libraries: libgcc_s.so.1: cannot open shared object file: No such file or directory<br>error while loading shared libraries: libgcc_s.so.1: wrong ELF class: ELFCLASS64 </p>\n</blockquote>","more":"<p>搜索<a href=\"https://pkgs.org/download/libgcc_s.so.1\">libgcc_s.so.1</a></p>\n<p>没有找到deb,下载的rpm</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm2cpio  libgcc-4.1.2-55.el5.i386.rpm  | cpio -div</span><br></pre></td></tr></table></figure>\n<p>解压后</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ln -s /home/cs/repository/Android/sdk/lib32/libgcc_s.so.1  /lib/</span><br></pre></td></tr></table></figure>\n<p>创建AVD成功<strong>等待近2分钟后出现</strong></p>\n<blockquote>\n<p>Error while waiting for device: Timed out after 300seconds waiting for emulator to come online.</p>\n</blockquote>\n<h4 id=\"最终解决方法\"><a href=\"#最终解决方法\" class=\"headerlink\" title=\"最终解决方法\"></a>最终解决方法</h4><p><strong>SDK tools &gt; SDK Tools</strong> 勾选 <strong>Android Emulator</strong> </p>\n<p><strong>虚拟化应用</strong> <em>VirtualBox</em> <em>docker</em> 等，与avd不能同时开启</p>\n<p> <strong>Tools - Android</strong> 勾选取消 <em>Enable ADB Integration</em> （对我无用）</p>\n<p>Graphics选项，<strong>Software</strong>而不是Automatic或Hardware</p>"},{"title":"git pull","date":"2017-10-05T04:36:33.000Z","_content":"### pull\n稀疏检出*sparse checkout*\n <!--more--> \n```\n#!/bin/bash\n\nprint_help() {\n  cat <<EOF\n  use params \n   -h , --help   说明   不支持分支\n   -u , --url   *必须，下载文件的链接（如https:://github.io/xx/tree/master/a/b ,下载b）\n  \n\nEOF\n}\n\nfunction src(){\n   if [[ \"$1\" =~ \"github.com\" ]] || [[ \"$1\" =~ \"gitee.com\" ]];then\n     echo \"downloadUrl--> $1\"\n   else \n     echo \"不支持\"\n     exit 1\n   fi\n}\n\nwhile [ $# -ge 0 ]; do\n    case $1 in\n        -h|--help)\n           print_help  \n           exit 1\n            ;;\n        -u|--url)\n              src $2\n              break \n            ;;\n         *  )\n           echo \"use param -h or --help !\"  \n           exit 1\n            ;;\n    esac\ndone\nfunction type(){\n   uri=$(echo $1 | grep \"/tree/master/\" | grep -v grep)\n   echo \"---$uri\"\n   if [[ $uri != \"\" ]];then\n     echo \"-------/tree/master\"\n     uri=${url%/tree/master*}\".git\"\n     down=${url#*/tree/master/}\n   else\n     echo \"-------/blob/master\"\n     uri=$(echo $1 |grep -v grep | grep \"/blob/master/\")\n     if [[ $uri != \"\" ]];then\n       uri=${url%/blob/master*}\".git\"\n       down=${url#*/blob/master/}\n     else\n       echo \"只支持拉取master文件下载\"\n       exit 1\n     fi\n   fi \n}\n\nurl=$2\n\nfile=${url##*/}\n\nuri=\ndown=\ntype $2\n \n\nif [ ! -f \"$file\" ];then\n\tmkdir $file\nfi\ncd $file\n\ngit init\necho \"==================添加 源===================\"\ngit remote add -f origin $uri \n#稀疏检出\ngit config core.sparsecheckout true\n#拉取文件\necho \"$down\">>.git/info/sparse-checkout\necho \"==================开始拉取===================\"\ngit pull origin master\n \nrm -rf .git\nmv $file/*  . && rm -r $file\n\n\necho \"==================$PWD===================\"\t\n```\n>利用git稀疏检出拉取部分文件\n\n### js实现下载\n[kinolien gitzip ](http://kinolien.github.io/gitzip/)","source":"_posts/tool/git-pull.md","raw":"---\ntitle: git pull\ndate: 2017-10-05 12:36:33\ntags: git\ncategories: tool\n---\n### pull\n稀疏检出*sparse checkout*\n <!--more--> \n```\n#!/bin/bash\n\nprint_help() {\n  cat <<EOF\n  use params \n   -h , --help   说明   不支持分支\n   -u , --url   *必须，下载文件的链接（如https:://github.io/xx/tree/master/a/b ,下载b）\n  \n\nEOF\n}\n\nfunction src(){\n   if [[ \"$1\" =~ \"github.com\" ]] || [[ \"$1\" =~ \"gitee.com\" ]];then\n     echo \"downloadUrl--> $1\"\n   else \n     echo \"不支持\"\n     exit 1\n   fi\n}\n\nwhile [ $# -ge 0 ]; do\n    case $1 in\n        -h|--help)\n           print_help  \n           exit 1\n            ;;\n        -u|--url)\n              src $2\n              break \n            ;;\n         *  )\n           echo \"use param -h or --help !\"  \n           exit 1\n            ;;\n    esac\ndone\nfunction type(){\n   uri=$(echo $1 | grep \"/tree/master/\" | grep -v grep)\n   echo \"---$uri\"\n   if [[ $uri != \"\" ]];then\n     echo \"-------/tree/master\"\n     uri=${url%/tree/master*}\".git\"\n     down=${url#*/tree/master/}\n   else\n     echo \"-------/blob/master\"\n     uri=$(echo $1 |grep -v grep | grep \"/blob/master/\")\n     if [[ $uri != \"\" ]];then\n       uri=${url%/blob/master*}\".git\"\n       down=${url#*/blob/master/}\n     else\n       echo \"只支持拉取master文件下载\"\n       exit 1\n     fi\n   fi \n}\n\nurl=$2\n\nfile=${url##*/}\n\nuri=\ndown=\ntype $2\n \n\nif [ ! -f \"$file\" ];then\n\tmkdir $file\nfi\ncd $file\n\ngit init\necho \"==================添加 源===================\"\ngit remote add -f origin $uri \n#稀疏检出\ngit config core.sparsecheckout true\n#拉取文件\necho \"$down\">>.git/info/sparse-checkout\necho \"==================开始拉取===================\"\ngit pull origin master\n \nrm -rf .git\nmv $file/*  . && rm -r $file\n\n\necho \"==================$PWD===================\"\t\n```\n>利用git稀疏检出拉取部分文件\n\n### js实现下载\n[kinolien gitzip ](http://kinolien.github.io/gitzip/)","slug":"tool/git-pull","published":1,"updated":"2022-08-21T10:22:40.047Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtsr000vgwi54ydp7lvj","content":"<h3 id=\"pull\"><a href=\"#pull\" class=\"headerlink\" title=\"pull\"></a>pull</h3><p>稀疏检出<em>sparse checkout</em><br> <span id=\"more\"></span> </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\">print_help() &#123;</span><br><span class=\"line\">  cat &lt;&lt;EOF</span><br><span class=\"line\">  use params </span><br><span class=\"line\">   -h , --help   说明   不支持分支</span><br><span class=\"line\">   -u , --url   *必须，下载文件的链接（如https:://github.io/xx/tree/master/a/b ,下载b）</span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\">EOF</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function src()&#123;</span><br><span class=\"line\">   if [[ &quot;$1&quot; =~ &quot;github.com&quot; ]] || [[ &quot;$1&quot; =~ &quot;gitee.com&quot; ]];then</span><br><span class=\"line\">     echo &quot;downloadUrl--&gt; $1&quot;</span><br><span class=\"line\">   else </span><br><span class=\"line\">     echo &quot;不支持&quot;</span><br><span class=\"line\">     exit 1</span><br><span class=\"line\">   fi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">while [ $# -ge 0 ]; do</span><br><span class=\"line\">    case $1 in</span><br><span class=\"line\">        -h|--help)</span><br><span class=\"line\">           print_help  </span><br><span class=\"line\">           exit 1</span><br><span class=\"line\">            ;;</span><br><span class=\"line\">        -u|--url)</span><br><span class=\"line\">              src $2</span><br><span class=\"line\">              break </span><br><span class=\"line\">            ;;</span><br><span class=\"line\">         *  )</span><br><span class=\"line\">           echo &quot;use param -h or --help !&quot;  </span><br><span class=\"line\">           exit 1</span><br><span class=\"line\">            ;;</span><br><span class=\"line\">    esac</span><br><span class=\"line\">done</span><br><span class=\"line\">function type()&#123;</span><br><span class=\"line\">   uri=$(echo $1 | grep &quot;/tree/master/&quot; | grep -v grep)</span><br><span class=\"line\">   echo &quot;---$uri&quot;</span><br><span class=\"line\">   if [[ $uri != &quot;&quot; ]];then</span><br><span class=\"line\">     echo &quot;-------/tree/master&quot;</span><br><span class=\"line\">     uri=$&#123;url%/tree/master*&#125;&quot;.git&quot;</span><br><span class=\"line\">     down=$&#123;url#*/tree/master/&#125;</span><br><span class=\"line\">   else</span><br><span class=\"line\">     echo &quot;-------/blob/master&quot;</span><br><span class=\"line\">     uri=$(echo $1 |grep -v grep | grep &quot;/blob/master/&quot;)</span><br><span class=\"line\">     if [[ $uri != &quot;&quot; ]];then</span><br><span class=\"line\">       uri=$&#123;url%/blob/master*&#125;&quot;.git&quot;</span><br><span class=\"line\">       down=$&#123;url#*/blob/master/&#125;</span><br><span class=\"line\">     else</span><br><span class=\"line\">       echo &quot;只支持拉取master文件下载&quot;</span><br><span class=\"line\">       exit 1</span><br><span class=\"line\">     fi</span><br><span class=\"line\">   fi </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">url=$2</span><br><span class=\"line\"></span><br><span class=\"line\">file=$&#123;url##*/&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">uri=</span><br><span class=\"line\">down=</span><br><span class=\"line\">type $2</span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">if [ ! -f &quot;$file&quot; ];then</span><br><span class=\"line\">\tmkdir $file</span><br><span class=\"line\">fi</span><br><span class=\"line\">cd $file</span><br><span class=\"line\"></span><br><span class=\"line\">git init</span><br><span class=\"line\">echo &quot;==================添加 源===================&quot;</span><br><span class=\"line\">git remote add -f origin $uri </span><br><span class=\"line\">#稀疏检出</span><br><span class=\"line\">git config core.sparsecheckout true</span><br><span class=\"line\">#拉取文件</span><br><span class=\"line\">echo &quot;$down&quot;&gt;&gt;.git/info/sparse-checkout</span><br><span class=\"line\">echo &quot;==================开始拉取===================&quot;</span><br><span class=\"line\">git pull origin master</span><br><span class=\"line\"> </span><br><span class=\"line\">rm -rf .git</span><br><span class=\"line\">mv $file/*  . &amp;&amp; rm -r $file</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;==================$PWD===================&quot;\t</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>利用git稀疏检出拉取部分文件</p>\n</blockquote>\n<h3 id=\"js实现下载\"><a href=\"#js实现下载\" class=\"headerlink\" title=\"js实现下载\"></a>js实现下载</h3><p><a href=\"http://kinolien.github.io/gitzip/\">kinolien gitzip </a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"pull\"><a href=\"#pull\" class=\"headerlink\" title=\"pull\"></a>pull</h3><p>稀疏检出<em>sparse checkout</em><br>","more":"</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\">print_help() &#123;</span><br><span class=\"line\">  cat &lt;&lt;EOF</span><br><span class=\"line\">  use params </span><br><span class=\"line\">   -h , --help   说明   不支持分支</span><br><span class=\"line\">   -u , --url   *必须，下载文件的链接（如https:://github.io/xx/tree/master/a/b ,下载b）</span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\">EOF</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function src()&#123;</span><br><span class=\"line\">   if [[ &quot;$1&quot; =~ &quot;github.com&quot; ]] || [[ &quot;$1&quot; =~ &quot;gitee.com&quot; ]];then</span><br><span class=\"line\">     echo &quot;downloadUrl--&gt; $1&quot;</span><br><span class=\"line\">   else </span><br><span class=\"line\">     echo &quot;不支持&quot;</span><br><span class=\"line\">     exit 1</span><br><span class=\"line\">   fi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">while [ $# -ge 0 ]; do</span><br><span class=\"line\">    case $1 in</span><br><span class=\"line\">        -h|--help)</span><br><span class=\"line\">           print_help  </span><br><span class=\"line\">           exit 1</span><br><span class=\"line\">            ;;</span><br><span class=\"line\">        -u|--url)</span><br><span class=\"line\">              src $2</span><br><span class=\"line\">              break </span><br><span class=\"line\">            ;;</span><br><span class=\"line\">         *  )</span><br><span class=\"line\">           echo &quot;use param -h or --help !&quot;  </span><br><span class=\"line\">           exit 1</span><br><span class=\"line\">            ;;</span><br><span class=\"line\">    esac</span><br><span class=\"line\">done</span><br><span class=\"line\">function type()&#123;</span><br><span class=\"line\">   uri=$(echo $1 | grep &quot;/tree/master/&quot; | grep -v grep)</span><br><span class=\"line\">   echo &quot;---$uri&quot;</span><br><span class=\"line\">   if [[ $uri != &quot;&quot; ]];then</span><br><span class=\"line\">     echo &quot;-------/tree/master&quot;</span><br><span class=\"line\">     uri=$&#123;url%/tree/master*&#125;&quot;.git&quot;</span><br><span class=\"line\">     down=$&#123;url#*/tree/master/&#125;</span><br><span class=\"line\">   else</span><br><span class=\"line\">     echo &quot;-------/blob/master&quot;</span><br><span class=\"line\">     uri=$(echo $1 |grep -v grep | grep &quot;/blob/master/&quot;)</span><br><span class=\"line\">     if [[ $uri != &quot;&quot; ]];then</span><br><span class=\"line\">       uri=$&#123;url%/blob/master*&#125;&quot;.git&quot;</span><br><span class=\"line\">       down=$&#123;url#*/blob/master/&#125;</span><br><span class=\"line\">     else</span><br><span class=\"line\">       echo &quot;只支持拉取master文件下载&quot;</span><br><span class=\"line\">       exit 1</span><br><span class=\"line\">     fi</span><br><span class=\"line\">   fi </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">url=$2</span><br><span class=\"line\"></span><br><span class=\"line\">file=$&#123;url##*/&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">uri=</span><br><span class=\"line\">down=</span><br><span class=\"line\">type $2</span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">if [ ! -f &quot;$file&quot; ];then</span><br><span class=\"line\">\tmkdir $file</span><br><span class=\"line\">fi</span><br><span class=\"line\">cd $file</span><br><span class=\"line\"></span><br><span class=\"line\">git init</span><br><span class=\"line\">echo &quot;==================添加 源===================&quot;</span><br><span class=\"line\">git remote add -f origin $uri </span><br><span class=\"line\">#稀疏检出</span><br><span class=\"line\">git config core.sparsecheckout true</span><br><span class=\"line\">#拉取文件</span><br><span class=\"line\">echo &quot;$down&quot;&gt;&gt;.git/info/sparse-checkout</span><br><span class=\"line\">echo &quot;==================开始拉取===================&quot;</span><br><span class=\"line\">git pull origin master</span><br><span class=\"line\"> </span><br><span class=\"line\">rm -rf .git</span><br><span class=\"line\">mv $file/*  . &amp;&amp; rm -r $file</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;==================$PWD===================&quot;\t</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>利用git稀疏检出拉取部分文件</p>\n</blockquote>\n<h3 id=\"js实现下载\"><a href=\"#js实现下载\" class=\"headerlink\" title=\"js实现下载\"></a>js实现下载</h3><p><a href=\"http://kinolien.github.io/gitzip/\">kinolien gitzip </a></p>"},{"title":"git server 搭建","date":"2017-10-10T11:36:33.000Z","_content":"## 准备\n*    ssh\n*    git \n\n\n## gitosis\n### 添加用户\n仓库服务器执行\n```\nuseradd git\nmkdir -p /home/git\nchown -R git:git /home/git\n```\n\n密钥\n```\ncp  ~/.ssh/id_rsa.pub   /tmp/git.pub\n```\n <!--more--> \n### 安装\n\n```\ngit clone git://github.com/res0nat0r/gitosis.git\ncd gitosis\npython setup.py install\n```\n\n初始化\n```\nsu  git\ngitosis-init < ~/.ssh/id_rsa.pub\n```\n\n### 管理\n拉取\n```\n$git clone git@192.168.16.232:repositories/gitosis-admin.git\n$ tree -L 2 gitosis-admin\ngitosis-admin\n├── gitosis.conf\n└── keydir\n    └── git@ubuntu.pub\n```\n配置密钥\n```\ncp ~/.ssh/id_rsa.pub  gitosis-admin/keydir/cs.pub\n```\n添加权限 **gitosis.conf**\n```\n[group dev]  \nmembers = cs #这里的cs对上面公匙cs.pub文件名cs  \nwritable = test #项目名test\n```\n\n### <span id=\"pull\">测试拉取</span>\n\n```\nmkdir  test && cd test\necho \"测试test仓库\">rep\ngit init\ngit add .\ngit  commit -am \"add test\"\ngit remote add origin git@192.168.16.232:test.git\ngit  push origin master\n```\n> 提示要密码 <br />\n设置密码（root用户操作）\n```\npasswd gits\n2次 123456\n```\n或\n```\nsu gits\necho \"你的密钥\">>~/.ssh/authorized_keys\n```\n\n\n## gitolite\n### 添加用户\n仓库服务器执行\n```\nuseradd gits\nmkdir -p /home/gits\nchown -R gits:gits  /home/gits\n```\n\n初始化\n```\n$ cp  ~/.ssh/id_rsa.pub   /tmp/git.pub\n$ su gits\n$ git clone https://github.com/sitaramc/gitolite\n$ gitolite/install -to $HOME/bin\n$ ~/bin/gitolite setup -pk /tmp/git.pub\n```\n\n**密码**\n\n见gitosis测试[拉取](#pull)的操作\n\n\n### 管理\n本地拉取\n```shell\ngit clone gits@192.168.16.232:repositories/gitolite-admin\n```\n> 正克隆到 'gitolite-admin'...  <br />\ngits@192.168.16.232's password:  <br />\nremote: Counting objects: 6, done. <br />\nremote: Compressing objects: 100% (4/4), done. <br />\nremote: Total 6 (delta 0), reused 0 (delta 0)\n接收对象中: 100% (6/6), 完成. <br />\n检查连接... 完成。 <br />\n\n查看目录\n```\n$ tree -L 2  gitolite-admin\ngitolite-admin\n├── conf\n│   └── gitolite.conf\n└── keydir\n    └── git.pub\n```\ncp密钥，配置权限\n```\n$ cat  gitolite-admin/conf/gitolite.conf \nrepo gitolite-admin\n    RW+     =   git\n\nrepo testing\n    RW+     =   @all\n```\n> RW+  所有权限  <br />\ndoc: https://github.com/sitaramc/gitolite#access-rule-examples <br />\n\n\n最后\n```\ngit add .\ngit commit -am \"add new user xx\"\ngit push origin master\n```\n>更多高级配置在/home/gits/.gitolite.rc\n\n\n## gogs\n官网 https://try.gogs.io/\n\n带**UI**的服务，部署方便，轻量级\n\ngitlab太占内存了，云服务器跑成本高呀\n```\n# Pull image from Docker Hub.\n$ docker pull gogs/gogs\n\n# Create local directory for volume.\n$ mkdir -p /var/gogs\n\n# Use `docker run` for the first time.\n$ docker run --name=gogs -p 10022:22 -p 10080:3000 -v /var/gogs:/data gogs/gogs\n\n# Use `docker start` if you have stopped it.\n$ docker start gogs\n```\n>doc https://github.com/gogits/gogs/tree/master/docker#usage\n","source":"_posts/tool/git-server.md","raw":"---\ntitle: git server 搭建\ndate: 2017-10-10 19:36:33\ntags: git\ncategories: tool\n---\n## 准备\n*    ssh\n*    git \n\n\n## gitosis\n### 添加用户\n仓库服务器执行\n```\nuseradd git\nmkdir -p /home/git\nchown -R git:git /home/git\n```\n\n密钥\n```\ncp  ~/.ssh/id_rsa.pub   /tmp/git.pub\n```\n <!--more--> \n### 安装\n\n```\ngit clone git://github.com/res0nat0r/gitosis.git\ncd gitosis\npython setup.py install\n```\n\n初始化\n```\nsu  git\ngitosis-init < ~/.ssh/id_rsa.pub\n```\n\n### 管理\n拉取\n```\n$git clone git@192.168.16.232:repositories/gitosis-admin.git\n$ tree -L 2 gitosis-admin\ngitosis-admin\n├── gitosis.conf\n└── keydir\n    └── git@ubuntu.pub\n```\n配置密钥\n```\ncp ~/.ssh/id_rsa.pub  gitosis-admin/keydir/cs.pub\n```\n添加权限 **gitosis.conf**\n```\n[group dev]  \nmembers = cs #这里的cs对上面公匙cs.pub文件名cs  \nwritable = test #项目名test\n```\n\n### <span id=\"pull\">测试拉取</span>\n\n```\nmkdir  test && cd test\necho \"测试test仓库\">rep\ngit init\ngit add .\ngit  commit -am \"add test\"\ngit remote add origin git@192.168.16.232:test.git\ngit  push origin master\n```\n> 提示要密码 <br />\n设置密码（root用户操作）\n```\npasswd gits\n2次 123456\n```\n或\n```\nsu gits\necho \"你的密钥\">>~/.ssh/authorized_keys\n```\n\n\n## gitolite\n### 添加用户\n仓库服务器执行\n```\nuseradd gits\nmkdir -p /home/gits\nchown -R gits:gits  /home/gits\n```\n\n初始化\n```\n$ cp  ~/.ssh/id_rsa.pub   /tmp/git.pub\n$ su gits\n$ git clone https://github.com/sitaramc/gitolite\n$ gitolite/install -to $HOME/bin\n$ ~/bin/gitolite setup -pk /tmp/git.pub\n```\n\n**密码**\n\n见gitosis测试[拉取](#pull)的操作\n\n\n### 管理\n本地拉取\n```shell\ngit clone gits@192.168.16.232:repositories/gitolite-admin\n```\n> 正克隆到 'gitolite-admin'...  <br />\ngits@192.168.16.232's password:  <br />\nremote: Counting objects: 6, done. <br />\nremote: Compressing objects: 100% (4/4), done. <br />\nremote: Total 6 (delta 0), reused 0 (delta 0)\n接收对象中: 100% (6/6), 完成. <br />\n检查连接... 完成。 <br />\n\n查看目录\n```\n$ tree -L 2  gitolite-admin\ngitolite-admin\n├── conf\n│   └── gitolite.conf\n└── keydir\n    └── git.pub\n```\ncp密钥，配置权限\n```\n$ cat  gitolite-admin/conf/gitolite.conf \nrepo gitolite-admin\n    RW+     =   git\n\nrepo testing\n    RW+     =   @all\n```\n> RW+  所有权限  <br />\ndoc: https://github.com/sitaramc/gitolite#access-rule-examples <br />\n\n\n最后\n```\ngit add .\ngit commit -am \"add new user xx\"\ngit push origin master\n```\n>更多高级配置在/home/gits/.gitolite.rc\n\n\n## gogs\n官网 https://try.gogs.io/\n\n带**UI**的服务，部署方便，轻量级\n\ngitlab太占内存了，云服务器跑成本高呀\n```\n# Pull image from Docker Hub.\n$ docker pull gogs/gogs\n\n# Create local directory for volume.\n$ mkdir -p /var/gogs\n\n# Use `docker run` for the first time.\n$ docker run --name=gogs -p 10022:22 -p 10080:3000 -v /var/gogs:/data gogs/gogs\n\n# Use `docker start` if you have stopped it.\n$ docker start gogs\n```\n>doc https://github.com/gogits/gogs/tree/master/docker#usage\n","slug":"tool/git-server","published":1,"updated":"2022-08-21T10:22:31.639Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtst000wgwi5c263fg9a","content":"<h2 id=\"准备\"><a href=\"#准备\" class=\"headerlink\" title=\"准备\"></a>准备</h2><ul>\n<li>ssh</li>\n<li>git</li>\n</ul>\n<h2 id=\"gitosis\"><a href=\"#gitosis\" class=\"headerlink\" title=\"gitosis\"></a>gitosis</h2><h3 id=\"添加用户\"><a href=\"#添加用户\" class=\"headerlink\" title=\"添加用户\"></a>添加用户</h3><p>仓库服务器执行</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd git</span><br><span class=\"line\">mkdir -p /home/git</span><br><span class=\"line\">chown -R git:git /home/git</span><br></pre></td></tr></table></figure>\n\n<p>密钥</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp  ~/.ssh/id_rsa.pub   /tmp/git.pub</span><br></pre></td></tr></table></figure>\n <span id=\"more\"></span> \n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone git://github.com/res0nat0r/gitosis.git</span><br><span class=\"line\">cd gitosis</span><br><span class=\"line\">python setup.py install</span><br></pre></td></tr></table></figure>\n\n<p>初始化</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">su  git</span><br><span class=\"line\">gitosis-init &lt; ~/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"管理\"><a href=\"#管理\" class=\"headerlink\" title=\"管理\"></a>管理</h3><p>拉取</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$git clone git@192.168.16.232:repositories/gitosis-admin.git</span><br><span class=\"line\">$ tree -L 2 gitosis-admin</span><br><span class=\"line\">gitosis-admin</span><br><span class=\"line\">├── gitosis.conf</span><br><span class=\"line\">└── keydir</span><br><span class=\"line\">    └── git@ubuntu.pub</span><br></pre></td></tr></table></figure>\n<p>配置密钥</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp ~/.ssh/id_rsa.pub  gitosis-admin/keydir/cs.pub</span><br></pre></td></tr></table></figure>\n<p>添加权限 <strong>gitosis.conf</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[group dev]  </span><br><span class=\"line\">members = cs #这里的cs对上面公匙cs.pub文件名cs  </span><br><span class=\"line\">writable = test #项目名test</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"测试拉取\"><a href=\"#测试拉取\" class=\"headerlink\" title=\"测试拉取\"></a><span id=\"pull\">测试拉取</span></h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir  test &amp;&amp; cd test</span><br><span class=\"line\">echo &quot;测试test仓库&quot;&gt;rep</span><br><span class=\"line\">git init</span><br><span class=\"line\">git add .</span><br><span class=\"line\">git  commit -am &quot;add test&quot;</span><br><span class=\"line\">git remote add origin git@192.168.16.232:test.git</span><br><span class=\"line\">git  push origin master</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>提示要密码 <br /><br>设置密码（root用户操作）</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">passwd gits</span><br><span class=\"line\">2次 123456</span><br></pre></td></tr></table></figure>\n<p>或</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">su gits</span><br><span class=\"line\">echo &quot;你的密钥&quot;&gt;&gt;~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"gitolite\"><a href=\"#gitolite\" class=\"headerlink\" title=\"gitolite\"></a>gitolite</h2><h3 id=\"添加用户-1\"><a href=\"#添加用户-1\" class=\"headerlink\" title=\"添加用户\"></a>添加用户</h3><p>仓库服务器执行</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd gits</span><br><span class=\"line\">mkdir -p /home/gits</span><br><span class=\"line\">chown -R gits:gits  /home/gits</span><br></pre></td></tr></table></figure>\n\n<p>初始化</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cp  ~/.ssh/id_rsa.pub   /tmp/git.pub</span><br><span class=\"line\">$ su gits</span><br><span class=\"line\">$ git clone https://github.com/sitaramc/gitolite</span><br><span class=\"line\">$ gitolite/install -to $HOME/bin</span><br><span class=\"line\">$ ~/bin/gitolite setup -pk /tmp/git.pub</span><br></pre></td></tr></table></figure>\n\n<p><strong>密码</strong></p>\n<p>见gitosis测试<a href=\"#pull\">拉取</a>的操作</p>\n<h3 id=\"管理-1\"><a href=\"#管理-1\" class=\"headerlink\" title=\"管理\"></a>管理</h3><p>本地拉取</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone gits@192.168.16.232:repositories/gitolite-admin</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>正克隆到 ‘gitolite-admin’…  <br /><br><a href=\"mailto:&#x67;&#x69;&#116;&#115;&#64;&#x31;&#57;&#x32;&#x2e;&#x31;&#x36;&#x38;&#46;&#x31;&#x36;&#46;&#50;&#x33;&#50;\">&#x67;&#x69;&#116;&#115;&#64;&#x31;&#57;&#x32;&#x2e;&#x31;&#x36;&#x38;&#46;&#x31;&#x36;&#46;&#50;&#x33;&#50;</a>‘s password:  <br /><br>remote: Counting objects: 6, done. <br /><br>remote: Compressing objects: 100% (4&#x2F;4), done. <br /><br>remote: Total 6 (delta 0), reused 0 (delta 0)<br>接收对象中: 100% (6&#x2F;6), 完成. <br /><br>检查连接… 完成。 <br /></p>\n</blockquote>\n<p>查看目录</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ tree -L 2  gitolite-admin</span><br><span class=\"line\">gitolite-admin</span><br><span class=\"line\">├── conf</span><br><span class=\"line\">│   └── gitolite.conf</span><br><span class=\"line\">└── keydir</span><br><span class=\"line\">    └── git.pub</span><br></pre></td></tr></table></figure>\n<p>cp密钥，配置权限</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cat  gitolite-admin/conf/gitolite.conf </span><br><span class=\"line\">repo gitolite-admin</span><br><span class=\"line\">    RW+     =   git</span><br><span class=\"line\"></span><br><span class=\"line\">repo testing</span><br><span class=\"line\">    RW+     =   @all</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>RW+  所有权限  <br /><br>doc: <a href=\"https://github.com/sitaramc/gitolite#access-rule-examples\">https://github.com/sitaramc/gitolite#access-rule-examples</a> <br /></p>\n</blockquote>\n<p>最后</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add .</span><br><span class=\"line\">git commit -am &quot;add new user xx&quot;</span><br><span class=\"line\">git push origin master</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>更多高级配置在&#x2F;home&#x2F;gits&#x2F;.gitolite.rc</p>\n</blockquote>\n<h2 id=\"gogs\"><a href=\"#gogs\" class=\"headerlink\" title=\"gogs\"></a>gogs</h2><p>官网 <a href=\"https://try.gogs.io/\">https://try.gogs.io/</a></p>\n<p>带<strong>UI</strong>的服务，部署方便，轻量级</p>\n<p>gitlab太占内存了，云服务器跑成本高呀</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Pull image from Docker Hub.</span><br><span class=\"line\">$ docker pull gogs/gogs</span><br><span class=\"line\"></span><br><span class=\"line\"># Create local directory for volume.</span><br><span class=\"line\">$ mkdir -p /var/gogs</span><br><span class=\"line\"></span><br><span class=\"line\"># Use `docker run` for the first time.</span><br><span class=\"line\">$ docker run --name=gogs -p 10022:22 -p 10080:3000 -v /var/gogs:/data gogs/gogs</span><br><span class=\"line\"></span><br><span class=\"line\"># Use `docker start` if you have stopped it.</span><br><span class=\"line\">$ docker start gogs</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>doc <a href=\"https://github.com/gogits/gogs/tree/master/docker#usage\">https://github.com/gogits/gogs/tree/master/docker#usage</a></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<h2 id=\"准备\"><a href=\"#准备\" class=\"headerlink\" title=\"准备\"></a>准备</h2><ul>\n<li>ssh</li>\n<li>git</li>\n</ul>\n<h2 id=\"gitosis\"><a href=\"#gitosis\" class=\"headerlink\" title=\"gitosis\"></a>gitosis</h2><h3 id=\"添加用户\"><a href=\"#添加用户\" class=\"headerlink\" title=\"添加用户\"></a>添加用户</h3><p>仓库服务器执行</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd git</span><br><span class=\"line\">mkdir -p /home/git</span><br><span class=\"line\">chown -R git:git /home/git</span><br></pre></td></tr></table></figure>\n\n<p>密钥</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp  ~/.ssh/id_rsa.pub   /tmp/git.pub</span><br></pre></td></tr></table></figure>","more":"<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone git://github.com/res0nat0r/gitosis.git</span><br><span class=\"line\">cd gitosis</span><br><span class=\"line\">python setup.py install</span><br></pre></td></tr></table></figure>\n\n<p>初始化</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">su  git</span><br><span class=\"line\">gitosis-init &lt; ~/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"管理\"><a href=\"#管理\" class=\"headerlink\" title=\"管理\"></a>管理</h3><p>拉取</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$git clone git@192.168.16.232:repositories/gitosis-admin.git</span><br><span class=\"line\">$ tree -L 2 gitosis-admin</span><br><span class=\"line\">gitosis-admin</span><br><span class=\"line\">├── gitosis.conf</span><br><span class=\"line\">└── keydir</span><br><span class=\"line\">    └── git@ubuntu.pub</span><br></pre></td></tr></table></figure>\n<p>配置密钥</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp ~/.ssh/id_rsa.pub  gitosis-admin/keydir/cs.pub</span><br></pre></td></tr></table></figure>\n<p>添加权限 <strong>gitosis.conf</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[group dev]  </span><br><span class=\"line\">members = cs #这里的cs对上面公匙cs.pub文件名cs  </span><br><span class=\"line\">writable = test #项目名test</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"测试拉取\"><a href=\"#测试拉取\" class=\"headerlink\" title=\"测试拉取\"></a><span id=\"pull\">测试拉取</span></h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir  test &amp;&amp; cd test</span><br><span class=\"line\">echo &quot;测试test仓库&quot;&gt;rep</span><br><span class=\"line\">git init</span><br><span class=\"line\">git add .</span><br><span class=\"line\">git  commit -am &quot;add test&quot;</span><br><span class=\"line\">git remote add origin git@192.168.16.232:test.git</span><br><span class=\"line\">git  push origin master</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>提示要密码 <br /><br>设置密码（root用户操作）</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">passwd gits</span><br><span class=\"line\">2次 123456</span><br></pre></td></tr></table></figure>\n<p>或</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">su gits</span><br><span class=\"line\">echo &quot;你的密钥&quot;&gt;&gt;~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"gitolite\"><a href=\"#gitolite\" class=\"headerlink\" title=\"gitolite\"></a>gitolite</h2><h3 id=\"添加用户-1\"><a href=\"#添加用户-1\" class=\"headerlink\" title=\"添加用户\"></a>添加用户</h3><p>仓库服务器执行</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd gits</span><br><span class=\"line\">mkdir -p /home/gits</span><br><span class=\"line\">chown -R gits:gits  /home/gits</span><br></pre></td></tr></table></figure>\n\n<p>初始化</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cp  ~/.ssh/id_rsa.pub   /tmp/git.pub</span><br><span class=\"line\">$ su gits</span><br><span class=\"line\">$ git clone https://github.com/sitaramc/gitolite</span><br><span class=\"line\">$ gitolite/install -to $HOME/bin</span><br><span class=\"line\">$ ~/bin/gitolite setup -pk /tmp/git.pub</span><br></pre></td></tr></table></figure>\n\n<p><strong>密码</strong></p>\n<p>见gitosis测试<a href=\"#pull\">拉取</a>的操作</p>\n<h3 id=\"管理-1\"><a href=\"#管理-1\" class=\"headerlink\" title=\"管理\"></a>管理</h3><p>本地拉取</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone gits@192.168.16.232:repositories/gitolite-admin</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>正克隆到 ‘gitolite-admin’…  <br /><br><a href=\"mailto:&#x67;&#x69;&#116;&#115;&#64;&#x31;&#57;&#x32;&#x2e;&#x31;&#x36;&#x38;&#46;&#x31;&#x36;&#46;&#50;&#x33;&#50;\">&#x67;&#x69;&#116;&#115;&#64;&#x31;&#57;&#x32;&#x2e;&#x31;&#x36;&#x38;&#46;&#x31;&#x36;&#46;&#50;&#x33;&#50;</a>‘s password:  <br /><br>remote: Counting objects: 6, done. <br /><br>remote: Compressing objects: 100% (4&#x2F;4), done. <br /><br>remote: Total 6 (delta 0), reused 0 (delta 0)<br>接收对象中: 100% (6&#x2F;6), 完成. <br /><br>检查连接… 完成。 <br /></p>\n</blockquote>\n<p>查看目录</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ tree -L 2  gitolite-admin</span><br><span class=\"line\">gitolite-admin</span><br><span class=\"line\">├── conf</span><br><span class=\"line\">│   └── gitolite.conf</span><br><span class=\"line\">└── keydir</span><br><span class=\"line\">    └── git.pub</span><br></pre></td></tr></table></figure>\n<p>cp密钥，配置权限</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cat  gitolite-admin/conf/gitolite.conf </span><br><span class=\"line\">repo gitolite-admin</span><br><span class=\"line\">    RW+     =   git</span><br><span class=\"line\"></span><br><span class=\"line\">repo testing</span><br><span class=\"line\">    RW+     =   @all</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>RW+  所有权限  <br /><br>doc: <a href=\"https://github.com/sitaramc/gitolite#access-rule-examples\">https://github.com/sitaramc/gitolite#access-rule-examples</a> <br /></p>\n</blockquote>\n<p>最后</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add .</span><br><span class=\"line\">git commit -am &quot;add new user xx&quot;</span><br><span class=\"line\">git push origin master</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>更多高级配置在&#x2F;home&#x2F;gits&#x2F;.gitolite.rc</p>\n</blockquote>\n<h2 id=\"gogs\"><a href=\"#gogs\" class=\"headerlink\" title=\"gogs\"></a>gogs</h2><p>官网 <a href=\"https://try.gogs.io/\">https://try.gogs.io/</a></p>\n<p>带<strong>UI</strong>的服务，部署方便，轻量级</p>\n<p>gitlab太占内存了，云服务器跑成本高呀</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Pull image from Docker Hub.</span><br><span class=\"line\">$ docker pull gogs/gogs</span><br><span class=\"line\"></span><br><span class=\"line\"># Create local directory for volume.</span><br><span class=\"line\">$ mkdir -p /var/gogs</span><br><span class=\"line\"></span><br><span class=\"line\"># Use `docker run` for the first time.</span><br><span class=\"line\">$ docker run --name=gogs -p 10022:22 -p 10080:3000 -v /var/gogs:/data gogs/gogs</span><br><span class=\"line\"></span><br><span class=\"line\"># Use `docker start` if you have stopped it.</span><br><span class=\"line\">$ docker start gogs</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>doc <a href=\"https://github.com/gogits/gogs/tree/master/docker#usage\">https://github.com/gogits/gogs/tree/master/docker#usage</a></p>\n</blockquote>"},{"title":"maven介绍","date":"2022-07-30T11:51:46.000Z","_content":"\n\n\n\n\n\n\n## 安装\n\n### 环境变量\n\n```\ncs@debian:~/oss/hexo$ wget https://dlcdn.apache.org/maven/maven-3/3.8.6/binaries/apache-maven-3.8.6-bin.tar.gz -O apache-maven-3.8.6-bin.tar.gz\ncs@debian:~/oss/hexo$ tar -zxvf apache-maven-3.8.6-bin.tar.gz -C /opt/apache\ncs@debian:~/oss/hexo$ cat >>  ~/.bashrc <<EOF\n#maven\nif [ -d \"/opt/apache/maven-3.8.6\" ] ; then\n    export MAVEN_HOME=/opt/apache/maven-3.8.6\n    export PATH=${MAVEN_HOME}/bin:\\$PATH\nfi\nEOF\n```\n\n### 版本\n\n```\ncs@debian:~/oss/hexo$ mvn -version\n```\n\n> Apache Maven 3.8.6 (84538c9988a25aec085021c365c560670ad80f63)\n> Maven home: /opt/apache/apache-maven-3.8.6\n> Java version: 11.0.12, vendor: Oracle Corporation, runtime: /opt/jdk/jdk-11.0.12\n> Default locale: zh_CN, platform encoding: UTF-8\n> OS name: \"linux\", version: \"4.9.0-8-amd64\", arch: \"amd64\", family: \"unix\"\n\n\n\n##  基本命令\n\n### 编译\n\n```\nmvn compile　\n```\n\n  --src/main/java目录java源码编译生成class （target目录下）\n\n　　　　　　　　　　\n\n### 测试\n\n```\nmvn test　\n```\n\n   --src/test/java 目录编译\n\n　　　　　　　　　　\n\n### 清理\n\n```\nmvn clean\n```\n\n  --删除target目录，也就是将class文件等删除\n\n　　　　　　　　　　\n\n### 打包\n\n```\nmvn package　\n```\n\n --生成压缩文件：java项目#jar包；web项目#war包，也是放在target目录下\n\n　　　　　　　　　　\n\n### 安装\n\n```\nmvn install　　\n```\n\n--将压缩文件(jar或者war)上传到本地仓库\n\n　　　　　　　　　　\n\n### 部署|发布\n\n```\nmvn deploy　　\n```\n\n--将压缩文件上传私服\n\n\n\n### [多模块](#idmore)\n\n\n\n\n\n场景:几百个微服务只打部分包\n\n\n\n<!--more-->\n\n\n\n### 周期\n\n| **验证（validate）**                        | 验证项目是正确的，所有必要的信息可用。                       |\n| ------------------------------------------- | ------------------------------------------------------------ |\n| **初始化（initialize）**                    | 初始化构建状态，例如设置属性或创建目录。                     |\n| **产生来源（generate-sources）**            | 生成包含在编译中的任何源代码。                               |\n| **流程源（process-sources）**               | 处理源代码，例如过滤任何值。                                 |\n| **生成资源（generate-resources）**          | 生成包含在包中的资源。                                       |\n| **流程资源（process-resources）**           | 将资源复制并处理到目标目录中，准备打包。                     |\n| **编译（compile）**                         | 编译项目的源代码。                                           |\n| **工艺类（process-classes）**               | 从编译后处理生成的文件，例如对Java类进行字节码增强。         |\n| **生成测试来源（generate-test-sources）**   | 生成包含在编译中的任何测试源代码。                           |\n| **流程测试来源（process-test-sources）**    | 处理测试源代码，例如过滤任何值。                             |\n| **生成测试资源（generate-test-resources）** | 创建测试资源。                                               |\n| **流程测试资源（process-test-resources）**  | 将资源复制并处理到测试目标目录中。                           |\n| **测试编译（test-compile）**                | 将测试源代码编译到测试目标目录中                             |\n| **流程检验类（process-test-classes）**      | 从测试编译中处理生成的文件，例如对Java类进行字节码增强。对于Maven 2.0.5及以上版本。 |\n| **测试（test）**                            | 使用合适的单元测试框架运行测试。这些测试不应该要求代码被打包或部署。 |\n| **制备包（prepare-package）**               | 在实际包装之前，执行必要的准备包装的操作。这通常会导致打包的处理版本的包。（Maven 2.1及以上） |\n| **打包（package）**                         | 采取编译的代码，并以其可分发的格式（如JAR）进行打包。        |\n| **预集成测试（pre-integration-test）**      | 在执行集成测试之前执行所需的操作。这可能涉及诸如设置所需环境等。 |\n| **集成测试（integration-test）**            | 如果需要，可以将该包过程并部署到可以运行集成测试的环境中。   |\n| **整合后的测试（post-integration-test）**   | 执行集成测试后执行所需的操作。这可能包括清理环境。           |\n| **校验（verify）**                          | 运行任何检查以验证包装是否有效并符合质量标准。               |\n| **安装（install）**                         | 将软件包安装到本地存储库中，以作为本地其他项目的依赖关系。   |\n| **部署（deploy）**                          | 在集成或发布环境中完成，将最终软件包复制到远程存储库，以与其他开发人员和项目共享。 |\n\n\n\n## 高级命令\n\n在<a id=\"idmore\">多模块</a>Maven项目中，反应堆（Reactor）是一个包含了所有需要构建模块的抽象概念，对于Maven用户来说，主要关心的是两点：\n\n1. 哪些模块会被包含到反应堆中？\n2. 反应堆中所有模块的构建顺序是什么？\n\n\n\n```\n$ tree -L 3 -P *xml -I \"src|target\" ./spring-boot/\n./spring-boot/\n├── cs-framework\n│   ├── cs-msc\n│   │   ├── lib\n│   │   ├── msc\n│   │   └── pom.xml\n│   ├── cs-ocr\n│   │   ├── libs\n│   │   └── pom.xml\n│   ├── cs-shiro\n│   │   └── pom.xml\n│   └── pom.xml\n├── cs-tool\n│   ├── cs-common\n│   │   └── pom.xml\n│   ├── cs-email\n│   │   └── pom.xml\n│   ├── cs-jpa\n│   │   └── pom.xml\n│   ├── cs-rw-aop\n│   │   └── pom.xml\n│   ├── cs-rw-druid\n│   │   └── pom.xml\n│   └── pom.xml\n└── pom.xml\n```\n\n\n\n一级\n\n```xml\n<groupId>com.cs</groupId>\n  <artifactId>cs-parent</artifactId>\n   <version>${version}</version>\n\n  <modules>\n    <module>cs-framework</module>\n    <module>cs-tool</module>\n  </modules>\n  <packaging>pom</packaging>\n  \n  <name>cs-parent</name>\n```\n\n\n\n\n\n二级\n\n```xml\n <parent>\n    <groupId>com.cs</groupId>\n    <artifactId>cs-parent</artifactId>\n    <version>${version}</version>\n  </parent>\n\n <groupId>com.cs</groupId>\n  <artifactId>cs-framework</artifactId>\n   <version>${version}</version>\n  <name>cs-framework</name>\n  <packaging>pom</packaging>\n  \n   <modules>\n     <module>cs-shiro</module>\n    <module>cs-ocr</module>\n    <module>cs-msc</module>\n  </modules>\n```\n\n\n\n子\n\n```xml\n  <parent>\n    <groupId>com.cs</groupId>\n    <artifactId>cs-framework</artifactId>\n    <version>${version}</version>\n  </parent>\n  <groupId>com.cs</groupId>\n  <artifactId>cs-ocr</artifactId>\n  <version>${version}</version>\n  <name>cs-ocr</name>\n```\n\n\n\n```\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for cs-parent 0.0.1-SNAPSHOT:\n[INFO] \n[INFO] cs-parent .......................................... SUCCESS [  0.163 s]\n[INFO] cs-tool ............................................ SUCCESS [  0.005 s]\n[INFO] cs-common .......................................... SUCCESS [  0.800 s]\n[INFO] cs-framework ....................................... SUCCESS [  0.006 s]\n[INFO] cs-ocr ............................................. SUCCESS [  3.194 s]\n[INFO] cs-msc ............................................. SUCCESS [  0.271 s]\n[INFO] cs-jpa ............................................. SUCCESS [  0.471 s]\n[INFO] cs-rw-aop .......................................... SUCCESS [  1.074 s]\n[INFO] cs-rw-druid ........................................ SUCCESS [  0.893 s]\n[INFO] cs-email ........................................... SUCCESS [  2.520 s]\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  9.736 s\n[INFO] Finished at: 2022-07-30T21:51:32+08:00\n[INFO] ------------------------------------------------------------------------\n```\n\n\n\n\n\n### 指定 -pl\n\n手动选择项目，多个逗号隔开\n\n```\nmvn install -pl web/style,web/login\n```\n\n>-pl,--projects <arg>                   \n>Build specified reactor projects instead of all projects. \n>A project can be specified by [groupId]:artifactId or by its relative path.\n\n\n\n### 所需依赖 -am\n\n构建某个子模块\n\n```\nmvn install -pl web/style  -am\n```\n\n>项目被指定，构建该项目所需依赖\n>\n> -am,--also-make                      \n>  If project list is specified, also  build projects required by the  list\n\n构建 parent ，framework, web, redis ,style\n\n\n\n### 依赖该模块 -amd \n\n构建父模块，公用模块\n\n```\nmvn install -pl web/redis  -amd\n```\n\n> 项目被指定，构建依赖该模块的模块 \n>\n> -amd,--also-make-dependents          \n>    If project list is specified, also  build projects that depend on projects on the list\n\n构建 redis, login, style\n\n\n\n### 裁剪 -rf\n\n在前命令裁剪基础上，从rf指定模块开始构建\n\n```\nmvn install -pl web/style  -am -rf  web/redis\n```\n\n>从原有构建过程中裁剪反应堆，去掉指定模块原有构建顺序的前面部分\n>\n>-rf,--resume-from <arg>              \n>Resume reactor from specified  project\n\n构建 redis style\n\n\n\n\n\n\n\n## 错误\n\n### find main class\n\n repackage failed: Unable to find main class\n\n```\n <build>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n                <executions>\n                    <execution>\n                        <phase>none</phase>\n                    </execution>\n                </executions>\n            </plugin>\n        </plugins>\n   </build>\n```\n\n","source":"_posts/tool/maven.md","raw":"---\ntitle: maven介绍\npermalink: tool/maven/\ntags:\n  - maven\n  - mvn\ncategories:\n  - tool\ndate: 2022-07-30 19:51:46\n---\n\n\n\n\n\n\n\n## 安装\n\n### 环境变量\n\n```\ncs@debian:~/oss/hexo$ wget https://dlcdn.apache.org/maven/maven-3/3.8.6/binaries/apache-maven-3.8.6-bin.tar.gz -O apache-maven-3.8.6-bin.tar.gz\ncs@debian:~/oss/hexo$ tar -zxvf apache-maven-3.8.6-bin.tar.gz -C /opt/apache\ncs@debian:~/oss/hexo$ cat >>  ~/.bashrc <<EOF\n#maven\nif [ -d \"/opt/apache/maven-3.8.6\" ] ; then\n    export MAVEN_HOME=/opt/apache/maven-3.8.6\n    export PATH=${MAVEN_HOME}/bin:\\$PATH\nfi\nEOF\n```\n\n### 版本\n\n```\ncs@debian:~/oss/hexo$ mvn -version\n```\n\n> Apache Maven 3.8.6 (84538c9988a25aec085021c365c560670ad80f63)\n> Maven home: /opt/apache/apache-maven-3.8.6\n> Java version: 11.0.12, vendor: Oracle Corporation, runtime: /opt/jdk/jdk-11.0.12\n> Default locale: zh_CN, platform encoding: UTF-8\n> OS name: \"linux\", version: \"4.9.0-8-amd64\", arch: \"amd64\", family: \"unix\"\n\n\n\n##  基本命令\n\n### 编译\n\n```\nmvn compile　\n```\n\n  --src/main/java目录java源码编译生成class （target目录下）\n\n　　　　　　　　　　\n\n### 测试\n\n```\nmvn test　\n```\n\n   --src/test/java 目录编译\n\n　　　　　　　　　　\n\n### 清理\n\n```\nmvn clean\n```\n\n  --删除target目录，也就是将class文件等删除\n\n　　　　　　　　　　\n\n### 打包\n\n```\nmvn package　\n```\n\n --生成压缩文件：java项目#jar包；web项目#war包，也是放在target目录下\n\n　　　　　　　　　　\n\n### 安装\n\n```\nmvn install　　\n```\n\n--将压缩文件(jar或者war)上传到本地仓库\n\n　　　　　　　　　　\n\n### 部署|发布\n\n```\nmvn deploy　　\n```\n\n--将压缩文件上传私服\n\n\n\n### [多模块](#idmore)\n\n\n\n\n\n场景:几百个微服务只打部分包\n\n\n\n<!--more-->\n\n\n\n### 周期\n\n| **验证（validate）**                        | 验证项目是正确的，所有必要的信息可用。                       |\n| ------------------------------------------- | ------------------------------------------------------------ |\n| **初始化（initialize）**                    | 初始化构建状态，例如设置属性或创建目录。                     |\n| **产生来源（generate-sources）**            | 生成包含在编译中的任何源代码。                               |\n| **流程源（process-sources）**               | 处理源代码，例如过滤任何值。                                 |\n| **生成资源（generate-resources）**          | 生成包含在包中的资源。                                       |\n| **流程资源（process-resources）**           | 将资源复制并处理到目标目录中，准备打包。                     |\n| **编译（compile）**                         | 编译项目的源代码。                                           |\n| **工艺类（process-classes）**               | 从编译后处理生成的文件，例如对Java类进行字节码增强。         |\n| **生成测试来源（generate-test-sources）**   | 生成包含在编译中的任何测试源代码。                           |\n| **流程测试来源（process-test-sources）**    | 处理测试源代码，例如过滤任何值。                             |\n| **生成测试资源（generate-test-resources）** | 创建测试资源。                                               |\n| **流程测试资源（process-test-resources）**  | 将资源复制并处理到测试目标目录中。                           |\n| **测试编译（test-compile）**                | 将测试源代码编译到测试目标目录中                             |\n| **流程检验类（process-test-classes）**      | 从测试编译中处理生成的文件，例如对Java类进行字节码增强。对于Maven 2.0.5及以上版本。 |\n| **测试（test）**                            | 使用合适的单元测试框架运行测试。这些测试不应该要求代码被打包或部署。 |\n| **制备包（prepare-package）**               | 在实际包装之前，执行必要的准备包装的操作。这通常会导致打包的处理版本的包。（Maven 2.1及以上） |\n| **打包（package）**                         | 采取编译的代码，并以其可分发的格式（如JAR）进行打包。        |\n| **预集成测试（pre-integration-test）**      | 在执行集成测试之前执行所需的操作。这可能涉及诸如设置所需环境等。 |\n| **集成测试（integration-test）**            | 如果需要，可以将该包过程并部署到可以运行集成测试的环境中。   |\n| **整合后的测试（post-integration-test）**   | 执行集成测试后执行所需的操作。这可能包括清理环境。           |\n| **校验（verify）**                          | 运行任何检查以验证包装是否有效并符合质量标准。               |\n| **安装（install）**                         | 将软件包安装到本地存储库中，以作为本地其他项目的依赖关系。   |\n| **部署（deploy）**                          | 在集成或发布环境中完成，将最终软件包复制到远程存储库，以与其他开发人员和项目共享。 |\n\n\n\n## 高级命令\n\n在<a id=\"idmore\">多模块</a>Maven项目中，反应堆（Reactor）是一个包含了所有需要构建模块的抽象概念，对于Maven用户来说，主要关心的是两点：\n\n1. 哪些模块会被包含到反应堆中？\n2. 反应堆中所有模块的构建顺序是什么？\n\n\n\n```\n$ tree -L 3 -P *xml -I \"src|target\" ./spring-boot/\n./spring-boot/\n├── cs-framework\n│   ├── cs-msc\n│   │   ├── lib\n│   │   ├── msc\n│   │   └── pom.xml\n│   ├── cs-ocr\n│   │   ├── libs\n│   │   └── pom.xml\n│   ├── cs-shiro\n│   │   └── pom.xml\n│   └── pom.xml\n├── cs-tool\n│   ├── cs-common\n│   │   └── pom.xml\n│   ├── cs-email\n│   │   └── pom.xml\n│   ├── cs-jpa\n│   │   └── pom.xml\n│   ├── cs-rw-aop\n│   │   └── pom.xml\n│   ├── cs-rw-druid\n│   │   └── pom.xml\n│   └── pom.xml\n└── pom.xml\n```\n\n\n\n一级\n\n```xml\n<groupId>com.cs</groupId>\n  <artifactId>cs-parent</artifactId>\n   <version>${version}</version>\n\n  <modules>\n    <module>cs-framework</module>\n    <module>cs-tool</module>\n  </modules>\n  <packaging>pom</packaging>\n  \n  <name>cs-parent</name>\n```\n\n\n\n\n\n二级\n\n```xml\n <parent>\n    <groupId>com.cs</groupId>\n    <artifactId>cs-parent</artifactId>\n    <version>${version}</version>\n  </parent>\n\n <groupId>com.cs</groupId>\n  <artifactId>cs-framework</artifactId>\n   <version>${version}</version>\n  <name>cs-framework</name>\n  <packaging>pom</packaging>\n  \n   <modules>\n     <module>cs-shiro</module>\n    <module>cs-ocr</module>\n    <module>cs-msc</module>\n  </modules>\n```\n\n\n\n子\n\n```xml\n  <parent>\n    <groupId>com.cs</groupId>\n    <artifactId>cs-framework</artifactId>\n    <version>${version}</version>\n  </parent>\n  <groupId>com.cs</groupId>\n  <artifactId>cs-ocr</artifactId>\n  <version>${version}</version>\n  <name>cs-ocr</name>\n```\n\n\n\n```\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for cs-parent 0.0.1-SNAPSHOT:\n[INFO] \n[INFO] cs-parent .......................................... SUCCESS [  0.163 s]\n[INFO] cs-tool ............................................ SUCCESS [  0.005 s]\n[INFO] cs-common .......................................... SUCCESS [  0.800 s]\n[INFO] cs-framework ....................................... SUCCESS [  0.006 s]\n[INFO] cs-ocr ............................................. SUCCESS [  3.194 s]\n[INFO] cs-msc ............................................. SUCCESS [  0.271 s]\n[INFO] cs-jpa ............................................. SUCCESS [  0.471 s]\n[INFO] cs-rw-aop .......................................... SUCCESS [  1.074 s]\n[INFO] cs-rw-druid ........................................ SUCCESS [  0.893 s]\n[INFO] cs-email ........................................... SUCCESS [  2.520 s]\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  9.736 s\n[INFO] Finished at: 2022-07-30T21:51:32+08:00\n[INFO] ------------------------------------------------------------------------\n```\n\n\n\n\n\n### 指定 -pl\n\n手动选择项目，多个逗号隔开\n\n```\nmvn install -pl web/style,web/login\n```\n\n>-pl,--projects <arg>                   \n>Build specified reactor projects instead of all projects. \n>A project can be specified by [groupId]:artifactId or by its relative path.\n\n\n\n### 所需依赖 -am\n\n构建某个子模块\n\n```\nmvn install -pl web/style  -am\n```\n\n>项目被指定，构建该项目所需依赖\n>\n> -am,--also-make                      \n>  If project list is specified, also  build projects required by the  list\n\n构建 parent ，framework, web, redis ,style\n\n\n\n### 依赖该模块 -amd \n\n构建父模块，公用模块\n\n```\nmvn install -pl web/redis  -amd\n```\n\n> 项目被指定，构建依赖该模块的模块 \n>\n> -amd,--also-make-dependents          \n>    If project list is specified, also  build projects that depend on projects on the list\n\n构建 redis, login, style\n\n\n\n### 裁剪 -rf\n\n在前命令裁剪基础上，从rf指定模块开始构建\n\n```\nmvn install -pl web/style  -am -rf  web/redis\n```\n\n>从原有构建过程中裁剪反应堆，去掉指定模块原有构建顺序的前面部分\n>\n>-rf,--resume-from <arg>              \n>Resume reactor from specified  project\n\n构建 redis style\n\n\n\n\n\n\n\n## 错误\n\n### find main class\n\n repackage failed: Unable to find main class\n\n```\n <build>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n                <executions>\n                    <execution>\n                        <phase>none</phase>\n                    </execution>\n                </executions>\n            </plugin>\n        </plugins>\n   </build>\n```\n\n","slug":"tool/maven","published":1,"updated":"2022-08-28T09:10:00.936Z","__permalink":"tool/maven/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtsu000zgwi58g35gxdw","content":"<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><h3 id=\"环境变量\"><a href=\"#环境变量\" class=\"headerlink\" title=\"环境变量\"></a>环境变量</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/hexo$ wget https://dlcdn.apache.org/maven/maven-3/3.8.6/binaries/apache-maven-3.8.6-bin.tar.gz -O apache-maven-3.8.6-bin.tar.gz</span><br><span class=\"line\">cs@debian:~/oss/hexo$ tar -zxvf apache-maven-3.8.6-bin.tar.gz -C /opt/apache</span><br><span class=\"line\">cs@debian:~/oss/hexo$ cat &gt;&gt;  ~/.bashrc &lt;&lt;EOF</span><br><span class=\"line\">#maven</span><br><span class=\"line\">if [ -d &quot;/opt/apache/maven-3.8.6&quot; ] ; then</span><br><span class=\"line\">    export MAVEN_HOME=/opt/apache/maven-3.8.6</span><br><span class=\"line\">    export PATH=$&#123;MAVEN_HOME&#125;/bin:\\$PATH</span><br><span class=\"line\">fi</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"版本\"><a href=\"#版本\" class=\"headerlink\" title=\"版本\"></a>版本</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/hexo$ mvn -version</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Apache Maven 3.8.6 (84538c9988a25aec085021c365c560670ad80f63)<br>Maven home: &#x2F;opt&#x2F;apache&#x2F;apache-maven-3.8.6<br>Java version: 11.0.12, vendor: Oracle Corporation, runtime: &#x2F;opt&#x2F;jdk&#x2F;jdk-11.0.12<br>Default locale: zh_CN, platform encoding: UTF-8<br>OS name: “linux”, version: “4.9.0-8-amd64”, arch: “amd64”, family: “unix”</p>\n</blockquote>\n<h2 id=\"基本命令\"><a href=\"#基本命令\" class=\"headerlink\" title=\"基本命令\"></a>基本命令</h2><h3 id=\"编译\"><a href=\"#编译\" class=\"headerlink\" title=\"编译\"></a>编译</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn compile　</span><br></pre></td></tr></table></figure>\n\n<p>  –src&#x2F;main&#x2F;java目录java源码编译生成class （target目录下）</p>\n<p>　　　　　　　　　　</p>\n<h3 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn test　</span><br></pre></td></tr></table></figure>\n\n<p>   –src&#x2F;test&#x2F;java 目录编译</p>\n<p>　　　　　　　　　　</p>\n<h3 id=\"清理\"><a href=\"#清理\" class=\"headerlink\" title=\"清理\"></a>清理</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn clean</span><br></pre></td></tr></table></figure>\n\n<p>  –删除target目录，也就是将class文件等删除</p>\n<p>　　　　　　　　　　</p>\n<h3 id=\"打包\"><a href=\"#打包\" class=\"headerlink\" title=\"打包\"></a>打包</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn package　</span><br></pre></td></tr></table></figure>\n\n<p> –生成压缩文件：java项目#jar包；web项目#war包，也是放在target目录下</p>\n<p>　　　　　　　　　　</p>\n<h3 id=\"安装-1\"><a href=\"#安装-1\" class=\"headerlink\" title=\"安装\"></a>安装</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn install　　</span><br></pre></td></tr></table></figure>\n\n<p>–将压缩文件(jar或者war)上传到本地仓库</p>\n<p>　　　　　　　　　　</p>\n<h3 id=\"部署-发布\"><a href=\"#部署-发布\" class=\"headerlink\" title=\"部署|发布\"></a>部署|发布</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn deploy　　</span><br></pre></td></tr></table></figure>\n\n<p>–将压缩文件上传私服</p>\n<h3 id=\"多模块\"><a href=\"#多模块\" class=\"headerlink\" title=\"多模块\"></a><a href=\"#idmore\">多模块</a></h3><p>场景:几百个微服务只打部分包</p>\n<span id=\"more\"></span>\n\n\n\n<h3 id=\"周期\"><a href=\"#周期\" class=\"headerlink\" title=\"周期\"></a>周期</h3><table>\n<thead>\n<tr>\n<th><strong>验证（validate）</strong></th>\n<th>验证项目是正确的，所有必要的信息可用。</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>初始化（initialize）</strong></td>\n<td>初始化构建状态，例如设置属性或创建目录。</td>\n</tr>\n<tr>\n<td><strong>产生来源（generate-sources）</strong></td>\n<td>生成包含在编译中的任何源代码。</td>\n</tr>\n<tr>\n<td><strong>流程源（process-sources）</strong></td>\n<td>处理源代码，例如过滤任何值。</td>\n</tr>\n<tr>\n<td><strong>生成资源（generate-resources）</strong></td>\n<td>生成包含在包中的资源。</td>\n</tr>\n<tr>\n<td><strong>流程资源（process-resources）</strong></td>\n<td>将资源复制并处理到目标目录中，准备打包。</td>\n</tr>\n<tr>\n<td><strong>编译（compile）</strong></td>\n<td>编译项目的源代码。</td>\n</tr>\n<tr>\n<td><strong>工艺类（process-classes）</strong></td>\n<td>从编译后处理生成的文件，例如对Java类进行字节码增强。</td>\n</tr>\n<tr>\n<td><strong>生成测试来源（generate-test-sources）</strong></td>\n<td>生成包含在编译中的任何测试源代码。</td>\n</tr>\n<tr>\n<td><strong>流程测试来源（process-test-sources）</strong></td>\n<td>处理测试源代码，例如过滤任何值。</td>\n</tr>\n<tr>\n<td><strong>生成测试资源（generate-test-resources）</strong></td>\n<td>创建测试资源。</td>\n</tr>\n<tr>\n<td><strong>流程测试资源（process-test-resources）</strong></td>\n<td>将资源复制并处理到测试目标目录中。</td>\n</tr>\n<tr>\n<td><strong>测试编译（test-compile）</strong></td>\n<td>将测试源代码编译到测试目标目录中</td>\n</tr>\n<tr>\n<td><strong>流程检验类（process-test-classes）</strong></td>\n<td>从测试编译中处理生成的文件，例如对Java类进行字节码增强。对于Maven 2.0.5及以上版本。</td>\n</tr>\n<tr>\n<td><strong>测试（test）</strong></td>\n<td>使用合适的单元测试框架运行测试。这些测试不应该要求代码被打包或部署。</td>\n</tr>\n<tr>\n<td><strong>制备包（prepare-package）</strong></td>\n<td>在实际包装之前，执行必要的准备包装的操作。这通常会导致打包的处理版本的包。（Maven 2.1及以上）</td>\n</tr>\n<tr>\n<td><strong>打包（package）</strong></td>\n<td>采取编译的代码，并以其可分发的格式（如JAR）进行打包。</td>\n</tr>\n<tr>\n<td><strong>预集成测试（pre-integration-test）</strong></td>\n<td>在执行集成测试之前执行所需的操作。这可能涉及诸如设置所需环境等。</td>\n</tr>\n<tr>\n<td><strong>集成测试（integration-test）</strong></td>\n<td>如果需要，可以将该包过程并部署到可以运行集成测试的环境中。</td>\n</tr>\n<tr>\n<td><strong>整合后的测试（post-integration-test）</strong></td>\n<td>执行集成测试后执行所需的操作。这可能包括清理环境。</td>\n</tr>\n<tr>\n<td><strong>校验（verify）</strong></td>\n<td>运行任何检查以验证包装是否有效并符合质量标准。</td>\n</tr>\n<tr>\n<td><strong>安装（install）</strong></td>\n<td>将软件包安装到本地存储库中，以作为本地其他项目的依赖关系。</td>\n</tr>\n<tr>\n<td><strong>部署（deploy）</strong></td>\n<td>在集成或发布环境中完成，将最终软件包复制到远程存储库，以与其他开发人员和项目共享。</td>\n</tr>\n</tbody></table>\n<h2 id=\"高级命令\"><a href=\"#高级命令\" class=\"headerlink\" title=\"高级命令\"></a>高级命令</h2><p>在<a id=\"idmore\">多模块</a>Maven项目中，反应堆（Reactor）是一个包含了所有需要构建模块的抽象概念，对于Maven用户来说，主要关心的是两点：</p>\n<ol>\n<li>哪些模块会被包含到反应堆中？</li>\n<li>反应堆中所有模块的构建顺序是什么？</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ tree -L 3 -P *xml -I &quot;src|target&quot; ./spring-boot/</span><br><span class=\"line\">./spring-boot/</span><br><span class=\"line\">├── cs-framework</span><br><span class=\"line\">│   ├── cs-msc</span><br><span class=\"line\">│   │   ├── lib</span><br><span class=\"line\">│   │   ├── msc</span><br><span class=\"line\">│   │   └── pom.xml</span><br><span class=\"line\">│   ├── cs-ocr</span><br><span class=\"line\">│   │   ├── libs</span><br><span class=\"line\">│   │   └── pom.xml</span><br><span class=\"line\">│   ├── cs-shiro</span><br><span class=\"line\">│   │   └── pom.xml</span><br><span class=\"line\">│   └── pom.xml</span><br><span class=\"line\">├── cs-tool</span><br><span class=\"line\">│   ├── cs-common</span><br><span class=\"line\">│   │   └── pom.xml</span><br><span class=\"line\">│   ├── cs-email</span><br><span class=\"line\">│   │   └── pom.xml</span><br><span class=\"line\">│   ├── cs-jpa</span><br><span class=\"line\">│   │   └── pom.xml</span><br><span class=\"line\">│   ├── cs-rw-aop</span><br><span class=\"line\">│   │   └── pom.xml</span><br><span class=\"line\">│   ├── cs-rw-druid</span><br><span class=\"line\">│   │   └── pom.xml</span><br><span class=\"line\">│   └── pom.xml</span><br><span class=\"line\">└── pom.xml</span><br></pre></td></tr></table></figure>\n\n\n\n<p>一级</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.cs<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>cs-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">modules</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>cs-framework<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>cs-tool<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">modules</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>cs-parent<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>二级</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.cs<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>cs-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.cs<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>cs-framework<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>cs-framework<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">modules</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>cs-shiro<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>cs-ocr<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>cs-msc<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">modules</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>子</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.cs<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>cs-framework<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.cs<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>cs-ocr<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>cs-ocr<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[INFO] ------------------------------------------------------------------------</span><br><span class=\"line\">[INFO] Reactor Summary for cs-parent 0.0.1-SNAPSHOT:</span><br><span class=\"line\">[INFO] </span><br><span class=\"line\">[INFO] cs-parent .......................................... SUCCESS [  0.163 s]</span><br><span class=\"line\">[INFO] cs-tool ............................................ SUCCESS [  0.005 s]</span><br><span class=\"line\">[INFO] cs-common .......................................... SUCCESS [  0.800 s]</span><br><span class=\"line\">[INFO] cs-framework ....................................... SUCCESS [  0.006 s]</span><br><span class=\"line\">[INFO] cs-ocr ............................................. SUCCESS [  3.194 s]</span><br><span class=\"line\">[INFO] cs-msc ............................................. SUCCESS [  0.271 s]</span><br><span class=\"line\">[INFO] cs-jpa ............................................. SUCCESS [  0.471 s]</span><br><span class=\"line\">[INFO] cs-rw-aop .......................................... SUCCESS [  1.074 s]</span><br><span class=\"line\">[INFO] cs-rw-druid ........................................ SUCCESS [  0.893 s]</span><br><span class=\"line\">[INFO] cs-email ........................................... SUCCESS [  2.520 s]</span><br><span class=\"line\">[INFO] ------------------------------------------------------------------------</span><br><span class=\"line\">[INFO] BUILD SUCCESS</span><br><span class=\"line\">[INFO] ------------------------------------------------------------------------</span><br><span class=\"line\">[INFO] Total time:  9.736 s</span><br><span class=\"line\">[INFO] Finished at: 2022-07-30T21:51:32+08:00</span><br><span class=\"line\">[INFO] ------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"指定-pl\"><a href=\"#指定-pl\" class=\"headerlink\" title=\"指定 -pl\"></a>指定 -pl</h3><p>手动选择项目，多个逗号隔开</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn install -pl web/style,web/login</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>-pl,–projects <arg><br>Build specified reactor projects instead of all projects.<br>A project can be specified by [groupId]:artifactId or by its relative path.</p>\n</blockquote>\n<h3 id=\"所需依赖-am\"><a href=\"#所需依赖-am\" class=\"headerlink\" title=\"所需依赖 -am\"></a>所需依赖 -am</h3><p>构建某个子模块</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn install -pl web/style  -am</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>项目被指定，构建该项目所需依赖</p>\n<p>-am,–also-make<br> If project list is specified, also  build projects required by the  list</p>\n</blockquote>\n<p>构建 parent ，framework, web, redis ,style</p>\n<h3 id=\"依赖该模块-amd\"><a href=\"#依赖该模块-amd\" class=\"headerlink\" title=\"依赖该模块 -amd\"></a>依赖该模块 -amd</h3><p>构建父模块，公用模块</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn install -pl web/redis  -amd</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>项目被指定，构建依赖该模块的模块 </p>\n<p>-amd,–also-make-dependents<br>   If project list is specified, also  build projects that depend on projects on the list</p>\n</blockquote>\n<p>构建 redis, login, style</p>\n<h3 id=\"裁剪-rf\"><a href=\"#裁剪-rf\" class=\"headerlink\" title=\"裁剪 -rf\"></a>裁剪 -rf</h3><p>在前命令裁剪基础上，从rf指定模块开始构建</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn install -pl web/style  -am -rf  web/redis</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>从原有构建过程中裁剪反应堆，去掉指定模块原有构建顺序的前面部分</p>\n<p>-rf,–resume-from <arg><br>Resume reactor from specified  project</p>\n</blockquote>\n<p>构建 redis style</p>\n<h2 id=\"错误\"><a href=\"#错误\" class=\"headerlink\" title=\"错误\"></a>错误</h2><h3 id=\"find-main-class\"><a href=\"#find-main-class\" class=\"headerlink\" title=\"find main class\"></a>find main class</h3><p> repackage failed: Unable to find main class</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;build&gt;</span><br><span class=\"line\">       &lt;plugins&gt;</span><br><span class=\"line\">           &lt;plugin&gt;</span><br><span class=\"line\">               &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">               &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class=\"line\">               &lt;executions&gt;</span><br><span class=\"line\">                   &lt;execution&gt;</span><br><span class=\"line\">                       &lt;phase&gt;none&lt;/phase&gt;</span><br><span class=\"line\">                   &lt;/execution&gt;</span><br><span class=\"line\">               &lt;/executions&gt;</span><br><span class=\"line\">           &lt;/plugin&gt;</span><br><span class=\"line\">       &lt;/plugins&gt;</span><br><span class=\"line\">  &lt;/build&gt;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><h3 id=\"环境变量\"><a href=\"#环境变量\" class=\"headerlink\" title=\"环境变量\"></a>环境变量</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/hexo$ wget https://dlcdn.apache.org/maven/maven-3/3.8.6/binaries/apache-maven-3.8.6-bin.tar.gz -O apache-maven-3.8.6-bin.tar.gz</span><br><span class=\"line\">cs@debian:~/oss/hexo$ tar -zxvf apache-maven-3.8.6-bin.tar.gz -C /opt/apache</span><br><span class=\"line\">cs@debian:~/oss/hexo$ cat &gt;&gt;  ~/.bashrc &lt;&lt;EOF</span><br><span class=\"line\">#maven</span><br><span class=\"line\">if [ -d &quot;/opt/apache/maven-3.8.6&quot; ] ; then</span><br><span class=\"line\">    export MAVEN_HOME=/opt/apache/maven-3.8.6</span><br><span class=\"line\">    export PATH=$&#123;MAVEN_HOME&#125;/bin:\\$PATH</span><br><span class=\"line\">fi</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"版本\"><a href=\"#版本\" class=\"headerlink\" title=\"版本\"></a>版本</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/hexo$ mvn -version</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Apache Maven 3.8.6 (84538c9988a25aec085021c365c560670ad80f63)<br>Maven home: &#x2F;opt&#x2F;apache&#x2F;apache-maven-3.8.6<br>Java version: 11.0.12, vendor: Oracle Corporation, runtime: &#x2F;opt&#x2F;jdk&#x2F;jdk-11.0.12<br>Default locale: zh_CN, platform encoding: UTF-8<br>OS name: “linux”, version: “4.9.0-8-amd64”, arch: “amd64”, family: “unix”</p>\n</blockquote>\n<h2 id=\"基本命令\"><a href=\"#基本命令\" class=\"headerlink\" title=\"基本命令\"></a>基本命令</h2><h3 id=\"编译\"><a href=\"#编译\" class=\"headerlink\" title=\"编译\"></a>编译</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn compile　</span><br></pre></td></tr></table></figure>\n\n<p>  –src&#x2F;main&#x2F;java目录java源码编译生成class （target目录下）</p>\n<p>　　　　　　　　　　</p>\n<h3 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn test　</span><br></pre></td></tr></table></figure>\n\n<p>   –src&#x2F;test&#x2F;java 目录编译</p>\n<p>　　　　　　　　　　</p>\n<h3 id=\"清理\"><a href=\"#清理\" class=\"headerlink\" title=\"清理\"></a>清理</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn clean</span><br></pre></td></tr></table></figure>\n\n<p>  –删除target目录，也就是将class文件等删除</p>\n<p>　　　　　　　　　　</p>\n<h3 id=\"打包\"><a href=\"#打包\" class=\"headerlink\" title=\"打包\"></a>打包</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn package　</span><br></pre></td></tr></table></figure>\n\n<p> –生成压缩文件：java项目#jar包；web项目#war包，也是放在target目录下</p>\n<p>　　　　　　　　　　</p>\n<h3 id=\"安装-1\"><a href=\"#安装-1\" class=\"headerlink\" title=\"安装\"></a>安装</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn install　　</span><br></pre></td></tr></table></figure>\n\n<p>–将压缩文件(jar或者war)上传到本地仓库</p>\n<p>　　　　　　　　　　</p>\n<h3 id=\"部署-发布\"><a href=\"#部署-发布\" class=\"headerlink\" title=\"部署|发布\"></a>部署|发布</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn deploy　　</span><br></pre></td></tr></table></figure>\n\n<p>–将压缩文件上传私服</p>\n<h3 id=\"多模块\"><a href=\"#多模块\" class=\"headerlink\" title=\"多模块\"></a><a href=\"#idmore\">多模块</a></h3><p>场景:几百个微服务只打部分包</p>","more":"<h3 id=\"周期\"><a href=\"#周期\" class=\"headerlink\" title=\"周期\"></a>周期</h3><table>\n<thead>\n<tr>\n<th><strong>验证（validate）</strong></th>\n<th>验证项目是正确的，所有必要的信息可用。</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>初始化（initialize）</strong></td>\n<td>初始化构建状态，例如设置属性或创建目录。</td>\n</tr>\n<tr>\n<td><strong>产生来源（generate-sources）</strong></td>\n<td>生成包含在编译中的任何源代码。</td>\n</tr>\n<tr>\n<td><strong>流程源（process-sources）</strong></td>\n<td>处理源代码，例如过滤任何值。</td>\n</tr>\n<tr>\n<td><strong>生成资源（generate-resources）</strong></td>\n<td>生成包含在包中的资源。</td>\n</tr>\n<tr>\n<td><strong>流程资源（process-resources）</strong></td>\n<td>将资源复制并处理到目标目录中，准备打包。</td>\n</tr>\n<tr>\n<td><strong>编译（compile）</strong></td>\n<td>编译项目的源代码。</td>\n</tr>\n<tr>\n<td><strong>工艺类（process-classes）</strong></td>\n<td>从编译后处理生成的文件，例如对Java类进行字节码增强。</td>\n</tr>\n<tr>\n<td><strong>生成测试来源（generate-test-sources）</strong></td>\n<td>生成包含在编译中的任何测试源代码。</td>\n</tr>\n<tr>\n<td><strong>流程测试来源（process-test-sources）</strong></td>\n<td>处理测试源代码，例如过滤任何值。</td>\n</tr>\n<tr>\n<td><strong>生成测试资源（generate-test-resources）</strong></td>\n<td>创建测试资源。</td>\n</tr>\n<tr>\n<td><strong>流程测试资源（process-test-resources）</strong></td>\n<td>将资源复制并处理到测试目标目录中。</td>\n</tr>\n<tr>\n<td><strong>测试编译（test-compile）</strong></td>\n<td>将测试源代码编译到测试目标目录中</td>\n</tr>\n<tr>\n<td><strong>流程检验类（process-test-classes）</strong></td>\n<td>从测试编译中处理生成的文件，例如对Java类进行字节码增强。对于Maven 2.0.5及以上版本。</td>\n</tr>\n<tr>\n<td><strong>测试（test）</strong></td>\n<td>使用合适的单元测试框架运行测试。这些测试不应该要求代码被打包或部署。</td>\n</tr>\n<tr>\n<td><strong>制备包（prepare-package）</strong></td>\n<td>在实际包装之前，执行必要的准备包装的操作。这通常会导致打包的处理版本的包。（Maven 2.1及以上）</td>\n</tr>\n<tr>\n<td><strong>打包（package）</strong></td>\n<td>采取编译的代码，并以其可分发的格式（如JAR）进行打包。</td>\n</tr>\n<tr>\n<td><strong>预集成测试（pre-integration-test）</strong></td>\n<td>在执行集成测试之前执行所需的操作。这可能涉及诸如设置所需环境等。</td>\n</tr>\n<tr>\n<td><strong>集成测试（integration-test）</strong></td>\n<td>如果需要，可以将该包过程并部署到可以运行集成测试的环境中。</td>\n</tr>\n<tr>\n<td><strong>整合后的测试（post-integration-test）</strong></td>\n<td>执行集成测试后执行所需的操作。这可能包括清理环境。</td>\n</tr>\n<tr>\n<td><strong>校验（verify）</strong></td>\n<td>运行任何检查以验证包装是否有效并符合质量标准。</td>\n</tr>\n<tr>\n<td><strong>安装（install）</strong></td>\n<td>将软件包安装到本地存储库中，以作为本地其他项目的依赖关系。</td>\n</tr>\n<tr>\n<td><strong>部署（deploy）</strong></td>\n<td>在集成或发布环境中完成，将最终软件包复制到远程存储库，以与其他开发人员和项目共享。</td>\n</tr>\n</tbody></table>\n<h2 id=\"高级命令\"><a href=\"#高级命令\" class=\"headerlink\" title=\"高级命令\"></a>高级命令</h2><p>在<a id=\"idmore\">多模块</a>Maven项目中，反应堆（Reactor）是一个包含了所有需要构建模块的抽象概念，对于Maven用户来说，主要关心的是两点：</p>\n<ol>\n<li>哪些模块会被包含到反应堆中？</li>\n<li>反应堆中所有模块的构建顺序是什么？</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ tree -L 3 -P *xml -I &quot;src|target&quot; ./spring-boot/</span><br><span class=\"line\">./spring-boot/</span><br><span class=\"line\">├── cs-framework</span><br><span class=\"line\">│   ├── cs-msc</span><br><span class=\"line\">│   │   ├── lib</span><br><span class=\"line\">│   │   ├── msc</span><br><span class=\"line\">│   │   └── pom.xml</span><br><span class=\"line\">│   ├── cs-ocr</span><br><span class=\"line\">│   │   ├── libs</span><br><span class=\"line\">│   │   └── pom.xml</span><br><span class=\"line\">│   ├── cs-shiro</span><br><span class=\"line\">│   │   └── pom.xml</span><br><span class=\"line\">│   └── pom.xml</span><br><span class=\"line\">├── cs-tool</span><br><span class=\"line\">│   ├── cs-common</span><br><span class=\"line\">│   │   └── pom.xml</span><br><span class=\"line\">│   ├── cs-email</span><br><span class=\"line\">│   │   └── pom.xml</span><br><span class=\"line\">│   ├── cs-jpa</span><br><span class=\"line\">│   │   └── pom.xml</span><br><span class=\"line\">│   ├── cs-rw-aop</span><br><span class=\"line\">│   │   └── pom.xml</span><br><span class=\"line\">│   ├── cs-rw-druid</span><br><span class=\"line\">│   │   └── pom.xml</span><br><span class=\"line\">│   └── pom.xml</span><br><span class=\"line\">└── pom.xml</span><br></pre></td></tr></table></figure>\n\n\n\n<p>一级</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.cs<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>cs-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">modules</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>cs-framework<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>cs-tool<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">modules</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>cs-parent<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>二级</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.cs<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>cs-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.cs<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>cs-framework<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>cs-framework<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">modules</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>cs-shiro<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>cs-ocr<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>cs-msc<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">modules</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>子</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.cs<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>cs-framework<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.cs<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>cs-ocr<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>cs-ocr<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[INFO] ------------------------------------------------------------------------</span><br><span class=\"line\">[INFO] Reactor Summary for cs-parent 0.0.1-SNAPSHOT:</span><br><span class=\"line\">[INFO] </span><br><span class=\"line\">[INFO] cs-parent .......................................... SUCCESS [  0.163 s]</span><br><span class=\"line\">[INFO] cs-tool ............................................ SUCCESS [  0.005 s]</span><br><span class=\"line\">[INFO] cs-common .......................................... SUCCESS [  0.800 s]</span><br><span class=\"line\">[INFO] cs-framework ....................................... SUCCESS [  0.006 s]</span><br><span class=\"line\">[INFO] cs-ocr ............................................. SUCCESS [  3.194 s]</span><br><span class=\"line\">[INFO] cs-msc ............................................. SUCCESS [  0.271 s]</span><br><span class=\"line\">[INFO] cs-jpa ............................................. SUCCESS [  0.471 s]</span><br><span class=\"line\">[INFO] cs-rw-aop .......................................... SUCCESS [  1.074 s]</span><br><span class=\"line\">[INFO] cs-rw-druid ........................................ SUCCESS [  0.893 s]</span><br><span class=\"line\">[INFO] cs-email ........................................... SUCCESS [  2.520 s]</span><br><span class=\"line\">[INFO] ------------------------------------------------------------------------</span><br><span class=\"line\">[INFO] BUILD SUCCESS</span><br><span class=\"line\">[INFO] ------------------------------------------------------------------------</span><br><span class=\"line\">[INFO] Total time:  9.736 s</span><br><span class=\"line\">[INFO] Finished at: 2022-07-30T21:51:32+08:00</span><br><span class=\"line\">[INFO] ------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"指定-pl\"><a href=\"#指定-pl\" class=\"headerlink\" title=\"指定 -pl\"></a>指定 -pl</h3><p>手动选择项目，多个逗号隔开</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn install -pl web/style,web/login</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>-pl,–projects <arg><br>Build specified reactor projects instead of all projects.<br>A project can be specified by [groupId]:artifactId or by its relative path.</p>\n</blockquote>\n<h3 id=\"所需依赖-am\"><a href=\"#所需依赖-am\" class=\"headerlink\" title=\"所需依赖 -am\"></a>所需依赖 -am</h3><p>构建某个子模块</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn install -pl web/style  -am</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>项目被指定，构建该项目所需依赖</p>\n<p>-am,–also-make<br> If project list is specified, also  build projects required by the  list</p>\n</blockquote>\n<p>构建 parent ，framework, web, redis ,style</p>\n<h3 id=\"依赖该模块-amd\"><a href=\"#依赖该模块-amd\" class=\"headerlink\" title=\"依赖该模块 -amd\"></a>依赖该模块 -amd</h3><p>构建父模块，公用模块</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn install -pl web/redis  -amd</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>项目被指定，构建依赖该模块的模块 </p>\n<p>-amd,–also-make-dependents<br>   If project list is specified, also  build projects that depend on projects on the list</p>\n</blockquote>\n<p>构建 redis, login, style</p>\n<h3 id=\"裁剪-rf\"><a href=\"#裁剪-rf\" class=\"headerlink\" title=\"裁剪 -rf\"></a>裁剪 -rf</h3><p>在前命令裁剪基础上，从rf指定模块开始构建</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn install -pl web/style  -am -rf  web/redis</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>从原有构建过程中裁剪反应堆，去掉指定模块原有构建顺序的前面部分</p>\n<p>-rf,–resume-from <arg><br>Resume reactor from specified  project</p>\n</blockquote>\n<p>构建 redis style</p>\n<h2 id=\"错误\"><a href=\"#错误\" class=\"headerlink\" title=\"错误\"></a>错误</h2><h3 id=\"find-main-class\"><a href=\"#find-main-class\" class=\"headerlink\" title=\"find main class\"></a>find main class</h3><p> repackage failed: Unable to find main class</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;build&gt;</span><br><span class=\"line\">       &lt;plugins&gt;</span><br><span class=\"line\">           &lt;plugin&gt;</span><br><span class=\"line\">               &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">               &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class=\"line\">               &lt;executions&gt;</span><br><span class=\"line\">                   &lt;execution&gt;</span><br><span class=\"line\">                       &lt;phase&gt;none&lt;/phase&gt;</span><br><span class=\"line\">                   &lt;/execution&gt;</span><br><span class=\"line\">               &lt;/executions&gt;</span><br><span class=\"line\">           &lt;/plugin&gt;</span><br><span class=\"line\">       &lt;/plugins&gt;</span><br><span class=\"line\">  &lt;/build&gt;</span><br></pre></td></tr></table></figure>"},{"title":"live","date":"2017-02-08T16:08:06.000Z","_content":"Redis live\n Redis Live是一个用来监控redis实例,分析查询语句并且有web界面的监控工具,使用python编写\n#### Install Dependencies\n* **tornado** pip install tornado\n* **redis.py** pip install redis\n* **python-dateutil** pip install python-dateutil\n if you're running Python < 2.7:\n*  ** argparse** pip install argparse\n官方说明： http://www.nkrode.com/article/real-time-dashboard-for-redis\n <!--more--> \n#### pip\n下载地址:  https://pypi.python.org/pypi/pip#downloads\npip 依赖 setuptools\nFinished processing dependencies for setuptools==32.3.1\n\n```bash\n$tar -zxvf  pip-9.0.1.tar.gz\n$python setup.py build \n$sudo python setup.py install\nFinished processing dependencies for pip==9.0.1\n```\n\n\n\nFinished processing dependencies for python-dateutil==2.6.0\n\n\nFinished processing dependencies for redis==2.10.5\n\n```\n$sudo apt-get install build-essential python-dev\n```\nDpkg: Warning: ** ldconfig ** could not be found in the PATH environment variable or no executable privileges\nTip: The root PATH environment variable should normally contain ** / usr / local / sbin, / usr / sbin, and / sbin **\n```bash\n$locate ldconfig   #sbin目录存在 ldconfig\n$sudo mousepad ~/.bashrc\nexport PATH=/usr/loca/sbin:/usr/sbin:/sbin:$PATH\n$source ~/.bashrc\n```\n\nFinished processing dependencies for tornado==4.5.dev1\n\n列出安装的packages\n```\n$ sudo pip freeze\n```\n\n####  redislive\n```\ngit clone https://github.com/kumarnitin/RedisLive.git\n```\n配置文件**redis-live.conf**【redis-live.conf.example】\n```\n{\n\t\"RedisServers\":\n\t[ \n\t\t{\n  \t\t\t\"server\": \"154.17.59.99\",\n  \t\t\t\"port\" : 6379\n\t\t},\n\t\t\n\t\t{\n  \t\t\t\"server\": \"localhost\",\n  \t\t\t\"port\" : 6380,\n  \t\t\t\"password\" : \"some-password\"\n\t\t}\t\t\n\t],\n\n\t\"DataStoreType\" : \"redis\",\n\n\t\"RedisStatsServer\":\n\t{\n\t\t\"server\" : \"ec2-184-72-166-144.compute-1.amazonaws.com\",\n\t\t\"port\" : 6385\n\t},\n\t\n\t\"SqliteStatsStore\" :\n\t{\n\t\t\"path\":  \"to your sql lite file\"\n\t}\n}\n```\n启动服务\n```\n./redis-monitor.py --duration=30     //启动监控，duration是心跳时间\n./redis-live.py                    //启动web服务，默认监听8888端口\n```\n**env: ...py 权限不够**\n给予执行权\n```\nchmod +x  redis-monitor.py\nchmod +x  redis-live.py \n```\n打开 http://localhost:8888/index.html","source":"_posts/tool/redis-live.md","raw":"---\ntitle: live\ndate: 2017-02-09 00:08:06\ntags:\n - redis\n - 监控工具\n - install\ncategories:\n - nosql\n - redis\n---\nRedis live\n Redis Live是一个用来监控redis实例,分析查询语句并且有web界面的监控工具,使用python编写\n#### Install Dependencies\n* **tornado** pip install tornado\n* **redis.py** pip install redis\n* **python-dateutil** pip install python-dateutil\n if you're running Python < 2.7:\n*  ** argparse** pip install argparse\n官方说明： http://www.nkrode.com/article/real-time-dashboard-for-redis\n <!--more--> \n#### pip\n下载地址:  https://pypi.python.org/pypi/pip#downloads\npip 依赖 setuptools\nFinished processing dependencies for setuptools==32.3.1\n\n```bash\n$tar -zxvf  pip-9.0.1.tar.gz\n$python setup.py build \n$sudo python setup.py install\nFinished processing dependencies for pip==9.0.1\n```\n\n\n\nFinished processing dependencies for python-dateutil==2.6.0\n\n\nFinished processing dependencies for redis==2.10.5\n\n```\n$sudo apt-get install build-essential python-dev\n```\nDpkg: Warning: ** ldconfig ** could not be found in the PATH environment variable or no executable privileges\nTip: The root PATH environment variable should normally contain ** / usr / local / sbin, / usr / sbin, and / sbin **\n```bash\n$locate ldconfig   #sbin目录存在 ldconfig\n$sudo mousepad ~/.bashrc\nexport PATH=/usr/loca/sbin:/usr/sbin:/sbin:$PATH\n$source ~/.bashrc\n```\n\nFinished processing dependencies for tornado==4.5.dev1\n\n列出安装的packages\n```\n$ sudo pip freeze\n```\n\n####  redislive\n```\ngit clone https://github.com/kumarnitin/RedisLive.git\n```\n配置文件**redis-live.conf**【redis-live.conf.example】\n```\n{\n\t\"RedisServers\":\n\t[ \n\t\t{\n  \t\t\t\"server\": \"154.17.59.99\",\n  \t\t\t\"port\" : 6379\n\t\t},\n\t\t\n\t\t{\n  \t\t\t\"server\": \"localhost\",\n  \t\t\t\"port\" : 6380,\n  \t\t\t\"password\" : \"some-password\"\n\t\t}\t\t\n\t],\n\n\t\"DataStoreType\" : \"redis\",\n\n\t\"RedisStatsServer\":\n\t{\n\t\t\"server\" : \"ec2-184-72-166-144.compute-1.amazonaws.com\",\n\t\t\"port\" : 6385\n\t},\n\t\n\t\"SqliteStatsStore\" :\n\t{\n\t\t\"path\":  \"to your sql lite file\"\n\t}\n}\n```\n启动服务\n```\n./redis-monitor.py --duration=30     //启动监控，duration是心跳时间\n./redis-live.py                    //启动web服务，默认监听8888端口\n```\n**env: ...py 权限不够**\n给予执行权\n```\nchmod +x  redis-monitor.py\nchmod +x  redis-live.py \n```\n打开 http://localhost:8888/index.html","slug":"tool/redis-live","published":1,"updated":"2022-06-03T08:37:24.087Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtsv0012gwi5heta5p5x","content":"<p>Redis live<br> Redis Live是一个用来监控redis实例,分析查询语句并且有web界面的监控工具,使用python编写</p>\n<h4 id=\"Install-Dependencies\"><a href=\"#Install-Dependencies\" class=\"headerlink\" title=\"Install Dependencies\"></a>Install Dependencies</h4><ul>\n<li><strong>tornado</strong> pip install tornado</li>\n<li><strong>redis.py</strong> pip install redis</li>\n<li><strong>python-dateutil</strong> pip install python-dateutil<br> if you’re running Python &lt; 2.7:</li>\n<li>** argparse** pip install argparse<br>官方说明： <a href=\"http://www.nkrode.com/article/real-time-dashboard-for-redis\">http://www.nkrode.com/article/real-time-dashboard-for-redis</a> <span id=\"more\"></span></li>\n</ul>\n<h4 id=\"pip\"><a href=\"#pip\" class=\"headerlink\" title=\"pip\"></a>pip</h4><p>下载地址:  <a href=\"https://pypi.python.org/pypi/pip#downloads\">https://pypi.python.org/pypi/pip#downloads</a><br>pip 依赖 setuptools<br>Finished processing dependencies for setuptools&#x3D;&#x3D;32.3.1</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$tar</span> -zxvf  pip-9.0.1.tar.gz</span><br><span class=\"line\"><span class=\"variable\">$python</span> setup.py build </span><br><span class=\"line\"><span class=\"variable\">$sudo</span> python setup.py install</span><br><span class=\"line\">Finished processing dependencies <span class=\"keyword\">for</span> pip==9.0.1</span><br></pre></td></tr></table></figure>\n\n\n\n<p>Finished processing dependencies for python-dateutil&#x3D;&#x3D;2.6.0</p>\n<p>Finished processing dependencies for redis&#x3D;&#x3D;2.10.5</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$sudo apt-get install build-essential python-dev</span><br></pre></td></tr></table></figure>\n<p>Dpkg: Warning: ** ldconfig ** could not be found in the PATH environment variable or no executable privileges<br>Tip: The root PATH environment variable should normally contain ** &#x2F; usr &#x2F; local &#x2F; sbin, &#x2F; usr &#x2F; sbin, and &#x2F; sbin **</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$locate</span> ldconfig   <span class=\"comment\">#sbin目录存在 ldconfig</span></span><br><span class=\"line\"><span class=\"variable\">$sudo</span> mousepad ~/.bashrc</span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=/usr/loca/sbin:/usr/sbin:/sbin:<span class=\"variable\">$PATH</span></span><br><span class=\"line\"><span class=\"variable\">$source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>\n\n<p>Finished processing dependencies for tornado&#x3D;&#x3D;4.5.dev1</p>\n<p>列出安装的packages</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo pip freeze</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"redislive\"><a href=\"#redislive\" class=\"headerlink\" title=\"redislive\"></a>redislive</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/kumarnitin/RedisLive.git</span><br></pre></td></tr></table></figure>\n<p>配置文件<strong>redis-live.conf</strong>【redis-live.conf.example】</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">\t&quot;RedisServers&quot;:</span><br><span class=\"line\">\t[ </span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">  \t\t\t&quot;server&quot;: &quot;154.17.59.99&quot;,</span><br><span class=\"line\">  \t\t\t&quot;port&quot; : 6379</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">  \t\t\t&quot;server&quot;: &quot;localhost&quot;,</span><br><span class=\"line\">  \t\t\t&quot;port&quot; : 6380,</span><br><span class=\"line\">  \t\t\t&quot;password&quot; : &quot;some-password&quot;</span><br><span class=\"line\">\t\t&#125;\t\t</span><br><span class=\"line\">\t],</span><br><span class=\"line\"></span><br><span class=\"line\">\t&quot;DataStoreType&quot; : &quot;redis&quot;,</span><br><span class=\"line\"></span><br><span class=\"line\">\t&quot;RedisStatsServer&quot;:</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t&quot;server&quot; : &quot;ec2-184-72-166-144.compute-1.amazonaws.com&quot;,</span><br><span class=\"line\">\t\t&quot;port&quot; : 6385</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t&quot;SqliteStatsStore&quot; :</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t&quot;path&quot;:  &quot;to your sql lite file&quot;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>启动服务</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./redis-monitor.py --duration=30     //启动监控，duration是心跳时间</span><br><span class=\"line\">./redis-live.py                    //启动web服务，默认监听8888端口</span><br></pre></td></tr></table></figure>\n<p><strong>env: …py 权限不够</strong><br>给予执行权</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod +x  redis-monitor.py</span><br><span class=\"line\">chmod +x  redis-live.py </span><br></pre></td></tr></table></figure>\n<p>打开 <a href=\"http://localhost:8888/index.html\">http://localhost:8888/index.html</a></p>\n","site":{"data":{}},"excerpt":"<p>Redis live<br> Redis Live是一个用来监控redis实例,分析查询语句并且有web界面的监控工具,使用python编写</p>\n<h4 id=\"Install-Dependencies\"><a href=\"#Install-Dependencies\" class=\"headerlink\" title=\"Install Dependencies\"></a>Install Dependencies</h4><ul>\n<li><strong>tornado</strong> pip install tornado</li>\n<li><strong>redis.py</strong> pip install redis</li>\n<li><strong>python-dateutil</strong> pip install python-dateutil<br> if you’re running Python &lt; 2.7:</li>\n<li>** argparse** pip install argparse<br>官方说明： <a href=\"http://www.nkrode.com/article/real-time-dashboard-for-redis\">http://www.nkrode.com/article/real-time-dashboard-for-redis</a>","more":"</li>\n</ul>\n<h4 id=\"pip\"><a href=\"#pip\" class=\"headerlink\" title=\"pip\"></a>pip</h4><p>下载地址:  <a href=\"https://pypi.python.org/pypi/pip#downloads\">https://pypi.python.org/pypi/pip#downloads</a><br>pip 依赖 setuptools<br>Finished processing dependencies for setuptools&#x3D;&#x3D;32.3.1</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$tar</span> -zxvf  pip-9.0.1.tar.gz</span><br><span class=\"line\"><span class=\"variable\">$python</span> setup.py build </span><br><span class=\"line\"><span class=\"variable\">$sudo</span> python setup.py install</span><br><span class=\"line\">Finished processing dependencies <span class=\"keyword\">for</span> pip==9.0.1</span><br></pre></td></tr></table></figure>\n\n\n\n<p>Finished processing dependencies for python-dateutil&#x3D;&#x3D;2.6.0</p>\n<p>Finished processing dependencies for redis&#x3D;&#x3D;2.10.5</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$sudo apt-get install build-essential python-dev</span><br></pre></td></tr></table></figure>\n<p>Dpkg: Warning: ** ldconfig ** could not be found in the PATH environment variable or no executable privileges<br>Tip: The root PATH environment variable should normally contain ** &#x2F; usr &#x2F; local &#x2F; sbin, &#x2F; usr &#x2F; sbin, and &#x2F; sbin **</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$locate</span> ldconfig   <span class=\"comment\">#sbin目录存在 ldconfig</span></span><br><span class=\"line\"><span class=\"variable\">$sudo</span> mousepad ~/.bashrc</span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=/usr/loca/sbin:/usr/sbin:/sbin:<span class=\"variable\">$PATH</span></span><br><span class=\"line\"><span class=\"variable\">$source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>\n\n<p>Finished processing dependencies for tornado&#x3D;&#x3D;4.5.dev1</p>\n<p>列出安装的packages</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo pip freeze</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"redislive\"><a href=\"#redislive\" class=\"headerlink\" title=\"redislive\"></a>redislive</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/kumarnitin/RedisLive.git</span><br></pre></td></tr></table></figure>\n<p>配置文件<strong>redis-live.conf</strong>【redis-live.conf.example】</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">\t&quot;RedisServers&quot;:</span><br><span class=\"line\">\t[ </span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">  \t\t\t&quot;server&quot;: &quot;154.17.59.99&quot;,</span><br><span class=\"line\">  \t\t\t&quot;port&quot; : 6379</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">  \t\t\t&quot;server&quot;: &quot;localhost&quot;,</span><br><span class=\"line\">  \t\t\t&quot;port&quot; : 6380,</span><br><span class=\"line\">  \t\t\t&quot;password&quot; : &quot;some-password&quot;</span><br><span class=\"line\">\t\t&#125;\t\t</span><br><span class=\"line\">\t],</span><br><span class=\"line\"></span><br><span class=\"line\">\t&quot;DataStoreType&quot; : &quot;redis&quot;,</span><br><span class=\"line\"></span><br><span class=\"line\">\t&quot;RedisStatsServer&quot;:</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t&quot;server&quot; : &quot;ec2-184-72-166-144.compute-1.amazonaws.com&quot;,</span><br><span class=\"line\">\t\t&quot;port&quot; : 6385</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t&quot;SqliteStatsStore&quot; :</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t&quot;path&quot;:  &quot;to your sql lite file&quot;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>启动服务</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./redis-monitor.py --duration=30     //启动监控，duration是心跳时间</span><br><span class=\"line\">./redis-live.py                    //启动web服务，默认监听8888端口</span><br></pre></td></tr></table></figure>\n<p><strong>env: …py 权限不够</strong><br>给予执行权</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod +x  redis-monitor.py</span><br><span class=\"line\">chmod +x  redis-live.py </span><br></pre></td></tr></table></figure>\n<p>打开 <a href=\"http://localhost:8888/index.html\">http://localhost:8888/index.html</a></p>"},{"title":"初识jvm","date":"2022-06-11T08:19:56.000Z","_content":"\n## 调优参数\n\n选项 Xms,Xmx,newSize,MaxSize ,PermSize, MaxPermSize\n\nXms(young和old区使用大小)\n\nXmx(young和old区最大承受大小)\n\nnewSize(young区使用大小)\n\nMaxSize(young区最大承受大小)\n\nPermSize(持久区使用大小)\n\nMaxPermSize(持久区最大使用大小)\n\n<!--more-->\n\nsuivivorRatio(设置Eden和survivor比例  默认是8:1)\n\n-Xms：表示java虚拟机堆区内存初始内存分配的大小，通常为操作系统可用内存的1/64大小即可，但仍需按照实际情况进行分配。\n-Xmx：表示java虚拟机堆区内存可被分配的最大上限，通常为操作系统可用内存的1/4大小。\n\n-XX:newSize：表示新生代初始内存的大小，应该小于-Xms的值；\n-XX:MaxnewSize：表示新生代可被分配的内存的最大上限；当然这个值应该小于-Xmx的值；\n\n-XX:PermSize：表示非堆区初始内存分配大小（方法区）\n-XX:MaxPermSize：表示对非堆区分配的内存的最大上限（方法区）。\n\n\n\n## 工作流程\n\n![](/pics/jvm-work-4037.png)\n\n1、编译阶段：首先.java经过javac编译成.class文件\n\n2、加载阶段：然后.class文件经过类的加载器加载到JVM内存。(装载、连接、初始化)\n\n-  先把class的信息读到内存来\n-  会对class的信息进行验证、为类变量分配内存空间并对其赋默认值\n-  执行初始化静态块内容，并且为静态变量进行真正的赋值操作\n\n3、解释阶段：class字节码经过字节码解释器解释成系统可识别的指令码。\n\n4、执行阶段：系统再向硬件设备发送指令码执行操作。\n\n\n\n\n\n## 数据区域\n\n![](/pics/jvm-area-4346.png)\n\n Matespace(元空间)在本地内存区域\n\n> -XX:MetaspaceSize，初始空间大小\n>\n> -XX:MaxMetaspaceSize，最大空间，默认是没有限制的\n\n\n\n## 垃圾回收区域\n\n![](/pics/gc-area-4008.png)\n\n### Yong Generation\n\n负责新接收的对象\n\n默认区域划分8:1\n\n#### Eden   80%\n\nEden区域触发第一次GC\n\n#### Survivor \n\n##### From 10%\n\n上一次MinorGC存活者,等待下次扫描\n\n##### To 10%\n\n一次MinorGC过程后的存活者\n\nMinorGC过程\n\n1. eden,survivorFrom复制到survivorTo,年龄加1\n2. 清空(eden,survivorFrom) \n3. survivorTo 与survivorFrom互换\n\nGC过程中to区满后(或者达到年龄标准,无法储存的某个对象)就移到old区\n\n### Old Generation\n\n存放yong多次GC后仍存活的对象\n\nold空间不足时会触发MajorGC(Full GC)\n\nMajorGC过程\n\n- 先扫描全部,标记存活对象,清除没有标记的对象\n\n### Permanent Generation\n\n静态文件(java类,方法,元数据)\n\n\n\n## 垃圾回收算法\n\n![](/pics/gc-yg-3223.png)\n\n\n\nhttps://zhuanlan.zhihu.com/p/343746128\n\n\n\n\n\n\n\n![](/pics/new-area-3239.png)\n\n","source":"_posts/lang/gc/jvm-gc0.md","raw":"---\ntitle: 初识jvm\npermalink: lang/gc/\ntags:\n  - jvm\ncategories:\n  - lang\n  - gc\ndate: 2022-06-11 16:19:56\n---\n\n## 调优参数\n\n选项 Xms,Xmx,newSize,MaxSize ,PermSize, MaxPermSize\n\nXms(young和old区使用大小)\n\nXmx(young和old区最大承受大小)\n\nnewSize(young区使用大小)\n\nMaxSize(young区最大承受大小)\n\nPermSize(持久区使用大小)\n\nMaxPermSize(持久区最大使用大小)\n\n<!--more-->\n\nsuivivorRatio(设置Eden和survivor比例  默认是8:1)\n\n-Xms：表示java虚拟机堆区内存初始内存分配的大小，通常为操作系统可用内存的1/64大小即可，但仍需按照实际情况进行分配。\n-Xmx：表示java虚拟机堆区内存可被分配的最大上限，通常为操作系统可用内存的1/4大小。\n\n-XX:newSize：表示新生代初始内存的大小，应该小于-Xms的值；\n-XX:MaxnewSize：表示新生代可被分配的内存的最大上限；当然这个值应该小于-Xmx的值；\n\n-XX:PermSize：表示非堆区初始内存分配大小（方法区）\n-XX:MaxPermSize：表示对非堆区分配的内存的最大上限（方法区）。\n\n\n\n## 工作流程\n\n![](/pics/jvm-work-4037.png)\n\n1、编译阶段：首先.java经过javac编译成.class文件\n\n2、加载阶段：然后.class文件经过类的加载器加载到JVM内存。(装载、连接、初始化)\n\n-  先把class的信息读到内存来\n-  会对class的信息进行验证、为类变量分配内存空间并对其赋默认值\n-  执行初始化静态块内容，并且为静态变量进行真正的赋值操作\n\n3、解释阶段：class字节码经过字节码解释器解释成系统可识别的指令码。\n\n4、执行阶段：系统再向硬件设备发送指令码执行操作。\n\n\n\n\n\n## 数据区域\n\n![](/pics/jvm-area-4346.png)\n\n Matespace(元空间)在本地内存区域\n\n> -XX:MetaspaceSize，初始空间大小\n>\n> -XX:MaxMetaspaceSize，最大空间，默认是没有限制的\n\n\n\n## 垃圾回收区域\n\n![](/pics/gc-area-4008.png)\n\n### Yong Generation\n\n负责新接收的对象\n\n默认区域划分8:1\n\n#### Eden   80%\n\nEden区域触发第一次GC\n\n#### Survivor \n\n##### From 10%\n\n上一次MinorGC存活者,等待下次扫描\n\n##### To 10%\n\n一次MinorGC过程后的存活者\n\nMinorGC过程\n\n1. eden,survivorFrom复制到survivorTo,年龄加1\n2. 清空(eden,survivorFrom) \n3. survivorTo 与survivorFrom互换\n\nGC过程中to区满后(或者达到年龄标准,无法储存的某个对象)就移到old区\n\n### Old Generation\n\n存放yong多次GC后仍存活的对象\n\nold空间不足时会触发MajorGC(Full GC)\n\nMajorGC过程\n\n- 先扫描全部,标记存活对象,清除没有标记的对象\n\n### Permanent Generation\n\n静态文件(java类,方法,元数据)\n\n\n\n## 垃圾回收算法\n\n![](/pics/gc-yg-3223.png)\n\n\n\nhttps://zhuanlan.zhihu.com/p/343746128\n\n\n\n\n\n\n\n![](/pics/new-area-3239.png)\n\n","slug":"lang/gc/jvm-gc0","published":1,"updated":"2022-08-28T09:10:00.932Z","__permalink":"lang/gc/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtsx0016gwi54q448qxo","content":"<h2 id=\"调优参数\"><a href=\"#调优参数\" class=\"headerlink\" title=\"调优参数\"></a>调优参数</h2><p>选项 Xms,Xmx,newSize,MaxSize ,PermSize, MaxPermSize</p>\n<p>Xms(young和old区使用大小)</p>\n<p>Xmx(young和old区最大承受大小)</p>\n<p>newSize(young区使用大小)</p>\n<p>MaxSize(young区最大承受大小)</p>\n<p>PermSize(持久区使用大小)</p>\n<p>MaxPermSize(持久区最大使用大小)</p>\n<span id=\"more\"></span>\n\n<p>suivivorRatio(设置Eden和survivor比例  默认是8:1)</p>\n<p>-Xms：表示java虚拟机堆区内存初始内存分配的大小，通常为操作系统可用内存的1&#x2F;64大小即可，但仍需按照实际情况进行分配。<br>-Xmx：表示java虚拟机堆区内存可被分配的最大上限，通常为操作系统可用内存的1&#x2F;4大小。</p>\n<p>-XX:newSize：表示新生代初始内存的大小，应该小于-Xms的值；<br>-XX:MaxnewSize：表示新生代可被分配的内存的最大上限；当然这个值应该小于-Xmx的值；</p>\n<p>-XX:PermSize：表示非堆区初始内存分配大小（方法区）<br>-XX:MaxPermSize：表示对非堆区分配的内存的最大上限（方法区）。</p>\n<h2 id=\"工作流程\"><a href=\"#工作流程\" class=\"headerlink\" title=\"工作流程\"></a>工作流程</h2><p><img src=\"/pics/jvm-work-4037.png\"></p>\n<p>1、编译阶段：首先.java经过javac编译成.class文件</p>\n<p>2、加载阶段：然后.class文件经过类的加载器加载到JVM内存。(装载、连接、初始化)</p>\n<ul>\n<li>先把class的信息读到内存来</li>\n<li>会对class的信息进行验证、为类变量分配内存空间并对其赋默认值</li>\n<li>执行初始化静态块内容，并且为静态变量进行真正的赋值操作</li>\n</ul>\n<p>3、解释阶段：class字节码经过字节码解释器解释成系统可识别的指令码。</p>\n<p>4、执行阶段：系统再向硬件设备发送指令码执行操作。</p>\n<h2 id=\"数据区域\"><a href=\"#数据区域\" class=\"headerlink\" title=\"数据区域\"></a>数据区域</h2><p><img src=\"/pics/jvm-area-4346.png\"></p>\n<p> Matespace(元空间)在本地内存区域</p>\n<blockquote>\n<p>-XX:MetaspaceSize，初始空间大小</p>\n<p>-XX:MaxMetaspaceSize，最大空间，默认是没有限制的</p>\n</blockquote>\n<h2 id=\"垃圾回收区域\"><a href=\"#垃圾回收区域\" class=\"headerlink\" title=\"垃圾回收区域\"></a>垃圾回收区域</h2><p><img src=\"/pics/gc-area-4008.png\"></p>\n<h3 id=\"Yong-Generation\"><a href=\"#Yong-Generation\" class=\"headerlink\" title=\"Yong Generation\"></a>Yong Generation</h3><p>负责新接收的对象</p>\n<p>默认区域划分8:1</p>\n<h4 id=\"Eden-80\"><a href=\"#Eden-80\" class=\"headerlink\" title=\"Eden   80%\"></a>Eden   80%</h4><p>Eden区域触发第一次GC</p>\n<h4 id=\"Survivor\"><a href=\"#Survivor\" class=\"headerlink\" title=\"Survivor\"></a>Survivor</h4><h5 id=\"From-10\"><a href=\"#From-10\" class=\"headerlink\" title=\"From 10%\"></a>From 10%</h5><p>上一次MinorGC存活者,等待下次扫描</p>\n<h5 id=\"To-10\"><a href=\"#To-10\" class=\"headerlink\" title=\"To 10%\"></a>To 10%</h5><p>一次MinorGC过程后的存活者</p>\n<p>MinorGC过程</p>\n<ol>\n<li>eden,survivorFrom复制到survivorTo,年龄加1</li>\n<li>清空(eden,survivorFrom) </li>\n<li>survivorTo 与survivorFrom互换</li>\n</ol>\n<p>GC过程中to区满后(或者达到年龄标准,无法储存的某个对象)就移到old区</p>\n<h3 id=\"Old-Generation\"><a href=\"#Old-Generation\" class=\"headerlink\" title=\"Old Generation\"></a>Old Generation</h3><p>存放yong多次GC后仍存活的对象</p>\n<p>old空间不足时会触发MajorGC(Full GC)</p>\n<p>MajorGC过程</p>\n<ul>\n<li>先扫描全部,标记存活对象,清除没有标记的对象</li>\n</ul>\n<h3 id=\"Permanent-Generation\"><a href=\"#Permanent-Generation\" class=\"headerlink\" title=\"Permanent Generation\"></a>Permanent Generation</h3><p>静态文件(java类,方法,元数据)</p>\n<h2 id=\"垃圾回收算法\"><a href=\"#垃圾回收算法\" class=\"headerlink\" title=\"垃圾回收算法\"></a>垃圾回收算法</h2><p><img src=\"/pics/gc-yg-3223.png\"></p>\n<p><a href=\"https://zhuanlan.zhihu.com/p/343746128\">https://zhuanlan.zhihu.com/p/343746128</a></p>\n<p><img src=\"/pics/new-area-3239.png\"></p>\n","site":{"data":{}},"excerpt":"<h2 id=\"调优参数\"><a href=\"#调优参数\" class=\"headerlink\" title=\"调优参数\"></a>调优参数</h2><p>选项 Xms,Xmx,newSize,MaxSize ,PermSize, MaxPermSize</p>\n<p>Xms(young和old区使用大小)</p>\n<p>Xmx(young和old区最大承受大小)</p>\n<p>newSize(young区使用大小)</p>\n<p>MaxSize(young区最大承受大小)</p>\n<p>PermSize(持久区使用大小)</p>\n<p>MaxPermSize(持久区最大使用大小)</p>","more":"<p>suivivorRatio(设置Eden和survivor比例  默认是8:1)</p>\n<p>-Xms：表示java虚拟机堆区内存初始内存分配的大小，通常为操作系统可用内存的1&#x2F;64大小即可，但仍需按照实际情况进行分配。<br>-Xmx：表示java虚拟机堆区内存可被分配的最大上限，通常为操作系统可用内存的1&#x2F;4大小。</p>\n<p>-XX:newSize：表示新生代初始内存的大小，应该小于-Xms的值；<br>-XX:MaxnewSize：表示新生代可被分配的内存的最大上限；当然这个值应该小于-Xmx的值；</p>\n<p>-XX:PermSize：表示非堆区初始内存分配大小（方法区）<br>-XX:MaxPermSize：表示对非堆区分配的内存的最大上限（方法区）。</p>\n<h2 id=\"工作流程\"><a href=\"#工作流程\" class=\"headerlink\" title=\"工作流程\"></a>工作流程</h2><p><img src=\"/pics/jvm-work-4037.png\"></p>\n<p>1、编译阶段：首先.java经过javac编译成.class文件</p>\n<p>2、加载阶段：然后.class文件经过类的加载器加载到JVM内存。(装载、连接、初始化)</p>\n<ul>\n<li>先把class的信息读到内存来</li>\n<li>会对class的信息进行验证、为类变量分配内存空间并对其赋默认值</li>\n<li>执行初始化静态块内容，并且为静态变量进行真正的赋值操作</li>\n</ul>\n<p>3、解释阶段：class字节码经过字节码解释器解释成系统可识别的指令码。</p>\n<p>4、执行阶段：系统再向硬件设备发送指令码执行操作。</p>\n<h2 id=\"数据区域\"><a href=\"#数据区域\" class=\"headerlink\" title=\"数据区域\"></a>数据区域</h2><p><img src=\"/pics/jvm-area-4346.png\"></p>\n<p> Matespace(元空间)在本地内存区域</p>\n<blockquote>\n<p>-XX:MetaspaceSize，初始空间大小</p>\n<p>-XX:MaxMetaspaceSize，最大空间，默认是没有限制的</p>\n</blockquote>\n<h2 id=\"垃圾回收区域\"><a href=\"#垃圾回收区域\" class=\"headerlink\" title=\"垃圾回收区域\"></a>垃圾回收区域</h2><p><img src=\"/pics/gc-area-4008.png\"></p>\n<h3 id=\"Yong-Generation\"><a href=\"#Yong-Generation\" class=\"headerlink\" title=\"Yong Generation\"></a>Yong Generation</h3><p>负责新接收的对象</p>\n<p>默认区域划分8:1</p>\n<h4 id=\"Eden-80\"><a href=\"#Eden-80\" class=\"headerlink\" title=\"Eden   80%\"></a>Eden   80%</h4><p>Eden区域触发第一次GC</p>\n<h4 id=\"Survivor\"><a href=\"#Survivor\" class=\"headerlink\" title=\"Survivor\"></a>Survivor</h4><h5 id=\"From-10\"><a href=\"#From-10\" class=\"headerlink\" title=\"From 10%\"></a>From 10%</h5><p>上一次MinorGC存活者,等待下次扫描</p>\n<h5 id=\"To-10\"><a href=\"#To-10\" class=\"headerlink\" title=\"To 10%\"></a>To 10%</h5><p>一次MinorGC过程后的存活者</p>\n<p>MinorGC过程</p>\n<ol>\n<li>eden,survivorFrom复制到survivorTo,年龄加1</li>\n<li>清空(eden,survivorFrom) </li>\n<li>survivorTo 与survivorFrom互换</li>\n</ol>\n<p>GC过程中to区满后(或者达到年龄标准,无法储存的某个对象)就移到old区</p>\n<h3 id=\"Old-Generation\"><a href=\"#Old-Generation\" class=\"headerlink\" title=\"Old Generation\"></a>Old Generation</h3><p>存放yong多次GC后仍存活的对象</p>\n<p>old空间不足时会触发MajorGC(Full GC)</p>\n<p>MajorGC过程</p>\n<ul>\n<li>先扫描全部,标记存活对象,清除没有标记的对象</li>\n</ul>\n<h3 id=\"Permanent-Generation\"><a href=\"#Permanent-Generation\" class=\"headerlink\" title=\"Permanent Generation\"></a>Permanent Generation</h3><p>静态文件(java类,方法,元数据)</p>\n<h2 id=\"垃圾回收算法\"><a href=\"#垃圾回收算法\" class=\"headerlink\" title=\"垃圾回收算法\"></a>垃圾回收算法</h2><p><img src=\"/pics/gc-yg-3223.png\"></p>\n<p><a href=\"https://zhuanlan.zhihu.com/p/343746128\">https://zhuanlan.zhihu.com/p/343746128</a></p>\n<p><img src=\"/pics/new-area-3239.png\"></p>"},{"title":"go语法规则","date":"2022-06-03T09:51:33.000Z","_content":"\n\n\n###  声明赋值\n\n**:=**  临时,局部变量\n\n###  方法首字母\n\n类似java,不等同(private 只能当前类访问)\n\n**public** 大写 跨包调用\n\n**private**小写 包内调用\n\n<!--more-->\n\n```go\n##f2.go\npackage t1\n\nimport (\n\t\"fmt\"\n)\n\nvar gloal string = \" 全局\"\n//...可变参函数\nfunc Tfun2(a ...string) (string, string) {\n\ttemp := \" 局部\"\n\tnf(a)\n\treturn a[0] + gloal, a[1] + temp\n}\n\nfunc nf(a []string) {\n    //for i := range a \n    //for _, v := range a \n\tfor i, v := range a {\n\t\tif a[i] == \"dd\" {\n\t\t\tfmt.Println(a, v)\n\t\t}\n\t}\n}\n##f1.go\npackage t1\n\nimport (\n\t\"fmt\"\n)\n\nfunc Tfun1() {\n\ta, b := Tfun2(\"a is\", \"b is\", \"dd\")\n\tfmt.Println(a, b)\n}\n\n##main.go\npackage main\n\nimport (\n\t\"fmt\"\n\tt1 \"go_learn/test\"\n)\n\nfunc main() {\n\tmf()\n}\n\nfunc mf() {\n\tfmt.Println(\"main调用包test fun1\")\n\tt1.Tfun1() //两个返回值\n}\n```\n\n\n\n","source":"_posts/lang/go/go初识.md","raw":"---\ntitle: go语法规则\npermalink: lang/go/\ntags:\n  - 规则\n  - 语法\ncategories:\n  - lang\n  - go\ndate: 2022-06-03 17:51:33\n---\n\n\n\n###  声明赋值\n\n**:=**  临时,局部变量\n\n###  方法首字母\n\n类似java,不等同(private 只能当前类访问)\n\n**public** 大写 跨包调用\n\n**private**小写 包内调用\n\n<!--more-->\n\n```go\n##f2.go\npackage t1\n\nimport (\n\t\"fmt\"\n)\n\nvar gloal string = \" 全局\"\n//...可变参函数\nfunc Tfun2(a ...string) (string, string) {\n\ttemp := \" 局部\"\n\tnf(a)\n\treturn a[0] + gloal, a[1] + temp\n}\n\nfunc nf(a []string) {\n    //for i := range a \n    //for _, v := range a \n\tfor i, v := range a {\n\t\tif a[i] == \"dd\" {\n\t\t\tfmt.Println(a, v)\n\t\t}\n\t}\n}\n##f1.go\npackage t1\n\nimport (\n\t\"fmt\"\n)\n\nfunc Tfun1() {\n\ta, b := Tfun2(\"a is\", \"b is\", \"dd\")\n\tfmt.Println(a, b)\n}\n\n##main.go\npackage main\n\nimport (\n\t\"fmt\"\n\tt1 \"go_learn/test\"\n)\n\nfunc main() {\n\tmf()\n}\n\nfunc mf() {\n\tfmt.Println(\"main调用包test fun1\")\n\tt1.Tfun1() //两个返回值\n}\n```\n\n\n\n","slug":"lang/go/go初识","published":1,"updated":"2022-08-28T09:10:00.932Z","__permalink":"lang/go/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtsy0018gwi5fy88a6h8","content":"<h3 id=\"声明赋值\"><a href=\"#声明赋值\" class=\"headerlink\" title=\"声明赋值\"></a>声明赋值</h3><p><strong>:&#x3D;</strong>  临时,局部变量</p>\n<h3 id=\"方法首字母\"><a href=\"#方法首字母\" class=\"headerlink\" title=\"方法首字母\"></a>方法首字母</h3><p>类似java,不等同(private 只能当前类访问)</p>\n<p><strong>public</strong> 大写 跨包调用</p>\n<p><strong>private</strong>小写 包内调用</p>\n<span id=\"more\"></span>\n\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">##f2.<span class=\"keyword\">go</span></span><br><span class=\"line\"><span class=\"keyword\">package</span> t1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> gloal <span class=\"type\">string</span> = <span class=\"string\">&quot; 全局&quot;</span></span><br><span class=\"line\"><span class=\"comment\">//...可变参函数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Tfun2</span><span class=\"params\">(a ...<span class=\"type\">string</span>)</span></span> (<span class=\"type\">string</span>, <span class=\"type\">string</span>) &#123;</span><br><span class=\"line\">\ttemp := <span class=\"string\">&quot; 局部&quot;</span></span><br><span class=\"line\">\tnf(a)</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> a[<span class=\"number\">0</span>] + gloal, a[<span class=\"number\">1</span>] + temp</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">nf</span><span class=\"params\">(a []<span class=\"type\">string</span>)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//for i := range a </span></span><br><span class=\"line\">    <span class=\"comment\">//for _, v := range a </span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i, v := <span class=\"keyword\">range</span> a &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> a[i] == <span class=\"string\">&quot;dd&quot;</span> &#123;</span><br><span class=\"line\">\t\t\tfmt.Println(a, v)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">##f1.<span class=\"keyword\">go</span></span><br><span class=\"line\"><span class=\"keyword\">package</span> t1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Tfun1</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\ta, b := Tfun2(<span class=\"string\">&quot;a is&quot;</span>, <span class=\"string\">&quot;b is&quot;</span>, <span class=\"string\">&quot;dd&quot;</span>)</span><br><span class=\"line\">\tfmt.Println(a, b)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">##main.<span class=\"keyword\">go</span></span><br><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\tt1 <span class=\"string\">&quot;go_learn/test&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tmf()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">mf</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;main调用包test fun1&quot;</span>)</span><br><span class=\"line\">\tt1.Tfun1() <span class=\"comment\">//两个返回值</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n","site":{"data":{}},"excerpt":"<h3 id=\"声明赋值\"><a href=\"#声明赋值\" class=\"headerlink\" title=\"声明赋值\"></a>声明赋值</h3><p><strong>:&#x3D;</strong>  临时,局部变量</p>\n<h3 id=\"方法首字母\"><a href=\"#方法首字母\" class=\"headerlink\" title=\"方法首字母\"></a>方法首字母</h3><p>类似java,不等同(private 只能当前类访问)</p>\n<p><strong>public</strong> 大写 跨包调用</p>\n<p><strong>private</strong>小写 包内调用</p>","more":"<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">##f2.<span class=\"keyword\">go</span></span><br><span class=\"line\"><span class=\"keyword\">package</span> t1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> gloal <span class=\"type\">string</span> = <span class=\"string\">&quot; 全局&quot;</span></span><br><span class=\"line\"><span class=\"comment\">//...可变参函数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Tfun2</span><span class=\"params\">(a ...<span class=\"type\">string</span>)</span></span> (<span class=\"type\">string</span>, <span class=\"type\">string</span>) &#123;</span><br><span class=\"line\">\ttemp := <span class=\"string\">&quot; 局部&quot;</span></span><br><span class=\"line\">\tnf(a)</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> a[<span class=\"number\">0</span>] + gloal, a[<span class=\"number\">1</span>] + temp</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">nf</span><span class=\"params\">(a []<span class=\"type\">string</span>)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//for i := range a </span></span><br><span class=\"line\">    <span class=\"comment\">//for _, v := range a </span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i, v := <span class=\"keyword\">range</span> a &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> a[i] == <span class=\"string\">&quot;dd&quot;</span> &#123;</span><br><span class=\"line\">\t\t\tfmt.Println(a, v)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">##f1.<span class=\"keyword\">go</span></span><br><span class=\"line\"><span class=\"keyword\">package</span> t1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Tfun1</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\ta, b := Tfun2(<span class=\"string\">&quot;a is&quot;</span>, <span class=\"string\">&quot;b is&quot;</span>, <span class=\"string\">&quot;dd&quot;</span>)</span><br><span class=\"line\">\tfmt.Println(a, b)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">##main.<span class=\"keyword\">go</span></span><br><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\tt1 <span class=\"string\">&quot;go_learn/test&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tmf()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">mf</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;main调用包test fun1&quot;</span>)</span><br><span class=\"line\">\tt1.Tfun1() <span class=\"comment\">//两个返回值</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"stream写法","date":"2022-06-03T09:58:03.000Z","_content":"\n\n\n\n\n\n\n\n\n\n\n```\n  public static void main(String[] args) {\n    ArrayList<String> list = new ArrayList<>(Arrays.asList(\"I\", \"love\", \"you\", \"too\"));\n    for(String str : list){\n        if(str.length()>3)\n            System.out.println(str);\n    }\n    list.forEach(str->System.out.println(str));\n    list.stream().filter(str->str.length()>3).forEach(System.out::println);\n  }\n```\n\n>用stream的filter来替代if/else业务逻辑\n\n\n\n```\nfor(int i=0;i<10;i++){\n    if(....){\n      //...........\n    }else{\n        //.......\n    }\n}\n\nlist.stream().filter().limit(10).foreach();\n```\n\n\n\n## Stream\n\n![](/pics/stream-1.png)\n\n<!--more-->\n\n### 流创建\n\n```\n\nList<String> list = Arrays.asList(\"hello\",\"world\",\"stream\");\n//创建顺序流\nStream<String> stream = list.stream();\n//创建并行流\nStream<String> parallelStream = list.parallelStream();\n```\n\n\n\n#### 静态方法\n\n**`of()、iterate()、generate()`**\n\n```\nStream<String> stream1 = Stream.of(\"I\", \"love\", \"you\", \"too\");\nstream1.forEach(System.out::println);\n\nStream<Integer> stream2 = Stream.iterate(0, i -> i + 2).limit(3);\nstream2.forEach(System.out::println);\n\nStream<Boolean> stream3 = Stream.generate(new Random()::nextBoolean).limit(3);\nstream3.forEach(System.out::println);\n```\n\n\n\n并行流  多线程  把一个内容分成多个数据块 不同线程分别处理每个数据块的流,最后合并(*无序数据处理*)\n\n```\nOptional<Integer> findFirst = list.stream().parallel().filter( x -> x>4 ).findFirst();\n```\n\n> 可以通过`parallel()`把顺序流转换成并行流\n\n![](/pics/stream-type2.png)\n\n\n\n### 中间操作\n\n#### 无状态（Stateless）\n\n指元素的处理不受之前元素的影响\n\n##### filter\n\n**筛选，是按照一定的规则校验流中的元素，将符合条件的元素提取到新的流中的操作**\n\n```\nlist.stream().filter(str->str.length()>3).forEach(System.out::println);\n```\n\n相当于if\n\n##### 映射(map、flatMap、peek)\n\n###### map\n\n```\n List<String> out =  list.stream().\n        map(String::toUpperCase).\n        collect(Collectors.toList());\n System.out.println(out);//[I, LOVE, YOU, TOO]\n```\n\n\n\n```\n    List<Product> list = new ArrayList<>();\n    Test t = new Test();\n\n    list.add(t.new Product(1, \"domestic phone\", new BigDecimal(6899.99)));\n    list.add(t.new Product(2, \"overseas notebook\", new BigDecimal(14989.98)));\n\n    String out =  list.stream().\n     //map(a->a.name.split(\" \")[1]).//phone&&notebook\n    map(a->a.name.replaceAll(\" \", \"-\")).//domestic-phone&&overseas-notebook\n    collect(Collectors.joining(\"&&\"));\n    System.out.println(out);\n```\n\n###### flatMap\n\n```\n    List<String> list = Arrays.asList(\"a:b:c\", \"1:3:5\");\n    List<String> listNew = list.stream().\n            flatMap(s -> Arrays.stream(s.split(\":\")) ).\n            collect(Collectors.toList());\n \n    System.out.println(\"处理前的集合：\" + list);\n    System.out.println(\"处理后的集合：\" + listNew);\n```\n\n>处理前的集合：[a:b:c, 1:3:5]\n>处理后的集合：[a, b, c, 1, 3, 5]\n\n\n\n###### peek\n\n```\n    Stream<String> stream = Stream.of(\"hello\", \"world\");\n    stream.peek(System.out::println).collect(Collectors.toList());\n```\n\n\n\n终端操作。通常分为 **最终的消费** （`foreach` 之类的）和 **归纳** （`collect`）两类。\n\n\n\n#### 有状态（Stateful）\n\n指该操作只有拿到所有元素之后才能继续下去\n\n###### distinct\n\n使用hashCode（）和equals（）方法来获取不同的元素\n\n```\nStream<String> stream = Stream.of(\"1\", \"3\",\"4\",\"10\",\"4\",\"6\",\"23\",\"3\");\nstream.distinct().forEach(System.out::println);\n\n```\n\n\n\n###### sorted\n\n```\n    HashMap<Integer, String> map = new HashMap<>();\n    map.put(1,\"phone\");\n    map.put(2,\"notebook\");\n    map.entrySet().stream().sorted(\n                    Collections.reverseOrder(Map.Entry.comparingByKey())//倒序\n                    //Comparator.comparing(e -> e.getKey())//正序\n            ).forEach(System.out::println);\n```\n\n\n\n###### skip\n\n```\n    Stream<Integer> stream = Stream.of(3,1,10,16,8,4,9);\n    stream.limit(3).skip(2).forEach(System.out::print);\n```\n\n>limit(3)  Iloveyou\n>\n>skip(2)  you\n\n\n\n### 终结操作\n\n#### 短路（Short-circuiting）\n\n指遇到某些符合条件的元素就可以得到最终结果\n\n\n\n###### anyMatch\n\nStream 中只要有一个元素符合传入的 predicate，返回 true\n\n```\nstream.anyMatch(s->s==2)\n```\n\n###### allMatch\n\nStream 中全部元素符合传入的 predicate，返回 true\n\n\n\n###### noneMatch\n\nStream 中没有一个元素符合传入的 predicate，返回 true\n\n\n\n###### findFirst\n\n用于返回满足条件的第一个元素\n\n```\nArrayList<String> list = new ArrayList<>(Arrays.asList(\"I\", \"love\", \"you\", \"too\"));\nSystem.out.println(\n\tlist.stream().filter(s-> s.length()>2).findFirst().get()\n);\n\n```\n\n###### findAny\n\n返回流中的任意元素\n\n```\n    System.out.println(\n            list.parallelStream().filter(s-> s.length()>2).findAny().get()\n    );\n```\n\n>love 或 you\n\n并行数据多返回满足第一个\n\n\n\n#### 非短路（Unshort-circuiting）\n\n指必须处理完所有元素才能得到最终结果\n\n\n\n###### reduce\n\nreduce操作效率不高，因为它创建了大量的中间`String`和`StringBuilder`\n\n```\n list.stream().\n \t \tmap(a->a.name.replaceAll(\" \", \"-\")).\n\t\treduce((str1, str2) -> str1 + \"&&\" + str2).get();\n```\n\n>等价 collect(Collectors.joining(\"&&\"))\n\n\n\n###### toArray\n\n```\n    Product[] array = list.stream().toArray(Product[]::new);\n   //Arrays.stream(array).sorted(Comparator.comparing(s>s.getId())).forEach(System.out::println);\n    Arrays.stream(array).filter(s->s.id>1).forEach(System.out::println);\n```\n\n","source":"_posts/lang/java/stream.md","raw":"---\ntitle: stream写法\npermalink: lang/java/stream/\ntags:\n  - stream\ncategories:\n  - lang\n  - java\ndate: 2022-06-03 17:58:03\n---\n\n\n\n\n\n\n\n\n\n\n\n```\n  public static void main(String[] args) {\n    ArrayList<String> list = new ArrayList<>(Arrays.asList(\"I\", \"love\", \"you\", \"too\"));\n    for(String str : list){\n        if(str.length()>3)\n            System.out.println(str);\n    }\n    list.forEach(str->System.out.println(str));\n    list.stream().filter(str->str.length()>3).forEach(System.out::println);\n  }\n```\n\n>用stream的filter来替代if/else业务逻辑\n\n\n\n```\nfor(int i=0;i<10;i++){\n    if(....){\n      //...........\n    }else{\n        //.......\n    }\n}\n\nlist.stream().filter().limit(10).foreach();\n```\n\n\n\n## Stream\n\n![](/pics/stream-1.png)\n\n<!--more-->\n\n### 流创建\n\n```\n\nList<String> list = Arrays.asList(\"hello\",\"world\",\"stream\");\n//创建顺序流\nStream<String> stream = list.stream();\n//创建并行流\nStream<String> parallelStream = list.parallelStream();\n```\n\n\n\n#### 静态方法\n\n**`of()、iterate()、generate()`**\n\n```\nStream<String> stream1 = Stream.of(\"I\", \"love\", \"you\", \"too\");\nstream1.forEach(System.out::println);\n\nStream<Integer> stream2 = Stream.iterate(0, i -> i + 2).limit(3);\nstream2.forEach(System.out::println);\n\nStream<Boolean> stream3 = Stream.generate(new Random()::nextBoolean).limit(3);\nstream3.forEach(System.out::println);\n```\n\n\n\n并行流  多线程  把一个内容分成多个数据块 不同线程分别处理每个数据块的流,最后合并(*无序数据处理*)\n\n```\nOptional<Integer> findFirst = list.stream().parallel().filter( x -> x>4 ).findFirst();\n```\n\n> 可以通过`parallel()`把顺序流转换成并行流\n\n![](/pics/stream-type2.png)\n\n\n\n### 中间操作\n\n#### 无状态（Stateless）\n\n指元素的处理不受之前元素的影响\n\n##### filter\n\n**筛选，是按照一定的规则校验流中的元素，将符合条件的元素提取到新的流中的操作**\n\n```\nlist.stream().filter(str->str.length()>3).forEach(System.out::println);\n```\n\n相当于if\n\n##### 映射(map、flatMap、peek)\n\n###### map\n\n```\n List<String> out =  list.stream().\n        map(String::toUpperCase).\n        collect(Collectors.toList());\n System.out.println(out);//[I, LOVE, YOU, TOO]\n```\n\n\n\n```\n    List<Product> list = new ArrayList<>();\n    Test t = new Test();\n\n    list.add(t.new Product(1, \"domestic phone\", new BigDecimal(6899.99)));\n    list.add(t.new Product(2, \"overseas notebook\", new BigDecimal(14989.98)));\n\n    String out =  list.stream().\n     //map(a->a.name.split(\" \")[1]).//phone&&notebook\n    map(a->a.name.replaceAll(\" \", \"-\")).//domestic-phone&&overseas-notebook\n    collect(Collectors.joining(\"&&\"));\n    System.out.println(out);\n```\n\n###### flatMap\n\n```\n    List<String> list = Arrays.asList(\"a:b:c\", \"1:3:5\");\n    List<String> listNew = list.stream().\n            flatMap(s -> Arrays.stream(s.split(\":\")) ).\n            collect(Collectors.toList());\n \n    System.out.println(\"处理前的集合：\" + list);\n    System.out.println(\"处理后的集合：\" + listNew);\n```\n\n>处理前的集合：[a:b:c, 1:3:5]\n>处理后的集合：[a, b, c, 1, 3, 5]\n\n\n\n###### peek\n\n```\n    Stream<String> stream = Stream.of(\"hello\", \"world\");\n    stream.peek(System.out::println).collect(Collectors.toList());\n```\n\n\n\n终端操作。通常分为 **最终的消费** （`foreach` 之类的）和 **归纳** （`collect`）两类。\n\n\n\n#### 有状态（Stateful）\n\n指该操作只有拿到所有元素之后才能继续下去\n\n###### distinct\n\n使用hashCode（）和equals（）方法来获取不同的元素\n\n```\nStream<String> stream = Stream.of(\"1\", \"3\",\"4\",\"10\",\"4\",\"6\",\"23\",\"3\");\nstream.distinct().forEach(System.out::println);\n\n```\n\n\n\n###### sorted\n\n```\n    HashMap<Integer, String> map = new HashMap<>();\n    map.put(1,\"phone\");\n    map.put(2,\"notebook\");\n    map.entrySet().stream().sorted(\n                    Collections.reverseOrder(Map.Entry.comparingByKey())//倒序\n                    //Comparator.comparing(e -> e.getKey())//正序\n            ).forEach(System.out::println);\n```\n\n\n\n###### skip\n\n```\n    Stream<Integer> stream = Stream.of(3,1,10,16,8,4,9);\n    stream.limit(3).skip(2).forEach(System.out::print);\n```\n\n>limit(3)  Iloveyou\n>\n>skip(2)  you\n\n\n\n### 终结操作\n\n#### 短路（Short-circuiting）\n\n指遇到某些符合条件的元素就可以得到最终结果\n\n\n\n###### anyMatch\n\nStream 中只要有一个元素符合传入的 predicate，返回 true\n\n```\nstream.anyMatch(s->s==2)\n```\n\n###### allMatch\n\nStream 中全部元素符合传入的 predicate，返回 true\n\n\n\n###### noneMatch\n\nStream 中没有一个元素符合传入的 predicate，返回 true\n\n\n\n###### findFirst\n\n用于返回满足条件的第一个元素\n\n```\nArrayList<String> list = new ArrayList<>(Arrays.asList(\"I\", \"love\", \"you\", \"too\"));\nSystem.out.println(\n\tlist.stream().filter(s-> s.length()>2).findFirst().get()\n);\n\n```\n\n###### findAny\n\n返回流中的任意元素\n\n```\n    System.out.println(\n            list.parallelStream().filter(s-> s.length()>2).findAny().get()\n    );\n```\n\n>love 或 you\n\n并行数据多返回满足第一个\n\n\n\n#### 非短路（Unshort-circuiting）\n\n指必须处理完所有元素才能得到最终结果\n\n\n\n###### reduce\n\nreduce操作效率不高，因为它创建了大量的中间`String`和`StringBuilder`\n\n```\n list.stream().\n \t \tmap(a->a.name.replaceAll(\" \", \"-\")).\n\t\treduce((str1, str2) -> str1 + \"&&\" + str2).get();\n```\n\n>等价 collect(Collectors.joining(\"&&\"))\n\n\n\n###### toArray\n\n```\n    Product[] array = list.stream().toArray(Product[]::new);\n   //Arrays.stream(array).sorted(Comparator.comparing(s>s.getId())).forEach(System.out::println);\n    Arrays.stream(array).filter(s->s.id>1).forEach(System.out::println);\n```\n\n","slug":"lang/java/stream","published":1,"updated":"2022-08-28T09:10:00.932Z","__permalink":"lang/java/stream/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtsz001bgwi5eyub3q23","content":"<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static void main(String[] args) &#123;</span><br><span class=\"line\">  ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;(Arrays.asList(&quot;I&quot;, &quot;love&quot;, &quot;you&quot;, &quot;too&quot;));</span><br><span class=\"line\">  for(String str : list)&#123;</span><br><span class=\"line\">      if(str.length()&gt;3)</span><br><span class=\"line\">          System.out.println(str);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  list.forEach(str-&gt;System.out.println(str));</span><br><span class=\"line\">  list.stream().filter(str-&gt;str.length()&gt;3).forEach(System.out::println);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>用stream的filter来替代if&#x2F;else业务逻辑</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for(int i=0;i&lt;10;i++)&#123;</span><br><span class=\"line\">    if(....)&#123;</span><br><span class=\"line\">      //...........</span><br><span class=\"line\">    &#125;else&#123;</span><br><span class=\"line\">        //.......</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">list.stream().filter().limit(10).foreach();</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"Stream\"><a href=\"#Stream\" class=\"headerlink\" title=\"Stream\"></a>Stream</h2><p><img src=\"/pics/stream-1.png\"></p>\n<span id=\"more\"></span>\n\n<h3 id=\"流创建\"><a href=\"#流创建\" class=\"headerlink\" title=\"流创建\"></a>流创建</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">List&lt;String&gt; list = Arrays.asList(&quot;hello&quot;,&quot;world&quot;,&quot;stream&quot;);</span><br><span class=\"line\">//创建顺序流</span><br><span class=\"line\">Stream&lt;String&gt; stream = list.stream();</span><br><span class=\"line\">//创建并行流</span><br><span class=\"line\">Stream&lt;String&gt; parallelStream = list.parallelStream();</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"静态方法\"><a href=\"#静态方法\" class=\"headerlink\" title=\"静态方法\"></a>静态方法</h4><p><strong><code>of()、iterate()、generate()</code></strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Stream&lt;String&gt; stream1 = Stream.of(&quot;I&quot;, &quot;love&quot;, &quot;you&quot;, &quot;too&quot;);</span><br><span class=\"line\">stream1.forEach(System.out::println);</span><br><span class=\"line\"></span><br><span class=\"line\">Stream&lt;Integer&gt; stream2 = Stream.iterate(0, i -&gt; i + 2).limit(3);</span><br><span class=\"line\">stream2.forEach(System.out::println);</span><br><span class=\"line\"></span><br><span class=\"line\">Stream&lt;Boolean&gt; stream3 = Stream.generate(new Random()::nextBoolean).limit(3);</span><br><span class=\"line\">stream3.forEach(System.out::println);</span><br></pre></td></tr></table></figure>\n\n\n\n<p>并行流  多线程  把一个内容分成多个数据块 不同线程分别处理每个数据块的流,最后合并(<em>无序数据处理</em>)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Optional&lt;Integer&gt; findFirst = list.stream().parallel().filter( x -&gt; x&gt;4 ).findFirst();</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>可以通过<code>parallel()</code>把顺序流转换成并行流</p>\n</blockquote>\n<p><img src=\"/pics/stream-type2.png\"></p>\n<h3 id=\"中间操作\"><a href=\"#中间操作\" class=\"headerlink\" title=\"中间操作\"></a>中间操作</h3><h4 id=\"无状态（Stateless）\"><a href=\"#无状态（Stateless）\" class=\"headerlink\" title=\"无状态（Stateless）\"></a>无状态（Stateless）</h4><p>指元素的处理不受之前元素的影响</p>\n<h5 id=\"filter\"><a href=\"#filter\" class=\"headerlink\" title=\"filter\"></a>filter</h5><p><strong>筛选，是按照一定的规则校验流中的元素，将符合条件的元素提取到新的流中的操作</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">list.stream().filter(str-&gt;str.length()&gt;3).forEach(System.out::println);</span><br></pre></td></tr></table></figure>\n\n<p>相当于if</p>\n<h5 id=\"映射-map、flatMap、peek\"><a href=\"#映射-map、flatMap、peek\" class=\"headerlink\" title=\"映射(map、flatMap、peek)\"></a>映射(map、flatMap、peek)</h5><h6 id=\"map\"><a href=\"#map\" class=\"headerlink\" title=\"map\"></a>map</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">List&lt;String&gt; out =  list.stream().</span><br><span class=\"line\">       map(String::toUpperCase).</span><br><span class=\"line\">       collect(Collectors.toList());</span><br><span class=\"line\">System.out.println(out);//[I, LOVE, YOU, TOO]</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">List&lt;Product&gt; list = new ArrayList&lt;&gt;();</span><br><span class=\"line\">Test t = new Test();</span><br><span class=\"line\"></span><br><span class=\"line\">list.add(t.new Product(1, &quot;domestic phone&quot;, new BigDecimal(6899.99)));</span><br><span class=\"line\">list.add(t.new Product(2, &quot;overseas notebook&quot;, new BigDecimal(14989.98)));</span><br><span class=\"line\"></span><br><span class=\"line\">String out =  list.stream().</span><br><span class=\"line\"> //map(a-&gt;a.name.split(&quot; &quot;)[1]).//phone&amp;&amp;notebook</span><br><span class=\"line\">map(a-&gt;a.name.replaceAll(&quot; &quot;, &quot;-&quot;)).//domestic-phone&amp;&amp;overseas-notebook</span><br><span class=\"line\">collect(Collectors.joining(&quot;&amp;&amp;&quot;));</span><br><span class=\"line\">System.out.println(out);</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"flatMap\"><a href=\"#flatMap\" class=\"headerlink\" title=\"flatMap\"></a>flatMap</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">List&lt;String&gt; list = Arrays.asList(&quot;a:b:c&quot;, &quot;1:3:5&quot;);</span><br><span class=\"line\">List&lt;String&gt; listNew = list.stream().</span><br><span class=\"line\">        flatMap(s -&gt; Arrays.stream(s.split(&quot;:&quot;)) ).</span><br><span class=\"line\">        collect(Collectors.toList());</span><br><span class=\"line\"> </span><br><span class=\"line\">System.out.println(&quot;处理前的集合：&quot; + list);</span><br><span class=\"line\">System.out.println(&quot;处理后的集合：&quot; + listNew);</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>处理前的集合：[a:b:c, 1:3:5]<br>处理后的集合：[a, b, c, 1, 3, 5]</p>\n</blockquote>\n<h6 id=\"peek\"><a href=\"#peek\" class=\"headerlink\" title=\"peek\"></a>peek</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Stream&lt;String&gt; stream = Stream.of(&quot;hello&quot;, &quot;world&quot;);</span><br><span class=\"line\">stream.peek(System.out::println).collect(Collectors.toList());</span><br></pre></td></tr></table></figure>\n\n\n\n<p>终端操作。通常分为 <strong>最终的消费</strong> （<code>foreach</code> 之类的）和 <strong>归纳</strong> （<code>collect</code>）两类。</p>\n<h4 id=\"有状态（Stateful）\"><a href=\"#有状态（Stateful）\" class=\"headerlink\" title=\"有状态（Stateful）\"></a>有状态（Stateful）</h4><p>指该操作只有拿到所有元素之后才能继续下去</p>\n<h6 id=\"distinct\"><a href=\"#distinct\" class=\"headerlink\" title=\"distinct\"></a>distinct</h6><p>使用hashCode（）和equals（）方法来获取不同的元素</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Stream&lt;String&gt; stream = Stream.of(&quot;1&quot;, &quot;3&quot;,&quot;4&quot;,&quot;10&quot;,&quot;4&quot;,&quot;6&quot;,&quot;23&quot;,&quot;3&quot;);</span><br><span class=\"line\">stream.distinct().forEach(System.out::println);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h6 id=\"sorted\"><a href=\"#sorted\" class=\"headerlink\" title=\"sorted\"></a>sorted</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HashMap&lt;Integer, String&gt; map = new HashMap&lt;&gt;();</span><br><span class=\"line\">map.put(1,&quot;phone&quot;);</span><br><span class=\"line\">map.put(2,&quot;notebook&quot;);</span><br><span class=\"line\">map.entrySet().stream().sorted(</span><br><span class=\"line\">                Collections.reverseOrder(Map.Entry.comparingByKey())//倒序</span><br><span class=\"line\">                //Comparator.comparing(e -&gt; e.getKey())//正序</span><br><span class=\"line\">        ).forEach(System.out::println);</span><br></pre></td></tr></table></figure>\n\n\n\n<h6 id=\"skip\"><a href=\"#skip\" class=\"headerlink\" title=\"skip\"></a>skip</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Stream&lt;Integer&gt; stream = Stream.of(3,1,10,16,8,4,9);</span><br><span class=\"line\">stream.limit(3).skip(2).forEach(System.out::print);</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>limit(3)  Iloveyou</p>\n<p>skip(2)  you</p>\n</blockquote>\n<h3 id=\"终结操作\"><a href=\"#终结操作\" class=\"headerlink\" title=\"终结操作\"></a>终结操作</h3><h4 id=\"短路（Short-circuiting）\"><a href=\"#短路（Short-circuiting）\" class=\"headerlink\" title=\"短路（Short-circuiting）\"></a>短路（Short-circuiting）</h4><p>指遇到某些符合条件的元素就可以得到最终结果</p>\n<h6 id=\"anyMatch\"><a href=\"#anyMatch\" class=\"headerlink\" title=\"anyMatch\"></a>anyMatch</h6><p>Stream 中只要有一个元素符合传入的 predicate，返回 true</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stream.anyMatch(s-&gt;s==2)</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"allMatch\"><a href=\"#allMatch\" class=\"headerlink\" title=\"allMatch\"></a>allMatch</h6><p>Stream 中全部元素符合传入的 predicate，返回 true</p>\n<h6 id=\"noneMatch\"><a href=\"#noneMatch\" class=\"headerlink\" title=\"noneMatch\"></a>noneMatch</h6><p>Stream 中没有一个元素符合传入的 predicate，返回 true</p>\n<h6 id=\"findFirst\"><a href=\"#findFirst\" class=\"headerlink\" title=\"findFirst\"></a>findFirst</h6><p>用于返回满足条件的第一个元素</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;(Arrays.asList(&quot;I&quot;, &quot;love&quot;, &quot;you&quot;, &quot;too&quot;));</span><br><span class=\"line\">System.out.println(</span><br><span class=\"line\">\tlist.stream().filter(s-&gt; s.length()&gt;2).findFirst().get()</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h6 id=\"findAny\"><a href=\"#findAny\" class=\"headerlink\" title=\"findAny\"></a>findAny</h6><p>返回流中的任意元素</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">System.out.println(</span><br><span class=\"line\">        list.parallelStream().filter(s-&gt; s.length()&gt;2).findAny().get()</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>love 或 you</p>\n</blockquote>\n<p>并行数据多返回满足第一个</p>\n<h4 id=\"非短路（Unshort-circuiting）\"><a href=\"#非短路（Unshort-circuiting）\" class=\"headerlink\" title=\"非短路（Unshort-circuiting）\"></a>非短路（Unshort-circuiting）</h4><p>指必须处理完所有元素才能得到最终结果</p>\n<h6 id=\"reduce\"><a href=\"#reduce\" class=\"headerlink\" title=\"reduce\"></a>reduce</h6><p>reduce操作效率不高，因为它创建了大量的中间<code>String</code>和<code>StringBuilder</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">list.stream().</span><br><span class=\"line\">\t \tmap(a-&gt;a.name.replaceAll(&quot; &quot;, &quot;-&quot;)).</span><br><span class=\"line\">\treduce((str1, str2) -&gt; str1 + &quot;&amp;&amp;&quot; + str2).get();</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>等价 collect(Collectors.joining(“&amp;&amp;”))</p>\n</blockquote>\n<h6 id=\"toArray\"><a href=\"#toArray\" class=\"headerlink\" title=\"toArray\"></a>toArray</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> Product[] array = list.stream().toArray(Product[]::new);</span><br><span class=\"line\">//Arrays.stream(array).sorted(Comparator.comparing(s&gt;s.getId())).forEach(System.out::println);</span><br><span class=\"line\"> Arrays.stream(array).filter(s-&gt;s.id&gt;1).forEach(System.out::println);</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static void main(String[] args) &#123;</span><br><span class=\"line\">  ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;(Arrays.asList(&quot;I&quot;, &quot;love&quot;, &quot;you&quot;, &quot;too&quot;));</span><br><span class=\"line\">  for(String str : list)&#123;</span><br><span class=\"line\">      if(str.length()&gt;3)</span><br><span class=\"line\">          System.out.println(str);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  list.forEach(str-&gt;System.out.println(str));</span><br><span class=\"line\">  list.stream().filter(str-&gt;str.length()&gt;3).forEach(System.out::println);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>用stream的filter来替代if&#x2F;else业务逻辑</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for(int i=0;i&lt;10;i++)&#123;</span><br><span class=\"line\">    if(....)&#123;</span><br><span class=\"line\">      //...........</span><br><span class=\"line\">    &#125;else&#123;</span><br><span class=\"line\">        //.......</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">list.stream().filter().limit(10).foreach();</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"Stream\"><a href=\"#Stream\" class=\"headerlink\" title=\"Stream\"></a>Stream</h2><p><img src=\"/pics/stream-1.png\"></p>","more":"<h3 id=\"流创建\"><a href=\"#流创建\" class=\"headerlink\" title=\"流创建\"></a>流创建</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">List&lt;String&gt; list = Arrays.asList(&quot;hello&quot;,&quot;world&quot;,&quot;stream&quot;);</span><br><span class=\"line\">//创建顺序流</span><br><span class=\"line\">Stream&lt;String&gt; stream = list.stream();</span><br><span class=\"line\">//创建并行流</span><br><span class=\"line\">Stream&lt;String&gt; parallelStream = list.parallelStream();</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"静态方法\"><a href=\"#静态方法\" class=\"headerlink\" title=\"静态方法\"></a>静态方法</h4><p><strong><code>of()、iterate()、generate()</code></strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Stream&lt;String&gt; stream1 = Stream.of(&quot;I&quot;, &quot;love&quot;, &quot;you&quot;, &quot;too&quot;);</span><br><span class=\"line\">stream1.forEach(System.out::println);</span><br><span class=\"line\"></span><br><span class=\"line\">Stream&lt;Integer&gt; stream2 = Stream.iterate(0, i -&gt; i + 2).limit(3);</span><br><span class=\"line\">stream2.forEach(System.out::println);</span><br><span class=\"line\"></span><br><span class=\"line\">Stream&lt;Boolean&gt; stream3 = Stream.generate(new Random()::nextBoolean).limit(3);</span><br><span class=\"line\">stream3.forEach(System.out::println);</span><br></pre></td></tr></table></figure>\n\n\n\n<p>并行流  多线程  把一个内容分成多个数据块 不同线程分别处理每个数据块的流,最后合并(<em>无序数据处理</em>)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Optional&lt;Integer&gt; findFirst = list.stream().parallel().filter( x -&gt; x&gt;4 ).findFirst();</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>可以通过<code>parallel()</code>把顺序流转换成并行流</p>\n</blockquote>\n<p><img src=\"/pics/stream-type2.png\"></p>\n<h3 id=\"中间操作\"><a href=\"#中间操作\" class=\"headerlink\" title=\"中间操作\"></a>中间操作</h3><h4 id=\"无状态（Stateless）\"><a href=\"#无状态（Stateless）\" class=\"headerlink\" title=\"无状态（Stateless）\"></a>无状态（Stateless）</h4><p>指元素的处理不受之前元素的影响</p>\n<h5 id=\"filter\"><a href=\"#filter\" class=\"headerlink\" title=\"filter\"></a>filter</h5><p><strong>筛选，是按照一定的规则校验流中的元素，将符合条件的元素提取到新的流中的操作</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">list.stream().filter(str-&gt;str.length()&gt;3).forEach(System.out::println);</span><br></pre></td></tr></table></figure>\n\n<p>相当于if</p>\n<h5 id=\"映射-map、flatMap、peek\"><a href=\"#映射-map、flatMap、peek\" class=\"headerlink\" title=\"映射(map、flatMap、peek)\"></a>映射(map、flatMap、peek)</h5><h6 id=\"map\"><a href=\"#map\" class=\"headerlink\" title=\"map\"></a>map</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">List&lt;String&gt; out =  list.stream().</span><br><span class=\"line\">       map(String::toUpperCase).</span><br><span class=\"line\">       collect(Collectors.toList());</span><br><span class=\"line\">System.out.println(out);//[I, LOVE, YOU, TOO]</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">List&lt;Product&gt; list = new ArrayList&lt;&gt;();</span><br><span class=\"line\">Test t = new Test();</span><br><span class=\"line\"></span><br><span class=\"line\">list.add(t.new Product(1, &quot;domestic phone&quot;, new BigDecimal(6899.99)));</span><br><span class=\"line\">list.add(t.new Product(2, &quot;overseas notebook&quot;, new BigDecimal(14989.98)));</span><br><span class=\"line\"></span><br><span class=\"line\">String out =  list.stream().</span><br><span class=\"line\"> //map(a-&gt;a.name.split(&quot; &quot;)[1]).//phone&amp;&amp;notebook</span><br><span class=\"line\">map(a-&gt;a.name.replaceAll(&quot; &quot;, &quot;-&quot;)).//domestic-phone&amp;&amp;overseas-notebook</span><br><span class=\"line\">collect(Collectors.joining(&quot;&amp;&amp;&quot;));</span><br><span class=\"line\">System.out.println(out);</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"flatMap\"><a href=\"#flatMap\" class=\"headerlink\" title=\"flatMap\"></a>flatMap</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">List&lt;String&gt; list = Arrays.asList(&quot;a:b:c&quot;, &quot;1:3:5&quot;);</span><br><span class=\"line\">List&lt;String&gt; listNew = list.stream().</span><br><span class=\"line\">        flatMap(s -&gt; Arrays.stream(s.split(&quot;:&quot;)) ).</span><br><span class=\"line\">        collect(Collectors.toList());</span><br><span class=\"line\"> </span><br><span class=\"line\">System.out.println(&quot;处理前的集合：&quot; + list);</span><br><span class=\"line\">System.out.println(&quot;处理后的集合：&quot; + listNew);</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>处理前的集合：[a:b:c, 1:3:5]<br>处理后的集合：[a, b, c, 1, 3, 5]</p>\n</blockquote>\n<h6 id=\"peek\"><a href=\"#peek\" class=\"headerlink\" title=\"peek\"></a>peek</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Stream&lt;String&gt; stream = Stream.of(&quot;hello&quot;, &quot;world&quot;);</span><br><span class=\"line\">stream.peek(System.out::println).collect(Collectors.toList());</span><br></pre></td></tr></table></figure>\n\n\n\n<p>终端操作。通常分为 <strong>最终的消费</strong> （<code>foreach</code> 之类的）和 <strong>归纳</strong> （<code>collect</code>）两类。</p>\n<h4 id=\"有状态（Stateful）\"><a href=\"#有状态（Stateful）\" class=\"headerlink\" title=\"有状态（Stateful）\"></a>有状态（Stateful）</h4><p>指该操作只有拿到所有元素之后才能继续下去</p>\n<h6 id=\"distinct\"><a href=\"#distinct\" class=\"headerlink\" title=\"distinct\"></a>distinct</h6><p>使用hashCode（）和equals（）方法来获取不同的元素</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Stream&lt;String&gt; stream = Stream.of(&quot;1&quot;, &quot;3&quot;,&quot;4&quot;,&quot;10&quot;,&quot;4&quot;,&quot;6&quot;,&quot;23&quot;,&quot;3&quot;);</span><br><span class=\"line\">stream.distinct().forEach(System.out::println);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h6 id=\"sorted\"><a href=\"#sorted\" class=\"headerlink\" title=\"sorted\"></a>sorted</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HashMap&lt;Integer, String&gt; map = new HashMap&lt;&gt;();</span><br><span class=\"line\">map.put(1,&quot;phone&quot;);</span><br><span class=\"line\">map.put(2,&quot;notebook&quot;);</span><br><span class=\"line\">map.entrySet().stream().sorted(</span><br><span class=\"line\">                Collections.reverseOrder(Map.Entry.comparingByKey())//倒序</span><br><span class=\"line\">                //Comparator.comparing(e -&gt; e.getKey())//正序</span><br><span class=\"line\">        ).forEach(System.out::println);</span><br></pre></td></tr></table></figure>\n\n\n\n<h6 id=\"skip\"><a href=\"#skip\" class=\"headerlink\" title=\"skip\"></a>skip</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Stream&lt;Integer&gt; stream = Stream.of(3,1,10,16,8,4,9);</span><br><span class=\"line\">stream.limit(3).skip(2).forEach(System.out::print);</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>limit(3)  Iloveyou</p>\n<p>skip(2)  you</p>\n</blockquote>\n<h3 id=\"终结操作\"><a href=\"#终结操作\" class=\"headerlink\" title=\"终结操作\"></a>终结操作</h3><h4 id=\"短路（Short-circuiting）\"><a href=\"#短路（Short-circuiting）\" class=\"headerlink\" title=\"短路（Short-circuiting）\"></a>短路（Short-circuiting）</h4><p>指遇到某些符合条件的元素就可以得到最终结果</p>\n<h6 id=\"anyMatch\"><a href=\"#anyMatch\" class=\"headerlink\" title=\"anyMatch\"></a>anyMatch</h6><p>Stream 中只要有一个元素符合传入的 predicate，返回 true</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stream.anyMatch(s-&gt;s==2)</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"allMatch\"><a href=\"#allMatch\" class=\"headerlink\" title=\"allMatch\"></a>allMatch</h6><p>Stream 中全部元素符合传入的 predicate，返回 true</p>\n<h6 id=\"noneMatch\"><a href=\"#noneMatch\" class=\"headerlink\" title=\"noneMatch\"></a>noneMatch</h6><p>Stream 中没有一个元素符合传入的 predicate，返回 true</p>\n<h6 id=\"findFirst\"><a href=\"#findFirst\" class=\"headerlink\" title=\"findFirst\"></a>findFirst</h6><p>用于返回满足条件的第一个元素</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;(Arrays.asList(&quot;I&quot;, &quot;love&quot;, &quot;you&quot;, &quot;too&quot;));</span><br><span class=\"line\">System.out.println(</span><br><span class=\"line\">\tlist.stream().filter(s-&gt; s.length()&gt;2).findFirst().get()</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h6 id=\"findAny\"><a href=\"#findAny\" class=\"headerlink\" title=\"findAny\"></a>findAny</h6><p>返回流中的任意元素</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">System.out.println(</span><br><span class=\"line\">        list.parallelStream().filter(s-&gt; s.length()&gt;2).findAny().get()</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>love 或 you</p>\n</blockquote>\n<p>并行数据多返回满足第一个</p>\n<h4 id=\"非短路（Unshort-circuiting）\"><a href=\"#非短路（Unshort-circuiting）\" class=\"headerlink\" title=\"非短路（Unshort-circuiting）\"></a>非短路（Unshort-circuiting）</h4><p>指必须处理完所有元素才能得到最终结果</p>\n<h6 id=\"reduce\"><a href=\"#reduce\" class=\"headerlink\" title=\"reduce\"></a>reduce</h6><p>reduce操作效率不高，因为它创建了大量的中间<code>String</code>和<code>StringBuilder</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">list.stream().</span><br><span class=\"line\">\t \tmap(a-&gt;a.name.replaceAll(&quot; &quot;, &quot;-&quot;)).</span><br><span class=\"line\">\treduce((str1, str2) -&gt; str1 + &quot;&amp;&amp;&quot; + str2).get();</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>等价 collect(Collectors.joining(“&amp;&amp;”))</p>\n</blockquote>\n<h6 id=\"toArray\"><a href=\"#toArray\" class=\"headerlink\" title=\"toArray\"></a>toArray</h6><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> Product[] array = list.stream().toArray(Product[]::new);</span><br><span class=\"line\">//Arrays.stream(array).sorted(Comparator.comparing(s&gt;s.getId())).forEach(System.out::println);</span><br><span class=\"line\"> Arrays.stream(array).filter(s-&gt;s.id&gt;1).forEach(System.out::println);</span><br></pre></td></tr></table></figure>"},{"title":"pip包管理","date":"2022-07-16T13:21:44.000Z","_content":"\n\n\n## 安装\n\n```\ncs@debian:~/oss/typoraCracker$ sudo apt-get install python3-pip\ncs@debian:~/oss/typoraCracker$ pip3 -V\npip 20.3.4 from /usr/local/lib/python3.5/dist-packages/pip (python 3.5)\n```\n\n\n\n## 升级\n\n```\ncs@debian:~/oss/typoraCracker$ sudo pip3 install --upgrade pip\nCollecting pip\n  Downloading http://mirrors.aliyun.com/pypi/packages/27/79/8a850fe3496446ff0d584327ae44e7500daf6764ca1a382d2d02789accf7/pip-20.3.4-py2.py3-none-any.whl (1.5MB)\n    100% |████████████████████████████████| 1.5MB 5.8MB/s \nInstalling collected packages: pip\n  Found existing installation: pip 9.0.1\n    Not uninstalling pip at /usr/lib/python3/dist-packages, outside environment /usr\nSuccessfully installed pip-20.3.4\n```\n\n\n\n## 国内源\n\n```\n$ pip config set global.index-url https://mirrors.aliyun.com/pypi/simple/\nWriting to ~/.config/pip/pip.conf\n\n```\npip.ini\n\n```\n[global]\ntimeout = 6000\nindex-url = https://pypi.tuna.tsinghua.edu.cn/simple\ntrusted-host = pypi.tuna.tsinghua.edu.cn\n```\n\n\n\n## 卸载\n\n```\nsudo apt-get remove python3-pip\n```\n\n","source":"_posts/lang/python/pip.md","raw":"---\ntitle: pip包管理\npermalink: lang/python/pip/\ntags:\n  - pip\ncategories:\n  - lang\n  - python\ndate: 2022-07-16 21:21:44\n---\n\n\n\n## 安装\n\n```\ncs@debian:~/oss/typoraCracker$ sudo apt-get install python3-pip\ncs@debian:~/oss/typoraCracker$ pip3 -V\npip 20.3.4 from /usr/local/lib/python3.5/dist-packages/pip (python 3.5)\n```\n\n\n\n## 升级\n\n```\ncs@debian:~/oss/typoraCracker$ sudo pip3 install --upgrade pip\nCollecting pip\n  Downloading http://mirrors.aliyun.com/pypi/packages/27/79/8a850fe3496446ff0d584327ae44e7500daf6764ca1a382d2d02789accf7/pip-20.3.4-py2.py3-none-any.whl (1.5MB)\n    100% |████████████████████████████████| 1.5MB 5.8MB/s \nInstalling collected packages: pip\n  Found existing installation: pip 9.0.1\n    Not uninstalling pip at /usr/lib/python3/dist-packages, outside environment /usr\nSuccessfully installed pip-20.3.4\n```\n\n\n\n## 国内源\n\n```\n$ pip config set global.index-url https://mirrors.aliyun.com/pypi/simple/\nWriting to ~/.config/pip/pip.conf\n\n```\npip.ini\n\n```\n[global]\ntimeout = 6000\nindex-url = https://pypi.tuna.tsinghua.edu.cn/simple\ntrusted-host = pypi.tuna.tsinghua.edu.cn\n```\n\n\n\n## 卸载\n\n```\nsudo apt-get remove python3-pip\n```\n\n","slug":"lang/python/pip","published":1,"updated":"2022-08-28T09:10:00.932Z","__permalink":"lang/python/pip/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtt0001egwi5ggg62sqs","content":"<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/typoraCracker$ sudo apt-get install python3-pip</span><br><span class=\"line\">cs@debian:~/oss/typoraCracker$ pip3 -V</span><br><span class=\"line\">pip 20.3.4 from /usr/local/lib/python3.5/dist-packages/pip (python 3.5)</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"升级\"><a href=\"#升级\" class=\"headerlink\" title=\"升级\"></a>升级</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/typoraCracker$ sudo pip3 install --upgrade pip</span><br><span class=\"line\">Collecting pip</span><br><span class=\"line\">  Downloading http://mirrors.aliyun.com/pypi/packages/27/79/8a850fe3496446ff0d584327ae44e7500daf6764ca1a382d2d02789accf7/pip-20.3.4-py2.py3-none-any.whl (1.5MB)</span><br><span class=\"line\">    100% |████████████████████████████████| 1.5MB 5.8MB/s </span><br><span class=\"line\">Installing collected packages: pip</span><br><span class=\"line\">  Found existing installation: pip 9.0.1</span><br><span class=\"line\">    Not uninstalling pip at /usr/lib/python3/dist-packages, outside environment /usr</span><br><span class=\"line\">Successfully installed pip-20.3.4</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"国内源\"><a href=\"#国内源\" class=\"headerlink\" title=\"国内源\"></a>国内源</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ pip config set global.index-url https://mirrors.aliyun.com/pypi/simple/</span><br><span class=\"line\">Writing to ~/.config/pip/pip.conf</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>pip.ini</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[global]</span><br><span class=\"line\">timeout = 6000</span><br><span class=\"line\">index-url = https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class=\"line\">trusted-host = pypi.tuna.tsinghua.edu.cn</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"卸载\"><a href=\"#卸载\" class=\"headerlink\" title=\"卸载\"></a>卸载</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get remove python3-pip</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/typoraCracker$ sudo apt-get install python3-pip</span><br><span class=\"line\">cs@debian:~/oss/typoraCracker$ pip3 -V</span><br><span class=\"line\">pip 20.3.4 from /usr/local/lib/python3.5/dist-packages/pip (python 3.5)</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"升级\"><a href=\"#升级\" class=\"headerlink\" title=\"升级\"></a>升级</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/typoraCracker$ sudo pip3 install --upgrade pip</span><br><span class=\"line\">Collecting pip</span><br><span class=\"line\">  Downloading http://mirrors.aliyun.com/pypi/packages/27/79/8a850fe3496446ff0d584327ae44e7500daf6764ca1a382d2d02789accf7/pip-20.3.4-py2.py3-none-any.whl (1.5MB)</span><br><span class=\"line\">    100% |████████████████████████████████| 1.5MB 5.8MB/s </span><br><span class=\"line\">Installing collected packages: pip</span><br><span class=\"line\">  Found existing installation: pip 9.0.1</span><br><span class=\"line\">    Not uninstalling pip at /usr/lib/python3/dist-packages, outside environment /usr</span><br><span class=\"line\">Successfully installed pip-20.3.4</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"国内源\"><a href=\"#国内源\" class=\"headerlink\" title=\"国内源\"></a>国内源</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ pip config set global.index-url https://mirrors.aliyun.com/pypi/simple/</span><br><span class=\"line\">Writing to ~/.config/pip/pip.conf</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>pip.ini</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[global]</span><br><span class=\"line\">timeout = 6000</span><br><span class=\"line\">index-url = https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class=\"line\">trusted-host = pypi.tuna.tsinghua.edu.cn</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"卸载\"><a href=\"#卸载\" class=\"headerlink\" title=\"卸载\"></a>卸载</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get remove python3-pip</span><br></pre></td></tr></table></figure>\n\n"},{"title":"前置操作/后置操作","date":"2022-08-27T15:24:33.000Z","_content":"\npostman **https://learning.postman.com/docs/writing-scripts/intro-to-scripts/**\n\n设置变量 {{变量名}}，可用于Pre-request Script，Body，request url ,Tests...\n\n\n\n### 前置操作\n\nPre-request-script\n\n![](/pics/test-2022-08-31-21-02.gif)\n\nbody 的json串在图片上仅为展示可以设置变量\n\n#### 设置变量\n\n <!--more--> \n\n##### 字符串\n\n```js\nvar url = \"scripts/pre-request-script\"; \npm.environment.set(\"example\", url.split(\"/\")[0]);\npm.environment.set(\"function\", url.split(\"/\")[1]);\n```\n\n>环境变量 environment ；例如:测试,预发,生产url\n>\n>全局变量 globals；例如:登录token\n\n##### 非字符串\n\n对于数组和对象需要 JSON.stringify() 转换成字符串\n\n###### 设置\n\n```js\nvar array = [1, 2, 3, 4];\npm.environment.set('array', JSON.stringify(array));\n\nvar obj = { a: [1, 2, 3, 4], b: { c: 'val' } };\npm.environment.set('obj', JSON.stringify(obj));\n```\n\n\n\n###### 读取\n\n```js\ntry {\n  var array = JSON.parse(pm.environment.get('array'));\n  var obj = JSON.parse(pm.environment.get('obj'));\n} catch (e) {\n  // 处理异常\n}\n```\n\n\n\n\n\n### 后置操作\n\nTests  \n\n#### 设置token\n\n返回请求头toekn写入环境变量,给其他接口调用\n\n![](/pics/test-2022-08-28-14-48.gif)\n\n```js\n//获取返回header信息,如“Authorization”,\"X-Subject-Token\"\nvar token = pm.response.headers.get(\"X-Subject-Token\");\nconsole.log(token)\npm.environment.set(\"token\",token)\n```\n\n\n\n```js\nvar tk = JSON.parse(responseBody);//pm.response.json();\npm.globals.set(\"token\", tk.data.Token)\n```\n\n>{\n>\n>   \"code\":200,\n>\n>​    \"data\":{\n>\n>​         \"Token\":\"xxxxxxxxxxxx\",\n>\n>​         \"Expired-in\":720000\n>\n>​    }\n>\n>}\n\n\n\n```js\nvar type = pm.response.headers.get(\"Content-Type\");\npm.test('返回类型', function() {\n  pm.expect(type).to.be.contain(\"text/html\");\n});\npm.test('返回结果状态码正常', function() {\n  pm.response.to.have.status(200);\n});\n```\n\n>expect  运行结果    期望结果\n>\n>","source":"_posts/lang/test/tests.md","raw":"---\ntitle: 前置操作/后置操作\npermalink: lang/test/tests/\ntags:\n  - api\n  - request\n  - response\ncategories:\n  - lang\n  - test\ndate: 2022-08-27 23:24:33\n---\n\npostman **https://learning.postman.com/docs/writing-scripts/intro-to-scripts/**\n\n设置变量 {{变量名}}，可用于Pre-request Script，Body，request url ,Tests...\n\n\n\n### 前置操作\n\nPre-request-script\n\n![](/pics/test-2022-08-31-21-02.gif)\n\nbody 的json串在图片上仅为展示可以设置变量\n\n#### 设置变量\n\n <!--more--> \n\n##### 字符串\n\n```js\nvar url = \"scripts/pre-request-script\"; \npm.environment.set(\"example\", url.split(\"/\")[0]);\npm.environment.set(\"function\", url.split(\"/\")[1]);\n```\n\n>环境变量 environment ；例如:测试,预发,生产url\n>\n>全局变量 globals；例如:登录token\n\n##### 非字符串\n\n对于数组和对象需要 JSON.stringify() 转换成字符串\n\n###### 设置\n\n```js\nvar array = [1, 2, 3, 4];\npm.environment.set('array', JSON.stringify(array));\n\nvar obj = { a: [1, 2, 3, 4], b: { c: 'val' } };\npm.environment.set('obj', JSON.stringify(obj));\n```\n\n\n\n###### 读取\n\n```js\ntry {\n  var array = JSON.parse(pm.environment.get('array'));\n  var obj = JSON.parse(pm.environment.get('obj'));\n} catch (e) {\n  // 处理异常\n}\n```\n\n\n\n\n\n### 后置操作\n\nTests  \n\n#### 设置token\n\n返回请求头toekn写入环境变量,给其他接口调用\n\n![](/pics/test-2022-08-28-14-48.gif)\n\n```js\n//获取返回header信息,如“Authorization”,\"X-Subject-Token\"\nvar token = pm.response.headers.get(\"X-Subject-Token\");\nconsole.log(token)\npm.environment.set(\"token\",token)\n```\n\n\n\n```js\nvar tk = JSON.parse(responseBody);//pm.response.json();\npm.globals.set(\"token\", tk.data.Token)\n```\n\n>{\n>\n>   \"code\":200,\n>\n>​    \"data\":{\n>\n>​         \"Token\":\"xxxxxxxxxxxx\",\n>\n>​         \"Expired-in\":720000\n>\n>​    }\n>\n>}\n\n\n\n```js\nvar type = pm.response.headers.get(\"Content-Type\");\npm.test('返回类型', function() {\n  pm.expect(type).to.be.contain(\"text/html\");\n});\npm.test('返回结果状态码正常', function() {\n  pm.response.to.have.status(200);\n});\n```\n\n>expect  运行结果    期望结果\n>\n>","slug":"lang/test/tests","published":1,"updated":"2022-08-31T13:14:27.778Z","__permalink":"lang/test/tests/","_id":"cl7g6gtt1001ggwi50rpfg45y","comments":1,"layout":"post","photos":[],"link":"","content":"<p>postman <strong><a href=\"https://learning.postman.com/docs/writing-scripts/intro-to-scripts/\">https://learning.postman.com/docs/writing-scripts/intro-to-scripts/</a></strong></p>\n<p>设置变量 ，可用于Pre-request Script，Body，request url ,Tests…</p>\n<h3 id=\"前置操作\"><a href=\"#前置操作\" class=\"headerlink\" title=\"前置操作\"></a>前置操作</h3><p>Pre-request-script</p>\n<p><img src=\"/pics/test-2022-08-31-21-02.gif\"></p>\n<p>body 的json串在图片上仅为展示可以设置变量</p>\n<h4 id=\"设置变量\"><a href=\"#设置变量\" class=\"headerlink\" title=\"设置变量\"></a>设置变量</h4> <span id=\"more\"></span> \n\n<h5 id=\"字符串\"><a href=\"#字符串\" class=\"headerlink\" title=\"字符串\"></a>字符串</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> url = <span class=\"string\">&quot;scripts/pre-request-script&quot;</span>; </span><br><span class=\"line\">pm.<span class=\"property\">environment</span>.<span class=\"title function_\">set</span>(<span class=\"string\">&quot;example&quot;</span>, url.<span class=\"title function_\">split</span>(<span class=\"string\">&quot;/&quot;</span>)[<span class=\"number\">0</span>]);</span><br><span class=\"line\">pm.<span class=\"property\">environment</span>.<span class=\"title function_\">set</span>(<span class=\"string\">&quot;function&quot;</span>, url.<span class=\"title function_\">split</span>(<span class=\"string\">&quot;/&quot;</span>)[<span class=\"number\">1</span>]);</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>环境变量 environment ；例如:测试,预发,生产url</p>\n<p>全局变量 globals；例如:登录token</p>\n</blockquote>\n<h5 id=\"非字符串\"><a href=\"#非字符串\" class=\"headerlink\" title=\"非字符串\"></a>非字符串</h5><p>对于数组和对象需要 JSON.stringify() 转换成字符串</p>\n<h6 id=\"设置\"><a href=\"#设置\" class=\"headerlink\" title=\"设置\"></a>设置</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> array = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>];</span><br><span class=\"line\">pm.<span class=\"property\">environment</span>.<span class=\"title function_\">set</span>(<span class=\"string\">&#x27;array&#x27;</span>, <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(array));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; <span class=\"attr\">a</span>: [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>], <span class=\"attr\">b</span>: &#123; <span class=\"attr\">c</span>: <span class=\"string\">&#x27;val&#x27;</span> &#125; &#125;;</span><br><span class=\"line\">pm.<span class=\"property\">environment</span>.<span class=\"title function_\">set</span>(<span class=\"string\">&#x27;obj&#x27;</span>, <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(obj));</span><br></pre></td></tr></table></figure>\n\n\n\n<h6 id=\"读取\"><a href=\"#读取\" class=\"headerlink\" title=\"读取\"></a>读取</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> array = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(pm.<span class=\"property\">environment</span>.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;array&#x27;</span>));</span><br><span class=\"line\">  <span class=\"keyword\">var</span> obj = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(pm.<span class=\"property\">environment</span>.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;obj&#x27;</span>));</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 处理异常</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"后置操作\"><a href=\"#后置操作\" class=\"headerlink\" title=\"后置操作\"></a>后置操作</h3><p>Tests  </p>\n<h4 id=\"设置token\"><a href=\"#设置token\" class=\"headerlink\" title=\"设置token\"></a>设置token</h4><p>返回请求头toekn写入环境变量,给其他接口调用</p>\n<p><img src=\"/pics/test-2022-08-28-14-48.gif\"></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//获取返回header信息,如“Authorization”,&quot;X-Subject-Token&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> token = pm.<span class=\"property\">response</span>.<span class=\"property\">headers</span>.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;X-Subject-Token&quot;</span>);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(token)</span><br><span class=\"line\">pm.<span class=\"property\">environment</span>.<span class=\"title function_\">set</span>(<span class=\"string\">&quot;token&quot;</span>,token)</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> tk = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(responseBody);<span class=\"comment\">//pm.response.json();</span></span><br><span class=\"line\">pm.<span class=\"property\">globals</span>.<span class=\"title function_\">set</span>(<span class=\"string\">&quot;token&quot;</span>, tk.<span class=\"property\">data</span>.<span class=\"property\">Token</span>)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>{</p>\n<p>  “code”:200,</p>\n<p>​    “data”:{</p>\n<p>​         “Token”:”xxxxxxxxxxxx”,</p>\n<p>​         “Expired-in”:720000</p>\n<p>​    }</p>\n<p>}</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> type = pm.<span class=\"property\">response</span>.<span class=\"property\">headers</span>.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;Content-Type&quot;</span>);</span><br><span class=\"line\">pm.<span class=\"title function_\">test</span>(<span class=\"string\">&#x27;返回类型&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  pm.<span class=\"title function_\">expect</span>(type).<span class=\"property\">to</span>.<span class=\"property\">be</span>.<span class=\"title function_\">contain</span>(<span class=\"string\">&quot;text/html&quot;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">pm.<span class=\"title function_\">test</span>(<span class=\"string\">&#x27;返回结果状态码正常&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  pm.<span class=\"property\">response</span>.<span class=\"property\">to</span>.<span class=\"property\">have</span>.<span class=\"title function_\">status</span>(<span class=\"number\">200</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>expect  运行结果    期望结果</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<p>postman <strong><a href=\"https://learning.postman.com/docs/writing-scripts/intro-to-scripts/\">https://learning.postman.com/docs/writing-scripts/intro-to-scripts/</a></strong></p>\n<p>设置变量 ，可用于Pre-request Script，Body，request url ,Tests…</p>\n<h3 id=\"前置操作\"><a href=\"#前置操作\" class=\"headerlink\" title=\"前置操作\"></a>前置操作</h3><p>Pre-request-script</p>\n<p><img src=\"/pics/test-2022-08-31-21-02.gif\"></p>\n<p>body 的json串在图片上仅为展示可以设置变量</p>\n<h4 id=\"设置变量\"><a href=\"#设置变量\" class=\"headerlink\" title=\"设置变量\"></a>设置变量</h4>","more":"<h5 id=\"字符串\"><a href=\"#字符串\" class=\"headerlink\" title=\"字符串\"></a>字符串</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> url = <span class=\"string\">&quot;scripts/pre-request-script&quot;</span>; </span><br><span class=\"line\">pm.<span class=\"property\">environment</span>.<span class=\"title function_\">set</span>(<span class=\"string\">&quot;example&quot;</span>, url.<span class=\"title function_\">split</span>(<span class=\"string\">&quot;/&quot;</span>)[<span class=\"number\">0</span>]);</span><br><span class=\"line\">pm.<span class=\"property\">environment</span>.<span class=\"title function_\">set</span>(<span class=\"string\">&quot;function&quot;</span>, url.<span class=\"title function_\">split</span>(<span class=\"string\">&quot;/&quot;</span>)[<span class=\"number\">1</span>]);</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>环境变量 environment ；例如:测试,预发,生产url</p>\n<p>全局变量 globals；例如:登录token</p>\n</blockquote>\n<h5 id=\"非字符串\"><a href=\"#非字符串\" class=\"headerlink\" title=\"非字符串\"></a>非字符串</h5><p>对于数组和对象需要 JSON.stringify() 转换成字符串</p>\n<h6 id=\"设置\"><a href=\"#设置\" class=\"headerlink\" title=\"设置\"></a>设置</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> array = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>];</span><br><span class=\"line\">pm.<span class=\"property\">environment</span>.<span class=\"title function_\">set</span>(<span class=\"string\">&#x27;array&#x27;</span>, <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(array));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; <span class=\"attr\">a</span>: [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>], <span class=\"attr\">b</span>: &#123; <span class=\"attr\">c</span>: <span class=\"string\">&#x27;val&#x27;</span> &#125; &#125;;</span><br><span class=\"line\">pm.<span class=\"property\">environment</span>.<span class=\"title function_\">set</span>(<span class=\"string\">&#x27;obj&#x27;</span>, <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(obj));</span><br></pre></td></tr></table></figure>\n\n\n\n<h6 id=\"读取\"><a href=\"#读取\" class=\"headerlink\" title=\"读取\"></a>读取</h6><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> array = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(pm.<span class=\"property\">environment</span>.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;array&#x27;</span>));</span><br><span class=\"line\">  <span class=\"keyword\">var</span> obj = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(pm.<span class=\"property\">environment</span>.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;obj&#x27;</span>));</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 处理异常</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"后置操作\"><a href=\"#后置操作\" class=\"headerlink\" title=\"后置操作\"></a>后置操作</h3><p>Tests  </p>\n<h4 id=\"设置token\"><a href=\"#设置token\" class=\"headerlink\" title=\"设置token\"></a>设置token</h4><p>返回请求头toekn写入环境变量,给其他接口调用</p>\n<p><img src=\"/pics/test-2022-08-28-14-48.gif\"></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//获取返回header信息,如“Authorization”,&quot;X-Subject-Token&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> token = pm.<span class=\"property\">response</span>.<span class=\"property\">headers</span>.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;X-Subject-Token&quot;</span>);</span><br><span class=\"line\"><span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(token)</span><br><span class=\"line\">pm.<span class=\"property\">environment</span>.<span class=\"title function_\">set</span>(<span class=\"string\">&quot;token&quot;</span>,token)</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> tk = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(responseBody);<span class=\"comment\">//pm.response.json();</span></span><br><span class=\"line\">pm.<span class=\"property\">globals</span>.<span class=\"title function_\">set</span>(<span class=\"string\">&quot;token&quot;</span>, tk.<span class=\"property\">data</span>.<span class=\"property\">Token</span>)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>{</p>\n<p>  “code”:200,</p>\n<p>​    “data”:{</p>\n<p>​         “Token”:”xxxxxxxxxxxx”,</p>\n<p>​         “Expired-in”:720000</p>\n<p>​    }</p>\n<p>}</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> type = pm.<span class=\"property\">response</span>.<span class=\"property\">headers</span>.<span class=\"title function_\">get</span>(<span class=\"string\">&quot;Content-Type&quot;</span>);</span><br><span class=\"line\">pm.<span class=\"title function_\">test</span>(<span class=\"string\">&#x27;返回类型&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  pm.<span class=\"title function_\">expect</span>(type).<span class=\"property\">to</span>.<span class=\"property\">be</span>.<span class=\"title function_\">contain</span>(<span class=\"string\">&quot;text/html&quot;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">pm.<span class=\"title function_\">test</span>(<span class=\"string\">&#x27;返回结果状态码正常&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  pm.<span class=\"property\">response</span>.<span class=\"property\">to</span>.<span class=\"property\">have</span>.<span class=\"title function_\">status</span>(<span class=\"number\">200</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>expect  运行结果    期望结果</p>\n</blockquote>"},{"title":"apt","date":"2022-07-16T06:26:10.000Z","_content":"\n\n\n## apt-get\n\n\n\n升级\n\n```\napt-get update\t\t\t   // 更新源文件，并不会做任何安装升级操作 \napt-get upgrade\t\t       // 升级所有已安装的包 \n```\n\n安装\n\n```\napt-get install packagename\t\t// 安装指定的包\n```\n\n查询包\n\n```\napt-cache depends packagename   //该包依赖哪些包\n```\n\n列出所有已经安装\n\n```\napt list --installed\n```\n\n\n\n删除\n\n```\napt-get autoremove packagename --purge  //删除包及其依赖的软件包+配置文件等\n```\n\n\n\n清理\n\n```\napt-get clean \t\t\t\t\t\t// 清理无用的包  \napt-get autoclean \t\t\t\t\t// 清理无用的包  \napt-get check \t\t\t\t\t\t// 检查是否有损坏的依赖\n```\n\n\n\n## apt-mark 标记\n\n系统中禁用 Chrome 更新\n\n```\ncs@debian:~$ sudo apt-mark  hold google-chrome-stable\ngoogle-chrome-stable 设置为保留。\n```\n\n> auto\t标记指定软件包为自动安装\n> manual\t标记指定软件包为手动安装\n> minimize-manual\t将 meta 包的所有依赖项标记为自动安装\n> hold\t标记指定软件包为保留（held back），阻止软件自动更新\n> unhold\t取消指定软件包的保留（held back）标记，解除阻止自动更新\n> showauto\t列出所有自动安装的软件包\n> showmanual\t列出所有手动安装的软件包\n> showhold\t列出设为保留的软件包\n\n\n\ncentos\n\n```\necho 'exclude=google-chrome-stable' >> /etc/yum.conf\n```\n\n","source":"_posts/linux/debian/apt.md","raw":"---\n\ntitle: apt\npermalink: linux/debian/apt/\ntags:\n  - apt\ncategories:\n  - linux\n  - debian\ndate: 2022-07-16 14:26:10\n---\n\n\n\n## apt-get\n\n\n\n升级\n\n```\napt-get update\t\t\t   // 更新源文件，并不会做任何安装升级操作 \napt-get upgrade\t\t       // 升级所有已安装的包 \n```\n\n安装\n\n```\napt-get install packagename\t\t// 安装指定的包\n```\n\n查询包\n\n```\napt-cache depends packagename   //该包依赖哪些包\n```\n\n列出所有已经安装\n\n```\napt list --installed\n```\n\n\n\n删除\n\n```\napt-get autoremove packagename --purge  //删除包及其依赖的软件包+配置文件等\n```\n\n\n\n清理\n\n```\napt-get clean \t\t\t\t\t\t// 清理无用的包  \napt-get autoclean \t\t\t\t\t// 清理无用的包  \napt-get check \t\t\t\t\t\t// 检查是否有损坏的依赖\n```\n\n\n\n## apt-mark 标记\n\n系统中禁用 Chrome 更新\n\n```\ncs@debian:~$ sudo apt-mark  hold google-chrome-stable\ngoogle-chrome-stable 设置为保留。\n```\n\n> auto\t标记指定软件包为自动安装\n> manual\t标记指定软件包为手动安装\n> minimize-manual\t将 meta 包的所有依赖项标记为自动安装\n> hold\t标记指定软件包为保留（held back），阻止软件自动更新\n> unhold\t取消指定软件包的保留（held back）标记，解除阻止自动更新\n> showauto\t列出所有自动安装的软件包\n> showmanual\t列出所有手动安装的软件包\n> showhold\t列出设为保留的软件包\n\n\n\ncentos\n\n```\necho 'exclude=google-chrome-stable' >> /etc/yum.conf\n```\n\n","slug":"linux/debian/apt","published":1,"updated":"2022-08-28T09:10:00.948Z","__permalink":"linux/debian/apt/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtt2001kgwi58rvt927l","content":"<h2 id=\"apt-get\"><a href=\"#apt-get\" class=\"headerlink\" title=\"apt-get\"></a>apt-get</h2><p>升级</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get update\t\t\t   // 更新源文件，并不会做任何安装升级操作 </span><br><span class=\"line\">apt-get upgrade\t\t       // 升级所有已安装的包 </span><br></pre></td></tr></table></figure>\n\n<p>安装</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install packagename\t\t// 安装指定的包</span><br></pre></td></tr></table></figure>\n\n<p>查询包</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-cache depends packagename   //该包依赖哪些包</span><br></pre></td></tr></table></figure>\n\n<p>列出所有已经安装</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt list --installed</span><br></pre></td></tr></table></figure>\n\n\n\n<p>删除</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get autoremove packagename --purge  //删除包及其依赖的软件包+配置文件等</span><br></pre></td></tr></table></figure>\n\n\n\n<p>清理</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get clean \t\t\t\t\t\t// 清理无用的包  </span><br><span class=\"line\">apt-get autoclean \t\t\t\t\t// 清理无用的包  </span><br><span class=\"line\">apt-get check \t\t\t\t\t\t// 检查是否有损坏的依赖</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"apt-mark-标记\"><a href=\"#apt-mark-标记\" class=\"headerlink\" title=\"apt-mark 标记\"></a>apt-mark 标记</h2><p>系统中禁用 Chrome 更新</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ sudo apt-mark  hold google-chrome-stable</span><br><span class=\"line\">google-chrome-stable 设置为保留。</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>auto\t标记指定软件包为自动安装<br>manual\t标记指定软件包为手动安装<br>minimize-manual\t将 meta 包的所有依赖项标记为自动安装<br>hold\t标记指定软件包为保留（held back），阻止软件自动更新<br>unhold\t取消指定软件包的保留（held back）标记，解除阻止自动更新<br>showauto\t列出所有自动安装的软件包<br>showmanual\t列出所有手动安装的软件包<br>showhold\t列出设为保留的软件包</p>\n</blockquote>\n<p>centos</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;exclude=google-chrome-stable&#x27; &gt;&gt; /etc/yum.conf</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"apt-get\"><a href=\"#apt-get\" class=\"headerlink\" title=\"apt-get\"></a>apt-get</h2><p>升级</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get update\t\t\t   // 更新源文件，并不会做任何安装升级操作 </span><br><span class=\"line\">apt-get upgrade\t\t       // 升级所有已安装的包 </span><br></pre></td></tr></table></figure>\n\n<p>安装</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install packagename\t\t// 安装指定的包</span><br></pre></td></tr></table></figure>\n\n<p>查询包</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-cache depends packagename   //该包依赖哪些包</span><br></pre></td></tr></table></figure>\n\n<p>列出所有已经安装</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt list --installed</span><br></pre></td></tr></table></figure>\n\n\n\n<p>删除</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get autoremove packagename --purge  //删除包及其依赖的软件包+配置文件等</span><br></pre></td></tr></table></figure>\n\n\n\n<p>清理</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get clean \t\t\t\t\t\t// 清理无用的包  </span><br><span class=\"line\">apt-get autoclean \t\t\t\t\t// 清理无用的包  </span><br><span class=\"line\">apt-get check \t\t\t\t\t\t// 检查是否有损坏的依赖</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"apt-mark-标记\"><a href=\"#apt-mark-标记\" class=\"headerlink\" title=\"apt-mark 标记\"></a>apt-mark 标记</h2><p>系统中禁用 Chrome 更新</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ sudo apt-mark  hold google-chrome-stable</span><br><span class=\"line\">google-chrome-stable 设置为保留。</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>auto\t标记指定软件包为自动安装<br>manual\t标记指定软件包为手动安装<br>minimize-manual\t将 meta 包的所有依赖项标记为自动安装<br>hold\t标记指定软件包为保留（held back），阻止软件自动更新<br>unhold\t取消指定软件包的保留（held back）标记，解除阻止自动更新<br>showauto\t列出所有自动安装的软件包<br>showmanual\t列出所有手动安装的软件包<br>showhold\t列出设为保留的软件包</p>\n</blockquote>\n<p>centos</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;exclude=google-chrome-stable&#x27; &gt;&gt; /etc/yum.conf</span><br></pre></td></tr></table></figure>\n\n"},{"title":"dpkg","date":"2017-02-20T16:09:58.000Z","_content":"### dpkg\n\n\n\n```\napt-get install xxx\n....\nCould not exec dpkg!\nE: Sub-process /usr/bin/dpkg returned an error code (100)\n```\n\n\n```\n ls -l /usr/bin/dpkg #什么没有呀！！！\n find /usr -type f -name dpkg\n .....\n```\n  <!--more--> \n 那执行\n```\n apt-get install dpkg  \n ....\n 显示已安装 **使用方法一**\n```\n\n 搜索 **dpkg debian download **\n [download](https://packages.debian.org/jessie/dpkg)\n\n\n##### 方法一\n```\n ar x  ~/文档/dpkg_1.17.27_amd64.deb data.tar.gz\n \n mkdir /tmp/dpkg\n cp data.tar.gz /tmp/dpkg\n cd /tmp/dpkg\n \n tar xfvz data.tar.gz ./usr/bin/dpkg\n \nsudo cp ./usr/bin/dpkg /usr/bin/\nsudo apt-get update\n```\n#####  方法二\n\n`./configure`\nconfigure: error: libbz2 library or header not found\nSee `config.log' for more details\n安装 **libbz2**\nhttps://packages.debian.org/jessie/libbz2-1.0\n\nconfigure: error: liblzma library or header not found\nSee `config.log' for more details\n安装 **liblzma**\nhttps://packages.debian.org/jessie/liblzma5\n\nconfigure: error: no curses library found\n安装 ** curses  **\nhttps://packages.debian.org/jessie/libncurses5-dev\n\n\n\n#### 参数\n\n##### -i|--install\n\n\n\n##### -r|--remove \n\n\n\nL|--listfiles   <软件包名> ...  列出属于指定软件包的文件。\n\n\n\n##### -l | --list \n\n [<表达式> ...]        简明地列出软件包的状态。\n\n```shell\ncs@debian:~/test$ sudo dpkg -l | grep api\nii  apipost6                             6.1.5                             amd64        \nii  libbrlapi0.6:amd64                   5.4-7+deb9u1                      amd64        braille display access via BRLTTY - shared library\nii  libglapi-mesa:amd64                  13.0.6-1+b2                       amd64        free implementation of the GL API -- shared library\n```\n\n\n\n\n\n### 解压deb\n\n \n\n```\nar x   fileName.deb\n```\n\n\n\n```\nxz -d  data.tar.xz\n```\n\n\n\n```\ntar -zxvf   data.tar.gz\ntar -xvf   data.tar\n```\n\n","source":"_posts/linux/debian/dpkg.md","raw":"---\ntitle: dpkg\ndate: 2017-02-21 00:09:58\ntags:\n - install\n - dpkg\ncategories:\n - linux \n - debian\n - tools\n---\n### dpkg\n\n\n\n```\napt-get install xxx\n....\nCould not exec dpkg!\nE: Sub-process /usr/bin/dpkg returned an error code (100)\n```\n\n\n```\n ls -l /usr/bin/dpkg #什么没有呀！！！\n find /usr -type f -name dpkg\n .....\n```\n  <!--more--> \n 那执行\n```\n apt-get install dpkg  \n ....\n 显示已安装 **使用方法一**\n```\n\n 搜索 **dpkg debian download **\n [download](https://packages.debian.org/jessie/dpkg)\n\n\n##### 方法一\n```\n ar x  ~/文档/dpkg_1.17.27_amd64.deb data.tar.gz\n \n mkdir /tmp/dpkg\n cp data.tar.gz /tmp/dpkg\n cd /tmp/dpkg\n \n tar xfvz data.tar.gz ./usr/bin/dpkg\n \nsudo cp ./usr/bin/dpkg /usr/bin/\nsudo apt-get update\n```\n#####  方法二\n\n`./configure`\nconfigure: error: libbz2 library or header not found\nSee `config.log' for more details\n安装 **libbz2**\nhttps://packages.debian.org/jessie/libbz2-1.0\n\nconfigure: error: liblzma library or header not found\nSee `config.log' for more details\n安装 **liblzma**\nhttps://packages.debian.org/jessie/liblzma5\n\nconfigure: error: no curses library found\n安装 ** curses  **\nhttps://packages.debian.org/jessie/libncurses5-dev\n\n\n\n#### 参数\n\n##### -i|--install\n\n\n\n##### -r|--remove \n\n\n\nL|--listfiles   <软件包名> ...  列出属于指定软件包的文件。\n\n\n\n##### -l | --list \n\n [<表达式> ...]        简明地列出软件包的状态。\n\n```shell\ncs@debian:~/test$ sudo dpkg -l | grep api\nii  apipost6                             6.1.5                             amd64        \nii  libbrlapi0.6:amd64                   5.4-7+deb9u1                      amd64        braille display access via BRLTTY - shared library\nii  libglapi-mesa:amd64                  13.0.6-1+b2                       amd64        free implementation of the GL API -- shared library\n```\n\n\n\n\n\n### 解压deb\n\n \n\n```\nar x   fileName.deb\n```\n\n\n\n```\nxz -d  data.tar.xz\n```\n\n\n\n```\ntar -zxvf   data.tar.gz\ntar -xvf   data.tar\n```\n\n","slug":"linux/debian/dpkg","published":1,"updated":"2022-08-27T09:22:06.401Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtt3001lgwi57hthezr7","content":"<h3 id=\"dpkg\"><a href=\"#dpkg\" class=\"headerlink\" title=\"dpkg\"></a>dpkg</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install xxx</span><br><span class=\"line\">....</span><br><span class=\"line\">Could not exec dpkg!</span><br><span class=\"line\">E: Sub-process /usr/bin/dpkg returned an error code (100)</span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ls -l /usr/bin/dpkg #什么没有呀！！！</span><br><span class=\"line\">find /usr -type f -name dpkg</span><br><span class=\"line\">.....</span><br></pre></td></tr></table></figure>\n  <span id=\"more\"></span> \n<p> 那执行</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install dpkg  </span><br><span class=\"line\">....</span><br><span class=\"line\">显示已安装 **使用方法一**</span><br></pre></td></tr></table></figure>\n\n<p> 搜索 **dpkg debian download **<br> <a href=\"https://packages.debian.org/jessie/dpkg\">download</a></p>\n<h5 id=\"方法一\"><a href=\"#方法一\" class=\"headerlink\" title=\"方法一\"></a>方法一</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> ar x  ~/文档/dpkg_1.17.27_amd64.deb data.tar.gz</span><br><span class=\"line\"> </span><br><span class=\"line\"> mkdir /tmp/dpkg</span><br><span class=\"line\"> cp data.tar.gz /tmp/dpkg</span><br><span class=\"line\"> cd /tmp/dpkg</span><br><span class=\"line\"> </span><br><span class=\"line\"> tar xfvz data.tar.gz ./usr/bin/dpkg</span><br><span class=\"line\"> </span><br><span class=\"line\">sudo cp ./usr/bin/dpkg /usr/bin/</span><br><span class=\"line\">sudo apt-get update</span><br></pre></td></tr></table></figure>\n<h5 id=\"方法二\"><a href=\"#方法二\" class=\"headerlink\" title=\"方法二\"></a>方法二</h5><p><code>./configure</code><br>configure: error: libbz2 library or header not found<br>See &#96;config.log’ for more details<br>安装 <strong>libbz2</strong><br><a href=\"https://packages.debian.org/jessie/libbz2-1.0\">https://packages.debian.org/jessie/libbz2-1.0</a></p>\n<p>configure: error: liblzma library or header not found<br>See &#96;config.log’ for more details<br>安装 <strong>liblzma</strong><br><a href=\"https://packages.debian.org/jessie/liblzma5\">https://packages.debian.org/jessie/liblzma5</a></p>\n<p>configure: error: no curses library found<br>安装 ** curses  **<br><a href=\"https://packages.debian.org/jessie/libncurses5-dev\">https://packages.debian.org/jessie/libncurses5-dev</a></p>\n<h4 id=\"参数\"><a href=\"#参数\" class=\"headerlink\" title=\"参数\"></a>参数</h4><h5 id=\"i-–install\"><a href=\"#i-–install\" class=\"headerlink\" title=\"-i|–install\"></a>-i|–install</h5><h5 id=\"r-–remove\"><a href=\"#r-–remove\" class=\"headerlink\" title=\"-r|–remove\"></a>-r|–remove</h5><p>L|–listfiles   &lt;软件包名&gt; …  列出属于指定软件包的文件。</p>\n<h5 id=\"l-–list\"><a href=\"#l-–list\" class=\"headerlink\" title=\"-l | –list\"></a>-l | –list</h5><p> [&lt;表达式&gt; …]        简明地列出软件包的状态。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/test$ sudo dpkg -l | grep api</span><br><span class=\"line\">ii  apipost6                             6.1.5                             amd64        </span><br><span class=\"line\">ii  libbrlapi0.6:amd64                   5.4-7+deb9u1                      amd64        braille display access via BRLTTY - shared library</span><br><span class=\"line\">ii  libglapi-mesa:amd64                  13.0.6-1+b2                       amd64        free implementation of the GL API -- shared library</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"解压deb\"><a href=\"#解压deb\" class=\"headerlink\" title=\"解压deb\"></a>解压deb</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ar x   fileName.deb</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xz -d  data.tar.xz</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zxvf   data.tar.gz</span><br><span class=\"line\">tar -xvf   data.tar</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h3 id=\"dpkg\"><a href=\"#dpkg\" class=\"headerlink\" title=\"dpkg\"></a>dpkg</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install xxx</span><br><span class=\"line\">....</span><br><span class=\"line\">Could not exec dpkg!</span><br><span class=\"line\">E: Sub-process /usr/bin/dpkg returned an error code (100)</span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ls -l /usr/bin/dpkg #什么没有呀！！！</span><br><span class=\"line\">find /usr -type f -name dpkg</span><br><span class=\"line\">.....</span><br></pre></td></tr></table></figure>","more":"<p> 那执行</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install dpkg  </span><br><span class=\"line\">....</span><br><span class=\"line\">显示已安装 **使用方法一**</span><br></pre></td></tr></table></figure>\n\n<p> 搜索 **dpkg debian download **<br> <a href=\"https://packages.debian.org/jessie/dpkg\">download</a></p>\n<h5 id=\"方法一\"><a href=\"#方法一\" class=\"headerlink\" title=\"方法一\"></a>方法一</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> ar x  ~/文档/dpkg_1.17.27_amd64.deb data.tar.gz</span><br><span class=\"line\"> </span><br><span class=\"line\"> mkdir /tmp/dpkg</span><br><span class=\"line\"> cp data.tar.gz /tmp/dpkg</span><br><span class=\"line\"> cd /tmp/dpkg</span><br><span class=\"line\"> </span><br><span class=\"line\"> tar xfvz data.tar.gz ./usr/bin/dpkg</span><br><span class=\"line\"> </span><br><span class=\"line\">sudo cp ./usr/bin/dpkg /usr/bin/</span><br><span class=\"line\">sudo apt-get update</span><br></pre></td></tr></table></figure>\n<h5 id=\"方法二\"><a href=\"#方法二\" class=\"headerlink\" title=\"方法二\"></a>方法二</h5><p><code>./configure</code><br>configure: error: libbz2 library or header not found<br>See &#96;config.log’ for more details<br>安装 <strong>libbz2</strong><br><a href=\"https://packages.debian.org/jessie/libbz2-1.0\">https://packages.debian.org/jessie/libbz2-1.0</a></p>\n<p>configure: error: liblzma library or header not found<br>See &#96;config.log’ for more details<br>安装 <strong>liblzma</strong><br><a href=\"https://packages.debian.org/jessie/liblzma5\">https://packages.debian.org/jessie/liblzma5</a></p>\n<p>configure: error: no curses library found<br>安装 ** curses  **<br><a href=\"https://packages.debian.org/jessie/libncurses5-dev\">https://packages.debian.org/jessie/libncurses5-dev</a></p>\n<h4 id=\"参数\"><a href=\"#参数\" class=\"headerlink\" title=\"参数\"></a>参数</h4><h5 id=\"i-–install\"><a href=\"#i-–install\" class=\"headerlink\" title=\"-i|–install\"></a>-i|–install</h5><h5 id=\"r-–remove\"><a href=\"#r-–remove\" class=\"headerlink\" title=\"-r|–remove\"></a>-r|–remove</h5><p>L|–listfiles   &lt;软件包名&gt; …  列出属于指定软件包的文件。</p>\n<h5 id=\"l-–list\"><a href=\"#l-–list\" class=\"headerlink\" title=\"-l | –list\"></a>-l | –list</h5><p> [&lt;表达式&gt; …]        简明地列出软件包的状态。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/test$ sudo dpkg -l | grep api</span><br><span class=\"line\">ii  apipost6                             6.1.5                             amd64        </span><br><span class=\"line\">ii  libbrlapi0.6:amd64                   5.4-7+deb9u1                      amd64        braille display access via BRLTTY - shared library</span><br><span class=\"line\">ii  libglapi-mesa:amd64                  13.0.6-1+b2                       amd64        free implementation of the GL API -- shared library</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"解压deb\"><a href=\"#解压deb\" class=\"headerlink\" title=\"解压deb\"></a>解压deb</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ar x   fileName.deb</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xz -d  data.tar.xz</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zxvf   data.tar.gz</span><br><span class=\"line\">tar -xvf   data.tar</span><br></pre></td></tr></table></figure>"},{"title":"docker-compose","date":"2017-02-27T04:08:32.000Z","_content":"#### 安装 \ngit下载地址:https://github.com/docker/compose/releases\n\n推荐pip安装\n```\nsudo pip install -U docker-compose\nchmod +x /usr/local/bin/docker-compose\ndocker-compose -version\n```\n  <!--more--> \n#### 使用\n>build\n\n指定Dockerfile 文件,compose会利用它自动构建\n```\nbuild: /path\n```\n> command\n\n覆盖容器启动后默认命令\n```\ncommand:\n       - \"python\" \n       - \"neural_style.py\" \n       - \"--content\" \n       - \"/neural/input.jpg\" \n```\n> links\n\n链接其它服务的容器\n```\nlinks:\n    - redis\n```\n> ports\n\n暴露端口信息给宿主机,使用(host:container) 必须字符串格式,yaml解析涉及进制\n```\nports:\n      - \"8888:8888\"\n      - \"127.0.0.1:8001:8001\"\n```\n\n> volumes\n\n挂载路径,宿主机(host:container);上访模式(host:container:ro)\n``` \nvolumes:\n    - ~/tmp:/tmp/dir\n    - \n```\n> volumes_from\n\n挂载容器或服务\n```\nvolumes_from:\n    - jupyter\n    - service_name\n```\n> devices\n\n设配映射列表\n```\ndevices:\n    - \"/dev/nivida0:/dev/nivida0\"\n    - \"/dev/nivida1:/dev/nivida1\"\n```\n> depends_on\n\nexpress之间依赖关系,\n * `docker-compose up` 按照依赖顺序启动\n\n```\n depends_on:\n     - elasticsearch\n```\n\n> labels\n\n向docker容器添加元数据\n```\nlabels:\n   - aliyun.gpu=2\n\n```\n>其它\n\ndocker run 支持\n```\ncpu_shares: 73\n#指定工作目录\nworking_dir: /code  \n\nentrypoint: /code/entrypoint.sh\nuser: postgresql\nhostname: foo\ndomainname: foo.com\nmem_limit: 1000000000\nprivileged: true\nrestart: always\nstdin_open: true\ntty: true\n```\n\n#### 示例\n\n\n\n```\nversion: '2'\nservices:\n  jupyter:\n    image: registry.cn-hangzhou.aliyuncs.com/denverdino/tensorflow:1.0.0\n    container_name: jupyter\n    ports:\n      - \"8888:8888\"\n    environment:\n      - PASSWORD=tensorflow\n    volumes:\n      - \"/tmp/tensorflow_logs\"\n      - \"./notebooks:/root/notebooks\"\n    command:\n      - \"/run_jupyter.sh\"\n      - \"/root/notebooks\"\n  tensorboard:\n    image: registry.cn-hangzhou.aliyuncs.com/denverdino/tensorflow:1.0.0\n    container_name: tensorboard\n    ports:\n      - \"6006:6006\"\n    volumes_from:\n      - jupyter\n    command:\n      - \"tensorboard\"\n      - \"--logdir\"\n      - \"/tmp/tensorflow_logs\"\n      - \"--host\"\n      - \"0.0.0.0\"\n```\n\n\n\nlogstash\n\n```\nlogstash:\n  image: logstash:2.4.1\n  command: /opt/logstash/bin/logstash -f /etc/logstash/conf.d/logstash.conf\n  privileged: false\n  restart: always\n  ports:\n  - 21020:21020\n  volumes:\n  - /mnt/tinkle_data/logstash/logstash.conf:/etc/logstash/conf.d/logstash.conf\n```\n\nkibana\n\n```\nkibana:\n  image: daocloud.io/library/kibana:4.6.1\n  privileged: false\n  restart: always\n  ports:\n  - 5601:5601\n  volumes:\n  - /mnt/tinkle_data/kibana/kibana.yml:/opt/kibana/config/kibana.yml\n```\n\nelasticsearch\n\n```\nes:\n  restart: always\n  ports:\n    - '9200:9200/tcp'\n    - '9300:9300/tcp'\n  environment:\n    - LANG=C.UTF-8\n    - JAVA_HOME=/docker-java-home/jre\n    - TZ=Asia/ShangHai\n  memswap_limit: 0\n  labels:\n    aliyun.scale: '1'\n  shm_size: 0\n  image: 'elasticsearch:2.4.1'\n  memswap_reservation: 0\n  volumes:\n    - '/home/data/es:/usr/share/elasticsearch/data:rw'\n    - '/mnt/elasticsearch/plugins:/usr/share/elasticsearch/plugins:rw'\n  kernel_memory: 0\n  mem_limit: 0\n```\n\nredis\n\n```\nredis:\n  image: redis:3.2.5\n  command: \n     -  /etc/redis/6379.conf\n  privileged: false\n  restart: always\n  ports:\n  - 6379:6379\n  volumes:\n  - /mnt/tinkle_data/redis/data:/data/\n  - /mnt/tinkle_data/redis/conf/6379.conf:/etc/redis/6379.conf\n```\n\n\n\n```\nmysql:\n  image: 'mysql:5.7.17'\n  ports:\n    - '3306:3306'\n  restart: always\n  environment:\n    - MYSQL_ROOT_PASSWORD=19930221\n  labels:\n    aliyun.scale: '1'\n  volumes:\n    - '/home/data/mysql/mysql:/var/lib/mysql'\n    - '/home/data/mysql/conf/mysql.cnf:/etc/mysql/conf.d/mysql.cnf'\n```\n\n\n\n```\n#docker-compose services  mysql的服务名\njdbc_url=jdbc:mysql://服务名:3306/databasename\n```\n\n","source":"_posts/linux/k8s/compose.md","raw":"---\ntitle: docker-compose\ndate: 2017-02-27 12:08:32\ntags:\n - install\n - docker-engine\n - docker compose\ncategories:\n - linux\n - k8s\n - docker\n---\n#### 安装 \ngit下载地址:https://github.com/docker/compose/releases\n\n推荐pip安装\n```\nsudo pip install -U docker-compose\nchmod +x /usr/local/bin/docker-compose\ndocker-compose -version\n```\n  <!--more--> \n#### 使用\n>build\n\n指定Dockerfile 文件,compose会利用它自动构建\n```\nbuild: /path\n```\n> command\n\n覆盖容器启动后默认命令\n```\ncommand:\n       - \"python\" \n       - \"neural_style.py\" \n       - \"--content\" \n       - \"/neural/input.jpg\" \n```\n> links\n\n链接其它服务的容器\n```\nlinks:\n    - redis\n```\n> ports\n\n暴露端口信息给宿主机,使用(host:container) 必须字符串格式,yaml解析涉及进制\n```\nports:\n      - \"8888:8888\"\n      - \"127.0.0.1:8001:8001\"\n```\n\n> volumes\n\n挂载路径,宿主机(host:container);上访模式(host:container:ro)\n``` \nvolumes:\n    - ~/tmp:/tmp/dir\n    - \n```\n> volumes_from\n\n挂载容器或服务\n```\nvolumes_from:\n    - jupyter\n    - service_name\n```\n> devices\n\n设配映射列表\n```\ndevices:\n    - \"/dev/nivida0:/dev/nivida0\"\n    - \"/dev/nivida1:/dev/nivida1\"\n```\n> depends_on\n\nexpress之间依赖关系,\n * `docker-compose up` 按照依赖顺序启动\n\n```\n depends_on:\n     - elasticsearch\n```\n\n> labels\n\n向docker容器添加元数据\n```\nlabels:\n   - aliyun.gpu=2\n\n```\n>其它\n\ndocker run 支持\n```\ncpu_shares: 73\n#指定工作目录\nworking_dir: /code  \n\nentrypoint: /code/entrypoint.sh\nuser: postgresql\nhostname: foo\ndomainname: foo.com\nmem_limit: 1000000000\nprivileged: true\nrestart: always\nstdin_open: true\ntty: true\n```\n\n#### 示例\n\n\n\n```\nversion: '2'\nservices:\n  jupyter:\n    image: registry.cn-hangzhou.aliyuncs.com/denverdino/tensorflow:1.0.0\n    container_name: jupyter\n    ports:\n      - \"8888:8888\"\n    environment:\n      - PASSWORD=tensorflow\n    volumes:\n      - \"/tmp/tensorflow_logs\"\n      - \"./notebooks:/root/notebooks\"\n    command:\n      - \"/run_jupyter.sh\"\n      - \"/root/notebooks\"\n  tensorboard:\n    image: registry.cn-hangzhou.aliyuncs.com/denverdino/tensorflow:1.0.0\n    container_name: tensorboard\n    ports:\n      - \"6006:6006\"\n    volumes_from:\n      - jupyter\n    command:\n      - \"tensorboard\"\n      - \"--logdir\"\n      - \"/tmp/tensorflow_logs\"\n      - \"--host\"\n      - \"0.0.0.0\"\n```\n\n\n\nlogstash\n\n```\nlogstash:\n  image: logstash:2.4.1\n  command: /opt/logstash/bin/logstash -f /etc/logstash/conf.d/logstash.conf\n  privileged: false\n  restart: always\n  ports:\n  - 21020:21020\n  volumes:\n  - /mnt/tinkle_data/logstash/logstash.conf:/etc/logstash/conf.d/logstash.conf\n```\n\nkibana\n\n```\nkibana:\n  image: daocloud.io/library/kibana:4.6.1\n  privileged: false\n  restart: always\n  ports:\n  - 5601:5601\n  volumes:\n  - /mnt/tinkle_data/kibana/kibana.yml:/opt/kibana/config/kibana.yml\n```\n\nelasticsearch\n\n```\nes:\n  restart: always\n  ports:\n    - '9200:9200/tcp'\n    - '9300:9300/tcp'\n  environment:\n    - LANG=C.UTF-8\n    - JAVA_HOME=/docker-java-home/jre\n    - TZ=Asia/ShangHai\n  memswap_limit: 0\n  labels:\n    aliyun.scale: '1'\n  shm_size: 0\n  image: 'elasticsearch:2.4.1'\n  memswap_reservation: 0\n  volumes:\n    - '/home/data/es:/usr/share/elasticsearch/data:rw'\n    - '/mnt/elasticsearch/plugins:/usr/share/elasticsearch/plugins:rw'\n  kernel_memory: 0\n  mem_limit: 0\n```\n\nredis\n\n```\nredis:\n  image: redis:3.2.5\n  command: \n     -  /etc/redis/6379.conf\n  privileged: false\n  restart: always\n  ports:\n  - 6379:6379\n  volumes:\n  - /mnt/tinkle_data/redis/data:/data/\n  - /mnt/tinkle_data/redis/conf/6379.conf:/etc/redis/6379.conf\n```\n\n\n\n```\nmysql:\n  image: 'mysql:5.7.17'\n  ports:\n    - '3306:3306'\n  restart: always\n  environment:\n    - MYSQL_ROOT_PASSWORD=19930221\n  labels:\n    aliyun.scale: '1'\n  volumes:\n    - '/home/data/mysql/mysql:/var/lib/mysql'\n    - '/home/data/mysql/conf/mysql.cnf:/etc/mysql/conf.d/mysql.cnf'\n```\n\n\n\n```\n#docker-compose services  mysql的服务名\njdbc_url=jdbc:mysql://服务名:3306/databasename\n```\n\n","slug":"linux/k8s/compose","published":1,"updated":"2022-08-07T08:34:03.144Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtt4001ngwi5c8wxhy1o","content":"<h4 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h4><p>git下载地址:<a href=\"https://github.com/docker/compose/releases\">https://github.com/docker/compose/releases</a></p>\n<p>推荐pip安装</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo pip install -U docker-compose</span><br><span class=\"line\">chmod +x /usr/local/bin/docker-compose</span><br><span class=\"line\">docker-compose -version</span><br></pre></td></tr></table></figure>\n  <span id=\"more\"></span> \n<h4 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h4><blockquote>\n<p>build</p>\n</blockquote>\n<p>指定Dockerfile 文件,compose会利用它自动构建</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">build: /path</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>command</p>\n</blockquote>\n<p>覆盖容器启动后默认命令</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">command:</span><br><span class=\"line\">       - &quot;python&quot; </span><br><span class=\"line\">       - &quot;neural_style.py&quot; </span><br><span class=\"line\">       - &quot;--content&quot; </span><br><span class=\"line\">       - &quot;/neural/input.jpg&quot; </span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>links</p>\n</blockquote>\n<p>链接其它服务的容器</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">links:</span><br><span class=\"line\">    - redis</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>ports</p>\n</blockquote>\n<p>暴露端口信息给宿主机,使用(host:container) 必须字符串格式,yaml解析涉及进制</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ports:</span><br><span class=\"line\">      - &quot;8888:8888&quot;</span><br><span class=\"line\">      - &quot;127.0.0.1:8001:8001&quot;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>volumes</p>\n</blockquote>\n<p>挂载路径,宿主机(host:container);上访模式(host:container:ro)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">volumes:</span><br><span class=\"line\">    - ~/tmp:/tmp/dir</span><br><span class=\"line\">    - </span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>volumes_from</p>\n</blockquote>\n<p>挂载容器或服务</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">volumes_from:</span><br><span class=\"line\">    - jupyter</span><br><span class=\"line\">    - service_name</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>devices</p>\n</blockquote>\n<p>设配映射列表</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">devices:</span><br><span class=\"line\">    - &quot;/dev/nivida0:/dev/nivida0&quot;</span><br><span class=\"line\">    - &quot;/dev/nivida1:/dev/nivida1&quot;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>depends_on</p>\n</blockquote>\n<p>express之间依赖关系,</p>\n<ul>\n<li><code>docker-compose up</code> 按照依赖顺序启动</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">depends_on:</span><br><span class=\"line\">    - elasticsearch</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>labels</p>\n</blockquote>\n<p>向docker容器添加元数据</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">labels:</span><br><span class=\"line\">   - aliyun.gpu=2</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>其它</p>\n</blockquote>\n<p>docker run 支持</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cpu_shares: 73</span><br><span class=\"line\">#指定工作目录</span><br><span class=\"line\">working_dir: /code  </span><br><span class=\"line\"></span><br><span class=\"line\">entrypoint: /code/entrypoint.sh</span><br><span class=\"line\">user: postgresql</span><br><span class=\"line\">hostname: foo</span><br><span class=\"line\">domainname: foo.com</span><br><span class=\"line\">mem_limit: 1000000000</span><br><span class=\"line\">privileged: true</span><br><span class=\"line\">restart: always</span><br><span class=\"line\">stdin_open: true</span><br><span class=\"line\">tty: true</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: &#x27;2&#x27;</span><br><span class=\"line\">services:</span><br><span class=\"line\">  jupyter:</span><br><span class=\"line\">    image: registry.cn-hangzhou.aliyuncs.com/denverdino/tensorflow:1.0.0</span><br><span class=\"line\">    container_name: jupyter</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;8888:8888&quot;</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - PASSWORD=tensorflow</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - &quot;/tmp/tensorflow_logs&quot;</span><br><span class=\"line\">      - &quot;./notebooks:/root/notebooks&quot;</span><br><span class=\"line\">    command:</span><br><span class=\"line\">      - &quot;/run_jupyter.sh&quot;</span><br><span class=\"line\">      - &quot;/root/notebooks&quot;</span><br><span class=\"line\">  tensorboard:</span><br><span class=\"line\">    image: registry.cn-hangzhou.aliyuncs.com/denverdino/tensorflow:1.0.0</span><br><span class=\"line\">    container_name: tensorboard</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;6006:6006&quot;</span><br><span class=\"line\">    volumes_from:</span><br><span class=\"line\">      - jupyter</span><br><span class=\"line\">    command:</span><br><span class=\"line\">      - &quot;tensorboard&quot;</span><br><span class=\"line\">      - &quot;--logdir&quot;</span><br><span class=\"line\">      - &quot;/tmp/tensorflow_logs&quot;</span><br><span class=\"line\">      - &quot;--host&quot;</span><br><span class=\"line\">      - &quot;0.0.0.0&quot;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>logstash</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">logstash:</span><br><span class=\"line\">  image: logstash:2.4.1</span><br><span class=\"line\">  command: /opt/logstash/bin/logstash -f /etc/logstash/conf.d/logstash.conf</span><br><span class=\"line\">  privileged: false</span><br><span class=\"line\">  restart: always</span><br><span class=\"line\">  ports:</span><br><span class=\"line\">  - 21020:21020</span><br><span class=\"line\">  volumes:</span><br><span class=\"line\">  - /mnt/tinkle_data/logstash/logstash.conf:/etc/logstash/conf.d/logstash.conf</span><br></pre></td></tr></table></figure>\n\n<p>kibana</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kibana:</span><br><span class=\"line\">  image: daocloud.io/library/kibana:4.6.1</span><br><span class=\"line\">  privileged: false</span><br><span class=\"line\">  restart: always</span><br><span class=\"line\">  ports:</span><br><span class=\"line\">  - 5601:5601</span><br><span class=\"line\">  volumes:</span><br><span class=\"line\">  - /mnt/tinkle_data/kibana/kibana.yml:/opt/kibana/config/kibana.yml</span><br></pre></td></tr></table></figure>\n\n<p>elasticsearch</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">es:</span><br><span class=\"line\">  restart: always</span><br><span class=\"line\">  ports:</span><br><span class=\"line\">    - &#x27;9200:9200/tcp&#x27;</span><br><span class=\"line\">    - &#x27;9300:9300/tcp&#x27;</span><br><span class=\"line\">  environment:</span><br><span class=\"line\">    - LANG=C.UTF-8</span><br><span class=\"line\">    - JAVA_HOME=/docker-java-home/jre</span><br><span class=\"line\">    - TZ=Asia/ShangHai</span><br><span class=\"line\">  memswap_limit: 0</span><br><span class=\"line\">  labels:</span><br><span class=\"line\">    aliyun.scale: &#x27;1&#x27;</span><br><span class=\"line\">  shm_size: 0</span><br><span class=\"line\">  image: &#x27;elasticsearch:2.4.1&#x27;</span><br><span class=\"line\">  memswap_reservation: 0</span><br><span class=\"line\">  volumes:</span><br><span class=\"line\">    - &#x27;/home/data/es:/usr/share/elasticsearch/data:rw&#x27;</span><br><span class=\"line\">    - &#x27;/mnt/elasticsearch/plugins:/usr/share/elasticsearch/plugins:rw&#x27;</span><br><span class=\"line\">  kernel_memory: 0</span><br><span class=\"line\">  mem_limit: 0</span><br></pre></td></tr></table></figure>\n\n<p>redis</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis:</span><br><span class=\"line\">  image: redis:3.2.5</span><br><span class=\"line\">  command: </span><br><span class=\"line\">     -  /etc/redis/6379.conf</span><br><span class=\"line\">  privileged: false</span><br><span class=\"line\">  restart: always</span><br><span class=\"line\">  ports:</span><br><span class=\"line\">  - 6379:6379</span><br><span class=\"line\">  volumes:</span><br><span class=\"line\">  - /mnt/tinkle_data/redis/data:/data/</span><br><span class=\"line\">  - /mnt/tinkle_data/redis/conf/6379.conf:/etc/redis/6379.conf</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql:</span><br><span class=\"line\">  image: &#x27;mysql:5.7.17&#x27;</span><br><span class=\"line\">  ports:</span><br><span class=\"line\">    - &#x27;3306:3306&#x27;</span><br><span class=\"line\">  restart: always</span><br><span class=\"line\">  environment:</span><br><span class=\"line\">    - MYSQL_ROOT_PASSWORD=19930221</span><br><span class=\"line\">  labels:</span><br><span class=\"line\">    aliyun.scale: &#x27;1&#x27;</span><br><span class=\"line\">  volumes:</span><br><span class=\"line\">    - &#x27;/home/data/mysql/mysql:/var/lib/mysql&#x27;</span><br><span class=\"line\">    - &#x27;/home/data/mysql/conf/mysql.cnf:/etc/mysql/conf.d/mysql.cnf&#x27;</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#docker-compose services  mysql的服务名</span><br><span class=\"line\">jdbc_url=jdbc:mysql://服务名:3306/databasename</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h4 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h4><p>git下载地址:<a href=\"https://github.com/docker/compose/releases\">https://github.com/docker/compose/releases</a></p>\n<p>推荐pip安装</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo pip install -U docker-compose</span><br><span class=\"line\">chmod +x /usr/local/bin/docker-compose</span><br><span class=\"line\">docker-compose -version</span><br></pre></td></tr></table></figure>","more":"<h4 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h4><blockquote>\n<p>build</p>\n</blockquote>\n<p>指定Dockerfile 文件,compose会利用它自动构建</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">build: /path</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>command</p>\n</blockquote>\n<p>覆盖容器启动后默认命令</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">command:</span><br><span class=\"line\">       - &quot;python&quot; </span><br><span class=\"line\">       - &quot;neural_style.py&quot; </span><br><span class=\"line\">       - &quot;--content&quot; </span><br><span class=\"line\">       - &quot;/neural/input.jpg&quot; </span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>links</p>\n</blockquote>\n<p>链接其它服务的容器</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">links:</span><br><span class=\"line\">    - redis</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>ports</p>\n</blockquote>\n<p>暴露端口信息给宿主机,使用(host:container) 必须字符串格式,yaml解析涉及进制</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ports:</span><br><span class=\"line\">      - &quot;8888:8888&quot;</span><br><span class=\"line\">      - &quot;127.0.0.1:8001:8001&quot;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>volumes</p>\n</blockquote>\n<p>挂载路径,宿主机(host:container);上访模式(host:container:ro)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">volumes:</span><br><span class=\"line\">    - ~/tmp:/tmp/dir</span><br><span class=\"line\">    - </span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>volumes_from</p>\n</blockquote>\n<p>挂载容器或服务</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">volumes_from:</span><br><span class=\"line\">    - jupyter</span><br><span class=\"line\">    - service_name</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>devices</p>\n</blockquote>\n<p>设配映射列表</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">devices:</span><br><span class=\"line\">    - &quot;/dev/nivida0:/dev/nivida0&quot;</span><br><span class=\"line\">    - &quot;/dev/nivida1:/dev/nivida1&quot;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>depends_on</p>\n</blockquote>\n<p>express之间依赖关系,</p>\n<ul>\n<li><code>docker-compose up</code> 按照依赖顺序启动</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">depends_on:</span><br><span class=\"line\">    - elasticsearch</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>labels</p>\n</blockquote>\n<p>向docker容器添加元数据</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">labels:</span><br><span class=\"line\">   - aliyun.gpu=2</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>其它</p>\n</blockquote>\n<p>docker run 支持</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cpu_shares: 73</span><br><span class=\"line\">#指定工作目录</span><br><span class=\"line\">working_dir: /code  </span><br><span class=\"line\"></span><br><span class=\"line\">entrypoint: /code/entrypoint.sh</span><br><span class=\"line\">user: postgresql</span><br><span class=\"line\">hostname: foo</span><br><span class=\"line\">domainname: foo.com</span><br><span class=\"line\">mem_limit: 1000000000</span><br><span class=\"line\">privileged: true</span><br><span class=\"line\">restart: always</span><br><span class=\"line\">stdin_open: true</span><br><span class=\"line\">tty: true</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: &#x27;2&#x27;</span><br><span class=\"line\">services:</span><br><span class=\"line\">  jupyter:</span><br><span class=\"line\">    image: registry.cn-hangzhou.aliyuncs.com/denverdino/tensorflow:1.0.0</span><br><span class=\"line\">    container_name: jupyter</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;8888:8888&quot;</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - PASSWORD=tensorflow</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - &quot;/tmp/tensorflow_logs&quot;</span><br><span class=\"line\">      - &quot;./notebooks:/root/notebooks&quot;</span><br><span class=\"line\">    command:</span><br><span class=\"line\">      - &quot;/run_jupyter.sh&quot;</span><br><span class=\"line\">      - &quot;/root/notebooks&quot;</span><br><span class=\"line\">  tensorboard:</span><br><span class=\"line\">    image: registry.cn-hangzhou.aliyuncs.com/denverdino/tensorflow:1.0.0</span><br><span class=\"line\">    container_name: tensorboard</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;6006:6006&quot;</span><br><span class=\"line\">    volumes_from:</span><br><span class=\"line\">      - jupyter</span><br><span class=\"line\">    command:</span><br><span class=\"line\">      - &quot;tensorboard&quot;</span><br><span class=\"line\">      - &quot;--logdir&quot;</span><br><span class=\"line\">      - &quot;/tmp/tensorflow_logs&quot;</span><br><span class=\"line\">      - &quot;--host&quot;</span><br><span class=\"line\">      - &quot;0.0.0.0&quot;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>logstash</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">logstash:</span><br><span class=\"line\">  image: logstash:2.4.1</span><br><span class=\"line\">  command: /opt/logstash/bin/logstash -f /etc/logstash/conf.d/logstash.conf</span><br><span class=\"line\">  privileged: false</span><br><span class=\"line\">  restart: always</span><br><span class=\"line\">  ports:</span><br><span class=\"line\">  - 21020:21020</span><br><span class=\"line\">  volumes:</span><br><span class=\"line\">  - /mnt/tinkle_data/logstash/logstash.conf:/etc/logstash/conf.d/logstash.conf</span><br></pre></td></tr></table></figure>\n\n<p>kibana</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kibana:</span><br><span class=\"line\">  image: daocloud.io/library/kibana:4.6.1</span><br><span class=\"line\">  privileged: false</span><br><span class=\"line\">  restart: always</span><br><span class=\"line\">  ports:</span><br><span class=\"line\">  - 5601:5601</span><br><span class=\"line\">  volumes:</span><br><span class=\"line\">  - /mnt/tinkle_data/kibana/kibana.yml:/opt/kibana/config/kibana.yml</span><br></pre></td></tr></table></figure>\n\n<p>elasticsearch</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">es:</span><br><span class=\"line\">  restart: always</span><br><span class=\"line\">  ports:</span><br><span class=\"line\">    - &#x27;9200:9200/tcp&#x27;</span><br><span class=\"line\">    - &#x27;9300:9300/tcp&#x27;</span><br><span class=\"line\">  environment:</span><br><span class=\"line\">    - LANG=C.UTF-8</span><br><span class=\"line\">    - JAVA_HOME=/docker-java-home/jre</span><br><span class=\"line\">    - TZ=Asia/ShangHai</span><br><span class=\"line\">  memswap_limit: 0</span><br><span class=\"line\">  labels:</span><br><span class=\"line\">    aliyun.scale: &#x27;1&#x27;</span><br><span class=\"line\">  shm_size: 0</span><br><span class=\"line\">  image: &#x27;elasticsearch:2.4.1&#x27;</span><br><span class=\"line\">  memswap_reservation: 0</span><br><span class=\"line\">  volumes:</span><br><span class=\"line\">    - &#x27;/home/data/es:/usr/share/elasticsearch/data:rw&#x27;</span><br><span class=\"line\">    - &#x27;/mnt/elasticsearch/plugins:/usr/share/elasticsearch/plugins:rw&#x27;</span><br><span class=\"line\">  kernel_memory: 0</span><br><span class=\"line\">  mem_limit: 0</span><br></pre></td></tr></table></figure>\n\n<p>redis</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis:</span><br><span class=\"line\">  image: redis:3.2.5</span><br><span class=\"line\">  command: </span><br><span class=\"line\">     -  /etc/redis/6379.conf</span><br><span class=\"line\">  privileged: false</span><br><span class=\"line\">  restart: always</span><br><span class=\"line\">  ports:</span><br><span class=\"line\">  - 6379:6379</span><br><span class=\"line\">  volumes:</span><br><span class=\"line\">  - /mnt/tinkle_data/redis/data:/data/</span><br><span class=\"line\">  - /mnt/tinkle_data/redis/conf/6379.conf:/etc/redis/6379.conf</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql:</span><br><span class=\"line\">  image: &#x27;mysql:5.7.17&#x27;</span><br><span class=\"line\">  ports:</span><br><span class=\"line\">    - &#x27;3306:3306&#x27;</span><br><span class=\"line\">  restart: always</span><br><span class=\"line\">  environment:</span><br><span class=\"line\">    - MYSQL_ROOT_PASSWORD=19930221</span><br><span class=\"line\">  labels:</span><br><span class=\"line\">    aliyun.scale: &#x27;1&#x27;</span><br><span class=\"line\">  volumes:</span><br><span class=\"line\">    - &#x27;/home/data/mysql/mysql:/var/lib/mysql&#x27;</span><br><span class=\"line\">    - &#x27;/home/data/mysql/conf/mysql.cnf:/etc/mysql/conf.d/mysql.cnf&#x27;</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#docker-compose services  mysql的服务名</span><br><span class=\"line\">jdbc_url=jdbc:mysql://服务名:3306/databasename</span><br></pre></td></tr></table></figure>"},{"title":"docker","date":"2017-02-21T04:08:32.000Z","_content":"#### 安装 engine\n卸载旧版\n`sudo apt-get purge docker.io*`\n\n编辑 ` /etc/apt/sources.list.d/docker.list`\n```\necho 'deb https://apt.dockerproject.org/repo debian-jessie main'> /etc/apt/sources.list.d/docker.list\n```\n安装依赖：` apt-transport-https`\n\n```\nsudo apt-get install docker-engine\ndocker version\n...permission问题\n```\n创建组\n```\n cat /etc/group | grep ^docker  #不存在\n sudo groupadd docker  #存在忽略，创建组\nsudo gpasswd -a ${USER} docker   #添加当前用户到组\nsudo restart  #重启生效\n```\n <!--more--> \n#### 安装 compose\n官方文档 https://docs.docker.com/compose/install/#alternative-install-options\n\n##### 方法一\ncurl 安装\n```\nsudo apt-get install curl\n```\n/usr/local/bin 需要权限\n```\nsudo curl -L \"https://github.com/docker/compose/releases/download/1.11.1/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\n..... \ncurl: (56) SSL read: error:00000000:lib(0):func(0):reason(0), errno 104\n网络中断n次，推荐离线\n```\n[离线下载](https://dl.bintray.com/docker-compose/master/)\n```\nsudo mv docker-compose-Linux-x86_64 /usr/local/bin/docker-compose\nchmod +x /usr/local/bin/docker-compose\ndocker-compose --version\n```\n\n##### 方法二\npip安装`pip install docker-compose`\n**强烈建议您使用 virtualenv，因为许多操作系统有python系统包与docker-compose依赖关系冲突**\n\n\n####  国内源\n`docker search  xxxx` \n**error response from daemon: Get https://index.docker.io**\n被 GFW强了\nDocker配置文件`/etc/default/docker`\n```\nsudo mousepad /etc/default/docker\n\n#添加 阿里源\nDOCKER_OPTS=\"--registry-mirror=http://mirrors.aliyun.com\"\n```\n加速地址\n```\nsudo mkdir -p /etc/docker\nsudo tee /etc/docker/daemon.json <<-'EOF'\n{\n  \"registry-mirrors\": [\"https://自己专属.mirror.aliyuncs.com\"]\n}\nEOF\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n```\n#### docker-compose.yml\n常用配置{% post_link  compose %}\n\n#### 卸载\n```\n#docker-engine\nsudo apt-get remove docker-engine\n\n# docker-compose \n#curl\n$ rm /usr/local/bin/docker-compose\n# pip\n$ pip uninstall docker-compose\n```\n\n\n\ndocker.service\n\n```\ncat >/usr/lib/systemd/system/docker.service <<EOF\n[Unit]\nDescription=Docker Application Container Engine\nDocumentation=http://docs.docker.com\nAfter=network.target docker.socket\n[Service]\nType=notify\nEnvironmentFile=$BASE/flanneld/subnet.env\nWorkingDirectory=/usr/local/bin\nExecStart=/usr/bin/dockerd \\\n                \\$DOCKER_NETWORK_OPTIONS \\\n                -H unix:///var/run/docker.sock \nExecReload=/bin/kill -s HUP $MAINPID\n# Having non-zero Limit*s causes performance problems due to accounting overhead\n# in the kernel. We recommend using cgroups to do container-local accounting.\nLimitNOFILE=infinity\nLimitNPROC=infinity\nLimitCORE=infinity\nTimeoutStartSec=0\n# set delegate yes so that systemd does not reset the cgroups of docker containers\nDelegate=yes\n# kill only the docker process, not all processes in the cgroup\nKillMode=process\nRestart=on-failure\n[Install]\nWantedBy=multi-user.target\nEOF\n```\n\n","source":"_posts/linux/k8s/docker.md","raw":"---\ntitle: docker\ndate: 2017-02-21 12:08:32\ntags:\n - install\n - docker-engine\n - docker compose\ncategories:\n - linux\n - debian\n - docker\n---\n#### 安装 engine\n卸载旧版\n`sudo apt-get purge docker.io*`\n\n编辑 ` /etc/apt/sources.list.d/docker.list`\n```\necho 'deb https://apt.dockerproject.org/repo debian-jessie main'> /etc/apt/sources.list.d/docker.list\n```\n安装依赖：` apt-transport-https`\n\n```\nsudo apt-get install docker-engine\ndocker version\n...permission问题\n```\n创建组\n```\n cat /etc/group | grep ^docker  #不存在\n sudo groupadd docker  #存在忽略，创建组\nsudo gpasswd -a ${USER} docker   #添加当前用户到组\nsudo restart  #重启生效\n```\n <!--more--> \n#### 安装 compose\n官方文档 https://docs.docker.com/compose/install/#alternative-install-options\n\n##### 方法一\ncurl 安装\n```\nsudo apt-get install curl\n```\n/usr/local/bin 需要权限\n```\nsudo curl -L \"https://github.com/docker/compose/releases/download/1.11.1/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\n..... \ncurl: (56) SSL read: error:00000000:lib(0):func(0):reason(0), errno 104\n网络中断n次，推荐离线\n```\n[离线下载](https://dl.bintray.com/docker-compose/master/)\n```\nsudo mv docker-compose-Linux-x86_64 /usr/local/bin/docker-compose\nchmod +x /usr/local/bin/docker-compose\ndocker-compose --version\n```\n\n##### 方法二\npip安装`pip install docker-compose`\n**强烈建议您使用 virtualenv，因为许多操作系统有python系统包与docker-compose依赖关系冲突**\n\n\n####  国内源\n`docker search  xxxx` \n**error response from daemon: Get https://index.docker.io**\n被 GFW强了\nDocker配置文件`/etc/default/docker`\n```\nsudo mousepad /etc/default/docker\n\n#添加 阿里源\nDOCKER_OPTS=\"--registry-mirror=http://mirrors.aliyun.com\"\n```\n加速地址\n```\nsudo mkdir -p /etc/docker\nsudo tee /etc/docker/daemon.json <<-'EOF'\n{\n  \"registry-mirrors\": [\"https://自己专属.mirror.aliyuncs.com\"]\n}\nEOF\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n```\n#### docker-compose.yml\n常用配置{% post_link  compose %}\n\n#### 卸载\n```\n#docker-engine\nsudo apt-get remove docker-engine\n\n# docker-compose \n#curl\n$ rm /usr/local/bin/docker-compose\n# pip\n$ pip uninstall docker-compose\n```\n\n\n\ndocker.service\n\n```\ncat >/usr/lib/systemd/system/docker.service <<EOF\n[Unit]\nDescription=Docker Application Container Engine\nDocumentation=http://docs.docker.com\nAfter=network.target docker.socket\n[Service]\nType=notify\nEnvironmentFile=$BASE/flanneld/subnet.env\nWorkingDirectory=/usr/local/bin\nExecStart=/usr/bin/dockerd \\\n                \\$DOCKER_NETWORK_OPTIONS \\\n                -H unix:///var/run/docker.sock \nExecReload=/bin/kill -s HUP $MAINPID\n# Having non-zero Limit*s causes performance problems due to accounting overhead\n# in the kernel. We recommend using cgroups to do container-local accounting.\nLimitNOFILE=infinity\nLimitNPROC=infinity\nLimitCORE=infinity\nTimeoutStartSec=0\n# set delegate yes so that systemd does not reset the cgroups of docker containers\nDelegate=yes\n# kill only the docker process, not all processes in the cgroup\nKillMode=process\nRestart=on-failure\n[Install]\nWantedBy=multi-user.target\nEOF\n```\n\n","slug":"linux/k8s/docker","published":1,"updated":"2022-08-16T13:26:40.694Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtt5001qgwi57zry7ihf","content":"<h4 id=\"安装-engine\"><a href=\"#安装-engine\" class=\"headerlink\" title=\"安装 engine\"></a>安装 engine</h4><p>卸载旧版<br><code>sudo apt-get purge docker.io*</code></p>\n<p>编辑 <code> /etc/apt/sources.list.d/docker.list</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;deb https://apt.dockerproject.org/repo debian-jessie main&#x27;&gt; /etc/apt/sources.list.d/docker.list</span><br></pre></td></tr></table></figure>\n<p>安装依赖：<code> apt-transport-https</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install docker-engine</span><br><span class=\"line\">docker version</span><br><span class=\"line\">...permission问题</span><br></pre></td></tr></table></figure>\n<p>创建组</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> cat /etc/group | grep ^docker  #不存在</span><br><span class=\"line\"> sudo groupadd docker  #存在忽略，创建组</span><br><span class=\"line\">sudo gpasswd -a $&#123;USER&#125; docker   #添加当前用户到组</span><br><span class=\"line\">sudo restart  #重启生效</span><br></pre></td></tr></table></figure>\n <span id=\"more\"></span> \n<h4 id=\"安装-compose\"><a href=\"#安装-compose\" class=\"headerlink\" title=\"安装 compose\"></a>安装 compose</h4><p>官方文档 <a href=\"https://docs.docker.com/compose/install/#alternative-install-options\">https://docs.docker.com/compose/install/#alternative-install-options</a></p>\n<h5 id=\"方法一\"><a href=\"#方法一\" class=\"headerlink\" title=\"方法一\"></a>方法一</h5><p>curl 安装</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install curl</span><br></pre></td></tr></table></figure>\n<p>&#x2F;usr&#x2F;local&#x2F;bin 需要权限</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.11.1/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br><span class=\"line\">..... </span><br><span class=\"line\">curl: (56) SSL read: error:00000000:lib(0):func(0):reason(0), errno 104</span><br><span class=\"line\">网络中断n次，推荐离线</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://dl.bintray.com/docker-compose/master/\">离线下载</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mv docker-compose-Linux-x86_64 /usr/local/bin/docker-compose</span><br><span class=\"line\">chmod +x /usr/local/bin/docker-compose</span><br><span class=\"line\">docker-compose --version</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"方法二\"><a href=\"#方法二\" class=\"headerlink\" title=\"方法二\"></a>方法二</h5><p>pip安装<code>pip install docker-compose</code><br><strong>强烈建议您使用 virtualenv，因为许多操作系统有python系统包与docker-compose依赖关系冲突</strong></p>\n<h4 id=\"国内源\"><a href=\"#国内源\" class=\"headerlink\" title=\"国内源\"></a>国内源</h4><p><code>docker search  xxxx</code><br><strong>error response from daemon: Get <a href=\"https://index.docker.io/\">https://index.docker.io</a></strong><br>被 GFW强了<br>Docker配置文件<code>/etc/default/docker</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mousepad /etc/default/docker</span><br><span class=\"line\"></span><br><span class=\"line\">#添加 阿里源</span><br><span class=\"line\">DOCKER_OPTS=&quot;--registry-mirror=http://mirrors.aliyun.com&quot;</span><br></pre></td></tr></table></figure>\n<p>加速地址</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir -p /etc/docker</span><br><span class=\"line\">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;registry-mirrors&quot;: [&quot;https://自己专属.mirror.aliyuncs.com&quot;]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EOF</span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>\n<h4 id=\"docker-compose-yml\"><a href=\"#docker-compose-yml\" class=\"headerlink\" title=\"docker-compose.yml\"></a>docker-compose.yml</h4><p>常用配置<a href=\"#\">Post not found: compose</a></p>\n<h4 id=\"卸载\"><a href=\"#卸载\" class=\"headerlink\" title=\"卸载\"></a>卸载</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#docker-engine</span><br><span class=\"line\">sudo apt-get remove docker-engine</span><br><span class=\"line\"></span><br><span class=\"line\"># docker-compose </span><br><span class=\"line\">#curl</span><br><span class=\"line\">$ rm /usr/local/bin/docker-compose</span><br><span class=\"line\"># pip</span><br><span class=\"line\">$ pip uninstall docker-compose</span><br></pre></td></tr></table></figure>\n\n\n\n<p>docker.service</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt;/usr/lib/systemd/system/docker.service &lt;&lt;EOF</span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Docker Application Container Engine</span><br><span class=\"line\">Documentation=http://docs.docker.com</span><br><span class=\"line\">After=network.target docker.socket</span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=notify</span><br><span class=\"line\">EnvironmentFile=$BASE/flanneld/subnet.env</span><br><span class=\"line\">WorkingDirectory=/usr/local/bin</span><br><span class=\"line\">ExecStart=/usr/bin/dockerd \\</span><br><span class=\"line\">                \\$DOCKER_NETWORK_OPTIONS \\</span><br><span class=\"line\">                -H unix:///var/run/docker.sock </span><br><span class=\"line\">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class=\"line\"># Having non-zero Limit*s causes performance problems due to accounting overhead</span><br><span class=\"line\"># in the kernel. We recommend using cgroups to do container-local accounting.</span><br><span class=\"line\">LimitNOFILE=infinity</span><br><span class=\"line\">LimitNPROC=infinity</span><br><span class=\"line\">LimitCORE=infinity</span><br><span class=\"line\">TimeoutStartSec=0</span><br><span class=\"line\"># set delegate yes so that systemd does not reset the cgroups of docker containers</span><br><span class=\"line\">Delegate=yes</span><br><span class=\"line\"># kill only the docker process, not all processes in the cgroup</span><br><span class=\"line\">KillMode=process</span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h4 id=\"安装-engine\"><a href=\"#安装-engine\" class=\"headerlink\" title=\"安装 engine\"></a>安装 engine</h4><p>卸载旧版<br><code>sudo apt-get purge docker.io*</code></p>\n<p>编辑 <code> /etc/apt/sources.list.d/docker.list</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;deb https://apt.dockerproject.org/repo debian-jessie main&#x27;&gt; /etc/apt/sources.list.d/docker.list</span><br></pre></td></tr></table></figure>\n<p>安装依赖：<code> apt-transport-https</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install docker-engine</span><br><span class=\"line\">docker version</span><br><span class=\"line\">...permission问题</span><br></pre></td></tr></table></figure>\n<p>创建组</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> cat /etc/group | grep ^docker  #不存在</span><br><span class=\"line\"> sudo groupadd docker  #存在忽略，创建组</span><br><span class=\"line\">sudo gpasswd -a $&#123;USER&#125; docker   #添加当前用户到组</span><br><span class=\"line\">sudo restart  #重启生效</span><br></pre></td></tr></table></figure>","more":"<h4 id=\"安装-compose\"><a href=\"#安装-compose\" class=\"headerlink\" title=\"安装 compose\"></a>安装 compose</h4><p>官方文档 <a href=\"https://docs.docker.com/compose/install/#alternative-install-options\">https://docs.docker.com/compose/install/#alternative-install-options</a></p>\n<h5 id=\"方法一\"><a href=\"#方法一\" class=\"headerlink\" title=\"方法一\"></a>方法一</h5><p>curl 安装</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install curl</span><br></pre></td></tr></table></figure>\n<p>&#x2F;usr&#x2F;local&#x2F;bin 需要权限</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.11.1/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br><span class=\"line\">..... </span><br><span class=\"line\">curl: (56) SSL read: error:00000000:lib(0):func(0):reason(0), errno 104</span><br><span class=\"line\">网络中断n次，推荐离线</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://dl.bintray.com/docker-compose/master/\">离线下载</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mv docker-compose-Linux-x86_64 /usr/local/bin/docker-compose</span><br><span class=\"line\">chmod +x /usr/local/bin/docker-compose</span><br><span class=\"line\">docker-compose --version</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"方法二\"><a href=\"#方法二\" class=\"headerlink\" title=\"方法二\"></a>方法二</h5><p>pip安装<code>pip install docker-compose</code><br><strong>强烈建议您使用 virtualenv，因为许多操作系统有python系统包与docker-compose依赖关系冲突</strong></p>\n<h4 id=\"国内源\"><a href=\"#国内源\" class=\"headerlink\" title=\"国内源\"></a>国内源</h4><p><code>docker search  xxxx</code><br><strong>error response from daemon: Get <a href=\"https://index.docker.io/\">https://index.docker.io</a></strong><br>被 GFW强了<br>Docker配置文件<code>/etc/default/docker</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mousepad /etc/default/docker</span><br><span class=\"line\"></span><br><span class=\"line\">#添加 阿里源</span><br><span class=\"line\">DOCKER_OPTS=&quot;--registry-mirror=http://mirrors.aliyun.com&quot;</span><br></pre></td></tr></table></figure>\n<p>加速地址</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir -p /etc/docker</span><br><span class=\"line\">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;registry-mirrors&quot;: [&quot;https://自己专属.mirror.aliyuncs.com&quot;]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EOF</span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>\n<h4 id=\"docker-compose-yml\"><a href=\"#docker-compose-yml\" class=\"headerlink\" title=\"docker-compose.yml\"></a>docker-compose.yml</h4><p>常用配置<a href=\"#\">Post not found: compose</a></p>\n<h4 id=\"卸载\"><a href=\"#卸载\" class=\"headerlink\" title=\"卸载\"></a>卸载</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#docker-engine</span><br><span class=\"line\">sudo apt-get remove docker-engine</span><br><span class=\"line\"></span><br><span class=\"line\"># docker-compose </span><br><span class=\"line\">#curl</span><br><span class=\"line\">$ rm /usr/local/bin/docker-compose</span><br><span class=\"line\"># pip</span><br><span class=\"line\">$ pip uninstall docker-compose</span><br></pre></td></tr></table></figure>\n\n\n\n<p>docker.service</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt;/usr/lib/systemd/system/docker.service &lt;&lt;EOF</span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Docker Application Container Engine</span><br><span class=\"line\">Documentation=http://docs.docker.com</span><br><span class=\"line\">After=network.target docker.socket</span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=notify</span><br><span class=\"line\">EnvironmentFile=$BASE/flanneld/subnet.env</span><br><span class=\"line\">WorkingDirectory=/usr/local/bin</span><br><span class=\"line\">ExecStart=/usr/bin/dockerd \\</span><br><span class=\"line\">                \\$DOCKER_NETWORK_OPTIONS \\</span><br><span class=\"line\">                -H unix:///var/run/docker.sock </span><br><span class=\"line\">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class=\"line\"># Having non-zero Limit*s causes performance problems due to accounting overhead</span><br><span class=\"line\"># in the kernel. We recommend using cgroups to do container-local accounting.</span><br><span class=\"line\">LimitNOFILE=infinity</span><br><span class=\"line\">LimitNPROC=infinity</span><br><span class=\"line\">LimitCORE=infinity</span><br><span class=\"line\">TimeoutStartSec=0</span><br><span class=\"line\"># set delegate yes so that systemd does not reset the cgroups of docker containers</span><br><span class=\"line\">Delegate=yes</span><br><span class=\"line\"># kill only the docker process, not all processes in the cgroup</span><br><span class=\"line\">KillMode=process</span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>"},{"title":"常用语法","date":"2022-07-11T13:50:49.000Z","_content":"\n\n\n\n\n```\n sudo  service docker status\n\n sudo service docker stop\n\n sudo service docker start\n```\n\n\n\n#### 搜索\n\n```\ndocker search Python\n\n```\n\n#### 拉取\n\n```\ndocker pull python:2.7\n\n```\n\n\n\n#### 查询\n\n镜像  `image`\n\n```\ndocker images\n\n```\n\n\n\n 容器 `container`\n\n```\ndocker ps  #run container\n\ndocker ps -a  #all container\n\n```\n\n##### 日志\n\n```\ndocker logs -f  <container or id>\n\n```\n\n##### 容器信息\n\n```\ndocker inspect  <id>\n\n#查看指定信息\ndocker inspect  <id>  --format '{{.Args}}'\n\ndocker inspect --format='{{.NetworkSettings.IPAddress}}' $CONTAINER_ID\n\n```\n\n<!--more-->\n\n#### 运行\n\n创建镜像  当前路径 **.** 英文点表示\n\n```\ndocker build -t  <镜像名> <Dockerfile路径>\n\n```\n\n修改名字,版本\n\n```\ndocker tag <IMAGE ID>  <名称:版本号>\n\n```\n\n容器安装程序\n\n```\ndocker run python:3.5.3 pip -V\n\n#指定源更新\ndocker run python:3.5.3 pip -i https://mirrors.aliyun.com/pypi/simple/ numpy\n\ndocker run <镜像名> apt-get install -y <程序>  \n\n```\n\n`-y` 交互\n\n\n\n```\n# tomcat 后台运行  p local port:container port     4452镜像id前4位\n\n docker run -d -p 8080:8080 4452\n\n```\n\n 保存容器\n\n```\ndocker commit  <id> <镜像名:版本号>\n\n```\n\n\n\n##### 进入容器\n\n```\n# /bin/bash\ndocker run -i -t  python:3.5.3  /bin/bash\n\n```\n\n##### 共享目录\n\n```\ndocker run -it -v <宿主机绝对路径目录>:<容器目录>  <镜像id>    /bin/bash\n\n```\n\n`-e` 环境变量\n\n```\ndocker run  -e \"MYSQL_ROOT_PASSWORD=19930221\" -it 797e57bb4fea\n\n```\n\n#### 停止\n\n```\ndocker stop <CONTAINER ID>\n\n```\n\n#### 删除\n\n要先停止运行容器stop id\n\n```\ndocker rmi <tag>:<no>\n\n```\n\n所有镜像\n\n```\ndocker rmi $(docker images  -q)\n\n```\n\n\n\n所有容器\n\n```\ndocker rm $(docker ps -a -q)\n\n```\n\n#### 迁移\n\n备份\n\n```\ndocker save <镜像名>  -o  ~/save.tar  \n\n```\n\n还原\n\n```\ndocker load  -i  ~/docker/save.tar\n\n```\n\n\n\n**Ctrl + P + Q** 退出容器\n\n\n\n\n\n#### 性能限制\n\n\n\n容器使用状态\n\n```\ndocker stats  containerId  \n```\n\nk,b,m,g内存\n\ndoc https://docs.docker.com/engine/reference/run/#runtime-constraints-on-resources\n\n\n\nnginx代理\n\n\n\n```\ntinkle-style-dev:\n  restart: always\n  ports:\n    - '18082:8080/tcp'\n  environment:\n    - TZ=Asia/Shanghai\n    - TERM=xterm\n  memswap_limit: 0\n  labels:\n    aliyun.scale: '1'\n  shm_size: 0\n  image: >-\n    registry-internal.cn-shenzhen.aliyuncs.com/tinkle/docker-registry:centos7-lite-1.0\n  memswap_reservation: 0\n  volumes:\n    - >-\n      /mnt/acs_mnt/nas/21ac64b65d/baopinghui/style-service:/app/0.0.1-SNAPSHOT/style-service/:rw\n    - '/home/data/tmpfile/style-service:/tmp:rw'\n    - /mnt/acs_mnt/nas/21ac64b65d/baopinghui/style-service/tinkle-style.conf:/etc/supervisor.conf.d/tinkle-style.conf:rw\n  kernel_memory: 0\n  mem_limit: 0\n```\n\n\n\n/tinkle-style-dev/docker-compose.yml  不指明`container_name`容器名\n\n`docker-compose up -d` 默认 tinkle-style-dev_tinkle-style-dev_1\n\n```\nupstream backend {\n    server tinkle-core-dev_tinkle-core-dev_1:8080;\n}\nupstream style{\n    server tinkle-style-dev_tinkle-style-dev_1:8080;\n}\nupstream ocr{\n    server tinkle-ocr-dev_tinkle-ocr-dev_1:8080;\n}\n log_format  main1  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"'\n                       '$upstream_addr $upstream_response_time $request_time ';\nserver {\n\tlisten       80;\n\tserver_name  api.baopinghui.com;\n\tcharset utf-8;\n\taccess_log  logs/host.access.log  main1;\n      \n      \n\tlocation / {\n\t\t#root   html;\n\t\t#index  index.html index.htm;\n\t\tif ( $request_uri ~* /fastNeuralStyleController ) {\n  \t\t\tproxy_pass http://style;\n\t\t }\n\t\tif ( $request_uri ~* /(style)/(.*) ){\n\t\t\tproxy_pass http://style/$2;\n\t\t}\n\t\tproxy_pass http://backend/;\n\t\tproxy_set_header   Host    $host;\n\t\tproxy_set_header   Cookie $http_cookie; \n\t\tproxy_set_header   X-Real-IP        $remote_addr;\n\t\tproxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;\n\t\tadd_header From localhost;\n\t\tproxy_cookie_path / /; \n\t}\n}\n```\n\n\n\n#### GPU\n\n\n\n```\nlspci | grep -i vga\n```\n\n支持列表 https://developer.nvidia.com/cuda-gpus\n\n下载 http://www.geforce.cn/drivers\n\n\n\n驱动版本\n\n```\ncat /proc/driver/nvidia/version\n```\n\n本机显卡\n\n```\nls -l /dev/nvidia*\n```\n\n\n\n```\nsudo nvidia-smi\n```\n\n![](/pics/nvidia.png)\n\n\n\n温度\n\n```\nsudo nvidia-smi -q -d TEMPERATURE\n```\n\n10s 一次\n\n```\nwatch -n 10 nvidia-smi\n```\n\n\n\n\n\n```\nexport LD_LIBRARY_PATH=\"$LD_LIBRARY_PATH:/usr/local/cuda/lib64\"`\nexport CUDA_HOME=/usr/local/cuda`\n```\n\n> Check failed: s.ok() could not find cudnnCreate in cudnn DSO xxxxx undefined symbol: cudnnCreate\n\n\n\n\n\n#### 错误\n\nNo `command` specified\n\n```\ndocker run -it   xidx  /bin/bash  -c \"ls\"\n```\n\n\n\nOCI runtime create failed: container_linux.go:344: starting container process caused \"exec: \\\"/bin/bash\\\": stat `/bin/bash: no such file or directory`\": unknown.  \n\n```\ndocker run -it   xidx  sh\n```\n\n\n\n","source":"_posts/linux/k8s/docker1.md","raw":"---\ntitle: 常用语法\npermalink: linux/k8s/docker1/\ntags:\n  - docker\ncategories:\n  - linux\n  - k8s\ndate: 2022-07-11 21:50:49\n---\n\n\n\n\n\n```\n sudo  service docker status\n\n sudo service docker stop\n\n sudo service docker start\n```\n\n\n\n#### 搜索\n\n```\ndocker search Python\n\n```\n\n#### 拉取\n\n```\ndocker pull python:2.7\n\n```\n\n\n\n#### 查询\n\n镜像  `image`\n\n```\ndocker images\n\n```\n\n\n\n 容器 `container`\n\n```\ndocker ps  #run container\n\ndocker ps -a  #all container\n\n```\n\n##### 日志\n\n```\ndocker logs -f  <container or id>\n\n```\n\n##### 容器信息\n\n```\ndocker inspect  <id>\n\n#查看指定信息\ndocker inspect  <id>  --format '{{.Args}}'\n\ndocker inspect --format='{{.NetworkSettings.IPAddress}}' $CONTAINER_ID\n\n```\n\n<!--more-->\n\n#### 运行\n\n创建镜像  当前路径 **.** 英文点表示\n\n```\ndocker build -t  <镜像名> <Dockerfile路径>\n\n```\n\n修改名字,版本\n\n```\ndocker tag <IMAGE ID>  <名称:版本号>\n\n```\n\n容器安装程序\n\n```\ndocker run python:3.5.3 pip -V\n\n#指定源更新\ndocker run python:3.5.3 pip -i https://mirrors.aliyun.com/pypi/simple/ numpy\n\ndocker run <镜像名> apt-get install -y <程序>  \n\n```\n\n`-y` 交互\n\n\n\n```\n# tomcat 后台运行  p local port:container port     4452镜像id前4位\n\n docker run -d -p 8080:8080 4452\n\n```\n\n 保存容器\n\n```\ndocker commit  <id> <镜像名:版本号>\n\n```\n\n\n\n##### 进入容器\n\n```\n# /bin/bash\ndocker run -i -t  python:3.5.3  /bin/bash\n\n```\n\n##### 共享目录\n\n```\ndocker run -it -v <宿主机绝对路径目录>:<容器目录>  <镜像id>    /bin/bash\n\n```\n\n`-e` 环境变量\n\n```\ndocker run  -e \"MYSQL_ROOT_PASSWORD=19930221\" -it 797e57bb4fea\n\n```\n\n#### 停止\n\n```\ndocker stop <CONTAINER ID>\n\n```\n\n#### 删除\n\n要先停止运行容器stop id\n\n```\ndocker rmi <tag>:<no>\n\n```\n\n所有镜像\n\n```\ndocker rmi $(docker images  -q)\n\n```\n\n\n\n所有容器\n\n```\ndocker rm $(docker ps -a -q)\n\n```\n\n#### 迁移\n\n备份\n\n```\ndocker save <镜像名>  -o  ~/save.tar  \n\n```\n\n还原\n\n```\ndocker load  -i  ~/docker/save.tar\n\n```\n\n\n\n**Ctrl + P + Q** 退出容器\n\n\n\n\n\n#### 性能限制\n\n\n\n容器使用状态\n\n```\ndocker stats  containerId  \n```\n\nk,b,m,g内存\n\ndoc https://docs.docker.com/engine/reference/run/#runtime-constraints-on-resources\n\n\n\nnginx代理\n\n\n\n```\ntinkle-style-dev:\n  restart: always\n  ports:\n    - '18082:8080/tcp'\n  environment:\n    - TZ=Asia/Shanghai\n    - TERM=xterm\n  memswap_limit: 0\n  labels:\n    aliyun.scale: '1'\n  shm_size: 0\n  image: >-\n    registry-internal.cn-shenzhen.aliyuncs.com/tinkle/docker-registry:centos7-lite-1.0\n  memswap_reservation: 0\n  volumes:\n    - >-\n      /mnt/acs_mnt/nas/21ac64b65d/baopinghui/style-service:/app/0.0.1-SNAPSHOT/style-service/:rw\n    - '/home/data/tmpfile/style-service:/tmp:rw'\n    - /mnt/acs_mnt/nas/21ac64b65d/baopinghui/style-service/tinkle-style.conf:/etc/supervisor.conf.d/tinkle-style.conf:rw\n  kernel_memory: 0\n  mem_limit: 0\n```\n\n\n\n/tinkle-style-dev/docker-compose.yml  不指明`container_name`容器名\n\n`docker-compose up -d` 默认 tinkle-style-dev_tinkle-style-dev_1\n\n```\nupstream backend {\n    server tinkle-core-dev_tinkle-core-dev_1:8080;\n}\nupstream style{\n    server tinkle-style-dev_tinkle-style-dev_1:8080;\n}\nupstream ocr{\n    server tinkle-ocr-dev_tinkle-ocr-dev_1:8080;\n}\n log_format  main1  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"'\n                       '$upstream_addr $upstream_response_time $request_time ';\nserver {\n\tlisten       80;\n\tserver_name  api.baopinghui.com;\n\tcharset utf-8;\n\taccess_log  logs/host.access.log  main1;\n      \n      \n\tlocation / {\n\t\t#root   html;\n\t\t#index  index.html index.htm;\n\t\tif ( $request_uri ~* /fastNeuralStyleController ) {\n  \t\t\tproxy_pass http://style;\n\t\t }\n\t\tif ( $request_uri ~* /(style)/(.*) ){\n\t\t\tproxy_pass http://style/$2;\n\t\t}\n\t\tproxy_pass http://backend/;\n\t\tproxy_set_header   Host    $host;\n\t\tproxy_set_header   Cookie $http_cookie; \n\t\tproxy_set_header   X-Real-IP        $remote_addr;\n\t\tproxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;\n\t\tadd_header From localhost;\n\t\tproxy_cookie_path / /; \n\t}\n}\n```\n\n\n\n#### GPU\n\n\n\n```\nlspci | grep -i vga\n```\n\n支持列表 https://developer.nvidia.com/cuda-gpus\n\n下载 http://www.geforce.cn/drivers\n\n\n\n驱动版本\n\n```\ncat /proc/driver/nvidia/version\n```\n\n本机显卡\n\n```\nls -l /dev/nvidia*\n```\n\n\n\n```\nsudo nvidia-smi\n```\n\n![](/pics/nvidia.png)\n\n\n\n温度\n\n```\nsudo nvidia-smi -q -d TEMPERATURE\n```\n\n10s 一次\n\n```\nwatch -n 10 nvidia-smi\n```\n\n\n\n\n\n```\nexport LD_LIBRARY_PATH=\"$LD_LIBRARY_PATH:/usr/local/cuda/lib64\"`\nexport CUDA_HOME=/usr/local/cuda`\n```\n\n> Check failed: s.ok() could not find cudnnCreate in cudnn DSO xxxxx undefined symbol: cudnnCreate\n\n\n\n\n\n#### 错误\n\nNo `command` specified\n\n```\ndocker run -it   xidx  /bin/bash  -c \"ls\"\n```\n\n\n\nOCI runtime create failed: container_linux.go:344: starting container process caused \"exec: \\\"/bin/bash\\\": stat `/bin/bash: no such file or directory`\": unknown.  \n\n```\ndocker run -it   xidx  sh\n```\n\n\n\n","slug":"linux/k8s/docker1","published":1,"updated":"2022-08-28T09:10:00.940Z","__permalink":"linux/k8s/docker1/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtt6001ugwi5gyti7jh7","content":"<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo  service docker status</span><br><span class=\"line\"></span><br><span class=\"line\">sudo service docker stop</span><br><span class=\"line\"></span><br><span class=\"line\">sudo service docker start</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"搜索\"><a href=\"#搜索\" class=\"headerlink\" title=\"搜索\"></a>搜索</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker search Python</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"拉取\"><a href=\"#拉取\" class=\"headerlink\" title=\"拉取\"></a>拉取</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull python:2.7</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"查询\"><a href=\"#查询\" class=\"headerlink\" title=\"查询\"></a>查询</h4><p>镜像  <code>image</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker images</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p> 容器 <code>container</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker ps  #run container</span><br><span class=\"line\"></span><br><span class=\"line\">docker ps -a  #all container</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"日志\"><a href=\"#日志\" class=\"headerlink\" title=\"日志\"></a>日志</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker logs -f  &lt;container or id&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"容器信息\"><a href=\"#容器信息\" class=\"headerlink\" title=\"容器信息\"></a>容器信息</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker inspect  &lt;id&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">#查看指定信息</span><br><span class=\"line\">docker inspect  &lt;id&gt;  --format &#x27;&#123;&#123;.Args&#125;&#125;&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">docker inspect --format=&#x27;&#123;&#123;.NetworkSettings.IPAddress&#125;&#125;&#x27; $CONTAINER_ID</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n<h4 id=\"运行\"><a href=\"#运行\" class=\"headerlink\" title=\"运行\"></a>运行</h4><p>创建镜像  当前路径 <strong>.</strong> 英文点表示</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker build -t  &lt;镜像名&gt; &lt;Dockerfile路径&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>修改名字,版本</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker tag &lt;IMAGE ID&gt;  &lt;名称:版本号&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>容器安装程序</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run python:3.5.3 pip -V</span><br><span class=\"line\"></span><br><span class=\"line\">#指定源更新</span><br><span class=\"line\">docker run python:3.5.3 pip -i https://mirrors.aliyun.com/pypi/simple/ numpy</span><br><span class=\"line\"></span><br><span class=\"line\">docker run &lt;镜像名&gt; apt-get install -y &lt;程序&gt;  </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><code>-y</code> 交互</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># tomcat 后台运行  p local port:container port     4452镜像id前4位</span><br><span class=\"line\"></span><br><span class=\"line\"> docker run -d -p 8080:8080 4452</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> 保存容器</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker commit  &lt;id&gt; &lt;镜像名:版本号&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"进入容器\"><a href=\"#进入容器\" class=\"headerlink\" title=\"进入容器\"></a>进入容器</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># /bin/bash</span><br><span class=\"line\">docker run -i -t  python:3.5.3  /bin/bash</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"共享目录\"><a href=\"#共享目录\" class=\"headerlink\" title=\"共享目录\"></a>共享目录</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -it -v &lt;宿主机绝对路径目录&gt;:&lt;容器目录&gt;  &lt;镜像id&gt;    /bin/bash</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><code>-e</code> 环境变量</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run  -e &quot;MYSQL_ROOT_PASSWORD=19930221&quot; -it 797e57bb4fea</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"停止\"><a href=\"#停止\" class=\"headerlink\" title=\"停止\"></a>停止</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker stop &lt;CONTAINER ID&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"删除\"><a href=\"#删除\" class=\"headerlink\" title=\"删除\"></a>删除</h4><p>要先停止运行容器stop id</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker rmi &lt;tag&gt;:&lt;no&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>所有镜像</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker rmi $(docker images  -q)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>所有容器</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker rm $(docker ps -a -q)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"迁移\"><a href=\"#迁移\" class=\"headerlink\" title=\"迁移\"></a>迁移</h4><p>备份</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker save &lt;镜像名&gt;  -o  ~/save.tar  </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>还原</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker load  -i  ~/docker/save.tar</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>Ctrl + P + Q</strong> 退出容器</p>\n<h4 id=\"性能限制\"><a href=\"#性能限制\" class=\"headerlink\" title=\"性能限制\"></a>性能限制</h4><p>容器使用状态</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker stats  containerId  </span><br></pre></td></tr></table></figure>\n\n<p>k,b,m,g内存</p>\n<p>doc <a href=\"https://docs.docker.com/engine/reference/run/#runtime-constraints-on-resources\">https://docs.docker.com/engine/reference/run/#runtime-constraints-on-resources</a></p>\n<p>nginx代理</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tinkle-style-dev:</span><br><span class=\"line\">  restart: always</span><br><span class=\"line\">  ports:</span><br><span class=\"line\">    - &#x27;18082:8080/tcp&#x27;</span><br><span class=\"line\">  environment:</span><br><span class=\"line\">    - TZ=Asia/Shanghai</span><br><span class=\"line\">    - TERM=xterm</span><br><span class=\"line\">  memswap_limit: 0</span><br><span class=\"line\">  labels:</span><br><span class=\"line\">    aliyun.scale: &#x27;1&#x27;</span><br><span class=\"line\">  shm_size: 0</span><br><span class=\"line\">  image: &gt;-</span><br><span class=\"line\">    registry-internal.cn-shenzhen.aliyuncs.com/tinkle/docker-registry:centos7-lite-1.0</span><br><span class=\"line\">  memswap_reservation: 0</span><br><span class=\"line\">  volumes:</span><br><span class=\"line\">    - &gt;-</span><br><span class=\"line\">      /mnt/acs_mnt/nas/21ac64b65d/baopinghui/style-service:/app/0.0.1-SNAPSHOT/style-service/:rw</span><br><span class=\"line\">    - &#x27;/home/data/tmpfile/style-service:/tmp:rw&#x27;</span><br><span class=\"line\">    - /mnt/acs_mnt/nas/21ac64b65d/baopinghui/style-service/tinkle-style.conf:/etc/supervisor.conf.d/tinkle-style.conf:rw</span><br><span class=\"line\">  kernel_memory: 0</span><br><span class=\"line\">  mem_limit: 0</span><br></pre></td></tr></table></figure>\n\n\n\n<p>&#x2F;tinkle-style-dev&#x2F;docker-compose.yml  不指明<code>container_name</code>容器名</p>\n<p><code>docker-compose up -d</code> 默认 tinkle-style-dev_tinkle-style-dev_1</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream backend &#123;</span><br><span class=\"line\">    server tinkle-core-dev_tinkle-core-dev_1:8080;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">upstream style&#123;</span><br><span class=\"line\">    server tinkle-style-dev_tinkle-style-dev_1:8080;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">upstream ocr&#123;</span><br><span class=\"line\">    server tinkle-ocr-dev_tinkle-ocr-dev_1:8080;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> log_format  main1  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class=\"line\">                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class=\"line\">                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span><br><span class=\"line\">                       &#x27;$upstream_addr $upstream_response_time $request_time &#x27;;</span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">\tlisten       80;</span><br><span class=\"line\">\tserver_name  api.baopinghui.com;</span><br><span class=\"line\">\tcharset utf-8;</span><br><span class=\"line\">\taccess_log  logs/host.access.log  main1;</span><br><span class=\"line\">      </span><br><span class=\"line\">      </span><br><span class=\"line\">\tlocation / &#123;</span><br><span class=\"line\">\t\t#root   html;</span><br><span class=\"line\">\t\t#index  index.html index.htm;</span><br><span class=\"line\">\t\tif ( $request_uri ~* /fastNeuralStyleController ) &#123;</span><br><span class=\"line\">  \t\t\tproxy_pass http://style;</span><br><span class=\"line\">\t\t &#125;</span><br><span class=\"line\">\t\tif ( $request_uri ~* /(style)/(.*) )&#123;</span><br><span class=\"line\">\t\t\tproxy_pass http://style/$2;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tproxy_pass http://backend/;</span><br><span class=\"line\">\t\tproxy_set_header   Host    $host;</span><br><span class=\"line\">\t\tproxy_set_header   Cookie $http_cookie; </span><br><span class=\"line\">\t\tproxy_set_header   X-Real-IP        $remote_addr;</span><br><span class=\"line\">\t\tproxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;</span><br><span class=\"line\">\t\tadd_header From localhost;</span><br><span class=\"line\">\t\tproxy_cookie_path / /; </span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"GPU\"><a href=\"#GPU\" class=\"headerlink\" title=\"GPU\"></a>GPU</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lspci | grep -i vga</span><br></pre></td></tr></table></figure>\n\n<p>支持列表 <a href=\"https://developer.nvidia.com/cuda-gpus\">https://developer.nvidia.com/cuda-gpus</a></p>\n<p>下载 <a href=\"http://www.geforce.cn/drivers\">http://www.geforce.cn/drivers</a></p>\n<p>驱动版本</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat /proc/driver/nvidia/version</span><br></pre></td></tr></table></figure>\n\n<p>本机显卡</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ls -l /dev/nvidia*</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo nvidia-smi</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/pics/nvidia.png\"></p>\n<p>温度</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo nvidia-smi -q -d TEMPERATURE</span><br></pre></td></tr></table></figure>\n\n<p>10s 一次</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">watch -n 10 nvidia-smi</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export LD_LIBRARY_PATH=&quot;$LD_LIBRARY_PATH:/usr/local/cuda/lib64&quot;`</span><br><span class=\"line\">export CUDA_HOME=/usr/local/cuda`</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Check failed: s.ok() could not find cudnnCreate in cudnn DSO xxxxx undefined symbol: cudnnCreate</p>\n</blockquote>\n<h4 id=\"错误\"><a href=\"#错误\" class=\"headerlink\" title=\"错误\"></a>错误</h4><p>No <code>command</code> specified</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -it   xidx  /bin/bash  -c &quot;ls&quot;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>OCI runtime create failed: container_linux.go:344: starting container process caused “exec: &quot;&#x2F;bin&#x2F;bash&quot;: stat <code>/bin/bash: no such file or directory</code>“: unknown.  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -it   xidx  sh</span><br></pre></td></tr></table></figure>\n\n\n\n","site":{"data":{}},"excerpt":"<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo  service docker status</span><br><span class=\"line\"></span><br><span class=\"line\">sudo service docker stop</span><br><span class=\"line\"></span><br><span class=\"line\">sudo service docker start</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"搜索\"><a href=\"#搜索\" class=\"headerlink\" title=\"搜索\"></a>搜索</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker search Python</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"拉取\"><a href=\"#拉取\" class=\"headerlink\" title=\"拉取\"></a>拉取</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull python:2.7</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"查询\"><a href=\"#查询\" class=\"headerlink\" title=\"查询\"></a>查询</h4><p>镜像  <code>image</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker images</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p> 容器 <code>container</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker ps  #run container</span><br><span class=\"line\"></span><br><span class=\"line\">docker ps -a  #all container</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"日志\"><a href=\"#日志\" class=\"headerlink\" title=\"日志\"></a>日志</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker logs -f  &lt;container or id&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"容器信息\"><a href=\"#容器信息\" class=\"headerlink\" title=\"容器信息\"></a>容器信息</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker inspect  &lt;id&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">#查看指定信息</span><br><span class=\"line\">docker inspect  &lt;id&gt;  --format &#x27;&#123;&#123;.Args&#125;&#125;&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">docker inspect --format=&#x27;&#123;&#123;.NetworkSettings.IPAddress&#125;&#125;&#x27; $CONTAINER_ID</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>","more":"<h4 id=\"运行\"><a href=\"#运行\" class=\"headerlink\" title=\"运行\"></a>运行</h4><p>创建镜像  当前路径 <strong>.</strong> 英文点表示</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker build -t  &lt;镜像名&gt; &lt;Dockerfile路径&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>修改名字,版本</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker tag &lt;IMAGE ID&gt;  &lt;名称:版本号&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>容器安装程序</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run python:3.5.3 pip -V</span><br><span class=\"line\"></span><br><span class=\"line\">#指定源更新</span><br><span class=\"line\">docker run python:3.5.3 pip -i https://mirrors.aliyun.com/pypi/simple/ numpy</span><br><span class=\"line\"></span><br><span class=\"line\">docker run &lt;镜像名&gt; apt-get install -y &lt;程序&gt;  </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><code>-y</code> 交互</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># tomcat 后台运行  p local port:container port     4452镜像id前4位</span><br><span class=\"line\"></span><br><span class=\"line\"> docker run -d -p 8080:8080 4452</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> 保存容器</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker commit  &lt;id&gt; &lt;镜像名:版本号&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"进入容器\"><a href=\"#进入容器\" class=\"headerlink\" title=\"进入容器\"></a>进入容器</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># /bin/bash</span><br><span class=\"line\">docker run -i -t  python:3.5.3  /bin/bash</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"共享目录\"><a href=\"#共享目录\" class=\"headerlink\" title=\"共享目录\"></a>共享目录</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -it -v &lt;宿主机绝对路径目录&gt;:&lt;容器目录&gt;  &lt;镜像id&gt;    /bin/bash</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><code>-e</code> 环境变量</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run  -e &quot;MYSQL_ROOT_PASSWORD=19930221&quot; -it 797e57bb4fea</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"停止\"><a href=\"#停止\" class=\"headerlink\" title=\"停止\"></a>停止</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker stop &lt;CONTAINER ID&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"删除\"><a href=\"#删除\" class=\"headerlink\" title=\"删除\"></a>删除</h4><p>要先停止运行容器stop id</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker rmi &lt;tag&gt;:&lt;no&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>所有镜像</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker rmi $(docker images  -q)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>所有容器</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker rm $(docker ps -a -q)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"迁移\"><a href=\"#迁移\" class=\"headerlink\" title=\"迁移\"></a>迁移</h4><p>备份</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker save &lt;镜像名&gt;  -o  ~/save.tar  </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>还原</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker load  -i  ~/docker/save.tar</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>Ctrl + P + Q</strong> 退出容器</p>\n<h4 id=\"性能限制\"><a href=\"#性能限制\" class=\"headerlink\" title=\"性能限制\"></a>性能限制</h4><p>容器使用状态</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker stats  containerId  </span><br></pre></td></tr></table></figure>\n\n<p>k,b,m,g内存</p>\n<p>doc <a href=\"https://docs.docker.com/engine/reference/run/#runtime-constraints-on-resources\">https://docs.docker.com/engine/reference/run/#runtime-constraints-on-resources</a></p>\n<p>nginx代理</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tinkle-style-dev:</span><br><span class=\"line\">  restart: always</span><br><span class=\"line\">  ports:</span><br><span class=\"line\">    - &#x27;18082:8080/tcp&#x27;</span><br><span class=\"line\">  environment:</span><br><span class=\"line\">    - TZ=Asia/Shanghai</span><br><span class=\"line\">    - TERM=xterm</span><br><span class=\"line\">  memswap_limit: 0</span><br><span class=\"line\">  labels:</span><br><span class=\"line\">    aliyun.scale: &#x27;1&#x27;</span><br><span class=\"line\">  shm_size: 0</span><br><span class=\"line\">  image: &gt;-</span><br><span class=\"line\">    registry-internal.cn-shenzhen.aliyuncs.com/tinkle/docker-registry:centos7-lite-1.0</span><br><span class=\"line\">  memswap_reservation: 0</span><br><span class=\"line\">  volumes:</span><br><span class=\"line\">    - &gt;-</span><br><span class=\"line\">      /mnt/acs_mnt/nas/21ac64b65d/baopinghui/style-service:/app/0.0.1-SNAPSHOT/style-service/:rw</span><br><span class=\"line\">    - &#x27;/home/data/tmpfile/style-service:/tmp:rw&#x27;</span><br><span class=\"line\">    - /mnt/acs_mnt/nas/21ac64b65d/baopinghui/style-service/tinkle-style.conf:/etc/supervisor.conf.d/tinkle-style.conf:rw</span><br><span class=\"line\">  kernel_memory: 0</span><br><span class=\"line\">  mem_limit: 0</span><br></pre></td></tr></table></figure>\n\n\n\n<p>&#x2F;tinkle-style-dev&#x2F;docker-compose.yml  不指明<code>container_name</code>容器名</p>\n<p><code>docker-compose up -d</code> 默认 tinkle-style-dev_tinkle-style-dev_1</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream backend &#123;</span><br><span class=\"line\">    server tinkle-core-dev_tinkle-core-dev_1:8080;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">upstream style&#123;</span><br><span class=\"line\">    server tinkle-style-dev_tinkle-style-dev_1:8080;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">upstream ocr&#123;</span><br><span class=\"line\">    server tinkle-ocr-dev_tinkle-ocr-dev_1:8080;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> log_format  main1  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class=\"line\">                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class=\"line\">                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span><br><span class=\"line\">                       &#x27;$upstream_addr $upstream_response_time $request_time &#x27;;</span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">\tlisten       80;</span><br><span class=\"line\">\tserver_name  api.baopinghui.com;</span><br><span class=\"line\">\tcharset utf-8;</span><br><span class=\"line\">\taccess_log  logs/host.access.log  main1;</span><br><span class=\"line\">      </span><br><span class=\"line\">      </span><br><span class=\"line\">\tlocation / &#123;</span><br><span class=\"line\">\t\t#root   html;</span><br><span class=\"line\">\t\t#index  index.html index.htm;</span><br><span class=\"line\">\t\tif ( $request_uri ~* /fastNeuralStyleController ) &#123;</span><br><span class=\"line\">  \t\t\tproxy_pass http://style;</span><br><span class=\"line\">\t\t &#125;</span><br><span class=\"line\">\t\tif ( $request_uri ~* /(style)/(.*) )&#123;</span><br><span class=\"line\">\t\t\tproxy_pass http://style/$2;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tproxy_pass http://backend/;</span><br><span class=\"line\">\t\tproxy_set_header   Host    $host;</span><br><span class=\"line\">\t\tproxy_set_header   Cookie $http_cookie; </span><br><span class=\"line\">\t\tproxy_set_header   X-Real-IP        $remote_addr;</span><br><span class=\"line\">\t\tproxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;</span><br><span class=\"line\">\t\tadd_header From localhost;</span><br><span class=\"line\">\t\tproxy_cookie_path / /; </span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"GPU\"><a href=\"#GPU\" class=\"headerlink\" title=\"GPU\"></a>GPU</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lspci | grep -i vga</span><br></pre></td></tr></table></figure>\n\n<p>支持列表 <a href=\"https://developer.nvidia.com/cuda-gpus\">https://developer.nvidia.com/cuda-gpus</a></p>\n<p>下载 <a href=\"http://www.geforce.cn/drivers\">http://www.geforce.cn/drivers</a></p>\n<p>驱动版本</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat /proc/driver/nvidia/version</span><br></pre></td></tr></table></figure>\n\n<p>本机显卡</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ls -l /dev/nvidia*</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo nvidia-smi</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/pics/nvidia.png\"></p>\n<p>温度</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo nvidia-smi -q -d TEMPERATURE</span><br></pre></td></tr></table></figure>\n\n<p>10s 一次</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">watch -n 10 nvidia-smi</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export LD_LIBRARY_PATH=&quot;$LD_LIBRARY_PATH:/usr/local/cuda/lib64&quot;`</span><br><span class=\"line\">export CUDA_HOME=/usr/local/cuda`</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Check failed: s.ok() could not find cudnnCreate in cudnn DSO xxxxx undefined symbol: cudnnCreate</p>\n</blockquote>\n<h4 id=\"错误\"><a href=\"#错误\" class=\"headerlink\" title=\"错误\"></a>错误</h4><p>No <code>command</code> specified</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -it   xidx  /bin/bash  -c &quot;ls&quot;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>OCI runtime create failed: container_linux.go:344: starting container process caused “exec: &quot;&#x2F;bin&#x2F;bash&quot;: stat <code>/bin/bash: no such file or directory</code>“: unknown.  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -it   xidx  sh</span><br></pre></td></tr></table></figure>"},{"title":"etcd集群","date":"2022-07-19T13:13:51.000Z","_content":"etcd 下载\n\n\n\n\n\n\n\nhttps://github.com/bitnami/bitnami-docker-etcd\n\n\n\n\n\n```\n$ etcdctl set /atomic.io/network/config '{\"Network\":\"121.21.0.0/16\",\"Backend\":{\"Type\":\"vxlan\"}}'\n```\n\n>{\"Network\":\"121.21.0.0/16\",\"Backend\":{\"Type\":\"vxlan\"}}\n\n\n\nCouldn't fetch network config: client: response is invalid json. The endpoint is probably not valid etcd cluster endpoint. timed out\n\n查阅 flanneld 官网文档，上面标准了 flannel 这个版本不能给 etcd 3 进行通信\n\n```\n$ etcdctl put /atomic.io/network/config '{\"Network\":\"121.21.0.0/16\",\"Backend\":{\"Type\":\"vxlan\"}}'\n$ etcdctl del /atomic.io/network/config\n```\n\n>API VERSION:3.2\n>\n>Did you mean this?\n>\tget\n>\tput\n>\tdel\n>\tuser\n\n\n\netcd environment文档\n\nhttps://doczhcn.gitbook.io/etcd/index/index-1/configuration\n\n\n\n\n\n\n\n```shell\ncs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs\ninsmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs.ko \ncs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs_rr\ninsmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs_rr.ko \ncs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs_wrr\ninsmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs_wrr.ko \ncs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs_sh\ninsmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs_sh.ko\ncs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs_nq\ninsmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs_nq.ko\n```\n\n\n\n```shell\ncs@debian:~/oss/0s/k8s$ sudo ipvsadm -ln\nIP Virtual Server version 1.2.1 (size=4096)\nProt LocalAddress:Port Scheduler Flags\n  -> RemoteAddress:Port           Forward Weight ActiveConn InActConn\n\n```\n\n\n\n```shell\n#两种临时方法\n# echo 1 > /proc/sys/net/ipv4/vs/conntrack\n# sysctl -w net.ipv4.vs.conntrack=1\n```\n\n> 想永久保留配置，可以修改/etc/sysctl.conf文件\n\n\n\n\n\n```\nkubectl create clusterrolebinding test:anonymous --clusterrole=cluster-admin --user=system:anonymous\n```\n\n> configmaps is forbidden: User “system:anonymous” cannot list resource “configmaps” in [API](https://so.csdn.net/so/search?q=API&spm=1001.2101.3001.7020) group “” in the namespace “default”\n\n\n\n```\n[vagrant@k8s master]$ kubectl create clusterrolebinding kubelet-bootstrap --clusterrole=system:node-bootstrapper --user=kubelet-bootstrap\nclusterrolebinding.rbac.authorization.k8s.io/kubelet-bootstrap created\n```\n\n>error: failed to run Kubelet: cannot create certificate signing request: certificatesigningrequests.certificates.k8s.io is forbidden: User \"kubelet-bootstrap\" cannot create certificatesigningrequests.certificates.k8s.io at the cluster\n\n\n\nproxy\n\nunable to create proxier: can't set sysctl net/ipv4/conf/all/route_localnet to 1: open /proc/sys/net/ipv4/conf/all/route_localnet: read-only file system\n\n\n\n```\n sduo  cat > /etc/sysconfig/modules/ipvs.modules <<EOF\n#!/bin/bash\nmodprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- ip_vs_nq\nmodprobe -- nf_conntrack_ipv4\nEOF\n```\n\n\n\n```yaml\n      containers:\n      - name: kube-flannel\n        image: k8s.org/k8s/flannel:v0.11.0-amd64\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        - --iface=eth1\n```\n\n> --iface=eth1\n\n\n\n\n\n```shell\ncs@debian:~$ ansible k8s-108 -m copy -a \"src=/home/cs/oss/0s/k8s/kube-apiserver/docker-compose.yml dest=/opt/kubernetes/master/docker-compose.yml\"   -b --become-method sudo --become-user root\n```\n\nansible k8s-108 -m copy -a \"src=/opt/kubernetes/client/k8s-1.21-11/bin/config.yaml dest=/opt/kubernetes  mode=0644\"   -b --become-method sudo --become-user root\n\n\n\n\n\n```\n[root@k8s kubernetes]# cat > /etc/sysctl.d/k8s.conf << EOF\nnet.ipv4.ip_forward = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\n```\n\n\n\n\n\n```\n cat>/opt/kubernetes/kubelet.env<<EOF\n KUBELET_OPTIONS=\" --hostname-override=192.168.56.108 \\\n  --pod-infra-container-image=k8s.org/k8s/pause:3.4.1 \\\n  --bootstrap-kubeconfig=/opt/kubernetes/config/bootstrap.kubeconfig \\\n  --kubeconfig=/opt/kubernetes/config/kubelet.kubeconfig \\\n   --config=/opt/kubernetes/config/kubelet-conf.yaml   \\\n  --register-node=true \\\n  --cni-bin-dir=/opt/kubernetes/cni/bin --cni-conf-dir=/opt/kubernetes/cni/net.d --network-plugin=cni  \\\n   --runtime-cgroups=/systemd/system.slice  \\\n  --logtostderr=true \"\nEOF\n```\n\n\n\n\n\n\n\n```\n\tcat>/usr/lib/systemd/system/kubelet.service<<EOF\n[Unit]\nDescription=Kubernetes Kubelet Server\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nWorkingDirectory=/var/lib/kubelet\nEnvironmentFile=/opt/kubernetes/kubelet.env\nExecStart=/opt/kubernetes/bin/kubelet  \\$KUBELET_OPTIONS\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\nEOF\n```\n\n\n\n\n\n\n\n","source":"_posts/linux/k8s/etcd.md","raw":"---\ntitle: etcd集群\npermalink: linux/k8s/etcd/\ntags:\n  - etcd\ncategories:\n  - linux\n  - k8s\ndate: 2022-07-19 21:13:51\n---\netcd 下载\n\n\n\n\n\n\n\nhttps://github.com/bitnami/bitnami-docker-etcd\n\n\n\n\n\n```\n$ etcdctl set /atomic.io/network/config '{\"Network\":\"121.21.0.0/16\",\"Backend\":{\"Type\":\"vxlan\"}}'\n```\n\n>{\"Network\":\"121.21.0.0/16\",\"Backend\":{\"Type\":\"vxlan\"}}\n\n\n\nCouldn't fetch network config: client: response is invalid json. The endpoint is probably not valid etcd cluster endpoint. timed out\n\n查阅 flanneld 官网文档，上面标准了 flannel 这个版本不能给 etcd 3 进行通信\n\n```\n$ etcdctl put /atomic.io/network/config '{\"Network\":\"121.21.0.0/16\",\"Backend\":{\"Type\":\"vxlan\"}}'\n$ etcdctl del /atomic.io/network/config\n```\n\n>API VERSION:3.2\n>\n>Did you mean this?\n>\tget\n>\tput\n>\tdel\n>\tuser\n\n\n\netcd environment文档\n\nhttps://doczhcn.gitbook.io/etcd/index/index-1/configuration\n\n\n\n\n\n\n\n```shell\ncs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs\ninsmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs.ko \ncs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs_rr\ninsmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs_rr.ko \ncs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs_wrr\ninsmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs_wrr.ko \ncs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs_sh\ninsmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs_sh.ko\ncs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs_nq\ninsmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs_nq.ko\n```\n\n\n\n```shell\ncs@debian:~/oss/0s/k8s$ sudo ipvsadm -ln\nIP Virtual Server version 1.2.1 (size=4096)\nProt LocalAddress:Port Scheduler Flags\n  -> RemoteAddress:Port           Forward Weight ActiveConn InActConn\n\n```\n\n\n\n```shell\n#两种临时方法\n# echo 1 > /proc/sys/net/ipv4/vs/conntrack\n# sysctl -w net.ipv4.vs.conntrack=1\n```\n\n> 想永久保留配置，可以修改/etc/sysctl.conf文件\n\n\n\n\n\n```\nkubectl create clusterrolebinding test:anonymous --clusterrole=cluster-admin --user=system:anonymous\n```\n\n> configmaps is forbidden: User “system:anonymous” cannot list resource “configmaps” in [API](https://so.csdn.net/so/search?q=API&spm=1001.2101.3001.7020) group “” in the namespace “default”\n\n\n\n```\n[vagrant@k8s master]$ kubectl create clusterrolebinding kubelet-bootstrap --clusterrole=system:node-bootstrapper --user=kubelet-bootstrap\nclusterrolebinding.rbac.authorization.k8s.io/kubelet-bootstrap created\n```\n\n>error: failed to run Kubelet: cannot create certificate signing request: certificatesigningrequests.certificates.k8s.io is forbidden: User \"kubelet-bootstrap\" cannot create certificatesigningrequests.certificates.k8s.io at the cluster\n\n\n\nproxy\n\nunable to create proxier: can't set sysctl net/ipv4/conf/all/route_localnet to 1: open /proc/sys/net/ipv4/conf/all/route_localnet: read-only file system\n\n\n\n```\n sduo  cat > /etc/sysconfig/modules/ipvs.modules <<EOF\n#!/bin/bash\nmodprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- ip_vs_nq\nmodprobe -- nf_conntrack_ipv4\nEOF\n```\n\n\n\n```yaml\n      containers:\n      - name: kube-flannel\n        image: k8s.org/k8s/flannel:v0.11.0-amd64\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        - --iface=eth1\n```\n\n> --iface=eth1\n\n\n\n\n\n```shell\ncs@debian:~$ ansible k8s-108 -m copy -a \"src=/home/cs/oss/0s/k8s/kube-apiserver/docker-compose.yml dest=/opt/kubernetes/master/docker-compose.yml\"   -b --become-method sudo --become-user root\n```\n\nansible k8s-108 -m copy -a \"src=/opt/kubernetes/client/k8s-1.21-11/bin/config.yaml dest=/opt/kubernetes  mode=0644\"   -b --become-method sudo --become-user root\n\n\n\n\n\n```\n[root@k8s kubernetes]# cat > /etc/sysctl.d/k8s.conf << EOF\nnet.ipv4.ip_forward = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\n```\n\n\n\n\n\n```\n cat>/opt/kubernetes/kubelet.env<<EOF\n KUBELET_OPTIONS=\" --hostname-override=192.168.56.108 \\\n  --pod-infra-container-image=k8s.org/k8s/pause:3.4.1 \\\n  --bootstrap-kubeconfig=/opt/kubernetes/config/bootstrap.kubeconfig \\\n  --kubeconfig=/opt/kubernetes/config/kubelet.kubeconfig \\\n   --config=/opt/kubernetes/config/kubelet-conf.yaml   \\\n  --register-node=true \\\n  --cni-bin-dir=/opt/kubernetes/cni/bin --cni-conf-dir=/opt/kubernetes/cni/net.d --network-plugin=cni  \\\n   --runtime-cgroups=/systemd/system.slice  \\\n  --logtostderr=true \"\nEOF\n```\n\n\n\n\n\n\n\n```\n\tcat>/usr/lib/systemd/system/kubelet.service<<EOF\n[Unit]\nDescription=Kubernetes Kubelet Server\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nWorkingDirectory=/var/lib/kubelet\nEnvironmentFile=/opt/kubernetes/kubelet.env\nExecStart=/opt/kubernetes/bin/kubelet  \\$KUBELET_OPTIONS\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\nEOF\n```\n\n\n\n\n\n\n\n","slug":"linux/k8s/etcd","published":1,"updated":"2022-08-28T09:10:00.940Z","__permalink":"linux/k8s/etcd/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtt7001wgwi50q4f8ofd","content":"<p>etcd 下载</p>\n<p><a href=\"https://github.com/bitnami/bitnami-docker-etcd\">https://github.com/bitnami/bitnami-docker-etcd</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ etcdctl set /atomic.io/network/config &#x27;&#123;&quot;Network&quot;:&quot;121.21.0.0/16&quot;,&quot;Backend&quot;:&#123;&quot;Type&quot;:&quot;vxlan&quot;&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>{“Network”:”121.21.0.0&#x2F;16”,”Backend”:{“Type”:”vxlan”}}</p>\n</blockquote>\n<p>Couldn’t fetch network config: client: response is invalid json. The endpoint is probably not valid etcd cluster endpoint. timed out</p>\n<p>查阅 flanneld 官网文档，上面标准了 flannel 这个版本不能给 etcd 3 进行通信</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ etcdctl put /atomic.io/network/config &#x27;&#123;&quot;Network&quot;:&quot;121.21.0.0/16&quot;,&quot;Backend&quot;:&#123;&quot;Type&quot;:&quot;vxlan&quot;&#125;&#125;&#x27;</span><br><span class=\"line\">$ etcdctl del /atomic.io/network/config</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>API VERSION:3.2</p>\n<p>Did you mean this?<br>get<br>put<br>del<br>user</p>\n</blockquote>\n<p>etcd environment文档</p>\n<p><a href=\"https://doczhcn.gitbook.io/etcd/index/index-1/configuration\">https://doczhcn.gitbook.io/etcd/index/index-1/configuration</a></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs</span><br><span class=\"line\">insmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs.ko </span><br><span class=\"line\">cs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs_rr</span><br><span class=\"line\">insmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs_rr.ko </span><br><span class=\"line\">cs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs_wrr</span><br><span class=\"line\">insmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs_wrr.ko </span><br><span class=\"line\">cs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs_sh</span><br><span class=\"line\">insmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs_sh.ko</span><br><span class=\"line\">cs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs_nq</span><br><span class=\"line\">insmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs_nq.ko</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/0s/k8s$ sudo ipvsadm -ln</span><br><span class=\"line\">IP Virtual Server version 1.2.1 (size=4096)</span><br><span class=\"line\">Prot LocalAddress:Port Scheduler Flags</span><br><span class=\"line\"><span class=\"meta prompt_\">  -&gt; </span><span class=\"language-bash\">RemoteAddress:Port           Forward Weight ActiveConn InActConn</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">两种临时方法</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">echo</span> 1 &gt; /proc/sys/net/ipv4/vs/conntrack</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">sysctl -w net.ipv4.vs.conntrack=1</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>想永久保留配置，可以修改&#x2F;etc&#x2F;sysctl.conf文件</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create clusterrolebinding test:anonymous --clusterrole=cluster-admin --user=system:anonymous</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>configmaps is forbidden: User “system:anonymous” cannot list resource “configmaps” in <a href=\"https://so.csdn.net/so/search?q=API&spm=1001.2101.3001.7020\">API</a> group “” in the namespace “default”</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[vagrant@k8s master]$ kubectl create clusterrolebinding kubelet-bootstrap --clusterrole=system:node-bootstrapper --user=kubelet-bootstrap</span><br><span class=\"line\">clusterrolebinding.rbac.authorization.k8s.io/kubelet-bootstrap created</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>error: failed to run Kubelet: cannot create certificate signing request: certificatesigningrequests.certificates.k8s.io is forbidden: User “kubelet-bootstrap” cannot create certificatesigningrequests.certificates.k8s.io at the cluster</p>\n</blockquote>\n<p>proxy</p>\n<p>unable to create proxier: can’t set sysctl net&#x2F;ipv4&#x2F;conf&#x2F;all&#x2F;route_localnet to 1: open &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;conf&#x2F;all&#x2F;route_localnet: read-only file system</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> sduo  cat &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;EOF</span><br><span class=\"line\">#!/bin/bash</span><br><span class=\"line\">modprobe -- ip_vs</span><br><span class=\"line\">modprobe -- ip_vs_rr</span><br><span class=\"line\">modprobe -- ip_vs_wrr</span><br><span class=\"line\">modprobe -- ip_vs_sh</span><br><span class=\"line\">modprobe -- ip_vs_nq</span><br><span class=\"line\">modprobe -- nf_conntrack_ipv4</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">containers:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">kube-flannel</span></span><br><span class=\"line\">  <span class=\"attr\">image:</span> <span class=\"string\">k8s.org/k8s/flannel:v0.11.0-amd64</span></span><br><span class=\"line\">  <span class=\"attr\">command:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">/opt/bin/flanneld</span></span><br><span class=\"line\">  <span class=\"attr\">args:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">--ip-masq</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">--kube-subnet-mgr</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">--iface=eth1</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>–iface&#x3D;eth1</p>\n</blockquote>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ ansible k8s-108 -m copy -a &quot;src=/home/cs/oss/0s/k8s/kube-apiserver/docker-compose.yml dest=/opt/kubernetes/master/docker-compose.yml&quot;   -b --become-method sudo --become-user root</span><br></pre></td></tr></table></figure>\n\n<p>ansible k8s-108 -m copy -a “src&#x3D;&#x2F;opt&#x2F;kubernetes&#x2F;client&#x2F;k8s-1.21-11&#x2F;bin&#x2F;config.yaml dest&#x3D;&#x2F;opt&#x2F;kubernetes  mode&#x3D;0644”   -b –become-method sudo –become-user root</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@k8s kubernetes]# cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt; EOF</span><br><span class=\"line\">net.ipv4.ip_forward = 1</span><br><span class=\"line\">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class=\"line\">net.bridge.bridge-nf-call-iptables = 1</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> cat&gt;/opt/kubernetes/kubelet.env&lt;&lt;EOF</span><br><span class=\"line\"> KUBELET_OPTIONS=&quot; --hostname-override=192.168.56.108 \\</span><br><span class=\"line\">  --pod-infra-container-image=k8s.org/k8s/pause:3.4.1 \\</span><br><span class=\"line\">  --bootstrap-kubeconfig=/opt/kubernetes/config/bootstrap.kubeconfig \\</span><br><span class=\"line\">  --kubeconfig=/opt/kubernetes/config/kubelet.kubeconfig \\</span><br><span class=\"line\">   --config=/opt/kubernetes/config/kubelet-conf.yaml   \\</span><br><span class=\"line\">  --register-node=true \\</span><br><span class=\"line\">  --cni-bin-dir=/opt/kubernetes/cni/bin --cni-conf-dir=/opt/kubernetes/cni/net.d --network-plugin=cni  \\</span><br><span class=\"line\">   --runtime-cgroups=/systemd/system.slice  \\</span><br><span class=\"line\">  --logtostderr=true &quot;</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\tcat&gt;/usr/lib/systemd/system/kubelet.service&lt;&lt;EOF</span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Kubernetes Kubelet Server</span><br><span class=\"line\">Documentation=https://github.com/GoogleCloudPlatform/kubernetes</span><br><span class=\"line\">After=docker.service</span><br><span class=\"line\">Requires=docker.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">WorkingDirectory=/var/lib/kubelet</span><br><span class=\"line\">EnvironmentFile=/opt/kubernetes/kubelet.env</span><br><span class=\"line\">ExecStart=/opt/kubernetes/bin/kubelet  \\$KUBELET_OPTIONS</span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n","site":{"data":{}},"excerpt":"","more":"<p>etcd 下载</p>\n<p><a href=\"https://github.com/bitnami/bitnami-docker-etcd\">https://github.com/bitnami/bitnami-docker-etcd</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ etcdctl set /atomic.io/network/config &#x27;&#123;&quot;Network&quot;:&quot;121.21.0.0/16&quot;,&quot;Backend&quot;:&#123;&quot;Type&quot;:&quot;vxlan&quot;&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>{“Network”:”121.21.0.0&#x2F;16”,”Backend”:{“Type”:”vxlan”}}</p>\n</blockquote>\n<p>Couldn’t fetch network config: client: response is invalid json. The endpoint is probably not valid etcd cluster endpoint. timed out</p>\n<p>查阅 flanneld 官网文档，上面标准了 flannel 这个版本不能给 etcd 3 进行通信</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ etcdctl put /atomic.io/network/config &#x27;&#123;&quot;Network&quot;:&quot;121.21.0.0/16&quot;,&quot;Backend&quot;:&#123;&quot;Type&quot;:&quot;vxlan&quot;&#125;&#125;&#x27;</span><br><span class=\"line\">$ etcdctl del /atomic.io/network/config</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>API VERSION:3.2</p>\n<p>Did you mean this?<br>get<br>put<br>del<br>user</p>\n</blockquote>\n<p>etcd environment文档</p>\n<p><a href=\"https://doczhcn.gitbook.io/etcd/index/index-1/configuration\">https://doczhcn.gitbook.io/etcd/index/index-1/configuration</a></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs</span><br><span class=\"line\">insmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs.ko </span><br><span class=\"line\">cs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs_rr</span><br><span class=\"line\">insmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs_rr.ko </span><br><span class=\"line\">cs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs_wrr</span><br><span class=\"line\">insmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs_wrr.ko </span><br><span class=\"line\">cs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs_sh</span><br><span class=\"line\">insmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs_sh.ko</span><br><span class=\"line\">cs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs_nq</span><br><span class=\"line\">insmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs_nq.ko</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/0s/k8s$ sudo ipvsadm -ln</span><br><span class=\"line\">IP Virtual Server version 1.2.1 (size=4096)</span><br><span class=\"line\">Prot LocalAddress:Port Scheduler Flags</span><br><span class=\"line\"><span class=\"meta prompt_\">  -&gt; </span><span class=\"language-bash\">RemoteAddress:Port           Forward Weight ActiveConn InActConn</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">两种临时方法</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">echo</span> 1 &gt; /proc/sys/net/ipv4/vs/conntrack</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">sysctl -w net.ipv4.vs.conntrack=1</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>想永久保留配置，可以修改&#x2F;etc&#x2F;sysctl.conf文件</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create clusterrolebinding test:anonymous --clusterrole=cluster-admin --user=system:anonymous</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>configmaps is forbidden: User “system:anonymous” cannot list resource “configmaps” in <a href=\"https://so.csdn.net/so/search?q=API&spm=1001.2101.3001.7020\">API</a> group “” in the namespace “default”</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[vagrant@k8s master]$ kubectl create clusterrolebinding kubelet-bootstrap --clusterrole=system:node-bootstrapper --user=kubelet-bootstrap</span><br><span class=\"line\">clusterrolebinding.rbac.authorization.k8s.io/kubelet-bootstrap created</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>error: failed to run Kubelet: cannot create certificate signing request: certificatesigningrequests.certificates.k8s.io is forbidden: User “kubelet-bootstrap” cannot create certificatesigningrequests.certificates.k8s.io at the cluster</p>\n</blockquote>\n<p>proxy</p>\n<p>unable to create proxier: can’t set sysctl net&#x2F;ipv4&#x2F;conf&#x2F;all&#x2F;route_localnet to 1: open &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;conf&#x2F;all&#x2F;route_localnet: read-only file system</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> sduo  cat &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;EOF</span><br><span class=\"line\">#!/bin/bash</span><br><span class=\"line\">modprobe -- ip_vs</span><br><span class=\"line\">modprobe -- ip_vs_rr</span><br><span class=\"line\">modprobe -- ip_vs_wrr</span><br><span class=\"line\">modprobe -- ip_vs_sh</span><br><span class=\"line\">modprobe -- ip_vs_nq</span><br><span class=\"line\">modprobe -- nf_conntrack_ipv4</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">containers:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">kube-flannel</span></span><br><span class=\"line\">  <span class=\"attr\">image:</span> <span class=\"string\">k8s.org/k8s/flannel:v0.11.0-amd64</span></span><br><span class=\"line\">  <span class=\"attr\">command:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">/opt/bin/flanneld</span></span><br><span class=\"line\">  <span class=\"attr\">args:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">--ip-masq</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">--kube-subnet-mgr</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">--iface=eth1</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>–iface&#x3D;eth1</p>\n</blockquote>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ ansible k8s-108 -m copy -a &quot;src=/home/cs/oss/0s/k8s/kube-apiserver/docker-compose.yml dest=/opt/kubernetes/master/docker-compose.yml&quot;   -b --become-method sudo --become-user root</span><br></pre></td></tr></table></figure>\n\n<p>ansible k8s-108 -m copy -a “src&#x3D;&#x2F;opt&#x2F;kubernetes&#x2F;client&#x2F;k8s-1.21-11&#x2F;bin&#x2F;config.yaml dest&#x3D;&#x2F;opt&#x2F;kubernetes  mode&#x3D;0644”   -b –become-method sudo –become-user root</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@k8s kubernetes]# cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt; EOF</span><br><span class=\"line\">net.ipv4.ip_forward = 1</span><br><span class=\"line\">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class=\"line\">net.bridge.bridge-nf-call-iptables = 1</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> cat&gt;/opt/kubernetes/kubelet.env&lt;&lt;EOF</span><br><span class=\"line\"> KUBELET_OPTIONS=&quot; --hostname-override=192.168.56.108 \\</span><br><span class=\"line\">  --pod-infra-container-image=k8s.org/k8s/pause:3.4.1 \\</span><br><span class=\"line\">  --bootstrap-kubeconfig=/opt/kubernetes/config/bootstrap.kubeconfig \\</span><br><span class=\"line\">  --kubeconfig=/opt/kubernetes/config/kubelet.kubeconfig \\</span><br><span class=\"line\">   --config=/opt/kubernetes/config/kubelet-conf.yaml   \\</span><br><span class=\"line\">  --register-node=true \\</span><br><span class=\"line\">  --cni-bin-dir=/opt/kubernetes/cni/bin --cni-conf-dir=/opt/kubernetes/cni/net.d --network-plugin=cni  \\</span><br><span class=\"line\">   --runtime-cgroups=/systemd/system.slice  \\</span><br><span class=\"line\">  --logtostderr=true &quot;</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\tcat&gt;/usr/lib/systemd/system/kubelet.service&lt;&lt;EOF</span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Kubernetes Kubelet Server</span><br><span class=\"line\">Documentation=https://github.com/GoogleCloudPlatform/kubernetes</span><br><span class=\"line\">After=docker.service</span><br><span class=\"line\">Requires=docker.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">WorkingDirectory=/var/lib/kubelet</span><br><span class=\"line\">EnvironmentFile=/opt/kubernetes/kubelet.env</span><br><span class=\"line\">ExecStart=/opt/kubernetes/bin/kubelet  \\$KUBELET_OPTIONS</span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n"},{"title":"flanneld虚拟网络","mathjax":true,"date":"2022-08-01T12:37:39.000Z","_content":"\n\n\ngithub https://github.com/flannel-io/flannel/tree/v0.16.1/Documentation\n\n\n\n### flanneld.yaml \n\n```yaml\n---\napiVersion: policy/v1beta1\nkind: PodSecurityPolicy\nmetadata:\n  name: psp.flannel.unprivileged\n  annotations:\n    seccomp.security.alpha.kubernetes.io/allowedProfileNames: docker/default\n    seccomp.security.alpha.kubernetes.io/defaultProfileName: docker/default\n    apparmor.security.beta.kubernetes.io/allowedProfileNames: runtime/default\n    apparmor.security.beta.kubernetes.io/defaultProfileName: runtime/default\nspec:\n  privileged: false\n  volumes:\n  - configMap\n  - secret\n  - emptyDir\n  - hostPath\n  allowedHostPaths:\n  - pathPrefix: \"/etc/cni/net.d\"\n  - pathPrefix: \"/etc/kube-flannel\"\n  - pathPrefix: \"/run/flannel\"\n  readOnlyRootFilesystem: false\n  # Users and groups\n  runAsUser:\n    rule: RunAsAny\n  supplementalGroups:\n    rule: RunAsAny\n  fsGroup:\n    rule: RunAsAny\n  # Privilege Escalation\n  allowPrivilegeEscalation: false\n  defaultAllowPrivilegeEscalation: false\n  # Capabilities\n  allowedCapabilities: ['NET_ADMIN', 'NET_RAW']\n  defaultAddCapabilities: []\n  requiredDropCapabilities: []\n  # Host namespaces\n  hostPID: false\n  hostIPC: false\n  hostNetwork: true\n  hostPorts:\n  - min: 0\n    max: 65535\n  # SELinux\n  seLinux:\n    # SELinux is unused in CaaSP\n    rule: 'RunAsAny'\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: flannel\nrules:\n- apiGroups: ['extensions']\n  resources: ['podsecuritypolicies']\n  verbs: ['use']\n  resourceNames: ['psp.flannel.unprivileged']\n- apiGroups:\n  - \"\"\n  resources:\n  - pods\n  verbs:\n  - get\n- apiGroups:\n  - \"\"\n  resources:\n  - nodes\n  verbs:\n  - list\n  - watch\n- apiGroups:\n  - \"\"\n  resources:\n  - nodes/status\n  verbs:\n  - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"cniVersion\": \"0.3.1\",\n      \"plugins\": [\n        {\n          \"type\": \"flannel\",\n          \"delegate\": {\n            \"hairpinMode\": true,\n            \"isDefaultGateway\": true\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"capabilities\": {\n            \"portMappings\": true\n          }\n        }\n      ]\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"10.244.0.0/16\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n            - matchExpressions:\n              - key: kubernetes.io/os\n                operator: In\n                values:\n                - linux\n      hostNetwork: true\n      priorityClassName: system-node-critical\n      tolerations:\n      - operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni-plugin\n        image: k8s.org/k8s/flannel-cni-plugin:v1.0.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - /flannel\n        - /opt/cni/bin/flannel\n        volumeMounts:\n        - name: cni-plugin\n          mountPath: /opt/cni/bin\n      - name: install-cni\n        image: k8s.org/k8s/flannel:v0.15.1-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumeMounts:\n        - name: cni\n          mountPath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: k8s.org/k8s/flannel:v0.15.1-amd64\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        - --iface=eth1\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: false\n          capabilities:\n            add: [\"NET_ADMIN\", \"NET_RAW\"]\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: /run/flannel\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      volumes:\n      - name: run\n        hostPath:\n          path: /run/flannel\n      - name: cni-plugin\n        hostPath:\n          path: /opt/cni/bin\n      - name: cni\n        hostPath:\n          path: /etc/cni/net.d\n      - name: flannel-cfg\n        configMap:\n          name: kube-flannel-cfg\n```\n\n\n\n","source":"_posts/linux/k8s/flanneld.md","raw":"---\ntitle: flanneld虚拟网络\npermalink: linux/k8s/flanneld/\ntags:\n  - flanneld\ncategories:\n  - linux\n  - k8s\nmathjax: true\ndate: 2022-08-01 20:37:39\n---\n\n\n\ngithub https://github.com/flannel-io/flannel/tree/v0.16.1/Documentation\n\n\n\n### flanneld.yaml \n\n```yaml\n---\napiVersion: policy/v1beta1\nkind: PodSecurityPolicy\nmetadata:\n  name: psp.flannel.unprivileged\n  annotations:\n    seccomp.security.alpha.kubernetes.io/allowedProfileNames: docker/default\n    seccomp.security.alpha.kubernetes.io/defaultProfileName: docker/default\n    apparmor.security.beta.kubernetes.io/allowedProfileNames: runtime/default\n    apparmor.security.beta.kubernetes.io/defaultProfileName: runtime/default\nspec:\n  privileged: false\n  volumes:\n  - configMap\n  - secret\n  - emptyDir\n  - hostPath\n  allowedHostPaths:\n  - pathPrefix: \"/etc/cni/net.d\"\n  - pathPrefix: \"/etc/kube-flannel\"\n  - pathPrefix: \"/run/flannel\"\n  readOnlyRootFilesystem: false\n  # Users and groups\n  runAsUser:\n    rule: RunAsAny\n  supplementalGroups:\n    rule: RunAsAny\n  fsGroup:\n    rule: RunAsAny\n  # Privilege Escalation\n  allowPrivilegeEscalation: false\n  defaultAllowPrivilegeEscalation: false\n  # Capabilities\n  allowedCapabilities: ['NET_ADMIN', 'NET_RAW']\n  defaultAddCapabilities: []\n  requiredDropCapabilities: []\n  # Host namespaces\n  hostPID: false\n  hostIPC: false\n  hostNetwork: true\n  hostPorts:\n  - min: 0\n    max: 65535\n  # SELinux\n  seLinux:\n    # SELinux is unused in CaaSP\n    rule: 'RunAsAny'\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: flannel\nrules:\n- apiGroups: ['extensions']\n  resources: ['podsecuritypolicies']\n  verbs: ['use']\n  resourceNames: ['psp.flannel.unprivileged']\n- apiGroups:\n  - \"\"\n  resources:\n  - pods\n  verbs:\n  - get\n- apiGroups:\n  - \"\"\n  resources:\n  - nodes\n  verbs:\n  - list\n  - watch\n- apiGroups:\n  - \"\"\n  resources:\n  - nodes/status\n  verbs:\n  - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"cniVersion\": \"0.3.1\",\n      \"plugins\": [\n        {\n          \"type\": \"flannel\",\n          \"delegate\": {\n            \"hairpinMode\": true,\n            \"isDefaultGateway\": true\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"capabilities\": {\n            \"portMappings\": true\n          }\n        }\n      ]\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"10.244.0.0/16\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n            - matchExpressions:\n              - key: kubernetes.io/os\n                operator: In\n                values:\n                - linux\n      hostNetwork: true\n      priorityClassName: system-node-critical\n      tolerations:\n      - operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni-plugin\n        image: k8s.org/k8s/flannel-cni-plugin:v1.0.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - /flannel\n        - /opt/cni/bin/flannel\n        volumeMounts:\n        - name: cni-plugin\n          mountPath: /opt/cni/bin\n      - name: install-cni\n        image: k8s.org/k8s/flannel:v0.15.1-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumeMounts:\n        - name: cni\n          mountPath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: k8s.org/k8s/flannel:v0.15.1-amd64\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        - --iface=eth1\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: false\n          capabilities:\n            add: [\"NET_ADMIN\", \"NET_RAW\"]\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: /run/flannel\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      volumes:\n      - name: run\n        hostPath:\n          path: /run/flannel\n      - name: cni-plugin\n        hostPath:\n          path: /opt/cni/bin\n      - name: cni\n        hostPath:\n          path: /etc/cni/net.d\n      - name: flannel-cfg\n        configMap:\n          name: kube-flannel-cfg\n```\n\n\n\n","slug":"linux/k8s/flanneld","published":1,"updated":"2022-08-28T09:10:00.936Z","__permalink":"linux/k8s/flanneld/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtt8001ygwi50f1df6d3","content":"<p>github <a href=\"https://github.com/flannel-io/flannel/tree/v0.16.1/Documentation\">https://github.com/flannel-io/flannel/tree/v0.16.1/Documentation</a></p>\n<h3 id=\"flanneld-yaml\"><a href=\"#flanneld-yaml\" class=\"headerlink\" title=\"flanneld.yaml\"></a>flanneld.yaml</h3><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">policy/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PodSecurityPolicy</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">psp.flannel.unprivileged</span></span><br><span class=\"line\">  <span class=\"attr\">annotations:</span></span><br><span class=\"line\">    <span class=\"attr\">seccomp.security.alpha.kubernetes.io/allowedProfileNames:</span> <span class=\"string\">docker/default</span></span><br><span class=\"line\">    <span class=\"attr\">seccomp.security.alpha.kubernetes.io/defaultProfileName:</span> <span class=\"string\">docker/default</span></span><br><span class=\"line\">    <span class=\"attr\">apparmor.security.beta.kubernetes.io/allowedProfileNames:</span> <span class=\"string\">runtime/default</span></span><br><span class=\"line\">    <span class=\"attr\">apparmor.security.beta.kubernetes.io/defaultProfileName:</span> <span class=\"string\">runtime/default</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">privileged:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">configMap</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">secret</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">emptyDir</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">hostPath</span></span><br><span class=\"line\">  <span class=\"attr\">allowedHostPaths:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">pathPrefix:</span> <span class=\"string\">&quot;/etc/cni/net.d&quot;</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">pathPrefix:</span> <span class=\"string\">&quot;/etc/kube-flannel&quot;</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">pathPrefix:</span> <span class=\"string\">&quot;/run/flannel&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">readOnlyRootFilesystem:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\"># Users and groups</span></span><br><span class=\"line\">  <span class=\"attr\">runAsUser:</span></span><br><span class=\"line\">    <span class=\"attr\">rule:</span> <span class=\"string\">RunAsAny</span></span><br><span class=\"line\">  <span class=\"attr\">supplementalGroups:</span></span><br><span class=\"line\">    <span class=\"attr\">rule:</span> <span class=\"string\">RunAsAny</span></span><br><span class=\"line\">  <span class=\"attr\">fsGroup:</span></span><br><span class=\"line\">    <span class=\"attr\">rule:</span> <span class=\"string\">RunAsAny</span></span><br><span class=\"line\">  <span class=\"comment\"># Privilege Escalation</span></span><br><span class=\"line\">  <span class=\"attr\">allowPrivilegeEscalation:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">defaultAllowPrivilegeEscalation:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\"># Capabilities</span></span><br><span class=\"line\">  <span class=\"attr\">allowedCapabilities:</span> [<span class=\"string\">&#x27;NET_ADMIN&#x27;</span>, <span class=\"string\">&#x27;NET_RAW&#x27;</span>]</span><br><span class=\"line\">  <span class=\"attr\">defaultAddCapabilities:</span> []</span><br><span class=\"line\">  <span class=\"attr\">requiredDropCapabilities:</span> []</span><br><span class=\"line\">  <span class=\"comment\"># Host namespaces</span></span><br><span class=\"line\">  <span class=\"attr\">hostPID:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">hostIPC:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">hostNetwork:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">hostPorts:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">min:</span> <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"attr\">max:</span> <span class=\"number\">65535</span></span><br><span class=\"line\">  <span class=\"comment\"># SELinux</span></span><br><span class=\"line\">  <span class=\"attr\">seLinux:</span></span><br><span class=\"line\">    <span class=\"comment\"># SELinux is unused in CaaSP</span></span><br><span class=\"line\">    <span class=\"attr\">rule:</span> <span class=\"string\">&#x27;RunAsAny&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span> [<span class=\"string\">&#x27;extensions&#x27;</span>]</span><br><span class=\"line\">  <span class=\"attr\">resources:</span> [<span class=\"string\">&#x27;podsecuritypolicies&#x27;</span>]</span><br><span class=\"line\">  <span class=\"attr\">verbs:</span> [<span class=\"string\">&#x27;use&#x27;</span>]</span><br><span class=\"line\">  <span class=\"attr\">resourceNames:</span> [<span class=\"string\">&#x27;psp.flannel.unprivileged&#x27;</span>]</span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">pods</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">get</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nodes</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">list</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">watch</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nodes/status</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">patch</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ConfigMap</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">kube-flannel-cfg</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">tier:</span> <span class=\"string\">node</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\">  <span class=\"attr\">cni-conf.json:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">    &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;name&quot;: &quot;cbr0&quot;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;cniVersion&quot;: &quot;0.3.1&quot;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;plugins&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">        &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;: &quot;flannel&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;delegate&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">            &quot;hairpinMode&quot;: true,</span></span><br><span class=\"line\"><span class=\"string\">            &quot;isDefaultGateway&quot;: true</span></span><br><span class=\"line\"><span class=\"string\">          &#125;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;: &quot;portmap&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;capabilities&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">            &quot;portMappings&quot;: true</span></span><br><span class=\"line\"><span class=\"string\">          &#125;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      ]</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\"></span>  <span class=\"attr\">net-conf.json:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">    &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;Network&quot;: &quot;10.244.0.0/16&quot;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;Backend&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;Type&quot;: &quot;vxlan&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\"></span><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">DaemonSet</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">kube-flannel-ds</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">tier:</span> <span class=\"string\">node</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">tier:</span> <span class=\"string\">node</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">affinity:</span></span><br><span class=\"line\">        <span class=\"attr\">nodeAffinity:</span></span><br><span class=\"line\">          <span class=\"attr\">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class=\"line\">            <span class=\"attr\">nodeSelectorTerms:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">matchExpressions:</span></span><br><span class=\"line\">              <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">kubernetes.io/os</span></span><br><span class=\"line\">                <span class=\"attr\">operator:</span> <span class=\"string\">In</span></span><br><span class=\"line\">                <span class=\"attr\">values:</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">linux</span></span><br><span class=\"line\">      <span class=\"attr\">hostNetwork:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">priorityClassName:</span> <span class=\"string\">system-node-critical</span></span><br><span class=\"line\">      <span class=\"attr\">tolerations:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">operator:</span> <span class=\"string\">Exists</span></span><br><span class=\"line\">        <span class=\"attr\">effect:</span> <span class=\"string\">NoSchedule</span></span><br><span class=\"line\">      <span class=\"attr\">serviceAccountName:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">      <span class=\"attr\">initContainers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">install-cni-plugin</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">k8s.org/k8s/flannel-cni-plugin:v1.0.0-amd64</span></span><br><span class=\"line\">        <span class=\"attr\">command:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">cp</span></span><br><span class=\"line\">        <span class=\"attr\">args:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">-f</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">/flannel</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">/opt/cni/bin/flannel</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">cni-plugin</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/opt/cni/bin</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">install-cni</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">k8s.org/k8s/flannel:v0.15.1-amd64</span></span><br><span class=\"line\">        <span class=\"attr\">command:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">cp</span></span><br><span class=\"line\">        <span class=\"attr\">args:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">-f</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">/etc/kube-flannel/cni-conf.json</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">/etc/cni/net.d/10-flannel.conflist</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">cni</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/cni/net.d</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">flannel-cfg</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/kube-flannel/</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">kube-flannel</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">k8s.org/k8s/flannel:v0.15.1-amd64</span></span><br><span class=\"line\">        <span class=\"attr\">command:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">/opt/bin/flanneld</span></span><br><span class=\"line\">        <span class=\"attr\">args:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--ip-masq</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--kube-subnet-mgr</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--iface=eth1</span></span><br><span class=\"line\">        <span class=\"attr\">resources:</span></span><br><span class=\"line\">          <span class=\"attr\">requests:</span></span><br><span class=\"line\">            <span class=\"attr\">cpu:</span> <span class=\"string\">&quot;100m&quot;</span></span><br><span class=\"line\">            <span class=\"attr\">memory:</span> <span class=\"string\">&quot;50Mi&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">limits:</span></span><br><span class=\"line\">            <span class=\"attr\">cpu:</span> <span class=\"string\">&quot;100m&quot;</span></span><br><span class=\"line\">            <span class=\"attr\">memory:</span> <span class=\"string\">&quot;50Mi&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">securityContext:</span></span><br><span class=\"line\">          <span class=\"attr\">privileged:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">          <span class=\"attr\">capabilities:</span></span><br><span class=\"line\">            <span class=\"attr\">add:</span> [<span class=\"string\">&quot;NET_ADMIN&quot;</span>, <span class=\"string\">&quot;NET_RAW&quot;</span>]</span><br><span class=\"line\">        <span class=\"attr\">env:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">POD_NAME</span></span><br><span class=\"line\">          <span class=\"attr\">valueFrom:</span></span><br><span class=\"line\">            <span class=\"attr\">fieldRef:</span></span><br><span class=\"line\">              <span class=\"attr\">fieldPath:</span> <span class=\"string\">metadata.name</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">POD_NAMESPACE</span></span><br><span class=\"line\">          <span class=\"attr\">valueFrom:</span></span><br><span class=\"line\">            <span class=\"attr\">fieldRef:</span></span><br><span class=\"line\">              <span class=\"attr\">fieldPath:</span> <span class=\"string\">metadata.namespace</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">run</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/run/flannel</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">flannel-cfg</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/kube-flannel/</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">run</span></span><br><span class=\"line\">        <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">          <span class=\"attr\">path:</span> <span class=\"string\">/run/flannel</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">cni-plugin</span></span><br><span class=\"line\">        <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">          <span class=\"attr\">path:</span> <span class=\"string\">/opt/cni/bin</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">cni</span></span><br><span class=\"line\">        <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">          <span class=\"attr\">path:</span> <span class=\"string\">/etc/cni/net.d</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">flannel-cfg</span></span><br><span class=\"line\">        <span class=\"attr\">configMap:</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">kube-flannel-cfg</span></span><br></pre></td></tr></table></figure>\n\n\n\n","site":{"data":{}},"excerpt":"","more":"<p>github <a href=\"https://github.com/flannel-io/flannel/tree/v0.16.1/Documentation\">https://github.com/flannel-io/flannel/tree/v0.16.1/Documentation</a></p>\n<h3 id=\"flanneld-yaml\"><a href=\"#flanneld-yaml\" class=\"headerlink\" title=\"flanneld.yaml\"></a>flanneld.yaml</h3><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">policy/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">PodSecurityPolicy</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">psp.flannel.unprivileged</span></span><br><span class=\"line\">  <span class=\"attr\">annotations:</span></span><br><span class=\"line\">    <span class=\"attr\">seccomp.security.alpha.kubernetes.io/allowedProfileNames:</span> <span class=\"string\">docker/default</span></span><br><span class=\"line\">    <span class=\"attr\">seccomp.security.alpha.kubernetes.io/defaultProfileName:</span> <span class=\"string\">docker/default</span></span><br><span class=\"line\">    <span class=\"attr\">apparmor.security.beta.kubernetes.io/allowedProfileNames:</span> <span class=\"string\">runtime/default</span></span><br><span class=\"line\">    <span class=\"attr\">apparmor.security.beta.kubernetes.io/defaultProfileName:</span> <span class=\"string\">runtime/default</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">privileged:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">volumes:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">configMap</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">secret</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">emptyDir</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">hostPath</span></span><br><span class=\"line\">  <span class=\"attr\">allowedHostPaths:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">pathPrefix:</span> <span class=\"string\">&quot;/etc/cni/net.d&quot;</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">pathPrefix:</span> <span class=\"string\">&quot;/etc/kube-flannel&quot;</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">pathPrefix:</span> <span class=\"string\">&quot;/run/flannel&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">readOnlyRootFilesystem:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\"># Users and groups</span></span><br><span class=\"line\">  <span class=\"attr\">runAsUser:</span></span><br><span class=\"line\">    <span class=\"attr\">rule:</span> <span class=\"string\">RunAsAny</span></span><br><span class=\"line\">  <span class=\"attr\">supplementalGroups:</span></span><br><span class=\"line\">    <span class=\"attr\">rule:</span> <span class=\"string\">RunAsAny</span></span><br><span class=\"line\">  <span class=\"attr\">fsGroup:</span></span><br><span class=\"line\">    <span class=\"attr\">rule:</span> <span class=\"string\">RunAsAny</span></span><br><span class=\"line\">  <span class=\"comment\"># Privilege Escalation</span></span><br><span class=\"line\">  <span class=\"attr\">allowPrivilegeEscalation:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">defaultAllowPrivilegeEscalation:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\"># Capabilities</span></span><br><span class=\"line\">  <span class=\"attr\">allowedCapabilities:</span> [<span class=\"string\">&#x27;NET_ADMIN&#x27;</span>, <span class=\"string\">&#x27;NET_RAW&#x27;</span>]</span><br><span class=\"line\">  <span class=\"attr\">defaultAddCapabilities:</span> []</span><br><span class=\"line\">  <span class=\"attr\">requiredDropCapabilities:</span> []</span><br><span class=\"line\">  <span class=\"comment\"># Host namespaces</span></span><br><span class=\"line\">  <span class=\"attr\">hostPID:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">hostIPC:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">hostNetwork:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">hostPorts:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">min:</span> <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"attr\">max:</span> <span class=\"number\">65535</span></span><br><span class=\"line\">  <span class=\"comment\"># SELinux</span></span><br><span class=\"line\">  <span class=\"attr\">seLinux:</span></span><br><span class=\"line\">    <span class=\"comment\"># SELinux is unused in CaaSP</span></span><br><span class=\"line\">    <span class=\"attr\">rule:</span> <span class=\"string\">&#x27;RunAsAny&#x27;</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span> [<span class=\"string\">&#x27;extensions&#x27;</span>]</span><br><span class=\"line\">  <span class=\"attr\">resources:</span> [<span class=\"string\">&#x27;podsecuritypolicies&#x27;</span>]</span><br><span class=\"line\">  <span class=\"attr\">verbs:</span> [<span class=\"string\">&#x27;use&#x27;</span>]</span><br><span class=\"line\">  <span class=\"attr\">resourceNames:</span> [<span class=\"string\">&#x27;psp.flannel.unprivileged&#x27;</span>]</span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">pods</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">get</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nodes</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">list</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">watch</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nodes/status</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">patch</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ConfigMap</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">kube-flannel-cfg</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">tier:</span> <span class=\"string\">node</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\">  <span class=\"attr\">cni-conf.json:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">    &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;name&quot;: &quot;cbr0&quot;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;cniVersion&quot;: &quot;0.3.1&quot;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;plugins&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">        &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;: &quot;flannel&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;delegate&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">            &quot;hairpinMode&quot;: true,</span></span><br><span class=\"line\"><span class=\"string\">            &quot;isDefaultGateway&quot;: true</span></span><br><span class=\"line\"><span class=\"string\">          &#125;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;,</span></span><br><span class=\"line\"><span class=\"string\">        &#123;</span></span><br><span class=\"line\"><span class=\"string\">          &quot;type&quot;: &quot;portmap&quot;,</span></span><br><span class=\"line\"><span class=\"string\">          &quot;capabilities&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">            &quot;portMappings&quot;: true</span></span><br><span class=\"line\"><span class=\"string\">          &#125;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      ]</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\"></span>  <span class=\"attr\">net-conf.json:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">    &#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;Network&quot;: &quot;10.244.0.0/16&quot;,</span></span><br><span class=\"line\"><span class=\"string\">      &quot;Backend&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;Type&quot;: &quot;vxlan&quot;</span></span><br><span class=\"line\"><span class=\"string\">      &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\"></span><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">DaemonSet</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">kube-flannel-ds</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">tier:</span> <span class=\"string\">node</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">tier:</span> <span class=\"string\">node</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">affinity:</span></span><br><span class=\"line\">        <span class=\"attr\">nodeAffinity:</span></span><br><span class=\"line\">          <span class=\"attr\">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class=\"line\">            <span class=\"attr\">nodeSelectorTerms:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">matchExpressions:</span></span><br><span class=\"line\">              <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">kubernetes.io/os</span></span><br><span class=\"line\">                <span class=\"attr\">operator:</span> <span class=\"string\">In</span></span><br><span class=\"line\">                <span class=\"attr\">values:</span></span><br><span class=\"line\">                <span class=\"bullet\">-</span> <span class=\"string\">linux</span></span><br><span class=\"line\">      <span class=\"attr\">hostNetwork:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">priorityClassName:</span> <span class=\"string\">system-node-critical</span></span><br><span class=\"line\">      <span class=\"attr\">tolerations:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">operator:</span> <span class=\"string\">Exists</span></span><br><span class=\"line\">        <span class=\"attr\">effect:</span> <span class=\"string\">NoSchedule</span></span><br><span class=\"line\">      <span class=\"attr\">serviceAccountName:</span> <span class=\"string\">flannel</span></span><br><span class=\"line\">      <span class=\"attr\">initContainers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">install-cni-plugin</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">k8s.org/k8s/flannel-cni-plugin:v1.0.0-amd64</span></span><br><span class=\"line\">        <span class=\"attr\">command:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">cp</span></span><br><span class=\"line\">        <span class=\"attr\">args:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">-f</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">/flannel</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">/opt/cni/bin/flannel</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">cni-plugin</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/opt/cni/bin</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">install-cni</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">k8s.org/k8s/flannel:v0.15.1-amd64</span></span><br><span class=\"line\">        <span class=\"attr\">command:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">cp</span></span><br><span class=\"line\">        <span class=\"attr\">args:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">-f</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">/etc/kube-flannel/cni-conf.json</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">/etc/cni/net.d/10-flannel.conflist</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">cni</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/cni/net.d</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">flannel-cfg</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/kube-flannel/</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">kube-flannel</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">k8s.org/k8s/flannel:v0.15.1-amd64</span></span><br><span class=\"line\">        <span class=\"attr\">command:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">/opt/bin/flanneld</span></span><br><span class=\"line\">        <span class=\"attr\">args:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--ip-masq</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--kube-subnet-mgr</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--iface=eth1</span></span><br><span class=\"line\">        <span class=\"attr\">resources:</span></span><br><span class=\"line\">          <span class=\"attr\">requests:</span></span><br><span class=\"line\">            <span class=\"attr\">cpu:</span> <span class=\"string\">&quot;100m&quot;</span></span><br><span class=\"line\">            <span class=\"attr\">memory:</span> <span class=\"string\">&quot;50Mi&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">limits:</span></span><br><span class=\"line\">            <span class=\"attr\">cpu:</span> <span class=\"string\">&quot;100m&quot;</span></span><br><span class=\"line\">            <span class=\"attr\">memory:</span> <span class=\"string\">&quot;50Mi&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">securityContext:</span></span><br><span class=\"line\">          <span class=\"attr\">privileged:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">          <span class=\"attr\">capabilities:</span></span><br><span class=\"line\">            <span class=\"attr\">add:</span> [<span class=\"string\">&quot;NET_ADMIN&quot;</span>, <span class=\"string\">&quot;NET_RAW&quot;</span>]</span><br><span class=\"line\">        <span class=\"attr\">env:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">POD_NAME</span></span><br><span class=\"line\">          <span class=\"attr\">valueFrom:</span></span><br><span class=\"line\">            <span class=\"attr\">fieldRef:</span></span><br><span class=\"line\">              <span class=\"attr\">fieldPath:</span> <span class=\"string\">metadata.name</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">POD_NAMESPACE</span></span><br><span class=\"line\">          <span class=\"attr\">valueFrom:</span></span><br><span class=\"line\">            <span class=\"attr\">fieldRef:</span></span><br><span class=\"line\">              <span class=\"attr\">fieldPath:</span> <span class=\"string\">metadata.namespace</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">run</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/run/flannel</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">flannel-cfg</span></span><br><span class=\"line\">          <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/kube-flannel/</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">run</span></span><br><span class=\"line\">        <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">          <span class=\"attr\">path:</span> <span class=\"string\">/run/flannel</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">cni-plugin</span></span><br><span class=\"line\">        <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">          <span class=\"attr\">path:</span> <span class=\"string\">/opt/cni/bin</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">cni</span></span><br><span class=\"line\">        <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">          <span class=\"attr\">path:</span> <span class=\"string\">/etc/cni/net.d</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">flannel-cfg</span></span><br><span class=\"line\">        <span class=\"attr\">configMap:</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">kube-flannel-cfg</span></span><br></pre></td></tr></table></figure>\n\n\n\n"},{"title":"harbor镜像私库","date":"2022-08-13T05:47:30.000Z","_content":"\n## 配置要求\n\n### 硬件\n\n| 资源 | 最低  | 推荐   |\n| ---- | ----- | ------ |\n| CPU  | 2 CPU | 4 CPU  |\n| Mem  | 4 GB  | 8 GB   |\n| Disk | 40 GB | 160 GB |\n\n\n\n### 软件\n\ndocker  v17.06.0-ce+  [Docker 引擎文档](https://docs.docker.com/engine/installation/)\n\ndocker-compose v1.18.0+  [Docker Compose 文档](https://docs.docker.com/compose/install/)\n\nOpenSSL\n\n\n\n### 网络端口\n\nHTTPS  443/4443\n\nHTTP  80\n\n\n\n## 安装\n\n仓库\n\nhttps://github.com/goharbor/harbor/releases\n\n文档\n\nhttps://goharbor.io/docs/2.5.3/install-config/download-installer/\n\n\n\n### harbor\n\n#### 证书ca.key\n\nhttps://goharbor.io/docs/2.5.3/install-config/configure-https/\n\n##### 生成CA私钥\n\n```shell\n openssl genrsa -out ca.key 4096\n```\n\n<!--more-->\n\n##### 生成CA证书\n\n```shell\n openssl req -x509 -new -nodes -sha512 -days 3650 \\\n -subj \"/C=CN/ST=GD/L=SZ/O=cs/OU=shea/CN=k8s.org\" \\\n  -key ca.key \\\n  -out ca.crtopenssl genrsa -out ca.key 4096\n```\n\n#### 服务器证书\n\n##### 生成私钥\n\n```shell\n openssl genrsa -out k8s.org.key 4096\n```\n\n##### 生成证书签名请求（CSR）\n\n```shell\nopenssl  req -sha512 -new \\\n -subj \"/C=CN/ST=GD/L=SZ/O=cs/OU=shea/CN=k8s.org\" \\\n -key k8s.org.key \\\n -out k8s.org.csr\n```\n\n##### 生成一个x509 v3扩展文件\n\n```shell\n cat > v3.ext <<-EOF\nauthorityKeyIdentifier=keyid,issuer\nbasicConstraints=CA:FALSE\nkeyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment\nextendedKeyUsage = serverAuth\nsubjectAltName = @alt_names\n\n[alt_names]\nDNS.1=k8s.org\nDNS.2=k8s\nDNS.3=k8s\nEOF\n```\n\n##### 使用该v3.ext文件为您的Harbor主机生成证书\n\n```shell\nopenssl x509 -req -sha512 -days 3650 \\\n    -extfile v3.ext \\\n    -CA ca.crt -CAkey ca.key -CAcreateserial \\\n    -in k8s.org.csr \\\n    -out k8s.org.crt\n```\n\n\n\nDocker守护程序将.crt文件解释为CA证书，并将.cert文件解释为客户端证书\n\n```shell\nopenssl x509 -inform PEM -in k8s.org.crt -out k8s.org.cert\n```\n\n\n\n#### harbor.yml\n\n代理网址 https://ghproxy.com  下载\n\nhttps://ghproxy.com/https://github.com/goharbor/harbor/releases/download/v2.5.3/harbor-offline-installer-v2.5.3.tgz\n\n```\ncs@debian:~/下载/新建文件夹$ md5sum harbor-offline-installer-v2.5.3.tgz \nd858f6969829e4ce2769a790ecaa0cf7  harbor-offline-installer-v2.5.3.tgz\n\ncs@debian:~/下载/新建文件夹$ tar xzvf harbor-offline-installer-v2.5.3.tgz\ncs@debian:~/下载/新建文件夹$ tree -L 1 ./harbor\n./harbor\n├── common.sh\n├── harbor.v2.5.3.tar.gz\n├── harbor.yml.tmpl\n├── install.sh\n├── LICENSE\n└── prepare\n\n0 directories, 6 files\n```\n\n\n\n```\nsed -n '/hostname/s/reg.mydomain.com/192.168.56.1/'p ./harbor/harbor.yml.tmpl \nhostname: 192.168.56.1\nsed -n '/port:/s/443/8443/'p ./harbor/harbor.yml.tmpl \n  port: 8443\nsed -n '/certificate:/s/\\/your.*path/\\/opt\\/nginx\\/conf\\/conf.d\\/ssl\\/k8s.org.crt/'p ./harbor/harbor.yml.tmpl \n  certificate: /opt/nginx/conf/conf.d/ssl/k8s.org.crt\n```\n\n>hostname\n>\n>https   port ,certificate,private_key\n>\n>external_url\n>\n>harbor_admin_password\n>\n>data_volume\n>\n>用外部数据库,redis时需要配置 external_database,external_redis \n\n\n\n```\nsudo ./install.sh\n```\n\n> 默认的 Harbor 安装不包括 Notary 或 Trivy 等服务\n>\n> ./install.sh --with-notary --with-trivy --with-chartmuseum\n>\n>  --with-notary  数据权限\n>\n> --with-trivy   漏洞扫描\n>\n> --with-chartmuseum helm\n\n\n\n### docker\n\n#### certs.d\n\n```shell\ntree -L 3 /etc/docker/\n/etc/docker/\n├── certs.d\n│   └── k8s.org\n│       ├── ca.crt\n│       ├── k8s.org.cert\n│       └── k8s.org.key\n├── daemon.json\n└── key.json\n\n2 directories, 5 files\n```\n\n> cp yourdomain.com.cert /etc/docker/certs.d/yourdomain.com/\n>cp yourdomain.com.key /etc/docker/certs.d/yourdomain.com/\n>cp ca.crt /etc/docker/certs.d/yourdomain.com/\n\n\n\n#### daemon.json\n\n```json\n{\n    \"data-root\": \"/opt/data/docker\",\n   \"registry-mirrors\" : [\n    \"http://hub-mirror.c.163.com\"\n  ],\n\"insecure-registries\":[\n  \"https://k8s.org\"\n  ],\n  \"debug\" : true,\n  \"experimental\" : true\n}\n\n```\n\n> insecure-registries 私库地址,非域名格式 ip:端口\n\n\n\n#### login\n\n登录密码会保存认证,下次push镜像就不需要输入密码了\n\n```shell\ncs@debian:~$ docker login k8s.org\ncs@debian:~$ cat  ~/.docker/config.json \n{\n\t\"auths\": {\n\t\t\"cs.org\": {\n\t\t\t\"auth\": \"YWRtaW46YWRtaW4=\"\n\t\t},\n\t\t\"k8s.org\": {\n\t\t\t\"auth\": \"YWRtaW46Y3MxMjM0NTY=\"\n\t\t}\n\t},\n\t\"HttpHeaders\": {\n\t\t\"User-Agent\": \"Docker-Client/18.09.3 (linux)\"\n\t}\n}\n```\n\n\n\n\n\n### nginx\n\n/opt/nginx/conf/conf.d/http/harbor.conf\n\n```\nupstream harbors{\n     server 192.168.56.1:8443;\n     #server 192.168.56.2:8443;\n}\n\n\nlog_format  harbor_log  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                     '$status $body_bytes_sent \"$http_referer\" '\n                     '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n\nserver {\n       listen       443 ssl;\n       server_name  k8s.org;\n\n        ssl_certificate      conf.d/ssl/k8s.org.crt;\n        ssl_certificate_key  conf.d/ssl/k8s.org.key;\n\n        ssl_session_cache    shared:SSL:1m;\n        ssl_session_timeout  5m;\n\n        ssl_ciphers  HIGH:!aNULL:!MD5;\n        ssl_prefer_server_ciphers  on;\n\n       access_log  logs/harbors.log  harbor_log;\n       location / {\n            client_max_body_size  1024m;  # 设置接收客户端 body 最大长度为 1024M\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_pass https://harbors;\n        }\n}\n```\n\n> error parsing HTTP 413 response body: ...... <title>413 Request Entity Too Large</title>\n>\n> **client_max_body_size**\n\n\n\n## 推送\n\n域名/目录/镜像名:版本号\n\n```shell\n$ docker images | grep etcd\nk8s.org/k8s/etcd                      3.4.13-0            51401ddb110e        23 months ago       145MB\n\n$ docker push  k8s.org/k8s/etcd:3.4.13-0\n```\n\n\n\n### 项目 \n\n![](/pics/harbor-01.png)\n\n### 镜像\n\n![](/pics/harbor-02.png)\n\n\n\n## 高可用\n\n通过配置数据库(mysql ,redis集群),存储来实现\n\n\n\n## ERROR\n\n### pull Retrying in\n\nhttps://github.com/vmware/harbor/issues/3062\n\n/opt/nginx/conf/nginx.conf\n\n```\nhttp {\n    ......\n      ####添加以下配置\n      proxy_buffers 4 32k;\n      proxy_busy_buffers_size 64k;\n      proxy_temp_file_write_size 64k;\n      #unlimit the proxy temp file size limitaion. Look at issue #3062 (https://github.com/vmware/harbor/issues/3062)\n      proxy_max_temp_file_size 0;\n\n  ....      \n  }\n```\n\n\n\n```\nhttp:\n  relativeurls: true\n```\n\nharbor的helm里需要加上registry.relativeurls=true\n\n参考：https://github.com/docker/distribution/issues/970#issuecomment-284227065\n\n\n\n### ImagePullBackOff\n\n#### 创建一个基于现有凭证的 Secret\n\n```\n$ kubectl create secret generic login --from-file=.dockerconfigjson=/home/cs/.docker/config.json  --type=kubernetes.io/dockerconfigjson \nsecret/login created\n```\n\n\n\n#### 在命令行上提供凭证来创建 Secret\n\n```\nkubectl create secret docker-registry regcred \\\n--docker-server=<你的镜像仓库服务器> \\\n--docker-username=<你的用户名> \\\n--docker-password=<你的密码> \\\n--docker-email=<你的邮箱地址>\n```\n\n>在这里：\n\n>-  是你的私有 Docker 仓库全限定域名（FQDN）。 DockerHub 使用 https://index.docker.io/v1/。\n>-  是你的 Docker 用户名。\n>-  是你的 Docker 密码。\n>-  是你的 Docker 邮箱。\n\n这样你就成功地将集群中的 Docker 凭证设置为名为 regcred 的 Secret\n\n#### 检查 Secret \n\n\n\n```yaml\n$ kubectl get secrets\nNAME                  TYPE                                  DATA   AGE\nlogin                 kubernetes.io/dockerconfigjson        1      85d\n$ kubectl get secret login --output=yaml  \napiVersion: v1\ndata:\n  .dockerconfigjson: ewoJImF1dGhzIjogewoJCSJjcy5vcmciOiB7CgkJCSJhdXRoIjogIllXUnRhVzQ2WVdSdGFXND0iCgkJfSwKCQkiazhzLm9yZyI6IHsKCQkJImF1dGgiOiAiWVdSdGFXNDZZM014TWpNME5UWT0iCgkJfQoJfSwKCSJIdHRwSGVhZGVycyI6IHsKCQkiVXNlci1BZ2VudCI6ICJEb2NrZXItQ2xpZW50LzE4LjA5LjMgKGxpbnV4KSIKCX0KfQ==\nkind: Secret\n....\n```\n\n\n\n```\n$ kubectl get secret login --output=\"jsonpath={.data.\\.dockerconfigjson}\" | base64 --decode\n{\n\t\"auths\": {\n\t\t\"cs.org\": {\n\t\t\t\"auth\": \"YWRtaW46YWRtaW4=\"\n\t\t},\n\t\t\"k8s.org\": {\n\t\t\t\"auth\": \"YWRtaW46Y3MxMjM0NTY=\"\n\t\t}\n\t},\n\t\"HttpHeaders\": {\n\t\t\"User-Agent\": \"Docker-Client/18.09.3 (linux)\"\n\t}\n}\n```\n\n\n\n```\necho \"YWRtaW46Y3MxMjM0NTY=\" | base64 --decode \nadmin:cs12xx\n```\n\n\n\n#### pod\n\n创建一个使用你的 Secret 的 Pod\n\n```\napiVersion: v1\nkind: Pod\nmetadata:\n  name: private-reg\nspec:\n  containers:\n  - name: private-reg-container\n    image: <your-private-image>\n  imagePullSecrets:\n  - name: login\n```\n\n","source":"_posts/linux/k8s/harbor.md","raw":"---\ntitle: harbor镜像私库\npermalink: linux/k8s/harbor/\ntags:\n  - harbor\ncategories:\n  - linux\n  - k8s\ndate: 2022-08-13 13:47:30\n---\n\n## 配置要求\n\n### 硬件\n\n| 资源 | 最低  | 推荐   |\n| ---- | ----- | ------ |\n| CPU  | 2 CPU | 4 CPU  |\n| Mem  | 4 GB  | 8 GB   |\n| Disk | 40 GB | 160 GB |\n\n\n\n### 软件\n\ndocker  v17.06.0-ce+  [Docker 引擎文档](https://docs.docker.com/engine/installation/)\n\ndocker-compose v1.18.0+  [Docker Compose 文档](https://docs.docker.com/compose/install/)\n\nOpenSSL\n\n\n\n### 网络端口\n\nHTTPS  443/4443\n\nHTTP  80\n\n\n\n## 安装\n\n仓库\n\nhttps://github.com/goharbor/harbor/releases\n\n文档\n\nhttps://goharbor.io/docs/2.5.3/install-config/download-installer/\n\n\n\n### harbor\n\n#### 证书ca.key\n\nhttps://goharbor.io/docs/2.5.3/install-config/configure-https/\n\n##### 生成CA私钥\n\n```shell\n openssl genrsa -out ca.key 4096\n```\n\n<!--more-->\n\n##### 生成CA证书\n\n```shell\n openssl req -x509 -new -nodes -sha512 -days 3650 \\\n -subj \"/C=CN/ST=GD/L=SZ/O=cs/OU=shea/CN=k8s.org\" \\\n  -key ca.key \\\n  -out ca.crtopenssl genrsa -out ca.key 4096\n```\n\n#### 服务器证书\n\n##### 生成私钥\n\n```shell\n openssl genrsa -out k8s.org.key 4096\n```\n\n##### 生成证书签名请求（CSR）\n\n```shell\nopenssl  req -sha512 -new \\\n -subj \"/C=CN/ST=GD/L=SZ/O=cs/OU=shea/CN=k8s.org\" \\\n -key k8s.org.key \\\n -out k8s.org.csr\n```\n\n##### 生成一个x509 v3扩展文件\n\n```shell\n cat > v3.ext <<-EOF\nauthorityKeyIdentifier=keyid,issuer\nbasicConstraints=CA:FALSE\nkeyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment\nextendedKeyUsage = serverAuth\nsubjectAltName = @alt_names\n\n[alt_names]\nDNS.1=k8s.org\nDNS.2=k8s\nDNS.3=k8s\nEOF\n```\n\n##### 使用该v3.ext文件为您的Harbor主机生成证书\n\n```shell\nopenssl x509 -req -sha512 -days 3650 \\\n    -extfile v3.ext \\\n    -CA ca.crt -CAkey ca.key -CAcreateserial \\\n    -in k8s.org.csr \\\n    -out k8s.org.crt\n```\n\n\n\nDocker守护程序将.crt文件解释为CA证书，并将.cert文件解释为客户端证书\n\n```shell\nopenssl x509 -inform PEM -in k8s.org.crt -out k8s.org.cert\n```\n\n\n\n#### harbor.yml\n\n代理网址 https://ghproxy.com  下载\n\nhttps://ghproxy.com/https://github.com/goharbor/harbor/releases/download/v2.5.3/harbor-offline-installer-v2.5.3.tgz\n\n```\ncs@debian:~/下载/新建文件夹$ md5sum harbor-offline-installer-v2.5.3.tgz \nd858f6969829e4ce2769a790ecaa0cf7  harbor-offline-installer-v2.5.3.tgz\n\ncs@debian:~/下载/新建文件夹$ tar xzvf harbor-offline-installer-v2.5.3.tgz\ncs@debian:~/下载/新建文件夹$ tree -L 1 ./harbor\n./harbor\n├── common.sh\n├── harbor.v2.5.3.tar.gz\n├── harbor.yml.tmpl\n├── install.sh\n├── LICENSE\n└── prepare\n\n0 directories, 6 files\n```\n\n\n\n```\nsed -n '/hostname/s/reg.mydomain.com/192.168.56.1/'p ./harbor/harbor.yml.tmpl \nhostname: 192.168.56.1\nsed -n '/port:/s/443/8443/'p ./harbor/harbor.yml.tmpl \n  port: 8443\nsed -n '/certificate:/s/\\/your.*path/\\/opt\\/nginx\\/conf\\/conf.d\\/ssl\\/k8s.org.crt/'p ./harbor/harbor.yml.tmpl \n  certificate: /opt/nginx/conf/conf.d/ssl/k8s.org.crt\n```\n\n>hostname\n>\n>https   port ,certificate,private_key\n>\n>external_url\n>\n>harbor_admin_password\n>\n>data_volume\n>\n>用外部数据库,redis时需要配置 external_database,external_redis \n\n\n\n```\nsudo ./install.sh\n```\n\n> 默认的 Harbor 安装不包括 Notary 或 Trivy 等服务\n>\n> ./install.sh --with-notary --with-trivy --with-chartmuseum\n>\n>  --with-notary  数据权限\n>\n> --with-trivy   漏洞扫描\n>\n> --with-chartmuseum helm\n\n\n\n### docker\n\n#### certs.d\n\n```shell\ntree -L 3 /etc/docker/\n/etc/docker/\n├── certs.d\n│   └── k8s.org\n│       ├── ca.crt\n│       ├── k8s.org.cert\n│       └── k8s.org.key\n├── daemon.json\n└── key.json\n\n2 directories, 5 files\n```\n\n> cp yourdomain.com.cert /etc/docker/certs.d/yourdomain.com/\n>cp yourdomain.com.key /etc/docker/certs.d/yourdomain.com/\n>cp ca.crt /etc/docker/certs.d/yourdomain.com/\n\n\n\n#### daemon.json\n\n```json\n{\n    \"data-root\": \"/opt/data/docker\",\n   \"registry-mirrors\" : [\n    \"http://hub-mirror.c.163.com\"\n  ],\n\"insecure-registries\":[\n  \"https://k8s.org\"\n  ],\n  \"debug\" : true,\n  \"experimental\" : true\n}\n\n```\n\n> insecure-registries 私库地址,非域名格式 ip:端口\n\n\n\n#### login\n\n登录密码会保存认证,下次push镜像就不需要输入密码了\n\n```shell\ncs@debian:~$ docker login k8s.org\ncs@debian:~$ cat  ~/.docker/config.json \n{\n\t\"auths\": {\n\t\t\"cs.org\": {\n\t\t\t\"auth\": \"YWRtaW46YWRtaW4=\"\n\t\t},\n\t\t\"k8s.org\": {\n\t\t\t\"auth\": \"YWRtaW46Y3MxMjM0NTY=\"\n\t\t}\n\t},\n\t\"HttpHeaders\": {\n\t\t\"User-Agent\": \"Docker-Client/18.09.3 (linux)\"\n\t}\n}\n```\n\n\n\n\n\n### nginx\n\n/opt/nginx/conf/conf.d/http/harbor.conf\n\n```\nupstream harbors{\n     server 192.168.56.1:8443;\n     #server 192.168.56.2:8443;\n}\n\n\nlog_format  harbor_log  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                     '$status $body_bytes_sent \"$http_referer\" '\n                     '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n\nserver {\n       listen       443 ssl;\n       server_name  k8s.org;\n\n        ssl_certificate      conf.d/ssl/k8s.org.crt;\n        ssl_certificate_key  conf.d/ssl/k8s.org.key;\n\n        ssl_session_cache    shared:SSL:1m;\n        ssl_session_timeout  5m;\n\n        ssl_ciphers  HIGH:!aNULL:!MD5;\n        ssl_prefer_server_ciphers  on;\n\n       access_log  logs/harbors.log  harbor_log;\n       location / {\n            client_max_body_size  1024m;  # 设置接收客户端 body 最大长度为 1024M\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_pass https://harbors;\n        }\n}\n```\n\n> error parsing HTTP 413 response body: ...... <title>413 Request Entity Too Large</title>\n>\n> **client_max_body_size**\n\n\n\n## 推送\n\n域名/目录/镜像名:版本号\n\n```shell\n$ docker images | grep etcd\nk8s.org/k8s/etcd                      3.4.13-0            51401ddb110e        23 months ago       145MB\n\n$ docker push  k8s.org/k8s/etcd:3.4.13-0\n```\n\n\n\n### 项目 \n\n![](/pics/harbor-01.png)\n\n### 镜像\n\n![](/pics/harbor-02.png)\n\n\n\n## 高可用\n\n通过配置数据库(mysql ,redis集群),存储来实现\n\n\n\n## ERROR\n\n### pull Retrying in\n\nhttps://github.com/vmware/harbor/issues/3062\n\n/opt/nginx/conf/nginx.conf\n\n```\nhttp {\n    ......\n      ####添加以下配置\n      proxy_buffers 4 32k;\n      proxy_busy_buffers_size 64k;\n      proxy_temp_file_write_size 64k;\n      #unlimit the proxy temp file size limitaion. Look at issue #3062 (https://github.com/vmware/harbor/issues/3062)\n      proxy_max_temp_file_size 0;\n\n  ....      \n  }\n```\n\n\n\n```\nhttp:\n  relativeurls: true\n```\n\nharbor的helm里需要加上registry.relativeurls=true\n\n参考：https://github.com/docker/distribution/issues/970#issuecomment-284227065\n\n\n\n### ImagePullBackOff\n\n#### 创建一个基于现有凭证的 Secret\n\n```\n$ kubectl create secret generic login --from-file=.dockerconfigjson=/home/cs/.docker/config.json  --type=kubernetes.io/dockerconfigjson \nsecret/login created\n```\n\n\n\n#### 在命令行上提供凭证来创建 Secret\n\n```\nkubectl create secret docker-registry regcred \\\n--docker-server=<你的镜像仓库服务器> \\\n--docker-username=<你的用户名> \\\n--docker-password=<你的密码> \\\n--docker-email=<你的邮箱地址>\n```\n\n>在这里：\n\n>-  是你的私有 Docker 仓库全限定域名（FQDN）。 DockerHub 使用 https://index.docker.io/v1/。\n>-  是你的 Docker 用户名。\n>-  是你的 Docker 密码。\n>-  是你的 Docker 邮箱。\n\n这样你就成功地将集群中的 Docker 凭证设置为名为 regcred 的 Secret\n\n#### 检查 Secret \n\n\n\n```yaml\n$ kubectl get secrets\nNAME                  TYPE                                  DATA   AGE\nlogin                 kubernetes.io/dockerconfigjson        1      85d\n$ kubectl get secret login --output=yaml  \napiVersion: v1\ndata:\n  .dockerconfigjson: ewoJImF1dGhzIjogewoJCSJjcy5vcmciOiB7CgkJCSJhdXRoIjogIllXUnRhVzQ2WVdSdGFXND0iCgkJfSwKCQkiazhzLm9yZyI6IHsKCQkJImF1dGgiOiAiWVdSdGFXNDZZM014TWpNME5UWT0iCgkJfQoJfSwKCSJIdHRwSGVhZGVycyI6IHsKCQkiVXNlci1BZ2VudCI6ICJEb2NrZXItQ2xpZW50LzE4LjA5LjMgKGxpbnV4KSIKCX0KfQ==\nkind: Secret\n....\n```\n\n\n\n```\n$ kubectl get secret login --output=\"jsonpath={.data.\\.dockerconfigjson}\" | base64 --decode\n{\n\t\"auths\": {\n\t\t\"cs.org\": {\n\t\t\t\"auth\": \"YWRtaW46YWRtaW4=\"\n\t\t},\n\t\t\"k8s.org\": {\n\t\t\t\"auth\": \"YWRtaW46Y3MxMjM0NTY=\"\n\t\t}\n\t},\n\t\"HttpHeaders\": {\n\t\t\"User-Agent\": \"Docker-Client/18.09.3 (linux)\"\n\t}\n}\n```\n\n\n\n```\necho \"YWRtaW46Y3MxMjM0NTY=\" | base64 --decode \nadmin:cs12xx\n```\n\n\n\n#### pod\n\n创建一个使用你的 Secret 的 Pod\n\n```\napiVersion: v1\nkind: Pod\nmetadata:\n  name: private-reg\nspec:\n  containers:\n  - name: private-reg-container\n    image: <your-private-image>\n  imagePullSecrets:\n  - name: login\n```\n\n","slug":"linux/k8s/harbor","published":1,"updated":"2022-08-28T09:10:00.936Z","__permalink":"linux/k8s/harbor/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtt90020gwi5end53qyz","content":"<h2 id=\"配置要求\"><a href=\"#配置要求\" class=\"headerlink\" title=\"配置要求\"></a>配置要求</h2><h3 id=\"硬件\"><a href=\"#硬件\" class=\"headerlink\" title=\"硬件\"></a>硬件</h3><table>\n<thead>\n<tr>\n<th>资源</th>\n<th>最低</th>\n<th>推荐</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>CPU</td>\n<td>2 CPU</td>\n<td>4 CPU</td>\n</tr>\n<tr>\n<td>Mem</td>\n<td>4 GB</td>\n<td>8 GB</td>\n</tr>\n<tr>\n<td>Disk</td>\n<td>40 GB</td>\n<td>160 GB</td>\n</tr>\n</tbody></table>\n<h3 id=\"软件\"><a href=\"#软件\" class=\"headerlink\" title=\"软件\"></a>软件</h3><p>docker  v17.06.0-ce+  <a href=\"https://docs.docker.com/engine/installation/\">Docker 引擎文档</a></p>\n<p>docker-compose v1.18.0+  <a href=\"https://docs.docker.com/compose/install/\">Docker Compose 文档</a></p>\n<p>OpenSSL</p>\n<h3 id=\"网络端口\"><a href=\"#网络端口\" class=\"headerlink\" title=\"网络端口\"></a>网络端口</h3><p>HTTPS  443&#x2F;4443</p>\n<p>HTTP  80</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p>仓库</p>\n<p><a href=\"https://github.com/goharbor/harbor/releases\">https://github.com/goharbor/harbor/releases</a></p>\n<p>文档</p>\n<p><a href=\"https://goharbor.io/docs/2.5.3/install-config/download-installer/\">https://goharbor.io/docs/2.5.3/install-config/download-installer/</a></p>\n<h3 id=\"harbor\"><a href=\"#harbor\" class=\"headerlink\" title=\"harbor\"></a>harbor</h3><h4 id=\"证书ca-key\"><a href=\"#证书ca-key\" class=\"headerlink\" title=\"证书ca.key\"></a>证书ca.key</h4><p><a href=\"https://goharbor.io/docs/2.5.3/install-config/configure-https/\">https://goharbor.io/docs/2.5.3/install-config/configure-https/</a></p>\n<h5 id=\"生成CA私钥\"><a href=\"#生成CA私钥\" class=\"headerlink\" title=\"生成CA私钥\"></a>生成CA私钥</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl genrsa -out ca.key 4096</span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n<h5 id=\"生成CA证书\"><a href=\"#生成CA证书\" class=\"headerlink\" title=\"生成CA证书\"></a>生成CA证书</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl req -x509 -new -nodes -sha512 -days 3650 \\</span><br><span class=\"line\">-subj &quot;/C=CN/ST=GD/L=SZ/O=cs/OU=shea/CN=k8s.org&quot; \\</span><br><span class=\"line\"> -key ca.key \\</span><br><span class=\"line\"> -out ca.crtopenssl genrsa -out ca.key 4096</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"服务器证书\"><a href=\"#服务器证书\" class=\"headerlink\" title=\"服务器证书\"></a>服务器证书</h4><h5 id=\"生成私钥\"><a href=\"#生成私钥\" class=\"headerlink\" title=\"生成私钥\"></a>生成私钥</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl genrsa -out k8s.org.key 4096</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"生成证书签名请求（CSR）\"><a href=\"#生成证书签名请求（CSR）\" class=\"headerlink\" title=\"生成证书签名请求（CSR）\"></a>生成证书签名请求（CSR）</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl  req -sha512 -new \\</span><br><span class=\"line\"> -subj &quot;/C=CN/ST=GD/L=SZ/O=cs/OU=shea/CN=k8s.org&quot; \\</span><br><span class=\"line\"> -key k8s.org.key \\</span><br><span class=\"line\"> -out k8s.org.csr</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"生成一个x509-v3扩展文件\"><a href=\"#生成一个x509-v3扩展文件\" class=\"headerlink\" title=\"生成一个x509 v3扩展文件\"></a>生成一个x509 v3扩展文件</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> cat &gt; v3.ext &lt;&lt;-EOF</span><br><span class=\"line\">authorityKeyIdentifier=keyid,issuer</span><br><span class=\"line\">basicConstraints=CA:FALSE</span><br><span class=\"line\">keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment</span><br><span class=\"line\">extendedKeyUsage = serverAuth</span><br><span class=\"line\">subjectAltName = @alt_names</span><br><span class=\"line\"></span><br><span class=\"line\">[alt_names]</span><br><span class=\"line\">DNS.1=k8s.org</span><br><span class=\"line\">DNS.2=k8s</span><br><span class=\"line\">DNS.3=k8s</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"使用该v3-ext文件为您的Harbor主机生成证书\"><a href=\"#使用该v3-ext文件为您的Harbor主机生成证书\" class=\"headerlink\" title=\"使用该v3.ext文件为您的Harbor主机生成证书\"></a>使用该v3.ext文件为您的Harbor主机生成证书</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl x509 -req -sha512 -days 3650 \\</span><br><span class=\"line\">    -extfile v3.ext \\</span><br><span class=\"line\">    -CA ca.crt -CAkey ca.key -CAcreateserial \\</span><br><span class=\"line\">    -in k8s.org.csr \\</span><br><span class=\"line\">    -out k8s.org.crt</span><br></pre></td></tr></table></figure>\n\n\n\n<p>Docker守护程序将.crt文件解释为CA证书，并将.cert文件解释为客户端证书</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl x509 -inform PEM -in k8s.org.crt -out k8s.org.cert</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"harbor-yml\"><a href=\"#harbor-yml\" class=\"headerlink\" title=\"harbor.yml\"></a>harbor.yml</h4><p>代理网址 <a href=\"https://ghproxy.com/\">https://ghproxy.com</a>  下载</p>\n<p><a href=\"https://ghproxy.com/https://github.com/goharbor/harbor/releases/download/v2.5.3/harbor-offline-installer-v2.5.3.tgz\">https://ghproxy.com/https://github.com/goharbor/harbor/releases/download/v2.5.3/harbor-offline-installer-v2.5.3.tgz</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/下载/新建文件夹$ md5sum harbor-offline-installer-v2.5.3.tgz </span><br><span class=\"line\">d858f6969829e4ce2769a790ecaa0cf7  harbor-offline-installer-v2.5.3.tgz</span><br><span class=\"line\"></span><br><span class=\"line\">cs@debian:~/下载/新建文件夹$ tar xzvf harbor-offline-installer-v2.5.3.tgz</span><br><span class=\"line\">cs@debian:~/下载/新建文件夹$ tree -L 1 ./harbor</span><br><span class=\"line\">./harbor</span><br><span class=\"line\">├── common.sh</span><br><span class=\"line\">├── harbor.v2.5.3.tar.gz</span><br><span class=\"line\">├── harbor.yml.tmpl</span><br><span class=\"line\">├── install.sh</span><br><span class=\"line\">├── LICENSE</span><br><span class=\"line\">└── prepare</span><br><span class=\"line\"></span><br><span class=\"line\">0 directories, 6 files</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -n &#x27;/hostname/s/reg.mydomain.com/192.168.56.1/&#x27;p ./harbor/harbor.yml.tmpl </span><br><span class=\"line\">hostname: 192.168.56.1</span><br><span class=\"line\">sed -n &#x27;/port:/s/443/8443/&#x27;p ./harbor/harbor.yml.tmpl </span><br><span class=\"line\">  port: 8443</span><br><span class=\"line\">sed -n &#x27;/certificate:/s/\\/your.*path/\\/opt\\/nginx\\/conf\\/conf.d\\/ssl\\/k8s.org.crt/&#x27;p ./harbor/harbor.yml.tmpl </span><br><span class=\"line\">  certificate: /opt/nginx/conf/conf.d/ssl/k8s.org.crt</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>hostname</p>\n<p>https   port ,certificate,private_key</p>\n<p>external_url</p>\n<p>harbor_admin_password</p>\n<p>data_volume</p>\n<p>用外部数据库,redis时需要配置 external_database,external_redis </p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ./install.sh</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>默认的 Harbor 安装不包括 Notary 或 Trivy 等服务</p>\n<p>.&#x2F;install.sh –with-notary –with-trivy –with-chartmuseum</p>\n<p> –with-notary  数据权限</p>\n<p>–with-trivy   漏洞扫描</p>\n<p>–with-chartmuseum helm</p>\n</blockquote>\n<h3 id=\"docker\"><a href=\"#docker\" class=\"headerlink\" title=\"docker\"></a>docker</h3><h4 id=\"certs-d\"><a href=\"#certs-d\" class=\"headerlink\" title=\"certs.d\"></a>certs.d</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tree -L 3 /etc/docker/</span><br><span class=\"line\">/etc/docker/</span><br><span class=\"line\">├── certs.d</span><br><span class=\"line\">│   └── k8s.org</span><br><span class=\"line\">│       ├── ca.crt</span><br><span class=\"line\">│       ├── k8s.org.cert</span><br><span class=\"line\">│       └── k8s.org.key</span><br><span class=\"line\">├── daemon.json</span><br><span class=\"line\">└── key.json</span><br><span class=\"line\"></span><br><span class=\"line\">2 directories, 5 files</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>cp yourdomain.com.cert &#x2F;etc&#x2F;docker&#x2F;certs.d&#x2F;yourdomain.com&#x2F;<br>cp yourdomain.com.key &#x2F;etc&#x2F;docker&#x2F;certs.d&#x2F;yourdomain.com&#x2F;<br>cp ca.crt &#x2F;etc&#x2F;docker&#x2F;certs.d&#x2F;yourdomain.com&#x2F;</p>\n</blockquote>\n<h4 id=\"daemon-json\"><a href=\"#daemon-json\" class=\"headerlink\" title=\"daemon.json\"></a>daemon.json</h4><figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;data-root&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;/opt/data/docker&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">   <span class=\"attr\">&quot;registry-mirrors&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"string\">&quot;http://hub-mirror.c.163.com&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"attr\">&quot;insecure-registries&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span></span><br><span class=\"line\">  <span class=\"string\">&quot;https://k8s.org&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;debug&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;experimental&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>insecure-registries 私库地址,非域名格式 ip:端口</p>\n</blockquote>\n<h4 id=\"login\"><a href=\"#login\" class=\"headerlink\" title=\"login\"></a>login</h4><p>登录密码会保存认证,下次push镜像就不需要输入密码了</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ docker login k8s.org</span><br><span class=\"line\">cs@debian:~$ cat  ~/.docker/config.json </span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t&quot;auths&quot;: &#123;</span><br><span class=\"line\">\t\t&quot;cs.org&quot;: &#123;</span><br><span class=\"line\">\t\t\t&quot;auth&quot;: &quot;YWRtaW46YWRtaW4=&quot;</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t&quot;k8s.org&quot;: &#123;</span><br><span class=\"line\">\t\t\t&quot;auth&quot;: &quot;YWRtaW46Y3MxMjM0NTY=&quot;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t&quot;HttpHeaders&quot;: &#123;</span><br><span class=\"line\">\t\t&quot;User-Agent&quot;: &quot;Docker-Client/18.09.3 (linux)&quot;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"nginx\"><a href=\"#nginx\" class=\"headerlink\" title=\"nginx\"></a>nginx</h3><p>&#x2F;opt&#x2F;nginx&#x2F;conf&#x2F;conf.d&#x2F;http&#x2F;harbor.conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream harbors&#123;</span><br><span class=\"line\">     server 192.168.56.1:8443;</span><br><span class=\"line\">     #server 192.168.56.2:8443;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">log_format  harbor_log  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class=\"line\">                     &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class=\"line\">                     &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">       listen       443 ssl;</span><br><span class=\"line\">       server_name  k8s.org;</span><br><span class=\"line\"></span><br><span class=\"line\">        ssl_certificate      conf.d/ssl/k8s.org.crt;</span><br><span class=\"line\">        ssl_certificate_key  conf.d/ssl/k8s.org.key;</span><br><span class=\"line\"></span><br><span class=\"line\">        ssl_session_cache    shared:SSL:1m;</span><br><span class=\"line\">        ssl_session_timeout  5m;</span><br><span class=\"line\"></span><br><span class=\"line\">        ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class=\"line\">        ssl_prefer_server_ciphers  on;</span><br><span class=\"line\"></span><br><span class=\"line\">       access_log  logs/harbors.log  harbor_log;</span><br><span class=\"line\">       location / &#123;</span><br><span class=\"line\">            client_max_body_size  1024m;  # 设置接收客户端 body 最大长度为 1024M</span><br><span class=\"line\">            proxy_set_header Host $host;</span><br><span class=\"line\">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">            proxy_pass https://harbors;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>error parsing HTTP 413 response body: …… <title>413 Request Entity Too Large</title></p>\n<p><strong>client_max_body_size</strong></p>\n</blockquote>\n<h2 id=\"推送\"><a href=\"#推送\" class=\"headerlink\" title=\"推送\"></a>推送</h2><p>域名&#x2F;目录&#x2F;镜像名:版本号</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">docker images | grep etcd</span></span><br><span class=\"line\">k8s.org/k8s/etcd                      3.4.13-0            51401ddb110e        23 months ago       145MB</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">docker push  k8s.org/k8s/etcd:3.4.13-0</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"项目\"><a href=\"#项目\" class=\"headerlink\" title=\"项目\"></a>项目</h3><p><img src=\"/pics/harbor-01.png\"></p>\n<h3 id=\"镜像\"><a href=\"#镜像\" class=\"headerlink\" title=\"镜像\"></a>镜像</h3><p><img src=\"/pics/harbor-02.png\"></p>\n<h2 id=\"高可用\"><a href=\"#高可用\" class=\"headerlink\" title=\"高可用\"></a>高可用</h2><p>通过配置数据库(mysql ,redis集群),存储来实现</p>\n<h2 id=\"ERROR\"><a href=\"#ERROR\" class=\"headerlink\" title=\"ERROR\"></a>ERROR</h2><h3 id=\"pull-Retrying-in\"><a href=\"#pull-Retrying-in\" class=\"headerlink\" title=\"pull Retrying in\"></a>pull Retrying in</h3><p><a href=\"https://github.com/vmware/harbor/issues/3062\">https://github.com/vmware/harbor/issues/3062</a></p>\n<p>&#x2F;opt&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http &#123;</span><br><span class=\"line\">    ......</span><br><span class=\"line\">      ####添加以下配置</span><br><span class=\"line\">      proxy_buffers 4 32k;</span><br><span class=\"line\">      proxy_busy_buffers_size 64k;</span><br><span class=\"line\">      proxy_temp_file_write_size 64k;</span><br><span class=\"line\">      #unlimit the proxy temp file size limitaion. Look at issue #3062 (https://github.com/vmware/harbor/issues/3062)</span><br><span class=\"line\">      proxy_max_temp_file_size 0;</span><br><span class=\"line\"></span><br><span class=\"line\">  ....      </span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http:</span><br><span class=\"line\">  relativeurls: true</span><br></pre></td></tr></table></figure>\n\n<p>harbor的helm里需要加上registry.relativeurls&#x3D;true</p>\n<p>参考：<a href=\"https://github.com/docker/distribution/issues/970#issuecomment-284227065\">https://github.com/docker/distribution/issues/970#issuecomment-284227065</a></p>\n<h3 id=\"ImagePullBackOff\"><a href=\"#ImagePullBackOff\" class=\"headerlink\" title=\"ImagePullBackOff\"></a>ImagePullBackOff</h3><h4 id=\"创建一个基于现有凭证的-Secret\"><a href=\"#创建一个基于现有凭证的-Secret\" class=\"headerlink\" title=\"创建一个基于现有凭证的 Secret\"></a>创建一个基于现有凭证的 Secret</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl create secret generic login --from-file=.dockerconfigjson=/home/cs/.docker/config.json  --type=kubernetes.io/dockerconfigjson </span><br><span class=\"line\">secret/login created</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"在命令行上提供凭证来创建-Secret\"><a href=\"#在命令行上提供凭证来创建-Secret\" class=\"headerlink\" title=\"在命令行上提供凭证来创建 Secret\"></a>在命令行上提供凭证来创建 Secret</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create secret docker-registry regcred \\</span><br><span class=\"line\">--docker-server=&lt;你的镜像仓库服务器&gt; \\</span><br><span class=\"line\">--docker-username=&lt;你的用户名&gt; \\</span><br><span class=\"line\">--docker-password=&lt;你的密码&gt; \\</span><br><span class=\"line\">--docker-email=&lt;你的邮箱地址&gt;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>在这里：</p>\n</blockquote>\n<blockquote>\n<ul>\n<li>是你的私有 Docker 仓库全限定域名（FQDN）。 DockerHub 使用 <a href=\"https://index.docker.io/v1/%E3%80%82\">https://index.docker.io/v1/。</a></li>\n<li>是你的 Docker 用户名。</li>\n<li>是你的 Docker 密码。</li>\n<li>是你的 Docker 邮箱。</li>\n</ul>\n</blockquote>\n<p>这样你就成功地将集群中的 Docker 凭证设置为名为 regcred 的 Secret</p>\n<h4 id=\"检查-Secret\"><a href=\"#检查-Secret\" class=\"headerlink\" title=\"检查 Secret\"></a>检查 Secret</h4><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">$</span> <span class=\"string\">kubectl</span> <span class=\"string\">get</span> <span class=\"string\">secrets</span></span><br><span class=\"line\"><span class=\"string\">NAME</span>                  <span class=\"string\">TYPE</span>                                  <span class=\"string\">DATA</span>   <span class=\"string\">AGE</span></span><br><span class=\"line\"><span class=\"string\">login</span>                 <span class=\"string\">kubernetes.io/dockerconfigjson</span>        <span class=\"number\">1</span>      <span class=\"string\">85d</span></span><br><span class=\"line\"><span class=\"string\">$</span> <span class=\"string\">kubectl</span> <span class=\"string\">get</span> <span class=\"string\">secret</span> <span class=\"string\">login</span> <span class=\"string\">--output=yaml</span>  </span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\">  <span class=\"string\">.dockerconfigjson:</span> <span class=\"string\">ewoJImF1dGhzIjogewoJCSJjcy5vcmciOiB7CgkJCSJhdXRoIjogIllXUnRhVzQ2WVdSdGFXND0iCgkJfSwKCQkiazhzLm9yZyI6IHsKCQkJImF1dGgiOiAiWVdSdGFXNDZZM014TWpNME5UWT0iCgkJfQoJfSwKCSJIdHRwSGVhZGVycyI6IHsKCQkiVXNlci1BZ2VudCI6ICJEb2NrZXItQ2xpZW50LzE4LjA5LjMgKGxpbnV4KSIKCX0KfQ==</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Secret</span></span><br><span class=\"line\"><span class=\"string\">....</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl get secret login --output=&quot;jsonpath=&#123;.data.\\.dockerconfigjson&#125;&quot; | base64 --decode</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t&quot;auths&quot;: &#123;</span><br><span class=\"line\">\t\t&quot;cs.org&quot;: &#123;</span><br><span class=\"line\">\t\t\t&quot;auth&quot;: &quot;YWRtaW46YWRtaW4=&quot;</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t&quot;k8s.org&quot;: &#123;</span><br><span class=\"line\">\t\t\t&quot;auth&quot;: &quot;YWRtaW46Y3MxMjM0NTY=&quot;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t&quot;HttpHeaders&quot;: &#123;</span><br><span class=\"line\">\t\t&quot;User-Agent&quot;: &quot;Docker-Client/18.09.3 (linux)&quot;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;YWRtaW46Y3MxMjM0NTY=&quot; | base64 --decode </span><br><span class=\"line\">admin:cs12xx</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"pod\"><a href=\"#pod\" class=\"headerlink\" title=\"pod\"></a>pod</h4><p>创建一个使用你的 Secret 的 Pod</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">kind: Pod</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: private-reg</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  containers:</span><br><span class=\"line\">  - name: private-reg-container</span><br><span class=\"line\">    image: &lt;your-private-image&gt;</span><br><span class=\"line\">  imagePullSecrets:</span><br><span class=\"line\">  - name: login</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"配置要求\"><a href=\"#配置要求\" class=\"headerlink\" title=\"配置要求\"></a>配置要求</h2><h3 id=\"硬件\"><a href=\"#硬件\" class=\"headerlink\" title=\"硬件\"></a>硬件</h3><table>\n<thead>\n<tr>\n<th>资源</th>\n<th>最低</th>\n<th>推荐</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>CPU</td>\n<td>2 CPU</td>\n<td>4 CPU</td>\n</tr>\n<tr>\n<td>Mem</td>\n<td>4 GB</td>\n<td>8 GB</td>\n</tr>\n<tr>\n<td>Disk</td>\n<td>40 GB</td>\n<td>160 GB</td>\n</tr>\n</tbody></table>\n<h3 id=\"软件\"><a href=\"#软件\" class=\"headerlink\" title=\"软件\"></a>软件</h3><p>docker  v17.06.0-ce+  <a href=\"https://docs.docker.com/engine/installation/\">Docker 引擎文档</a></p>\n<p>docker-compose v1.18.0+  <a href=\"https://docs.docker.com/compose/install/\">Docker Compose 文档</a></p>\n<p>OpenSSL</p>\n<h3 id=\"网络端口\"><a href=\"#网络端口\" class=\"headerlink\" title=\"网络端口\"></a>网络端口</h3><p>HTTPS  443&#x2F;4443</p>\n<p>HTTP  80</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p>仓库</p>\n<p><a href=\"https://github.com/goharbor/harbor/releases\">https://github.com/goharbor/harbor/releases</a></p>\n<p>文档</p>\n<p><a href=\"https://goharbor.io/docs/2.5.3/install-config/download-installer/\">https://goharbor.io/docs/2.5.3/install-config/download-installer/</a></p>\n<h3 id=\"harbor\"><a href=\"#harbor\" class=\"headerlink\" title=\"harbor\"></a>harbor</h3><h4 id=\"证书ca-key\"><a href=\"#证书ca-key\" class=\"headerlink\" title=\"证书ca.key\"></a>证书ca.key</h4><p><a href=\"https://goharbor.io/docs/2.5.3/install-config/configure-https/\">https://goharbor.io/docs/2.5.3/install-config/configure-https/</a></p>\n<h5 id=\"生成CA私钥\"><a href=\"#生成CA私钥\" class=\"headerlink\" title=\"生成CA私钥\"></a>生成CA私钥</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl genrsa -out ca.key 4096</span><br></pre></td></tr></table></figure>","more":"<h5 id=\"生成CA证书\"><a href=\"#生成CA证书\" class=\"headerlink\" title=\"生成CA证书\"></a>生成CA证书</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl req -x509 -new -nodes -sha512 -days 3650 \\</span><br><span class=\"line\">-subj &quot;/C=CN/ST=GD/L=SZ/O=cs/OU=shea/CN=k8s.org&quot; \\</span><br><span class=\"line\"> -key ca.key \\</span><br><span class=\"line\"> -out ca.crtopenssl genrsa -out ca.key 4096</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"服务器证书\"><a href=\"#服务器证书\" class=\"headerlink\" title=\"服务器证书\"></a>服务器证书</h4><h5 id=\"生成私钥\"><a href=\"#生成私钥\" class=\"headerlink\" title=\"生成私钥\"></a>生成私钥</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl genrsa -out k8s.org.key 4096</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"生成证书签名请求（CSR）\"><a href=\"#生成证书签名请求（CSR）\" class=\"headerlink\" title=\"生成证书签名请求（CSR）\"></a>生成证书签名请求（CSR）</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl  req -sha512 -new \\</span><br><span class=\"line\"> -subj &quot;/C=CN/ST=GD/L=SZ/O=cs/OU=shea/CN=k8s.org&quot; \\</span><br><span class=\"line\"> -key k8s.org.key \\</span><br><span class=\"line\"> -out k8s.org.csr</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"生成一个x509-v3扩展文件\"><a href=\"#生成一个x509-v3扩展文件\" class=\"headerlink\" title=\"生成一个x509 v3扩展文件\"></a>生成一个x509 v3扩展文件</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> cat &gt; v3.ext &lt;&lt;-EOF</span><br><span class=\"line\">authorityKeyIdentifier=keyid,issuer</span><br><span class=\"line\">basicConstraints=CA:FALSE</span><br><span class=\"line\">keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment</span><br><span class=\"line\">extendedKeyUsage = serverAuth</span><br><span class=\"line\">subjectAltName = @alt_names</span><br><span class=\"line\"></span><br><span class=\"line\">[alt_names]</span><br><span class=\"line\">DNS.1=k8s.org</span><br><span class=\"line\">DNS.2=k8s</span><br><span class=\"line\">DNS.3=k8s</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"使用该v3-ext文件为您的Harbor主机生成证书\"><a href=\"#使用该v3-ext文件为您的Harbor主机生成证书\" class=\"headerlink\" title=\"使用该v3.ext文件为您的Harbor主机生成证书\"></a>使用该v3.ext文件为您的Harbor主机生成证书</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl x509 -req -sha512 -days 3650 \\</span><br><span class=\"line\">    -extfile v3.ext \\</span><br><span class=\"line\">    -CA ca.crt -CAkey ca.key -CAcreateserial \\</span><br><span class=\"line\">    -in k8s.org.csr \\</span><br><span class=\"line\">    -out k8s.org.crt</span><br></pre></td></tr></table></figure>\n\n\n\n<p>Docker守护程序将.crt文件解释为CA证书，并将.cert文件解释为客户端证书</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl x509 -inform PEM -in k8s.org.crt -out k8s.org.cert</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"harbor-yml\"><a href=\"#harbor-yml\" class=\"headerlink\" title=\"harbor.yml\"></a>harbor.yml</h4><p>代理网址 <a href=\"https://ghproxy.com/\">https://ghproxy.com</a>  下载</p>\n<p><a href=\"https://ghproxy.com/https://github.com/goharbor/harbor/releases/download/v2.5.3/harbor-offline-installer-v2.5.3.tgz\">https://ghproxy.com/https://github.com/goharbor/harbor/releases/download/v2.5.3/harbor-offline-installer-v2.5.3.tgz</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/下载/新建文件夹$ md5sum harbor-offline-installer-v2.5.3.tgz </span><br><span class=\"line\">d858f6969829e4ce2769a790ecaa0cf7  harbor-offline-installer-v2.5.3.tgz</span><br><span class=\"line\"></span><br><span class=\"line\">cs@debian:~/下载/新建文件夹$ tar xzvf harbor-offline-installer-v2.5.3.tgz</span><br><span class=\"line\">cs@debian:~/下载/新建文件夹$ tree -L 1 ./harbor</span><br><span class=\"line\">./harbor</span><br><span class=\"line\">├── common.sh</span><br><span class=\"line\">├── harbor.v2.5.3.tar.gz</span><br><span class=\"line\">├── harbor.yml.tmpl</span><br><span class=\"line\">├── install.sh</span><br><span class=\"line\">├── LICENSE</span><br><span class=\"line\">└── prepare</span><br><span class=\"line\"></span><br><span class=\"line\">0 directories, 6 files</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -n &#x27;/hostname/s/reg.mydomain.com/192.168.56.1/&#x27;p ./harbor/harbor.yml.tmpl </span><br><span class=\"line\">hostname: 192.168.56.1</span><br><span class=\"line\">sed -n &#x27;/port:/s/443/8443/&#x27;p ./harbor/harbor.yml.tmpl </span><br><span class=\"line\">  port: 8443</span><br><span class=\"line\">sed -n &#x27;/certificate:/s/\\/your.*path/\\/opt\\/nginx\\/conf\\/conf.d\\/ssl\\/k8s.org.crt/&#x27;p ./harbor/harbor.yml.tmpl </span><br><span class=\"line\">  certificate: /opt/nginx/conf/conf.d/ssl/k8s.org.crt</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>hostname</p>\n<p>https   port ,certificate,private_key</p>\n<p>external_url</p>\n<p>harbor_admin_password</p>\n<p>data_volume</p>\n<p>用外部数据库,redis时需要配置 external_database,external_redis </p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ./install.sh</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>默认的 Harbor 安装不包括 Notary 或 Trivy 等服务</p>\n<p>.&#x2F;install.sh –with-notary –with-trivy –with-chartmuseum</p>\n<p> –with-notary  数据权限</p>\n<p>–with-trivy   漏洞扫描</p>\n<p>–with-chartmuseum helm</p>\n</blockquote>\n<h3 id=\"docker\"><a href=\"#docker\" class=\"headerlink\" title=\"docker\"></a>docker</h3><h4 id=\"certs-d\"><a href=\"#certs-d\" class=\"headerlink\" title=\"certs.d\"></a>certs.d</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tree -L 3 /etc/docker/</span><br><span class=\"line\">/etc/docker/</span><br><span class=\"line\">├── certs.d</span><br><span class=\"line\">│   └── k8s.org</span><br><span class=\"line\">│       ├── ca.crt</span><br><span class=\"line\">│       ├── k8s.org.cert</span><br><span class=\"line\">│       └── k8s.org.key</span><br><span class=\"line\">├── daemon.json</span><br><span class=\"line\">└── key.json</span><br><span class=\"line\"></span><br><span class=\"line\">2 directories, 5 files</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>cp yourdomain.com.cert &#x2F;etc&#x2F;docker&#x2F;certs.d&#x2F;yourdomain.com&#x2F;<br>cp yourdomain.com.key &#x2F;etc&#x2F;docker&#x2F;certs.d&#x2F;yourdomain.com&#x2F;<br>cp ca.crt &#x2F;etc&#x2F;docker&#x2F;certs.d&#x2F;yourdomain.com&#x2F;</p>\n</blockquote>\n<h4 id=\"daemon-json\"><a href=\"#daemon-json\" class=\"headerlink\" title=\"daemon.json\"></a>daemon.json</h4><figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;data-root&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;/opt/data/docker&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">   <span class=\"attr\">&quot;registry-mirrors&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"string\">&quot;http://hub-mirror.c.163.com&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"attr\">&quot;insecure-registries&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span></span><br><span class=\"line\">  <span class=\"string\">&quot;https://k8s.org&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;debug&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;experimental&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>insecure-registries 私库地址,非域名格式 ip:端口</p>\n</blockquote>\n<h4 id=\"login\"><a href=\"#login\" class=\"headerlink\" title=\"login\"></a>login</h4><p>登录密码会保存认证,下次push镜像就不需要输入密码了</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ docker login k8s.org</span><br><span class=\"line\">cs@debian:~$ cat  ~/.docker/config.json </span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t&quot;auths&quot;: &#123;</span><br><span class=\"line\">\t\t&quot;cs.org&quot;: &#123;</span><br><span class=\"line\">\t\t\t&quot;auth&quot;: &quot;YWRtaW46YWRtaW4=&quot;</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t&quot;k8s.org&quot;: &#123;</span><br><span class=\"line\">\t\t\t&quot;auth&quot;: &quot;YWRtaW46Y3MxMjM0NTY=&quot;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t&quot;HttpHeaders&quot;: &#123;</span><br><span class=\"line\">\t\t&quot;User-Agent&quot;: &quot;Docker-Client/18.09.3 (linux)&quot;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"nginx\"><a href=\"#nginx\" class=\"headerlink\" title=\"nginx\"></a>nginx</h3><p>&#x2F;opt&#x2F;nginx&#x2F;conf&#x2F;conf.d&#x2F;http&#x2F;harbor.conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream harbors&#123;</span><br><span class=\"line\">     server 192.168.56.1:8443;</span><br><span class=\"line\">     #server 192.168.56.2:8443;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">log_format  harbor_log  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class=\"line\">                     &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class=\"line\">                     &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">       listen       443 ssl;</span><br><span class=\"line\">       server_name  k8s.org;</span><br><span class=\"line\"></span><br><span class=\"line\">        ssl_certificate      conf.d/ssl/k8s.org.crt;</span><br><span class=\"line\">        ssl_certificate_key  conf.d/ssl/k8s.org.key;</span><br><span class=\"line\"></span><br><span class=\"line\">        ssl_session_cache    shared:SSL:1m;</span><br><span class=\"line\">        ssl_session_timeout  5m;</span><br><span class=\"line\"></span><br><span class=\"line\">        ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class=\"line\">        ssl_prefer_server_ciphers  on;</span><br><span class=\"line\"></span><br><span class=\"line\">       access_log  logs/harbors.log  harbor_log;</span><br><span class=\"line\">       location / &#123;</span><br><span class=\"line\">            client_max_body_size  1024m;  # 设置接收客户端 body 最大长度为 1024M</span><br><span class=\"line\">            proxy_set_header Host $host;</span><br><span class=\"line\">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">            proxy_pass https://harbors;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>error parsing HTTP 413 response body: …… <title>413 Request Entity Too Large</title></p>\n<p><strong>client_max_body_size</strong></p>\n</blockquote>\n<h2 id=\"推送\"><a href=\"#推送\" class=\"headerlink\" title=\"推送\"></a>推送</h2><p>域名&#x2F;目录&#x2F;镜像名:版本号</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">docker images | grep etcd</span></span><br><span class=\"line\">k8s.org/k8s/etcd                      3.4.13-0            51401ddb110e        23 months ago       145MB</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">docker push  k8s.org/k8s/etcd:3.4.13-0</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"项目\"><a href=\"#项目\" class=\"headerlink\" title=\"项目\"></a>项目</h3><p><img src=\"/pics/harbor-01.png\"></p>\n<h3 id=\"镜像\"><a href=\"#镜像\" class=\"headerlink\" title=\"镜像\"></a>镜像</h3><p><img src=\"/pics/harbor-02.png\"></p>\n<h2 id=\"高可用\"><a href=\"#高可用\" class=\"headerlink\" title=\"高可用\"></a>高可用</h2><p>通过配置数据库(mysql ,redis集群),存储来实现</p>\n<h2 id=\"ERROR\"><a href=\"#ERROR\" class=\"headerlink\" title=\"ERROR\"></a>ERROR</h2><h3 id=\"pull-Retrying-in\"><a href=\"#pull-Retrying-in\" class=\"headerlink\" title=\"pull Retrying in\"></a>pull Retrying in</h3><p><a href=\"https://github.com/vmware/harbor/issues/3062\">https://github.com/vmware/harbor/issues/3062</a></p>\n<p>&#x2F;opt&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http &#123;</span><br><span class=\"line\">    ......</span><br><span class=\"line\">      ####添加以下配置</span><br><span class=\"line\">      proxy_buffers 4 32k;</span><br><span class=\"line\">      proxy_busy_buffers_size 64k;</span><br><span class=\"line\">      proxy_temp_file_write_size 64k;</span><br><span class=\"line\">      #unlimit the proxy temp file size limitaion. Look at issue #3062 (https://github.com/vmware/harbor/issues/3062)</span><br><span class=\"line\">      proxy_max_temp_file_size 0;</span><br><span class=\"line\"></span><br><span class=\"line\">  ....      </span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http:</span><br><span class=\"line\">  relativeurls: true</span><br></pre></td></tr></table></figure>\n\n<p>harbor的helm里需要加上registry.relativeurls&#x3D;true</p>\n<p>参考：<a href=\"https://github.com/docker/distribution/issues/970#issuecomment-284227065\">https://github.com/docker/distribution/issues/970#issuecomment-284227065</a></p>\n<h3 id=\"ImagePullBackOff\"><a href=\"#ImagePullBackOff\" class=\"headerlink\" title=\"ImagePullBackOff\"></a>ImagePullBackOff</h3><h4 id=\"创建一个基于现有凭证的-Secret\"><a href=\"#创建一个基于现有凭证的-Secret\" class=\"headerlink\" title=\"创建一个基于现有凭证的 Secret\"></a>创建一个基于现有凭证的 Secret</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl create secret generic login --from-file=.dockerconfigjson=/home/cs/.docker/config.json  --type=kubernetes.io/dockerconfigjson </span><br><span class=\"line\">secret/login created</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"在命令行上提供凭证来创建-Secret\"><a href=\"#在命令行上提供凭证来创建-Secret\" class=\"headerlink\" title=\"在命令行上提供凭证来创建 Secret\"></a>在命令行上提供凭证来创建 Secret</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create secret docker-registry regcred \\</span><br><span class=\"line\">--docker-server=&lt;你的镜像仓库服务器&gt; \\</span><br><span class=\"line\">--docker-username=&lt;你的用户名&gt; \\</span><br><span class=\"line\">--docker-password=&lt;你的密码&gt; \\</span><br><span class=\"line\">--docker-email=&lt;你的邮箱地址&gt;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>在这里：</p>\n</blockquote>\n<blockquote>\n<ul>\n<li>是你的私有 Docker 仓库全限定域名（FQDN）。 DockerHub 使用 <a href=\"https://index.docker.io/v1/%E3%80%82\">https://index.docker.io/v1/。</a></li>\n<li>是你的 Docker 用户名。</li>\n<li>是你的 Docker 密码。</li>\n<li>是你的 Docker 邮箱。</li>\n</ul>\n</blockquote>\n<p>这样你就成功地将集群中的 Docker 凭证设置为名为 regcred 的 Secret</p>\n<h4 id=\"检查-Secret\"><a href=\"#检查-Secret\" class=\"headerlink\" title=\"检查 Secret\"></a>检查 Secret</h4><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">$</span> <span class=\"string\">kubectl</span> <span class=\"string\">get</span> <span class=\"string\">secrets</span></span><br><span class=\"line\"><span class=\"string\">NAME</span>                  <span class=\"string\">TYPE</span>                                  <span class=\"string\">DATA</span>   <span class=\"string\">AGE</span></span><br><span class=\"line\"><span class=\"string\">login</span>                 <span class=\"string\">kubernetes.io/dockerconfigjson</span>        <span class=\"number\">1</span>      <span class=\"string\">85d</span></span><br><span class=\"line\"><span class=\"string\">$</span> <span class=\"string\">kubectl</span> <span class=\"string\">get</span> <span class=\"string\">secret</span> <span class=\"string\">login</span> <span class=\"string\">--output=yaml</span>  </span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\">  <span class=\"string\">.dockerconfigjson:</span> <span class=\"string\">ewoJImF1dGhzIjogewoJCSJjcy5vcmciOiB7CgkJCSJhdXRoIjogIllXUnRhVzQ2WVdSdGFXND0iCgkJfSwKCQkiazhzLm9yZyI6IHsKCQkJImF1dGgiOiAiWVdSdGFXNDZZM014TWpNME5UWT0iCgkJfQoJfSwKCSJIdHRwSGVhZGVycyI6IHsKCQkiVXNlci1BZ2VudCI6ICJEb2NrZXItQ2xpZW50LzE4LjA5LjMgKGxpbnV4KSIKCX0KfQ==</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Secret</span></span><br><span class=\"line\"><span class=\"string\">....</span></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl get secret login --output=&quot;jsonpath=&#123;.data.\\.dockerconfigjson&#125;&quot; | base64 --decode</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t&quot;auths&quot;: &#123;</span><br><span class=\"line\">\t\t&quot;cs.org&quot;: &#123;</span><br><span class=\"line\">\t\t\t&quot;auth&quot;: &quot;YWRtaW46YWRtaW4=&quot;</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t&quot;k8s.org&quot;: &#123;</span><br><span class=\"line\">\t\t\t&quot;auth&quot;: &quot;YWRtaW46Y3MxMjM0NTY=&quot;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t&quot;HttpHeaders&quot;: &#123;</span><br><span class=\"line\">\t\t&quot;User-Agent&quot;: &quot;Docker-Client/18.09.3 (linux)&quot;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;YWRtaW46Y3MxMjM0NTY=&quot; | base64 --decode </span><br><span class=\"line\">admin:cs12xx</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"pod\"><a href=\"#pod\" class=\"headerlink\" title=\"pod\"></a>pod</h4><p>创建一个使用你的 Secret 的 Pod</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">kind: Pod</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: private-reg</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  containers:</span><br><span class=\"line\">  - name: private-reg-container</span><br><span class=\"line\">    image: &lt;your-private-image&gt;</span><br><span class=\"line\">  imagePullSecrets:</span><br><span class=\"line\">  - name: login</span><br></pre></td></tr></table></figure>"},{"title":"helm工具","date":"2022-08-18T12:26:54.000Z","_content":"\n\n\n### 安装\n\n下载 https://helm.sh/docs/intro/install/\n\n```\nwget  -P /opt/docker  https://get.helm.sh/helm-v3.9.3-linux-amd64.tar.gz\nmkdir /opt/docker/helm-v3.9.3\ntar -zxvf  helm-v3.9.3-linux-amd64.tar.gz  -C  ./helm-v3.9.3   --strip-components 1\n```\n\n\n\n### 设置环境变量\n\n```\n$ cat >> ~/.bashrc <<EOF\n#helm\nexport PATH=$PATH:/opt/docker/helm-v3.9.3\nEOF\n$ helm version\nversion.BuildInfo{Version:\"v3.9.3\", GitCommit:\"414ff28d4029ae8c8b05d62aa06c7fe3dee2bc58\", GitTreeState:\"clean\", GoVersion:\"go1.17.13\"}\n\n```\n\n\n\n### 添加源\n\n<!--more-->\n\n```\nhelm repo add stable http://mirror.azure.cn/kubernetes/charts \nhelm repo add aliyun https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts \nhelm repo list\n```\n\n\n\nshow\n\n```\nhelm show chart stable/mysql\n```\n\n\n\ninstall\n\n```\n helm install db stable/mysql\nWARNING: This chart is deprecated\nNAME: db\nLAST DEPLOYED: Thu Aug 18 21:33:05 2022\nNAMESPACE: default\nSTATUS: deployed\nREVISION: 1\nNOTES:\nMySQL can be accessed via port 3306 on the following DNS name from within your cluster:\ndb-mysql.default.svc.cluster.local\n\nTo get your root password run:\n\n    MYSQL_ROOT_PASSWORD=$(kubectl get secret --namespace default db-mysql -o jsonpath=\"{.data.mysql-root-password}\" | base64 --decode; echo)\n\nTo connect to your database:\n\n1. Run an Ubuntu pod that you can use as a client:\n\n    kubectl run -i --tty ubuntu --image=ubuntu:16.04 --restart=Never -- bash -il\n\n2. Install the mysql client:\n\n    $ apt-get update && apt-get install mysql-client -y\n\n3. Connect using the mysql cli, then provide your password:\n    $ mysql -h db-mysql -p\n\nTo connect to your database directly from outside the K8s cluster:\n    MYSQL_HOST=127.0.0.1\n    MYSQL_PORT=3306\n\n    # Execute the following command to route the connection:\n    kubectl port-forward svc/db-mysql 3306\n\n    mysql -h ${MYSQL_HOST} -P${MYSQL_PORT} -u root -p${MYSQL_ROOT_PASSWORD}\n```\n\n\n\n```\ns@debian:~$ kubectl  get pod -A\nNAMESPACE     NAME                          READY   STATUS    RESTARTS   AGE\ndefault       db-mysql-7f4fdddfd5-2dqql     0/1     Pending   0          67s\n```\n\n","source":"_posts/linux/k8s/helm.md","raw":"---\ntitle: helm工具\npermalink: linux/k8s/helm/\ntags:\n  - helm\ncategories:\n  - linux\n  - k8s\ndate: 2022-08-18 20:26:54\n---\n\n\n\n### 安装\n\n下载 https://helm.sh/docs/intro/install/\n\n```\nwget  -P /opt/docker  https://get.helm.sh/helm-v3.9.3-linux-amd64.tar.gz\nmkdir /opt/docker/helm-v3.9.3\ntar -zxvf  helm-v3.9.3-linux-amd64.tar.gz  -C  ./helm-v3.9.3   --strip-components 1\n```\n\n\n\n### 设置环境变量\n\n```\n$ cat >> ~/.bashrc <<EOF\n#helm\nexport PATH=$PATH:/opt/docker/helm-v3.9.3\nEOF\n$ helm version\nversion.BuildInfo{Version:\"v3.9.3\", GitCommit:\"414ff28d4029ae8c8b05d62aa06c7fe3dee2bc58\", GitTreeState:\"clean\", GoVersion:\"go1.17.13\"}\n\n```\n\n\n\n### 添加源\n\n<!--more-->\n\n```\nhelm repo add stable http://mirror.azure.cn/kubernetes/charts \nhelm repo add aliyun https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts \nhelm repo list\n```\n\n\n\nshow\n\n```\nhelm show chart stable/mysql\n```\n\n\n\ninstall\n\n```\n helm install db stable/mysql\nWARNING: This chart is deprecated\nNAME: db\nLAST DEPLOYED: Thu Aug 18 21:33:05 2022\nNAMESPACE: default\nSTATUS: deployed\nREVISION: 1\nNOTES:\nMySQL can be accessed via port 3306 on the following DNS name from within your cluster:\ndb-mysql.default.svc.cluster.local\n\nTo get your root password run:\n\n    MYSQL_ROOT_PASSWORD=$(kubectl get secret --namespace default db-mysql -o jsonpath=\"{.data.mysql-root-password}\" | base64 --decode; echo)\n\nTo connect to your database:\n\n1. Run an Ubuntu pod that you can use as a client:\n\n    kubectl run -i --tty ubuntu --image=ubuntu:16.04 --restart=Never -- bash -il\n\n2. Install the mysql client:\n\n    $ apt-get update && apt-get install mysql-client -y\n\n3. Connect using the mysql cli, then provide your password:\n    $ mysql -h db-mysql -p\n\nTo connect to your database directly from outside the K8s cluster:\n    MYSQL_HOST=127.0.0.1\n    MYSQL_PORT=3306\n\n    # Execute the following command to route the connection:\n    kubectl port-forward svc/db-mysql 3306\n\n    mysql -h ${MYSQL_HOST} -P${MYSQL_PORT} -u root -p${MYSQL_ROOT_PASSWORD}\n```\n\n\n\n```\ns@debian:~$ kubectl  get pod -A\nNAMESPACE     NAME                          READY   STATUS    RESTARTS   AGE\ndefault       db-mysql-7f4fdddfd5-2dqql     0/1     Pending   0          67s\n```\n\n","slug":"linux/k8s/helm","published":1,"updated":"2022-08-29T13:45:21.964Z","__permalink":"linux/k8s/helm/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtta0022gwi50xf875y2","content":"<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><p>下载 <a href=\"https://helm.sh/docs/intro/install/\">https://helm.sh/docs/intro/install/</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget  -P /opt/docker  https://get.helm.sh/helm-v3.9.3-linux-amd64.tar.gz</span><br><span class=\"line\">mkdir /opt/docker/helm-v3.9.3</span><br><span class=\"line\">tar -zxvf  helm-v3.9.3-linux-amd64.tar.gz  -C  ./helm-v3.9.3   --strip-components 1</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"设置环境变量\"><a href=\"#设置环境变量\" class=\"headerlink\" title=\"设置环境变量\"></a>设置环境变量</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cat &gt;&gt; ~/.bashrc &lt;&lt;EOF</span><br><span class=\"line\">#helm</span><br><span class=\"line\">export PATH=$PATH:/opt/docker/helm-v3.9.3</span><br><span class=\"line\">EOF</span><br><span class=\"line\">$ helm version</span><br><span class=\"line\">version.BuildInfo&#123;Version:&quot;v3.9.3&quot;, GitCommit:&quot;414ff28d4029ae8c8b05d62aa06c7fe3dee2bc58&quot;, GitTreeState:&quot;clean&quot;, GoVersion:&quot;go1.17.13&quot;&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"添加源\"><a href=\"#添加源\" class=\"headerlink\" title=\"添加源\"></a>添加源</h3><span id=\"more\"></span>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">helm repo add stable http://mirror.azure.cn/kubernetes/charts </span><br><span class=\"line\">helm repo add aliyun https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts </span><br><span class=\"line\">helm repo list</span><br></pre></td></tr></table></figure>\n\n\n\n<p>show</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">helm show chart stable/mysql</span><br></pre></td></tr></table></figure>\n\n\n\n<p>install</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> helm install db stable/mysql</span><br><span class=\"line\">WARNING: This chart is deprecated</span><br><span class=\"line\">NAME: db</span><br><span class=\"line\">LAST DEPLOYED: Thu Aug 18 21:33:05 2022</span><br><span class=\"line\">NAMESPACE: default</span><br><span class=\"line\">STATUS: deployed</span><br><span class=\"line\">REVISION: 1</span><br><span class=\"line\">NOTES:</span><br><span class=\"line\">MySQL can be accessed via port 3306 on the following DNS name from within your cluster:</span><br><span class=\"line\">db-mysql.default.svc.cluster.local</span><br><span class=\"line\"></span><br><span class=\"line\">To get your root password run:</span><br><span class=\"line\"></span><br><span class=\"line\">    MYSQL_ROOT_PASSWORD=$(kubectl get secret --namespace default db-mysql -o jsonpath=&quot;&#123;.data.mysql-root-password&#125;&quot; | base64 --decode; echo)</span><br><span class=\"line\"></span><br><span class=\"line\">To connect to your database:</span><br><span class=\"line\"></span><br><span class=\"line\">1. Run an Ubuntu pod that you can use as a client:</span><br><span class=\"line\"></span><br><span class=\"line\">    kubectl run -i --tty ubuntu --image=ubuntu:16.04 --restart=Never -- bash -il</span><br><span class=\"line\"></span><br><span class=\"line\">2. Install the mysql client:</span><br><span class=\"line\"></span><br><span class=\"line\">    $ apt-get update &amp;&amp; apt-get install mysql-client -y</span><br><span class=\"line\"></span><br><span class=\"line\">3. Connect using the mysql cli, then provide your password:</span><br><span class=\"line\">    $ mysql -h db-mysql -p</span><br><span class=\"line\"></span><br><span class=\"line\">To connect to your database directly from outside the K8s cluster:</span><br><span class=\"line\">    MYSQL_HOST=127.0.0.1</span><br><span class=\"line\">    MYSQL_PORT=3306</span><br><span class=\"line\"></span><br><span class=\"line\">    # Execute the following command to route the connection:</span><br><span class=\"line\">    kubectl port-forward svc/db-mysql 3306</span><br><span class=\"line\"></span><br><span class=\"line\">    mysql -h $&#123;MYSQL_HOST&#125; -P$&#123;MYSQL_PORT&#125; -u root -p$&#123;MYSQL_ROOT_PASSWORD&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s@debian:~$ kubectl  get pod -A</span><br><span class=\"line\">NAMESPACE     NAME                          READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">default       db-mysql-7f4fdddfd5-2dqql     0/1     Pending   0          67s</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><p>下载 <a href=\"https://helm.sh/docs/intro/install/\">https://helm.sh/docs/intro/install/</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget  -P /opt/docker  https://get.helm.sh/helm-v3.9.3-linux-amd64.tar.gz</span><br><span class=\"line\">mkdir /opt/docker/helm-v3.9.3</span><br><span class=\"line\">tar -zxvf  helm-v3.9.3-linux-amd64.tar.gz  -C  ./helm-v3.9.3   --strip-components 1</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"设置环境变量\"><a href=\"#设置环境变量\" class=\"headerlink\" title=\"设置环境变量\"></a>设置环境变量</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cat &gt;&gt; ~/.bashrc &lt;&lt;EOF</span><br><span class=\"line\">#helm</span><br><span class=\"line\">export PATH=$PATH:/opt/docker/helm-v3.9.3</span><br><span class=\"line\">EOF</span><br><span class=\"line\">$ helm version</span><br><span class=\"line\">version.BuildInfo&#123;Version:&quot;v3.9.3&quot;, GitCommit:&quot;414ff28d4029ae8c8b05d62aa06c7fe3dee2bc58&quot;, GitTreeState:&quot;clean&quot;, GoVersion:&quot;go1.17.13&quot;&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"添加源\"><a href=\"#添加源\" class=\"headerlink\" title=\"添加源\"></a>添加源</h3>","more":"<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">helm repo add stable http://mirror.azure.cn/kubernetes/charts </span><br><span class=\"line\">helm repo add aliyun https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts </span><br><span class=\"line\">helm repo list</span><br></pre></td></tr></table></figure>\n\n\n\n<p>show</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">helm show chart stable/mysql</span><br></pre></td></tr></table></figure>\n\n\n\n<p>install</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> helm install db stable/mysql</span><br><span class=\"line\">WARNING: This chart is deprecated</span><br><span class=\"line\">NAME: db</span><br><span class=\"line\">LAST DEPLOYED: Thu Aug 18 21:33:05 2022</span><br><span class=\"line\">NAMESPACE: default</span><br><span class=\"line\">STATUS: deployed</span><br><span class=\"line\">REVISION: 1</span><br><span class=\"line\">NOTES:</span><br><span class=\"line\">MySQL can be accessed via port 3306 on the following DNS name from within your cluster:</span><br><span class=\"line\">db-mysql.default.svc.cluster.local</span><br><span class=\"line\"></span><br><span class=\"line\">To get your root password run:</span><br><span class=\"line\"></span><br><span class=\"line\">    MYSQL_ROOT_PASSWORD=$(kubectl get secret --namespace default db-mysql -o jsonpath=&quot;&#123;.data.mysql-root-password&#125;&quot; | base64 --decode; echo)</span><br><span class=\"line\"></span><br><span class=\"line\">To connect to your database:</span><br><span class=\"line\"></span><br><span class=\"line\">1. Run an Ubuntu pod that you can use as a client:</span><br><span class=\"line\"></span><br><span class=\"line\">    kubectl run -i --tty ubuntu --image=ubuntu:16.04 --restart=Never -- bash -il</span><br><span class=\"line\"></span><br><span class=\"line\">2. Install the mysql client:</span><br><span class=\"line\"></span><br><span class=\"line\">    $ apt-get update &amp;&amp; apt-get install mysql-client -y</span><br><span class=\"line\"></span><br><span class=\"line\">3. Connect using the mysql cli, then provide your password:</span><br><span class=\"line\">    $ mysql -h db-mysql -p</span><br><span class=\"line\"></span><br><span class=\"line\">To connect to your database directly from outside the K8s cluster:</span><br><span class=\"line\">    MYSQL_HOST=127.0.0.1</span><br><span class=\"line\">    MYSQL_PORT=3306</span><br><span class=\"line\"></span><br><span class=\"line\">    # Execute the following command to route the connection:</span><br><span class=\"line\">    kubectl port-forward svc/db-mysql 3306</span><br><span class=\"line\"></span><br><span class=\"line\">    mysql -h $&#123;MYSQL_HOST&#125; -P$&#123;MYSQL_PORT&#125; -u root -p$&#123;MYSQL_ROOT_PASSWORD&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s@debian:~$ kubectl  get pod -A</span><br><span class=\"line\">NAMESPACE     NAME                          READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">default       db-mysql-7f4fdddfd5-2dqql     0/1     Pending   0          67s</span><br></pre></td></tr></table></figure>"},{"title":"kubernetes部署结构","date":"2022-07-31T13:59:24.000Z","_content":"\n## go env\n\n编译二进制\n\nYou have a working [Go environment](https://golang.org/doc/install).\n\n```shell\nGOPATH=`go env | grep GOPATH | cut -d '\"' -f 2 `\nmkdir -p $GOPATH/src/k8s.io\ncd $GOPATH/src/k8s.io\ngit clone https://github.com/kubernetes/kubernetes\ncd kubernetes\ngit checkout v1.21.12\nmake\n```\n\n\n\n## 前置条件配置\n\n- 一台兼容的 Linux 主机。Kubernetes 项目为基于 Debian 和 Red Hat 的 Linux 发行版以及一些不提供包管理器的发行版提供通用的指令\n- 每台机器 `2 GB` 或更多的 RAM （如果少于这个数字将会影响你应用的运行内存）\n- `2 CPU` 核或更多\n- 集群中的所有机器的网络彼此均能相互连接(公网和内网都可以)\n- 节点之中不可以有重复的主机名、MAC 地址或 product_uuid。请参见[这里](https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#verify-mac-address)了解更多详细信息。\n- 开启机器上的某些端口。请参见[这里](https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#check-required-ports) 了解更多详细信息。\n- 禁用交换分区。为了保证 kubelet 正常工作，你 **必须** 禁用交换分区\n\n更多见 https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/\n\n\n\n## 2种 HA 集群方式\n\n文档 https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/ha-topology/\n\n### 堆叠（Stacked）etcd \n\n这种拓扑将控制平面和 etcd 成员耦合在同一节点上,设置简单.存在耦合失败的风险\n\n![](/pics/etcd-stacked.png)\n\n\n\n<!--more-->\n\n### 外部 etcd 节点\n\n这种拓扑结构解耦了控制平面和 etcd 成员.需要两倍于堆叠 HA 拓扑的主机数量\n\n![](/pics/etcd-external.png)\n","source":"_posts/linux/k8s/k8s.md","raw":"---\ntitle: kubernetes部署结构\npermalink: linux/k8s/k8s/\ntags:\n  - kubernetes\ncategories:\n  - linux\n  - k8s\ndate: 2022-07-31 21:59:24\n---\n\n## go env\n\n编译二进制\n\nYou have a working [Go environment](https://golang.org/doc/install).\n\n```shell\nGOPATH=`go env | grep GOPATH | cut -d '\"' -f 2 `\nmkdir -p $GOPATH/src/k8s.io\ncd $GOPATH/src/k8s.io\ngit clone https://github.com/kubernetes/kubernetes\ncd kubernetes\ngit checkout v1.21.12\nmake\n```\n\n\n\n## 前置条件配置\n\n- 一台兼容的 Linux 主机。Kubernetes 项目为基于 Debian 和 Red Hat 的 Linux 发行版以及一些不提供包管理器的发行版提供通用的指令\n- 每台机器 `2 GB` 或更多的 RAM （如果少于这个数字将会影响你应用的运行内存）\n- `2 CPU` 核或更多\n- 集群中的所有机器的网络彼此均能相互连接(公网和内网都可以)\n- 节点之中不可以有重复的主机名、MAC 地址或 product_uuid。请参见[这里](https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#verify-mac-address)了解更多详细信息。\n- 开启机器上的某些端口。请参见[这里](https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#check-required-ports) 了解更多详细信息。\n- 禁用交换分区。为了保证 kubelet 正常工作，你 **必须** 禁用交换分区\n\n更多见 https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/\n\n\n\n## 2种 HA 集群方式\n\n文档 https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/ha-topology/\n\n### 堆叠（Stacked）etcd \n\n这种拓扑将控制平面和 etcd 成员耦合在同一节点上,设置简单.存在耦合失败的风险\n\n![](/pics/etcd-stacked.png)\n\n\n\n<!--more-->\n\n### 外部 etcd 节点\n\n这种拓扑结构解耦了控制平面和 etcd 成员.需要两倍于堆叠 HA 拓扑的主机数量\n\n![](/pics/etcd-external.png)\n","slug":"linux/k8s/k8s","published":1,"updated":"2022-08-28T09:10:00.944Z","__permalink":"linux/k8s/k8s/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gttb0026gwi5f4b79mo0","content":"<h2 id=\"go-env\"><a href=\"#go-env\" class=\"headerlink\" title=\"go env\"></a>go env</h2><p>编译二进制</p>\n<p>You have a working <a href=\"https://golang.org/doc/install\">Go environment</a>.</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GOPATH=`go env | grep GOPATH | cut -d &#x27;&quot;&#x27; -f 2 `</span><br><span class=\"line\">mkdir -p $GOPATH/src/k8s.io</span><br><span class=\"line\">cd $GOPATH/src/k8s.io</span><br><span class=\"line\">git clone https://github.com/kubernetes/kubernetes</span><br><span class=\"line\">cd kubernetes</span><br><span class=\"line\">git checkout v1.21.12</span><br><span class=\"line\">make</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"前置条件配置\"><a href=\"#前置条件配置\" class=\"headerlink\" title=\"前置条件配置\"></a>前置条件配置</h2><ul>\n<li>一台兼容的 Linux 主机。Kubernetes 项目为基于 Debian 和 Red Hat 的 Linux 发行版以及一些不提供包管理器的发行版提供通用的指令</li>\n<li>每台机器 <code>2 GB</code> 或更多的 RAM （如果少于这个数字将会影响你应用的运行内存）</li>\n<li><code>2 CPU</code> 核或更多</li>\n<li>集群中的所有机器的网络彼此均能相互连接(公网和内网都可以)</li>\n<li>节点之中不可以有重复的主机名、MAC 地址或 product_uuid。请参见<a href=\"https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#verify-mac-address\">这里</a>了解更多详细信息。</li>\n<li>开启机器上的某些端口。请参见<a href=\"https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#check-required-ports\">这里</a> 了解更多详细信息。</li>\n<li>禁用交换分区。为了保证 kubelet 正常工作，你 <strong>必须</strong> 禁用交换分区</li>\n</ul>\n<p>更多见 <a href=\"https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/\">https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/</a></p>\n<h2 id=\"2种-HA-集群方式\"><a href=\"#2种-HA-集群方式\" class=\"headerlink\" title=\"2种 HA 集群方式\"></a>2种 HA 集群方式</h2><p>文档 <a href=\"https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/ha-topology/\">https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/ha-topology/</a></p>\n<h3 id=\"堆叠（Stacked）etcd\"><a href=\"#堆叠（Stacked）etcd\" class=\"headerlink\" title=\"堆叠（Stacked）etcd\"></a>堆叠（Stacked）etcd</h3><p>这种拓扑将控制平面和 etcd 成员耦合在同一节点上,设置简单.存在耦合失败的风险</p>\n<p><img src=\"/pics/etcd-stacked.png\"></p>\n<span id=\"more\"></span>\n\n<h3 id=\"外部-etcd-节点\"><a href=\"#外部-etcd-节点\" class=\"headerlink\" title=\"外部 etcd 节点\"></a>外部 etcd 节点</h3><p>这种拓扑结构解耦了控制平面和 etcd 成员.需要两倍于堆叠 HA 拓扑的主机数量</p>\n<p><img src=\"/pics/etcd-external.png\"></p>\n","site":{"data":{}},"excerpt":"<h2 id=\"go-env\"><a href=\"#go-env\" class=\"headerlink\" title=\"go env\"></a>go env</h2><p>编译二进制</p>\n<p>You have a working <a href=\"https://golang.org/doc/install\">Go environment</a>.</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GOPATH=`go env | grep GOPATH | cut -d &#x27;&quot;&#x27; -f 2 `</span><br><span class=\"line\">mkdir -p $GOPATH/src/k8s.io</span><br><span class=\"line\">cd $GOPATH/src/k8s.io</span><br><span class=\"line\">git clone https://github.com/kubernetes/kubernetes</span><br><span class=\"line\">cd kubernetes</span><br><span class=\"line\">git checkout v1.21.12</span><br><span class=\"line\">make</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"前置条件配置\"><a href=\"#前置条件配置\" class=\"headerlink\" title=\"前置条件配置\"></a>前置条件配置</h2><ul>\n<li>一台兼容的 Linux 主机。Kubernetes 项目为基于 Debian 和 Red Hat 的 Linux 发行版以及一些不提供包管理器的发行版提供通用的指令</li>\n<li>每台机器 <code>2 GB</code> 或更多的 RAM （如果少于这个数字将会影响你应用的运行内存）</li>\n<li><code>2 CPU</code> 核或更多</li>\n<li>集群中的所有机器的网络彼此均能相互连接(公网和内网都可以)</li>\n<li>节点之中不可以有重复的主机名、MAC 地址或 product_uuid。请参见<a href=\"https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#verify-mac-address\">这里</a>了解更多详细信息。</li>\n<li>开启机器上的某些端口。请参见<a href=\"https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#check-required-ports\">这里</a> 了解更多详细信息。</li>\n<li>禁用交换分区。为了保证 kubelet 正常工作，你 <strong>必须</strong> 禁用交换分区</li>\n</ul>\n<p>更多见 <a href=\"https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/\">https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/</a></p>\n<h2 id=\"2种-HA-集群方式\"><a href=\"#2种-HA-集群方式\" class=\"headerlink\" title=\"2种 HA 集群方式\"></a>2种 HA 集群方式</h2><p>文档 <a href=\"https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/ha-topology/\">https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/ha-topology/</a></p>\n<h3 id=\"堆叠（Stacked）etcd\"><a href=\"#堆叠（Stacked）etcd\" class=\"headerlink\" title=\"堆叠（Stacked）etcd\"></a>堆叠（Stacked）etcd</h3><p>这种拓扑将控制平面和 etcd 成员耦合在同一节点上,设置简单.存在耦合失败的风险</p>\n<p><img src=\"/pics/etcd-stacked.png\"></p>","more":"<h3 id=\"外部-etcd-节点\"><a href=\"#外部-etcd-节点\" class=\"headerlink\" title=\"外部 etcd 节点\"></a>外部 etcd 节点</h3><p>这种拓扑结构解耦了控制平面和 etcd 成员.需要两倍于堆叠 HA 拓扑的主机数量</p>\n<p><img src=\"/pics/etcd-external.png\"></p>"},{"title":"k8s集群","date":"2022-07-21T12:24:46.000Z","_content":"\n\n\n\n\n\n\n### 常用命令\n\n缩写\n\n```\ncertificatesigningrequests (缩写 csr)\ncomponentstatuses (缩写 cs)\nconfigmaps (缩写 cm)\ncustomresourcedefinition (缩写 crd)\ndaemonsets (缩写 ds)\ndeployments (缩写 deploy)\nendpoints (缩写 ep)\nevents (缩写 ev)\nhorizontalpodautoscalers (缩写 hpa)\ningresses (缩写 ing)\nlimitranges (缩写 limits)\nnamespaces (缩写 ns)\nnetworkpolicies (缩写 netpol)\nnodes (缩写 no)\npersistentvolumeclaims (缩写 pvc)\npersistentvolumes (缩写 pv)\npoddisruptionbudgets (缩写 pdb)\npods (缩写 po)\npodsecuritypolicies (缩写 psp)\nreplicasets (缩写 rs)\nreplicationcontrollers (缩写 rc)\nresourcequotas (缩写 quota)\nserviceaccounts (缩写 sa)\nservices (缩写 svc)\nstatefulsets (缩写 sts)\nstorageclasses (缩写 sc)\n```\n\n\n\n#### 自动补全\n\n```\nsudo apt install bash-completion\n\nsource /usr/share/bash-completion/bash_completion\nsource <(kubectl completion bash)\n\necho \"source <(kubectl completion bash)\" >> ~/.bashrc\n```\n\n\n\n#### cs(master节点)\n\ncomponentstatuses\n\n```\ncs@debian:~$ kubectl get cs\nNAME                 STATUS    MESSAGE              ERROR\nscheduler            Healthy   ok                   \ncontroller-manager   Healthy   ok                   \netcd-2               Healthy   {\"health\": \"true\"}   \netcd-0               Healthy   {\"health\": \"true\"}   \netcd-1               Healthy   {\"health\": \"true\"}  \n```\n\n\n\n#### node节点\n\n```\ncs@debian:~$ kubectl  get node\nNAME       STATUS   ROLES    AGE    VERSION\nmaster02   Ready    <none>   101d   v1.18.8\nmaster03   Ready    <none>   101d   v1.18.8\nnode04     Ready    <none>   101d   v1.18.8\nnode05     Ready    <none>   101d   v1.18.8\nnode06     Ready    <none>   101d   v1.18.8\n\nkubectl get node -o wide\n```\n\n<!--more-->\n\n空间\n\n```\ncs@debian:~$ kubectl get namespaces \nNAME                   STATUS   AGE\ndefault                Active   101d\ndevops                 Active   100d\nkube-node-lease        Active   101d\nkube-public            Active   101d\nkube-system            Active   101d\nkubernetes-dashboard   Active   92d\n```\n\n\n\n#### pod\n\n```\ncs@debian:~$ kubectl get pod\nNo resources found in default namespace.\n\ncs@debian:~$ kubectl get pod -n kube-system \nNAME                                         READY   STATUS    RESTARTS   AGE\ncoredns-56ff7bc666-prc6l                     1/1     Running   4          11d\ncoredns-56ff7bc666-qwdsh                     1/1     Running   8          92d\ntraefik-ingress-controller-7769cb875-x76rs   1/1     Running   1          46h\n```\n\n>-n  接namespaces的NAME值,省略为default\n\n\n\n```\nkubectl get pods -o wide\nkubectl get pods -A -o wide\n```\n\n\n\n\n\n#### describe\n\n ingress **Tab提示**\n\n```\ncs@debian:~$ kubectl get ingress -n devops \ningressclasses.networking.k8s.io      ingresses.networking.k8s.io           ingressroutetcps.traefik.containo.us  \ningresses.extensions                  ingressroutes.traefik.containo.us     ingressrouteudps.traefik.containo.us  \n\ncs@debian:~$ kubectl get ingressroutetcps.traefik.containo.us -n devops \nNAME    AGE\nredis   47h\n\ncs@debian:~$ kubectl describe ingressroutetcps.traefik.containo.us redis -n devops \nName:         redis\nNamespace:    devops\nLabels:       <none>\nAnnotations:  API Version:  traefik.containo.us/v1alpha1\nKind:         IngressRouteTCP\nMetadata:\n  Creation Timestamp:  2022-07-19T13:01:37Z\n  Generation:          1\n  Managed Fields:\n    API Version:  traefik.containo.us/v1alpha1\n    Fields Type:  FieldsV1\n    fieldsV1:\n      f:metadata:\n        f:annotations:\n          .:\n          f:kubectl.kubernetes.io/last-applied-configuration:\n      f:spec:\n        .:\n        f:entryPoints:\n        f:routes:\n    Manager:         kubectl\n    Operation:       Update\n    Time:            2022-07-19T13:01:37Z\n  Resource Version:  261095\n  Self Link:         /apis/traefik.containo.us/v1alpha1/namespaces/devops/ingressroutetcps/redis\n  UID:               c79681ee-1bf1-4843-9666-457970d78f27\nSpec:\n  Entry Points:\n    redis\n  Routes:\n    Match:  HostSNI(`*`)\n    Services:\n      Name:  redis-service\n      Port:  6379\nEvents:      <none>\n```\n\n\n\n\n\n#### log\n\n\n\n```\ncs@debian:~$ kubectl logs  --tail=5 redis-app-1 -n devops\n63:M 21 Jul 2022 12:15:34.720 * Synchronization with replica 121.21.25.3:6379 succeeded\n63:M 21 Jul 2022 12:15:36.469 # Cluster state changed: ok\n63:M 21 Jul 2022 12:15:40.604 * FAIL message received from 67f931358b8004268db0b57932293602ab3de629 about b49a123e2764b665ee898c21f983b9cda70cda00\n63:M 21 Jul 2022 12:15:42.635 * Marking node a0e2f50ba382870da1ce4d23b66a1375826d6dc8 as failing (quorum reached).\n63:M 21 Jul 2022 12:15:42.635 # Cluster state changed: fail\n\ncs@debian:~$ kubectl logs  -f  --tail=5 redis-app-1 -n devops\n63:M 21 Jul 2022 12:15:34.720 * Synchronization with replica 121.21.25.3:6379 succeeded\n63:M 21 Jul 2022 12:15:36.469 # Cluster state changed: ok\n63:M 21 Jul 2022 12:15:40.604 * FAIL message received from 67f931358b8004268db0b57932293602ab3de629 about b49a123e2764b665ee898c21f983b9cda70cda00\n63:M 21 Jul 2022 12:15:42.635 * Marking node a0e2f50ba382870da1ce4d23b66a1375826d6dc8 as failing (quorum reached).\n63:M 21 Jul 2022 12:15:42.635 # Cluster state changed: fail\n^C\n```\n\n>-f   类似 **tail -f** \n>\n>-p,  --previous[=false]: 如果为true，输出pod中曾经运行过，但目前已终止的容器的日志\n>       --since=0: 仅返回相对时间范围，如5s、2m或3h，之内的日志。默认返回所有日志。只能同时使用since 和since-time中的一种\n>      --since-time=\"\": 仅返回指定时间（RFC3339格式）之后的日志。默认返回所有日志。只能同时使用since和since-time中的一种\n>      --tail=-1: 要显示的最新的日志条数。默认为-1，显示所有的日志\n\n\n\n#### patch\n\n更新容器的镜像\n\n```\nkubectl patch pod valid-pod -p '{\"spec\":{\"containers\":[{\"name\":\"kubernetes-serve-hostname\",\"image\":\"new image\"}]}}'\n或\nkubectl patch pod valid-pod --type='json' -p='[{\"op\": \"replace\", \"path\": \"/spec/containers/0/image\", \"value\":\"new image\"}]'\n```\n\n设置服务对外的IP\n\n```\nkubectl patch svc <svc-name> -n <namespace> -p '{\"spec\": {\"type\": \"LoadBalancer\", \"externalIPs\":[\"192.168.31.241\"]}}'\n```\n\n\n\n#### scale\n\n对副本数进行扩展或缩小\n\n\n\n前提条件校验 ；当前副本数量或 `--resource-version`\n\n\n\n缩减副本数到2\n\n```\nkubectl scale rc rc-nginx-3 —replicas=2\n```\n\n\n\n当前副本数为2，则将其扩展至3\n\n```\nkubectl scale --current-replicas=2 --replicas=3 deployment/mysql\n```\n\n\n\n\n\n#### 重启\n\n```\nkubectl rollout restart deployment <deployment_name> -n <namespace>\n```\n\n\n\n#### 选择器\n\n--field-selector\n\n`status.podIP`\n\n```\ncs@debian:~/oss/hexo$  kubectl  get pod --field-selector status.podIP=121.21.35.3 -o wide -n devops\nNAME          READY   STATUS    RESTARTS   AGE   IP            NODE     NOMINATED NODE   READINESS GATES\nredis-app-1   1/1     Running   1          9d    121.21.35.3   node04   <none>           <none>\n```\n\n>1. metadata.name=my-service\n>2. metadata.namespace!=default\n>3. status.phase=Pending\n>\n>\n\n选择了所有**`status.phase`**不为**`Running`**且`spec.restartPolicy`为**`Always`**的Pod.\n\n```\nkubectl get pods --field-selector=status.phase!=Running,spec.restartPolicy=Always\n```\n\n\n\n#### events\n\n显示集群内的详细事件，如果最近出现故障，你可以查看集群事件以了解故障前后发生的情况。如果你知道只有特定名称空间中存在问题，你可以将事件过滤到该名称空间。\n\n```\n$ kubectl get events \nLAST SEEN   TYPE     REASON                    OBJECT     MESSAGE\n2d18h       Normal   Starting                  node/k8s   Starting kubelet.\n2d18h       Normal   NodeHasSufficientMemory   node/k8s   Node k8s status is now: NodeHasSufficientMemory\n2d18h       Normal   NodeHasNoDiskPressure     node/k8s   Node k8s status is now: NodeHasNoDiskPressure\n2d18h       Normal   NodeHasSufficientPID      node/k8s   Node k8s status is now: NodeHasSufficientPID\n2d18h       Normal   NodeAllocatableEnforced   node/k8s   Updated Node Allocatable limit across pods\n2d18h       Normal   Starting                  node/k8s   Starting kubelet.\n2d18h       Normal   NodeHasSufficientMemory   node/k8s   Node k8s status is now: NodeHasSufficientMemory\n2d18h       Normal   NodeHasNoDiskPressure     node/k8s   Node k8s status is now: NodeHasNoDiskPressure\n2d18h       Normal   NodeHasSufficientPID      node/k8s   Node k8s status is now: NodeHasSufficientPID\n2d18h       Normal   NodeAllocatableEnforced   node/k8s   Updated Node Allocatable limit across pods\n2d18h       Normal   NodeReady                 node/k8s   Node k8s status is now: NodeReady\n2d18h       Normal   RegisteredNode            node/k8s   Node k8s event: Registered Node k8s in Controller\n2d18h       Normal   Starting                  node/k8s   Starting kube-proxy.\n2d18h       Normal   RegisteredNode            node/k8s   Node k8s event: Registered Node k8s in Controller\n23m         Normal   Starting                  node/k8s   Starting kubelet.\n23m         Normal   NodeHasSufficientMemory   node/k8s   Node k8s status is now: NodeHasSufficientMemory\n23m         Normal   NodeHasNoDiskPressure     node/k8s   Node k8s status is now: NodeHasNoDiskPressure\n23m         Normal   NodeHasSufficientPID      node/k8s   Node k8s status is now: NodeHasSufficientPID\n23m         Normal   NodeAllocatableEnforced   node/k8s   Updated Node Allocatable limit across pods\n23m         Normal   Starting                  node/k8s   Starting kube-proxy.\n22m         Normal   RegisteredNode            node/k8s   Node k8s event: Registered Node k8s in Controller\n```\n\n\n\n#### api-resources\n\n```\nkubectl api-resources -o wide --sort-by name\n```\n\n\n\n#### 调试\n\n启动参数`--feature-gates=EphemeralContainers=true`配置到kube-api和kubelet服务上重启\n\n```\n# 查看pod所在宿主及pod name\n$ kubectl get po -o wide\n# 根据pod name查看对应的docker 容器\n$ docker ps | grep centos-687ff6c787-47gvh\n# 根据输出的容器id，挂载容器网络并运行一个debug容器，使用 nicolaka/netshoot 这个镜像。这个镜像里集成了很多网络调试工具。\n$ docker run -it --rm --name=debug --network=container:bb009aab414f nicolaka/netshoot bash\n接下来就进入了与这个pod的相同的网络namespace，可以进行网络相关的调试了\n```\n\n\n\n```\nfor pod in $(kubectl get -o name pod  -n kube-system); \ndo\n    kubectl debug --image security/pod_scanner -p $pod /sanner.sh\ndone\n```\n\n> 批量跑某个命名空间下的安全扫描的脚本而不用干扰原容器\n\n\n\n\n\n##### 没有开启Ephemeral Containers\n\n```\nkubectl debug mypod -it \\\n--container=debug \\\n--image=busybox \\\n--copy-to=my-debugger \\\n--same-node=true \\\n--share-processes=true\n```\n\n>--copy-to   指定新pod的名称\n>--replace=true   是否删除原容器\n>--same-node=true  是否调度到和原容器一样的node上\n>--share-processes=true  是否共享容器pid空间\n\n\n\n##### 利用Ephemeral Containers\n\n```\nkubectl run ephemeral-demo --image=k8s.gcr.io/pause:3.1 --restart=Never\n```\n\n\n\n```\nkubectl debug ephemeral-demo -it --image=busybox  --target=ephemeral-demo\n```\n\n> 容器运行时必须支持--target参数。 如果不支持，则临时容器可能不会启动，或者可能使用隔离的进程命名空间启动。\n\n\n\n```\nkubectl delete pod ephemeral-demo\n```\n\n##### nsenter\n\n```\n sudo yum install -y util-linux\n```\n\n\n\n```\n$ docker inspect -f {{.State.Pid}} nginx\n#nsenter命令进入该容器的网络命令空间\n$ nsenter -n -t6700\n```\n\n","source":"_posts/linux/k8s/k8s01.md","raw":"---\ntitle: k8s集群\npermalink: linux/k8s/k8s01/\ntags:\n  - kubernetes\n  - kubectl\ncategories:\n  - linux\n  - k8s\ndate: 2022-07-21 20:24:46\n---\n\n\n\n\n\n\n\n### 常用命令\n\n缩写\n\n```\ncertificatesigningrequests (缩写 csr)\ncomponentstatuses (缩写 cs)\nconfigmaps (缩写 cm)\ncustomresourcedefinition (缩写 crd)\ndaemonsets (缩写 ds)\ndeployments (缩写 deploy)\nendpoints (缩写 ep)\nevents (缩写 ev)\nhorizontalpodautoscalers (缩写 hpa)\ningresses (缩写 ing)\nlimitranges (缩写 limits)\nnamespaces (缩写 ns)\nnetworkpolicies (缩写 netpol)\nnodes (缩写 no)\npersistentvolumeclaims (缩写 pvc)\npersistentvolumes (缩写 pv)\npoddisruptionbudgets (缩写 pdb)\npods (缩写 po)\npodsecuritypolicies (缩写 psp)\nreplicasets (缩写 rs)\nreplicationcontrollers (缩写 rc)\nresourcequotas (缩写 quota)\nserviceaccounts (缩写 sa)\nservices (缩写 svc)\nstatefulsets (缩写 sts)\nstorageclasses (缩写 sc)\n```\n\n\n\n#### 自动补全\n\n```\nsudo apt install bash-completion\n\nsource /usr/share/bash-completion/bash_completion\nsource <(kubectl completion bash)\n\necho \"source <(kubectl completion bash)\" >> ~/.bashrc\n```\n\n\n\n#### cs(master节点)\n\ncomponentstatuses\n\n```\ncs@debian:~$ kubectl get cs\nNAME                 STATUS    MESSAGE              ERROR\nscheduler            Healthy   ok                   \ncontroller-manager   Healthy   ok                   \netcd-2               Healthy   {\"health\": \"true\"}   \netcd-0               Healthy   {\"health\": \"true\"}   \netcd-1               Healthy   {\"health\": \"true\"}  \n```\n\n\n\n#### node节点\n\n```\ncs@debian:~$ kubectl  get node\nNAME       STATUS   ROLES    AGE    VERSION\nmaster02   Ready    <none>   101d   v1.18.8\nmaster03   Ready    <none>   101d   v1.18.8\nnode04     Ready    <none>   101d   v1.18.8\nnode05     Ready    <none>   101d   v1.18.8\nnode06     Ready    <none>   101d   v1.18.8\n\nkubectl get node -o wide\n```\n\n<!--more-->\n\n空间\n\n```\ncs@debian:~$ kubectl get namespaces \nNAME                   STATUS   AGE\ndefault                Active   101d\ndevops                 Active   100d\nkube-node-lease        Active   101d\nkube-public            Active   101d\nkube-system            Active   101d\nkubernetes-dashboard   Active   92d\n```\n\n\n\n#### pod\n\n```\ncs@debian:~$ kubectl get pod\nNo resources found in default namespace.\n\ncs@debian:~$ kubectl get pod -n kube-system \nNAME                                         READY   STATUS    RESTARTS   AGE\ncoredns-56ff7bc666-prc6l                     1/1     Running   4          11d\ncoredns-56ff7bc666-qwdsh                     1/1     Running   8          92d\ntraefik-ingress-controller-7769cb875-x76rs   1/1     Running   1          46h\n```\n\n>-n  接namespaces的NAME值,省略为default\n\n\n\n```\nkubectl get pods -o wide\nkubectl get pods -A -o wide\n```\n\n\n\n\n\n#### describe\n\n ingress **Tab提示**\n\n```\ncs@debian:~$ kubectl get ingress -n devops \ningressclasses.networking.k8s.io      ingresses.networking.k8s.io           ingressroutetcps.traefik.containo.us  \ningresses.extensions                  ingressroutes.traefik.containo.us     ingressrouteudps.traefik.containo.us  \n\ncs@debian:~$ kubectl get ingressroutetcps.traefik.containo.us -n devops \nNAME    AGE\nredis   47h\n\ncs@debian:~$ kubectl describe ingressroutetcps.traefik.containo.us redis -n devops \nName:         redis\nNamespace:    devops\nLabels:       <none>\nAnnotations:  API Version:  traefik.containo.us/v1alpha1\nKind:         IngressRouteTCP\nMetadata:\n  Creation Timestamp:  2022-07-19T13:01:37Z\n  Generation:          1\n  Managed Fields:\n    API Version:  traefik.containo.us/v1alpha1\n    Fields Type:  FieldsV1\n    fieldsV1:\n      f:metadata:\n        f:annotations:\n          .:\n          f:kubectl.kubernetes.io/last-applied-configuration:\n      f:spec:\n        .:\n        f:entryPoints:\n        f:routes:\n    Manager:         kubectl\n    Operation:       Update\n    Time:            2022-07-19T13:01:37Z\n  Resource Version:  261095\n  Self Link:         /apis/traefik.containo.us/v1alpha1/namespaces/devops/ingressroutetcps/redis\n  UID:               c79681ee-1bf1-4843-9666-457970d78f27\nSpec:\n  Entry Points:\n    redis\n  Routes:\n    Match:  HostSNI(`*`)\n    Services:\n      Name:  redis-service\n      Port:  6379\nEvents:      <none>\n```\n\n\n\n\n\n#### log\n\n\n\n```\ncs@debian:~$ kubectl logs  --tail=5 redis-app-1 -n devops\n63:M 21 Jul 2022 12:15:34.720 * Synchronization with replica 121.21.25.3:6379 succeeded\n63:M 21 Jul 2022 12:15:36.469 # Cluster state changed: ok\n63:M 21 Jul 2022 12:15:40.604 * FAIL message received from 67f931358b8004268db0b57932293602ab3de629 about b49a123e2764b665ee898c21f983b9cda70cda00\n63:M 21 Jul 2022 12:15:42.635 * Marking node a0e2f50ba382870da1ce4d23b66a1375826d6dc8 as failing (quorum reached).\n63:M 21 Jul 2022 12:15:42.635 # Cluster state changed: fail\n\ncs@debian:~$ kubectl logs  -f  --tail=5 redis-app-1 -n devops\n63:M 21 Jul 2022 12:15:34.720 * Synchronization with replica 121.21.25.3:6379 succeeded\n63:M 21 Jul 2022 12:15:36.469 # Cluster state changed: ok\n63:M 21 Jul 2022 12:15:40.604 * FAIL message received from 67f931358b8004268db0b57932293602ab3de629 about b49a123e2764b665ee898c21f983b9cda70cda00\n63:M 21 Jul 2022 12:15:42.635 * Marking node a0e2f50ba382870da1ce4d23b66a1375826d6dc8 as failing (quorum reached).\n63:M 21 Jul 2022 12:15:42.635 # Cluster state changed: fail\n^C\n```\n\n>-f   类似 **tail -f** \n>\n>-p,  --previous[=false]: 如果为true，输出pod中曾经运行过，但目前已终止的容器的日志\n>       --since=0: 仅返回相对时间范围，如5s、2m或3h，之内的日志。默认返回所有日志。只能同时使用since 和since-time中的一种\n>      --since-time=\"\": 仅返回指定时间（RFC3339格式）之后的日志。默认返回所有日志。只能同时使用since和since-time中的一种\n>      --tail=-1: 要显示的最新的日志条数。默认为-1，显示所有的日志\n\n\n\n#### patch\n\n更新容器的镜像\n\n```\nkubectl patch pod valid-pod -p '{\"spec\":{\"containers\":[{\"name\":\"kubernetes-serve-hostname\",\"image\":\"new image\"}]}}'\n或\nkubectl patch pod valid-pod --type='json' -p='[{\"op\": \"replace\", \"path\": \"/spec/containers/0/image\", \"value\":\"new image\"}]'\n```\n\n设置服务对外的IP\n\n```\nkubectl patch svc <svc-name> -n <namespace> -p '{\"spec\": {\"type\": \"LoadBalancer\", \"externalIPs\":[\"192.168.31.241\"]}}'\n```\n\n\n\n#### scale\n\n对副本数进行扩展或缩小\n\n\n\n前提条件校验 ；当前副本数量或 `--resource-version`\n\n\n\n缩减副本数到2\n\n```\nkubectl scale rc rc-nginx-3 —replicas=2\n```\n\n\n\n当前副本数为2，则将其扩展至3\n\n```\nkubectl scale --current-replicas=2 --replicas=3 deployment/mysql\n```\n\n\n\n\n\n#### 重启\n\n```\nkubectl rollout restart deployment <deployment_name> -n <namespace>\n```\n\n\n\n#### 选择器\n\n--field-selector\n\n`status.podIP`\n\n```\ncs@debian:~/oss/hexo$  kubectl  get pod --field-selector status.podIP=121.21.35.3 -o wide -n devops\nNAME          READY   STATUS    RESTARTS   AGE   IP            NODE     NOMINATED NODE   READINESS GATES\nredis-app-1   1/1     Running   1          9d    121.21.35.3   node04   <none>           <none>\n```\n\n>1. metadata.name=my-service\n>2. metadata.namespace!=default\n>3. status.phase=Pending\n>\n>\n\n选择了所有**`status.phase`**不为**`Running`**且`spec.restartPolicy`为**`Always`**的Pod.\n\n```\nkubectl get pods --field-selector=status.phase!=Running,spec.restartPolicy=Always\n```\n\n\n\n#### events\n\n显示集群内的详细事件，如果最近出现故障，你可以查看集群事件以了解故障前后发生的情况。如果你知道只有特定名称空间中存在问题，你可以将事件过滤到该名称空间。\n\n```\n$ kubectl get events \nLAST SEEN   TYPE     REASON                    OBJECT     MESSAGE\n2d18h       Normal   Starting                  node/k8s   Starting kubelet.\n2d18h       Normal   NodeHasSufficientMemory   node/k8s   Node k8s status is now: NodeHasSufficientMemory\n2d18h       Normal   NodeHasNoDiskPressure     node/k8s   Node k8s status is now: NodeHasNoDiskPressure\n2d18h       Normal   NodeHasSufficientPID      node/k8s   Node k8s status is now: NodeHasSufficientPID\n2d18h       Normal   NodeAllocatableEnforced   node/k8s   Updated Node Allocatable limit across pods\n2d18h       Normal   Starting                  node/k8s   Starting kubelet.\n2d18h       Normal   NodeHasSufficientMemory   node/k8s   Node k8s status is now: NodeHasSufficientMemory\n2d18h       Normal   NodeHasNoDiskPressure     node/k8s   Node k8s status is now: NodeHasNoDiskPressure\n2d18h       Normal   NodeHasSufficientPID      node/k8s   Node k8s status is now: NodeHasSufficientPID\n2d18h       Normal   NodeAllocatableEnforced   node/k8s   Updated Node Allocatable limit across pods\n2d18h       Normal   NodeReady                 node/k8s   Node k8s status is now: NodeReady\n2d18h       Normal   RegisteredNode            node/k8s   Node k8s event: Registered Node k8s in Controller\n2d18h       Normal   Starting                  node/k8s   Starting kube-proxy.\n2d18h       Normal   RegisteredNode            node/k8s   Node k8s event: Registered Node k8s in Controller\n23m         Normal   Starting                  node/k8s   Starting kubelet.\n23m         Normal   NodeHasSufficientMemory   node/k8s   Node k8s status is now: NodeHasSufficientMemory\n23m         Normal   NodeHasNoDiskPressure     node/k8s   Node k8s status is now: NodeHasNoDiskPressure\n23m         Normal   NodeHasSufficientPID      node/k8s   Node k8s status is now: NodeHasSufficientPID\n23m         Normal   NodeAllocatableEnforced   node/k8s   Updated Node Allocatable limit across pods\n23m         Normal   Starting                  node/k8s   Starting kube-proxy.\n22m         Normal   RegisteredNode            node/k8s   Node k8s event: Registered Node k8s in Controller\n```\n\n\n\n#### api-resources\n\n```\nkubectl api-resources -o wide --sort-by name\n```\n\n\n\n#### 调试\n\n启动参数`--feature-gates=EphemeralContainers=true`配置到kube-api和kubelet服务上重启\n\n```\n# 查看pod所在宿主及pod name\n$ kubectl get po -o wide\n# 根据pod name查看对应的docker 容器\n$ docker ps | grep centos-687ff6c787-47gvh\n# 根据输出的容器id，挂载容器网络并运行一个debug容器，使用 nicolaka/netshoot 这个镜像。这个镜像里集成了很多网络调试工具。\n$ docker run -it --rm --name=debug --network=container:bb009aab414f nicolaka/netshoot bash\n接下来就进入了与这个pod的相同的网络namespace，可以进行网络相关的调试了\n```\n\n\n\n```\nfor pod in $(kubectl get -o name pod  -n kube-system); \ndo\n    kubectl debug --image security/pod_scanner -p $pod /sanner.sh\ndone\n```\n\n> 批量跑某个命名空间下的安全扫描的脚本而不用干扰原容器\n\n\n\n\n\n##### 没有开启Ephemeral Containers\n\n```\nkubectl debug mypod -it \\\n--container=debug \\\n--image=busybox \\\n--copy-to=my-debugger \\\n--same-node=true \\\n--share-processes=true\n```\n\n>--copy-to   指定新pod的名称\n>--replace=true   是否删除原容器\n>--same-node=true  是否调度到和原容器一样的node上\n>--share-processes=true  是否共享容器pid空间\n\n\n\n##### 利用Ephemeral Containers\n\n```\nkubectl run ephemeral-demo --image=k8s.gcr.io/pause:3.1 --restart=Never\n```\n\n\n\n```\nkubectl debug ephemeral-demo -it --image=busybox  --target=ephemeral-demo\n```\n\n> 容器运行时必须支持--target参数。 如果不支持，则临时容器可能不会启动，或者可能使用隔离的进程命名空间启动。\n\n\n\n```\nkubectl delete pod ephemeral-demo\n```\n\n##### nsenter\n\n```\n sudo yum install -y util-linux\n```\n\n\n\n```\n$ docker inspect -f {{.State.Pid}} nginx\n#nsenter命令进入该容器的网络命令空间\n$ nsenter -n -t6700\n```\n\n","slug":"linux/k8s/k8s01","published":1,"updated":"2022-08-28T09:10:00.940Z","__permalink":"linux/k8s/k8s01/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gttc0028gwi5gkq2ey3a","content":"<h3 id=\"常用命令\"><a href=\"#常用命令\" class=\"headerlink\" title=\"常用命令\"></a>常用命令</h3><p>缩写</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">certificatesigningrequests (缩写 csr)</span><br><span class=\"line\">componentstatuses (缩写 cs)</span><br><span class=\"line\">configmaps (缩写 cm)</span><br><span class=\"line\">customresourcedefinition (缩写 crd)</span><br><span class=\"line\">daemonsets (缩写 ds)</span><br><span class=\"line\">deployments (缩写 deploy)</span><br><span class=\"line\">endpoints (缩写 ep)</span><br><span class=\"line\">events (缩写 ev)</span><br><span class=\"line\">horizontalpodautoscalers (缩写 hpa)</span><br><span class=\"line\">ingresses (缩写 ing)</span><br><span class=\"line\">limitranges (缩写 limits)</span><br><span class=\"line\">namespaces (缩写 ns)</span><br><span class=\"line\">networkpolicies (缩写 netpol)</span><br><span class=\"line\">nodes (缩写 no)</span><br><span class=\"line\">persistentvolumeclaims (缩写 pvc)</span><br><span class=\"line\">persistentvolumes (缩写 pv)</span><br><span class=\"line\">poddisruptionbudgets (缩写 pdb)</span><br><span class=\"line\">pods (缩写 po)</span><br><span class=\"line\">podsecuritypolicies (缩写 psp)</span><br><span class=\"line\">replicasets (缩写 rs)</span><br><span class=\"line\">replicationcontrollers (缩写 rc)</span><br><span class=\"line\">resourcequotas (缩写 quota)</span><br><span class=\"line\">serviceaccounts (缩写 sa)</span><br><span class=\"line\">services (缩写 svc)</span><br><span class=\"line\">statefulsets (缩写 sts)</span><br><span class=\"line\">storageclasses (缩写 sc)</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"自动补全\"><a href=\"#自动补全\" class=\"headerlink\" title=\"自动补全\"></a>自动补全</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install bash-completion</span><br><span class=\"line\"></span><br><span class=\"line\">source /usr/share/bash-completion/bash_completion</span><br><span class=\"line\">source &lt;(kubectl completion bash)</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;source &lt;(kubectl completion bash)&quot; &gt;&gt; ~/.bashrc</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"cs-master节点\"><a href=\"#cs-master节点\" class=\"headerlink\" title=\"cs(master节点)\"></a>cs(master节点)</h4><p>componentstatuses</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ kubectl get cs</span><br><span class=\"line\">NAME                 STATUS    MESSAGE              ERROR</span><br><span class=\"line\">scheduler            Healthy   ok                   </span><br><span class=\"line\">controller-manager   Healthy   ok                   </span><br><span class=\"line\">etcd-2               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;   </span><br><span class=\"line\">etcd-0               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;   </span><br><span class=\"line\">etcd-1               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;  </span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"node节点\"><a href=\"#node节点\" class=\"headerlink\" title=\"node节点\"></a>node节点</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ kubectl  get node</span><br><span class=\"line\">NAME       STATUS   ROLES    AGE    VERSION</span><br><span class=\"line\">master02   Ready    &lt;none&gt;   101d   v1.18.8</span><br><span class=\"line\">master03   Ready    &lt;none&gt;   101d   v1.18.8</span><br><span class=\"line\">node04     Ready    &lt;none&gt;   101d   v1.18.8</span><br><span class=\"line\">node05     Ready    &lt;none&gt;   101d   v1.18.8</span><br><span class=\"line\">node06     Ready    &lt;none&gt;   101d   v1.18.8</span><br><span class=\"line\"></span><br><span class=\"line\">kubectl get node -o wide</span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n<p>空间</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ kubectl get namespaces </span><br><span class=\"line\">NAME                   STATUS   AGE</span><br><span class=\"line\">default                Active   101d</span><br><span class=\"line\">devops                 Active   100d</span><br><span class=\"line\">kube-node-lease        Active   101d</span><br><span class=\"line\">kube-public            Active   101d</span><br><span class=\"line\">kube-system            Active   101d</span><br><span class=\"line\">kubernetes-dashboard   Active   92d</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"pod\"><a href=\"#pod\" class=\"headerlink\" title=\"pod\"></a>pod</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ kubectl get pod</span><br><span class=\"line\">No resources found in default namespace.</span><br><span class=\"line\"></span><br><span class=\"line\">cs@debian:~$ kubectl get pod -n kube-system </span><br><span class=\"line\">NAME                                         READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">coredns-56ff7bc666-prc6l                     1/1     Running   4          11d</span><br><span class=\"line\">coredns-56ff7bc666-qwdsh                     1/1     Running   8          92d</span><br><span class=\"line\">traefik-ingress-controller-7769cb875-x76rs   1/1     Running   1          46h</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>-n  接namespaces的NAME值,省略为default</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get pods -o wide</span><br><span class=\"line\">kubectl get pods -A -o wide</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h4 id=\"describe\"><a href=\"#describe\" class=\"headerlink\" title=\"describe\"></a>describe</h4><p> ingress <strong>Tab提示</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ kubectl get ingress -n devops </span><br><span class=\"line\">ingressclasses.networking.k8s.io      ingresses.networking.k8s.io           ingressroutetcps.traefik.containo.us  </span><br><span class=\"line\">ingresses.extensions                  ingressroutes.traefik.containo.us     ingressrouteudps.traefik.containo.us  </span><br><span class=\"line\"></span><br><span class=\"line\">cs@debian:~$ kubectl get ingressroutetcps.traefik.containo.us -n devops </span><br><span class=\"line\">NAME    AGE</span><br><span class=\"line\">redis   47h</span><br><span class=\"line\"></span><br><span class=\"line\">cs@debian:~$ kubectl describe ingressroutetcps.traefik.containo.us redis -n devops </span><br><span class=\"line\">Name:         redis</span><br><span class=\"line\">Namespace:    devops</span><br><span class=\"line\">Labels:       &lt;none&gt;</span><br><span class=\"line\">Annotations:  API Version:  traefik.containo.us/v1alpha1</span><br><span class=\"line\">Kind:         IngressRouteTCP</span><br><span class=\"line\">Metadata:</span><br><span class=\"line\">  Creation Timestamp:  2022-07-19T13:01:37Z</span><br><span class=\"line\">  Generation:          1</span><br><span class=\"line\">  Managed Fields:</span><br><span class=\"line\">    API Version:  traefik.containo.us/v1alpha1</span><br><span class=\"line\">    Fields Type:  FieldsV1</span><br><span class=\"line\">    fieldsV1:</span><br><span class=\"line\">      f:metadata:</span><br><span class=\"line\">        f:annotations:</span><br><span class=\"line\">          .:</span><br><span class=\"line\">          f:kubectl.kubernetes.io/last-applied-configuration:</span><br><span class=\"line\">      f:spec:</span><br><span class=\"line\">        .:</span><br><span class=\"line\">        f:entryPoints:</span><br><span class=\"line\">        f:routes:</span><br><span class=\"line\">    Manager:         kubectl</span><br><span class=\"line\">    Operation:       Update</span><br><span class=\"line\">    Time:            2022-07-19T13:01:37Z</span><br><span class=\"line\">  Resource Version:  261095</span><br><span class=\"line\">  Self Link:         /apis/traefik.containo.us/v1alpha1/namespaces/devops/ingressroutetcps/redis</span><br><span class=\"line\">  UID:               c79681ee-1bf1-4843-9666-457970d78f27</span><br><span class=\"line\">Spec:</span><br><span class=\"line\">  Entry Points:</span><br><span class=\"line\">    redis</span><br><span class=\"line\">  Routes:</span><br><span class=\"line\">    Match:  HostSNI(`*`)</span><br><span class=\"line\">    Services:</span><br><span class=\"line\">      Name:  redis-service</span><br><span class=\"line\">      Port:  6379</span><br><span class=\"line\">Events:      &lt;none&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h4 id=\"log\"><a href=\"#log\" class=\"headerlink\" title=\"log\"></a>log</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ kubectl logs  --tail=5 redis-app-1 -n devops</span><br><span class=\"line\">63:M 21 Jul 2022 12:15:34.720 * Synchronization with replica 121.21.25.3:6379 succeeded</span><br><span class=\"line\">63:M 21 Jul 2022 12:15:36.469 # Cluster state changed: ok</span><br><span class=\"line\">63:M 21 Jul 2022 12:15:40.604 * FAIL message received from 67f931358b8004268db0b57932293602ab3de629 about b49a123e2764b665ee898c21f983b9cda70cda00</span><br><span class=\"line\">63:M 21 Jul 2022 12:15:42.635 * Marking node a0e2f50ba382870da1ce4d23b66a1375826d6dc8 as failing (quorum reached).</span><br><span class=\"line\">63:M 21 Jul 2022 12:15:42.635 # Cluster state changed: fail</span><br><span class=\"line\"></span><br><span class=\"line\">cs@debian:~$ kubectl logs  -f  --tail=5 redis-app-1 -n devops</span><br><span class=\"line\">63:M 21 Jul 2022 12:15:34.720 * Synchronization with replica 121.21.25.3:6379 succeeded</span><br><span class=\"line\">63:M 21 Jul 2022 12:15:36.469 # Cluster state changed: ok</span><br><span class=\"line\">63:M 21 Jul 2022 12:15:40.604 * FAIL message received from 67f931358b8004268db0b57932293602ab3de629 about b49a123e2764b665ee898c21f983b9cda70cda00</span><br><span class=\"line\">63:M 21 Jul 2022 12:15:42.635 * Marking node a0e2f50ba382870da1ce4d23b66a1375826d6dc8 as failing (quorum reached).</span><br><span class=\"line\">63:M 21 Jul 2022 12:15:42.635 # Cluster state changed: fail</span><br><span class=\"line\">^C</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>-f   类似 <strong>tail -f</strong> </p>\n<p>-p,  –previous[&#x3D;false]: 如果为true，输出pod中曾经运行过，但目前已终止的容器的日志<br>      –since&#x3D;0: 仅返回相对时间范围，如5s、2m或3h，之内的日志。默认返回所有日志。只能同时使用since 和since-time中的一种<br>     –since-time&#x3D;””: 仅返回指定时间（RFC3339格式）之后的日志。默认返回所有日志。只能同时使用since和since-time中的一种<br>     –tail&#x3D;-1: 要显示的最新的日志条数。默认为-1，显示所有的日志</p>\n</blockquote>\n<h4 id=\"patch\"><a href=\"#patch\" class=\"headerlink\" title=\"patch\"></a>patch</h4><p>更新容器的镜像</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl patch pod valid-pod -p &#x27;&#123;&quot;spec&quot;:&#123;&quot;containers&quot;:[&#123;&quot;name&quot;:&quot;kubernetes-serve-hostname&quot;,&quot;image&quot;:&quot;new image&quot;&#125;]&#125;&#125;&#x27;</span><br><span class=\"line\">或</span><br><span class=\"line\">kubectl patch pod valid-pod --type=&#x27;json&#x27; -p=&#x27;[&#123;&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/spec/containers/0/image&quot;, &quot;value&quot;:&quot;new image&quot;&#125;]&#x27;</span><br></pre></td></tr></table></figure>\n\n<p>设置服务对外的IP</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl patch svc &lt;svc-name&gt; -n &lt;namespace&gt; -p &#x27;&#123;&quot;spec&quot;: &#123;&quot;type&quot;: &quot;LoadBalancer&quot;, &quot;externalIPs&quot;:[&quot;192.168.31.241&quot;]&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"scale\"><a href=\"#scale\" class=\"headerlink\" title=\"scale\"></a>scale</h4><p>对副本数进行扩展或缩小</p>\n<p>前提条件校验 ；当前副本数量或 <code>--resource-version</code></p>\n<p>缩减副本数到2</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl scale rc rc-nginx-3 —replicas=2</span><br></pre></td></tr></table></figure>\n\n\n\n<p>当前副本数为2，则将其扩展至3</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl scale --current-replicas=2 --replicas=3 deployment/mysql</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h4 id=\"重启\"><a href=\"#重启\" class=\"headerlink\" title=\"重启\"></a>重启</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl rollout restart deployment &lt;deployment_name&gt; -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"选择器\"><a href=\"#选择器\" class=\"headerlink\" title=\"选择器\"></a>选择器</h4><p>–field-selector</p>\n<p><code>status.podIP</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/hexo$  kubectl  get pod --field-selector status.podIP=121.21.35.3 -o wide -n devops</span><br><span class=\"line\">NAME          READY   STATUS    RESTARTS   AGE   IP            NODE     NOMINATED NODE   READINESS GATES</span><br><span class=\"line\">redis-app-1   1/1     Running   1          9d    121.21.35.3   node04   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<ol>\n<li>metadata.name&#x3D;my-service</li>\n<li>metadata.namespace!&#x3D;default</li>\n<li>status.phase&#x3D;Pending</li>\n</ol>\n</blockquote>\n<p>选择了所有**<code>status.phase</code><strong>不为</strong><code>Running</code><strong>且<code>spec.restartPolicy</code>为</strong><code>Always</code>**的Pod.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get pods --field-selector=status.phase!=Running,spec.restartPolicy=Always</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"events\"><a href=\"#events\" class=\"headerlink\" title=\"events\"></a>events</h4><p>显示集群内的详细事件，如果最近出现故障，你可以查看集群事件以了解故障前后发生的情况。如果你知道只有特定名称空间中存在问题，你可以将事件过滤到该名称空间。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl get events </span><br><span class=\"line\">LAST SEEN   TYPE     REASON                    OBJECT     MESSAGE</span><br><span class=\"line\">2d18h       Normal   Starting                  node/k8s   Starting kubelet.</span><br><span class=\"line\">2d18h       Normal   NodeHasSufficientMemory   node/k8s   Node k8s status is now: NodeHasSufficientMemory</span><br><span class=\"line\">2d18h       Normal   NodeHasNoDiskPressure     node/k8s   Node k8s status is now: NodeHasNoDiskPressure</span><br><span class=\"line\">2d18h       Normal   NodeHasSufficientPID      node/k8s   Node k8s status is now: NodeHasSufficientPID</span><br><span class=\"line\">2d18h       Normal   NodeAllocatableEnforced   node/k8s   Updated Node Allocatable limit across pods</span><br><span class=\"line\">2d18h       Normal   Starting                  node/k8s   Starting kubelet.</span><br><span class=\"line\">2d18h       Normal   NodeHasSufficientMemory   node/k8s   Node k8s status is now: NodeHasSufficientMemory</span><br><span class=\"line\">2d18h       Normal   NodeHasNoDiskPressure     node/k8s   Node k8s status is now: NodeHasNoDiskPressure</span><br><span class=\"line\">2d18h       Normal   NodeHasSufficientPID      node/k8s   Node k8s status is now: NodeHasSufficientPID</span><br><span class=\"line\">2d18h       Normal   NodeAllocatableEnforced   node/k8s   Updated Node Allocatable limit across pods</span><br><span class=\"line\">2d18h       Normal   NodeReady                 node/k8s   Node k8s status is now: NodeReady</span><br><span class=\"line\">2d18h       Normal   RegisteredNode            node/k8s   Node k8s event: Registered Node k8s in Controller</span><br><span class=\"line\">2d18h       Normal   Starting                  node/k8s   Starting kube-proxy.</span><br><span class=\"line\">2d18h       Normal   RegisteredNode            node/k8s   Node k8s event: Registered Node k8s in Controller</span><br><span class=\"line\">23m         Normal   Starting                  node/k8s   Starting kubelet.</span><br><span class=\"line\">23m         Normal   NodeHasSufficientMemory   node/k8s   Node k8s status is now: NodeHasSufficientMemory</span><br><span class=\"line\">23m         Normal   NodeHasNoDiskPressure     node/k8s   Node k8s status is now: NodeHasNoDiskPressure</span><br><span class=\"line\">23m         Normal   NodeHasSufficientPID      node/k8s   Node k8s status is now: NodeHasSufficientPID</span><br><span class=\"line\">23m         Normal   NodeAllocatableEnforced   node/k8s   Updated Node Allocatable limit across pods</span><br><span class=\"line\">23m         Normal   Starting                  node/k8s   Starting kube-proxy.</span><br><span class=\"line\">22m         Normal   RegisteredNode            node/k8s   Node k8s event: Registered Node k8s in Controller</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"api-resources\"><a href=\"#api-resources\" class=\"headerlink\" title=\"api-resources\"></a>api-resources</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl api-resources -o wide --sort-by name</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"调试\"><a href=\"#调试\" class=\"headerlink\" title=\"调试\"></a>调试</h4><p>启动参数<code>--feature-gates=EphemeralContainers=true</code>配置到kube-api和kubelet服务上重启</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 查看pod所在宿主及pod name</span><br><span class=\"line\">$ kubectl get po -o wide</span><br><span class=\"line\"># 根据pod name查看对应的docker 容器</span><br><span class=\"line\">$ docker ps | grep centos-687ff6c787-47gvh</span><br><span class=\"line\"># 根据输出的容器id，挂载容器网络并运行一个debug容器，使用 nicolaka/netshoot 这个镜像。这个镜像里集成了很多网络调试工具。</span><br><span class=\"line\">$ docker run -it --rm --name=debug --network=container:bb009aab414f nicolaka/netshoot bash</span><br><span class=\"line\">接下来就进入了与这个pod的相同的网络namespace，可以进行网络相关的调试了</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for pod in $(kubectl get -o name pod  -n kube-system); </span><br><span class=\"line\">do</span><br><span class=\"line\">    kubectl debug --image security/pod_scanner -p $pod /sanner.sh</span><br><span class=\"line\">done</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>批量跑某个命名空间下的安全扫描的脚本而不用干扰原容器</p>\n</blockquote>\n<h5 id=\"没有开启Ephemeral-Containers\"><a href=\"#没有开启Ephemeral-Containers\" class=\"headerlink\" title=\"没有开启Ephemeral Containers\"></a>没有开启Ephemeral Containers</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl debug mypod -it \\</span><br><span class=\"line\">--container=debug \\</span><br><span class=\"line\">--image=busybox \\</span><br><span class=\"line\">--copy-to=my-debugger \\</span><br><span class=\"line\">--same-node=true \\</span><br><span class=\"line\">--share-processes=true</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>–copy-to   指定新pod的名称<br>–replace&#x3D;true   是否删除原容器<br>–same-node&#x3D;true  是否调度到和原容器一样的node上<br>–share-processes&#x3D;true  是否共享容器pid空间</p>\n</blockquote>\n<h5 id=\"利用Ephemeral-Containers\"><a href=\"#利用Ephemeral-Containers\" class=\"headerlink\" title=\"利用Ephemeral Containers\"></a>利用Ephemeral Containers</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl run ephemeral-demo --image=k8s.gcr.io/pause:3.1 --restart=Never</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl debug ephemeral-demo -it --image=busybox  --target=ephemeral-demo</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>容器运行时必须支持–target参数。 如果不支持，则临时容器可能不会启动，或者可能使用隔离的进程命名空间启动。</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete pod ephemeral-demo</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"nsenter\"><a href=\"#nsenter\" class=\"headerlink\" title=\"nsenter\"></a>nsenter</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum install -y util-linux</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ docker inspect -f &#123;&#123;.State.Pid&#125;&#125; nginx</span><br><span class=\"line\">#nsenter命令进入该容器的网络命令空间</span><br><span class=\"line\">$ nsenter -n -t6700</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h3 id=\"常用命令\"><a href=\"#常用命令\" class=\"headerlink\" title=\"常用命令\"></a>常用命令</h3><p>缩写</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">certificatesigningrequests (缩写 csr)</span><br><span class=\"line\">componentstatuses (缩写 cs)</span><br><span class=\"line\">configmaps (缩写 cm)</span><br><span class=\"line\">customresourcedefinition (缩写 crd)</span><br><span class=\"line\">daemonsets (缩写 ds)</span><br><span class=\"line\">deployments (缩写 deploy)</span><br><span class=\"line\">endpoints (缩写 ep)</span><br><span class=\"line\">events (缩写 ev)</span><br><span class=\"line\">horizontalpodautoscalers (缩写 hpa)</span><br><span class=\"line\">ingresses (缩写 ing)</span><br><span class=\"line\">limitranges (缩写 limits)</span><br><span class=\"line\">namespaces (缩写 ns)</span><br><span class=\"line\">networkpolicies (缩写 netpol)</span><br><span class=\"line\">nodes (缩写 no)</span><br><span class=\"line\">persistentvolumeclaims (缩写 pvc)</span><br><span class=\"line\">persistentvolumes (缩写 pv)</span><br><span class=\"line\">poddisruptionbudgets (缩写 pdb)</span><br><span class=\"line\">pods (缩写 po)</span><br><span class=\"line\">podsecuritypolicies (缩写 psp)</span><br><span class=\"line\">replicasets (缩写 rs)</span><br><span class=\"line\">replicationcontrollers (缩写 rc)</span><br><span class=\"line\">resourcequotas (缩写 quota)</span><br><span class=\"line\">serviceaccounts (缩写 sa)</span><br><span class=\"line\">services (缩写 svc)</span><br><span class=\"line\">statefulsets (缩写 sts)</span><br><span class=\"line\">storageclasses (缩写 sc)</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"自动补全\"><a href=\"#自动补全\" class=\"headerlink\" title=\"自动补全\"></a>自动补全</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install bash-completion</span><br><span class=\"line\"></span><br><span class=\"line\">source /usr/share/bash-completion/bash_completion</span><br><span class=\"line\">source &lt;(kubectl completion bash)</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;source &lt;(kubectl completion bash)&quot; &gt;&gt; ~/.bashrc</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"cs-master节点\"><a href=\"#cs-master节点\" class=\"headerlink\" title=\"cs(master节点)\"></a>cs(master节点)</h4><p>componentstatuses</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ kubectl get cs</span><br><span class=\"line\">NAME                 STATUS    MESSAGE              ERROR</span><br><span class=\"line\">scheduler            Healthy   ok                   </span><br><span class=\"line\">controller-manager   Healthy   ok                   </span><br><span class=\"line\">etcd-2               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;   </span><br><span class=\"line\">etcd-0               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;   </span><br><span class=\"line\">etcd-1               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;  </span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"node节点\"><a href=\"#node节点\" class=\"headerlink\" title=\"node节点\"></a>node节点</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ kubectl  get node</span><br><span class=\"line\">NAME       STATUS   ROLES    AGE    VERSION</span><br><span class=\"line\">master02   Ready    &lt;none&gt;   101d   v1.18.8</span><br><span class=\"line\">master03   Ready    &lt;none&gt;   101d   v1.18.8</span><br><span class=\"line\">node04     Ready    &lt;none&gt;   101d   v1.18.8</span><br><span class=\"line\">node05     Ready    &lt;none&gt;   101d   v1.18.8</span><br><span class=\"line\">node06     Ready    &lt;none&gt;   101d   v1.18.8</span><br><span class=\"line\"></span><br><span class=\"line\">kubectl get node -o wide</span><br></pre></td></tr></table></figure>","more":"<p>空间</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ kubectl get namespaces </span><br><span class=\"line\">NAME                   STATUS   AGE</span><br><span class=\"line\">default                Active   101d</span><br><span class=\"line\">devops                 Active   100d</span><br><span class=\"line\">kube-node-lease        Active   101d</span><br><span class=\"line\">kube-public            Active   101d</span><br><span class=\"line\">kube-system            Active   101d</span><br><span class=\"line\">kubernetes-dashboard   Active   92d</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"pod\"><a href=\"#pod\" class=\"headerlink\" title=\"pod\"></a>pod</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ kubectl get pod</span><br><span class=\"line\">No resources found in default namespace.</span><br><span class=\"line\"></span><br><span class=\"line\">cs@debian:~$ kubectl get pod -n kube-system </span><br><span class=\"line\">NAME                                         READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">coredns-56ff7bc666-prc6l                     1/1     Running   4          11d</span><br><span class=\"line\">coredns-56ff7bc666-qwdsh                     1/1     Running   8          92d</span><br><span class=\"line\">traefik-ingress-controller-7769cb875-x76rs   1/1     Running   1          46h</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>-n  接namespaces的NAME值,省略为default</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get pods -o wide</span><br><span class=\"line\">kubectl get pods -A -o wide</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h4 id=\"describe\"><a href=\"#describe\" class=\"headerlink\" title=\"describe\"></a>describe</h4><p> ingress <strong>Tab提示</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ kubectl get ingress -n devops </span><br><span class=\"line\">ingressclasses.networking.k8s.io      ingresses.networking.k8s.io           ingressroutetcps.traefik.containo.us  </span><br><span class=\"line\">ingresses.extensions                  ingressroutes.traefik.containo.us     ingressrouteudps.traefik.containo.us  </span><br><span class=\"line\"></span><br><span class=\"line\">cs@debian:~$ kubectl get ingressroutetcps.traefik.containo.us -n devops </span><br><span class=\"line\">NAME    AGE</span><br><span class=\"line\">redis   47h</span><br><span class=\"line\"></span><br><span class=\"line\">cs@debian:~$ kubectl describe ingressroutetcps.traefik.containo.us redis -n devops </span><br><span class=\"line\">Name:         redis</span><br><span class=\"line\">Namespace:    devops</span><br><span class=\"line\">Labels:       &lt;none&gt;</span><br><span class=\"line\">Annotations:  API Version:  traefik.containo.us/v1alpha1</span><br><span class=\"line\">Kind:         IngressRouteTCP</span><br><span class=\"line\">Metadata:</span><br><span class=\"line\">  Creation Timestamp:  2022-07-19T13:01:37Z</span><br><span class=\"line\">  Generation:          1</span><br><span class=\"line\">  Managed Fields:</span><br><span class=\"line\">    API Version:  traefik.containo.us/v1alpha1</span><br><span class=\"line\">    Fields Type:  FieldsV1</span><br><span class=\"line\">    fieldsV1:</span><br><span class=\"line\">      f:metadata:</span><br><span class=\"line\">        f:annotations:</span><br><span class=\"line\">          .:</span><br><span class=\"line\">          f:kubectl.kubernetes.io/last-applied-configuration:</span><br><span class=\"line\">      f:spec:</span><br><span class=\"line\">        .:</span><br><span class=\"line\">        f:entryPoints:</span><br><span class=\"line\">        f:routes:</span><br><span class=\"line\">    Manager:         kubectl</span><br><span class=\"line\">    Operation:       Update</span><br><span class=\"line\">    Time:            2022-07-19T13:01:37Z</span><br><span class=\"line\">  Resource Version:  261095</span><br><span class=\"line\">  Self Link:         /apis/traefik.containo.us/v1alpha1/namespaces/devops/ingressroutetcps/redis</span><br><span class=\"line\">  UID:               c79681ee-1bf1-4843-9666-457970d78f27</span><br><span class=\"line\">Spec:</span><br><span class=\"line\">  Entry Points:</span><br><span class=\"line\">    redis</span><br><span class=\"line\">  Routes:</span><br><span class=\"line\">    Match:  HostSNI(`*`)</span><br><span class=\"line\">    Services:</span><br><span class=\"line\">      Name:  redis-service</span><br><span class=\"line\">      Port:  6379</span><br><span class=\"line\">Events:      &lt;none&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h4 id=\"log\"><a href=\"#log\" class=\"headerlink\" title=\"log\"></a>log</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ kubectl logs  --tail=5 redis-app-1 -n devops</span><br><span class=\"line\">63:M 21 Jul 2022 12:15:34.720 * Synchronization with replica 121.21.25.3:6379 succeeded</span><br><span class=\"line\">63:M 21 Jul 2022 12:15:36.469 # Cluster state changed: ok</span><br><span class=\"line\">63:M 21 Jul 2022 12:15:40.604 * FAIL message received from 67f931358b8004268db0b57932293602ab3de629 about b49a123e2764b665ee898c21f983b9cda70cda00</span><br><span class=\"line\">63:M 21 Jul 2022 12:15:42.635 * Marking node a0e2f50ba382870da1ce4d23b66a1375826d6dc8 as failing (quorum reached).</span><br><span class=\"line\">63:M 21 Jul 2022 12:15:42.635 # Cluster state changed: fail</span><br><span class=\"line\"></span><br><span class=\"line\">cs@debian:~$ kubectl logs  -f  --tail=5 redis-app-1 -n devops</span><br><span class=\"line\">63:M 21 Jul 2022 12:15:34.720 * Synchronization with replica 121.21.25.3:6379 succeeded</span><br><span class=\"line\">63:M 21 Jul 2022 12:15:36.469 # Cluster state changed: ok</span><br><span class=\"line\">63:M 21 Jul 2022 12:15:40.604 * FAIL message received from 67f931358b8004268db0b57932293602ab3de629 about b49a123e2764b665ee898c21f983b9cda70cda00</span><br><span class=\"line\">63:M 21 Jul 2022 12:15:42.635 * Marking node a0e2f50ba382870da1ce4d23b66a1375826d6dc8 as failing (quorum reached).</span><br><span class=\"line\">63:M 21 Jul 2022 12:15:42.635 # Cluster state changed: fail</span><br><span class=\"line\">^C</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>-f   类似 <strong>tail -f</strong> </p>\n<p>-p,  –previous[&#x3D;false]: 如果为true，输出pod中曾经运行过，但目前已终止的容器的日志<br>      –since&#x3D;0: 仅返回相对时间范围，如5s、2m或3h，之内的日志。默认返回所有日志。只能同时使用since 和since-time中的一种<br>     –since-time&#x3D;””: 仅返回指定时间（RFC3339格式）之后的日志。默认返回所有日志。只能同时使用since和since-time中的一种<br>     –tail&#x3D;-1: 要显示的最新的日志条数。默认为-1，显示所有的日志</p>\n</blockquote>\n<h4 id=\"patch\"><a href=\"#patch\" class=\"headerlink\" title=\"patch\"></a>patch</h4><p>更新容器的镜像</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl patch pod valid-pod -p &#x27;&#123;&quot;spec&quot;:&#123;&quot;containers&quot;:[&#123;&quot;name&quot;:&quot;kubernetes-serve-hostname&quot;,&quot;image&quot;:&quot;new image&quot;&#125;]&#125;&#125;&#x27;</span><br><span class=\"line\">或</span><br><span class=\"line\">kubectl patch pod valid-pod --type=&#x27;json&#x27; -p=&#x27;[&#123;&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/spec/containers/0/image&quot;, &quot;value&quot;:&quot;new image&quot;&#125;]&#x27;</span><br></pre></td></tr></table></figure>\n\n<p>设置服务对外的IP</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl patch svc &lt;svc-name&gt; -n &lt;namespace&gt; -p &#x27;&#123;&quot;spec&quot;: &#123;&quot;type&quot;: &quot;LoadBalancer&quot;, &quot;externalIPs&quot;:[&quot;192.168.31.241&quot;]&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"scale\"><a href=\"#scale\" class=\"headerlink\" title=\"scale\"></a>scale</h4><p>对副本数进行扩展或缩小</p>\n<p>前提条件校验 ；当前副本数量或 <code>--resource-version</code></p>\n<p>缩减副本数到2</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl scale rc rc-nginx-3 —replicas=2</span><br></pre></td></tr></table></figure>\n\n\n\n<p>当前副本数为2，则将其扩展至3</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl scale --current-replicas=2 --replicas=3 deployment/mysql</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h4 id=\"重启\"><a href=\"#重启\" class=\"headerlink\" title=\"重启\"></a>重启</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl rollout restart deployment &lt;deployment_name&gt; -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"选择器\"><a href=\"#选择器\" class=\"headerlink\" title=\"选择器\"></a>选择器</h4><p>–field-selector</p>\n<p><code>status.podIP</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/hexo$  kubectl  get pod --field-selector status.podIP=121.21.35.3 -o wide -n devops</span><br><span class=\"line\">NAME          READY   STATUS    RESTARTS   AGE   IP            NODE     NOMINATED NODE   READINESS GATES</span><br><span class=\"line\">redis-app-1   1/1     Running   1          9d    121.21.35.3   node04   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<ol>\n<li>metadata.name&#x3D;my-service</li>\n<li>metadata.namespace!&#x3D;default</li>\n<li>status.phase&#x3D;Pending</li>\n</ol>\n</blockquote>\n<p>选择了所有**<code>status.phase</code><strong>不为</strong><code>Running</code><strong>且<code>spec.restartPolicy</code>为</strong><code>Always</code>**的Pod.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get pods --field-selector=status.phase!=Running,spec.restartPolicy=Always</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"events\"><a href=\"#events\" class=\"headerlink\" title=\"events\"></a>events</h4><p>显示集群内的详细事件，如果最近出现故障，你可以查看集群事件以了解故障前后发生的情况。如果你知道只有特定名称空间中存在问题，你可以将事件过滤到该名称空间。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl get events </span><br><span class=\"line\">LAST SEEN   TYPE     REASON                    OBJECT     MESSAGE</span><br><span class=\"line\">2d18h       Normal   Starting                  node/k8s   Starting kubelet.</span><br><span class=\"line\">2d18h       Normal   NodeHasSufficientMemory   node/k8s   Node k8s status is now: NodeHasSufficientMemory</span><br><span class=\"line\">2d18h       Normal   NodeHasNoDiskPressure     node/k8s   Node k8s status is now: NodeHasNoDiskPressure</span><br><span class=\"line\">2d18h       Normal   NodeHasSufficientPID      node/k8s   Node k8s status is now: NodeHasSufficientPID</span><br><span class=\"line\">2d18h       Normal   NodeAllocatableEnforced   node/k8s   Updated Node Allocatable limit across pods</span><br><span class=\"line\">2d18h       Normal   Starting                  node/k8s   Starting kubelet.</span><br><span class=\"line\">2d18h       Normal   NodeHasSufficientMemory   node/k8s   Node k8s status is now: NodeHasSufficientMemory</span><br><span class=\"line\">2d18h       Normal   NodeHasNoDiskPressure     node/k8s   Node k8s status is now: NodeHasNoDiskPressure</span><br><span class=\"line\">2d18h       Normal   NodeHasSufficientPID      node/k8s   Node k8s status is now: NodeHasSufficientPID</span><br><span class=\"line\">2d18h       Normal   NodeAllocatableEnforced   node/k8s   Updated Node Allocatable limit across pods</span><br><span class=\"line\">2d18h       Normal   NodeReady                 node/k8s   Node k8s status is now: NodeReady</span><br><span class=\"line\">2d18h       Normal   RegisteredNode            node/k8s   Node k8s event: Registered Node k8s in Controller</span><br><span class=\"line\">2d18h       Normal   Starting                  node/k8s   Starting kube-proxy.</span><br><span class=\"line\">2d18h       Normal   RegisteredNode            node/k8s   Node k8s event: Registered Node k8s in Controller</span><br><span class=\"line\">23m         Normal   Starting                  node/k8s   Starting kubelet.</span><br><span class=\"line\">23m         Normal   NodeHasSufficientMemory   node/k8s   Node k8s status is now: NodeHasSufficientMemory</span><br><span class=\"line\">23m         Normal   NodeHasNoDiskPressure     node/k8s   Node k8s status is now: NodeHasNoDiskPressure</span><br><span class=\"line\">23m         Normal   NodeHasSufficientPID      node/k8s   Node k8s status is now: NodeHasSufficientPID</span><br><span class=\"line\">23m         Normal   NodeAllocatableEnforced   node/k8s   Updated Node Allocatable limit across pods</span><br><span class=\"line\">23m         Normal   Starting                  node/k8s   Starting kube-proxy.</span><br><span class=\"line\">22m         Normal   RegisteredNode            node/k8s   Node k8s event: Registered Node k8s in Controller</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"api-resources\"><a href=\"#api-resources\" class=\"headerlink\" title=\"api-resources\"></a>api-resources</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl api-resources -o wide --sort-by name</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"调试\"><a href=\"#调试\" class=\"headerlink\" title=\"调试\"></a>调试</h4><p>启动参数<code>--feature-gates=EphemeralContainers=true</code>配置到kube-api和kubelet服务上重启</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 查看pod所在宿主及pod name</span><br><span class=\"line\">$ kubectl get po -o wide</span><br><span class=\"line\"># 根据pod name查看对应的docker 容器</span><br><span class=\"line\">$ docker ps | grep centos-687ff6c787-47gvh</span><br><span class=\"line\"># 根据输出的容器id，挂载容器网络并运行一个debug容器，使用 nicolaka/netshoot 这个镜像。这个镜像里集成了很多网络调试工具。</span><br><span class=\"line\">$ docker run -it --rm --name=debug --network=container:bb009aab414f nicolaka/netshoot bash</span><br><span class=\"line\">接下来就进入了与这个pod的相同的网络namespace，可以进行网络相关的调试了</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for pod in $(kubectl get -o name pod  -n kube-system); </span><br><span class=\"line\">do</span><br><span class=\"line\">    kubectl debug --image security/pod_scanner -p $pod /sanner.sh</span><br><span class=\"line\">done</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>批量跑某个命名空间下的安全扫描的脚本而不用干扰原容器</p>\n</blockquote>\n<h5 id=\"没有开启Ephemeral-Containers\"><a href=\"#没有开启Ephemeral-Containers\" class=\"headerlink\" title=\"没有开启Ephemeral Containers\"></a>没有开启Ephemeral Containers</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl debug mypod -it \\</span><br><span class=\"line\">--container=debug \\</span><br><span class=\"line\">--image=busybox \\</span><br><span class=\"line\">--copy-to=my-debugger \\</span><br><span class=\"line\">--same-node=true \\</span><br><span class=\"line\">--share-processes=true</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>–copy-to   指定新pod的名称<br>–replace&#x3D;true   是否删除原容器<br>–same-node&#x3D;true  是否调度到和原容器一样的node上<br>–share-processes&#x3D;true  是否共享容器pid空间</p>\n</blockquote>\n<h5 id=\"利用Ephemeral-Containers\"><a href=\"#利用Ephemeral-Containers\" class=\"headerlink\" title=\"利用Ephemeral Containers\"></a>利用Ephemeral Containers</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl run ephemeral-demo --image=k8s.gcr.io/pause:3.1 --restart=Never</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl debug ephemeral-demo -it --image=busybox  --target=ephemeral-demo</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>容器运行时必须支持–target参数。 如果不支持，则临时容器可能不会启动，或者可能使用隔离的进程命名空间启动。</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl delete pod ephemeral-demo</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"nsenter\"><a href=\"#nsenter\" class=\"headerlink\" title=\"nsenter\"></a>nsenter</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum install -y util-linux</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ docker inspect -f &#123;&#123;.State.Pid&#125;&#125; nginx</span><br><span class=\"line\">#nsenter命令进入该容器的网络命令空间</span><br><span class=\"line\">$ nsenter -n -t6700</span><br></pre></td></tr></table></figure>"},{"title":"kubeadm容器化安装","date":"2022-08-07T12:18:14.000Z","_content":"\n### docker\n\n#### daemon.json\n\n```shell\n[vagrant@k8s ~]$ sudo vi /etc/docker/daemon.json\n[vagrant@k8s ~]$ docker info | grep Driver\nStorage Driver: overlay2\nLogging Driver: json-file\nCgroup Driver: cgroupfs\n[vagrant@k8s ~]$ sudo systemctl restart docker \n[vagrant@k8s ~]$ docker info | grep Driver\nStorage Driver: overlay2\nLogging Driver: json-file\nCgroup Driver: systemd\n[vagrant@k8s ~]$ sudo cat  /etc/docker/daemon.json\n{\n \"exec-opts\": [\"native.cgroupdriver=systemd\"],\n \"insecure-registries\":[\"https://k8s.org\"]\n\n}\n```\n\n>\"exec-opts\": [\"native.cgroupdriver=systemd\"]\n\n Error response from daemon: OCI runtime create failed: systemd cgroup flag passed, but systemd support for managing cgroups is not available\n\n\n\n/etc/sysconfig/modules/ipvs.modules\n\n```\ncat > /etc/sysconfig/modules/ipvs.modules <<EOF\n#!/bin/bash\nmodprobe -- br_netfilter\nmodprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- nf_conntrack_ipv4\nEOF\nchmod 755 /etc/sysconfig/modules/ipvs.modules\n```\n\n\n\n```\n cat  /etc/sysctl.conf\nnet.ipv4.vs.conntrack=1\nnet.ipv4.vs.conn_reuse_mode=0\nnet.ipv4.vs.expire_nodest_conn=1\n```\n\n\n\n\n\n### 准备images list\n\n```\n./kubeadm config images list\nI0809 21:56:57.334915    4785 version.go:254] remote version is much newer: v1.24.3; falling back to: stable-1.21\nk8s.gcr.io/kube-apiserver:v1.21.14\nk8s.gcr.io/kube-controller-manager:v1.21.14\nk8s.gcr.io/kube-scheduler:v1.21.14\nk8s.gcr.io/kube-proxy:v1.21.14\nk8s.gcr.io/pause:3.4.1\nk8s.gcr.io/etcd:3.4.13-0\nk8s.gcr.io/coredns/coredns:v1.8.0\n```\n\n<!--more-->\n\n\n\n### 依赖conntrack\n\n![](/pics/k8s-not-ipvs-02.png)\n\n```\nyum -y install socat conntrack-tools\n```\n\n\n\n### init配置文件\n\n#### 命令生成默认文件\n\n```\nkubeadm config print init-defaults  > config.yaml\n```\n\n\n\n```\n#生成KubeletConfiguration示例文件 \nkubeadm config print init-defaults --component-configs KubeletConfiguration\n\n#生成KubeProxyConfiguration示例文件 \nkubeadm config print init-defaults --component-configs KubeProxyConfiguration\n```\n\n\n\n```\nansible k8s-108 -m copy -a \"src=/opt/kubernetes/client/k8s-1.21-11/bin/config.yaml dest=/opt/kubernetes  mode=0644\"   -b --become-method sudo --become-user root\n```\n\n\n\n\n\n#### config.yaml\n\n```yaml\napiVersion: kubeadm.k8s.io/v1beta2\nbootstrapTokens:\n- groups:\n  - system:bootstrappers:kubeadm:default-node-token\n  token: abcdef.0123456789abcdef\n  ttl: 24h0m0s\n  usages:\n  - signing\n  - authentication\nkind: InitConfiguration\nlocalAPIEndpoint:\n  advertiseAddress: 192.168.56.108 #ip\n  bindPort: 6443\nnodeRegistration:\n  criSocket: /var/run/dockershim.sock\n  name: k8s # hostname “xxx” could not be reached\n  taints: null\n---\napiServer:\n  timeoutForControlPlane: 4m0s\napiVersion: kubeadm.k8s.io/v1beta2\ncertificatesDir: /etc/kubernetes/pki\nclusterName: kubernetes\ncontrollerManager: {}\ndns:\n  type: CoreDNS\netcd:\n  local:\n    dataDir: /var/lib/etcd\nimageRepository: k8s.org/k8s  # 镜像仓库源\nkind: ClusterConfiguration\nkubernetesVersion: 1.21.12  #版本\nnetworking:\n  dnsDomain: cluster.local\n  serviceSubnet: 10.96.0.0/12\nscheduler: {}\n---\napiVersion: kubelet.config.k8s.io/v1beta1\nkind: KubeletConfiguration\ncgroupDriver: systemd\nfailSwapOn: False\n---\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nkind: KubeProxyConfiguration\nipvs:\n  minSyncPeriod: 0s\n  scheduler: \"rr\"\n  syncPeriod: 30s\nmode: \"ipvs\"\n```\n\n\n\n#### kubectl\n\n![](/pics/k8s-get-pend-01.png)\n\ndocker: network plugin is not ready: cni config uninitialized\n\n[kubelet.service详解](/linux/k8s/kubelet#id-service)\n\n\n\n### 初始化过程\n\n```shell\n[vagrant@k8s kubernetes]$ sudo ./bin/kubeadm   init --config config.yaml\nW0809 20:30:08.653353    3073 kubelet.go:215] detected \"cgroupfs\" as the Docker cgroup driver, the provided value \"systemd\" in \"KubeletConfiguration\" will be overrided\n[init] Using Kubernetes version: v1.21.12\n[preflight] Running pre-flight checks\n\t[WARNING IsDockerSystemdCheck]: detected \"cgroupfs\" as the Docker cgroup driver. The recommended driver is \"systemd\". Please follow the guide at https://kubernetes.io/docs/setup/cri/\n\t[WARNING Service-Kubelet]: kubelet service is not enabled, please run 'systemctl enable kubelet.service'\n[preflight] Pulling images required for setting up a Kubernetes cluster\n[preflight] This might take a minute or two, depending on the speed of your internet connection\n[preflight] You can also perform this action in beforehand using 'kubeadm config images pull'\n[certs] Using certificateDir folder \"/etc/kubernetes/pki\"\n[certs] Generating \"ca\" certificate and key\n[certs] Generating \"apiserver\" certificate and key\n[certs] apiserver serving cert is signed for DNS names [k8s kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 192.168.56.108]\n[certs] Generating \"apiserver-kubelet-client\" certificate and key\n[certs] Generating \"front-proxy-ca\" certificate and key\n[certs] Generating \"front-proxy-client\" certificate and key\n[certs] Generating \"etcd/ca\" certificate and key\n[certs] Generating \"etcd/server\" certificate and key\n[certs] etcd/server serving cert is signed for DNS names [k8s localhost] and IPs [192.168.56.108 127.0.0.1 ::1]\n[certs] Generating \"etcd/peer\" certificate and key\n[certs] etcd/peer serving cert is signed for DNS names [k8s localhost] and IPs [192.168.56.108 127.0.0.1 ::1]\n[certs] Generating \"etcd/healthcheck-client\" certificate and key\n[certs] Generating \"apiserver-etcd-client\" certificate and key\n[certs] Generating \"sa\" key and public key\n[kubeconfig] Using kubeconfig folder \"/etc/kubernetes\"\n[kubeconfig] Writing \"admin.conf\" kubeconfig file\n[kubeconfig] Writing \"kubelet.conf\" kubeconfig file\n[kubeconfig] Writing \"controller-manager.conf\" kubeconfig file\n[kubeconfig] Writing \"scheduler.conf\" kubeconfig file\n[kubelet-start] Writing kubelet environment file with flags to file \"/var/lib/kubelet/kubeadm-flags.env\"\n[kubelet-start] Writing kubelet configuration to file \"/var/lib/kubelet/config.yaml\"\n[kubelet-start] Starting the kubelet\n[control-plane] Using manifest folder \"/etc/kubernetes/manifests\"\n[control-plane] Creating static Pod manifest for \"kube-apiserver\"\n[control-plane] Creating static Pod manifest for \"kube-controller-manager\"\n[control-plane] Creating static Pod manifest for \"kube-scheduler\"\n[etcd] Creating static Pod manifest for local etcd in \"/etc/kubernetes/manifests\"\n[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory \"/etc/kubernetes/manifests\". This can take up to 4m0s\n[apiclient] All control plane components are healthy after 12.505234 seconds\n[upload-config] Storing the configuration used in ConfigMap \"kubeadm-config\" in the \"kube-system\" Namespace\n[kubelet] Creating a ConfigMap \"kubelet-config-1.21\" in namespace kube-system with the configuration for the kubelets in the cluster\n[upload-certs] Skipping phase. Please see --upload-certs\n[mark-control-plane] Marking the node k8s as control-plane by adding the labels: [node-role.kubernetes.io/master(deprecated) node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]\n[mark-control-plane] Marking the node k8s as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]\n[bootstrap-token] Using token: abcdef.0123456789abcdef\n[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles\n[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to get nodes\n[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials\n[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token\n[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster\n[bootstrap-token] Creating the \"cluster-info\" ConfigMap in the \"kube-public\" namespace\n[kubelet-finalize] Updating \"/etc/kubernetes/kubelet.conf\" to point to a rotatable kubelet client certificate and key\n[addons] Applied essential addon: CoreDNS\n[addons] Applied essential addon: kube-proxy\n\nYour Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\nAlternatively, if you are the root user, you can run:\n\n  export KUBECONFIG=/etc/kubernetes/admin.conf\n\nYou should now deploy a pod network to the cluster.\nRun \"kubectl apply -f [podnetwork].yaml\" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join 192.168.56.108:6443 --token abcdef.0123456789abcdef \\\n\t--discovery-token-ca-cert-hash sha256:01661c34149742e27fa96db2f1c4a8d4675d2f0b5133f8cd25a45e031eb23653 \n```\n\n\n\n### 节点配置文件\n\n```\nkubeadm config print join-defaults > join-config.yaml\n```\n\n\n\n\n\n```\nkubectl create clusterrolebinding kubelet-bootstrap --clusterrole=system:node-bootstrapper --user=kubelet-bootstrap\n```\n\n>error: failed to run Kubelet: cannot create certificate signing request: certificatesigningrequests.certificates.k8s.io is forbidden: User \"kubelet-bootstrap\" cannot create certificatesigningrequests.certificates.k8s.io at the cluster scope\n>\n\n\n\n\n\n### 网络插件podnetwork\n\nhttps://kubernetes.io/docs/concepts/cluster-administration/addons/\n\n\n\n#### flanneld\n\n[查看flanneld.yaml](/linux/k8s/flanneld)\n\n```shell\nansible k8s-108 -m copy -a \"src=/home/cs/oss/0s/k8s/kube/kube-flanneld.yml  dest=/opt/kubernetes  mode=0644\"   -b --become-method sudo --become-user root\n```\n\n\n\n```shell\n[vagrant@k8s kubernetes]$ kubectl apply -f kube-flanneld.yaml \nWarning: policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+\npodsecuritypolicy.policy/psp.flannel.unprivileged created\nWarning: rbac.authorization.k8s.io/v1beta1 ClusterRole is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRole\nclusterrole.rbac.authorization.k8s.io/flannel created\nWarning: rbac.authorization.k8s.io/v1beta1 ClusterRoleBinding is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRoleBinding\nclusterrolebinding.rbac.authorization.k8s.io/flannel created\nserviceaccount/flannel created\nconfigmap/kube-flannel-cfg created\ndaemonset.apps/kube-flannel-ds-amd64 created\n```\n\n\n\n#### calico\n\nhttps://docs.projectcalico.org/getting-started/kubernetes/self-managed-onprem/onpremises\n\ncalico.yaml https://docs.projectcalico.org/manifests/calico.yaml\n\n\n\n### kubectl权限\n\n#### ~/.kube/config\n\n```\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n```\n\n\n\n\n\n### 组件状态cs\n\n#### Unhealthy \n\n![](/pics/k8s-get-cs-01.png)\n\n\n\n注释`port=0`行\n\n```shell\n[vagrant@k8s kubernetes]$ sudo sed -i '/port=0/s/^/#/'  /etc/kubernetes/manifests/kube-controller-manager.yaml\n[vagrant@k8s kubernetes]$ sudo sed -i '/port=0/s/^/#/'  /etc/kubernetes/manifests/kube-scheduler.yaml\n```\n\n![](/pics/k8s-get-cs-02.png)\n\n\n\n### 加入集群\n\n集群初始化时的添加命令\n\n```\nkubeadm join 192.168.56.108:6443 --token abcdef.0123456789abcdef \\\n\t--discovery-token-ca-cert-hash sha256:01661c34149742e27fa96db2f1c4a8d4675d2f0b5133f8cd25a45e031eb23653\n```\n\n命令方式获取join参数\n\n```\nkubeadm token create --print-join-command\n```\n\n\n\n\n\n重新生成certificate-key,生成用于加入控制平面的secret\n\n```\nkubeadm init phase upload-certs --upload-certs\n```\n\n> Using certificate key:xxxx\n\n\n\n#### 加入控制节点\n\n```\nkubeadm join 192.168.56.108:6443 --token abcdef.0123456789abcdef \\\n\t--discovery-token-ca-cert-hash sha256:01661c34149742e27fa96db2f1c4a8d4675d2f0b5133f8cd25a45e031eb23653    --control-plane --certificate-key xxxx\n```\n\n\n\n\n\n\n\n### Pending状态\n\n```\nkubectl logs kube-flannel-ds-amd64-7wjtn -n kube-system\n```\n\n> Error registering network: failed to acquire lease: node \"k8s\" pod cidr not assigned\n\n![](/pics/k8s-get-node-01.png)\n\nmaster节点一直notready  和  coredns pod一直pending\n\n安装flannel\n\n![](/pics/k8s-get-node-02.png)\n\n\n\n### pod-network-cidr\n\n#### 修改 \n\n--pod-network-cidr\n\n```\n1）kubectl -n kube-system edit cm kubeadm-config\n2）vim /etc/kubernetes/manifests/kube-scheduler.yaml\n```\n\n#### 检查配置\n\n```\nkubectl cluster-info dump | grep -m 1 cluster-cidr\n```\n\n**kube-proxy的cluster-cidr与kuber-controller-manager的cluster-cidr**\n\n\n\n\n\n```objectivec\n kubectl scale deployment --replicas=0 dns-autoscaler -n kube-system\ndeployment.extensions/dns-autoscaler scaled\n# kubectl patch deployment coredns -p '{\"spec\":{\"replicas\":17}}' -n kube-system\ndeployment.extensions/coredns patched\n# kubectl get pod -n kube-system |grep coredns |wc -l\n```\n\n\n\n### 重启\n\n```\nsystemctl status kubelet\nsudo systemctl start kubelet\n```\n\n> *静态 Pod* 在指定的节点上由 kubelet 守护进程直接管理，不需要 [API 服务器](https://kubernetes.io/zh-cn/docs/reference/command-line-tools-reference/kube-apiserver/) 监管,kubelet 监视每个静态 Pod（在它崩溃之后重新启动）\n>\n> –pod-manifest-path=\n\n#### 常见的 Static Pod\n\n- etcd\n- kube-apiserver\n- kube-controller-manager\n- kube-scheduler\n\n\n\n### 卸载\n\n```shell\nsudo kubeadm reset -f\nsudo rm -rf /var/lib/etcd /var/lib/kubelet /var/lib/dockershim /var/run/kubernetes /var/lib/cni /etc/kubernetes\n```\n\n\n\n\n\n### 多集群\n\n#### 多个配置\n\n一台机器管理多个集群\n\n```shell\ncs@debian:~$ ls -l ~/.kube/\n总用量 36\ndrwxr-x--- 3 cs cs 4096 4月  20 14:37 cache\n-rw------- 1 cs cs 9852 8月  10 21:58 config\n-rw-r--r-- 1 cs cs 5597 8月  10 21:56 config1   #k8s 容器部署\n-rw------- 1 cs cs 6201 8月   6 16:57 config2   #kubernetes二进制部署\ndrwxr-x--- 3 cs cs 4096 8月  10 21:58 http-cache\n```\n\n#### 合并配置\n\n```shell\n$ KUBECONFIG=/home/cs/.kube/config1:/home/cs/.kube/config2 kubectl config view --flatten >/home/cs/.kube/config\n```\n\n![](/pics/k8s-view-cluster.png)\n\n\n\n#### 获取集群配置\n\n```shell\ncs@debian:~$ kubectl config get-contexts\nCURRENT   NAME                   CLUSTER      AUTHINFO           NAMESPACE\n          admin@kubernetes       kubernetes   admin              \n*         kubernetes-admin@k8s   k8s          kubernetes-admin  \n```\n\n##### 容器部署\n\n```\ncs@debian:~$ kubectl get cs\nNAME                 STATUS    MESSAGE             ERROR\nscheduler            Healthy   ok                  \ncontroller-manager   Healthy   ok                  \netcd-0               Healthy   {\"health\":\"true\"}   \ncs@debian:~$ kubectl get node\nNAME   STATUS   ROLES                  AGE     VERSION\nk8s    Ready    control-plane,master   4m57s   v1.21.11\n```\n\n\n\n\n\n#### 换集群\n\nuse-context\n\n```shell\n#当前集群\ncs@debian:~$ kubectl config current-context   \nkubernetes-admin@k8s\n\ncs@debian:~$ kubectl config use-context admin@kubernetes   \nSwitched to context \"admin@kubernetes\".\n```\n\n##### 二进制部署\n\n```shell\ncs@debian:~$ kubectl get cs\nNAME                 STATUS    MESSAGE              ERROR\nscheduler            Healthy   ok                   \ncontroller-manager   Healthy   ok                   \netcd-1               Healthy   {\"health\": \"true\"}   \netcd-0               Healthy   {\"health\": \"true\"}   \netcd-2               Healthy   {\"health\": \"true\"}   \ncs@debian:~$ kubectl get node\nNAME       STATUS     ROLES    AGE    VERSION\nmaster02   Ready      <none>   121d   v1.18.8\nmaster03   Ready      <none>   121d   v1.18.8\nnode04     Ready      <none>   121d   v1.18.8\nnode05     NotReady   <none>   121d   v1.18.8\nnode06     Ready      <none>   121d   v1.18.8\n```\n\n\n\n\n\n![](/pics/k8s-more-cluster.png)\n\n> current-context 显示 current_context\n> delete-cluster  删除 kubeconfig 文件中指定的集群\n> delete-context  删除 kubeconfig 文件中指定的 context\n> get-clusters    显示 kubeconfig 文件中定义的集群\n> get-contexts    描述一个或多个 contexts\n> rename-context  从 kubeconfig 文件重命名上下文。\n> set             设置 kubeconfig 文件中的一个单个值\n> set-cluster     设置 kubeconfig 文件中的一个集群条目\n> set-context     设置 kubeconfig 文件中的一个 context 条目\n> set-credentials 设置 kubeconfig 文件中的一个用户条目\n> unset           取消设置 kubeconfig 文件中的一个单个值\n> use-context     设置 kubeconfig 文件中的当前上下文\n> view            显示合并的 kubeconfig 配置或一个指定的 kubeconfig 文件\n\n\n\n","source":"_posts/linux/k8s/kubeadm.md","raw":"---\ntitle: kubeadm容器化安装\npermalink: linux/k8s/kubeadm//\ntags:\n  - kubeadm\ncategories:\n  - linux\n  - k8s\ndate: 2022-08-07 20:18:14\n---\n\n### docker\n\n#### daemon.json\n\n```shell\n[vagrant@k8s ~]$ sudo vi /etc/docker/daemon.json\n[vagrant@k8s ~]$ docker info | grep Driver\nStorage Driver: overlay2\nLogging Driver: json-file\nCgroup Driver: cgroupfs\n[vagrant@k8s ~]$ sudo systemctl restart docker \n[vagrant@k8s ~]$ docker info | grep Driver\nStorage Driver: overlay2\nLogging Driver: json-file\nCgroup Driver: systemd\n[vagrant@k8s ~]$ sudo cat  /etc/docker/daemon.json\n{\n \"exec-opts\": [\"native.cgroupdriver=systemd\"],\n \"insecure-registries\":[\"https://k8s.org\"]\n\n}\n```\n\n>\"exec-opts\": [\"native.cgroupdriver=systemd\"]\n\n Error response from daemon: OCI runtime create failed: systemd cgroup flag passed, but systemd support for managing cgroups is not available\n\n\n\n/etc/sysconfig/modules/ipvs.modules\n\n```\ncat > /etc/sysconfig/modules/ipvs.modules <<EOF\n#!/bin/bash\nmodprobe -- br_netfilter\nmodprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- nf_conntrack_ipv4\nEOF\nchmod 755 /etc/sysconfig/modules/ipvs.modules\n```\n\n\n\n```\n cat  /etc/sysctl.conf\nnet.ipv4.vs.conntrack=1\nnet.ipv4.vs.conn_reuse_mode=0\nnet.ipv4.vs.expire_nodest_conn=1\n```\n\n\n\n\n\n### 准备images list\n\n```\n./kubeadm config images list\nI0809 21:56:57.334915    4785 version.go:254] remote version is much newer: v1.24.3; falling back to: stable-1.21\nk8s.gcr.io/kube-apiserver:v1.21.14\nk8s.gcr.io/kube-controller-manager:v1.21.14\nk8s.gcr.io/kube-scheduler:v1.21.14\nk8s.gcr.io/kube-proxy:v1.21.14\nk8s.gcr.io/pause:3.4.1\nk8s.gcr.io/etcd:3.4.13-0\nk8s.gcr.io/coredns/coredns:v1.8.0\n```\n\n<!--more-->\n\n\n\n### 依赖conntrack\n\n![](/pics/k8s-not-ipvs-02.png)\n\n```\nyum -y install socat conntrack-tools\n```\n\n\n\n### init配置文件\n\n#### 命令生成默认文件\n\n```\nkubeadm config print init-defaults  > config.yaml\n```\n\n\n\n```\n#生成KubeletConfiguration示例文件 \nkubeadm config print init-defaults --component-configs KubeletConfiguration\n\n#生成KubeProxyConfiguration示例文件 \nkubeadm config print init-defaults --component-configs KubeProxyConfiguration\n```\n\n\n\n```\nansible k8s-108 -m copy -a \"src=/opt/kubernetes/client/k8s-1.21-11/bin/config.yaml dest=/opt/kubernetes  mode=0644\"   -b --become-method sudo --become-user root\n```\n\n\n\n\n\n#### config.yaml\n\n```yaml\napiVersion: kubeadm.k8s.io/v1beta2\nbootstrapTokens:\n- groups:\n  - system:bootstrappers:kubeadm:default-node-token\n  token: abcdef.0123456789abcdef\n  ttl: 24h0m0s\n  usages:\n  - signing\n  - authentication\nkind: InitConfiguration\nlocalAPIEndpoint:\n  advertiseAddress: 192.168.56.108 #ip\n  bindPort: 6443\nnodeRegistration:\n  criSocket: /var/run/dockershim.sock\n  name: k8s # hostname “xxx” could not be reached\n  taints: null\n---\napiServer:\n  timeoutForControlPlane: 4m0s\napiVersion: kubeadm.k8s.io/v1beta2\ncertificatesDir: /etc/kubernetes/pki\nclusterName: kubernetes\ncontrollerManager: {}\ndns:\n  type: CoreDNS\netcd:\n  local:\n    dataDir: /var/lib/etcd\nimageRepository: k8s.org/k8s  # 镜像仓库源\nkind: ClusterConfiguration\nkubernetesVersion: 1.21.12  #版本\nnetworking:\n  dnsDomain: cluster.local\n  serviceSubnet: 10.96.0.0/12\nscheduler: {}\n---\napiVersion: kubelet.config.k8s.io/v1beta1\nkind: KubeletConfiguration\ncgroupDriver: systemd\nfailSwapOn: False\n---\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nkind: KubeProxyConfiguration\nipvs:\n  minSyncPeriod: 0s\n  scheduler: \"rr\"\n  syncPeriod: 30s\nmode: \"ipvs\"\n```\n\n\n\n#### kubectl\n\n![](/pics/k8s-get-pend-01.png)\n\ndocker: network plugin is not ready: cni config uninitialized\n\n[kubelet.service详解](/linux/k8s/kubelet#id-service)\n\n\n\n### 初始化过程\n\n```shell\n[vagrant@k8s kubernetes]$ sudo ./bin/kubeadm   init --config config.yaml\nW0809 20:30:08.653353    3073 kubelet.go:215] detected \"cgroupfs\" as the Docker cgroup driver, the provided value \"systemd\" in \"KubeletConfiguration\" will be overrided\n[init] Using Kubernetes version: v1.21.12\n[preflight] Running pre-flight checks\n\t[WARNING IsDockerSystemdCheck]: detected \"cgroupfs\" as the Docker cgroup driver. The recommended driver is \"systemd\". Please follow the guide at https://kubernetes.io/docs/setup/cri/\n\t[WARNING Service-Kubelet]: kubelet service is not enabled, please run 'systemctl enable kubelet.service'\n[preflight] Pulling images required for setting up a Kubernetes cluster\n[preflight] This might take a minute or two, depending on the speed of your internet connection\n[preflight] You can also perform this action in beforehand using 'kubeadm config images pull'\n[certs] Using certificateDir folder \"/etc/kubernetes/pki\"\n[certs] Generating \"ca\" certificate and key\n[certs] Generating \"apiserver\" certificate and key\n[certs] apiserver serving cert is signed for DNS names [k8s kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 192.168.56.108]\n[certs] Generating \"apiserver-kubelet-client\" certificate and key\n[certs] Generating \"front-proxy-ca\" certificate and key\n[certs] Generating \"front-proxy-client\" certificate and key\n[certs] Generating \"etcd/ca\" certificate and key\n[certs] Generating \"etcd/server\" certificate and key\n[certs] etcd/server serving cert is signed for DNS names [k8s localhost] and IPs [192.168.56.108 127.0.0.1 ::1]\n[certs] Generating \"etcd/peer\" certificate and key\n[certs] etcd/peer serving cert is signed for DNS names [k8s localhost] and IPs [192.168.56.108 127.0.0.1 ::1]\n[certs] Generating \"etcd/healthcheck-client\" certificate and key\n[certs] Generating \"apiserver-etcd-client\" certificate and key\n[certs] Generating \"sa\" key and public key\n[kubeconfig] Using kubeconfig folder \"/etc/kubernetes\"\n[kubeconfig] Writing \"admin.conf\" kubeconfig file\n[kubeconfig] Writing \"kubelet.conf\" kubeconfig file\n[kubeconfig] Writing \"controller-manager.conf\" kubeconfig file\n[kubeconfig] Writing \"scheduler.conf\" kubeconfig file\n[kubelet-start] Writing kubelet environment file with flags to file \"/var/lib/kubelet/kubeadm-flags.env\"\n[kubelet-start] Writing kubelet configuration to file \"/var/lib/kubelet/config.yaml\"\n[kubelet-start] Starting the kubelet\n[control-plane] Using manifest folder \"/etc/kubernetes/manifests\"\n[control-plane] Creating static Pod manifest for \"kube-apiserver\"\n[control-plane] Creating static Pod manifest for \"kube-controller-manager\"\n[control-plane] Creating static Pod manifest for \"kube-scheduler\"\n[etcd] Creating static Pod manifest for local etcd in \"/etc/kubernetes/manifests\"\n[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory \"/etc/kubernetes/manifests\". This can take up to 4m0s\n[apiclient] All control plane components are healthy after 12.505234 seconds\n[upload-config] Storing the configuration used in ConfigMap \"kubeadm-config\" in the \"kube-system\" Namespace\n[kubelet] Creating a ConfigMap \"kubelet-config-1.21\" in namespace kube-system with the configuration for the kubelets in the cluster\n[upload-certs] Skipping phase. Please see --upload-certs\n[mark-control-plane] Marking the node k8s as control-plane by adding the labels: [node-role.kubernetes.io/master(deprecated) node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]\n[mark-control-plane] Marking the node k8s as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]\n[bootstrap-token] Using token: abcdef.0123456789abcdef\n[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles\n[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to get nodes\n[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials\n[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token\n[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster\n[bootstrap-token] Creating the \"cluster-info\" ConfigMap in the \"kube-public\" namespace\n[kubelet-finalize] Updating \"/etc/kubernetes/kubelet.conf\" to point to a rotatable kubelet client certificate and key\n[addons] Applied essential addon: CoreDNS\n[addons] Applied essential addon: kube-proxy\n\nYour Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\nAlternatively, if you are the root user, you can run:\n\n  export KUBECONFIG=/etc/kubernetes/admin.conf\n\nYou should now deploy a pod network to the cluster.\nRun \"kubectl apply -f [podnetwork].yaml\" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join 192.168.56.108:6443 --token abcdef.0123456789abcdef \\\n\t--discovery-token-ca-cert-hash sha256:01661c34149742e27fa96db2f1c4a8d4675d2f0b5133f8cd25a45e031eb23653 \n```\n\n\n\n### 节点配置文件\n\n```\nkubeadm config print join-defaults > join-config.yaml\n```\n\n\n\n\n\n```\nkubectl create clusterrolebinding kubelet-bootstrap --clusterrole=system:node-bootstrapper --user=kubelet-bootstrap\n```\n\n>error: failed to run Kubelet: cannot create certificate signing request: certificatesigningrequests.certificates.k8s.io is forbidden: User \"kubelet-bootstrap\" cannot create certificatesigningrequests.certificates.k8s.io at the cluster scope\n>\n\n\n\n\n\n### 网络插件podnetwork\n\nhttps://kubernetes.io/docs/concepts/cluster-administration/addons/\n\n\n\n#### flanneld\n\n[查看flanneld.yaml](/linux/k8s/flanneld)\n\n```shell\nansible k8s-108 -m copy -a \"src=/home/cs/oss/0s/k8s/kube/kube-flanneld.yml  dest=/opt/kubernetes  mode=0644\"   -b --become-method sudo --become-user root\n```\n\n\n\n```shell\n[vagrant@k8s kubernetes]$ kubectl apply -f kube-flanneld.yaml \nWarning: policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+\npodsecuritypolicy.policy/psp.flannel.unprivileged created\nWarning: rbac.authorization.k8s.io/v1beta1 ClusterRole is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRole\nclusterrole.rbac.authorization.k8s.io/flannel created\nWarning: rbac.authorization.k8s.io/v1beta1 ClusterRoleBinding is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRoleBinding\nclusterrolebinding.rbac.authorization.k8s.io/flannel created\nserviceaccount/flannel created\nconfigmap/kube-flannel-cfg created\ndaemonset.apps/kube-flannel-ds-amd64 created\n```\n\n\n\n#### calico\n\nhttps://docs.projectcalico.org/getting-started/kubernetes/self-managed-onprem/onpremises\n\ncalico.yaml https://docs.projectcalico.org/manifests/calico.yaml\n\n\n\n### kubectl权限\n\n#### ~/.kube/config\n\n```\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n```\n\n\n\n\n\n### 组件状态cs\n\n#### Unhealthy \n\n![](/pics/k8s-get-cs-01.png)\n\n\n\n注释`port=0`行\n\n```shell\n[vagrant@k8s kubernetes]$ sudo sed -i '/port=0/s/^/#/'  /etc/kubernetes/manifests/kube-controller-manager.yaml\n[vagrant@k8s kubernetes]$ sudo sed -i '/port=0/s/^/#/'  /etc/kubernetes/manifests/kube-scheduler.yaml\n```\n\n![](/pics/k8s-get-cs-02.png)\n\n\n\n### 加入集群\n\n集群初始化时的添加命令\n\n```\nkubeadm join 192.168.56.108:6443 --token abcdef.0123456789abcdef \\\n\t--discovery-token-ca-cert-hash sha256:01661c34149742e27fa96db2f1c4a8d4675d2f0b5133f8cd25a45e031eb23653\n```\n\n命令方式获取join参数\n\n```\nkubeadm token create --print-join-command\n```\n\n\n\n\n\n重新生成certificate-key,生成用于加入控制平面的secret\n\n```\nkubeadm init phase upload-certs --upload-certs\n```\n\n> Using certificate key:xxxx\n\n\n\n#### 加入控制节点\n\n```\nkubeadm join 192.168.56.108:6443 --token abcdef.0123456789abcdef \\\n\t--discovery-token-ca-cert-hash sha256:01661c34149742e27fa96db2f1c4a8d4675d2f0b5133f8cd25a45e031eb23653    --control-plane --certificate-key xxxx\n```\n\n\n\n\n\n\n\n### Pending状态\n\n```\nkubectl logs kube-flannel-ds-amd64-7wjtn -n kube-system\n```\n\n> Error registering network: failed to acquire lease: node \"k8s\" pod cidr not assigned\n\n![](/pics/k8s-get-node-01.png)\n\nmaster节点一直notready  和  coredns pod一直pending\n\n安装flannel\n\n![](/pics/k8s-get-node-02.png)\n\n\n\n### pod-network-cidr\n\n#### 修改 \n\n--pod-network-cidr\n\n```\n1）kubectl -n kube-system edit cm kubeadm-config\n2）vim /etc/kubernetes/manifests/kube-scheduler.yaml\n```\n\n#### 检查配置\n\n```\nkubectl cluster-info dump | grep -m 1 cluster-cidr\n```\n\n**kube-proxy的cluster-cidr与kuber-controller-manager的cluster-cidr**\n\n\n\n\n\n```objectivec\n kubectl scale deployment --replicas=0 dns-autoscaler -n kube-system\ndeployment.extensions/dns-autoscaler scaled\n# kubectl patch deployment coredns -p '{\"spec\":{\"replicas\":17}}' -n kube-system\ndeployment.extensions/coredns patched\n# kubectl get pod -n kube-system |grep coredns |wc -l\n```\n\n\n\n### 重启\n\n```\nsystemctl status kubelet\nsudo systemctl start kubelet\n```\n\n> *静态 Pod* 在指定的节点上由 kubelet 守护进程直接管理，不需要 [API 服务器](https://kubernetes.io/zh-cn/docs/reference/command-line-tools-reference/kube-apiserver/) 监管,kubelet 监视每个静态 Pod（在它崩溃之后重新启动）\n>\n> –pod-manifest-path=\n\n#### 常见的 Static Pod\n\n- etcd\n- kube-apiserver\n- kube-controller-manager\n- kube-scheduler\n\n\n\n### 卸载\n\n```shell\nsudo kubeadm reset -f\nsudo rm -rf /var/lib/etcd /var/lib/kubelet /var/lib/dockershim /var/run/kubernetes /var/lib/cni /etc/kubernetes\n```\n\n\n\n\n\n### 多集群\n\n#### 多个配置\n\n一台机器管理多个集群\n\n```shell\ncs@debian:~$ ls -l ~/.kube/\n总用量 36\ndrwxr-x--- 3 cs cs 4096 4月  20 14:37 cache\n-rw------- 1 cs cs 9852 8月  10 21:58 config\n-rw-r--r-- 1 cs cs 5597 8月  10 21:56 config1   #k8s 容器部署\n-rw------- 1 cs cs 6201 8月   6 16:57 config2   #kubernetes二进制部署\ndrwxr-x--- 3 cs cs 4096 8月  10 21:58 http-cache\n```\n\n#### 合并配置\n\n```shell\n$ KUBECONFIG=/home/cs/.kube/config1:/home/cs/.kube/config2 kubectl config view --flatten >/home/cs/.kube/config\n```\n\n![](/pics/k8s-view-cluster.png)\n\n\n\n#### 获取集群配置\n\n```shell\ncs@debian:~$ kubectl config get-contexts\nCURRENT   NAME                   CLUSTER      AUTHINFO           NAMESPACE\n          admin@kubernetes       kubernetes   admin              \n*         kubernetes-admin@k8s   k8s          kubernetes-admin  \n```\n\n##### 容器部署\n\n```\ncs@debian:~$ kubectl get cs\nNAME                 STATUS    MESSAGE             ERROR\nscheduler            Healthy   ok                  \ncontroller-manager   Healthy   ok                  \netcd-0               Healthy   {\"health\":\"true\"}   \ncs@debian:~$ kubectl get node\nNAME   STATUS   ROLES                  AGE     VERSION\nk8s    Ready    control-plane,master   4m57s   v1.21.11\n```\n\n\n\n\n\n#### 换集群\n\nuse-context\n\n```shell\n#当前集群\ncs@debian:~$ kubectl config current-context   \nkubernetes-admin@k8s\n\ncs@debian:~$ kubectl config use-context admin@kubernetes   \nSwitched to context \"admin@kubernetes\".\n```\n\n##### 二进制部署\n\n```shell\ncs@debian:~$ kubectl get cs\nNAME                 STATUS    MESSAGE              ERROR\nscheduler            Healthy   ok                   \ncontroller-manager   Healthy   ok                   \netcd-1               Healthy   {\"health\": \"true\"}   \netcd-0               Healthy   {\"health\": \"true\"}   \netcd-2               Healthy   {\"health\": \"true\"}   \ncs@debian:~$ kubectl get node\nNAME       STATUS     ROLES    AGE    VERSION\nmaster02   Ready      <none>   121d   v1.18.8\nmaster03   Ready      <none>   121d   v1.18.8\nnode04     Ready      <none>   121d   v1.18.8\nnode05     NotReady   <none>   121d   v1.18.8\nnode06     Ready      <none>   121d   v1.18.8\n```\n\n\n\n\n\n![](/pics/k8s-more-cluster.png)\n\n> current-context 显示 current_context\n> delete-cluster  删除 kubeconfig 文件中指定的集群\n> delete-context  删除 kubeconfig 文件中指定的 context\n> get-clusters    显示 kubeconfig 文件中定义的集群\n> get-contexts    描述一个或多个 contexts\n> rename-context  从 kubeconfig 文件重命名上下文。\n> set             设置 kubeconfig 文件中的一个单个值\n> set-cluster     设置 kubeconfig 文件中的一个集群条目\n> set-context     设置 kubeconfig 文件中的一个 context 条目\n> set-credentials 设置 kubeconfig 文件中的一个用户条目\n> unset           取消设置 kubeconfig 文件中的一个单个值\n> use-context     设置 kubeconfig 文件中的当前上下文\n> view            显示合并的 kubeconfig 配置或一个指定的 kubeconfig 文件\n\n\n\n","slug":"linux/k8s/kubeadm","published":1,"updated":"2022-08-28T09:10:00.944Z","__permalink":"linux/k8s/kubeadm//","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gttd002bgwi5g9yf2jdf","content":"<h3 id=\"docker\"><a href=\"#docker\" class=\"headerlink\" title=\"docker\"></a>docker</h3><h4 id=\"daemon-json\"><a href=\"#daemon-json\" class=\"headerlink\" title=\"daemon.json\"></a>daemon.json</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[vagrant@k8s ~]$ sudo vi /etc/docker/daemon.json</span><br><span class=\"line\">[vagrant@k8s ~]$ docker info | grep Driver</span><br><span class=\"line\">Storage Driver: overlay2</span><br><span class=\"line\">Logging Driver: json-file</span><br><span class=\"line\">Cgroup Driver: cgroupfs</span><br><span class=\"line\">[vagrant@k8s ~]$ sudo systemctl restart docker </span><br><span class=\"line\">[vagrant@k8s ~]$ docker info | grep Driver</span><br><span class=\"line\">Storage Driver: overlay2</span><br><span class=\"line\">Logging Driver: json-file</span><br><span class=\"line\">Cgroup Driver: systemd</span><br><span class=\"line\">[vagrant@k8s ~]$ sudo cat  /etc/docker/daemon.json</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"> &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</span><br><span class=\"line\"> &quot;insecure-registries&quot;:[&quot;https://k8s.org&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>“exec-opts”: [“native.cgroupdriver&#x3D;systemd”]</p>\n</blockquote>\n<p> Error response from daemon: OCI runtime create failed: systemd cgroup flag passed, but systemd support for managing cgroups is not available</p>\n<p>&#x2F;etc&#x2F;sysconfig&#x2F;modules&#x2F;ipvs.modules</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;EOF</span><br><span class=\"line\">#!/bin/bash</span><br><span class=\"line\">modprobe -- br_netfilter</span><br><span class=\"line\">modprobe -- ip_vs</span><br><span class=\"line\">modprobe -- ip_vs_rr</span><br><span class=\"line\">modprobe -- ip_vs_wrr</span><br><span class=\"line\">modprobe -- ip_vs_sh</span><br><span class=\"line\">modprobe -- nf_conntrack_ipv4</span><br><span class=\"line\">EOF</span><br><span class=\"line\">chmod 755 /etc/sysconfig/modules/ipvs.modules</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> cat  /etc/sysctl.conf</span><br><span class=\"line\">net.ipv4.vs.conntrack=1</span><br><span class=\"line\">net.ipv4.vs.conn_reuse_mode=0</span><br><span class=\"line\">net.ipv4.vs.expire_nodest_conn=1</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"准备images-list\"><a href=\"#准备images-list\" class=\"headerlink\" title=\"准备images list\"></a>准备images list</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./kubeadm config images list</span><br><span class=\"line\">I0809 21:56:57.334915    4785 version.go:254] remote version is much newer: v1.24.3; falling back to: stable-1.21</span><br><span class=\"line\">k8s.gcr.io/kube-apiserver:v1.21.14</span><br><span class=\"line\">k8s.gcr.io/kube-controller-manager:v1.21.14</span><br><span class=\"line\">k8s.gcr.io/kube-scheduler:v1.21.14</span><br><span class=\"line\">k8s.gcr.io/kube-proxy:v1.21.14</span><br><span class=\"line\">k8s.gcr.io/pause:3.4.1</span><br><span class=\"line\">k8s.gcr.io/etcd:3.4.13-0</span><br><span class=\"line\">k8s.gcr.io/coredns/coredns:v1.8.0</span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n\n\n<h3 id=\"依赖conntrack\"><a href=\"#依赖conntrack\" class=\"headerlink\" title=\"依赖conntrack\"></a>依赖conntrack</h3><p><img src=\"/pics/k8s-not-ipvs-02.png\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install socat conntrack-tools</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"init配置文件\"><a href=\"#init配置文件\" class=\"headerlink\" title=\"init配置文件\"></a>init配置文件</h3><h4 id=\"命令生成默认文件\"><a href=\"#命令生成默认文件\" class=\"headerlink\" title=\"命令生成默认文件\"></a>命令生成默认文件</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubeadm config print init-defaults  &gt; config.yaml</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#生成KubeletConfiguration示例文件 </span><br><span class=\"line\">kubeadm config print init-defaults --component-configs KubeletConfiguration</span><br><span class=\"line\"></span><br><span class=\"line\">#生成KubeProxyConfiguration示例文件 </span><br><span class=\"line\">kubeadm config print init-defaults --component-configs KubeProxyConfiguration</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible k8s-108 -m copy -a &quot;src=/opt/kubernetes/client/k8s-1.21-11/bin/config.yaml dest=/opt/kubernetes  mode=0644&quot;   -b --become-method sudo --become-user root</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h4 id=\"config-yaml\"><a href=\"#config-yaml\" class=\"headerlink\" title=\"config.yaml\"></a>config.yaml</h4><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">kubeadm.k8s.io/v1beta2</span></span><br><span class=\"line\"><span class=\"attr\">bootstrapTokens:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">groups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">system:bootstrappers:kubeadm:default-node-token</span></span><br><span class=\"line\">  <span class=\"attr\">token:</span> <span class=\"string\">abcdef.0123456789abcdef</span></span><br><span class=\"line\">  <span class=\"attr\">ttl:</span> <span class=\"string\">24h0m0s</span></span><br><span class=\"line\">  <span class=\"attr\">usages:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">signing</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">authentication</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">InitConfiguration</span></span><br><span class=\"line\"><span class=\"attr\">localAPIEndpoint:</span></span><br><span class=\"line\">  <span class=\"attr\">advertiseAddress:</span> <span class=\"number\">192.168</span><span class=\"number\">.56</span><span class=\"number\">.108</span> <span class=\"comment\">#ip</span></span><br><span class=\"line\">  <span class=\"attr\">bindPort:</span> <span class=\"number\">6443</span></span><br><span class=\"line\"><span class=\"attr\">nodeRegistration:</span></span><br><span class=\"line\">  <span class=\"attr\">criSocket:</span> <span class=\"string\">/var/run/dockershim.sock</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">k8s</span> <span class=\"comment\"># hostname “xxx” could not be reached</span></span><br><span class=\"line\">  <span class=\"attr\">taints:</span> <span class=\"literal\">null</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiServer:</span></span><br><span class=\"line\">  <span class=\"attr\">timeoutForControlPlane:</span> <span class=\"string\">4m0s</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">kubeadm.k8s.io/v1beta2</span></span><br><span class=\"line\"><span class=\"attr\">certificatesDir:</span> <span class=\"string\">/etc/kubernetes/pki</span></span><br><span class=\"line\"><span class=\"attr\">clusterName:</span> <span class=\"string\">kubernetes</span></span><br><span class=\"line\"><span class=\"attr\">controllerManager:</span> &#123;&#125;</span><br><span class=\"line\"><span class=\"attr\">dns:</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">CoreDNS</span></span><br><span class=\"line\"><span class=\"attr\">etcd:</span></span><br><span class=\"line\">  <span class=\"attr\">local:</span></span><br><span class=\"line\">    <span class=\"attr\">dataDir:</span> <span class=\"string\">/var/lib/etcd</span></span><br><span class=\"line\"><span class=\"attr\">imageRepository:</span> <span class=\"string\">k8s.org/k8s</span>  <span class=\"comment\"># 镜像仓库源</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterConfiguration</span></span><br><span class=\"line\"><span class=\"attr\">kubernetesVersion:</span> <span class=\"number\">1.21</span><span class=\"number\">.12</span>  <span class=\"comment\">#版本</span></span><br><span class=\"line\"><span class=\"attr\">networking:</span></span><br><span class=\"line\">  <span class=\"attr\">dnsDomain:</span> <span class=\"string\">cluster.local</span></span><br><span class=\"line\">  <span class=\"attr\">serviceSubnet:</span> <span class=\"number\">10.96</span><span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"string\">/12</span></span><br><span class=\"line\"><span class=\"attr\">scheduler:</span> &#123;&#125;</span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">kubelet.config.k8s.io/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">KubeletConfiguration</span></span><br><span class=\"line\"><span class=\"attr\">cgroupDriver:</span> <span class=\"string\">systemd</span></span><br><span class=\"line\"><span class=\"attr\">failSwapOn:</span> <span class=\"literal\">False</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">kubeproxy.config.k8s.io/v1alpha1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">KubeProxyConfiguration</span></span><br><span class=\"line\"><span class=\"attr\">ipvs:</span></span><br><span class=\"line\">  <span class=\"attr\">minSyncPeriod:</span> <span class=\"string\">0s</span></span><br><span class=\"line\">  <span class=\"attr\">scheduler:</span> <span class=\"string\">&quot;rr&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">syncPeriod:</span> <span class=\"string\">30s</span></span><br><span class=\"line\"><span class=\"attr\">mode:</span> <span class=\"string\">&quot;ipvs&quot;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"kubectl\"><a href=\"#kubectl\" class=\"headerlink\" title=\"kubectl\"></a>kubectl</h4><p><img src=\"/pics/k8s-get-pend-01.png\"></p>\n<p>docker: network plugin is not ready: cni config uninitialized</p>\n<p><a href=\"/linux/k8s/kubelet#id-service\">kubelet.service详解</a></p>\n<h3 id=\"初始化过程\"><a href=\"#初始化过程\" class=\"headerlink\" title=\"初始化过程\"></a>初始化过程</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[vagrant@k8s kubernetes]$ sudo ./bin/kubeadm   init --config config.yaml</span><br><span class=\"line\">W0809 20:30:08.653353    3073 kubelet.go:215] detected &quot;cgroupfs&quot; as the Docker cgroup driver, the provided value &quot;systemd&quot; in &quot;KubeletConfiguration&quot; will be overrided</span><br><span class=\"line\">[init] Using Kubernetes version: v1.21.12</span><br><span class=\"line\">[preflight] Running pre-flight checks</span><br><span class=\"line\">\t[WARNING IsDockerSystemdCheck]: detected &quot;cgroupfs&quot; as the Docker cgroup driver. The recommended driver is &quot;systemd&quot;. Please follow the guide at https://kubernetes.io/docs/setup/cri/</span><br><span class=\"line\">\t[WARNING Service-Kubelet]: kubelet service is not enabled, please run &#x27;systemctl enable kubelet.service&#x27;</span><br><span class=\"line\">[preflight] Pulling images required for setting up a Kubernetes cluster</span><br><span class=\"line\">[preflight] This might take a minute or two, depending on the speed of your internet connection</span><br><span class=\"line\">[preflight] You can also perform this action in beforehand using &#x27;kubeadm config images pull&#x27;</span><br><span class=\"line\">[certs] Using certificateDir folder &quot;/etc/kubernetes/pki&quot;</span><br><span class=\"line\">[certs] Generating &quot;ca&quot; certificate and key</span><br><span class=\"line\">[certs] Generating &quot;apiserver&quot; certificate and key</span><br><span class=\"line\">[certs] apiserver serving cert is signed for DNS names [k8s kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 192.168.56.108]</span><br><span class=\"line\">[certs] Generating &quot;apiserver-kubelet-client&quot; certificate and key</span><br><span class=\"line\">[certs] Generating &quot;front-proxy-ca&quot; certificate and key</span><br><span class=\"line\">[certs] Generating &quot;front-proxy-client&quot; certificate and key</span><br><span class=\"line\">[certs] Generating &quot;etcd/ca&quot; certificate and key</span><br><span class=\"line\">[certs] Generating &quot;etcd/server&quot; certificate and key</span><br><span class=\"line\">[certs] etcd/server serving cert is signed for DNS names [k8s localhost] and IPs [192.168.56.108 127.0.0.1 ::1]</span><br><span class=\"line\">[certs] Generating &quot;etcd/peer&quot; certificate and key</span><br><span class=\"line\">[certs] etcd/peer serving cert is signed for DNS names [k8s localhost] and IPs [192.168.56.108 127.0.0.1 ::1]</span><br><span class=\"line\">[certs] Generating &quot;etcd/healthcheck-client&quot; certificate and key</span><br><span class=\"line\">[certs] Generating &quot;apiserver-etcd-client&quot; certificate and key</span><br><span class=\"line\">[certs] Generating &quot;sa&quot; key and public key</span><br><span class=\"line\">[kubeconfig] Using kubeconfig folder &quot;/etc/kubernetes&quot;</span><br><span class=\"line\">[kubeconfig] Writing &quot;admin.conf&quot; kubeconfig file</span><br><span class=\"line\">[kubeconfig] Writing &quot;kubelet.conf&quot; kubeconfig file</span><br><span class=\"line\">[kubeconfig] Writing &quot;controller-manager.conf&quot; kubeconfig file</span><br><span class=\"line\">[kubeconfig] Writing &quot;scheduler.conf&quot; kubeconfig file</span><br><span class=\"line\">[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span><br><span class=\"line\">[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;</span><br><span class=\"line\">[kubelet-start] Starting the kubelet</span><br><span class=\"line\">[control-plane] Using manifest folder &quot;/etc/kubernetes/manifests&quot;</span><br><span class=\"line\">[control-plane] Creating static Pod manifest for &quot;kube-apiserver&quot;</span><br><span class=\"line\">[control-plane] Creating static Pod manifest for &quot;kube-controller-manager&quot;</span><br><span class=\"line\">[control-plane] Creating static Pod manifest for &quot;kube-scheduler&quot;</span><br><span class=\"line\">[etcd] Creating static Pod manifest for local etcd in &quot;/etc/kubernetes/manifests&quot;</span><br><span class=\"line\">[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory &quot;/etc/kubernetes/manifests&quot;. This can take up to 4m0s</span><br><span class=\"line\">[apiclient] All control plane components are healthy after 12.505234 seconds</span><br><span class=\"line\">[upload-config] Storing the configuration used in ConfigMap &quot;kubeadm-config&quot; in the &quot;kube-system&quot; Namespace</span><br><span class=\"line\">[kubelet] Creating a ConfigMap &quot;kubelet-config-1.21&quot; in namespace kube-system with the configuration for the kubelets in the cluster</span><br><span class=\"line\">[upload-certs] Skipping phase. Please see --upload-certs</span><br><span class=\"line\">[mark-control-plane] Marking the node k8s as control-plane by adding the labels: [node-role.kubernetes.io/master(deprecated) node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]</span><br><span class=\"line\">[mark-control-plane] Marking the node k8s as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]</span><br><span class=\"line\">[bootstrap-token] Using token: abcdef.0123456789abcdef</span><br><span class=\"line\">[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles</span><br><span class=\"line\">[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to get nodes</span><br><span class=\"line\">[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials</span><br><span class=\"line\">[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token</span><br><span class=\"line\">[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster</span><br><span class=\"line\">[bootstrap-token] Creating the &quot;cluster-info&quot; ConfigMap in the &quot;kube-public&quot; namespace</span><br><span class=\"line\">[kubelet-finalize] Updating &quot;/etc/kubernetes/kubelet.conf&quot; to point to a rotatable kubelet client certificate and key</span><br><span class=\"line\">[addons] Applied essential addon: CoreDNS</span><br><span class=\"line\">[addons] Applied essential addon: kube-proxy</span><br><span class=\"line\"></span><br><span class=\"line\">Your Kubernetes control-plane has initialized successfully!</span><br><span class=\"line\"></span><br><span class=\"line\">To start using your cluster, you need to run the following as a regular user:</span><br><span class=\"line\"></span><br><span class=\"line\">  mkdir -p $HOME/.kube</span><br><span class=\"line\">  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class=\"line\">  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class=\"line\"></span><br><span class=\"line\">Alternatively, if you are the root user, you can run:</span><br><span class=\"line\"></span><br><span class=\"line\">  export KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class=\"line\"></span><br><span class=\"line\">You should now deploy a pod network to the cluster.</span><br><span class=\"line\">Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:</span><br><span class=\"line\">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class=\"line\"></span><br><span class=\"line\">Then you can join any number of worker nodes by running the following on each as root:</span><br><span class=\"line\"></span><br><span class=\"line\">kubeadm join 192.168.56.108:6443 --token abcdef.0123456789abcdef \\</span><br><span class=\"line\">\t--discovery-token-ca-cert-hash sha256:01661c34149742e27fa96db2f1c4a8d4675d2f0b5133f8cd25a45e031eb23653 </span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"节点配置文件\"><a href=\"#节点配置文件\" class=\"headerlink\" title=\"节点配置文件\"></a>节点配置文件</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubeadm config print join-defaults &gt; join-config.yaml</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create clusterrolebinding kubelet-bootstrap --clusterrole=system:node-bootstrapper --user=kubelet-bootstrap</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>error: failed to run Kubelet: cannot create certificate signing request: certificatesigningrequests.certificates.k8s.io is forbidden: User “kubelet-bootstrap” cannot create certificatesigningrequests.certificates.k8s.io at the cluster scope</p>\n</blockquote>\n<h3 id=\"网络插件podnetwork\"><a href=\"#网络插件podnetwork\" class=\"headerlink\" title=\"网络插件podnetwork\"></a>网络插件podnetwork</h3><p><a href=\"https://kubernetes.io/docs/concepts/cluster-administration/addons/\">https://kubernetes.io/docs/concepts/cluster-administration/addons/</a></p>\n<h4 id=\"flanneld\"><a href=\"#flanneld\" class=\"headerlink\" title=\"flanneld\"></a>flanneld</h4><p><a href=\"/linux/k8s/flanneld\">查看flanneld.yaml</a></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible k8s-108 -m copy -a &quot;src=/home/cs/oss/0s/k8s/kube/kube-flanneld.yml  dest=/opt/kubernetes  mode=0644&quot;   -b --become-method sudo --become-user root</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[vagrant@k8s kubernetes]$ kubectl apply -f kube-flanneld.yaml </span><br><span class=\"line\">Warning: policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+</span><br><span class=\"line\">podsecuritypolicy.policy/psp.flannel.unprivileged created</span><br><span class=\"line\">Warning: rbac.authorization.k8s.io/v1beta1 ClusterRole is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRole</span><br><span class=\"line\">clusterrole.rbac.authorization.k8s.io/flannel created</span><br><span class=\"line\">Warning: rbac.authorization.k8s.io/v1beta1 ClusterRoleBinding is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRoleBinding</span><br><span class=\"line\">clusterrolebinding.rbac.authorization.k8s.io/flannel created</span><br><span class=\"line\">serviceaccount/flannel created</span><br><span class=\"line\">configmap/kube-flannel-cfg created</span><br><span class=\"line\">daemonset.apps/kube-flannel-ds-amd64 created</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"calico\"><a href=\"#calico\" class=\"headerlink\" title=\"calico\"></a>calico</h4><p><a href=\"https://docs.projectcalico.org/getting-started/kubernetes/self-managed-onprem/onpremises\">https://docs.projectcalico.org/getting-started/kubernetes/self-managed-onprem/onpremises</a></p>\n<p>calico.yaml <a href=\"https://docs.projectcalico.org/manifests/calico.yaml\">https://docs.projectcalico.org/manifests/calico.yaml</a></p>\n<h3 id=\"kubectl权限\"><a href=\"#kubectl权限\" class=\"headerlink\" title=\"kubectl权限\"></a>kubectl权限</h3><h4 id=\"x2F-kube-x2F-config\"><a href=\"#x2F-kube-x2F-config\" class=\"headerlink\" title=\"~&#x2F;.kube&#x2F;config\"></a>~&#x2F;.kube&#x2F;config</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p $HOME/.kube</span><br><span class=\"line\">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class=\"line\">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"组件状态cs\"><a href=\"#组件状态cs\" class=\"headerlink\" title=\"组件状态cs\"></a>组件状态cs</h3><h4 id=\"Unhealthy\"><a href=\"#Unhealthy\" class=\"headerlink\" title=\"Unhealthy\"></a>Unhealthy</h4><p><img src=\"/pics/k8s-get-cs-01.png\"></p>\n<p>注释<code>port=0</code>行</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[vagrant@k8s kubernetes]$ sudo sed -i &#x27;/port=0/s/^/#/&#x27;  /etc/kubernetes/manifests/kube-controller-manager.yaml</span><br><span class=\"line\">[vagrant@k8s kubernetes]$ sudo sed -i &#x27;/port=0/s/^/#/&#x27;  /etc/kubernetes/manifests/kube-scheduler.yaml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/pics/k8s-get-cs-02.png\"></p>\n<h3 id=\"加入集群\"><a href=\"#加入集群\" class=\"headerlink\" title=\"加入集群\"></a>加入集群</h3><p>集群初始化时的添加命令</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubeadm join 192.168.56.108:6443 --token abcdef.0123456789abcdef \\</span><br><span class=\"line\">\t--discovery-token-ca-cert-hash sha256:01661c34149742e27fa96db2f1c4a8d4675d2f0b5133f8cd25a45e031eb23653</span><br></pre></td></tr></table></figure>\n\n<p>命令方式获取join参数</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubeadm token create --print-join-command</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>重新生成certificate-key,生成用于加入控制平面的secret</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubeadm init phase upload-certs --upload-certs</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Using certificate key:xxxx</p>\n</blockquote>\n<h4 id=\"加入控制节点\"><a href=\"#加入控制节点\" class=\"headerlink\" title=\"加入控制节点\"></a>加入控制节点</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubeadm join 192.168.56.108:6443 --token abcdef.0123456789abcdef \\</span><br><span class=\"line\">\t--discovery-token-ca-cert-hash sha256:01661c34149742e27fa96db2f1c4a8d4675d2f0b5133f8cd25a45e031eb23653    --control-plane --certificate-key xxxx</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<h3 id=\"Pending状态\"><a href=\"#Pending状态\" class=\"headerlink\" title=\"Pending状态\"></a>Pending状态</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl logs kube-flannel-ds-amd64-7wjtn -n kube-system</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Error registering network: failed to acquire lease: node “k8s” pod cidr not assigned</p>\n</blockquote>\n<p><img src=\"/pics/k8s-get-node-01.png\"></p>\n<p>master节点一直notready  和  coredns pod一直pending</p>\n<p>安装flannel</p>\n<p><img src=\"/pics/k8s-get-node-02.png\"></p>\n<h3 id=\"pod-network-cidr\"><a href=\"#pod-network-cidr\" class=\"headerlink\" title=\"pod-network-cidr\"></a>pod-network-cidr</h3><h4 id=\"修改\"><a href=\"#修改\" class=\"headerlink\" title=\"修改\"></a>修改</h4><p>–pod-network-cidr</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1）kubectl -n kube-system edit cm kubeadm-config</span><br><span class=\"line\">2）vim /etc/kubernetes/manifests/kube-scheduler.yaml</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"检查配置\"><a href=\"#检查配置\" class=\"headerlink\" title=\"检查配置\"></a>检查配置</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl cluster-info dump | grep -m 1 cluster-cidr</span><br></pre></td></tr></table></figure>\n\n<p><strong>kube-proxy的cluster-cidr与kuber-controller-manager的cluster-cidr</strong></p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> kubectl scale deployment --replicas=<span class=\"number\">0</span> dns-autoscaler -n kube-system</span><br><span class=\"line\">deployment.extensions/dns-autoscaler scaled</span><br><span class=\"line\"><span class=\"meta\"># kubectl patch deployment coredns -p &#x27;&#123;<span class=\"string\">&quot;spec&quot;</span>:&#123;<span class=\"string\">&quot;replicas&quot;</span>:17&#125;&#125;&#x27; -n kube-system</span></span><br><span class=\"line\">deployment.extensions/coredns patched</span><br><span class=\"line\"><span class=\"meta\"># kubectl get pod -n kube-system |grep coredns |wc -l</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"重启\"><a href=\"#重启\" class=\"headerlink\" title=\"重启\"></a>重启</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl status kubelet</span><br><span class=\"line\">sudo systemctl start kubelet</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p><em>静态 Pod</em> 在指定的节点上由 kubelet 守护进程直接管理，不需要 <a href=\"https://kubernetes.io/zh-cn/docs/reference/command-line-tools-reference/kube-apiserver/\">API 服务器</a> 监管,kubelet 监视每个静态 Pod（在它崩溃之后重新启动）</p>\n<p>–pod-manifest-path&#x3D;</p>\n</blockquote>\n<h4 id=\"常见的-Static-Pod\"><a href=\"#常见的-Static-Pod\" class=\"headerlink\" title=\"常见的 Static Pod\"></a>常见的 Static Pod</h4><ul>\n<li>etcd</li>\n<li>kube-apiserver</li>\n<li>kube-controller-manager</li>\n<li>kube-scheduler</li>\n</ul>\n<h3 id=\"卸载\"><a href=\"#卸载\" class=\"headerlink\" title=\"卸载\"></a>卸载</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo kubeadm reset -f</span><br><span class=\"line\">sudo rm -rf /var/lib/etcd /var/lib/kubelet /var/lib/dockershim /var/run/kubernetes /var/lib/cni /etc/kubernetes</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"多集群\"><a href=\"#多集群\" class=\"headerlink\" title=\"多集群\"></a>多集群</h3><h4 id=\"多个配置\"><a href=\"#多个配置\" class=\"headerlink\" title=\"多个配置\"></a>多个配置</h4><p>一台机器管理多个集群</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ ls -l ~/.kube/</span><br><span class=\"line\">总用量 36</span><br><span class=\"line\">drwxr-x--- 3 cs cs 4096 4月  20 14:37 cache</span><br><span class=\"line\">-rw------- 1 cs cs 9852 8月  10 21:58 config</span><br><span class=\"line\">-rw-r--r-- 1 cs cs 5597 8月  10 21:56 config1   #k8s 容器部署</span><br><span class=\"line\">-rw------- 1 cs cs 6201 8月   6 16:57 config2   #kubernetes二进制部署</span><br><span class=\"line\">drwxr-x--- 3 cs cs 4096 8月  10 21:58 http-cache</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"合并配置\"><a href=\"#合并配置\" class=\"headerlink\" title=\"合并配置\"></a>合并配置</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">KUBECONFIG=/home/cs/.kube/config1:/home/cs/.kube/config2 kubectl config view --flatten &gt;/home/cs/.kube/config</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/pics/k8s-view-cluster.png\"></p>\n<h4 id=\"获取集群配置\"><a href=\"#获取集群配置\" class=\"headerlink\" title=\"获取集群配置\"></a>获取集群配置</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ kubectl config get-contexts</span><br><span class=\"line\">CURRENT   NAME                   CLUSTER      AUTHINFO           NAMESPACE</span><br><span class=\"line\">          admin@kubernetes       kubernetes   admin              </span><br><span class=\"line\">*         kubernetes-admin@k8s   k8s          kubernetes-admin  </span><br></pre></td></tr></table></figure>\n\n<h5 id=\"容器部署\"><a href=\"#容器部署\" class=\"headerlink\" title=\"容器部署\"></a>容器部署</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ kubectl get cs</span><br><span class=\"line\">NAME                 STATUS    MESSAGE             ERROR</span><br><span class=\"line\">scheduler            Healthy   ok                  </span><br><span class=\"line\">controller-manager   Healthy   ok                  </span><br><span class=\"line\">etcd-0               Healthy   &#123;&quot;health&quot;:&quot;true&quot;&#125;   </span><br><span class=\"line\">cs@debian:~$ kubectl get node</span><br><span class=\"line\">NAME   STATUS   ROLES                  AGE     VERSION</span><br><span class=\"line\">k8s    Ready    control-plane,master   4m57s   v1.21.11</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h4 id=\"换集群\"><a href=\"#换集群\" class=\"headerlink\" title=\"换集群\"></a>换集群</h4><p>use-context</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">当前集群</span></span><br><span class=\"line\">cs@debian:~$ kubectl config current-context   </span><br><span class=\"line\">kubernetes-admin@k8s</span><br><span class=\"line\"></span><br><span class=\"line\">cs@debian:~$ kubectl config use-context admin@kubernetes   </span><br><span class=\"line\">Switched to context &quot;admin@kubernetes&quot;.</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"二进制部署\"><a href=\"#二进制部署\" class=\"headerlink\" title=\"二进制部署\"></a>二进制部署</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ kubectl get cs</span><br><span class=\"line\">NAME                 STATUS    MESSAGE              ERROR</span><br><span class=\"line\">scheduler            Healthy   ok                   </span><br><span class=\"line\">controller-manager   Healthy   ok                   </span><br><span class=\"line\">etcd-1               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;   </span><br><span class=\"line\">etcd-0               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;   </span><br><span class=\"line\">etcd-2               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;   </span><br><span class=\"line\">cs@debian:~$ kubectl get node</span><br><span class=\"line\">NAME       STATUS     ROLES    AGE    VERSION</span><br><span class=\"line\">master02   Ready      &lt;none&gt;   121d   v1.18.8</span><br><span class=\"line\">master03   Ready      &lt;none&gt;   121d   v1.18.8</span><br><span class=\"line\">node04     Ready      &lt;none&gt;   121d   v1.18.8</span><br><span class=\"line\">node05     NotReady   &lt;none&gt;   121d   v1.18.8</span><br><span class=\"line\">node06     Ready      &lt;none&gt;   121d   v1.18.8</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p><img src=\"/pics/k8s-more-cluster.png\"></p>\n<blockquote>\n<p>current-context 显示 current_context<br>delete-cluster  删除 kubeconfig 文件中指定的集群<br>delete-context  删除 kubeconfig 文件中指定的 context<br>get-clusters    显示 kubeconfig 文件中定义的集群<br>get-contexts    描述一个或多个 contexts<br>rename-context  从 kubeconfig 文件重命名上下文。<br>set             设置 kubeconfig 文件中的一个单个值<br>set-cluster     设置 kubeconfig 文件中的一个集群条目<br>set-context     设置 kubeconfig 文件中的一个 context 条目<br>set-credentials 设置 kubeconfig 文件中的一个用户条目<br>unset           取消设置 kubeconfig 文件中的一个单个值<br>use-context     设置 kubeconfig 文件中的当前上下文<br>view            显示合并的 kubeconfig 配置或一个指定的 kubeconfig 文件</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<h3 id=\"docker\"><a href=\"#docker\" class=\"headerlink\" title=\"docker\"></a>docker</h3><h4 id=\"daemon-json\"><a href=\"#daemon-json\" class=\"headerlink\" title=\"daemon.json\"></a>daemon.json</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[vagrant@k8s ~]$ sudo vi /etc/docker/daemon.json</span><br><span class=\"line\">[vagrant@k8s ~]$ docker info | grep Driver</span><br><span class=\"line\">Storage Driver: overlay2</span><br><span class=\"line\">Logging Driver: json-file</span><br><span class=\"line\">Cgroup Driver: cgroupfs</span><br><span class=\"line\">[vagrant@k8s ~]$ sudo systemctl restart docker </span><br><span class=\"line\">[vagrant@k8s ~]$ docker info | grep Driver</span><br><span class=\"line\">Storage Driver: overlay2</span><br><span class=\"line\">Logging Driver: json-file</span><br><span class=\"line\">Cgroup Driver: systemd</span><br><span class=\"line\">[vagrant@k8s ~]$ sudo cat  /etc/docker/daemon.json</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"> &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</span><br><span class=\"line\"> &quot;insecure-registries&quot;:[&quot;https://k8s.org&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>“exec-opts”: [“native.cgroupdriver&#x3D;systemd”]</p>\n</blockquote>\n<p> Error response from daemon: OCI runtime create failed: systemd cgroup flag passed, but systemd support for managing cgroups is not available</p>\n<p>&#x2F;etc&#x2F;sysconfig&#x2F;modules&#x2F;ipvs.modules</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;EOF</span><br><span class=\"line\">#!/bin/bash</span><br><span class=\"line\">modprobe -- br_netfilter</span><br><span class=\"line\">modprobe -- ip_vs</span><br><span class=\"line\">modprobe -- ip_vs_rr</span><br><span class=\"line\">modprobe -- ip_vs_wrr</span><br><span class=\"line\">modprobe -- ip_vs_sh</span><br><span class=\"line\">modprobe -- nf_conntrack_ipv4</span><br><span class=\"line\">EOF</span><br><span class=\"line\">chmod 755 /etc/sysconfig/modules/ipvs.modules</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> cat  /etc/sysctl.conf</span><br><span class=\"line\">net.ipv4.vs.conntrack=1</span><br><span class=\"line\">net.ipv4.vs.conn_reuse_mode=0</span><br><span class=\"line\">net.ipv4.vs.expire_nodest_conn=1</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"准备images-list\"><a href=\"#准备images-list\" class=\"headerlink\" title=\"准备images list\"></a>准备images list</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./kubeadm config images list</span><br><span class=\"line\">I0809 21:56:57.334915    4785 version.go:254] remote version is much newer: v1.24.3; falling back to: stable-1.21</span><br><span class=\"line\">k8s.gcr.io/kube-apiserver:v1.21.14</span><br><span class=\"line\">k8s.gcr.io/kube-controller-manager:v1.21.14</span><br><span class=\"line\">k8s.gcr.io/kube-scheduler:v1.21.14</span><br><span class=\"line\">k8s.gcr.io/kube-proxy:v1.21.14</span><br><span class=\"line\">k8s.gcr.io/pause:3.4.1</span><br><span class=\"line\">k8s.gcr.io/etcd:3.4.13-0</span><br><span class=\"line\">k8s.gcr.io/coredns/coredns:v1.8.0</span><br></pre></td></tr></table></figure>","more":"<h3 id=\"依赖conntrack\"><a href=\"#依赖conntrack\" class=\"headerlink\" title=\"依赖conntrack\"></a>依赖conntrack</h3><p><img src=\"/pics/k8s-not-ipvs-02.png\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install socat conntrack-tools</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"init配置文件\"><a href=\"#init配置文件\" class=\"headerlink\" title=\"init配置文件\"></a>init配置文件</h3><h4 id=\"命令生成默认文件\"><a href=\"#命令生成默认文件\" class=\"headerlink\" title=\"命令生成默认文件\"></a>命令生成默认文件</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubeadm config print init-defaults  &gt; config.yaml</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#生成KubeletConfiguration示例文件 </span><br><span class=\"line\">kubeadm config print init-defaults --component-configs KubeletConfiguration</span><br><span class=\"line\"></span><br><span class=\"line\">#生成KubeProxyConfiguration示例文件 </span><br><span class=\"line\">kubeadm config print init-defaults --component-configs KubeProxyConfiguration</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible k8s-108 -m copy -a &quot;src=/opt/kubernetes/client/k8s-1.21-11/bin/config.yaml dest=/opt/kubernetes  mode=0644&quot;   -b --become-method sudo --become-user root</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h4 id=\"config-yaml\"><a href=\"#config-yaml\" class=\"headerlink\" title=\"config.yaml\"></a>config.yaml</h4><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">kubeadm.k8s.io/v1beta2</span></span><br><span class=\"line\"><span class=\"attr\">bootstrapTokens:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">groups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">system:bootstrappers:kubeadm:default-node-token</span></span><br><span class=\"line\">  <span class=\"attr\">token:</span> <span class=\"string\">abcdef.0123456789abcdef</span></span><br><span class=\"line\">  <span class=\"attr\">ttl:</span> <span class=\"string\">24h0m0s</span></span><br><span class=\"line\">  <span class=\"attr\">usages:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">signing</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">authentication</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">InitConfiguration</span></span><br><span class=\"line\"><span class=\"attr\">localAPIEndpoint:</span></span><br><span class=\"line\">  <span class=\"attr\">advertiseAddress:</span> <span class=\"number\">192.168</span><span class=\"number\">.56</span><span class=\"number\">.108</span> <span class=\"comment\">#ip</span></span><br><span class=\"line\">  <span class=\"attr\">bindPort:</span> <span class=\"number\">6443</span></span><br><span class=\"line\"><span class=\"attr\">nodeRegistration:</span></span><br><span class=\"line\">  <span class=\"attr\">criSocket:</span> <span class=\"string\">/var/run/dockershim.sock</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">k8s</span> <span class=\"comment\"># hostname “xxx” could not be reached</span></span><br><span class=\"line\">  <span class=\"attr\">taints:</span> <span class=\"literal\">null</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiServer:</span></span><br><span class=\"line\">  <span class=\"attr\">timeoutForControlPlane:</span> <span class=\"string\">4m0s</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">kubeadm.k8s.io/v1beta2</span></span><br><span class=\"line\"><span class=\"attr\">certificatesDir:</span> <span class=\"string\">/etc/kubernetes/pki</span></span><br><span class=\"line\"><span class=\"attr\">clusterName:</span> <span class=\"string\">kubernetes</span></span><br><span class=\"line\"><span class=\"attr\">controllerManager:</span> &#123;&#125;</span><br><span class=\"line\"><span class=\"attr\">dns:</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">CoreDNS</span></span><br><span class=\"line\"><span class=\"attr\">etcd:</span></span><br><span class=\"line\">  <span class=\"attr\">local:</span></span><br><span class=\"line\">    <span class=\"attr\">dataDir:</span> <span class=\"string\">/var/lib/etcd</span></span><br><span class=\"line\"><span class=\"attr\">imageRepository:</span> <span class=\"string\">k8s.org/k8s</span>  <span class=\"comment\"># 镜像仓库源</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterConfiguration</span></span><br><span class=\"line\"><span class=\"attr\">kubernetesVersion:</span> <span class=\"number\">1.21</span><span class=\"number\">.12</span>  <span class=\"comment\">#版本</span></span><br><span class=\"line\"><span class=\"attr\">networking:</span></span><br><span class=\"line\">  <span class=\"attr\">dnsDomain:</span> <span class=\"string\">cluster.local</span></span><br><span class=\"line\">  <span class=\"attr\">serviceSubnet:</span> <span class=\"number\">10.96</span><span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"string\">/12</span></span><br><span class=\"line\"><span class=\"attr\">scheduler:</span> &#123;&#125;</span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">kubelet.config.k8s.io/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">KubeletConfiguration</span></span><br><span class=\"line\"><span class=\"attr\">cgroupDriver:</span> <span class=\"string\">systemd</span></span><br><span class=\"line\"><span class=\"attr\">failSwapOn:</span> <span class=\"literal\">False</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">kubeproxy.config.k8s.io/v1alpha1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">KubeProxyConfiguration</span></span><br><span class=\"line\"><span class=\"attr\">ipvs:</span></span><br><span class=\"line\">  <span class=\"attr\">minSyncPeriod:</span> <span class=\"string\">0s</span></span><br><span class=\"line\">  <span class=\"attr\">scheduler:</span> <span class=\"string\">&quot;rr&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">syncPeriod:</span> <span class=\"string\">30s</span></span><br><span class=\"line\"><span class=\"attr\">mode:</span> <span class=\"string\">&quot;ipvs&quot;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"kubectl\"><a href=\"#kubectl\" class=\"headerlink\" title=\"kubectl\"></a>kubectl</h4><p><img src=\"/pics/k8s-get-pend-01.png\"></p>\n<p>docker: network plugin is not ready: cni config uninitialized</p>\n<p><a href=\"/linux/k8s/kubelet#id-service\">kubelet.service详解</a></p>\n<h3 id=\"初始化过程\"><a href=\"#初始化过程\" class=\"headerlink\" title=\"初始化过程\"></a>初始化过程</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[vagrant@k8s kubernetes]$ sudo ./bin/kubeadm   init --config config.yaml</span><br><span class=\"line\">W0809 20:30:08.653353    3073 kubelet.go:215] detected &quot;cgroupfs&quot; as the Docker cgroup driver, the provided value &quot;systemd&quot; in &quot;KubeletConfiguration&quot; will be overrided</span><br><span class=\"line\">[init] Using Kubernetes version: v1.21.12</span><br><span class=\"line\">[preflight] Running pre-flight checks</span><br><span class=\"line\">\t[WARNING IsDockerSystemdCheck]: detected &quot;cgroupfs&quot; as the Docker cgroup driver. The recommended driver is &quot;systemd&quot;. Please follow the guide at https://kubernetes.io/docs/setup/cri/</span><br><span class=\"line\">\t[WARNING Service-Kubelet]: kubelet service is not enabled, please run &#x27;systemctl enable kubelet.service&#x27;</span><br><span class=\"line\">[preflight] Pulling images required for setting up a Kubernetes cluster</span><br><span class=\"line\">[preflight] This might take a minute or two, depending on the speed of your internet connection</span><br><span class=\"line\">[preflight] You can also perform this action in beforehand using &#x27;kubeadm config images pull&#x27;</span><br><span class=\"line\">[certs] Using certificateDir folder &quot;/etc/kubernetes/pki&quot;</span><br><span class=\"line\">[certs] Generating &quot;ca&quot; certificate and key</span><br><span class=\"line\">[certs] Generating &quot;apiserver&quot; certificate and key</span><br><span class=\"line\">[certs] apiserver serving cert is signed for DNS names [k8s kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 192.168.56.108]</span><br><span class=\"line\">[certs] Generating &quot;apiserver-kubelet-client&quot; certificate and key</span><br><span class=\"line\">[certs] Generating &quot;front-proxy-ca&quot; certificate and key</span><br><span class=\"line\">[certs] Generating &quot;front-proxy-client&quot; certificate and key</span><br><span class=\"line\">[certs] Generating &quot;etcd/ca&quot; certificate and key</span><br><span class=\"line\">[certs] Generating &quot;etcd/server&quot; certificate and key</span><br><span class=\"line\">[certs] etcd/server serving cert is signed for DNS names [k8s localhost] and IPs [192.168.56.108 127.0.0.1 ::1]</span><br><span class=\"line\">[certs] Generating &quot;etcd/peer&quot; certificate and key</span><br><span class=\"line\">[certs] etcd/peer serving cert is signed for DNS names [k8s localhost] and IPs [192.168.56.108 127.0.0.1 ::1]</span><br><span class=\"line\">[certs] Generating &quot;etcd/healthcheck-client&quot; certificate and key</span><br><span class=\"line\">[certs] Generating &quot;apiserver-etcd-client&quot; certificate and key</span><br><span class=\"line\">[certs] Generating &quot;sa&quot; key and public key</span><br><span class=\"line\">[kubeconfig] Using kubeconfig folder &quot;/etc/kubernetes&quot;</span><br><span class=\"line\">[kubeconfig] Writing &quot;admin.conf&quot; kubeconfig file</span><br><span class=\"line\">[kubeconfig] Writing &quot;kubelet.conf&quot; kubeconfig file</span><br><span class=\"line\">[kubeconfig] Writing &quot;controller-manager.conf&quot; kubeconfig file</span><br><span class=\"line\">[kubeconfig] Writing &quot;scheduler.conf&quot; kubeconfig file</span><br><span class=\"line\">[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span><br><span class=\"line\">[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;</span><br><span class=\"line\">[kubelet-start] Starting the kubelet</span><br><span class=\"line\">[control-plane] Using manifest folder &quot;/etc/kubernetes/manifests&quot;</span><br><span class=\"line\">[control-plane] Creating static Pod manifest for &quot;kube-apiserver&quot;</span><br><span class=\"line\">[control-plane] Creating static Pod manifest for &quot;kube-controller-manager&quot;</span><br><span class=\"line\">[control-plane] Creating static Pod manifest for &quot;kube-scheduler&quot;</span><br><span class=\"line\">[etcd] Creating static Pod manifest for local etcd in &quot;/etc/kubernetes/manifests&quot;</span><br><span class=\"line\">[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory &quot;/etc/kubernetes/manifests&quot;. This can take up to 4m0s</span><br><span class=\"line\">[apiclient] All control plane components are healthy after 12.505234 seconds</span><br><span class=\"line\">[upload-config] Storing the configuration used in ConfigMap &quot;kubeadm-config&quot; in the &quot;kube-system&quot; Namespace</span><br><span class=\"line\">[kubelet] Creating a ConfigMap &quot;kubelet-config-1.21&quot; in namespace kube-system with the configuration for the kubelets in the cluster</span><br><span class=\"line\">[upload-certs] Skipping phase. Please see --upload-certs</span><br><span class=\"line\">[mark-control-plane] Marking the node k8s as control-plane by adding the labels: [node-role.kubernetes.io/master(deprecated) node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]</span><br><span class=\"line\">[mark-control-plane] Marking the node k8s as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]</span><br><span class=\"line\">[bootstrap-token] Using token: abcdef.0123456789abcdef</span><br><span class=\"line\">[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles</span><br><span class=\"line\">[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to get nodes</span><br><span class=\"line\">[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials</span><br><span class=\"line\">[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token</span><br><span class=\"line\">[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster</span><br><span class=\"line\">[bootstrap-token] Creating the &quot;cluster-info&quot; ConfigMap in the &quot;kube-public&quot; namespace</span><br><span class=\"line\">[kubelet-finalize] Updating &quot;/etc/kubernetes/kubelet.conf&quot; to point to a rotatable kubelet client certificate and key</span><br><span class=\"line\">[addons] Applied essential addon: CoreDNS</span><br><span class=\"line\">[addons] Applied essential addon: kube-proxy</span><br><span class=\"line\"></span><br><span class=\"line\">Your Kubernetes control-plane has initialized successfully!</span><br><span class=\"line\"></span><br><span class=\"line\">To start using your cluster, you need to run the following as a regular user:</span><br><span class=\"line\"></span><br><span class=\"line\">  mkdir -p $HOME/.kube</span><br><span class=\"line\">  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class=\"line\">  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class=\"line\"></span><br><span class=\"line\">Alternatively, if you are the root user, you can run:</span><br><span class=\"line\"></span><br><span class=\"line\">  export KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class=\"line\"></span><br><span class=\"line\">You should now deploy a pod network to the cluster.</span><br><span class=\"line\">Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:</span><br><span class=\"line\">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class=\"line\"></span><br><span class=\"line\">Then you can join any number of worker nodes by running the following on each as root:</span><br><span class=\"line\"></span><br><span class=\"line\">kubeadm join 192.168.56.108:6443 --token abcdef.0123456789abcdef \\</span><br><span class=\"line\">\t--discovery-token-ca-cert-hash sha256:01661c34149742e27fa96db2f1c4a8d4675d2f0b5133f8cd25a45e031eb23653 </span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"节点配置文件\"><a href=\"#节点配置文件\" class=\"headerlink\" title=\"节点配置文件\"></a>节点配置文件</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubeadm config print join-defaults &gt; join-config.yaml</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create clusterrolebinding kubelet-bootstrap --clusterrole=system:node-bootstrapper --user=kubelet-bootstrap</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>error: failed to run Kubelet: cannot create certificate signing request: certificatesigningrequests.certificates.k8s.io is forbidden: User “kubelet-bootstrap” cannot create certificatesigningrequests.certificates.k8s.io at the cluster scope</p>\n</blockquote>\n<h3 id=\"网络插件podnetwork\"><a href=\"#网络插件podnetwork\" class=\"headerlink\" title=\"网络插件podnetwork\"></a>网络插件podnetwork</h3><p><a href=\"https://kubernetes.io/docs/concepts/cluster-administration/addons/\">https://kubernetes.io/docs/concepts/cluster-administration/addons/</a></p>\n<h4 id=\"flanneld\"><a href=\"#flanneld\" class=\"headerlink\" title=\"flanneld\"></a>flanneld</h4><p><a href=\"/linux/k8s/flanneld\">查看flanneld.yaml</a></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible k8s-108 -m copy -a &quot;src=/home/cs/oss/0s/k8s/kube/kube-flanneld.yml  dest=/opt/kubernetes  mode=0644&quot;   -b --become-method sudo --become-user root</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[vagrant@k8s kubernetes]$ kubectl apply -f kube-flanneld.yaml </span><br><span class=\"line\">Warning: policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+</span><br><span class=\"line\">podsecuritypolicy.policy/psp.flannel.unprivileged created</span><br><span class=\"line\">Warning: rbac.authorization.k8s.io/v1beta1 ClusterRole is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRole</span><br><span class=\"line\">clusterrole.rbac.authorization.k8s.io/flannel created</span><br><span class=\"line\">Warning: rbac.authorization.k8s.io/v1beta1 ClusterRoleBinding is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRoleBinding</span><br><span class=\"line\">clusterrolebinding.rbac.authorization.k8s.io/flannel created</span><br><span class=\"line\">serviceaccount/flannel created</span><br><span class=\"line\">configmap/kube-flannel-cfg created</span><br><span class=\"line\">daemonset.apps/kube-flannel-ds-amd64 created</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"calico\"><a href=\"#calico\" class=\"headerlink\" title=\"calico\"></a>calico</h4><p><a href=\"https://docs.projectcalico.org/getting-started/kubernetes/self-managed-onprem/onpremises\">https://docs.projectcalico.org/getting-started/kubernetes/self-managed-onprem/onpremises</a></p>\n<p>calico.yaml <a href=\"https://docs.projectcalico.org/manifests/calico.yaml\">https://docs.projectcalico.org/manifests/calico.yaml</a></p>\n<h3 id=\"kubectl权限\"><a href=\"#kubectl权限\" class=\"headerlink\" title=\"kubectl权限\"></a>kubectl权限</h3><h4 id=\"x2F-kube-x2F-config\"><a href=\"#x2F-kube-x2F-config\" class=\"headerlink\" title=\"~&#x2F;.kube&#x2F;config\"></a>~&#x2F;.kube&#x2F;config</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p $HOME/.kube</span><br><span class=\"line\">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class=\"line\">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"组件状态cs\"><a href=\"#组件状态cs\" class=\"headerlink\" title=\"组件状态cs\"></a>组件状态cs</h3><h4 id=\"Unhealthy\"><a href=\"#Unhealthy\" class=\"headerlink\" title=\"Unhealthy\"></a>Unhealthy</h4><p><img src=\"/pics/k8s-get-cs-01.png\"></p>\n<p>注释<code>port=0</code>行</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[vagrant@k8s kubernetes]$ sudo sed -i &#x27;/port=0/s/^/#/&#x27;  /etc/kubernetes/manifests/kube-controller-manager.yaml</span><br><span class=\"line\">[vagrant@k8s kubernetes]$ sudo sed -i &#x27;/port=0/s/^/#/&#x27;  /etc/kubernetes/manifests/kube-scheduler.yaml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/pics/k8s-get-cs-02.png\"></p>\n<h3 id=\"加入集群\"><a href=\"#加入集群\" class=\"headerlink\" title=\"加入集群\"></a>加入集群</h3><p>集群初始化时的添加命令</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubeadm join 192.168.56.108:6443 --token abcdef.0123456789abcdef \\</span><br><span class=\"line\">\t--discovery-token-ca-cert-hash sha256:01661c34149742e27fa96db2f1c4a8d4675d2f0b5133f8cd25a45e031eb23653</span><br></pre></td></tr></table></figure>\n\n<p>命令方式获取join参数</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubeadm token create --print-join-command</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>重新生成certificate-key,生成用于加入控制平面的secret</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubeadm init phase upload-certs --upload-certs</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Using certificate key:xxxx</p>\n</blockquote>\n<h4 id=\"加入控制节点\"><a href=\"#加入控制节点\" class=\"headerlink\" title=\"加入控制节点\"></a>加入控制节点</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubeadm join 192.168.56.108:6443 --token abcdef.0123456789abcdef \\</span><br><span class=\"line\">\t--discovery-token-ca-cert-hash sha256:01661c34149742e27fa96db2f1c4a8d4675d2f0b5133f8cd25a45e031eb23653    --control-plane --certificate-key xxxx</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<h3 id=\"Pending状态\"><a href=\"#Pending状态\" class=\"headerlink\" title=\"Pending状态\"></a>Pending状态</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl logs kube-flannel-ds-amd64-7wjtn -n kube-system</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Error registering network: failed to acquire lease: node “k8s” pod cidr not assigned</p>\n</blockquote>\n<p><img src=\"/pics/k8s-get-node-01.png\"></p>\n<p>master节点一直notready  和  coredns pod一直pending</p>\n<p>安装flannel</p>\n<p><img src=\"/pics/k8s-get-node-02.png\"></p>\n<h3 id=\"pod-network-cidr\"><a href=\"#pod-network-cidr\" class=\"headerlink\" title=\"pod-network-cidr\"></a>pod-network-cidr</h3><h4 id=\"修改\"><a href=\"#修改\" class=\"headerlink\" title=\"修改\"></a>修改</h4><p>–pod-network-cidr</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1）kubectl -n kube-system edit cm kubeadm-config</span><br><span class=\"line\">2）vim /etc/kubernetes/manifests/kube-scheduler.yaml</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"检查配置\"><a href=\"#检查配置\" class=\"headerlink\" title=\"检查配置\"></a>检查配置</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl cluster-info dump | grep -m 1 cluster-cidr</span><br></pre></td></tr></table></figure>\n\n<p><strong>kube-proxy的cluster-cidr与kuber-controller-manager的cluster-cidr</strong></p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> kubectl scale deployment --replicas=<span class=\"number\">0</span> dns-autoscaler -n kube-system</span><br><span class=\"line\">deployment.extensions/dns-autoscaler scaled</span><br><span class=\"line\"><span class=\"meta\"># kubectl patch deployment coredns -p &#x27;&#123;<span class=\"string\">&quot;spec&quot;</span>:&#123;<span class=\"string\">&quot;replicas&quot;</span>:17&#125;&#125;&#x27; -n kube-system</span></span><br><span class=\"line\">deployment.extensions/coredns patched</span><br><span class=\"line\"><span class=\"meta\"># kubectl get pod -n kube-system |grep coredns |wc -l</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"重启\"><a href=\"#重启\" class=\"headerlink\" title=\"重启\"></a>重启</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl status kubelet</span><br><span class=\"line\">sudo systemctl start kubelet</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p><em>静态 Pod</em> 在指定的节点上由 kubelet 守护进程直接管理，不需要 <a href=\"https://kubernetes.io/zh-cn/docs/reference/command-line-tools-reference/kube-apiserver/\">API 服务器</a> 监管,kubelet 监视每个静态 Pod（在它崩溃之后重新启动）</p>\n<p>–pod-manifest-path&#x3D;</p>\n</blockquote>\n<h4 id=\"常见的-Static-Pod\"><a href=\"#常见的-Static-Pod\" class=\"headerlink\" title=\"常见的 Static Pod\"></a>常见的 Static Pod</h4><ul>\n<li>etcd</li>\n<li>kube-apiserver</li>\n<li>kube-controller-manager</li>\n<li>kube-scheduler</li>\n</ul>\n<h3 id=\"卸载\"><a href=\"#卸载\" class=\"headerlink\" title=\"卸载\"></a>卸载</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo kubeadm reset -f</span><br><span class=\"line\">sudo rm -rf /var/lib/etcd /var/lib/kubelet /var/lib/dockershim /var/run/kubernetes /var/lib/cni /etc/kubernetes</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"多集群\"><a href=\"#多集群\" class=\"headerlink\" title=\"多集群\"></a>多集群</h3><h4 id=\"多个配置\"><a href=\"#多个配置\" class=\"headerlink\" title=\"多个配置\"></a>多个配置</h4><p>一台机器管理多个集群</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ ls -l ~/.kube/</span><br><span class=\"line\">总用量 36</span><br><span class=\"line\">drwxr-x--- 3 cs cs 4096 4月  20 14:37 cache</span><br><span class=\"line\">-rw------- 1 cs cs 9852 8月  10 21:58 config</span><br><span class=\"line\">-rw-r--r-- 1 cs cs 5597 8月  10 21:56 config1   #k8s 容器部署</span><br><span class=\"line\">-rw------- 1 cs cs 6201 8月   6 16:57 config2   #kubernetes二进制部署</span><br><span class=\"line\">drwxr-x--- 3 cs cs 4096 8月  10 21:58 http-cache</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"合并配置\"><a href=\"#合并配置\" class=\"headerlink\" title=\"合并配置\"></a>合并配置</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">KUBECONFIG=/home/cs/.kube/config1:/home/cs/.kube/config2 kubectl config view --flatten &gt;/home/cs/.kube/config</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/pics/k8s-view-cluster.png\"></p>\n<h4 id=\"获取集群配置\"><a href=\"#获取集群配置\" class=\"headerlink\" title=\"获取集群配置\"></a>获取集群配置</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ kubectl config get-contexts</span><br><span class=\"line\">CURRENT   NAME                   CLUSTER      AUTHINFO           NAMESPACE</span><br><span class=\"line\">          admin@kubernetes       kubernetes   admin              </span><br><span class=\"line\">*         kubernetes-admin@k8s   k8s          kubernetes-admin  </span><br></pre></td></tr></table></figure>\n\n<h5 id=\"容器部署\"><a href=\"#容器部署\" class=\"headerlink\" title=\"容器部署\"></a>容器部署</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ kubectl get cs</span><br><span class=\"line\">NAME                 STATUS    MESSAGE             ERROR</span><br><span class=\"line\">scheduler            Healthy   ok                  </span><br><span class=\"line\">controller-manager   Healthy   ok                  </span><br><span class=\"line\">etcd-0               Healthy   &#123;&quot;health&quot;:&quot;true&quot;&#125;   </span><br><span class=\"line\">cs@debian:~$ kubectl get node</span><br><span class=\"line\">NAME   STATUS   ROLES                  AGE     VERSION</span><br><span class=\"line\">k8s    Ready    control-plane,master   4m57s   v1.21.11</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h4 id=\"换集群\"><a href=\"#换集群\" class=\"headerlink\" title=\"换集群\"></a>换集群</h4><p>use-context</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">当前集群</span></span><br><span class=\"line\">cs@debian:~$ kubectl config current-context   </span><br><span class=\"line\">kubernetes-admin@k8s</span><br><span class=\"line\"></span><br><span class=\"line\">cs@debian:~$ kubectl config use-context admin@kubernetes   </span><br><span class=\"line\">Switched to context &quot;admin@kubernetes&quot;.</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"二进制部署\"><a href=\"#二进制部署\" class=\"headerlink\" title=\"二进制部署\"></a>二进制部署</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ kubectl get cs</span><br><span class=\"line\">NAME                 STATUS    MESSAGE              ERROR</span><br><span class=\"line\">scheduler            Healthy   ok                   </span><br><span class=\"line\">controller-manager   Healthy   ok                   </span><br><span class=\"line\">etcd-1               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;   </span><br><span class=\"line\">etcd-0               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;   </span><br><span class=\"line\">etcd-2               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;   </span><br><span class=\"line\">cs@debian:~$ kubectl get node</span><br><span class=\"line\">NAME       STATUS     ROLES    AGE    VERSION</span><br><span class=\"line\">master02   Ready      &lt;none&gt;   121d   v1.18.8</span><br><span class=\"line\">master03   Ready      &lt;none&gt;   121d   v1.18.8</span><br><span class=\"line\">node04     Ready      &lt;none&gt;   121d   v1.18.8</span><br><span class=\"line\">node05     NotReady   &lt;none&gt;   121d   v1.18.8</span><br><span class=\"line\">node06     Ready      &lt;none&gt;   121d   v1.18.8</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p><img src=\"/pics/k8s-more-cluster.png\"></p>\n<blockquote>\n<p>current-context 显示 current_context<br>delete-cluster  删除 kubeconfig 文件中指定的集群<br>delete-context  删除 kubeconfig 文件中指定的 context<br>get-clusters    显示 kubeconfig 文件中定义的集群<br>get-contexts    描述一个或多个 contexts<br>rename-context  从 kubeconfig 文件重命名上下文。<br>set             设置 kubeconfig 文件中的一个单个值<br>set-cluster     设置 kubeconfig 文件中的一个集群条目<br>set-context     设置 kubeconfig 文件中的一个 context 条目<br>set-credentials 设置 kubeconfig 文件中的一个用户条目<br>unset           取消设置 kubeconfig 文件中的一个单个值<br>use-context     设置 kubeconfig 文件中的当前上下文<br>view            显示合并的 kubeconfig 配置或一个指定的 kubeconfig 文件</p>\n</blockquote>"},{"title":"kubelet组件","date":"2022-08-17T13:27:19.000Z","_content":"\n\n\n\n\n#### 二进制\n\nversion 1.18\n\n##### kubelet.env\n\n```shell\n[vagrant@k8s kubernetes]$ cat > /opt/kubernetes/kubelet/kubelet.env <<EOF\nKUBELET_OPTIONS=\" --pod-infra-container-image=k8s.org/k8s/pause:3.2   \\\n--bootstrap-kubeconfig=/opt/kubernetes/config/bootstrap.kubeconfig   \\\n--kubeconfig=/opt/kubernetes/config/kubelet.kubeconfig   \\\n--config=/opt/kubernetes/kubelet/kubelet-config.yaml    \\\n--cni-bin-dir=/opt/kubernetes/cni/bin    \\\n--cni-conf-dir=/opt/kubernetes/cni/net.d    \\\n--network-plugin=cni    \\\n-runtime-cgroups=/systemd/system.slice    \\\n--log-dir=/var/log/kubernetes/kubelet     \\\n--logtostderr=false    \\\n--v=2\"\nEOF\n```\n\n<!--more-->\n\n##### kubelet-config.yaml\n\n```\napiVersion: kubelet.config.k8s.io/v1beta1\nkind: KubeletConfiguration\naddress: \"192.168.56.102\"\nport: 10250\nhealthzBindAddress: \"192.168.56.102\"\nhealthzPort: 10248\nreadOnlyPort: 0\ncgroupDriver: \"cgroupfs\"\nclusterDomain: \"cluster.local\"\nclusterDNS: [\"121.21.0.0\"]\nfailSwapOn: false\ntlsCertFile: \"/opt/kubernetes/pem/kubelet.pem\"\ntlsPrivateKeyFile: \"/opt/kubernetes/pem/kubelet-key.pem\"\nauthentication:\n    x509:\n        clientCAFile: \"/opt/kubernetes/pem/ca.pem\"\n    webhook:\n        enabled: true\n        cacheTTL: \"2m0s\"\n    anonymous:\n        enabled: false\nauthorization:\n    mode: Webhook\n    webhook:\n        cacheAuthorizedTTL: \"5m0s\"\n        cacheUnauthorizedTTL: \"30s\"\nhairpinMode: \"promiscuous-bridge\"\nserializeImagePulls: false\nfeatureGates:\n    RotateKubeletClientCertificate: true\n    RotateKubeletServerCertificate: true\n```\n\n\n\n#### 容器\n\nversion 1.22\n\n##### kubelet.env\n\n```shell\n[vagrant@k8s kubernetes]$ cat > /opt/kubernetes/kubelet.env <<EOF\n KUBELET_OPTIONS=\" --hostname-override=k8s  \\\n --pod-infra-container-image=k8s.org/k8s/pause:3.4.1 \\\n --kubeconfig=/etc/kubernetes/kubelet.conf    \\\n --config=/var/lib/kubelet/config.yaml     \\\n --register-node=true        \\\n --runtime-cgroups=/systemd/system.slice    \\\n --logtostderr=true \"\nEOF\n```\n\n> --network-plugin=cni  **去掉**\n\n\n\n##### kubelet.conf\n\n/etc/kubernetes/kubelet.conf\n\n```\napiVersion: v1\nclusters:\n- cluster:\n    certificate-authority-data: xxxx..xxxxxxx==\n    server: https://192.168.56.108:6443\n  name: k8s\ncontexts:\n- context:\n    cluster: k8s\n    user: system:node:k8s\n  name: system:node:k8s@k8s\ncurrent-context: system:node:k8s@k8s\nkind: Config\npreferences: {}\nusers:\n- name: system:node:k8s\n  user:\n    client-certificate: /var/lib/kubelet/pki/kubelet-client-current.pem\n    client-key: /var/lib/kubelet/pki/kubelet-client-current.pem\n```\n\n\n\n##### config.yaml\n\n/var/lib/kubelet/config.yaml\n\n```\napiVersion: kubelet.config.k8s.io/v1beta1\nauthentication:\n  anonymous:\n    enabled: false\n  webhook:\n    cacheTTL: 0s\n    enabled: true\n  x509:\n    clientCAFile: /etc/kubernetes/pki/ca.crt\nauthorization:\n  mode: Webhook\n  webhook:\n    cacheAuthorizedTTL: 0s\n    cacheUnauthorizedTTL: 0s\ncgroupDriver: cgroupfs\nclusterDNS:\n- 10.96.0.10\nclusterDomain: cluster.local\ncpuManagerReconcilePeriod: 0s\nevictionPressureTransitionPeriod: 0s\nfailSwapOn: false\nfileCheckFrequency: 0s\nhealthzBindAddress: 127.0.0.1\nhealthzPort: 10248\nhttpCheckFrequency: 0s\nimageMinimumGCAge: 0s\nkind: KubeletConfiguration\nlogging: {}\nnodeStatusReportFrequency: 0s\nnodeStatusUpdateFrequency: 0s\nrotateCertificates: true\nruntimeRequestTimeout: 0s\nshutdownGracePeriod: 0s\nshutdownGracePeriodCriticalPods: 0s\nstaticPodPath: /etc/kubernetes/manifests\nstreamingConnectionIdleTimeout: 0s\nsyncFrequency: 0s\nvolumeStatsAggPeriod: 0s\n```\n\n\n\n#### service<a id=\"id-service\"/>\n\n##### kubelet.service\n\n```\n[vagrant@k8s kubernetes]$ cat >/usr/lib/systemd/system/kubelet.service <<EOF\n[Unit]\nDescription=Kubernetes Kubelet Server\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nWorkingDirectory=/var/lib/kubelet\nEnvironmentFile=/opt/kubernetes/kubelet.env\nExecStart=/opt/kubernetes/bin/kubelet  $KUBELET_OPTIONS\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\nEOF\n```\n\nkubeadm部署,不用启动,会自动拉起\n\n初始化自动生成\n\n/etc/kubernetes/kubelet.conf\n\n/var/lib/kubelet/config.yaml\n\n\n\n开机自启动\n\n```\nsystemctl enable kubelet\n```\n\n","source":"_posts/linux/k8s/kubelet.md","raw":"---\ntitle: kubelet组件\npermalink: linux/k8s/kubelet/\ntags:\n  - kubelet\ncategories:\n  - linux\n  - k8s\ndate: 2022-08-17 21:27:19\n---\n\n\n\n\n\n#### 二进制\n\nversion 1.18\n\n##### kubelet.env\n\n```shell\n[vagrant@k8s kubernetes]$ cat > /opt/kubernetes/kubelet/kubelet.env <<EOF\nKUBELET_OPTIONS=\" --pod-infra-container-image=k8s.org/k8s/pause:3.2   \\\n--bootstrap-kubeconfig=/opt/kubernetes/config/bootstrap.kubeconfig   \\\n--kubeconfig=/opt/kubernetes/config/kubelet.kubeconfig   \\\n--config=/opt/kubernetes/kubelet/kubelet-config.yaml    \\\n--cni-bin-dir=/opt/kubernetes/cni/bin    \\\n--cni-conf-dir=/opt/kubernetes/cni/net.d    \\\n--network-plugin=cni    \\\n-runtime-cgroups=/systemd/system.slice    \\\n--log-dir=/var/log/kubernetes/kubelet     \\\n--logtostderr=false    \\\n--v=2\"\nEOF\n```\n\n<!--more-->\n\n##### kubelet-config.yaml\n\n```\napiVersion: kubelet.config.k8s.io/v1beta1\nkind: KubeletConfiguration\naddress: \"192.168.56.102\"\nport: 10250\nhealthzBindAddress: \"192.168.56.102\"\nhealthzPort: 10248\nreadOnlyPort: 0\ncgroupDriver: \"cgroupfs\"\nclusterDomain: \"cluster.local\"\nclusterDNS: [\"121.21.0.0\"]\nfailSwapOn: false\ntlsCertFile: \"/opt/kubernetes/pem/kubelet.pem\"\ntlsPrivateKeyFile: \"/opt/kubernetes/pem/kubelet-key.pem\"\nauthentication:\n    x509:\n        clientCAFile: \"/opt/kubernetes/pem/ca.pem\"\n    webhook:\n        enabled: true\n        cacheTTL: \"2m0s\"\n    anonymous:\n        enabled: false\nauthorization:\n    mode: Webhook\n    webhook:\n        cacheAuthorizedTTL: \"5m0s\"\n        cacheUnauthorizedTTL: \"30s\"\nhairpinMode: \"promiscuous-bridge\"\nserializeImagePulls: false\nfeatureGates:\n    RotateKubeletClientCertificate: true\n    RotateKubeletServerCertificate: true\n```\n\n\n\n#### 容器\n\nversion 1.22\n\n##### kubelet.env\n\n```shell\n[vagrant@k8s kubernetes]$ cat > /opt/kubernetes/kubelet.env <<EOF\n KUBELET_OPTIONS=\" --hostname-override=k8s  \\\n --pod-infra-container-image=k8s.org/k8s/pause:3.4.1 \\\n --kubeconfig=/etc/kubernetes/kubelet.conf    \\\n --config=/var/lib/kubelet/config.yaml     \\\n --register-node=true        \\\n --runtime-cgroups=/systemd/system.slice    \\\n --logtostderr=true \"\nEOF\n```\n\n> --network-plugin=cni  **去掉**\n\n\n\n##### kubelet.conf\n\n/etc/kubernetes/kubelet.conf\n\n```\napiVersion: v1\nclusters:\n- cluster:\n    certificate-authority-data: xxxx..xxxxxxx==\n    server: https://192.168.56.108:6443\n  name: k8s\ncontexts:\n- context:\n    cluster: k8s\n    user: system:node:k8s\n  name: system:node:k8s@k8s\ncurrent-context: system:node:k8s@k8s\nkind: Config\npreferences: {}\nusers:\n- name: system:node:k8s\n  user:\n    client-certificate: /var/lib/kubelet/pki/kubelet-client-current.pem\n    client-key: /var/lib/kubelet/pki/kubelet-client-current.pem\n```\n\n\n\n##### config.yaml\n\n/var/lib/kubelet/config.yaml\n\n```\napiVersion: kubelet.config.k8s.io/v1beta1\nauthentication:\n  anonymous:\n    enabled: false\n  webhook:\n    cacheTTL: 0s\n    enabled: true\n  x509:\n    clientCAFile: /etc/kubernetes/pki/ca.crt\nauthorization:\n  mode: Webhook\n  webhook:\n    cacheAuthorizedTTL: 0s\n    cacheUnauthorizedTTL: 0s\ncgroupDriver: cgroupfs\nclusterDNS:\n- 10.96.0.10\nclusterDomain: cluster.local\ncpuManagerReconcilePeriod: 0s\nevictionPressureTransitionPeriod: 0s\nfailSwapOn: false\nfileCheckFrequency: 0s\nhealthzBindAddress: 127.0.0.1\nhealthzPort: 10248\nhttpCheckFrequency: 0s\nimageMinimumGCAge: 0s\nkind: KubeletConfiguration\nlogging: {}\nnodeStatusReportFrequency: 0s\nnodeStatusUpdateFrequency: 0s\nrotateCertificates: true\nruntimeRequestTimeout: 0s\nshutdownGracePeriod: 0s\nshutdownGracePeriodCriticalPods: 0s\nstaticPodPath: /etc/kubernetes/manifests\nstreamingConnectionIdleTimeout: 0s\nsyncFrequency: 0s\nvolumeStatsAggPeriod: 0s\n```\n\n\n\n#### service<a id=\"id-service\"/>\n\n##### kubelet.service\n\n```\n[vagrant@k8s kubernetes]$ cat >/usr/lib/systemd/system/kubelet.service <<EOF\n[Unit]\nDescription=Kubernetes Kubelet Server\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nWorkingDirectory=/var/lib/kubelet\nEnvironmentFile=/opt/kubernetes/kubelet.env\nExecStart=/opt/kubernetes/bin/kubelet  $KUBELET_OPTIONS\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\nEOF\n```\n\nkubeadm部署,不用启动,会自动拉起\n\n初始化自动生成\n\n/etc/kubernetes/kubelet.conf\n\n/var/lib/kubelet/config.yaml\n\n\n\n开机自启动\n\n```\nsystemctl enable kubelet\n```\n\n","slug":"linux/k8s/kubelet","published":1,"updated":"2022-08-28T09:10:00.936Z","__permalink":"linux/k8s/kubelet/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gttd002dgwi57ycd0o4b","content":"<h4 id=\"二进制\"><a href=\"#二进制\" class=\"headerlink\" title=\"二进制\"></a>二进制</h4><p>version 1.18</p>\n<h5 id=\"kubelet-env\"><a href=\"#kubelet-env\" class=\"headerlink\" title=\"kubelet.env\"></a>kubelet.env</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[vagrant@k8s kubernetes]$ cat &gt; /opt/kubernetes/kubelet/kubelet.env &lt;&lt;EOF</span><br><span class=\"line\">KUBELET_OPTIONS=&quot; --pod-infra-container-image=k8s.org/k8s/pause:3.2   \\</span><br><span class=\"line\">--bootstrap-kubeconfig=/opt/kubernetes/config/bootstrap.kubeconfig   \\</span><br><span class=\"line\">--kubeconfig=/opt/kubernetes/config/kubelet.kubeconfig   \\</span><br><span class=\"line\">--config=/opt/kubernetes/kubelet/kubelet-config.yaml    \\</span><br><span class=\"line\">--cni-bin-dir=/opt/kubernetes/cni/bin    \\</span><br><span class=\"line\">--cni-conf-dir=/opt/kubernetes/cni/net.d    \\</span><br><span class=\"line\">--network-plugin=cni    \\</span><br><span class=\"line\">-runtime-cgroups=/systemd/system.slice    \\</span><br><span class=\"line\">--log-dir=/var/log/kubernetes/kubelet     \\</span><br><span class=\"line\">--logtostderr=false    \\</span><br><span class=\"line\">--v=2&quot;</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n<h5 id=\"kubelet-config-yaml\"><a href=\"#kubelet-config-yaml\" class=\"headerlink\" title=\"kubelet-config.yaml\"></a>kubelet-config.yaml</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apiVersion: kubelet.config.k8s.io/v1beta1</span><br><span class=\"line\">kind: KubeletConfiguration</span><br><span class=\"line\">address: &quot;192.168.56.102&quot;</span><br><span class=\"line\">port: 10250</span><br><span class=\"line\">healthzBindAddress: &quot;192.168.56.102&quot;</span><br><span class=\"line\">healthzPort: 10248</span><br><span class=\"line\">readOnlyPort: 0</span><br><span class=\"line\">cgroupDriver: &quot;cgroupfs&quot;</span><br><span class=\"line\">clusterDomain: &quot;cluster.local&quot;</span><br><span class=\"line\">clusterDNS: [&quot;121.21.0.0&quot;]</span><br><span class=\"line\">failSwapOn: false</span><br><span class=\"line\">tlsCertFile: &quot;/opt/kubernetes/pem/kubelet.pem&quot;</span><br><span class=\"line\">tlsPrivateKeyFile: &quot;/opt/kubernetes/pem/kubelet-key.pem&quot;</span><br><span class=\"line\">authentication:</span><br><span class=\"line\">    x509:</span><br><span class=\"line\">        clientCAFile: &quot;/opt/kubernetes/pem/ca.pem&quot;</span><br><span class=\"line\">    webhook:</span><br><span class=\"line\">        enabled: true</span><br><span class=\"line\">        cacheTTL: &quot;2m0s&quot;</span><br><span class=\"line\">    anonymous:</span><br><span class=\"line\">        enabled: false</span><br><span class=\"line\">authorization:</span><br><span class=\"line\">    mode: Webhook</span><br><span class=\"line\">    webhook:</span><br><span class=\"line\">        cacheAuthorizedTTL: &quot;5m0s&quot;</span><br><span class=\"line\">        cacheUnauthorizedTTL: &quot;30s&quot;</span><br><span class=\"line\">hairpinMode: &quot;promiscuous-bridge&quot;</span><br><span class=\"line\">serializeImagePulls: false</span><br><span class=\"line\">featureGates:</span><br><span class=\"line\">    RotateKubeletClientCertificate: true</span><br><span class=\"line\">    RotateKubeletServerCertificate: true</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"容器\"><a href=\"#容器\" class=\"headerlink\" title=\"容器\"></a>容器</h4><p>version 1.22</p>\n<h5 id=\"kubelet-env-1\"><a href=\"#kubelet-env-1\" class=\"headerlink\" title=\"kubelet.env\"></a>kubelet.env</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[vagrant@k8s kubernetes]$ cat &gt; /opt/kubernetes/kubelet.env &lt;&lt;EOF</span><br><span class=\"line\"> KUBELET_OPTIONS=&quot; --hostname-override=k8s  \\</span><br><span class=\"line\"> --pod-infra-container-image=k8s.org/k8s/pause:3.4.1 \\</span><br><span class=\"line\"> --kubeconfig=/etc/kubernetes/kubelet.conf    \\</span><br><span class=\"line\"> --config=/var/lib/kubelet/config.yaml     \\</span><br><span class=\"line\"> --register-node=true        \\</span><br><span class=\"line\"> --runtime-cgroups=/systemd/system.slice    \\</span><br><span class=\"line\"> --logtostderr=true &quot;</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>–network-plugin&#x3D;cni  <strong>去掉</strong></p>\n</blockquote>\n<h5 id=\"kubelet-conf\"><a href=\"#kubelet-conf\" class=\"headerlink\" title=\"kubelet.conf\"></a>kubelet.conf</h5><p>&#x2F;etc&#x2F;kubernetes&#x2F;kubelet.conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">clusters:</span><br><span class=\"line\">- cluster:</span><br><span class=\"line\">    certificate-authority-data: xxxx..xxxxxxx==</span><br><span class=\"line\">    server: https://192.168.56.108:6443</span><br><span class=\"line\">  name: k8s</span><br><span class=\"line\">contexts:</span><br><span class=\"line\">- context:</span><br><span class=\"line\">    cluster: k8s</span><br><span class=\"line\">    user: system:node:k8s</span><br><span class=\"line\">  name: system:node:k8s@k8s</span><br><span class=\"line\">current-context: system:node:k8s@k8s</span><br><span class=\"line\">kind: Config</span><br><span class=\"line\">preferences: &#123;&#125;</span><br><span class=\"line\">users:</span><br><span class=\"line\">- name: system:node:k8s</span><br><span class=\"line\">  user:</span><br><span class=\"line\">    client-certificate: /var/lib/kubelet/pki/kubelet-client-current.pem</span><br><span class=\"line\">    client-key: /var/lib/kubelet/pki/kubelet-client-current.pem</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"config-yaml\"><a href=\"#config-yaml\" class=\"headerlink\" title=\"config.yaml\"></a>config.yaml</h5><p>&#x2F;var&#x2F;lib&#x2F;kubelet&#x2F;config.yaml</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apiVersion: kubelet.config.k8s.io/v1beta1</span><br><span class=\"line\">authentication:</span><br><span class=\"line\">  anonymous:</span><br><span class=\"line\">    enabled: false</span><br><span class=\"line\">  webhook:</span><br><span class=\"line\">    cacheTTL: 0s</span><br><span class=\"line\">    enabled: true</span><br><span class=\"line\">  x509:</span><br><span class=\"line\">    clientCAFile: /etc/kubernetes/pki/ca.crt</span><br><span class=\"line\">authorization:</span><br><span class=\"line\">  mode: Webhook</span><br><span class=\"line\">  webhook:</span><br><span class=\"line\">    cacheAuthorizedTTL: 0s</span><br><span class=\"line\">    cacheUnauthorizedTTL: 0s</span><br><span class=\"line\">cgroupDriver: cgroupfs</span><br><span class=\"line\">clusterDNS:</span><br><span class=\"line\">- 10.96.0.10</span><br><span class=\"line\">clusterDomain: cluster.local</span><br><span class=\"line\">cpuManagerReconcilePeriod: 0s</span><br><span class=\"line\">evictionPressureTransitionPeriod: 0s</span><br><span class=\"line\">failSwapOn: false</span><br><span class=\"line\">fileCheckFrequency: 0s</span><br><span class=\"line\">healthzBindAddress: 127.0.0.1</span><br><span class=\"line\">healthzPort: 10248</span><br><span class=\"line\">httpCheckFrequency: 0s</span><br><span class=\"line\">imageMinimumGCAge: 0s</span><br><span class=\"line\">kind: KubeletConfiguration</span><br><span class=\"line\">logging: &#123;&#125;</span><br><span class=\"line\">nodeStatusReportFrequency: 0s</span><br><span class=\"line\">nodeStatusUpdateFrequency: 0s</span><br><span class=\"line\">rotateCertificates: true</span><br><span class=\"line\">runtimeRequestTimeout: 0s</span><br><span class=\"line\">shutdownGracePeriod: 0s</span><br><span class=\"line\">shutdownGracePeriodCriticalPods: 0s</span><br><span class=\"line\">staticPodPath: /etc/kubernetes/manifests</span><br><span class=\"line\">streamingConnectionIdleTimeout: 0s</span><br><span class=\"line\">syncFrequency: 0s</span><br><span class=\"line\">volumeStatsAggPeriod: 0s</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"service\"><a href=\"#service\" class=\"headerlink\" title=\"service\"></a>service<a id=\"id-service\"/></h4><h5 id=\"kubelet-service\"><a href=\"#kubelet-service\" class=\"headerlink\" title=\"kubelet.service\"></a>kubelet.service</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[vagrant@k8s kubernetes]$ cat &gt;/usr/lib/systemd/system/kubelet.service &lt;&lt;EOF</span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Kubernetes Kubelet Server</span><br><span class=\"line\">Documentation=https://github.com/GoogleCloudPlatform/kubernetes</span><br><span class=\"line\">After=docker.service</span><br><span class=\"line\">Requires=docker.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">WorkingDirectory=/var/lib/kubelet</span><br><span class=\"line\">EnvironmentFile=/opt/kubernetes/kubelet.env</span><br><span class=\"line\">ExecStart=/opt/kubernetes/bin/kubelet  $KUBELET_OPTIONS</span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n<p>kubeadm部署,不用启动,会自动拉起</p>\n<p>初始化自动生成</p>\n<p>&#x2F;etc&#x2F;kubernetes&#x2F;kubelet.conf</p>\n<p>&#x2F;var&#x2F;lib&#x2F;kubelet&#x2F;config.yaml</p>\n<p>开机自启动</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl enable kubelet</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h4 id=\"二进制\"><a href=\"#二进制\" class=\"headerlink\" title=\"二进制\"></a>二进制</h4><p>version 1.18</p>\n<h5 id=\"kubelet-env\"><a href=\"#kubelet-env\" class=\"headerlink\" title=\"kubelet.env\"></a>kubelet.env</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[vagrant@k8s kubernetes]$ cat &gt; /opt/kubernetes/kubelet/kubelet.env &lt;&lt;EOF</span><br><span class=\"line\">KUBELET_OPTIONS=&quot; --pod-infra-container-image=k8s.org/k8s/pause:3.2   \\</span><br><span class=\"line\">--bootstrap-kubeconfig=/opt/kubernetes/config/bootstrap.kubeconfig   \\</span><br><span class=\"line\">--kubeconfig=/opt/kubernetes/config/kubelet.kubeconfig   \\</span><br><span class=\"line\">--config=/opt/kubernetes/kubelet/kubelet-config.yaml    \\</span><br><span class=\"line\">--cni-bin-dir=/opt/kubernetes/cni/bin    \\</span><br><span class=\"line\">--cni-conf-dir=/opt/kubernetes/cni/net.d    \\</span><br><span class=\"line\">--network-plugin=cni    \\</span><br><span class=\"line\">-runtime-cgroups=/systemd/system.slice    \\</span><br><span class=\"line\">--log-dir=/var/log/kubernetes/kubelet     \\</span><br><span class=\"line\">--logtostderr=false    \\</span><br><span class=\"line\">--v=2&quot;</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>","more":"<h5 id=\"kubelet-config-yaml\"><a href=\"#kubelet-config-yaml\" class=\"headerlink\" title=\"kubelet-config.yaml\"></a>kubelet-config.yaml</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apiVersion: kubelet.config.k8s.io/v1beta1</span><br><span class=\"line\">kind: KubeletConfiguration</span><br><span class=\"line\">address: &quot;192.168.56.102&quot;</span><br><span class=\"line\">port: 10250</span><br><span class=\"line\">healthzBindAddress: &quot;192.168.56.102&quot;</span><br><span class=\"line\">healthzPort: 10248</span><br><span class=\"line\">readOnlyPort: 0</span><br><span class=\"line\">cgroupDriver: &quot;cgroupfs&quot;</span><br><span class=\"line\">clusterDomain: &quot;cluster.local&quot;</span><br><span class=\"line\">clusterDNS: [&quot;121.21.0.0&quot;]</span><br><span class=\"line\">failSwapOn: false</span><br><span class=\"line\">tlsCertFile: &quot;/opt/kubernetes/pem/kubelet.pem&quot;</span><br><span class=\"line\">tlsPrivateKeyFile: &quot;/opt/kubernetes/pem/kubelet-key.pem&quot;</span><br><span class=\"line\">authentication:</span><br><span class=\"line\">    x509:</span><br><span class=\"line\">        clientCAFile: &quot;/opt/kubernetes/pem/ca.pem&quot;</span><br><span class=\"line\">    webhook:</span><br><span class=\"line\">        enabled: true</span><br><span class=\"line\">        cacheTTL: &quot;2m0s&quot;</span><br><span class=\"line\">    anonymous:</span><br><span class=\"line\">        enabled: false</span><br><span class=\"line\">authorization:</span><br><span class=\"line\">    mode: Webhook</span><br><span class=\"line\">    webhook:</span><br><span class=\"line\">        cacheAuthorizedTTL: &quot;5m0s&quot;</span><br><span class=\"line\">        cacheUnauthorizedTTL: &quot;30s&quot;</span><br><span class=\"line\">hairpinMode: &quot;promiscuous-bridge&quot;</span><br><span class=\"line\">serializeImagePulls: false</span><br><span class=\"line\">featureGates:</span><br><span class=\"line\">    RotateKubeletClientCertificate: true</span><br><span class=\"line\">    RotateKubeletServerCertificate: true</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"容器\"><a href=\"#容器\" class=\"headerlink\" title=\"容器\"></a>容器</h4><p>version 1.22</p>\n<h5 id=\"kubelet-env-1\"><a href=\"#kubelet-env-1\" class=\"headerlink\" title=\"kubelet.env\"></a>kubelet.env</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[vagrant@k8s kubernetes]$ cat &gt; /opt/kubernetes/kubelet.env &lt;&lt;EOF</span><br><span class=\"line\"> KUBELET_OPTIONS=&quot; --hostname-override=k8s  \\</span><br><span class=\"line\"> --pod-infra-container-image=k8s.org/k8s/pause:3.4.1 \\</span><br><span class=\"line\"> --kubeconfig=/etc/kubernetes/kubelet.conf    \\</span><br><span class=\"line\"> --config=/var/lib/kubelet/config.yaml     \\</span><br><span class=\"line\"> --register-node=true        \\</span><br><span class=\"line\"> --runtime-cgroups=/systemd/system.slice    \\</span><br><span class=\"line\"> --logtostderr=true &quot;</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>–network-plugin&#x3D;cni  <strong>去掉</strong></p>\n</blockquote>\n<h5 id=\"kubelet-conf\"><a href=\"#kubelet-conf\" class=\"headerlink\" title=\"kubelet.conf\"></a>kubelet.conf</h5><p>&#x2F;etc&#x2F;kubernetes&#x2F;kubelet.conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">clusters:</span><br><span class=\"line\">- cluster:</span><br><span class=\"line\">    certificate-authority-data: xxxx..xxxxxxx==</span><br><span class=\"line\">    server: https://192.168.56.108:6443</span><br><span class=\"line\">  name: k8s</span><br><span class=\"line\">contexts:</span><br><span class=\"line\">- context:</span><br><span class=\"line\">    cluster: k8s</span><br><span class=\"line\">    user: system:node:k8s</span><br><span class=\"line\">  name: system:node:k8s@k8s</span><br><span class=\"line\">current-context: system:node:k8s@k8s</span><br><span class=\"line\">kind: Config</span><br><span class=\"line\">preferences: &#123;&#125;</span><br><span class=\"line\">users:</span><br><span class=\"line\">- name: system:node:k8s</span><br><span class=\"line\">  user:</span><br><span class=\"line\">    client-certificate: /var/lib/kubelet/pki/kubelet-client-current.pem</span><br><span class=\"line\">    client-key: /var/lib/kubelet/pki/kubelet-client-current.pem</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"config-yaml\"><a href=\"#config-yaml\" class=\"headerlink\" title=\"config.yaml\"></a>config.yaml</h5><p>&#x2F;var&#x2F;lib&#x2F;kubelet&#x2F;config.yaml</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apiVersion: kubelet.config.k8s.io/v1beta1</span><br><span class=\"line\">authentication:</span><br><span class=\"line\">  anonymous:</span><br><span class=\"line\">    enabled: false</span><br><span class=\"line\">  webhook:</span><br><span class=\"line\">    cacheTTL: 0s</span><br><span class=\"line\">    enabled: true</span><br><span class=\"line\">  x509:</span><br><span class=\"line\">    clientCAFile: /etc/kubernetes/pki/ca.crt</span><br><span class=\"line\">authorization:</span><br><span class=\"line\">  mode: Webhook</span><br><span class=\"line\">  webhook:</span><br><span class=\"line\">    cacheAuthorizedTTL: 0s</span><br><span class=\"line\">    cacheUnauthorizedTTL: 0s</span><br><span class=\"line\">cgroupDriver: cgroupfs</span><br><span class=\"line\">clusterDNS:</span><br><span class=\"line\">- 10.96.0.10</span><br><span class=\"line\">clusterDomain: cluster.local</span><br><span class=\"line\">cpuManagerReconcilePeriod: 0s</span><br><span class=\"line\">evictionPressureTransitionPeriod: 0s</span><br><span class=\"line\">failSwapOn: false</span><br><span class=\"line\">fileCheckFrequency: 0s</span><br><span class=\"line\">healthzBindAddress: 127.0.0.1</span><br><span class=\"line\">healthzPort: 10248</span><br><span class=\"line\">httpCheckFrequency: 0s</span><br><span class=\"line\">imageMinimumGCAge: 0s</span><br><span class=\"line\">kind: KubeletConfiguration</span><br><span class=\"line\">logging: &#123;&#125;</span><br><span class=\"line\">nodeStatusReportFrequency: 0s</span><br><span class=\"line\">nodeStatusUpdateFrequency: 0s</span><br><span class=\"line\">rotateCertificates: true</span><br><span class=\"line\">runtimeRequestTimeout: 0s</span><br><span class=\"line\">shutdownGracePeriod: 0s</span><br><span class=\"line\">shutdownGracePeriodCriticalPods: 0s</span><br><span class=\"line\">staticPodPath: /etc/kubernetes/manifests</span><br><span class=\"line\">streamingConnectionIdleTimeout: 0s</span><br><span class=\"line\">syncFrequency: 0s</span><br><span class=\"line\">volumeStatsAggPeriod: 0s</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"service\"><a href=\"#service\" class=\"headerlink\" title=\"service\"></a>service<a id=\"id-service\"/></h4><h5 id=\"kubelet-service\"><a href=\"#kubelet-service\" class=\"headerlink\" title=\"kubelet.service\"></a>kubelet.service</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[vagrant@k8s kubernetes]$ cat &gt;/usr/lib/systemd/system/kubelet.service &lt;&lt;EOF</span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Kubernetes Kubelet Server</span><br><span class=\"line\">Documentation=https://github.com/GoogleCloudPlatform/kubernetes</span><br><span class=\"line\">After=docker.service</span><br><span class=\"line\">Requires=docker.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">WorkingDirectory=/var/lib/kubelet</span><br><span class=\"line\">EnvironmentFile=/opt/kubernetes/kubelet.env</span><br><span class=\"line\">ExecStart=/opt/kubernetes/bin/kubelet  $KUBELET_OPTIONS</span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n<p>kubeadm部署,不用启动,会自动拉起</p>\n<p>初始化自动生成</p>\n<p>&#x2F;etc&#x2F;kubernetes&#x2F;kubelet.conf</p>\n<p>&#x2F;var&#x2F;lib&#x2F;kubelet&#x2F;config.yaml</p>\n<p>开机自启动</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl enable kubelet</span><br></pre></td></tr></table></figure>"},{"title":"redis集群","date":"2022-07-17T13:05:54.000Z","_content":"\n\n\n### pod\n\n```\nkubectl -n devops get pods\nNAME          READY   STATUS    RESTARTS   AGE\nredis-app-0   1/1     Running   0          50m\nredis-app-1   1/1     Running   0          50m\nredis-app-2   1/1     Running   0          44m\nredis-app-3   1/1     Running   0          38m\nredis-app-4   1/1     Running   0          38m\nredis-app-5   1/1     Running   0          38m\n\nkubectl -n devops exec -it redis-app-2 /bin/bash\nkubectl -n devops exec -it redis-app-4 /bin/bash\n```\n\nredis-cli -c -p 6379\n\n![](/pics/k8s-redis-c-set01.png)\n\n\n\n### svc ClusterIP\n\n两次认证?\n\n```\ncs@debian:~/oss/hexo$ kubectl get svc -n devops\nNAME                     TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)              AGE\njenkins                  ClusterIP   121.21.92.146    <none>        8081/TCP,50000/TCP   105d\nredis-headless-service   ClusterIP   None             <none>        6379/TCP             13d\nredis-service            ClusterIP   121.21.24.33     <none>        6379/TCP             13d\ntomcat                   ClusterIP   121.21.191.100   <none>        8082/TCP             105d\n\ncs@debian:~/oss/hexo$ kubectl exec -it redis-app-1 -n devops  /bin/bash\nkubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl kubectl exec [POD] -- [COMMAND] instead.\n.............\nroot@redis-app-1:/data# redis-cli  -c -h 121.21.24.33 -p 6379\n121.21.24.33:6379> auth 123456\nOK\n121.21.24.33:6379> ping\nPONG\n121.21.24.33:6379> get test21\n-> Redirected to slot [8530] located at 121.21.35.3:6379\n(error) NOAUTH Authentication required.  \n121.21.35.3:6379> auth 123456\nOK\n121.21.35.3:6379> get test21\n\"20220721cs\"\n```\n\n\n\n\n\n\n\ntraefik  deploay  配置 redis\n\n```\ncs@debian:/opt/kubernetes/yaml/k8s/tcp/redis$ redis-cli  -c  -p  6379\n127.0.0.1:6379> auth 123456\nOK\n127.0.0.1:6379> ping\nPONG\n```\n\n>127.0.0.1 - 192.168.56.103:6379, 192.168.56.101:6379, 192.168.56.102:6379 - [19/Jul/2022:22:10:12 +0800] 200 0, 0, 82\n\n\n\n### 不通超时\n\n![](/pics/k8s-redis-timeout.png)\n\n\n\n![](/pics/k8s-redis-c-set02.png)\n\n根据podip定位集群pod\n\n```\ncs@debian:~/oss/hexo$  kubectl  get pod --field-selector status.podIP=121.21.35.3 -o wide -n devops\nNAME          READY   STATUS    RESTARTS   AGE   IP            NODE     NOMINATED NODE   READINESS GATES\nredis-app-1   1/1     Running   1          9d    121.21.35.3   node04   <none>           <none>\n```\n\n","source":"_posts/linux/k8s/redis.md","raw":"---\ntitle: redis集群\npermalink: linux/k8s/redis/\ntags:\n  - redis\n  - redis-cluster\ncategories:\n  - linux\n  - k8s\ndate: 2022-07-17 21:05:54\n---\n\n\n\n### pod\n\n```\nkubectl -n devops get pods\nNAME          READY   STATUS    RESTARTS   AGE\nredis-app-0   1/1     Running   0          50m\nredis-app-1   1/1     Running   0          50m\nredis-app-2   1/1     Running   0          44m\nredis-app-3   1/1     Running   0          38m\nredis-app-4   1/1     Running   0          38m\nredis-app-5   1/1     Running   0          38m\n\nkubectl -n devops exec -it redis-app-2 /bin/bash\nkubectl -n devops exec -it redis-app-4 /bin/bash\n```\n\nredis-cli -c -p 6379\n\n![](/pics/k8s-redis-c-set01.png)\n\n\n\n### svc ClusterIP\n\n两次认证?\n\n```\ncs@debian:~/oss/hexo$ kubectl get svc -n devops\nNAME                     TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)              AGE\njenkins                  ClusterIP   121.21.92.146    <none>        8081/TCP,50000/TCP   105d\nredis-headless-service   ClusterIP   None             <none>        6379/TCP             13d\nredis-service            ClusterIP   121.21.24.33     <none>        6379/TCP             13d\ntomcat                   ClusterIP   121.21.191.100   <none>        8082/TCP             105d\n\ncs@debian:~/oss/hexo$ kubectl exec -it redis-app-1 -n devops  /bin/bash\nkubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl kubectl exec [POD] -- [COMMAND] instead.\n.............\nroot@redis-app-1:/data# redis-cli  -c -h 121.21.24.33 -p 6379\n121.21.24.33:6379> auth 123456\nOK\n121.21.24.33:6379> ping\nPONG\n121.21.24.33:6379> get test21\n-> Redirected to slot [8530] located at 121.21.35.3:6379\n(error) NOAUTH Authentication required.  \n121.21.35.3:6379> auth 123456\nOK\n121.21.35.3:6379> get test21\n\"20220721cs\"\n```\n\n\n\n\n\n\n\ntraefik  deploay  配置 redis\n\n```\ncs@debian:/opt/kubernetes/yaml/k8s/tcp/redis$ redis-cli  -c  -p  6379\n127.0.0.1:6379> auth 123456\nOK\n127.0.0.1:6379> ping\nPONG\n```\n\n>127.0.0.1 - 192.168.56.103:6379, 192.168.56.101:6379, 192.168.56.102:6379 - [19/Jul/2022:22:10:12 +0800] 200 0, 0, 82\n\n\n\n### 不通超时\n\n![](/pics/k8s-redis-timeout.png)\n\n\n\n![](/pics/k8s-redis-c-set02.png)\n\n根据podip定位集群pod\n\n```\ncs@debian:~/oss/hexo$  kubectl  get pod --field-selector status.podIP=121.21.35.3 -o wide -n devops\nNAME          READY   STATUS    RESTARTS   AGE   IP            NODE     NOMINATED NODE   READINESS GATES\nredis-app-1   1/1     Running   1          9d    121.21.35.3   node04   <none>           <none>\n```\n\n","slug":"linux/k8s/redis","published":1,"updated":"2022-08-28T09:10:00.944Z","__permalink":"linux/k8s/redis/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtte002ggwi546vsga9y","content":"<h3 id=\"pod\"><a href=\"#pod\" class=\"headerlink\" title=\"pod\"></a>pod</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl -n devops get pods</span><br><span class=\"line\">NAME          READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">redis-app-0   1/1     Running   0          50m</span><br><span class=\"line\">redis-app-1   1/1     Running   0          50m</span><br><span class=\"line\">redis-app-2   1/1     Running   0          44m</span><br><span class=\"line\">redis-app-3   1/1     Running   0          38m</span><br><span class=\"line\">redis-app-4   1/1     Running   0          38m</span><br><span class=\"line\">redis-app-5   1/1     Running   0          38m</span><br><span class=\"line\"></span><br><span class=\"line\">kubectl -n devops exec -it redis-app-2 /bin/bash</span><br><span class=\"line\">kubectl -n devops exec -it redis-app-4 /bin/bash</span><br></pre></td></tr></table></figure>\n\n<p>redis-cli -c -p 6379</p>\n<p><img src=\"/pics/k8s-redis-c-set01.png\"></p>\n<h3 id=\"svc-ClusterIP\"><a href=\"#svc-ClusterIP\" class=\"headerlink\" title=\"svc ClusterIP\"></a>svc ClusterIP</h3><p>两次认证?</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/hexo$ kubectl get svc -n devops</span><br><span class=\"line\">NAME                     TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)              AGE</span><br><span class=\"line\">jenkins                  ClusterIP   121.21.92.146    &lt;none&gt;        8081/TCP,50000/TCP   105d</span><br><span class=\"line\">redis-headless-service   ClusterIP   None             &lt;none&gt;        6379/TCP             13d</span><br><span class=\"line\">redis-service            ClusterIP   121.21.24.33     &lt;none&gt;        6379/TCP             13d</span><br><span class=\"line\">tomcat                   ClusterIP   121.21.191.100   &lt;none&gt;        8082/TCP             105d</span><br><span class=\"line\"></span><br><span class=\"line\">cs@debian:~/oss/hexo$ kubectl exec -it redis-app-1 -n devops  /bin/bash</span><br><span class=\"line\">kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl kubectl exec [POD] -- [COMMAND] instead.</span><br><span class=\"line\">.............</span><br><span class=\"line\">root@redis-app-1:/data# redis-cli  -c -h 121.21.24.33 -p 6379</span><br><span class=\"line\">121.21.24.33:6379&gt; auth 123456</span><br><span class=\"line\">OK</span><br><span class=\"line\">121.21.24.33:6379&gt; ping</span><br><span class=\"line\">PONG</span><br><span class=\"line\">121.21.24.33:6379&gt; get test21</span><br><span class=\"line\">-&gt; Redirected to slot [8530] located at 121.21.35.3:6379</span><br><span class=\"line\">(error) NOAUTH Authentication required.  </span><br><span class=\"line\">121.21.35.3:6379&gt; auth 123456</span><br><span class=\"line\">OK</span><br><span class=\"line\">121.21.35.3:6379&gt; get test21</span><br><span class=\"line\">&quot;20220721cs&quot;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<p>traefik  deploay  配置 redis</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/kubernetes/yaml/k8s/tcp/redis$ redis-cli  -c  -p  6379</span><br><span class=\"line\">127.0.0.1:6379&gt; auth 123456</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; ping</span><br><span class=\"line\">PONG</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>127.0.0.1 - 192.168.56.103:6379, 192.168.56.101:6379, 192.168.56.102:6379 - [19&#x2F;Jul&#x2F;2022:22:10:12 +0800] 200 0, 0, 82</p>\n</blockquote>\n<h3 id=\"不通超时\"><a href=\"#不通超时\" class=\"headerlink\" title=\"不通超时\"></a>不通超时</h3><p><img src=\"/pics/k8s-redis-timeout.png\"></p>\n<p><img src=\"/pics/k8s-redis-c-set02.png\"></p>\n<p>根据podip定位集群pod</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/hexo$  kubectl  get pod --field-selector status.podIP=121.21.35.3 -o wide -n devops</span><br><span class=\"line\">NAME          READY   STATUS    RESTARTS   AGE   IP            NODE     NOMINATED NODE   READINESS GATES</span><br><span class=\"line\">redis-app-1   1/1     Running   1          9d    121.21.35.3   node04   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"pod\"><a href=\"#pod\" class=\"headerlink\" title=\"pod\"></a>pod</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl -n devops get pods</span><br><span class=\"line\">NAME          READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">redis-app-0   1/1     Running   0          50m</span><br><span class=\"line\">redis-app-1   1/1     Running   0          50m</span><br><span class=\"line\">redis-app-2   1/1     Running   0          44m</span><br><span class=\"line\">redis-app-3   1/1     Running   0          38m</span><br><span class=\"line\">redis-app-4   1/1     Running   0          38m</span><br><span class=\"line\">redis-app-5   1/1     Running   0          38m</span><br><span class=\"line\"></span><br><span class=\"line\">kubectl -n devops exec -it redis-app-2 /bin/bash</span><br><span class=\"line\">kubectl -n devops exec -it redis-app-4 /bin/bash</span><br></pre></td></tr></table></figure>\n\n<p>redis-cli -c -p 6379</p>\n<p><img src=\"/pics/k8s-redis-c-set01.png\"></p>\n<h3 id=\"svc-ClusterIP\"><a href=\"#svc-ClusterIP\" class=\"headerlink\" title=\"svc ClusterIP\"></a>svc ClusterIP</h3><p>两次认证?</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/hexo$ kubectl get svc -n devops</span><br><span class=\"line\">NAME                     TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)              AGE</span><br><span class=\"line\">jenkins                  ClusterIP   121.21.92.146    &lt;none&gt;        8081/TCP,50000/TCP   105d</span><br><span class=\"line\">redis-headless-service   ClusterIP   None             &lt;none&gt;        6379/TCP             13d</span><br><span class=\"line\">redis-service            ClusterIP   121.21.24.33     &lt;none&gt;        6379/TCP             13d</span><br><span class=\"line\">tomcat                   ClusterIP   121.21.191.100   &lt;none&gt;        8082/TCP             105d</span><br><span class=\"line\"></span><br><span class=\"line\">cs@debian:~/oss/hexo$ kubectl exec -it redis-app-1 -n devops  /bin/bash</span><br><span class=\"line\">kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl kubectl exec [POD] -- [COMMAND] instead.</span><br><span class=\"line\">.............</span><br><span class=\"line\">root@redis-app-1:/data# redis-cli  -c -h 121.21.24.33 -p 6379</span><br><span class=\"line\">121.21.24.33:6379&gt; auth 123456</span><br><span class=\"line\">OK</span><br><span class=\"line\">121.21.24.33:6379&gt; ping</span><br><span class=\"line\">PONG</span><br><span class=\"line\">121.21.24.33:6379&gt; get test21</span><br><span class=\"line\">-&gt; Redirected to slot [8530] located at 121.21.35.3:6379</span><br><span class=\"line\">(error) NOAUTH Authentication required.  </span><br><span class=\"line\">121.21.35.3:6379&gt; auth 123456</span><br><span class=\"line\">OK</span><br><span class=\"line\">121.21.35.3:6379&gt; get test21</span><br><span class=\"line\">&quot;20220721cs&quot;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<p>traefik  deploay  配置 redis</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/kubernetes/yaml/k8s/tcp/redis$ redis-cli  -c  -p  6379</span><br><span class=\"line\">127.0.0.1:6379&gt; auth 123456</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; ping</span><br><span class=\"line\">PONG</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>127.0.0.1 - 192.168.56.103:6379, 192.168.56.101:6379, 192.168.56.102:6379 - [19&#x2F;Jul&#x2F;2022:22:10:12 +0800] 200 0, 0, 82</p>\n</blockquote>\n<h3 id=\"不通超时\"><a href=\"#不通超时\" class=\"headerlink\" title=\"不通超时\"></a>不通超时</h3><p><img src=\"/pics/k8s-redis-timeout.png\"></p>\n<p><img src=\"/pics/k8s-redis-c-set02.png\"></p>\n<p>根据podip定位集群pod</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/hexo$  kubectl  get pod --field-selector status.podIP=121.21.35.3 -o wide -n devops</span><br><span class=\"line\">NAME          READY   STATUS    RESTARTS   AGE   IP            NODE     NOMINATED NODE   READINESS GATES</span><br><span class=\"line\">redis-app-1   1/1     Running   1          9d    121.21.35.3   node04   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>\n\n"},{"title":"traefik","date":"2022-07-19T13:14:45.000Z","_content":"\n\n\n\n\nTræfɪk 是一个云原生的新型的 HTTP 反向代理、负载均衡软件\n\n\n\n```\n$bash traefik.sh\n$ tree  ./test\n./test\n├── 1-crd.yaml\n├── 2-rbac.yaml\n├── 3-role.yaml\n├── 4-static_config.yaml\n├── 5-dynamic_toml.toml\n├── 6-deploy.yaml\n├── 7-service.yaml\n└── 8-ingress.yaml\n\n```\n\n\n\ntraefik.sh\n\n```shell\n#!/bin/bash\nDIR=\"$(cd \"$(dirname \"$0\")\" && pwd)\"\n\nbase_file=$DIR/test\ncrd=1-crd.yaml\nrbac=2-rbac.yaml\nrole=3-role.yaml\nstatic=4-static_config.yaml\ndynamic=5-dynamic_toml.toml\ndeploy=6-deploy.yaml\nsvc=7-service.yaml\ningress=8-ingress.yaml\n\n\ny_crd(){\n\tcat >$1 <<EOF\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ingressroutes.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: IngressRoute\n    plural: ingressroutes\n    singular: ingressroute\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: middlewares.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: Middleware\n    plural: middlewares\n    singular: middleware\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ingressroutetcps.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: IngressRouteTCP\n    plural: ingressroutetcps\n    singular: ingressroutetcp\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ingressrouteudps.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: IngressRouteUDP\n    plural: ingressrouteudps\n    singular: ingressrouteudp\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: tlsoptions.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: TLSOption\n    plural: tlsoptions\n    singular: tlsoption\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: tlsstores.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: TLSStore\n    plural: tlsstores\n    singular: tlsstore\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: traefikservices.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: TraefikService\n    plural: traefikservices\n    singular: traefikservice\n  scope: Namespaced\n\nEOF\n\n}\n\n\n\ny_rbac(){\n\tcat>$1 <<EOF\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: traefik-ingress-controller\n\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - services\n      - endpoints\n      - secrets\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - persistentvolumes\n    verbs:\n      - get\n      - list\n      - watch\n      - create  # persistentvolumes\n      - delete\n  - apiGroups:\n      - \"\"\n    resources:\n      - persistentvolumeclaims\n    verbs:\n      - get\n      - list\n      - watch\n      - update  # persistentvolumeclaims         \n  - apiGroups:\n      - extensions\n    resources:\n      - ingresses\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups:\n      - extensions\n    resources:\n      - ingresses/status\n    verbs:\n      - update\n  - apiGroups:\n      - traefik.containo.us\n    resources:\n      - middlewares\n      - ingressroutes\n      - traefikservices\n      - ingressroutetcps\n      - ingressrouteudps\n      - tlsoptions\n      - tlsstores\n    verbs:\n      - get\n      - list\n      - watch\nEOF\n\n}\n\n\n\ny_role(){\n   cat >$1 <<EOF\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: traefik-ingress-controller\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: traefik-ingress-controller\nsubjects:\n  - kind: ServiceAccount\n    name: traefik-ingress-controller\n    namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  namespace: kube-system\n  name: traefik-ingress-controller\nEOF\n\n}\n\n#静态配置动态文件======================?\ny_static_config(){\n   cat >$1 <<EOF\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: traefik-config-yaml\n  namespace: kube-system\ndata:\n  traefik.yaml: |-\n    ping: \"\"\n    serversTransport:\n      insecureSkipVerify: true\n    api:\n      insecure: true\n      dashboard: true\n      debug: false\n    metrics:\n      prometheus: \"\"\n    entryPoints:\n      web:\n        address: \":80\"\n      websecure:\n        address: \":443\"\n      mysql:\n        address: \":3306\"\n      redis:    \n        address: \":6379\"\n      jenkins:\n        address: \":8081\"\n      gogo:\n        address: \":8082\"\n      prometheus:\n        address: \":8181\"\n    providers:\n      kubernetesCRD: \"\"\n      kubernetesIngress: \"\"\n      file:\n        directory: /etc/conf.d/\n        watch: true\n    log:\n      filePath: \"\"\n      level: error \n      format: json\n    accessLog:\n      filePath: \"\"\n      format: json\n      bufferingSize: 0\n      filters:\n        #statusCodes: [\"200\"]\n        retryAttempts: true\n        minDuration: 20\n      fields:\n        defaultMode: keep\n        names:\n          ClientUsername: drop  \n        headers:\n          defaultMode: keep\n          names:\n            User-Agent: redact\n            Authorization: drop\n            Content-Type: keep\nEOF\n\n}\n\n\ngenkey(){\nopenssl req \\\n        -newkey rsa:2048 -nodes -keyout tls.key \\\n        -x509 -days 3650 -out tls.crt \\\n        -subj \"/C=CN/ST=GD/L=SZ/O=cs/OU=shea/CN=k8s.org\" \n#kubectl create secret generic traefik-cert --from-file=tls.crt --from-file=tls.key -n kube-system        \n}\n\ny_dynamic_toml(){\n   cat >$1 <<EOF\ndefaultEntryPoints = [\"http\",\"https\"]\n[entryPoints]\n  [entryPoints.http]\n  address = \":80\"\n  [entryPoints.https]\n  address = \":443\"\n    [entryPoints.https.tls]\n      [[entryPoints.https.tls.certificates]]\n      CertFile = \"/ssl/tls.crt\"\n      KeyFile = \"/ssl/tls.key\"\n\n\ntls:\n  certificates:\n    - certFile: /path/to/domain.cert\n      keyFile: /path/to/domain.key\n      stores: #stores 列表将被忽略，并自动设置为 [\"default\"]\n        - default\n\nEOF\n}\n\n\n\n\ny_deploy(){\n   cat >$1 <<EOF\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: traefik-ingress-controller\n  namespace: kube-system\n  labels:\n    app: traefik\nspec:\n  selector:\n    matchLabels:\n      app: traefik\n  template:\n    metadata:\n      name: traefik\n      labels:\n        app: traefik\n    spec:\n      serviceAccountName: traefik-ingress-controller\n      terminationGracePeriodSeconds: 1\n      #设置node筛选器，在特定label的节点上启动  kubectl label node 192.168.56.109 tklabel=ok\n      nodeSelector: \n         tklabel: \"ok\"\n      containers:\n        - image: k8s.org/k8s/traefik:v2.2.10\n          name: traefik\n          ports:\n            - name: web\n              containerPort: 80\n              hostPort: 80         ## 将容器端口绑定所在服务器的 80 端口\n            - name: websecure\n              containerPort: 443\n              hostPort: 443        ## 将容器端口绑定所在服务器的 443 端口\n            # - name: redis\n            #   containerPort: 6379\n            #  hostPort: 6379\n            - name: admin\n              containerPort: 8080  ## Traefik Dashboard 端口\n          resources:\n            limits:\n              cpu: 200m\n              memory: 256Mi\n            requests:\n              cpu: 100m\n              memory: 256Mi\n          securityContext:\n            capabilities:\n              drop:\n                - ALL\n              add:\n                - NET_BIND_SERVICE\n          args:\n            - --configfile=/config/traefik.yaml\n          volumeMounts:\n            - mountPath: \"/config\"\n              name: \"config\"\n            - mountPath: \"/ssl\"\n              name: \"ssl\"\n      volumes:\n        - name: config\n          configMap:\n            name: traefik-config-yaml\n        - name: ssl\n          secret:\n            secretName: traefik-cert\nEOF\n\n}\n\n\n\n\ny_service(){\n   cat >$1 <<EOF\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: traefik\n  namespace: kube-system\nspec:\n  ports:\n    - name: web\n      port: 80\n    - name: websecure\n      port: 443\n    - name: admin   #没有会显示 404 page not found\n      port: 8080\n  selector:\n    app: traefik\n\nEOF\n}\n\n\n\n\ny_ingress(){\n   cat >$1 <<\"EOF\"\n---\napiVersion: traefik.containo.us/v1alpha1\nkind: IngressRoute\nmetadata:\n  name: traefik-dashboard-route\n  namespace: kube-system\nspec:\n  entryPoints:\n    - web\n  routes:\n    - match: Host(`master02`) #pod节点\n      kind: Rule\n      services:\n        - name: traefik\n          port: 8080\n\nEOF\n\n}\n\n[ -d \"$base_file\" ] || { echo \"没有目录,则创建目录\" && mkdir $base_file; }\n[ -n \"$(which openssl)\" ] || { echo \"需要用到openssl,没有找到,退出\" && exit 1; }\ncd $base_file\n\n# genkey  \n# [ -f \"tls.key\" ] || { echo \"没有生成密钥,退出\" && exit 1; }\n#kubectl create secret generic traefik-cert --from-file=tls.crt --from-file=tls.key -n kube-system\n# #kubectl create configmap traefik-conf --from-file=$dynamic -n kube-system\n\narr=($crd $rbac $role $static $dynamic $deploy  $svc $ingress)\n\nfor i in ${arr[@]}; do\necho \"开始生成:\"$i \ny_${i:2:0-5}  $i\n[ -f \"$i\" ] || { echo \"没有生成$i,退出\" && exit 1; }\n#kubectl apply -f  $i\ndone\n\n```\n\n\n\n","source":"_posts/linux/k8s/traefik.md","raw":"---\ntitle: traefik\npermalink: linux/k8s/traefik/\ntags:\n  - traefik\n  - ingress\ncategories:\n  - linux\n  - k8s\ndate: 2022-07-19 21:14:45\n---\n\n\n\n\n\nTræfɪk 是一个云原生的新型的 HTTP 反向代理、负载均衡软件\n\n\n\n```\n$bash traefik.sh\n$ tree  ./test\n./test\n├── 1-crd.yaml\n├── 2-rbac.yaml\n├── 3-role.yaml\n├── 4-static_config.yaml\n├── 5-dynamic_toml.toml\n├── 6-deploy.yaml\n├── 7-service.yaml\n└── 8-ingress.yaml\n\n```\n\n\n\ntraefik.sh\n\n```shell\n#!/bin/bash\nDIR=\"$(cd \"$(dirname \"$0\")\" && pwd)\"\n\nbase_file=$DIR/test\ncrd=1-crd.yaml\nrbac=2-rbac.yaml\nrole=3-role.yaml\nstatic=4-static_config.yaml\ndynamic=5-dynamic_toml.toml\ndeploy=6-deploy.yaml\nsvc=7-service.yaml\ningress=8-ingress.yaml\n\n\ny_crd(){\n\tcat >$1 <<EOF\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ingressroutes.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: IngressRoute\n    plural: ingressroutes\n    singular: ingressroute\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: middlewares.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: Middleware\n    plural: middlewares\n    singular: middleware\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ingressroutetcps.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: IngressRouteTCP\n    plural: ingressroutetcps\n    singular: ingressroutetcp\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ingressrouteudps.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: IngressRouteUDP\n    plural: ingressrouteudps\n    singular: ingressrouteudp\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: tlsoptions.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: TLSOption\n    plural: tlsoptions\n    singular: tlsoption\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: tlsstores.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: TLSStore\n    plural: tlsstores\n    singular: tlsstore\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: traefikservices.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: TraefikService\n    plural: traefikservices\n    singular: traefikservice\n  scope: Namespaced\n\nEOF\n\n}\n\n\n\ny_rbac(){\n\tcat>$1 <<EOF\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: traefik-ingress-controller\n\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - services\n      - endpoints\n      - secrets\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - persistentvolumes\n    verbs:\n      - get\n      - list\n      - watch\n      - create  # persistentvolumes\n      - delete\n  - apiGroups:\n      - \"\"\n    resources:\n      - persistentvolumeclaims\n    verbs:\n      - get\n      - list\n      - watch\n      - update  # persistentvolumeclaims         \n  - apiGroups:\n      - extensions\n    resources:\n      - ingresses\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups:\n      - extensions\n    resources:\n      - ingresses/status\n    verbs:\n      - update\n  - apiGroups:\n      - traefik.containo.us\n    resources:\n      - middlewares\n      - ingressroutes\n      - traefikservices\n      - ingressroutetcps\n      - ingressrouteudps\n      - tlsoptions\n      - tlsstores\n    verbs:\n      - get\n      - list\n      - watch\nEOF\n\n}\n\n\n\ny_role(){\n   cat >$1 <<EOF\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: traefik-ingress-controller\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: traefik-ingress-controller\nsubjects:\n  - kind: ServiceAccount\n    name: traefik-ingress-controller\n    namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  namespace: kube-system\n  name: traefik-ingress-controller\nEOF\n\n}\n\n#静态配置动态文件======================?\ny_static_config(){\n   cat >$1 <<EOF\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: traefik-config-yaml\n  namespace: kube-system\ndata:\n  traefik.yaml: |-\n    ping: \"\"\n    serversTransport:\n      insecureSkipVerify: true\n    api:\n      insecure: true\n      dashboard: true\n      debug: false\n    metrics:\n      prometheus: \"\"\n    entryPoints:\n      web:\n        address: \":80\"\n      websecure:\n        address: \":443\"\n      mysql:\n        address: \":3306\"\n      redis:    \n        address: \":6379\"\n      jenkins:\n        address: \":8081\"\n      gogo:\n        address: \":8082\"\n      prometheus:\n        address: \":8181\"\n    providers:\n      kubernetesCRD: \"\"\n      kubernetesIngress: \"\"\n      file:\n        directory: /etc/conf.d/\n        watch: true\n    log:\n      filePath: \"\"\n      level: error \n      format: json\n    accessLog:\n      filePath: \"\"\n      format: json\n      bufferingSize: 0\n      filters:\n        #statusCodes: [\"200\"]\n        retryAttempts: true\n        minDuration: 20\n      fields:\n        defaultMode: keep\n        names:\n          ClientUsername: drop  \n        headers:\n          defaultMode: keep\n          names:\n            User-Agent: redact\n            Authorization: drop\n            Content-Type: keep\nEOF\n\n}\n\n\ngenkey(){\nopenssl req \\\n        -newkey rsa:2048 -nodes -keyout tls.key \\\n        -x509 -days 3650 -out tls.crt \\\n        -subj \"/C=CN/ST=GD/L=SZ/O=cs/OU=shea/CN=k8s.org\" \n#kubectl create secret generic traefik-cert --from-file=tls.crt --from-file=tls.key -n kube-system        \n}\n\ny_dynamic_toml(){\n   cat >$1 <<EOF\ndefaultEntryPoints = [\"http\",\"https\"]\n[entryPoints]\n  [entryPoints.http]\n  address = \":80\"\n  [entryPoints.https]\n  address = \":443\"\n    [entryPoints.https.tls]\n      [[entryPoints.https.tls.certificates]]\n      CertFile = \"/ssl/tls.crt\"\n      KeyFile = \"/ssl/tls.key\"\n\n\ntls:\n  certificates:\n    - certFile: /path/to/domain.cert\n      keyFile: /path/to/domain.key\n      stores: #stores 列表将被忽略，并自动设置为 [\"default\"]\n        - default\n\nEOF\n}\n\n\n\n\ny_deploy(){\n   cat >$1 <<EOF\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: traefik-ingress-controller\n  namespace: kube-system\n  labels:\n    app: traefik\nspec:\n  selector:\n    matchLabels:\n      app: traefik\n  template:\n    metadata:\n      name: traefik\n      labels:\n        app: traefik\n    spec:\n      serviceAccountName: traefik-ingress-controller\n      terminationGracePeriodSeconds: 1\n      #设置node筛选器，在特定label的节点上启动  kubectl label node 192.168.56.109 tklabel=ok\n      nodeSelector: \n         tklabel: \"ok\"\n      containers:\n        - image: k8s.org/k8s/traefik:v2.2.10\n          name: traefik\n          ports:\n            - name: web\n              containerPort: 80\n              hostPort: 80         ## 将容器端口绑定所在服务器的 80 端口\n            - name: websecure\n              containerPort: 443\n              hostPort: 443        ## 将容器端口绑定所在服务器的 443 端口\n            # - name: redis\n            #   containerPort: 6379\n            #  hostPort: 6379\n            - name: admin\n              containerPort: 8080  ## Traefik Dashboard 端口\n          resources:\n            limits:\n              cpu: 200m\n              memory: 256Mi\n            requests:\n              cpu: 100m\n              memory: 256Mi\n          securityContext:\n            capabilities:\n              drop:\n                - ALL\n              add:\n                - NET_BIND_SERVICE\n          args:\n            - --configfile=/config/traefik.yaml\n          volumeMounts:\n            - mountPath: \"/config\"\n              name: \"config\"\n            - mountPath: \"/ssl\"\n              name: \"ssl\"\n      volumes:\n        - name: config\n          configMap:\n            name: traefik-config-yaml\n        - name: ssl\n          secret:\n            secretName: traefik-cert\nEOF\n\n}\n\n\n\n\ny_service(){\n   cat >$1 <<EOF\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: traefik\n  namespace: kube-system\nspec:\n  ports:\n    - name: web\n      port: 80\n    - name: websecure\n      port: 443\n    - name: admin   #没有会显示 404 page not found\n      port: 8080\n  selector:\n    app: traefik\n\nEOF\n}\n\n\n\n\ny_ingress(){\n   cat >$1 <<\"EOF\"\n---\napiVersion: traefik.containo.us/v1alpha1\nkind: IngressRoute\nmetadata:\n  name: traefik-dashboard-route\n  namespace: kube-system\nspec:\n  entryPoints:\n    - web\n  routes:\n    - match: Host(`master02`) #pod节点\n      kind: Rule\n      services:\n        - name: traefik\n          port: 8080\n\nEOF\n\n}\n\n[ -d \"$base_file\" ] || { echo \"没有目录,则创建目录\" && mkdir $base_file; }\n[ -n \"$(which openssl)\" ] || { echo \"需要用到openssl,没有找到,退出\" && exit 1; }\ncd $base_file\n\n# genkey  \n# [ -f \"tls.key\" ] || { echo \"没有生成密钥,退出\" && exit 1; }\n#kubectl create secret generic traefik-cert --from-file=tls.crt --from-file=tls.key -n kube-system\n# #kubectl create configmap traefik-conf --from-file=$dynamic -n kube-system\n\narr=($crd $rbac $role $static $dynamic $deploy  $svc $ingress)\n\nfor i in ${arr[@]}; do\necho \"开始生成:\"$i \ny_${i:2:0-5}  $i\n[ -f \"$i\" ] || { echo \"没有生成$i,退出\" && exit 1; }\n#kubectl apply -f  $i\ndone\n\n```\n\n\n\n","slug":"linux/k8s/traefik","published":1,"updated":"2022-08-28T09:10:00.940Z","__permalink":"linux/k8s/traefik/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gttf002igwi5afj1holm","content":"<p>Træfɪk 是一个云原生的新型的 HTTP 反向代理、负载均衡软件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$bash traefik.sh</span><br><span class=\"line\">$ tree  ./test</span><br><span class=\"line\">./test</span><br><span class=\"line\">├── 1-crd.yaml</span><br><span class=\"line\">├── 2-rbac.yaml</span><br><span class=\"line\">├── 3-role.yaml</span><br><span class=\"line\">├── 4-static_config.yaml</span><br><span class=\"line\">├── 5-dynamic_toml.toml</span><br><span class=\"line\">├── 6-deploy.yaml</span><br><span class=\"line\">├── 7-service.yaml</span><br><span class=\"line\">└── 8-ingress.yaml</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>traefik.sh</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">!/bin/bash</span></span><br><span class=\"line\">DIR=&quot;$(cd &quot;$(dirname &quot;$0&quot;)&quot; &amp;&amp; pwd)&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">base_file=$DIR/test</span><br><span class=\"line\">crd=1-crd.yaml</span><br><span class=\"line\">rbac=2-rbac.yaml</span><br><span class=\"line\">role=3-role.yaml</span><br><span class=\"line\">static=4-static_config.yaml</span><br><span class=\"line\">dynamic=5-dynamic_toml.toml</span><br><span class=\"line\">deploy=6-deploy.yaml</span><br><span class=\"line\">svc=7-service.yaml</span><br><span class=\"line\">ingress=8-ingress.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">y_crd()&#123;</span><br><span class=\"line\">\tcat &gt;$1 &lt;&lt;EOF</span><br><span class=\"line\">---</span><br><span class=\"line\">apiVersion: apiextensions.k8s.io/v1beta1</span><br><span class=\"line\">kind: CustomResourceDefinition</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: ingressroutes.traefik.containo.us</span><br><span class=\"line\"></span><br><span class=\"line\">spec:</span><br><span class=\"line\">  group: traefik.containo.us</span><br><span class=\"line\">  version: v1alpha1</span><br><span class=\"line\">  names:</span><br><span class=\"line\">    kind: IngressRoute</span><br><span class=\"line\">    plural: ingressroutes</span><br><span class=\"line\">    singular: ingressroute</span><br><span class=\"line\">  scope: Namespaced</span><br><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\">apiVersion: apiextensions.k8s.io/v1beta1</span><br><span class=\"line\">kind: CustomResourceDefinition</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: middlewares.traefik.containo.us</span><br><span class=\"line\"></span><br><span class=\"line\">spec:</span><br><span class=\"line\">  group: traefik.containo.us</span><br><span class=\"line\">  version: v1alpha1</span><br><span class=\"line\">  names:</span><br><span class=\"line\">    kind: Middleware</span><br><span class=\"line\">    plural: middlewares</span><br><span class=\"line\">    singular: middleware</span><br><span class=\"line\">  scope: Namespaced</span><br><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\">apiVersion: apiextensions.k8s.io/v1beta1</span><br><span class=\"line\">kind: CustomResourceDefinition</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: ingressroutetcps.traefik.containo.us</span><br><span class=\"line\"></span><br><span class=\"line\">spec:</span><br><span class=\"line\">  group: traefik.containo.us</span><br><span class=\"line\">  version: v1alpha1</span><br><span class=\"line\">  names:</span><br><span class=\"line\">    kind: IngressRouteTCP</span><br><span class=\"line\">    plural: ingressroutetcps</span><br><span class=\"line\">    singular: ingressroutetcp</span><br><span class=\"line\">  scope: Namespaced</span><br><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\">apiVersion: apiextensions.k8s.io/v1beta1</span><br><span class=\"line\">kind: CustomResourceDefinition</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: ingressrouteudps.traefik.containo.us</span><br><span class=\"line\"></span><br><span class=\"line\">spec:</span><br><span class=\"line\">  group: traefik.containo.us</span><br><span class=\"line\">  version: v1alpha1</span><br><span class=\"line\">  names:</span><br><span class=\"line\">    kind: IngressRouteUDP</span><br><span class=\"line\">    plural: ingressrouteudps</span><br><span class=\"line\">    singular: ingressrouteudp</span><br><span class=\"line\">  scope: Namespaced</span><br><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\">apiVersion: apiextensions.k8s.io/v1beta1</span><br><span class=\"line\">kind: CustomResourceDefinition</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: tlsoptions.traefik.containo.us</span><br><span class=\"line\"></span><br><span class=\"line\">spec:</span><br><span class=\"line\">  group: traefik.containo.us</span><br><span class=\"line\">  version: v1alpha1</span><br><span class=\"line\">  names:</span><br><span class=\"line\">    kind: TLSOption</span><br><span class=\"line\">    plural: tlsoptions</span><br><span class=\"line\">    singular: tlsoption</span><br><span class=\"line\">  scope: Namespaced</span><br><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\">apiVersion: apiextensions.k8s.io/v1beta1</span><br><span class=\"line\">kind: CustomResourceDefinition</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: tlsstores.traefik.containo.us</span><br><span class=\"line\"></span><br><span class=\"line\">spec:</span><br><span class=\"line\">  group: traefik.containo.us</span><br><span class=\"line\">  version: v1alpha1</span><br><span class=\"line\">  names:</span><br><span class=\"line\">    kind: TLSStore</span><br><span class=\"line\">    plural: tlsstores</span><br><span class=\"line\">    singular: tlsstore</span><br><span class=\"line\">  scope: Namespaced</span><br><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\">apiVersion: apiextensions.k8s.io/v1beta1</span><br><span class=\"line\">kind: CustomResourceDefinition</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: traefikservices.traefik.containo.us</span><br><span class=\"line\"></span><br><span class=\"line\">spec:</span><br><span class=\"line\">  group: traefik.containo.us</span><br><span class=\"line\">  version: v1alpha1</span><br><span class=\"line\">  names:</span><br><span class=\"line\">    kind: TraefikService</span><br><span class=\"line\">    plural: traefikservices</span><br><span class=\"line\">    singular: traefikservice</span><br><span class=\"line\">  scope: Namespaced</span><br><span class=\"line\"></span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">y_rbac()&#123;</span><br><span class=\"line\"><span class=\"meta prompt_\">\tcat&gt;</span><span class=\"language-bash\"><span class=\"variable\">$1</span> &lt;&lt;<span class=\"string\">EOF</span></span></span><br><span class=\"line\">---</span><br><span class=\"line\">kind: ClusterRole</span><br><span class=\"line\">apiVersion: rbac.authorization.k8s.io/v1beta1</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: traefik-ingress-controller</span><br><span class=\"line\"></span><br><span class=\"line\">rules:</span><br><span class=\"line\">  - apiGroups:</span><br><span class=\"line\">      - &quot;&quot;</span><br><span class=\"line\">    resources:</span><br><span class=\"line\">      - services</span><br><span class=\"line\">      - endpoints</span><br><span class=\"line\">      - secrets</span><br><span class=\"line\">    verbs:</span><br><span class=\"line\">      - get</span><br><span class=\"line\">      - list</span><br><span class=\"line\">      - watch</span><br><span class=\"line\">  - apiGroups:</span><br><span class=\"line\">      - &quot;&quot;</span><br><span class=\"line\">    resources:</span><br><span class=\"line\">      - persistentvolumes</span><br><span class=\"line\">    verbs:</span><br><span class=\"line\">      - get</span><br><span class=\"line\">      - list</span><br><span class=\"line\">      - watch</span><br><span class=\"line\">      - create  # persistentvolumes</span><br><span class=\"line\">      - delete</span><br><span class=\"line\">  - apiGroups:</span><br><span class=\"line\">      - &quot;&quot;</span><br><span class=\"line\">    resources:</span><br><span class=\"line\">      - persistentvolumeclaims</span><br><span class=\"line\">    verbs:</span><br><span class=\"line\">      - get</span><br><span class=\"line\">      - list</span><br><span class=\"line\">      - watch</span><br><span class=\"line\">      - update  # persistentvolumeclaims         </span><br><span class=\"line\">  - apiGroups:</span><br><span class=\"line\">      - extensions</span><br><span class=\"line\">    resources:</span><br><span class=\"line\">      - ingresses</span><br><span class=\"line\">    verbs:</span><br><span class=\"line\">      - get</span><br><span class=\"line\">      - list</span><br><span class=\"line\">      - watch</span><br><span class=\"line\">  - apiGroups:</span><br><span class=\"line\">      - extensions</span><br><span class=\"line\">    resources:</span><br><span class=\"line\">      - ingresses/status</span><br><span class=\"line\">    verbs:</span><br><span class=\"line\">      - update</span><br><span class=\"line\">  - apiGroups:</span><br><span class=\"line\">      - traefik.containo.us</span><br><span class=\"line\">    resources:</span><br><span class=\"line\">      - middlewares</span><br><span class=\"line\">      - ingressroutes</span><br><span class=\"line\">      - traefikservices</span><br><span class=\"line\">      - ingressroutetcps</span><br><span class=\"line\">      - ingressrouteudps</span><br><span class=\"line\">      - tlsoptions</span><br><span class=\"line\">      - tlsstores</span><br><span class=\"line\">    verbs:</span><br><span class=\"line\">      - get</span><br><span class=\"line\">      - list</span><br><span class=\"line\">      - watch</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">y_role()&#123;</span><br><span class=\"line\">   cat &gt;$1 &lt;&lt;EOF</span><br><span class=\"line\">---</span><br><span class=\"line\">kind: ClusterRoleBinding</span><br><span class=\"line\">apiVersion: rbac.authorization.k8s.io/v1beta1</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: traefik-ingress-controller</span><br><span class=\"line\">roleRef:</span><br><span class=\"line\">  apiGroup: rbac.authorization.k8s.io</span><br><span class=\"line\">  kind: ClusterRole</span><br><span class=\"line\">  name: traefik-ingress-controller</span><br><span class=\"line\">subjects:</span><br><span class=\"line\">  - kind: ServiceAccount</span><br><span class=\"line\">    name: traefik-ingress-controller</span><br><span class=\"line\">    namespace: kube-system</span><br><span class=\"line\">---</span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">kind: ServiceAccount</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  namespace: kube-system</span><br><span class=\"line\">  name: traefik-ingress-controller</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\">静态配置动态文件======================?</span></span></span><br><span class=\"line\">y_static_config()&#123;</span><br><span class=\"line\">   cat &gt;$1 &lt;&lt;EOF</span><br><span class=\"line\">---</span><br><span class=\"line\">kind: ConfigMap</span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: traefik-config-yaml</span><br><span class=\"line\">  namespace: kube-system</span><br><span class=\"line\">data:</span><br><span class=\"line\">  traefik.yaml: |-</span><br><span class=\"line\">    ping: &quot;&quot;</span><br><span class=\"line\">    serversTransport:</span><br><span class=\"line\">      insecureSkipVerify: true</span><br><span class=\"line\">    api:</span><br><span class=\"line\">      insecure: true</span><br><span class=\"line\">      dashboard: true</span><br><span class=\"line\">      debug: false</span><br><span class=\"line\">    metrics:</span><br><span class=\"line\">      prometheus: &quot;&quot;</span><br><span class=\"line\">    entryPoints:</span><br><span class=\"line\">      web:</span><br><span class=\"line\">        address: &quot;:80&quot;</span><br><span class=\"line\">      websecure:</span><br><span class=\"line\">        address: &quot;:443&quot;</span><br><span class=\"line\">      mysql:</span><br><span class=\"line\">        address: &quot;:3306&quot;</span><br><span class=\"line\">      redis:    </span><br><span class=\"line\">        address: &quot;:6379&quot;</span><br><span class=\"line\">      jenkins:</span><br><span class=\"line\">        address: &quot;:8081&quot;</span><br><span class=\"line\">      gogo:</span><br><span class=\"line\">        address: &quot;:8082&quot;</span><br><span class=\"line\">      prometheus:</span><br><span class=\"line\">        address: &quot;:8181&quot;</span><br><span class=\"line\">    providers:</span><br><span class=\"line\">      kubernetesCRD: &quot;&quot;</span><br><span class=\"line\">      kubernetesIngress: &quot;&quot;</span><br><span class=\"line\">      file:</span><br><span class=\"line\">        directory: /etc/conf.d/</span><br><span class=\"line\">        watch: true</span><br><span class=\"line\">    log:</span><br><span class=\"line\">      filePath: &quot;&quot;</span><br><span class=\"line\">      level: error </span><br><span class=\"line\">      format: json</span><br><span class=\"line\">    accessLog:</span><br><span class=\"line\">      filePath: &quot;&quot;</span><br><span class=\"line\">      format: json</span><br><span class=\"line\">      bufferingSize: 0</span><br><span class=\"line\">      filters:</span><br><span class=\"line\">        #statusCodes: [&quot;200&quot;]</span><br><span class=\"line\">        retryAttempts: true</span><br><span class=\"line\">        minDuration: 20</span><br><span class=\"line\">      fields:</span><br><span class=\"line\">        defaultMode: keep</span><br><span class=\"line\">        names:</span><br><span class=\"line\">          ClientUsername: drop  </span><br><span class=\"line\">        headers:</span><br><span class=\"line\">          defaultMode: keep</span><br><span class=\"line\">          names:</span><br><span class=\"line\">            User-Agent: redact</span><br><span class=\"line\">            Authorization: drop</span><br><span class=\"line\">            Content-Type: keep</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">genkey()&#123;</span><br><span class=\"line\">openssl req \\</span><br><span class=\"line\">        -newkey rsa:2048 -nodes -keyout tls.key \\</span><br><span class=\"line\">        -x509 -days 3650 -out tls.crt \\</span><br><span class=\"line\">        -subj &quot;/C=CN/ST=GD/L=SZ/O=cs/OU=shea/CN=k8s.org&quot; </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\">kubectl create secret generic traefik-cert --from-file=tls.crt --from-file=tls.key -n kube-system</span></span>        </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">y_dynamic_toml()&#123;</span><br><span class=\"line\">   cat &gt;$1 &lt;&lt;EOF</span><br><span class=\"line\">defaultEntryPoints = [&quot;http&quot;,&quot;https&quot;]</span><br><span class=\"line\">[entryPoints]</span><br><span class=\"line\">  [entryPoints.http]</span><br><span class=\"line\">  address = &quot;:80&quot;</span><br><span class=\"line\">  [entryPoints.https]</span><br><span class=\"line\">  address = &quot;:443&quot;</span><br><span class=\"line\">    [entryPoints.https.tls]</span><br><span class=\"line\">      [[entryPoints.https.tls.certificates]]</span><br><span class=\"line\">      CertFile = &quot;/ssl/tls.crt&quot;</span><br><span class=\"line\">      KeyFile = &quot;/ssl/tls.key&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">tls:</span><br><span class=\"line\">  certificates:</span><br><span class=\"line\">    - certFile: /path/to/domain.cert</span><br><span class=\"line\">      keyFile: /path/to/domain.key</span><br><span class=\"line\">      stores: #stores 列表将被忽略，并自动设置为 [&quot;default&quot;]</span><br><span class=\"line\">        - default</span><br><span class=\"line\"></span><br><span class=\"line\">EOF</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">y_deploy()&#123;</span><br><span class=\"line\">   cat &gt;$1 &lt;&lt;EOF</span><br><span class=\"line\">---</span><br><span class=\"line\">apiVersion: apps/v1</span><br><span class=\"line\">kind: Deployment</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: traefik-ingress-controller</span><br><span class=\"line\">  namespace: kube-system</span><br><span class=\"line\">  labels:</span><br><span class=\"line\">    app: traefik</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  selector:</span><br><span class=\"line\">    matchLabels:</span><br><span class=\"line\">      app: traefik</span><br><span class=\"line\">  template:</span><br><span class=\"line\">    metadata:</span><br><span class=\"line\">      name: traefik</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        app: traefik</span><br><span class=\"line\">    spec:</span><br><span class=\"line\">      serviceAccountName: traefik-ingress-controller</span><br><span class=\"line\">      terminationGracePeriodSeconds: 1</span><br><span class=\"line\">      #设置node筛选器，在特定label的节点上启动  kubectl label node 192.168.56.109 tklabel=ok</span><br><span class=\"line\">      nodeSelector: </span><br><span class=\"line\">         tklabel: &quot;ok&quot;</span><br><span class=\"line\">      containers:</span><br><span class=\"line\">        - image: k8s.org/k8s/traefik:v2.2.10</span><br><span class=\"line\">          name: traefik</span><br><span class=\"line\">          ports:</span><br><span class=\"line\">            - name: web</span><br><span class=\"line\">              containerPort: 80</span><br><span class=\"line\">              hostPort: 80         ## 将容器端口绑定所在服务器的 80 端口</span><br><span class=\"line\">            - name: websecure</span><br><span class=\"line\">              containerPort: 443</span><br><span class=\"line\">              hostPort: 443        ## 将容器端口绑定所在服务器的 443 端口</span><br><span class=\"line\">            # - name: redis</span><br><span class=\"line\">            #   containerPort: 6379</span><br><span class=\"line\">            #  hostPort: 6379</span><br><span class=\"line\">            - name: admin</span><br><span class=\"line\">              containerPort: 8080  ## Traefik Dashboard 端口</span><br><span class=\"line\">          resources:</span><br><span class=\"line\">            limits:</span><br><span class=\"line\">              cpu: 200m</span><br><span class=\"line\">              memory: 256Mi</span><br><span class=\"line\">            requests:</span><br><span class=\"line\">              cpu: 100m</span><br><span class=\"line\">              memory: 256Mi</span><br><span class=\"line\">          securityContext:</span><br><span class=\"line\">            capabilities:</span><br><span class=\"line\">              drop:</span><br><span class=\"line\">                - ALL</span><br><span class=\"line\">              add:</span><br><span class=\"line\">                - NET_BIND_SERVICE</span><br><span class=\"line\">          args:</span><br><span class=\"line\">            - --configfile=/config/traefik.yaml</span><br><span class=\"line\">          volumeMounts:</span><br><span class=\"line\">            - mountPath: &quot;/config&quot;</span><br><span class=\"line\">              name: &quot;config&quot;</span><br><span class=\"line\">            - mountPath: &quot;/ssl&quot;</span><br><span class=\"line\">              name: &quot;ssl&quot;</span><br><span class=\"line\">      volumes:</span><br><span class=\"line\">        - name: config</span><br><span class=\"line\">          configMap:</span><br><span class=\"line\">            name: traefik-config-yaml</span><br><span class=\"line\">        - name: ssl</span><br><span class=\"line\">          secret:</span><br><span class=\"line\">            secretName: traefik-cert</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">y_service()&#123;</span><br><span class=\"line\">   cat &gt;$1 &lt;&lt;EOF</span><br><span class=\"line\">---</span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">kind: Service</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: traefik</span><br><span class=\"line\">  namespace: kube-system</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  ports:</span><br><span class=\"line\">    - name: web</span><br><span class=\"line\">      port: 80</span><br><span class=\"line\">    - name: websecure</span><br><span class=\"line\">      port: 443</span><br><span class=\"line\">    - name: admin   #没有会显示 404 page not found</span><br><span class=\"line\">      port: 8080</span><br><span class=\"line\">  selector:</span><br><span class=\"line\">    app: traefik</span><br><span class=\"line\"></span><br><span class=\"line\">EOF</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">y_ingress()&#123;</span><br><span class=\"line\">   cat &gt;$1 &lt;&lt;&quot;EOF&quot;</span><br><span class=\"line\">---</span><br><span class=\"line\">apiVersion: traefik.containo.us/v1alpha1</span><br><span class=\"line\">kind: IngressRoute</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: traefik-dashboard-route</span><br><span class=\"line\">  namespace: kube-system</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  entryPoints:</span><br><span class=\"line\">    - web</span><br><span class=\"line\">  routes:</span><br><span class=\"line\">    - match: Host(`master02`) #pod节点</span><br><span class=\"line\">      kind: Rule</span><br><span class=\"line\">      services:</span><br><span class=\"line\">        - name: traefik</span><br><span class=\"line\">          port: 8080</span><br><span class=\"line\"></span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">[ -d &quot;$base_file&quot; ] || &#123; echo &quot;没有目录,则创建目录&quot; &amp;&amp; mkdir $base_file; &#125;</span><br><span class=\"line\">[ -n &quot;$(which openssl)&quot; ] || &#123; echo &quot;需要用到openssl,没有找到,退出&quot; &amp;&amp; exit 1; &#125;</span><br><span class=\"line\">cd $base_file</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"string\">genkey</span></span>  </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"string\">[ -f &quot;tls.key&quot; ] || &#123; echo &quot;没有生成密钥,退出&quot; &amp;&amp; exit 1; &#125;</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\">kubectl create secret generic traefik-cert --from-file=tls.crt --from-file=tls.key -n kube-system</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"string\">#kubectl create configmap traefik-conf --from-file=$dynamic -n kube-system</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">arr=($crd $rbac $role $static $dynamic $deploy  $svc $ingress)</span><br><span class=\"line\"></span><br><span class=\"line\">for i in $&#123;arr[@]&#125;; do</span><br><span class=\"line\">echo &quot;开始生成:&quot;$i </span><br><span class=\"line\"><span class=\"meta prompt_\">y_$</span><span class=\"language-bash\"><span class=\"string\">&#123;i:2:0-5&#125;  $i</span></span></span><br><span class=\"line\">[ -f &quot;$i&quot; ] || &#123; echo &quot;没有生成$i,退出&quot; &amp;&amp; exit 1; &#125;</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\">kubectl apply -f  $i</span></span></span><br><span class=\"line\">done</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n","site":{"data":{}},"excerpt":"","more":"<p>Træfɪk 是一个云原生的新型的 HTTP 反向代理、负载均衡软件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$bash traefik.sh</span><br><span class=\"line\">$ tree  ./test</span><br><span class=\"line\">./test</span><br><span class=\"line\">├── 1-crd.yaml</span><br><span class=\"line\">├── 2-rbac.yaml</span><br><span class=\"line\">├── 3-role.yaml</span><br><span class=\"line\">├── 4-static_config.yaml</span><br><span class=\"line\">├── 5-dynamic_toml.toml</span><br><span class=\"line\">├── 6-deploy.yaml</span><br><span class=\"line\">├── 7-service.yaml</span><br><span class=\"line\">└── 8-ingress.yaml</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>traefik.sh</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">!/bin/bash</span></span><br><span class=\"line\">DIR=&quot;$(cd &quot;$(dirname &quot;$0&quot;)&quot; &amp;&amp; pwd)&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">base_file=$DIR/test</span><br><span class=\"line\">crd=1-crd.yaml</span><br><span class=\"line\">rbac=2-rbac.yaml</span><br><span class=\"line\">role=3-role.yaml</span><br><span class=\"line\">static=4-static_config.yaml</span><br><span class=\"line\">dynamic=5-dynamic_toml.toml</span><br><span class=\"line\">deploy=6-deploy.yaml</span><br><span class=\"line\">svc=7-service.yaml</span><br><span class=\"line\">ingress=8-ingress.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">y_crd()&#123;</span><br><span class=\"line\">\tcat &gt;$1 &lt;&lt;EOF</span><br><span class=\"line\">---</span><br><span class=\"line\">apiVersion: apiextensions.k8s.io/v1beta1</span><br><span class=\"line\">kind: CustomResourceDefinition</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: ingressroutes.traefik.containo.us</span><br><span class=\"line\"></span><br><span class=\"line\">spec:</span><br><span class=\"line\">  group: traefik.containo.us</span><br><span class=\"line\">  version: v1alpha1</span><br><span class=\"line\">  names:</span><br><span class=\"line\">    kind: IngressRoute</span><br><span class=\"line\">    plural: ingressroutes</span><br><span class=\"line\">    singular: ingressroute</span><br><span class=\"line\">  scope: Namespaced</span><br><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\">apiVersion: apiextensions.k8s.io/v1beta1</span><br><span class=\"line\">kind: CustomResourceDefinition</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: middlewares.traefik.containo.us</span><br><span class=\"line\"></span><br><span class=\"line\">spec:</span><br><span class=\"line\">  group: traefik.containo.us</span><br><span class=\"line\">  version: v1alpha1</span><br><span class=\"line\">  names:</span><br><span class=\"line\">    kind: Middleware</span><br><span class=\"line\">    plural: middlewares</span><br><span class=\"line\">    singular: middleware</span><br><span class=\"line\">  scope: Namespaced</span><br><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\">apiVersion: apiextensions.k8s.io/v1beta1</span><br><span class=\"line\">kind: CustomResourceDefinition</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: ingressroutetcps.traefik.containo.us</span><br><span class=\"line\"></span><br><span class=\"line\">spec:</span><br><span class=\"line\">  group: traefik.containo.us</span><br><span class=\"line\">  version: v1alpha1</span><br><span class=\"line\">  names:</span><br><span class=\"line\">    kind: IngressRouteTCP</span><br><span class=\"line\">    plural: ingressroutetcps</span><br><span class=\"line\">    singular: ingressroutetcp</span><br><span class=\"line\">  scope: Namespaced</span><br><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\">apiVersion: apiextensions.k8s.io/v1beta1</span><br><span class=\"line\">kind: CustomResourceDefinition</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: ingressrouteudps.traefik.containo.us</span><br><span class=\"line\"></span><br><span class=\"line\">spec:</span><br><span class=\"line\">  group: traefik.containo.us</span><br><span class=\"line\">  version: v1alpha1</span><br><span class=\"line\">  names:</span><br><span class=\"line\">    kind: IngressRouteUDP</span><br><span class=\"line\">    plural: ingressrouteudps</span><br><span class=\"line\">    singular: ingressrouteudp</span><br><span class=\"line\">  scope: Namespaced</span><br><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\">apiVersion: apiextensions.k8s.io/v1beta1</span><br><span class=\"line\">kind: CustomResourceDefinition</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: tlsoptions.traefik.containo.us</span><br><span class=\"line\"></span><br><span class=\"line\">spec:</span><br><span class=\"line\">  group: traefik.containo.us</span><br><span class=\"line\">  version: v1alpha1</span><br><span class=\"line\">  names:</span><br><span class=\"line\">    kind: TLSOption</span><br><span class=\"line\">    plural: tlsoptions</span><br><span class=\"line\">    singular: tlsoption</span><br><span class=\"line\">  scope: Namespaced</span><br><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\">apiVersion: apiextensions.k8s.io/v1beta1</span><br><span class=\"line\">kind: CustomResourceDefinition</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: tlsstores.traefik.containo.us</span><br><span class=\"line\"></span><br><span class=\"line\">spec:</span><br><span class=\"line\">  group: traefik.containo.us</span><br><span class=\"line\">  version: v1alpha1</span><br><span class=\"line\">  names:</span><br><span class=\"line\">    kind: TLSStore</span><br><span class=\"line\">    plural: tlsstores</span><br><span class=\"line\">    singular: tlsstore</span><br><span class=\"line\">  scope: Namespaced</span><br><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\">apiVersion: apiextensions.k8s.io/v1beta1</span><br><span class=\"line\">kind: CustomResourceDefinition</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: traefikservices.traefik.containo.us</span><br><span class=\"line\"></span><br><span class=\"line\">spec:</span><br><span class=\"line\">  group: traefik.containo.us</span><br><span class=\"line\">  version: v1alpha1</span><br><span class=\"line\">  names:</span><br><span class=\"line\">    kind: TraefikService</span><br><span class=\"line\">    plural: traefikservices</span><br><span class=\"line\">    singular: traefikservice</span><br><span class=\"line\">  scope: Namespaced</span><br><span class=\"line\"></span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">y_rbac()&#123;</span><br><span class=\"line\"><span class=\"meta prompt_\">\tcat&gt;</span><span class=\"language-bash\"><span class=\"variable\">$1</span> &lt;&lt;<span class=\"string\">EOF</span></span></span><br><span class=\"line\">---</span><br><span class=\"line\">kind: ClusterRole</span><br><span class=\"line\">apiVersion: rbac.authorization.k8s.io/v1beta1</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: traefik-ingress-controller</span><br><span class=\"line\"></span><br><span class=\"line\">rules:</span><br><span class=\"line\">  - apiGroups:</span><br><span class=\"line\">      - &quot;&quot;</span><br><span class=\"line\">    resources:</span><br><span class=\"line\">      - services</span><br><span class=\"line\">      - endpoints</span><br><span class=\"line\">      - secrets</span><br><span class=\"line\">    verbs:</span><br><span class=\"line\">      - get</span><br><span class=\"line\">      - list</span><br><span class=\"line\">      - watch</span><br><span class=\"line\">  - apiGroups:</span><br><span class=\"line\">      - &quot;&quot;</span><br><span class=\"line\">    resources:</span><br><span class=\"line\">      - persistentvolumes</span><br><span class=\"line\">    verbs:</span><br><span class=\"line\">      - get</span><br><span class=\"line\">      - list</span><br><span class=\"line\">      - watch</span><br><span class=\"line\">      - create  # persistentvolumes</span><br><span class=\"line\">      - delete</span><br><span class=\"line\">  - apiGroups:</span><br><span class=\"line\">      - &quot;&quot;</span><br><span class=\"line\">    resources:</span><br><span class=\"line\">      - persistentvolumeclaims</span><br><span class=\"line\">    verbs:</span><br><span class=\"line\">      - get</span><br><span class=\"line\">      - list</span><br><span class=\"line\">      - watch</span><br><span class=\"line\">      - update  # persistentvolumeclaims         </span><br><span class=\"line\">  - apiGroups:</span><br><span class=\"line\">      - extensions</span><br><span class=\"line\">    resources:</span><br><span class=\"line\">      - ingresses</span><br><span class=\"line\">    verbs:</span><br><span class=\"line\">      - get</span><br><span class=\"line\">      - list</span><br><span class=\"line\">      - watch</span><br><span class=\"line\">  - apiGroups:</span><br><span class=\"line\">      - extensions</span><br><span class=\"line\">    resources:</span><br><span class=\"line\">      - ingresses/status</span><br><span class=\"line\">    verbs:</span><br><span class=\"line\">      - update</span><br><span class=\"line\">  - apiGroups:</span><br><span class=\"line\">      - traefik.containo.us</span><br><span class=\"line\">    resources:</span><br><span class=\"line\">      - middlewares</span><br><span class=\"line\">      - ingressroutes</span><br><span class=\"line\">      - traefikservices</span><br><span class=\"line\">      - ingressroutetcps</span><br><span class=\"line\">      - ingressrouteudps</span><br><span class=\"line\">      - tlsoptions</span><br><span class=\"line\">      - tlsstores</span><br><span class=\"line\">    verbs:</span><br><span class=\"line\">      - get</span><br><span class=\"line\">      - list</span><br><span class=\"line\">      - watch</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">y_role()&#123;</span><br><span class=\"line\">   cat &gt;$1 &lt;&lt;EOF</span><br><span class=\"line\">---</span><br><span class=\"line\">kind: ClusterRoleBinding</span><br><span class=\"line\">apiVersion: rbac.authorization.k8s.io/v1beta1</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: traefik-ingress-controller</span><br><span class=\"line\">roleRef:</span><br><span class=\"line\">  apiGroup: rbac.authorization.k8s.io</span><br><span class=\"line\">  kind: ClusterRole</span><br><span class=\"line\">  name: traefik-ingress-controller</span><br><span class=\"line\">subjects:</span><br><span class=\"line\">  - kind: ServiceAccount</span><br><span class=\"line\">    name: traefik-ingress-controller</span><br><span class=\"line\">    namespace: kube-system</span><br><span class=\"line\">---</span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">kind: ServiceAccount</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  namespace: kube-system</span><br><span class=\"line\">  name: traefik-ingress-controller</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\">静态配置动态文件======================?</span></span></span><br><span class=\"line\">y_static_config()&#123;</span><br><span class=\"line\">   cat &gt;$1 &lt;&lt;EOF</span><br><span class=\"line\">---</span><br><span class=\"line\">kind: ConfigMap</span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: traefik-config-yaml</span><br><span class=\"line\">  namespace: kube-system</span><br><span class=\"line\">data:</span><br><span class=\"line\">  traefik.yaml: |-</span><br><span class=\"line\">    ping: &quot;&quot;</span><br><span class=\"line\">    serversTransport:</span><br><span class=\"line\">      insecureSkipVerify: true</span><br><span class=\"line\">    api:</span><br><span class=\"line\">      insecure: true</span><br><span class=\"line\">      dashboard: true</span><br><span class=\"line\">      debug: false</span><br><span class=\"line\">    metrics:</span><br><span class=\"line\">      prometheus: &quot;&quot;</span><br><span class=\"line\">    entryPoints:</span><br><span class=\"line\">      web:</span><br><span class=\"line\">        address: &quot;:80&quot;</span><br><span class=\"line\">      websecure:</span><br><span class=\"line\">        address: &quot;:443&quot;</span><br><span class=\"line\">      mysql:</span><br><span class=\"line\">        address: &quot;:3306&quot;</span><br><span class=\"line\">      redis:    </span><br><span class=\"line\">        address: &quot;:6379&quot;</span><br><span class=\"line\">      jenkins:</span><br><span class=\"line\">        address: &quot;:8081&quot;</span><br><span class=\"line\">      gogo:</span><br><span class=\"line\">        address: &quot;:8082&quot;</span><br><span class=\"line\">      prometheus:</span><br><span class=\"line\">        address: &quot;:8181&quot;</span><br><span class=\"line\">    providers:</span><br><span class=\"line\">      kubernetesCRD: &quot;&quot;</span><br><span class=\"line\">      kubernetesIngress: &quot;&quot;</span><br><span class=\"line\">      file:</span><br><span class=\"line\">        directory: /etc/conf.d/</span><br><span class=\"line\">        watch: true</span><br><span class=\"line\">    log:</span><br><span class=\"line\">      filePath: &quot;&quot;</span><br><span class=\"line\">      level: error </span><br><span class=\"line\">      format: json</span><br><span class=\"line\">    accessLog:</span><br><span class=\"line\">      filePath: &quot;&quot;</span><br><span class=\"line\">      format: json</span><br><span class=\"line\">      bufferingSize: 0</span><br><span class=\"line\">      filters:</span><br><span class=\"line\">        #statusCodes: [&quot;200&quot;]</span><br><span class=\"line\">        retryAttempts: true</span><br><span class=\"line\">        minDuration: 20</span><br><span class=\"line\">      fields:</span><br><span class=\"line\">        defaultMode: keep</span><br><span class=\"line\">        names:</span><br><span class=\"line\">          ClientUsername: drop  </span><br><span class=\"line\">        headers:</span><br><span class=\"line\">          defaultMode: keep</span><br><span class=\"line\">          names:</span><br><span class=\"line\">            User-Agent: redact</span><br><span class=\"line\">            Authorization: drop</span><br><span class=\"line\">            Content-Type: keep</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">genkey()&#123;</span><br><span class=\"line\">openssl req \\</span><br><span class=\"line\">        -newkey rsa:2048 -nodes -keyout tls.key \\</span><br><span class=\"line\">        -x509 -days 3650 -out tls.crt \\</span><br><span class=\"line\">        -subj &quot;/C=CN/ST=GD/L=SZ/O=cs/OU=shea/CN=k8s.org&quot; </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\">kubectl create secret generic traefik-cert --from-file=tls.crt --from-file=tls.key -n kube-system</span></span>        </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">y_dynamic_toml()&#123;</span><br><span class=\"line\">   cat &gt;$1 &lt;&lt;EOF</span><br><span class=\"line\">defaultEntryPoints = [&quot;http&quot;,&quot;https&quot;]</span><br><span class=\"line\">[entryPoints]</span><br><span class=\"line\">  [entryPoints.http]</span><br><span class=\"line\">  address = &quot;:80&quot;</span><br><span class=\"line\">  [entryPoints.https]</span><br><span class=\"line\">  address = &quot;:443&quot;</span><br><span class=\"line\">    [entryPoints.https.tls]</span><br><span class=\"line\">      [[entryPoints.https.tls.certificates]]</span><br><span class=\"line\">      CertFile = &quot;/ssl/tls.crt&quot;</span><br><span class=\"line\">      KeyFile = &quot;/ssl/tls.key&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">tls:</span><br><span class=\"line\">  certificates:</span><br><span class=\"line\">    - certFile: /path/to/domain.cert</span><br><span class=\"line\">      keyFile: /path/to/domain.key</span><br><span class=\"line\">      stores: #stores 列表将被忽略，并自动设置为 [&quot;default&quot;]</span><br><span class=\"line\">        - default</span><br><span class=\"line\"></span><br><span class=\"line\">EOF</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">y_deploy()&#123;</span><br><span class=\"line\">   cat &gt;$1 &lt;&lt;EOF</span><br><span class=\"line\">---</span><br><span class=\"line\">apiVersion: apps/v1</span><br><span class=\"line\">kind: Deployment</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: traefik-ingress-controller</span><br><span class=\"line\">  namespace: kube-system</span><br><span class=\"line\">  labels:</span><br><span class=\"line\">    app: traefik</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  selector:</span><br><span class=\"line\">    matchLabels:</span><br><span class=\"line\">      app: traefik</span><br><span class=\"line\">  template:</span><br><span class=\"line\">    metadata:</span><br><span class=\"line\">      name: traefik</span><br><span class=\"line\">      labels:</span><br><span class=\"line\">        app: traefik</span><br><span class=\"line\">    spec:</span><br><span class=\"line\">      serviceAccountName: traefik-ingress-controller</span><br><span class=\"line\">      terminationGracePeriodSeconds: 1</span><br><span class=\"line\">      #设置node筛选器，在特定label的节点上启动  kubectl label node 192.168.56.109 tklabel=ok</span><br><span class=\"line\">      nodeSelector: </span><br><span class=\"line\">         tklabel: &quot;ok&quot;</span><br><span class=\"line\">      containers:</span><br><span class=\"line\">        - image: k8s.org/k8s/traefik:v2.2.10</span><br><span class=\"line\">          name: traefik</span><br><span class=\"line\">          ports:</span><br><span class=\"line\">            - name: web</span><br><span class=\"line\">              containerPort: 80</span><br><span class=\"line\">              hostPort: 80         ## 将容器端口绑定所在服务器的 80 端口</span><br><span class=\"line\">            - name: websecure</span><br><span class=\"line\">              containerPort: 443</span><br><span class=\"line\">              hostPort: 443        ## 将容器端口绑定所在服务器的 443 端口</span><br><span class=\"line\">            # - name: redis</span><br><span class=\"line\">            #   containerPort: 6379</span><br><span class=\"line\">            #  hostPort: 6379</span><br><span class=\"line\">            - name: admin</span><br><span class=\"line\">              containerPort: 8080  ## Traefik Dashboard 端口</span><br><span class=\"line\">          resources:</span><br><span class=\"line\">            limits:</span><br><span class=\"line\">              cpu: 200m</span><br><span class=\"line\">              memory: 256Mi</span><br><span class=\"line\">            requests:</span><br><span class=\"line\">              cpu: 100m</span><br><span class=\"line\">              memory: 256Mi</span><br><span class=\"line\">          securityContext:</span><br><span class=\"line\">            capabilities:</span><br><span class=\"line\">              drop:</span><br><span class=\"line\">                - ALL</span><br><span class=\"line\">              add:</span><br><span class=\"line\">                - NET_BIND_SERVICE</span><br><span class=\"line\">          args:</span><br><span class=\"line\">            - --configfile=/config/traefik.yaml</span><br><span class=\"line\">          volumeMounts:</span><br><span class=\"line\">            - mountPath: &quot;/config&quot;</span><br><span class=\"line\">              name: &quot;config&quot;</span><br><span class=\"line\">            - mountPath: &quot;/ssl&quot;</span><br><span class=\"line\">              name: &quot;ssl&quot;</span><br><span class=\"line\">      volumes:</span><br><span class=\"line\">        - name: config</span><br><span class=\"line\">          configMap:</span><br><span class=\"line\">            name: traefik-config-yaml</span><br><span class=\"line\">        - name: ssl</span><br><span class=\"line\">          secret:</span><br><span class=\"line\">            secretName: traefik-cert</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">y_service()&#123;</span><br><span class=\"line\">   cat &gt;$1 &lt;&lt;EOF</span><br><span class=\"line\">---</span><br><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">kind: Service</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: traefik</span><br><span class=\"line\">  namespace: kube-system</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  ports:</span><br><span class=\"line\">    - name: web</span><br><span class=\"line\">      port: 80</span><br><span class=\"line\">    - name: websecure</span><br><span class=\"line\">      port: 443</span><br><span class=\"line\">    - name: admin   #没有会显示 404 page not found</span><br><span class=\"line\">      port: 8080</span><br><span class=\"line\">  selector:</span><br><span class=\"line\">    app: traefik</span><br><span class=\"line\"></span><br><span class=\"line\">EOF</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">y_ingress()&#123;</span><br><span class=\"line\">   cat &gt;$1 &lt;&lt;&quot;EOF&quot;</span><br><span class=\"line\">---</span><br><span class=\"line\">apiVersion: traefik.containo.us/v1alpha1</span><br><span class=\"line\">kind: IngressRoute</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: traefik-dashboard-route</span><br><span class=\"line\">  namespace: kube-system</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  entryPoints:</span><br><span class=\"line\">    - web</span><br><span class=\"line\">  routes:</span><br><span class=\"line\">    - match: Host(`master02`) #pod节点</span><br><span class=\"line\">      kind: Rule</span><br><span class=\"line\">      services:</span><br><span class=\"line\">        - name: traefik</span><br><span class=\"line\">          port: 8080</span><br><span class=\"line\"></span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">[ -d &quot;$base_file&quot; ] || &#123; echo &quot;没有目录,则创建目录&quot; &amp;&amp; mkdir $base_file; &#125;</span><br><span class=\"line\">[ -n &quot;$(which openssl)&quot; ] || &#123; echo &quot;需要用到openssl,没有找到,退出&quot; &amp;&amp; exit 1; &#125;</span><br><span class=\"line\">cd $base_file</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"string\">genkey</span></span>  </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"string\">[ -f &quot;tls.key&quot; ] || &#123; echo &quot;没有生成密钥,退出&quot; &amp;&amp; exit 1; &#125;</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\">kubectl create secret generic traefik-cert --from-file=tls.crt --from-file=tls.key -n kube-system</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"string\">#kubectl create configmap traefik-conf --from-file=$dynamic -n kube-system</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">arr=($crd $rbac $role $static $dynamic $deploy  $svc $ingress)</span><br><span class=\"line\"></span><br><span class=\"line\">for i in $&#123;arr[@]&#125;; do</span><br><span class=\"line\">echo &quot;开始生成:&quot;$i </span><br><span class=\"line\"><span class=\"meta prompt_\">y_$</span><span class=\"language-bash\"><span class=\"string\">&#123;i:2:0-5&#125;  $i</span></span></span><br><span class=\"line\">[ -f &quot;$i&quot; ] || &#123; echo &quot;没有生成$i,退出&quot; &amp;&amp; exit 1; &#125;</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\">kubectl apply -f  $i</span></span></span><br><span class=\"line\">done</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n"},{"title":"初识K8S","date":"2018-09-07T04:36:29.000Z","_content":"\n### Master服务\n\n#### 安装kubernetes\n\n[官网下载kubernetes](https://kubernetes.io/docs/setup/release/notes/)\n\n```\ntar -xvf kubernetes.tar.gz  -C /opt/\n```\n\n下载 Client Binaries，Server Binaries\n\n```\nuname -s -m  #获取版本官网下载或执行下面命令下载\nbash /opt/kubernetes/cluster/get-kube-binaries.sh\n```\n\n <!--more--> \n\n> Kubernetes release: v1.11.0\n>\n> Server: linux/amd64 (to override, set KUBERNETES_SERVER_ARCH)\n>\n> Client: linux/amd64 (autodetected)\n>\n> Will download **kubernetes-server-linux-amd64.tar.gz** from https://dl.k8s.io/v1.11.0\n>\n> Will download and extract **kubernetes-client-linux-amd64.tar.gz** from https://dl.k8s.io/v1.11.0\n>\n> Is this ok? [Y]/n\n\nkubernetes-server\n\n```\ntar -tf   kubernetes-server-linux-amd64.tar.gz  #查看文件\ntar -xvf   kubernetes-server-linux-amd64.tar.gz  -C /opt/kubernetes/   --strip-components 1\n```\n\n\n\nkubernetes-client\n\n```\ntar -tf   kubernetes-client-linux-amd64.tar.gz\ntar -xvf   kubernetes-client-linux-amd64.tar.gz  -C /opt/kubernetes/   --strip-components 1\n```\n\n\n\n执行文件(配置文件可以直接路径)\n\n```\nsudo ln -s /opt/kubernetes/server/bin/kube-apiserver  /usr/bin/\nsudo ln -s /opt/kubernetes/server/bin/kube-controller-manager  /usr/bin/\nsudo ln -s /opt/kubernetes/server/bin/kube-scheduler  /usr/bin/\n```\n\n\n\n#### 准备依赖服务 etcd\n\n[etcd releases下载](https://github.com/etcd-io/etcd/releases) 如果s3.amazonaws.com下不动。。。\n\n被墙了 被墙了 被墙了\n\ngo 编译\n\n```\n#mkdir -p $GOPATH/src/go.etcd.io/ \n#cd $GOPATH/src/go.etcd.io/\n#git https://github.com/etcd-io/etcd.git\ncs@debian:~/gopath/etcd$ ./bulid\n```\n\n\n\n> can’t load package: package go.etcd.io/etcd: cannot find package “go.etcd.io/etcd” in any of:\n>\n> /opt/go/src/go.etcd.io/etcd (from $GOROOT)\n>\n> /home/cs/gopath/src/go.etcd.io/etcd (from $GOPATH)\n\n```\n$GOPATH/bin/etcd   #运行\n$ ETCDCTL_API=3 ./bin/etcdctl put foo bar\nOK\n```\n\n##### 创建用户\n\n```\nsudo groupadd  -g 995 etcd\nsudo useradd -s /sbin/nologin -M -c \"etcd user\" -u 995 etcd -g  etcd\nsduo mkdir -p /etc/etcd \nsudo mkdir -p /var/lib/etcd \nsudo chown -R etcd.etcd /var/lib/etcd\n```\n\n##### etcd.service\n\n```\n[Unit] \nDescription=Etcd Server \nAfter=network.target \nAfter=network-online.target \nWants=network-online.target \n \n[Service] \nType=notify \nWorkingDirectory=/var/lib/etcd/ \nEnvironmentFile=-/etc/etcd/etcd.conf \nUser=etcd \n# set GOMAXPROCS to number of processors \nExecStart=/bin/bash -c \"GOMAXPROCS=$(nproc) /usr/bin/etcd --name=\\\"${ETCD_NAME}\\\" --data-dir=\\\"${ETCD_DATA_DIR}\\\" --listen-client-urls=\\\"${ETCD_LISTEN_CLIENT_URLS}\\\"\" \nRestart=on-failure \nLimitNOFILE=65536 \n \n[Install] \nWantedBy=multi-user.target\n```\n\n> sudo systemctl start etcd.service\n>\n> 该命令启动不了 /bin/bash -c “GOMAXPROCS=$(nproc) /usr/bin/etcd –name=\\”${ETCD_NAME}\\” –data-dir=\\”${ETCD_DATA_DIR}\\” –listen-client-urls=\\”${ETCD_LISTEN_CLIENT_URLS}\\””\n>\n> sudo systemctl status etcd.service\n>\n> **bash[9841]: run the stateless etcd v3 gRPC L7 reverse proxy\n>\n> debian systemd[1]: etcd.service: main process exited, code=exited, status=2/INVALIDARGUMENT\n>\n> debian systemd[1]: Failed to start Etcd Server.\n> **\n\n设置etcd\nExecStart=/opt/etcd-v3.3.9/etcd\n\n##### 启动etcd服务\n\n```\ntemp=\"etcd.service\"\nsudo cp $temp /lib/systemd/system\nsudo systemctl daemon-reload\nsudo systemctl enable $temp\nsudo systemctl start $temp\nsudo systemctl status $temp\n```\n\n> ● etcd.service - Etcd Server\n>\n> Loaded: loaded (/lib/systemd/system/etcd.service; enabled)\n>\n> Active: active (running) since 六 2018-09-08 14:53:26 CST; 5min ago\n> Main PID: 804 (etcd)\n>\n> CGroup: /system.slice/etcd.service\n>\n> └─804 /opt/etcd-v3.3.9/etcd\n\n```\n./etcdctl cluster-health\n```\n\n> member 8e9e05c52164694d is healthy: got healthy result from [http://localhost:2379](http://localhost:2379/)\n>\n> cluster is healthy\n\n#### kube-apiserver\n\n##### 创建用户\n\n```\nsudo groupadd -g 996 kube\nsudo useradd -s /sbin/nologin -M -c \"kube user\" -u 996 kube -g kube\nsudo mkdir -p /etc/kubernetes\nsudo mkdir -p /usr/libexec/kubernetes\nsudo chown -R kube.kube /usr/libexec/kubernetes\nsudo chown -R kube.kube /var/run/kubernetes\n```\n\n##### kube-apiserver.service\n\n```\n[Unit]\nDescription=Kubernetes API Server\nDocumentation=https://github.com/kubernetes\n#Dependent service\nAfter=etcd.service\n\n[Service]\nEnvironmentFile=-/etc/kubernetes/apiserver\nExecStart=/opt/kubernetes/server/bin/kube-apiserver $KUBE_API_ARGS\nRestart=on-failure\nType=notify\nLimitNOFILE=65536\n\n[Install]\nWantedBy=multi-user.target\n```\n\n> 1.error creating self-signed certificates: mkdir /var/run/kubernetes: permission denied\n>\n> 2.error: –[etcd](https://chengshea.github.io/linux/debian/docker/install-kubernetes/#etcd)-servers must be specified\n\n配置\n\n```\nsudo cat>/etc/kubernetes/apiserver<<EOF\nKUBE_API_ARGS=\"--etcd-servers=http://localhost:2379 --insecure-bind-address=0.0.0.0 --insecure-port=8080 --service-cluster-ip-range=169.169.0.0/16 --service-node-port-range=1-65535 --admission-control=NamespaceLifecycle,LimitRanger,SecurityContextDeny,ResourceQuota --logtostderr=false --log-dir=/var/log/kubernetes --v=2\"\nEOF\n```\n\n\n\n> –etcd-servers：就是etcd的地址。\n>\n> –insecure-bind-address：apiserver绑定主机的非安全IP地址，设置0.0.0.0表示绑定所有IP地址。\n>\n> –insecure-port：apiserver绑定主机的非安全端口，默认为8080。\n>\n> –service-cluster-ip-range：Kubernetes集群中Service的虚拟IP地址段范围，以CIDR格式表示，该IP范围不能与物理机真实IP段有重合。\n>\n> -service-node-port-range：Kubernetes集群中Service可映射的物理机端口范围，默认为30000~32767.\n>\n> –admission-control： Kubernetes集群的准入控制设置，各控制模块以插件形式依次生效。\n>\n> –logtostderr：设置为false表示将日志写入文件，不写入stderr。\n>\n> –log-dir： 日志目录。\n>\n> –v：日志级别。\n>\n> [更多参数查看官方文档](https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/)\n\n##### 启动\n\n```\ntemp=\"kube-apiserver.service\"\nsudo cp $temp /lib/systemd/system\nsudo systemctl daemon-reload\nsudo systemctl enable $temp\nsudo systemctl start $temp\nsudo systemctl status $temp\n```\n\n> ● kube-apiserver.service - Kubernetes API Server\n>\n> Loaded: loaded (/lib/systemd/system/kube-apiserver.service; disabled)\n>\n> Active: active (running) since 六 2018-09-08 15:42:02 CST; 2s ago\n> Docs: https://github.com/GoogleCloudPlatform/kubernetes\n>\n> Main PID: 3560 (kube-apiserver)\n>\n> CGroup: /system.slice/kube-apiserver.service\n>\n> └─3560 /opt/kubernetes/server/bin/kube-apiserver –etcd-servers=[http://localhost:2379](http://localhost:2379/) …….\n\n#### kube-controller-manager\n\n##### kube-controller-manager.service\n\n```\n[Unit]\nDescription=Kubernetes Scheduler Plugin\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=kube-apiserver.service\nRequires=kube-apiserver.service\n\n[Service]\nEnvironmentFile=-/etc/kubernetes/controller-manager\nUser=kube\nExecStart=/opt/kubernetes/server/bin/kube-controller-manager $KUBE_CONTROLLER_MANAGER_ARGS\nRestart=on-failure\nLimitNOFILE=65536\n\n[Install]\nWantedBy=multi-user.target\n```\n\n配置\n\n```\nsudo touch /etc/kubernetes/controller-manager && sudo  chmod 757 /etc/kubernetes/controller-manager\ncat>/etc/kubernetes/controller-manager<<EOF\nKUBE_CONTROLLER_MANAGER_ARGS=\"--master=http://192.168.56.101:8080 --logtostderr=false --log-dir=/var/log/kubernetes --v=2\" \nEOF\n```\n\n\n\n##### 启动\n\n```\ntemp=\"kube-controller-manager.service\"\nsudo cp $temp /lib/systemd/system\nsudo systemctl daemon-reload\nsudo systemctl enable $temp\nsudo systemctl start $temp\nsudo systemctl status $temp\n```\n\n> ● kube-controller-manager.service - Kubernetes Scheduler Plugin\n>\n> Loaded: loaded (/lib/systemd/system/kube-controller-manager.service; disabled)\n>\n> Active: active (running) since 六 2018-09-08 16:54:32 CST; 2s ago\n>\n> Docs: https://github.com/GoogleCloudPlatform/kubernetes\n>\n> Main PID: 5980 (kube-controller)\n>\n> CGroup: /system.slice/kube-controller-manager.service\n>\n> └─5980 /opt/kubernetes/server/bin/kube-controller-manager –master=[http://localhost:8080](http://localhost:8080/) ……\n\n#### kube-scheduler\n\n##### kube-scheduler.service\n\n```\n[Unit]\nDescription=Kubernetes Scheduler Manager\nDocumentation=https://github.com/kubernetes\nAfter=kube-apiserver.service\nRequires=kube-apiserver.service\n\n[Service]\nEnvironmentFile=/etc/kubernetes/scheduler\nExecStart=/opt/kubernetes/server/bin/kube-scheduler $KUBE_SCHEDULER_ARGS\nRestart=on-failure\nLimitNOFILE=65536\n\n[Install]\nWantedBy=multi-user.target\n```\n\n配置\n\n```\nsudo touch /etc/kubernetes/scheduler && sudo  chmod 757 /etc/kubernetes/scheduler\ncat>/etc/kubernetes/scheduler<<EOF\nKUBE_SCHEDULER_ARGS=\"--master=http://localhost:8080 --logtostderr=false --log-dir=/var/log/kubernetes --v=2\"\nEOF\n```\n\n\n\n##### 启动\n\n```\ntemp=\"kube-scheduler.service\"\nsudo cp $temp /lib/systemd/system\nsudo systemctl daemon-reload\nsudo systemctl enable $temp\nsudo systemctl start $temp\nsudo systemctl status $temp\n```\n\n> ● kube-scheduler.service - Kubernetes Scheduler Manager\n>\n> Loaded: loaded (/lib/systemd/system/kube-scheduler.service; disabled)\n>\n> Active: active (running) since 六 2018-09-08 17:02:09 CST; 7s ago\n>\n> Docs: https://github.com/kubernetes\n> Main PID: 6340 (kube-scheduler)\n>\n> CGroup: /system.slice/kube-scheduler.service\n>\n> └─6340 /opt/kubernetes/server/bin/kube-scheduler –master=[http://localhost:8080](http://localhost:8080/) ……\n\n### Node节点服务\n\n#### kubelet\n\n##### kubelet.service\n\n```\n[Unit]\nDescription=Kubernetes Kubelet Server\nDocumentation=https://github.com/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nWorkingDirectory=-/var/lib/kubelet\nEnvironmentFile=-/etc/kubernetes/kubelet\nExecStart=/opt/kubernetes/server/bin/kubelet $KUBELET_ARGS  \nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\n```\n\n> kubelet.service holdoff time over, scheduling restart\n\n配置\n\n```\nsudo mkdir -p /var/lib/kubelet\nsudo touch /etc/kubernetes/kubelet && sudo  chmod 757 /etc/kubernetes/kubelet\ncat>/etc/kubernetes/kubelet<<EOF\nKUBELET_ARGS=\"--kubeconfig=/etc/kubernetes/kubeconfig --hostname-override=127.0.0.1 --logtostderr=false --log-dir=/var/log/kubernetes --v=2\"\nEOF\n```\n\n\n\n> [–kubeconfig代替了–api-servers](https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/)\n>\n> \n> –[require-kubeconfig 1.7版开始默认true ](https://github.com/kubernetes/kubernetes/issues/36745)\n>\n> Kubernetes 1.8开始要求关闭系统的Swap\n\n##### 启动\n\n```\ntemp=\"kubelet.service\"\nsudo cp $temp /lib/systemd/system\nsudo systemctl daemon-reload\nsudo systemctl enable $temp\nsudo systemctl start $temp\nsudo systemctl status $temp\n```\n\n> ● kubelet.service - Kubernetes Kubelet Server\n>\n> Loaded: loaded (/lib/systemd/system/kubelet.service; disabled)\n>\n> Active: active (running) since 二 2018-09-11 18:34:48 CST; 29ms ago\n>\n> Docs: https://github.com/kubernetes\n> Main PID: 9018 (kubelet)\n>\n> CGroup: /system.slice/kubelet.service\n>\n> └─9018 /opt/kubernetes/server/bin/kubelet –kubeconfig=/etc/kubernetes/kubeconfig –hostname-override=127.0.0.1 –logtostderr=false –log-dir=/var/log/kubernetes –v=2 –cgroup-driver=systemd\n\n#### kube-proxy\n\n##### kube-proxy.service\n\n```\n[Unit]\nDescription=Kubernetes Kube-Proxt Server\nDocumentation=https://github.com/kubernetes\nAfter=network.target\nRequires=network.target\n\n[Service]\nEnvironmentFile=-/etc/kubernetes/proxy\nExecStart=/opt/kubernetes/server/bin/kube-proxy $KUBE_PROXY_ARGS\nRestart=on-failure\nLimitNOFILE=65536\n\n[Install]\nWantedBy=multi-user.target\n```\n\n配置\n\n```\nsudo touch /etc/kubernetes/proxy && sudo  chmod 757 /etc/kubernetes/proxy\ncat>/etc/kubernetes/proxy<<EOF\nKUBE_PROXY_ARGS=\"--master=http://localhost:8080  --logtostderr=false --log-dir=/var/log/kubernetes --v=2\"\nEOF\n```\n\n\n\n##### 启动\n\n```\ntemp=\"kube-proxy.service\"\nsudo cp $temp /lib/systemd/system\nsudo systemctl daemon-reload\nsudo systemctl enable $temp\nsudo systemctl start $temp\nsudo systemctl status $temp\n./kubectl get cs\n./kubectl get node\n```","source":"_posts/linux/k8s/初识K8S.md","raw":"---\ntitle: 初识K8S\ndate: 2018-09-07 12:36:29\ntags:\n  - k8s\n  - docker\ncategories:\n  - linux\n  - docker\n---\n\n### Master服务\n\n#### 安装kubernetes\n\n[官网下载kubernetes](https://kubernetes.io/docs/setup/release/notes/)\n\n```\ntar -xvf kubernetes.tar.gz  -C /opt/\n```\n\n下载 Client Binaries，Server Binaries\n\n```\nuname -s -m  #获取版本官网下载或执行下面命令下载\nbash /opt/kubernetes/cluster/get-kube-binaries.sh\n```\n\n <!--more--> \n\n> Kubernetes release: v1.11.0\n>\n> Server: linux/amd64 (to override, set KUBERNETES_SERVER_ARCH)\n>\n> Client: linux/amd64 (autodetected)\n>\n> Will download **kubernetes-server-linux-amd64.tar.gz** from https://dl.k8s.io/v1.11.0\n>\n> Will download and extract **kubernetes-client-linux-amd64.tar.gz** from https://dl.k8s.io/v1.11.0\n>\n> Is this ok? [Y]/n\n\nkubernetes-server\n\n```\ntar -tf   kubernetes-server-linux-amd64.tar.gz  #查看文件\ntar -xvf   kubernetes-server-linux-amd64.tar.gz  -C /opt/kubernetes/   --strip-components 1\n```\n\n\n\nkubernetes-client\n\n```\ntar -tf   kubernetes-client-linux-amd64.tar.gz\ntar -xvf   kubernetes-client-linux-amd64.tar.gz  -C /opt/kubernetes/   --strip-components 1\n```\n\n\n\n执行文件(配置文件可以直接路径)\n\n```\nsudo ln -s /opt/kubernetes/server/bin/kube-apiserver  /usr/bin/\nsudo ln -s /opt/kubernetes/server/bin/kube-controller-manager  /usr/bin/\nsudo ln -s /opt/kubernetes/server/bin/kube-scheduler  /usr/bin/\n```\n\n\n\n#### 准备依赖服务 etcd\n\n[etcd releases下载](https://github.com/etcd-io/etcd/releases) 如果s3.amazonaws.com下不动。。。\n\n被墙了 被墙了 被墙了\n\ngo 编译\n\n```\n#mkdir -p $GOPATH/src/go.etcd.io/ \n#cd $GOPATH/src/go.etcd.io/\n#git https://github.com/etcd-io/etcd.git\ncs@debian:~/gopath/etcd$ ./bulid\n```\n\n\n\n> can’t load package: package go.etcd.io/etcd: cannot find package “go.etcd.io/etcd” in any of:\n>\n> /opt/go/src/go.etcd.io/etcd (from $GOROOT)\n>\n> /home/cs/gopath/src/go.etcd.io/etcd (from $GOPATH)\n\n```\n$GOPATH/bin/etcd   #运行\n$ ETCDCTL_API=3 ./bin/etcdctl put foo bar\nOK\n```\n\n##### 创建用户\n\n```\nsudo groupadd  -g 995 etcd\nsudo useradd -s /sbin/nologin -M -c \"etcd user\" -u 995 etcd -g  etcd\nsduo mkdir -p /etc/etcd \nsudo mkdir -p /var/lib/etcd \nsudo chown -R etcd.etcd /var/lib/etcd\n```\n\n##### etcd.service\n\n```\n[Unit] \nDescription=Etcd Server \nAfter=network.target \nAfter=network-online.target \nWants=network-online.target \n \n[Service] \nType=notify \nWorkingDirectory=/var/lib/etcd/ \nEnvironmentFile=-/etc/etcd/etcd.conf \nUser=etcd \n# set GOMAXPROCS to number of processors \nExecStart=/bin/bash -c \"GOMAXPROCS=$(nproc) /usr/bin/etcd --name=\\\"${ETCD_NAME}\\\" --data-dir=\\\"${ETCD_DATA_DIR}\\\" --listen-client-urls=\\\"${ETCD_LISTEN_CLIENT_URLS}\\\"\" \nRestart=on-failure \nLimitNOFILE=65536 \n \n[Install] \nWantedBy=multi-user.target\n```\n\n> sudo systemctl start etcd.service\n>\n> 该命令启动不了 /bin/bash -c “GOMAXPROCS=$(nproc) /usr/bin/etcd –name=\\”${ETCD_NAME}\\” –data-dir=\\”${ETCD_DATA_DIR}\\” –listen-client-urls=\\”${ETCD_LISTEN_CLIENT_URLS}\\””\n>\n> sudo systemctl status etcd.service\n>\n> **bash[9841]: run the stateless etcd v3 gRPC L7 reverse proxy\n>\n> debian systemd[1]: etcd.service: main process exited, code=exited, status=2/INVALIDARGUMENT\n>\n> debian systemd[1]: Failed to start Etcd Server.\n> **\n\n设置etcd\nExecStart=/opt/etcd-v3.3.9/etcd\n\n##### 启动etcd服务\n\n```\ntemp=\"etcd.service\"\nsudo cp $temp /lib/systemd/system\nsudo systemctl daemon-reload\nsudo systemctl enable $temp\nsudo systemctl start $temp\nsudo systemctl status $temp\n```\n\n> ● etcd.service - Etcd Server\n>\n> Loaded: loaded (/lib/systemd/system/etcd.service; enabled)\n>\n> Active: active (running) since 六 2018-09-08 14:53:26 CST; 5min ago\n> Main PID: 804 (etcd)\n>\n> CGroup: /system.slice/etcd.service\n>\n> └─804 /opt/etcd-v3.3.9/etcd\n\n```\n./etcdctl cluster-health\n```\n\n> member 8e9e05c52164694d is healthy: got healthy result from [http://localhost:2379](http://localhost:2379/)\n>\n> cluster is healthy\n\n#### kube-apiserver\n\n##### 创建用户\n\n```\nsudo groupadd -g 996 kube\nsudo useradd -s /sbin/nologin -M -c \"kube user\" -u 996 kube -g kube\nsudo mkdir -p /etc/kubernetes\nsudo mkdir -p /usr/libexec/kubernetes\nsudo chown -R kube.kube /usr/libexec/kubernetes\nsudo chown -R kube.kube /var/run/kubernetes\n```\n\n##### kube-apiserver.service\n\n```\n[Unit]\nDescription=Kubernetes API Server\nDocumentation=https://github.com/kubernetes\n#Dependent service\nAfter=etcd.service\n\n[Service]\nEnvironmentFile=-/etc/kubernetes/apiserver\nExecStart=/opt/kubernetes/server/bin/kube-apiserver $KUBE_API_ARGS\nRestart=on-failure\nType=notify\nLimitNOFILE=65536\n\n[Install]\nWantedBy=multi-user.target\n```\n\n> 1.error creating self-signed certificates: mkdir /var/run/kubernetes: permission denied\n>\n> 2.error: –[etcd](https://chengshea.github.io/linux/debian/docker/install-kubernetes/#etcd)-servers must be specified\n\n配置\n\n```\nsudo cat>/etc/kubernetes/apiserver<<EOF\nKUBE_API_ARGS=\"--etcd-servers=http://localhost:2379 --insecure-bind-address=0.0.0.0 --insecure-port=8080 --service-cluster-ip-range=169.169.0.0/16 --service-node-port-range=1-65535 --admission-control=NamespaceLifecycle,LimitRanger,SecurityContextDeny,ResourceQuota --logtostderr=false --log-dir=/var/log/kubernetes --v=2\"\nEOF\n```\n\n\n\n> –etcd-servers：就是etcd的地址。\n>\n> –insecure-bind-address：apiserver绑定主机的非安全IP地址，设置0.0.0.0表示绑定所有IP地址。\n>\n> –insecure-port：apiserver绑定主机的非安全端口，默认为8080。\n>\n> –service-cluster-ip-range：Kubernetes集群中Service的虚拟IP地址段范围，以CIDR格式表示，该IP范围不能与物理机真实IP段有重合。\n>\n> -service-node-port-range：Kubernetes集群中Service可映射的物理机端口范围，默认为30000~32767.\n>\n> –admission-control： Kubernetes集群的准入控制设置，各控制模块以插件形式依次生效。\n>\n> –logtostderr：设置为false表示将日志写入文件，不写入stderr。\n>\n> –log-dir： 日志目录。\n>\n> –v：日志级别。\n>\n> [更多参数查看官方文档](https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/)\n\n##### 启动\n\n```\ntemp=\"kube-apiserver.service\"\nsudo cp $temp /lib/systemd/system\nsudo systemctl daemon-reload\nsudo systemctl enable $temp\nsudo systemctl start $temp\nsudo systemctl status $temp\n```\n\n> ● kube-apiserver.service - Kubernetes API Server\n>\n> Loaded: loaded (/lib/systemd/system/kube-apiserver.service; disabled)\n>\n> Active: active (running) since 六 2018-09-08 15:42:02 CST; 2s ago\n> Docs: https://github.com/GoogleCloudPlatform/kubernetes\n>\n> Main PID: 3560 (kube-apiserver)\n>\n> CGroup: /system.slice/kube-apiserver.service\n>\n> └─3560 /opt/kubernetes/server/bin/kube-apiserver –etcd-servers=[http://localhost:2379](http://localhost:2379/) …….\n\n#### kube-controller-manager\n\n##### kube-controller-manager.service\n\n```\n[Unit]\nDescription=Kubernetes Scheduler Plugin\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=kube-apiserver.service\nRequires=kube-apiserver.service\n\n[Service]\nEnvironmentFile=-/etc/kubernetes/controller-manager\nUser=kube\nExecStart=/opt/kubernetes/server/bin/kube-controller-manager $KUBE_CONTROLLER_MANAGER_ARGS\nRestart=on-failure\nLimitNOFILE=65536\n\n[Install]\nWantedBy=multi-user.target\n```\n\n配置\n\n```\nsudo touch /etc/kubernetes/controller-manager && sudo  chmod 757 /etc/kubernetes/controller-manager\ncat>/etc/kubernetes/controller-manager<<EOF\nKUBE_CONTROLLER_MANAGER_ARGS=\"--master=http://192.168.56.101:8080 --logtostderr=false --log-dir=/var/log/kubernetes --v=2\" \nEOF\n```\n\n\n\n##### 启动\n\n```\ntemp=\"kube-controller-manager.service\"\nsudo cp $temp /lib/systemd/system\nsudo systemctl daemon-reload\nsudo systemctl enable $temp\nsudo systemctl start $temp\nsudo systemctl status $temp\n```\n\n> ● kube-controller-manager.service - Kubernetes Scheduler Plugin\n>\n> Loaded: loaded (/lib/systemd/system/kube-controller-manager.service; disabled)\n>\n> Active: active (running) since 六 2018-09-08 16:54:32 CST; 2s ago\n>\n> Docs: https://github.com/GoogleCloudPlatform/kubernetes\n>\n> Main PID: 5980 (kube-controller)\n>\n> CGroup: /system.slice/kube-controller-manager.service\n>\n> └─5980 /opt/kubernetes/server/bin/kube-controller-manager –master=[http://localhost:8080](http://localhost:8080/) ……\n\n#### kube-scheduler\n\n##### kube-scheduler.service\n\n```\n[Unit]\nDescription=Kubernetes Scheduler Manager\nDocumentation=https://github.com/kubernetes\nAfter=kube-apiserver.service\nRequires=kube-apiserver.service\n\n[Service]\nEnvironmentFile=/etc/kubernetes/scheduler\nExecStart=/opt/kubernetes/server/bin/kube-scheduler $KUBE_SCHEDULER_ARGS\nRestart=on-failure\nLimitNOFILE=65536\n\n[Install]\nWantedBy=multi-user.target\n```\n\n配置\n\n```\nsudo touch /etc/kubernetes/scheduler && sudo  chmod 757 /etc/kubernetes/scheduler\ncat>/etc/kubernetes/scheduler<<EOF\nKUBE_SCHEDULER_ARGS=\"--master=http://localhost:8080 --logtostderr=false --log-dir=/var/log/kubernetes --v=2\"\nEOF\n```\n\n\n\n##### 启动\n\n```\ntemp=\"kube-scheduler.service\"\nsudo cp $temp /lib/systemd/system\nsudo systemctl daemon-reload\nsudo systemctl enable $temp\nsudo systemctl start $temp\nsudo systemctl status $temp\n```\n\n> ● kube-scheduler.service - Kubernetes Scheduler Manager\n>\n> Loaded: loaded (/lib/systemd/system/kube-scheduler.service; disabled)\n>\n> Active: active (running) since 六 2018-09-08 17:02:09 CST; 7s ago\n>\n> Docs: https://github.com/kubernetes\n> Main PID: 6340 (kube-scheduler)\n>\n> CGroup: /system.slice/kube-scheduler.service\n>\n> └─6340 /opt/kubernetes/server/bin/kube-scheduler –master=[http://localhost:8080](http://localhost:8080/) ……\n\n### Node节点服务\n\n#### kubelet\n\n##### kubelet.service\n\n```\n[Unit]\nDescription=Kubernetes Kubelet Server\nDocumentation=https://github.com/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nWorkingDirectory=-/var/lib/kubelet\nEnvironmentFile=-/etc/kubernetes/kubelet\nExecStart=/opt/kubernetes/server/bin/kubelet $KUBELET_ARGS  \nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\n```\n\n> kubelet.service holdoff time over, scheduling restart\n\n配置\n\n```\nsudo mkdir -p /var/lib/kubelet\nsudo touch /etc/kubernetes/kubelet && sudo  chmod 757 /etc/kubernetes/kubelet\ncat>/etc/kubernetes/kubelet<<EOF\nKUBELET_ARGS=\"--kubeconfig=/etc/kubernetes/kubeconfig --hostname-override=127.0.0.1 --logtostderr=false --log-dir=/var/log/kubernetes --v=2\"\nEOF\n```\n\n\n\n> [–kubeconfig代替了–api-servers](https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/)\n>\n> \n> –[require-kubeconfig 1.7版开始默认true ](https://github.com/kubernetes/kubernetes/issues/36745)\n>\n> Kubernetes 1.8开始要求关闭系统的Swap\n\n##### 启动\n\n```\ntemp=\"kubelet.service\"\nsudo cp $temp /lib/systemd/system\nsudo systemctl daemon-reload\nsudo systemctl enable $temp\nsudo systemctl start $temp\nsudo systemctl status $temp\n```\n\n> ● kubelet.service - Kubernetes Kubelet Server\n>\n> Loaded: loaded (/lib/systemd/system/kubelet.service; disabled)\n>\n> Active: active (running) since 二 2018-09-11 18:34:48 CST; 29ms ago\n>\n> Docs: https://github.com/kubernetes\n> Main PID: 9018 (kubelet)\n>\n> CGroup: /system.slice/kubelet.service\n>\n> └─9018 /opt/kubernetes/server/bin/kubelet –kubeconfig=/etc/kubernetes/kubeconfig –hostname-override=127.0.0.1 –logtostderr=false –log-dir=/var/log/kubernetes –v=2 –cgroup-driver=systemd\n\n#### kube-proxy\n\n##### kube-proxy.service\n\n```\n[Unit]\nDescription=Kubernetes Kube-Proxt Server\nDocumentation=https://github.com/kubernetes\nAfter=network.target\nRequires=network.target\n\n[Service]\nEnvironmentFile=-/etc/kubernetes/proxy\nExecStart=/opt/kubernetes/server/bin/kube-proxy $KUBE_PROXY_ARGS\nRestart=on-failure\nLimitNOFILE=65536\n\n[Install]\nWantedBy=multi-user.target\n```\n\n配置\n\n```\nsudo touch /etc/kubernetes/proxy && sudo  chmod 757 /etc/kubernetes/proxy\ncat>/etc/kubernetes/proxy<<EOF\nKUBE_PROXY_ARGS=\"--master=http://localhost:8080  --logtostderr=false --log-dir=/var/log/kubernetes --v=2\"\nEOF\n```\n\n\n\n##### 启动\n\n```\ntemp=\"kube-proxy.service\"\nsudo cp $temp /lib/systemd/system\nsudo systemctl daemon-reload\nsudo systemctl enable $temp\nsudo systemctl start $temp\nsudo systemctl status $temp\n./kubectl get cs\n./kubectl get node\n```","slug":"linux/k8s/初识K8S","published":1,"updated":"2022-07-21T12:20:32.885Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gttg002mgwi5hl0p130c","content":"<h3 id=\"Master服务\"><a href=\"#Master服务\" class=\"headerlink\" title=\"Master服务\"></a>Master服务</h3><h4 id=\"安装kubernetes\"><a href=\"#安装kubernetes\" class=\"headerlink\" title=\"安装kubernetes\"></a>安装kubernetes</h4><p><a href=\"https://kubernetes.io/docs/setup/release/notes/\">官网下载kubernetes</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -xvf kubernetes.tar.gz  -C /opt/</span><br></pre></td></tr></table></figure>\n\n<p>下载 Client Binaries，Server Binaries</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uname -s -m  #获取版本官网下载或执行下面命令下载</span><br><span class=\"line\">bash /opt/kubernetes/cluster/get-kube-binaries.sh</span><br></pre></td></tr></table></figure>\n\n <span id=\"more\"></span> \n\n<blockquote>\n<p>Kubernetes release: v1.11.0</p>\n<p>Server: linux&#x2F;amd64 (to override, set KUBERNETES_SERVER_ARCH)</p>\n<p>Client: linux&#x2F;amd64 (autodetected)</p>\n<p>Will download <strong>kubernetes-server-linux-amd64.tar.gz</strong> from <a href=\"https://dl.k8s.io/v1.11.0\">https://dl.k8s.io/v1.11.0</a></p>\n<p>Will download and extract <strong>kubernetes-client-linux-amd64.tar.gz</strong> from <a href=\"https://dl.k8s.io/v1.11.0\">https://dl.k8s.io/v1.11.0</a></p>\n<p>Is this ok? [Y]&#x2F;n</p>\n</blockquote>\n<p>kubernetes-server</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -tf   kubernetes-server-linux-amd64.tar.gz  #查看文件</span><br><span class=\"line\">tar -xvf   kubernetes-server-linux-amd64.tar.gz  -C /opt/kubernetes/   --strip-components 1</span><br></pre></td></tr></table></figure>\n\n\n\n<p>kubernetes-client</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -tf   kubernetes-client-linux-amd64.tar.gz</span><br><span class=\"line\">tar -xvf   kubernetes-client-linux-amd64.tar.gz  -C /opt/kubernetes/   --strip-components 1</span><br></pre></td></tr></table></figure>\n\n\n\n<p>执行文件(配置文件可以直接路径)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ln -s /opt/kubernetes/server/bin/kube-apiserver  /usr/bin/</span><br><span class=\"line\">sudo ln -s /opt/kubernetes/server/bin/kube-controller-manager  /usr/bin/</span><br><span class=\"line\">sudo ln -s /opt/kubernetes/server/bin/kube-scheduler  /usr/bin/</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"准备依赖服务-etcd\"><a href=\"#准备依赖服务-etcd\" class=\"headerlink\" title=\"准备依赖服务 etcd\"></a>准备依赖服务 etcd</h4><p><a href=\"https://github.com/etcd-io/etcd/releases\">etcd releases下载</a> 如果s3.amazonaws.com下不动。。。</p>\n<p>被墙了 被墙了 被墙了</p>\n<p>go 编译</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#mkdir -p $GOPATH/src/go.etcd.io/ </span><br><span class=\"line\">#cd $GOPATH/src/go.etcd.io/</span><br><span class=\"line\">#git https://github.com/etcd-io/etcd.git</span><br><span class=\"line\">cs@debian:~/gopath/etcd$ ./bulid</span><br></pre></td></tr></table></figure>\n\n\n\n<blockquote>\n<p>can’t load package: package go.etcd.io&#x2F;etcd: cannot find package “go.etcd.io&#x2F;etcd” in any of:</p>\n<p>&#x2F;opt&#x2F;go&#x2F;src&#x2F;go.etcd.io&#x2F;etcd (from $GOROOT)</p>\n<p>&#x2F;home&#x2F;cs&#x2F;gopath&#x2F;src&#x2F;go.etcd.io&#x2F;etcd (from $GOPATH)</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$GOPATH/bin/etcd   #运行</span><br><span class=\"line\">$ ETCDCTL_API=3 ./bin/etcdctl put foo bar</span><br><span class=\"line\">OK</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"创建用户\"><a href=\"#创建用户\" class=\"headerlink\" title=\"创建用户\"></a>创建用户</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo groupadd  -g 995 etcd</span><br><span class=\"line\">sudo useradd -s /sbin/nologin -M -c &quot;etcd user&quot; -u 995 etcd -g  etcd</span><br><span class=\"line\">sduo mkdir -p /etc/etcd </span><br><span class=\"line\">sudo mkdir -p /var/lib/etcd </span><br><span class=\"line\">sudo chown -R etcd.etcd /var/lib/etcd</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"etcd-service\"><a href=\"#etcd-service\" class=\"headerlink\" title=\"etcd.service\"></a>etcd.service</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit] </span><br><span class=\"line\">Description=Etcd Server </span><br><span class=\"line\">After=network.target </span><br><span class=\"line\">After=network-online.target </span><br><span class=\"line\">Wants=network-online.target </span><br><span class=\"line\"> </span><br><span class=\"line\">[Service] </span><br><span class=\"line\">Type=notify </span><br><span class=\"line\">WorkingDirectory=/var/lib/etcd/ </span><br><span class=\"line\">EnvironmentFile=-/etc/etcd/etcd.conf </span><br><span class=\"line\">User=etcd </span><br><span class=\"line\"># set GOMAXPROCS to number of processors </span><br><span class=\"line\">ExecStart=/bin/bash -c &quot;GOMAXPROCS=$(nproc) /usr/bin/etcd --name=\\&quot;$&#123;ETCD_NAME&#125;\\&quot; --data-dir=\\&quot;$&#123;ETCD_DATA_DIR&#125;\\&quot; --listen-client-urls=\\&quot;$&#123;ETCD_LISTEN_CLIENT_URLS&#125;\\&quot;&quot; </span><br><span class=\"line\">Restart=on-failure </span><br><span class=\"line\">LimitNOFILE=65536 </span><br><span class=\"line\"> </span><br><span class=\"line\">[Install] </span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>sudo systemctl start etcd.service</p>\n<p>该命令启动不了 &#x2F;bin&#x2F;bash -c “GOMAXPROCS&#x3D;$(nproc) &#x2F;usr&#x2F;bin&#x2F;etcd –name&#x3D;\\”${ETCD_NAME}\\” –data-dir&#x3D;\\”${ETCD_DATA_DIR}\\” –listen-client-urls&#x3D;\\”${ETCD_LISTEN_CLIENT_URLS}\\””</p>\n<p>sudo systemctl status etcd.service</p>\n<p>**bash[9841]: run the stateless etcd v3 gRPC L7 reverse proxy</p>\n<p>debian systemd[1]: etcd.service: main process exited, code&#x3D;exited, status&#x3D;2&#x2F;INVALIDARGUMENT</p>\n<p>debian systemd[1]: Failed to start Etcd Server.<br>**</p>\n</blockquote>\n<p>设置etcd<br>ExecStart&#x3D;&#x2F;opt&#x2F;etcd-v3.3.9&#x2F;etcd</p>\n<h5 id=\"启动etcd服务\"><a href=\"#启动etcd服务\" class=\"headerlink\" title=\"启动etcd服务\"></a>启动etcd服务</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">temp=&quot;etcd.service&quot;</span><br><span class=\"line\">sudo cp $temp /lib/systemd/system</span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl enable $temp</span><br><span class=\"line\">sudo systemctl start $temp</span><br><span class=\"line\">sudo systemctl status $temp</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>● etcd.service - Etcd Server</p>\n<p>Loaded: loaded (&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;etcd.service; enabled)</p>\n<p>Active: active (running) since 六 2018-09-08 14:53:26 CST; 5min ago<br>Main PID: 804 (etcd)</p>\n<p>CGroup: &#x2F;system.slice&#x2F;etcd.service</p>\n<p>└─804 &#x2F;opt&#x2F;etcd-v3.3.9&#x2F;etcd</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./etcdctl cluster-health</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>member 8e9e05c52164694d is healthy: got healthy result from <a href=\"http://localhost:2379/\">http://localhost:2379</a></p>\n<p>cluster is healthy</p>\n</blockquote>\n<h4 id=\"kube-apiserver\"><a href=\"#kube-apiserver\" class=\"headerlink\" title=\"kube-apiserver\"></a>kube-apiserver</h4><h5 id=\"创建用户-1\"><a href=\"#创建用户-1\" class=\"headerlink\" title=\"创建用户\"></a>创建用户</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo groupadd -g 996 kube</span><br><span class=\"line\">sudo useradd -s /sbin/nologin -M -c &quot;kube user&quot; -u 996 kube -g kube</span><br><span class=\"line\">sudo mkdir -p /etc/kubernetes</span><br><span class=\"line\">sudo mkdir -p /usr/libexec/kubernetes</span><br><span class=\"line\">sudo chown -R kube.kube /usr/libexec/kubernetes</span><br><span class=\"line\">sudo chown -R kube.kube /var/run/kubernetes</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"kube-apiserver-service\"><a href=\"#kube-apiserver-service\" class=\"headerlink\" title=\"kube-apiserver.service\"></a>kube-apiserver.service</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Kubernetes API Server</span><br><span class=\"line\">Documentation=https://github.com/kubernetes</span><br><span class=\"line\">#Dependent service</span><br><span class=\"line\">After=etcd.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">EnvironmentFile=-/etc/kubernetes/apiserver</span><br><span class=\"line\">ExecStart=/opt/kubernetes/server/bin/kube-apiserver $KUBE_API_ARGS</span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\">Type=notify</span><br><span class=\"line\">LimitNOFILE=65536</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>1.error creating self-signed certificates: mkdir &#x2F;var&#x2F;run&#x2F;kubernetes: permission denied</p>\n<p>2.error: –<a href=\"https://chengshea.github.io/linux/debian/docker/install-kubernetes/#etcd\">etcd</a>-servers must be specified</p>\n</blockquote>\n<p>配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo cat&gt;/etc/kubernetes/apiserver&lt;&lt;EOF</span><br><span class=\"line\">KUBE_API_ARGS=&quot;--etcd-servers=http://localhost:2379 --insecure-bind-address=0.0.0.0 --insecure-port=8080 --service-cluster-ip-range=169.169.0.0/16 --service-node-port-range=1-65535 --admission-control=NamespaceLifecycle,LimitRanger,SecurityContextDeny,ResourceQuota --logtostderr=false --log-dir=/var/log/kubernetes --v=2&quot;</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n\n\n<blockquote>\n<p>–etcd-servers：就是etcd的地址。</p>\n<p>–insecure-bind-address：apiserver绑定主机的非安全IP地址，设置0.0.0.0表示绑定所有IP地址。</p>\n<p>–insecure-port：apiserver绑定主机的非安全端口，默认为8080。</p>\n<p>–service-cluster-ip-range：Kubernetes集群中Service的虚拟IP地址段范围，以CIDR格式表示，该IP范围不能与物理机真实IP段有重合。</p>\n<p>-service-node-port-range：Kubernetes集群中Service可映射的物理机端口范围，默认为30000~32767.</p>\n<p>–admission-control： Kubernetes集群的准入控制设置，各控制模块以插件形式依次生效。</p>\n<p>–logtostderr：设置为false表示将日志写入文件，不写入stderr。</p>\n<p>–log-dir： 日志目录。</p>\n<p>–v：日志级别。</p>\n<p><a href=\"https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/\">更多参数查看官方文档</a></p>\n</blockquote>\n<h5 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">temp=&quot;kube-apiserver.service&quot;</span><br><span class=\"line\">sudo cp $temp /lib/systemd/system</span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl enable $temp</span><br><span class=\"line\">sudo systemctl start $temp</span><br><span class=\"line\">sudo systemctl status $temp</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>● kube-apiserver.service - Kubernetes API Server</p>\n<p>Loaded: loaded (&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;kube-apiserver.service; disabled)</p>\n<p>Active: active (running) since 六 2018-09-08 15:42:02 CST; 2s ago<br>Docs: <a href=\"https://github.com/GoogleCloudPlatform/kubernetes\">https://github.com/GoogleCloudPlatform/kubernetes</a></p>\n<p>Main PID: 3560 (kube-apiserver)</p>\n<p>CGroup: &#x2F;system.slice&#x2F;kube-apiserver.service</p>\n<p>└─3560 &#x2F;opt&#x2F;kubernetes&#x2F;server&#x2F;bin&#x2F;kube-apiserver –etcd-servers&#x3D;<a href=\"http://localhost:2379/\">http://localhost:2379</a> …….</p>\n</blockquote>\n<h4 id=\"kube-controller-manager\"><a href=\"#kube-controller-manager\" class=\"headerlink\" title=\"kube-controller-manager\"></a>kube-controller-manager</h4><h5 id=\"kube-controller-manager-service\"><a href=\"#kube-controller-manager-service\" class=\"headerlink\" title=\"kube-controller-manager.service\"></a>kube-controller-manager.service</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Kubernetes Scheduler Plugin</span><br><span class=\"line\">Documentation=https://github.com/GoogleCloudPlatform/kubernetes</span><br><span class=\"line\">After=kube-apiserver.service</span><br><span class=\"line\">Requires=kube-apiserver.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">EnvironmentFile=-/etc/kubernetes/controller-manager</span><br><span class=\"line\">User=kube</span><br><span class=\"line\">ExecStart=/opt/kubernetes/server/bin/kube-controller-manager $KUBE_CONTROLLER_MANAGER_ARGS</span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\">LimitNOFILE=65536</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n<p>配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo touch /etc/kubernetes/controller-manager &amp;&amp; sudo  chmod 757 /etc/kubernetes/controller-manager</span><br><span class=\"line\">cat&gt;/etc/kubernetes/controller-manager&lt;&lt;EOF</span><br><span class=\"line\">KUBE_CONTROLLER_MANAGER_ARGS=&quot;--master=http://192.168.56.101:8080 --logtostderr=false --log-dir=/var/log/kubernetes --v=2&quot; </span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"启动-1\"><a href=\"#启动-1\" class=\"headerlink\" title=\"启动\"></a>启动</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">temp=&quot;kube-controller-manager.service&quot;</span><br><span class=\"line\">sudo cp $temp /lib/systemd/system</span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl enable $temp</span><br><span class=\"line\">sudo systemctl start $temp</span><br><span class=\"line\">sudo systemctl status $temp</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>● kube-controller-manager.service - Kubernetes Scheduler Plugin</p>\n<p>Loaded: loaded (&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;kube-controller-manager.service; disabled)</p>\n<p>Active: active (running) since 六 2018-09-08 16:54:32 CST; 2s ago</p>\n<p>Docs: <a href=\"https://github.com/GoogleCloudPlatform/kubernetes\">https://github.com/GoogleCloudPlatform/kubernetes</a></p>\n<p>Main PID: 5980 (kube-controller)</p>\n<p>CGroup: &#x2F;system.slice&#x2F;kube-controller-manager.service</p>\n<p>└─5980 &#x2F;opt&#x2F;kubernetes&#x2F;server&#x2F;bin&#x2F;kube-controller-manager –master&#x3D;<a href=\"http://localhost:8080/\">http://localhost:8080</a> ……</p>\n</blockquote>\n<h4 id=\"kube-scheduler\"><a href=\"#kube-scheduler\" class=\"headerlink\" title=\"kube-scheduler\"></a>kube-scheduler</h4><h5 id=\"kube-scheduler-service\"><a href=\"#kube-scheduler-service\" class=\"headerlink\" title=\"kube-scheduler.service\"></a>kube-scheduler.service</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Kubernetes Scheduler Manager</span><br><span class=\"line\">Documentation=https://github.com/kubernetes</span><br><span class=\"line\">After=kube-apiserver.service</span><br><span class=\"line\">Requires=kube-apiserver.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">EnvironmentFile=/etc/kubernetes/scheduler</span><br><span class=\"line\">ExecStart=/opt/kubernetes/server/bin/kube-scheduler $KUBE_SCHEDULER_ARGS</span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\">LimitNOFILE=65536</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n<p>配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo touch /etc/kubernetes/scheduler &amp;&amp; sudo  chmod 757 /etc/kubernetes/scheduler</span><br><span class=\"line\">cat&gt;/etc/kubernetes/scheduler&lt;&lt;EOF</span><br><span class=\"line\">KUBE_SCHEDULER_ARGS=&quot;--master=http://localhost:8080 --logtostderr=false --log-dir=/var/log/kubernetes --v=2&quot;</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"启动-2\"><a href=\"#启动-2\" class=\"headerlink\" title=\"启动\"></a>启动</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">temp=&quot;kube-scheduler.service&quot;</span><br><span class=\"line\">sudo cp $temp /lib/systemd/system</span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl enable $temp</span><br><span class=\"line\">sudo systemctl start $temp</span><br><span class=\"line\">sudo systemctl status $temp</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>● kube-scheduler.service - Kubernetes Scheduler Manager</p>\n<p>Loaded: loaded (&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;kube-scheduler.service; disabled)</p>\n<p>Active: active (running) since 六 2018-09-08 17:02:09 CST; 7s ago</p>\n<p>Docs: <a href=\"https://github.com/kubernetes\">https://github.com/kubernetes</a><br>Main PID: 6340 (kube-scheduler)</p>\n<p>CGroup: &#x2F;system.slice&#x2F;kube-scheduler.service</p>\n<p>└─6340 &#x2F;opt&#x2F;kubernetes&#x2F;server&#x2F;bin&#x2F;kube-scheduler –master&#x3D;<a href=\"http://localhost:8080/\">http://localhost:8080</a> ……</p>\n</blockquote>\n<h3 id=\"Node节点服务\"><a href=\"#Node节点服务\" class=\"headerlink\" title=\"Node节点服务\"></a>Node节点服务</h3><h4 id=\"kubelet\"><a href=\"#kubelet\" class=\"headerlink\" title=\"kubelet\"></a>kubelet</h4><h5 id=\"kubelet-service\"><a href=\"#kubelet-service\" class=\"headerlink\" title=\"kubelet.service\"></a>kubelet.service</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Kubernetes Kubelet Server</span><br><span class=\"line\">Documentation=https://github.com/kubernetes</span><br><span class=\"line\">After=docker.service</span><br><span class=\"line\">Requires=docker.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">WorkingDirectory=-/var/lib/kubelet</span><br><span class=\"line\">EnvironmentFile=-/etc/kubernetes/kubelet</span><br><span class=\"line\">ExecStart=/opt/kubernetes/server/bin/kubelet $KUBELET_ARGS  </span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>kubelet.service holdoff time over, scheduling restart</p>\n</blockquote>\n<p>配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir -p /var/lib/kubelet</span><br><span class=\"line\">sudo touch /etc/kubernetes/kubelet &amp;&amp; sudo  chmod 757 /etc/kubernetes/kubelet</span><br><span class=\"line\">cat&gt;/etc/kubernetes/kubelet&lt;&lt;EOF</span><br><span class=\"line\">KUBELET_ARGS=&quot;--kubeconfig=/etc/kubernetes/kubeconfig --hostname-override=127.0.0.1 --logtostderr=false --log-dir=/var/log/kubernetes --v=2&quot;</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n\n\n<blockquote>\n<p><a href=\"https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/\">–kubeconfig代替了–api-servers</a></p>\n<p>–<a href=\"https://github.com/kubernetes/kubernetes/issues/36745\">require-kubeconfig 1.7版开始默认true </a></p>\n<p>Kubernetes 1.8开始要求关闭系统的Swap</p>\n</blockquote>\n<h5 id=\"启动-3\"><a href=\"#启动-3\" class=\"headerlink\" title=\"启动\"></a>启动</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">temp=&quot;kubelet.service&quot;</span><br><span class=\"line\">sudo cp $temp /lib/systemd/system</span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl enable $temp</span><br><span class=\"line\">sudo systemctl start $temp</span><br><span class=\"line\">sudo systemctl status $temp</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>● kubelet.service - Kubernetes Kubelet Server</p>\n<p>Loaded: loaded (&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;kubelet.service; disabled)</p>\n<p>Active: active (running) since 二 2018-09-11 18:34:48 CST; 29ms ago</p>\n<p>Docs: <a href=\"https://github.com/kubernetes\">https://github.com/kubernetes</a><br>Main PID: 9018 (kubelet)</p>\n<p>CGroup: &#x2F;system.slice&#x2F;kubelet.service</p>\n<p>└─9018 &#x2F;opt&#x2F;kubernetes&#x2F;server&#x2F;bin&#x2F;kubelet –kubeconfig&#x3D;&#x2F;etc&#x2F;kubernetes&#x2F;kubeconfig –hostname-override&#x3D;127.0.0.1 –logtostderr&#x3D;false –log-dir&#x3D;&#x2F;var&#x2F;log&#x2F;kubernetes –v&#x3D;2 –cgroup-driver&#x3D;systemd</p>\n</blockquote>\n<h4 id=\"kube-proxy\"><a href=\"#kube-proxy\" class=\"headerlink\" title=\"kube-proxy\"></a>kube-proxy</h4><h5 id=\"kube-proxy-service\"><a href=\"#kube-proxy-service\" class=\"headerlink\" title=\"kube-proxy.service\"></a>kube-proxy.service</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Kubernetes Kube-Proxt Server</span><br><span class=\"line\">Documentation=https://github.com/kubernetes</span><br><span class=\"line\">After=network.target</span><br><span class=\"line\">Requires=network.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">EnvironmentFile=-/etc/kubernetes/proxy</span><br><span class=\"line\">ExecStart=/opt/kubernetes/server/bin/kube-proxy $KUBE_PROXY_ARGS</span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\">LimitNOFILE=65536</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n<p>配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo touch /etc/kubernetes/proxy &amp;&amp; sudo  chmod 757 /etc/kubernetes/proxy</span><br><span class=\"line\">cat&gt;/etc/kubernetes/proxy&lt;&lt;EOF</span><br><span class=\"line\">KUBE_PROXY_ARGS=&quot;--master=http://localhost:8080  --logtostderr=false --log-dir=/var/log/kubernetes --v=2&quot;</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"启动-4\"><a href=\"#启动-4\" class=\"headerlink\" title=\"启动\"></a>启动</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">temp=&quot;kube-proxy.service&quot;</span><br><span class=\"line\">sudo cp $temp /lib/systemd/system</span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl enable $temp</span><br><span class=\"line\">sudo systemctl start $temp</span><br><span class=\"line\">sudo systemctl status $temp</span><br><span class=\"line\">./kubectl get cs</span><br><span class=\"line\">./kubectl get node</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<h3 id=\"Master服务\"><a href=\"#Master服务\" class=\"headerlink\" title=\"Master服务\"></a>Master服务</h3><h4 id=\"安装kubernetes\"><a href=\"#安装kubernetes\" class=\"headerlink\" title=\"安装kubernetes\"></a>安装kubernetes</h4><p><a href=\"https://kubernetes.io/docs/setup/release/notes/\">官网下载kubernetes</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -xvf kubernetes.tar.gz  -C /opt/</span><br></pre></td></tr></table></figure>\n\n<p>下载 Client Binaries，Server Binaries</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uname -s -m  #获取版本官网下载或执行下面命令下载</span><br><span class=\"line\">bash /opt/kubernetes/cluster/get-kube-binaries.sh</span><br></pre></td></tr></table></figure>","more":"<blockquote>\n<p>Kubernetes release: v1.11.0</p>\n<p>Server: linux&#x2F;amd64 (to override, set KUBERNETES_SERVER_ARCH)</p>\n<p>Client: linux&#x2F;amd64 (autodetected)</p>\n<p>Will download <strong>kubernetes-server-linux-amd64.tar.gz</strong> from <a href=\"https://dl.k8s.io/v1.11.0\">https://dl.k8s.io/v1.11.0</a></p>\n<p>Will download and extract <strong>kubernetes-client-linux-amd64.tar.gz</strong> from <a href=\"https://dl.k8s.io/v1.11.0\">https://dl.k8s.io/v1.11.0</a></p>\n<p>Is this ok? [Y]&#x2F;n</p>\n</blockquote>\n<p>kubernetes-server</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -tf   kubernetes-server-linux-amd64.tar.gz  #查看文件</span><br><span class=\"line\">tar -xvf   kubernetes-server-linux-amd64.tar.gz  -C /opt/kubernetes/   --strip-components 1</span><br></pre></td></tr></table></figure>\n\n\n\n<p>kubernetes-client</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -tf   kubernetes-client-linux-amd64.tar.gz</span><br><span class=\"line\">tar -xvf   kubernetes-client-linux-amd64.tar.gz  -C /opt/kubernetes/   --strip-components 1</span><br></pre></td></tr></table></figure>\n\n\n\n<p>执行文件(配置文件可以直接路径)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ln -s /opt/kubernetes/server/bin/kube-apiserver  /usr/bin/</span><br><span class=\"line\">sudo ln -s /opt/kubernetes/server/bin/kube-controller-manager  /usr/bin/</span><br><span class=\"line\">sudo ln -s /opt/kubernetes/server/bin/kube-scheduler  /usr/bin/</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"准备依赖服务-etcd\"><a href=\"#准备依赖服务-etcd\" class=\"headerlink\" title=\"准备依赖服务 etcd\"></a>准备依赖服务 etcd</h4><p><a href=\"https://github.com/etcd-io/etcd/releases\">etcd releases下载</a> 如果s3.amazonaws.com下不动。。。</p>\n<p>被墙了 被墙了 被墙了</p>\n<p>go 编译</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#mkdir -p $GOPATH/src/go.etcd.io/ </span><br><span class=\"line\">#cd $GOPATH/src/go.etcd.io/</span><br><span class=\"line\">#git https://github.com/etcd-io/etcd.git</span><br><span class=\"line\">cs@debian:~/gopath/etcd$ ./bulid</span><br></pre></td></tr></table></figure>\n\n\n\n<blockquote>\n<p>can’t load package: package go.etcd.io&#x2F;etcd: cannot find package “go.etcd.io&#x2F;etcd” in any of:</p>\n<p>&#x2F;opt&#x2F;go&#x2F;src&#x2F;go.etcd.io&#x2F;etcd (from $GOROOT)</p>\n<p>&#x2F;home&#x2F;cs&#x2F;gopath&#x2F;src&#x2F;go.etcd.io&#x2F;etcd (from $GOPATH)</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$GOPATH/bin/etcd   #运行</span><br><span class=\"line\">$ ETCDCTL_API=3 ./bin/etcdctl put foo bar</span><br><span class=\"line\">OK</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"创建用户\"><a href=\"#创建用户\" class=\"headerlink\" title=\"创建用户\"></a>创建用户</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo groupadd  -g 995 etcd</span><br><span class=\"line\">sudo useradd -s /sbin/nologin -M -c &quot;etcd user&quot; -u 995 etcd -g  etcd</span><br><span class=\"line\">sduo mkdir -p /etc/etcd </span><br><span class=\"line\">sudo mkdir -p /var/lib/etcd </span><br><span class=\"line\">sudo chown -R etcd.etcd /var/lib/etcd</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"etcd-service\"><a href=\"#etcd-service\" class=\"headerlink\" title=\"etcd.service\"></a>etcd.service</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit] </span><br><span class=\"line\">Description=Etcd Server </span><br><span class=\"line\">After=network.target </span><br><span class=\"line\">After=network-online.target </span><br><span class=\"line\">Wants=network-online.target </span><br><span class=\"line\"> </span><br><span class=\"line\">[Service] </span><br><span class=\"line\">Type=notify </span><br><span class=\"line\">WorkingDirectory=/var/lib/etcd/ </span><br><span class=\"line\">EnvironmentFile=-/etc/etcd/etcd.conf </span><br><span class=\"line\">User=etcd </span><br><span class=\"line\"># set GOMAXPROCS to number of processors </span><br><span class=\"line\">ExecStart=/bin/bash -c &quot;GOMAXPROCS=$(nproc) /usr/bin/etcd --name=\\&quot;$&#123;ETCD_NAME&#125;\\&quot; --data-dir=\\&quot;$&#123;ETCD_DATA_DIR&#125;\\&quot; --listen-client-urls=\\&quot;$&#123;ETCD_LISTEN_CLIENT_URLS&#125;\\&quot;&quot; </span><br><span class=\"line\">Restart=on-failure </span><br><span class=\"line\">LimitNOFILE=65536 </span><br><span class=\"line\"> </span><br><span class=\"line\">[Install] </span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>sudo systemctl start etcd.service</p>\n<p>该命令启动不了 &#x2F;bin&#x2F;bash -c “GOMAXPROCS&#x3D;$(nproc) &#x2F;usr&#x2F;bin&#x2F;etcd –name&#x3D;\\”${ETCD_NAME}\\” –data-dir&#x3D;\\”${ETCD_DATA_DIR}\\” –listen-client-urls&#x3D;\\”${ETCD_LISTEN_CLIENT_URLS}\\””</p>\n<p>sudo systemctl status etcd.service</p>\n<p>**bash[9841]: run the stateless etcd v3 gRPC L7 reverse proxy</p>\n<p>debian systemd[1]: etcd.service: main process exited, code&#x3D;exited, status&#x3D;2&#x2F;INVALIDARGUMENT</p>\n<p>debian systemd[1]: Failed to start Etcd Server.<br>**</p>\n</blockquote>\n<p>设置etcd<br>ExecStart&#x3D;&#x2F;opt&#x2F;etcd-v3.3.9&#x2F;etcd</p>\n<h5 id=\"启动etcd服务\"><a href=\"#启动etcd服务\" class=\"headerlink\" title=\"启动etcd服务\"></a>启动etcd服务</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">temp=&quot;etcd.service&quot;</span><br><span class=\"line\">sudo cp $temp /lib/systemd/system</span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl enable $temp</span><br><span class=\"line\">sudo systemctl start $temp</span><br><span class=\"line\">sudo systemctl status $temp</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>● etcd.service - Etcd Server</p>\n<p>Loaded: loaded (&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;etcd.service; enabled)</p>\n<p>Active: active (running) since 六 2018-09-08 14:53:26 CST; 5min ago<br>Main PID: 804 (etcd)</p>\n<p>CGroup: &#x2F;system.slice&#x2F;etcd.service</p>\n<p>└─804 &#x2F;opt&#x2F;etcd-v3.3.9&#x2F;etcd</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./etcdctl cluster-health</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>member 8e9e05c52164694d is healthy: got healthy result from <a href=\"http://localhost:2379/\">http://localhost:2379</a></p>\n<p>cluster is healthy</p>\n</blockquote>\n<h4 id=\"kube-apiserver\"><a href=\"#kube-apiserver\" class=\"headerlink\" title=\"kube-apiserver\"></a>kube-apiserver</h4><h5 id=\"创建用户-1\"><a href=\"#创建用户-1\" class=\"headerlink\" title=\"创建用户\"></a>创建用户</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo groupadd -g 996 kube</span><br><span class=\"line\">sudo useradd -s /sbin/nologin -M -c &quot;kube user&quot; -u 996 kube -g kube</span><br><span class=\"line\">sudo mkdir -p /etc/kubernetes</span><br><span class=\"line\">sudo mkdir -p /usr/libexec/kubernetes</span><br><span class=\"line\">sudo chown -R kube.kube /usr/libexec/kubernetes</span><br><span class=\"line\">sudo chown -R kube.kube /var/run/kubernetes</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"kube-apiserver-service\"><a href=\"#kube-apiserver-service\" class=\"headerlink\" title=\"kube-apiserver.service\"></a>kube-apiserver.service</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Kubernetes API Server</span><br><span class=\"line\">Documentation=https://github.com/kubernetes</span><br><span class=\"line\">#Dependent service</span><br><span class=\"line\">After=etcd.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">EnvironmentFile=-/etc/kubernetes/apiserver</span><br><span class=\"line\">ExecStart=/opt/kubernetes/server/bin/kube-apiserver $KUBE_API_ARGS</span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\">Type=notify</span><br><span class=\"line\">LimitNOFILE=65536</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>1.error creating self-signed certificates: mkdir &#x2F;var&#x2F;run&#x2F;kubernetes: permission denied</p>\n<p>2.error: –<a href=\"https://chengshea.github.io/linux/debian/docker/install-kubernetes/#etcd\">etcd</a>-servers must be specified</p>\n</blockquote>\n<p>配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo cat&gt;/etc/kubernetes/apiserver&lt;&lt;EOF</span><br><span class=\"line\">KUBE_API_ARGS=&quot;--etcd-servers=http://localhost:2379 --insecure-bind-address=0.0.0.0 --insecure-port=8080 --service-cluster-ip-range=169.169.0.0/16 --service-node-port-range=1-65535 --admission-control=NamespaceLifecycle,LimitRanger,SecurityContextDeny,ResourceQuota --logtostderr=false --log-dir=/var/log/kubernetes --v=2&quot;</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n\n\n<blockquote>\n<p>–etcd-servers：就是etcd的地址。</p>\n<p>–insecure-bind-address：apiserver绑定主机的非安全IP地址，设置0.0.0.0表示绑定所有IP地址。</p>\n<p>–insecure-port：apiserver绑定主机的非安全端口，默认为8080。</p>\n<p>–service-cluster-ip-range：Kubernetes集群中Service的虚拟IP地址段范围，以CIDR格式表示，该IP范围不能与物理机真实IP段有重合。</p>\n<p>-service-node-port-range：Kubernetes集群中Service可映射的物理机端口范围，默认为30000~32767.</p>\n<p>–admission-control： Kubernetes集群的准入控制设置，各控制模块以插件形式依次生效。</p>\n<p>–logtostderr：设置为false表示将日志写入文件，不写入stderr。</p>\n<p>–log-dir： 日志目录。</p>\n<p>–v：日志级别。</p>\n<p><a href=\"https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/\">更多参数查看官方文档</a></p>\n</blockquote>\n<h5 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">temp=&quot;kube-apiserver.service&quot;</span><br><span class=\"line\">sudo cp $temp /lib/systemd/system</span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl enable $temp</span><br><span class=\"line\">sudo systemctl start $temp</span><br><span class=\"line\">sudo systemctl status $temp</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>● kube-apiserver.service - Kubernetes API Server</p>\n<p>Loaded: loaded (&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;kube-apiserver.service; disabled)</p>\n<p>Active: active (running) since 六 2018-09-08 15:42:02 CST; 2s ago<br>Docs: <a href=\"https://github.com/GoogleCloudPlatform/kubernetes\">https://github.com/GoogleCloudPlatform/kubernetes</a></p>\n<p>Main PID: 3560 (kube-apiserver)</p>\n<p>CGroup: &#x2F;system.slice&#x2F;kube-apiserver.service</p>\n<p>└─3560 &#x2F;opt&#x2F;kubernetes&#x2F;server&#x2F;bin&#x2F;kube-apiserver –etcd-servers&#x3D;<a href=\"http://localhost:2379/\">http://localhost:2379</a> …….</p>\n</blockquote>\n<h4 id=\"kube-controller-manager\"><a href=\"#kube-controller-manager\" class=\"headerlink\" title=\"kube-controller-manager\"></a>kube-controller-manager</h4><h5 id=\"kube-controller-manager-service\"><a href=\"#kube-controller-manager-service\" class=\"headerlink\" title=\"kube-controller-manager.service\"></a>kube-controller-manager.service</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Kubernetes Scheduler Plugin</span><br><span class=\"line\">Documentation=https://github.com/GoogleCloudPlatform/kubernetes</span><br><span class=\"line\">After=kube-apiserver.service</span><br><span class=\"line\">Requires=kube-apiserver.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">EnvironmentFile=-/etc/kubernetes/controller-manager</span><br><span class=\"line\">User=kube</span><br><span class=\"line\">ExecStart=/opt/kubernetes/server/bin/kube-controller-manager $KUBE_CONTROLLER_MANAGER_ARGS</span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\">LimitNOFILE=65536</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n<p>配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo touch /etc/kubernetes/controller-manager &amp;&amp; sudo  chmod 757 /etc/kubernetes/controller-manager</span><br><span class=\"line\">cat&gt;/etc/kubernetes/controller-manager&lt;&lt;EOF</span><br><span class=\"line\">KUBE_CONTROLLER_MANAGER_ARGS=&quot;--master=http://192.168.56.101:8080 --logtostderr=false --log-dir=/var/log/kubernetes --v=2&quot; </span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"启动-1\"><a href=\"#启动-1\" class=\"headerlink\" title=\"启动\"></a>启动</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">temp=&quot;kube-controller-manager.service&quot;</span><br><span class=\"line\">sudo cp $temp /lib/systemd/system</span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl enable $temp</span><br><span class=\"line\">sudo systemctl start $temp</span><br><span class=\"line\">sudo systemctl status $temp</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>● kube-controller-manager.service - Kubernetes Scheduler Plugin</p>\n<p>Loaded: loaded (&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;kube-controller-manager.service; disabled)</p>\n<p>Active: active (running) since 六 2018-09-08 16:54:32 CST; 2s ago</p>\n<p>Docs: <a href=\"https://github.com/GoogleCloudPlatform/kubernetes\">https://github.com/GoogleCloudPlatform/kubernetes</a></p>\n<p>Main PID: 5980 (kube-controller)</p>\n<p>CGroup: &#x2F;system.slice&#x2F;kube-controller-manager.service</p>\n<p>└─5980 &#x2F;opt&#x2F;kubernetes&#x2F;server&#x2F;bin&#x2F;kube-controller-manager –master&#x3D;<a href=\"http://localhost:8080/\">http://localhost:8080</a> ……</p>\n</blockquote>\n<h4 id=\"kube-scheduler\"><a href=\"#kube-scheduler\" class=\"headerlink\" title=\"kube-scheduler\"></a>kube-scheduler</h4><h5 id=\"kube-scheduler-service\"><a href=\"#kube-scheduler-service\" class=\"headerlink\" title=\"kube-scheduler.service\"></a>kube-scheduler.service</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Kubernetes Scheduler Manager</span><br><span class=\"line\">Documentation=https://github.com/kubernetes</span><br><span class=\"line\">After=kube-apiserver.service</span><br><span class=\"line\">Requires=kube-apiserver.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">EnvironmentFile=/etc/kubernetes/scheduler</span><br><span class=\"line\">ExecStart=/opt/kubernetes/server/bin/kube-scheduler $KUBE_SCHEDULER_ARGS</span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\">LimitNOFILE=65536</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n<p>配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo touch /etc/kubernetes/scheduler &amp;&amp; sudo  chmod 757 /etc/kubernetes/scheduler</span><br><span class=\"line\">cat&gt;/etc/kubernetes/scheduler&lt;&lt;EOF</span><br><span class=\"line\">KUBE_SCHEDULER_ARGS=&quot;--master=http://localhost:8080 --logtostderr=false --log-dir=/var/log/kubernetes --v=2&quot;</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"启动-2\"><a href=\"#启动-2\" class=\"headerlink\" title=\"启动\"></a>启动</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">temp=&quot;kube-scheduler.service&quot;</span><br><span class=\"line\">sudo cp $temp /lib/systemd/system</span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl enable $temp</span><br><span class=\"line\">sudo systemctl start $temp</span><br><span class=\"line\">sudo systemctl status $temp</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>● kube-scheduler.service - Kubernetes Scheduler Manager</p>\n<p>Loaded: loaded (&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;kube-scheduler.service; disabled)</p>\n<p>Active: active (running) since 六 2018-09-08 17:02:09 CST; 7s ago</p>\n<p>Docs: <a href=\"https://github.com/kubernetes\">https://github.com/kubernetes</a><br>Main PID: 6340 (kube-scheduler)</p>\n<p>CGroup: &#x2F;system.slice&#x2F;kube-scheduler.service</p>\n<p>└─6340 &#x2F;opt&#x2F;kubernetes&#x2F;server&#x2F;bin&#x2F;kube-scheduler –master&#x3D;<a href=\"http://localhost:8080/\">http://localhost:8080</a> ……</p>\n</blockquote>\n<h3 id=\"Node节点服务\"><a href=\"#Node节点服务\" class=\"headerlink\" title=\"Node节点服务\"></a>Node节点服务</h3><h4 id=\"kubelet\"><a href=\"#kubelet\" class=\"headerlink\" title=\"kubelet\"></a>kubelet</h4><h5 id=\"kubelet-service\"><a href=\"#kubelet-service\" class=\"headerlink\" title=\"kubelet.service\"></a>kubelet.service</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Kubernetes Kubelet Server</span><br><span class=\"line\">Documentation=https://github.com/kubernetes</span><br><span class=\"line\">After=docker.service</span><br><span class=\"line\">Requires=docker.service</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">WorkingDirectory=-/var/lib/kubelet</span><br><span class=\"line\">EnvironmentFile=-/etc/kubernetes/kubelet</span><br><span class=\"line\">ExecStart=/opt/kubernetes/server/bin/kubelet $KUBELET_ARGS  </span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>kubelet.service holdoff time over, scheduling restart</p>\n</blockquote>\n<p>配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir -p /var/lib/kubelet</span><br><span class=\"line\">sudo touch /etc/kubernetes/kubelet &amp;&amp; sudo  chmod 757 /etc/kubernetes/kubelet</span><br><span class=\"line\">cat&gt;/etc/kubernetes/kubelet&lt;&lt;EOF</span><br><span class=\"line\">KUBELET_ARGS=&quot;--kubeconfig=/etc/kubernetes/kubeconfig --hostname-override=127.0.0.1 --logtostderr=false --log-dir=/var/log/kubernetes --v=2&quot;</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n\n\n<blockquote>\n<p><a href=\"https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/\">–kubeconfig代替了–api-servers</a></p>\n<p>–<a href=\"https://github.com/kubernetes/kubernetes/issues/36745\">require-kubeconfig 1.7版开始默认true </a></p>\n<p>Kubernetes 1.8开始要求关闭系统的Swap</p>\n</blockquote>\n<h5 id=\"启动-3\"><a href=\"#启动-3\" class=\"headerlink\" title=\"启动\"></a>启动</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">temp=&quot;kubelet.service&quot;</span><br><span class=\"line\">sudo cp $temp /lib/systemd/system</span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl enable $temp</span><br><span class=\"line\">sudo systemctl start $temp</span><br><span class=\"line\">sudo systemctl status $temp</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>● kubelet.service - Kubernetes Kubelet Server</p>\n<p>Loaded: loaded (&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;kubelet.service; disabled)</p>\n<p>Active: active (running) since 二 2018-09-11 18:34:48 CST; 29ms ago</p>\n<p>Docs: <a href=\"https://github.com/kubernetes\">https://github.com/kubernetes</a><br>Main PID: 9018 (kubelet)</p>\n<p>CGroup: &#x2F;system.slice&#x2F;kubelet.service</p>\n<p>└─9018 &#x2F;opt&#x2F;kubernetes&#x2F;server&#x2F;bin&#x2F;kubelet –kubeconfig&#x3D;&#x2F;etc&#x2F;kubernetes&#x2F;kubeconfig –hostname-override&#x3D;127.0.0.1 –logtostderr&#x3D;false –log-dir&#x3D;&#x2F;var&#x2F;log&#x2F;kubernetes –v&#x3D;2 –cgroup-driver&#x3D;systemd</p>\n</blockquote>\n<h4 id=\"kube-proxy\"><a href=\"#kube-proxy\" class=\"headerlink\" title=\"kube-proxy\"></a>kube-proxy</h4><h5 id=\"kube-proxy-service\"><a href=\"#kube-proxy-service\" class=\"headerlink\" title=\"kube-proxy.service\"></a>kube-proxy.service</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Kubernetes Kube-Proxt Server</span><br><span class=\"line\">Documentation=https://github.com/kubernetes</span><br><span class=\"line\">After=network.target</span><br><span class=\"line\">Requires=network.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">EnvironmentFile=-/etc/kubernetes/proxy</span><br><span class=\"line\">ExecStart=/opt/kubernetes/server/bin/kube-proxy $KUBE_PROXY_ARGS</span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\">LimitNOFILE=65536</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n<p>配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo touch /etc/kubernetes/proxy &amp;&amp; sudo  chmod 757 /etc/kubernetes/proxy</span><br><span class=\"line\">cat&gt;/etc/kubernetes/proxy&lt;&lt;EOF</span><br><span class=\"line\">KUBE_PROXY_ARGS=&quot;--master=http://localhost:8080  --logtostderr=false --log-dir=/var/log/kubernetes --v=2&quot;</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"启动-4\"><a href=\"#启动-4\" class=\"headerlink\" title=\"启动\"></a>启动</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">temp=&quot;kube-proxy.service&quot;</span><br><span class=\"line\">sudo cp $temp /lib/systemd/system</span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl enable $temp</span><br><span class=\"line\">sudo systemctl start $temp</span><br><span class=\"line\">sudo systemctl status $temp</span><br><span class=\"line\">./kubectl get cs</span><br><span class=\"line\">./kubectl get node</span><br></pre></td></tr></table></figure>"},{"title":"decompress解压/压缩","date":"2022-08-18T12:59:41.000Z","_content":"\n\n\n## tar\n\n### 解压\n\n```\ntar -zxvf  helm-v3.9.3-linux-amd64.tar.gz\n```\n\n>-z    tar.gz  tgz\n>\n>-j    tar.bz2   tbz\n>\n>-C  接指定目录\n\n\n\n### 压缩\n\n\n\n```\ntar zcvf /dir/file.tar.gz   /dir/file\n```\n\n> -z  gzip压缩\n>\n> -j  bzip2压缩\n>\n> -zp  gzip压缩，并且保留权限信息(-p的属性是很重要的，尤其是当您要保留原本文件的属性时)\n>\n> --strip-components 1  去掉最外层目录\n","source":"_posts/linux/shell/decompress.md","raw":"---\ntitle: decompress解压/压缩\npermalink: linux/shell/decompress/\ntags:\n  - tar\n  - unzip\n  - xz\ncategories:\n  - linux\n  - shell\ndate: 2022-08-18 20:59:41\n---\n\n\n\n## tar\n\n### 解压\n\n```\ntar -zxvf  helm-v3.9.3-linux-amd64.tar.gz\n```\n\n>-z    tar.gz  tgz\n>\n>-j    tar.bz2   tbz\n>\n>-C  接指定目录\n\n\n\n### 压缩\n\n\n\n```\ntar zcvf /dir/file.tar.gz   /dir/file\n```\n\n> -z  gzip压缩\n>\n> -j  bzip2压缩\n>\n> -zp  gzip压缩，并且保留权限信息(-p的属性是很重要的，尤其是当您要保留原本文件的属性时)\n>\n> --strip-components 1  去掉最外层目录\n","slug":"linux/shell/decompress","published":1,"updated":"2022-08-28T09:10:00.944Z","__permalink":"linux/shell/decompress/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtth002pgwi52wxb9yyc","content":"<h2 id=\"tar\"><a href=\"#tar\" class=\"headerlink\" title=\"tar\"></a>tar</h2><h3 id=\"解压\"><a href=\"#解压\" class=\"headerlink\" title=\"解压\"></a>解压</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zxvf  helm-v3.9.3-linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>-z    tar.gz  tgz</p>\n<p>-j    tar.bz2   tbz</p>\n<p>-C  接指定目录</p>\n</blockquote>\n<h3 id=\"压缩\"><a href=\"#压缩\" class=\"headerlink\" title=\"压缩\"></a>压缩</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar zcvf /dir/file.tar.gz   /dir/file</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>-z  gzip压缩</p>\n<p>-j  bzip2压缩</p>\n<p>-zp  gzip压缩，并且保留权限信息(-p的属性是很重要的，尤其是当您要保留原本文件的属性时)</p>\n<p>–strip-components 1  去掉最外层目录</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"tar\"><a href=\"#tar\" class=\"headerlink\" title=\"tar\"></a>tar</h2><h3 id=\"解压\"><a href=\"#解压\" class=\"headerlink\" title=\"解压\"></a>解压</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zxvf  helm-v3.9.3-linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>-z    tar.gz  tgz</p>\n<p>-j    tar.bz2   tbz</p>\n<p>-C  接指定目录</p>\n</blockquote>\n<h3 id=\"压缩\"><a href=\"#压缩\" class=\"headerlink\" title=\"压缩\"></a>压缩</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar zcvf /dir/file.tar.gz   /dir/file</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>-z  gzip压缩</p>\n<p>-j  bzip2压缩</p>\n<p>-zp  gzip压缩，并且保留权限信息(-p的属性是很重要的，尤其是当您要保留原本文件的属性时)</p>\n<p>–strip-components 1  去掉最外层目录</p>\n</blockquote>\n"},{"title":"download工具命令","date":"2022-08-18T12:29:34.000Z","_content":"\n\n\n## wget\n\n### 常规使用\n\n```\nwget [options] [url]\n```\n\n#### 指定文件\n\n```\nwget  -P /opt/docker  https://get.helm.sh/helm-v3.9.3-linux-amd64.tar.gz\n```\n\n>-c 断点续传\n>\n>-O 下载并以不同的文件名保存\n>\n> -b 后台下载\n>\n>–spider 测试下载链接\n>\n>--limit-rate=1m  速度限制为1m/s\n\n\n\n### 批量下载\n\n#### 有规律\n\n```\nwget http://www.xxxx.com/file_{1..4}.txt\n```\n\n> 比如：file_1.txt，file_2.txt，file_3.txt\n\n\n\n#### 没有规律\n\n```\ncat >downloads.txt<<EOF\nhttp://www.xxxx.com/xxx\nhttp://www.xxxx.com/xxx\nEOF\nwget -i downloads.txt\n```\n\n\n\n### 下载整个目录\n\n\n\n```\nwget -r -np -nH -R index.html http://url/files/download/\n```\n\n>-r : 遍历所有子目录\n>-np : 不到上一层子目录去\n>-nH : 不要将文件保存到主机名文件夹\n>-R index.html : 不下载 index.html 文件\n>\n>-k 将网页内绝对链接转为相对链接\n\n\n\n### 模拟\n\n模拟 Edge 浏览器发出来的请求\n\n```\nwget --debug --header=\"User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36 Edg/91.0.864.59\" http://www.baidu.com\n```\n\n模拟手机\n\n```\nwget --debug --header=\"User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 13_5_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1.1 Mobile/15E148 Safari /604.1\" http://www.baidu.com\n```\n\n\n\n\n\n## curl\n\n\n\n```\ncurl   -ikv   http://www.baidu.com\n```\n\n","source":"_posts/linux/shell/download.md","raw":"---\ntitle: download工具命令\npermalink: linux/k8s/download/\ntags:\n  - download\n  - wget\n  - curl\ncategories:\n  - linux\n  - shell\ndate: 2022-08-18 20:29:34\n---\n\n\n\n## wget\n\n### 常规使用\n\n```\nwget [options] [url]\n```\n\n#### 指定文件\n\n```\nwget  -P /opt/docker  https://get.helm.sh/helm-v3.9.3-linux-amd64.tar.gz\n```\n\n>-c 断点续传\n>\n>-O 下载并以不同的文件名保存\n>\n> -b 后台下载\n>\n>–spider 测试下载链接\n>\n>--limit-rate=1m  速度限制为1m/s\n\n\n\n### 批量下载\n\n#### 有规律\n\n```\nwget http://www.xxxx.com/file_{1..4}.txt\n```\n\n> 比如：file_1.txt，file_2.txt，file_3.txt\n\n\n\n#### 没有规律\n\n```\ncat >downloads.txt<<EOF\nhttp://www.xxxx.com/xxx\nhttp://www.xxxx.com/xxx\nEOF\nwget -i downloads.txt\n```\n\n\n\n### 下载整个目录\n\n\n\n```\nwget -r -np -nH -R index.html http://url/files/download/\n```\n\n>-r : 遍历所有子目录\n>-np : 不到上一层子目录去\n>-nH : 不要将文件保存到主机名文件夹\n>-R index.html : 不下载 index.html 文件\n>\n>-k 将网页内绝对链接转为相对链接\n\n\n\n### 模拟\n\n模拟 Edge 浏览器发出来的请求\n\n```\nwget --debug --header=\"User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36 Edg/91.0.864.59\" http://www.baidu.com\n```\n\n模拟手机\n\n```\nwget --debug --header=\"User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 13_5_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1.1 Mobile/15E148 Safari /604.1\" http://www.baidu.com\n```\n\n\n\n\n\n## curl\n\n\n\n```\ncurl   -ikv   http://www.baidu.com\n```\n\n","slug":"linux/shell/download","published":1,"updated":"2022-08-28T09:10:00.948Z","__permalink":"linux/k8s/download/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtth002rgwi52cnkaud6","content":"<h2 id=\"wget\"><a href=\"#wget\" class=\"headerlink\" title=\"wget\"></a>wget</h2><h3 id=\"常规使用\"><a href=\"#常规使用\" class=\"headerlink\" title=\"常规使用\"></a>常规使用</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget [options] [url]</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"指定文件\"><a href=\"#指定文件\" class=\"headerlink\" title=\"指定文件\"></a>指定文件</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget  -P /opt/docker  https://get.helm.sh/helm-v3.9.3-linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>-c 断点续传</p>\n<p>-O 下载并以不同的文件名保存</p>\n<p>-b 后台下载</p>\n<p>–spider 测试下载链接</p>\n<p>–limit-rate&#x3D;1m  速度限制为1m&#x2F;s</p>\n</blockquote>\n<h3 id=\"批量下载\"><a href=\"#批量下载\" class=\"headerlink\" title=\"批量下载\"></a>批量下载</h3><h4 id=\"有规律\"><a href=\"#有规律\" class=\"headerlink\" title=\"有规律\"></a>有规律</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget http://www.xxxx.com/file_&#123;1..4&#125;.txt</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>比如：file_1.txt，file_2.txt，file_3.txt</p>\n</blockquote>\n<h4 id=\"没有规律\"><a href=\"#没有规律\" class=\"headerlink\" title=\"没有规律\"></a>没有规律</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt;downloads.txt&lt;&lt;EOF</span><br><span class=\"line\">http://www.xxxx.com/xxx</span><br><span class=\"line\">http://www.xxxx.com/xxx</span><br><span class=\"line\">EOF</span><br><span class=\"line\">wget -i downloads.txt</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"下载整个目录\"><a href=\"#下载整个目录\" class=\"headerlink\" title=\"下载整个目录\"></a>下载整个目录</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget -r -np -nH -R index.html http://url/files/download/</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>-r : 遍历所有子目录<br>-np : 不到上一层子目录去<br>-nH : 不要将文件保存到主机名文件夹<br>-R index.html : 不下载 index.html 文件</p>\n<p>-k 将网页内绝对链接转为相对链接</p>\n</blockquote>\n<h3 id=\"模拟\"><a href=\"#模拟\" class=\"headerlink\" title=\"模拟\"></a>模拟</h3><p>模拟 Edge 浏览器发出来的请求</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget --debug --header=&quot;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36 Edg/91.0.864.59&quot; http://www.baidu.com</span><br></pre></td></tr></table></figure>\n\n<p>模拟手机</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget --debug --header=&quot;User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 13_5_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1.1 Mobile/15E148 Safari /604.1&quot; http://www.baidu.com</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"curl\"><a href=\"#curl\" class=\"headerlink\" title=\"curl\"></a>curl</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl   -ikv   http://www.baidu.com</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"wget\"><a href=\"#wget\" class=\"headerlink\" title=\"wget\"></a>wget</h2><h3 id=\"常规使用\"><a href=\"#常规使用\" class=\"headerlink\" title=\"常规使用\"></a>常规使用</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget [options] [url]</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"指定文件\"><a href=\"#指定文件\" class=\"headerlink\" title=\"指定文件\"></a>指定文件</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget  -P /opt/docker  https://get.helm.sh/helm-v3.9.3-linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>-c 断点续传</p>\n<p>-O 下载并以不同的文件名保存</p>\n<p>-b 后台下载</p>\n<p>–spider 测试下载链接</p>\n<p>–limit-rate&#x3D;1m  速度限制为1m&#x2F;s</p>\n</blockquote>\n<h3 id=\"批量下载\"><a href=\"#批量下载\" class=\"headerlink\" title=\"批量下载\"></a>批量下载</h3><h4 id=\"有规律\"><a href=\"#有规律\" class=\"headerlink\" title=\"有规律\"></a>有规律</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget http://www.xxxx.com/file_&#123;1..4&#125;.txt</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>比如：file_1.txt，file_2.txt，file_3.txt</p>\n</blockquote>\n<h4 id=\"没有规律\"><a href=\"#没有规律\" class=\"headerlink\" title=\"没有规律\"></a>没有规律</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt;downloads.txt&lt;&lt;EOF</span><br><span class=\"line\">http://www.xxxx.com/xxx</span><br><span class=\"line\">http://www.xxxx.com/xxx</span><br><span class=\"line\">EOF</span><br><span class=\"line\">wget -i downloads.txt</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"下载整个目录\"><a href=\"#下载整个目录\" class=\"headerlink\" title=\"下载整个目录\"></a>下载整个目录</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget -r -np -nH -R index.html http://url/files/download/</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>-r : 遍历所有子目录<br>-np : 不到上一层子目录去<br>-nH : 不要将文件保存到主机名文件夹<br>-R index.html : 不下载 index.html 文件</p>\n<p>-k 将网页内绝对链接转为相对链接</p>\n</blockquote>\n<h3 id=\"模拟\"><a href=\"#模拟\" class=\"headerlink\" title=\"模拟\"></a>模拟</h3><p>模拟 Edge 浏览器发出来的请求</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget --debug --header=&quot;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36 Edg/91.0.864.59&quot; http://www.baidu.com</span><br></pre></td></tr></table></figure>\n\n<p>模拟手机</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget --debug --header=&quot;User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 13_5_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1.1 Mobile/15E148 Safari /604.1&quot; http://www.baidu.com</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"curl\"><a href=\"#curl\" class=\"headerlink\" title=\"curl\"></a>curl</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl   -ikv   http://www.baidu.com</span><br></pre></td></tr></table></figure>\n\n"},{"title":"find查找搜索","date":"2022-06-12T13:55:12.000Z","_content":"\n\n\n查找\n\n> find [OPTIONS] [查找起始路径] [查找条件] [处理动作]\n\n[OPTIONS]  忽略\n\n\n\n### 路径\n\n  相对    `./`\n\n  绝对   `/`\n\n### 条件\n\n#### 名称\n\n**name**    `find  /  -name   mysql`\n\n**iname**   `find  /  -iname  cmake`   *忽略大小写*\n\n**regex**  `find / -regex  /docker*`  正则模糊查询\n\n#### size 大小\n\n<!--more-->\n\n**size**   `find  / -size  +20M` \n\n *+* 大于    *-*小于    *K*  *M*  *G*\n\n`   20M`       (20-1,20]\n\n`-  20M`    [0,20-1]\n\n`+ 20M`    (20,+∞]\n\n#### 时间\n\n**atime**  文件最后访问  \n\n*  [#, #-1) ：最后访问时间在#天前（大于等于#天前，小于#-1天前）\n\n  等价于最后访问时间与当前的时间差 大于 (#-1)*24小时，小于等于 #*24小时\n\n\n*  (#, 0] ：最后访问时间在#天以内，不包括24小时前的那一刻。\n\n等价于最后访问时间与当前的时间差小于 #*24小时\n\n*  (oo, #-1] ：最后访问时间在#-1天以前的。包括#-1天前\n\n等价于最后访问时间与当前的时间差大于等于 #*24小时\n\n```\n#查找最近10天内被访问过的所有文件\n[root@centos7 ~]# find . -type f -atime -10\n \n#查找超过10天内被访问过的所有文件\n[root@centos7 ~]# find . -type f -atime +10\n \n#查找访问时间超过20分钟的所有文件\n[root@centos7 ~]# find . -type f -amin +20\n \n#找出比mingongge修改时间更长的所有文件\n[root@centos7 ~]# find . -type f -newer mingongge\n```\n\n**mtime**  文件最后修改\n\n**ctime**  文件最后改变\n\n\n\n```\n\nsudo find /boot/burg/themes/  -name '[^Metro]*' | xargs rm -rf\n\n```\n\n#### -path  排除路径\n\n\n\n#### -type  类型\n\n   d 目录  f文件 \n\n\n\n\n\n#### -prune 忽略\n\n配备到path路径，则跳过该目录\n\n```\n\nsudo find  /  -path \"/home/cs/lua-5.3.4\"  -prune -o -type f    -name  lua*\n\n```\n\n\n\n​    \n\n#### -o  or \n\n```shell\ncs@debian:~/oss/test$ find ./ -path ./cs -prune -o -type f -name *.js -print\n./cs1/c.js\n./cs2/s.js\ncs@debian:~/oss/test$ find ./ \\( -path ./cs -o -path ./cs1 \\) -prune -o -type f -name *.js -print\n./cs2/s.js\n```\n\n> 多个目录, 括号前后空格,\\转义\n\n\n\n#### -a and\n\n```\nfind   ./cs2  ./cs1   -type f  -name *js -a  -name c.*  -print\n./cs2/c.ejs\n./cs1/c.ejs\n./cs1/c.js\n```\n\n","source":"_posts/linux/shell/find.md","raw":"---\ntitle: find查找搜索\npermalink: linux/shell/find/\ntags:\n  - find\ncategories:\n  - linux\n  - shell\ndate: 2022-06-12 21:55:12\n---\n\n\n\n查找\n\n> find [OPTIONS] [查找起始路径] [查找条件] [处理动作]\n\n[OPTIONS]  忽略\n\n\n\n### 路径\n\n  相对    `./`\n\n  绝对   `/`\n\n### 条件\n\n#### 名称\n\n**name**    `find  /  -name   mysql`\n\n**iname**   `find  /  -iname  cmake`   *忽略大小写*\n\n**regex**  `find / -regex  /docker*`  正则模糊查询\n\n#### size 大小\n\n<!--more-->\n\n**size**   `find  / -size  +20M` \n\n *+* 大于    *-*小于    *K*  *M*  *G*\n\n`   20M`       (20-1,20]\n\n`-  20M`    [0,20-1]\n\n`+ 20M`    (20,+∞]\n\n#### 时间\n\n**atime**  文件最后访问  \n\n*  [#, #-1) ：最后访问时间在#天前（大于等于#天前，小于#-1天前）\n\n  等价于最后访问时间与当前的时间差 大于 (#-1)*24小时，小于等于 #*24小时\n\n\n*  (#, 0] ：最后访问时间在#天以内，不包括24小时前的那一刻。\n\n等价于最后访问时间与当前的时间差小于 #*24小时\n\n*  (oo, #-1] ：最后访问时间在#-1天以前的。包括#-1天前\n\n等价于最后访问时间与当前的时间差大于等于 #*24小时\n\n```\n#查找最近10天内被访问过的所有文件\n[root@centos7 ~]# find . -type f -atime -10\n \n#查找超过10天内被访问过的所有文件\n[root@centos7 ~]# find . -type f -atime +10\n \n#查找访问时间超过20分钟的所有文件\n[root@centos7 ~]# find . -type f -amin +20\n \n#找出比mingongge修改时间更长的所有文件\n[root@centos7 ~]# find . -type f -newer mingongge\n```\n\n**mtime**  文件最后修改\n\n**ctime**  文件最后改变\n\n\n\n```\n\nsudo find /boot/burg/themes/  -name '[^Metro]*' | xargs rm -rf\n\n```\n\n#### -path  排除路径\n\n\n\n#### -type  类型\n\n   d 目录  f文件 \n\n\n\n\n\n#### -prune 忽略\n\n配备到path路径，则跳过该目录\n\n```\n\nsudo find  /  -path \"/home/cs/lua-5.3.4\"  -prune -o -type f    -name  lua*\n\n```\n\n\n\n​    \n\n#### -o  or \n\n```shell\ncs@debian:~/oss/test$ find ./ -path ./cs -prune -o -type f -name *.js -print\n./cs1/c.js\n./cs2/s.js\ncs@debian:~/oss/test$ find ./ \\( -path ./cs -o -path ./cs1 \\) -prune -o -type f -name *.js -print\n./cs2/s.js\n```\n\n> 多个目录, 括号前后空格,\\转义\n\n\n\n#### -a and\n\n```\nfind   ./cs2  ./cs1   -type f  -name *js -a  -name c.*  -print\n./cs2/c.ejs\n./cs1/c.ejs\n./cs1/c.js\n```\n\n","slug":"linux/shell/find","published":1,"updated":"2022-09-03T08:32:57.932Z","__permalink":"linux/shell/find/","_id":"cl7g6gtto002tgwi5c9vv1n7t","comments":1,"layout":"post","photos":[],"link":"","content":"<p>查找</p>\n<blockquote>\n<p>find [OPTIONS] [查找起始路径] [查找条件] [处理动作]</p>\n</blockquote>\n<p>[OPTIONS]  忽略</p>\n<h3 id=\"路径\"><a href=\"#路径\" class=\"headerlink\" title=\"路径\"></a>路径</h3><p>  相对    <code>./</code></p>\n<p>  绝对   <code>/</code></p>\n<h3 id=\"条件\"><a href=\"#条件\" class=\"headerlink\" title=\"条件\"></a>条件</h3><h4 id=\"名称\"><a href=\"#名称\" class=\"headerlink\" title=\"名称\"></a>名称</h4><p><strong>name</strong>    <code>find  /  -name   mysql</code></p>\n<p><strong>iname</strong>   <code>find  /  -iname  cmake</code>   <em>忽略大小写</em></p>\n<p><strong>regex</strong>  <code>find / -regex  /docker*</code>  正则模糊查询</p>\n<h4 id=\"size-大小\"><a href=\"#size-大小\" class=\"headerlink\" title=\"size 大小\"></a>size 大小</h4><span id=\"more\"></span>\n\n<p><strong>size</strong>   <code>find  / -size  +20M</code> </p>\n<p> <em>+</em> 大于    *-*小于    <em>K</em>  <em>M</em>  <em>G</em></p>\n<p><code>   20M</code>       (20-1,20]</p>\n<p><code>-  20M</code>    [0,20-1]</p>\n<p><code>+ 20M</code>    (20,+∞]</p>\n<h4 id=\"时间\"><a href=\"#时间\" class=\"headerlink\" title=\"时间\"></a>时间</h4><p><strong>atime</strong>  文件最后访问  </p>\n<ul>\n<li>[#, #-1) ：最后访问时间在#天前（大于等于#天前，小于#-1天前）</li>\n</ul>\n<p>  等价于最后访问时间与当前的时间差 大于 (#-1)*24小时，小于等于 #*24小时</p>\n<ul>\n<li>(#, 0] ：最后访问时间在#天以内，不包括24小时前的那一刻。</li>\n</ul>\n<p>等价于最后访问时间与当前的时间差小于 #*24小时</p>\n<ul>\n<li>(oo, #-1] ：最后访问时间在#-1天以前的。包括#-1天前</li>\n</ul>\n<p>等价于最后访问时间与当前的时间差大于等于 #*24小时</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#查找最近10天内被访问过的所有文件</span><br><span class=\"line\">[root@centos7 ~]# find . -type f -atime -10</span><br><span class=\"line\"> </span><br><span class=\"line\">#查找超过10天内被访问过的所有文件</span><br><span class=\"line\">[root@centos7 ~]# find . -type f -atime +10</span><br><span class=\"line\"> </span><br><span class=\"line\">#查找访问时间超过20分钟的所有文件</span><br><span class=\"line\">[root@centos7 ~]# find . -type f -amin +20</span><br><span class=\"line\"> </span><br><span class=\"line\">#找出比mingongge修改时间更长的所有文件</span><br><span class=\"line\">[root@centos7 ~]# find . -type f -newer mingongge</span><br></pre></td></tr></table></figure>\n\n<p><strong>mtime</strong>  文件最后修改</p>\n<p><strong>ctime</strong>  文件最后改变</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">sudo find /boot/burg/themes/  -name &#x27;[^Metro]*&#x27; | xargs rm -rf</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"path-排除路径\"><a href=\"#path-排除路径\" class=\"headerlink\" title=\"-path  排除路径\"></a>-path  排除路径</h4><h4 id=\"type-类型\"><a href=\"#type-类型\" class=\"headerlink\" title=\"-type  类型\"></a>-type  类型</h4><p>   d 目录  f文件 </p>\n<h4 id=\"prune-忽略\"><a href=\"#prune-忽略\" class=\"headerlink\" title=\"-prune 忽略\"></a>-prune 忽略</h4><p>配备到path路径，则跳过该目录</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">sudo find  /  -path &quot;/home/cs/lua-5.3.4&quot;  -prune -o -type f    -name  lua*</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>​    </p>\n<h4 id=\"o-or\"><a href=\"#o-or\" class=\"headerlink\" title=\"-o  or\"></a>-o  or</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/test$ find ./ -path ./cs -prune -o -type f -name *.js -print</span><br><span class=\"line\">./cs1/c.js</span><br><span class=\"line\">./cs2/s.js</span><br><span class=\"line\">cs@debian:~/oss/test$ find ./ \\( -path ./cs -o -path ./cs1 \\) -prune -o -type f -name *.js -print</span><br><span class=\"line\">./cs2/s.js</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>多个目录, 括号前后空格,\\转义</p>\n</blockquote>\n<h4 id=\"a-and\"><a href=\"#a-and\" class=\"headerlink\" title=\"-a and\"></a>-a and</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find   ./cs2  ./cs1   -type f  -name *js -a  -name c.*  -print</span><br><span class=\"line\">./cs2/c.ejs</span><br><span class=\"line\">./cs1/c.ejs</span><br><span class=\"line\">./cs1/c.js</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>查找</p>\n<blockquote>\n<p>find [OPTIONS] [查找起始路径] [查找条件] [处理动作]</p>\n</blockquote>\n<p>[OPTIONS]  忽略</p>\n<h3 id=\"路径\"><a href=\"#路径\" class=\"headerlink\" title=\"路径\"></a>路径</h3><p>  相对    <code>./</code></p>\n<p>  绝对   <code>/</code></p>\n<h3 id=\"条件\"><a href=\"#条件\" class=\"headerlink\" title=\"条件\"></a>条件</h3><h4 id=\"名称\"><a href=\"#名称\" class=\"headerlink\" title=\"名称\"></a>名称</h4><p><strong>name</strong>    <code>find  /  -name   mysql</code></p>\n<p><strong>iname</strong>   <code>find  /  -iname  cmake</code>   <em>忽略大小写</em></p>\n<p><strong>regex</strong>  <code>find / -regex  /docker*</code>  正则模糊查询</p>\n<h4 id=\"size-大小\"><a href=\"#size-大小\" class=\"headerlink\" title=\"size 大小\"></a>size 大小</h4>","more":"<p><strong>size</strong>   <code>find  / -size  +20M</code> </p>\n<p> <em>+</em> 大于    *-*小于    <em>K</em>  <em>M</em>  <em>G</em></p>\n<p><code>   20M</code>       (20-1,20]</p>\n<p><code>-  20M</code>    [0,20-1]</p>\n<p><code>+ 20M</code>    (20,+∞]</p>\n<h4 id=\"时间\"><a href=\"#时间\" class=\"headerlink\" title=\"时间\"></a>时间</h4><p><strong>atime</strong>  文件最后访问  </p>\n<ul>\n<li>[#, #-1) ：最后访问时间在#天前（大于等于#天前，小于#-1天前）</li>\n</ul>\n<p>  等价于最后访问时间与当前的时间差 大于 (#-1)*24小时，小于等于 #*24小时</p>\n<ul>\n<li>(#, 0] ：最后访问时间在#天以内，不包括24小时前的那一刻。</li>\n</ul>\n<p>等价于最后访问时间与当前的时间差小于 #*24小时</p>\n<ul>\n<li>(oo, #-1] ：最后访问时间在#-1天以前的。包括#-1天前</li>\n</ul>\n<p>等价于最后访问时间与当前的时间差大于等于 #*24小时</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#查找最近10天内被访问过的所有文件</span><br><span class=\"line\">[root@centos7 ~]# find . -type f -atime -10</span><br><span class=\"line\"> </span><br><span class=\"line\">#查找超过10天内被访问过的所有文件</span><br><span class=\"line\">[root@centos7 ~]# find . -type f -atime +10</span><br><span class=\"line\"> </span><br><span class=\"line\">#查找访问时间超过20分钟的所有文件</span><br><span class=\"line\">[root@centos7 ~]# find . -type f -amin +20</span><br><span class=\"line\"> </span><br><span class=\"line\">#找出比mingongge修改时间更长的所有文件</span><br><span class=\"line\">[root@centos7 ~]# find . -type f -newer mingongge</span><br></pre></td></tr></table></figure>\n\n<p><strong>mtime</strong>  文件最后修改</p>\n<p><strong>ctime</strong>  文件最后改变</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">sudo find /boot/burg/themes/  -name &#x27;[^Metro]*&#x27; | xargs rm -rf</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"path-排除路径\"><a href=\"#path-排除路径\" class=\"headerlink\" title=\"-path  排除路径\"></a>-path  排除路径</h4><h4 id=\"type-类型\"><a href=\"#type-类型\" class=\"headerlink\" title=\"-type  类型\"></a>-type  类型</h4><p>   d 目录  f文件 </p>\n<h4 id=\"prune-忽略\"><a href=\"#prune-忽略\" class=\"headerlink\" title=\"-prune 忽略\"></a>-prune 忽略</h4><p>配备到path路径，则跳过该目录</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">sudo find  /  -path &quot;/home/cs/lua-5.3.4&quot;  -prune -o -type f    -name  lua*</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>​    </p>\n<h4 id=\"o-or\"><a href=\"#o-or\" class=\"headerlink\" title=\"-o  or\"></a>-o  or</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/test$ find ./ -path ./cs -prune -o -type f -name *.js -print</span><br><span class=\"line\">./cs1/c.js</span><br><span class=\"line\">./cs2/s.js</span><br><span class=\"line\">cs@debian:~/oss/test$ find ./ \\( -path ./cs -o -path ./cs1 \\) -prune -o -type f -name *.js -print</span><br><span class=\"line\">./cs2/s.js</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>多个目录, 括号前后空格,\\转义</p>\n</blockquote>\n<h4 id=\"a-and\"><a href=\"#a-and\" class=\"headerlink\" title=\"-a and\"></a>-a and</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find   ./cs2  ./cs1   -type f  -name *js -a  -name c.*  -print</span><br><span class=\"line\">./cs2/c.ejs</span><br><span class=\"line\">./cs1/c.ejs</span><br><span class=\"line\">./cs1/c.js</span><br></pre></td></tr></table></figure>"},{"title":"grep常用过滤","date":"2022-07-31T08:41:22.000Z","_content":"\n\n\n### 前后行 A B C\n\ngrep -A 显示匹配指定内容及之后的n行\n\ngrep -B 显示匹配指定内容及之前的n行\n\ngrep -C  显示匹配指定内容及其前后各n行\n\n```shell\ncs@debian:~/oss/hexo$ cat /opt/nginx/logs/k8s-access.log | grep -C 5 \"2022:15:43:27\"\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:22 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:23 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:24 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:25 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:26 +0800] 502 0\n127.0.0.1 - 192.168.56.103:6443, 192.168.56.101:6443, 192.168.56.102:6443 - [31/Jul/2022:15:43:27 +0800] 502 0, 0, 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:28 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:29 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:30 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:30 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:31 +0800] 502 0\n```\n\n\n\n### 与操作  \n\n多次匹配\n\n```shell\ncs@debian:~/oss/hexo$ cat /opt/nginx/logs/k8s-access.log | grep \"2022:15:43:2\" | grep 502\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:20 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:21 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:21 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:22 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:23 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:24 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:25 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:26 +0800] 502 0\n127.0.0.1 - 192.168.56.103:6443, 192.168.56.101:6443, 192.168.56.102:6443 - [31/Jul/2022:15:43:27 +0800] 502 0, 0, 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:28 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:29 +0800] 502 0\n```\n\n\n\n### 或操作 |\n\n<!--more-->\n\n```shell\ncs@debian:~/oss/hexo$ cat /opt/nginx/logs/k8s-access.log | grep \"502\\|15:43:3\\|kube-apiserver\"\n\n```\n\n>grep  -E  \"502|15:43:3|kube-apiserver\"\n>\n>egrep   \"502|15:43:3|kube-apiserver\"\n>\n>awk  \"502|15:43:3|kube-apiserver\"   file\n\n\n\n\n\n### 特殊字符 fgrep\n\n搜索文件包含正则表达式元字符串时,例如`$`、`^`、`/`等，`fgrep`很有用\n\n```shell\ncs@debian:~/oss/hexo$ egrep \"^Hello\"  12\ncs@debian:~/oss/hexo$ grep \"^Hello\"  12\ncs@debian:~/oss/hexo$ fgrep \"^Hello\"  12\n^Hello\\\n```\n\n它`不解析正则表达式`、想搜什么就跟什么\n\n\n\n### 压缩文件  zgrep\n\n```shell\nzgrep  pattern1  ./*   |  grep  pattern2\n```\n\n>zegrep  \n>\n>\n>zcat file1.gz file2.gz\n","source":"_posts/linux/shell/grep.md","raw":"---\ntitle: grep常用过滤\npermalink: linux/shell/grep/\ntags:\n  - grep\ncategories:\n  - linux\n  - shell\ndate: 2022-07-31 16:41:22\n---\n\n\n\n### 前后行 A B C\n\ngrep -A 显示匹配指定内容及之后的n行\n\ngrep -B 显示匹配指定内容及之前的n行\n\ngrep -C  显示匹配指定内容及其前后各n行\n\n```shell\ncs@debian:~/oss/hexo$ cat /opt/nginx/logs/k8s-access.log | grep -C 5 \"2022:15:43:27\"\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:22 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:23 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:24 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:25 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:26 +0800] 502 0\n127.0.0.1 - 192.168.56.103:6443, 192.168.56.101:6443, 192.168.56.102:6443 - [31/Jul/2022:15:43:27 +0800] 502 0, 0, 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:28 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:29 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:30 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:30 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:31 +0800] 502 0\n```\n\n\n\n### 与操作  \n\n多次匹配\n\n```shell\ncs@debian:~/oss/hexo$ cat /opt/nginx/logs/k8s-access.log | grep \"2022:15:43:2\" | grep 502\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:20 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:21 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:21 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:22 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:23 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:24 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:25 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:26 +0800] 502 0\n127.0.0.1 - 192.168.56.103:6443, 192.168.56.101:6443, 192.168.56.102:6443 - [31/Jul/2022:15:43:27 +0800] 502 0, 0, 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:28 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:29 +0800] 502 0\n```\n\n\n\n### 或操作 |\n\n<!--more-->\n\n```shell\ncs@debian:~/oss/hexo$ cat /opt/nginx/logs/k8s-access.log | grep \"502\\|15:43:3\\|kube-apiserver\"\n\n```\n\n>grep  -E  \"502|15:43:3|kube-apiserver\"\n>\n>egrep   \"502|15:43:3|kube-apiserver\"\n>\n>awk  \"502|15:43:3|kube-apiserver\"   file\n\n\n\n\n\n### 特殊字符 fgrep\n\n搜索文件包含正则表达式元字符串时,例如`$`、`^`、`/`等，`fgrep`很有用\n\n```shell\ncs@debian:~/oss/hexo$ egrep \"^Hello\"  12\ncs@debian:~/oss/hexo$ grep \"^Hello\"  12\ncs@debian:~/oss/hexo$ fgrep \"^Hello\"  12\n^Hello\\\n```\n\n它`不解析正则表达式`、想搜什么就跟什么\n\n\n\n### 压缩文件  zgrep\n\n```shell\nzgrep  pattern1  ./*   |  grep  pattern2\n```\n\n>zegrep  \n>\n>\n>zcat file1.gz file2.gz\n","slug":"linux/shell/grep","published":1,"updated":"2022-08-28T09:10:00.948Z","__permalink":"linux/shell/grep/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gttp002xgwi56kvh2ha9","content":"<h3 id=\"前后行-A-B-C\"><a href=\"#前后行-A-B-C\" class=\"headerlink\" title=\"前后行 A B C\"></a>前后行 A B C</h3><p>grep -A 显示匹配指定内容及之后的n行</p>\n<p>grep -B 显示匹配指定内容及之前的n行</p>\n<p>grep -C  显示匹配指定内容及其前后各n行</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/hexo$ cat /opt/nginx/logs/k8s-access.log | grep -C 5 &quot;2022:15:43:27&quot;</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:22 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:23 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:24 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:25 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:26 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - 192.168.56.103:6443, 192.168.56.101:6443, 192.168.56.102:6443 - [31/Jul/2022:15:43:27 +0800] 502 0, 0, 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:28 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:29 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:30 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:30 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:31 +0800] 502 0</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"与操作\"><a href=\"#与操作\" class=\"headerlink\" title=\"与操作\"></a>与操作</h3><p>多次匹配</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/hexo$ cat /opt/nginx/logs/k8s-access.log | grep &quot;2022:15:43:2&quot; | grep 502</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:20 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:21 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:21 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:22 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:23 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:24 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:25 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:26 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - 192.168.56.103:6443, 192.168.56.101:6443, 192.168.56.102:6443 - [31/Jul/2022:15:43:27 +0800] 502 0, 0, 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:28 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:29 +0800] 502 0</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"或操作\"><a href=\"#或操作\" class=\"headerlink\" title=\"或操作 |\"></a>或操作 |</h3><span id=\"more\"></span>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/hexo$ cat /opt/nginx/logs/k8s-access.log | grep &quot;502\\|15:43:3\\|kube-apiserver&quot;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>grep  -E  “502|15:43:3|kube-apiserver”</p>\n<p>egrep   “502|15:43:3|kube-apiserver”</p>\n<p>awk  “502|15:43:3|kube-apiserver”   file</p>\n</blockquote>\n<h3 id=\"特殊字符-fgrep\"><a href=\"#特殊字符-fgrep\" class=\"headerlink\" title=\"特殊字符 fgrep\"></a>特殊字符 fgrep</h3><p>搜索文件包含正则表达式元字符串时,例如<code>$</code>、<code>^</code>、<code>/</code>等，<code>fgrep</code>很有用</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/hexo$ egrep &quot;^Hello&quot;  12</span><br><span class=\"line\">cs@debian:~/oss/hexo$ grep &quot;^Hello&quot;  12</span><br><span class=\"line\">cs@debian:~/oss/hexo$ fgrep &quot;^Hello&quot;  12</span><br><span class=\"line\">^Hello\\</span><br></pre></td></tr></table></figure>\n\n<p>它<code>不解析正则表达式</code>、想搜什么就跟什么</p>\n<h3 id=\"压缩文件-zgrep\"><a href=\"#压缩文件-zgrep\" class=\"headerlink\" title=\"压缩文件  zgrep\"></a>压缩文件  zgrep</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zgrep  pattern1  ./*   |  grep  pattern2</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>zegrep  </p>\n<p>zcat file1.gz file2.gz</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<h3 id=\"前后行-A-B-C\"><a href=\"#前后行-A-B-C\" class=\"headerlink\" title=\"前后行 A B C\"></a>前后行 A B C</h3><p>grep -A 显示匹配指定内容及之后的n行</p>\n<p>grep -B 显示匹配指定内容及之前的n行</p>\n<p>grep -C  显示匹配指定内容及其前后各n行</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/hexo$ cat /opt/nginx/logs/k8s-access.log | grep -C 5 &quot;2022:15:43:27&quot;</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:22 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:23 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:24 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:25 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:26 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - 192.168.56.103:6443, 192.168.56.101:6443, 192.168.56.102:6443 - [31/Jul/2022:15:43:27 +0800] 502 0, 0, 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:28 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:29 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:30 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:30 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:31 +0800] 502 0</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"与操作\"><a href=\"#与操作\" class=\"headerlink\" title=\"与操作\"></a>与操作</h3><p>多次匹配</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/hexo$ cat /opt/nginx/logs/k8s-access.log | grep &quot;2022:15:43:2&quot; | grep 502</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:20 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:21 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:21 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:22 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:23 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:24 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:25 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:26 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - 192.168.56.103:6443, 192.168.56.101:6443, 192.168.56.102:6443 - [31/Jul/2022:15:43:27 +0800] 502 0, 0, 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:28 +0800] 502 0</span><br><span class=\"line\">127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:29 +0800] 502 0</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"或操作\"><a href=\"#或操作\" class=\"headerlink\" title=\"或操作 |\"></a>或操作 |</h3>","more":"<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/hexo$ cat /opt/nginx/logs/k8s-access.log | grep &quot;502\\|15:43:3\\|kube-apiserver&quot;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>grep  -E  “502|15:43:3|kube-apiserver”</p>\n<p>egrep   “502|15:43:3|kube-apiserver”</p>\n<p>awk  “502|15:43:3|kube-apiserver”   file</p>\n</blockquote>\n<h3 id=\"特殊字符-fgrep\"><a href=\"#特殊字符-fgrep\" class=\"headerlink\" title=\"特殊字符 fgrep\"></a>特殊字符 fgrep</h3><p>搜索文件包含正则表达式元字符串时,例如<code>$</code>、<code>^</code>、<code>/</code>等，<code>fgrep</code>很有用</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/hexo$ egrep &quot;^Hello&quot;  12</span><br><span class=\"line\">cs@debian:~/oss/hexo$ grep &quot;^Hello&quot;  12</span><br><span class=\"line\">cs@debian:~/oss/hexo$ fgrep &quot;^Hello&quot;  12</span><br><span class=\"line\">^Hello\\</span><br></pre></td></tr></table></figure>\n\n<p>它<code>不解析正则表达式</code>、想搜什么就跟什么</p>\n<h3 id=\"压缩文件-zgrep\"><a href=\"#压缩文件-zgrep\" class=\"headerlink\" title=\"压缩文件  zgrep\"></a>压缩文件  zgrep</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zgrep  pattern1  ./*   |  grep  pattern2</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>zegrep  </p>\n<p>zcat file1.gz file2.gz</p>\n</blockquote>"},{"title":"iptable防火墙","date":"2022-07-31T09:17:26.000Z","_content":"\n\n\n\n\n\n\n\n\n### 数据流向\n\n![](/pics/iptable-01.png)\n\n\n\n-  当一个数据包进入网卡时，它首先进入PREROUTING链，内核根据数据包目的IP判断是否需要转送出去。 \n- 如果数据包就是**`进入本机`**的，它就会到达INPUT链。数据包到了**`INPUT链`**后，任何进程都会收到它。本机上运行的程序可以发送数据包，这些数据包会经过OUTPUT链，然后到达POSTROUTING链输出。 \n- 如果数据包是要**`转发出去`**的，且内核允许转发，数据包就会如图所示向右移动，经过**`FORWARD链`**，然后到达POSTROUTING链输出。\n  \n\n![](/pics/iptable-01-1.png)\n\n\n\n```shell\n#临时生效\necho 1 > /proc/sys/net/ipv4/ip_forward\n#永久生效\ncs@debian:~/oss/hexo$ cat /etc/sysctl.conf | grep net.ipv4.ip_\nnet.ipv4.ip_forward=1\n```\n\n<!--more-->\n\n![](/pics/iptable-01-2.png)\n\n\n\n\n\n### 命令规则\n\n![](/pics/iptable-02.png)\n\n- 所有表名必须小写\n\n  filter/nat/mangle\n\n- 所有链名必须大写\n   INPUT/OUTPUT/FORWARD/PREROUTING/POSTROUTING\n\n| 名称        | 功能                                                         | 作用的表                                                     |\n| ----------- | ------------------------------------------------------------ | ------------------------------------------------------------ |\n| PREROUTING  | 主机外报文进入位置                                           | mangle, nat（目标地址转换，，通常指响应报文）                |\n| INPUT       | 报文进入本机用户空间位置                                     | filter, mangle                                               |\n| OUTPUT      | 报文从本机用户空间出去的位置                                 | filter, mangle, nat                                          |\n| FOWARD      | 报文经过路由并且发觉不是本机决定转发但还不知道从哪个网卡出去 | filter, mangle（中转）                                       |\n| POSTROUTING | 报文经过路由被转发出去                                       | 许mangle，nat（源地址转换，把原始地址转换为转发主机出口网卡地址） |\n\n \n\n- 所有匹配必须小写\n   -s/-d/-m <module_name>/-p\n\n- 所有动作必须大写\n   ACCEPT/DROP/SNAT/DNAT/MASQUERADE\n\n\n\n","source":"_posts/linux/shell/iptable.md","raw":"---\ntitle: iptable防火墙\npermalink: linux/shell/iptable/\ntags:\n  - iptable\ncategories:\n  - linux\n  - shell\ndate: 2022-07-31 17:17:26\n---\n\n\n\n\n\n\n\n\n\n### 数据流向\n\n![](/pics/iptable-01.png)\n\n\n\n-  当一个数据包进入网卡时，它首先进入PREROUTING链，内核根据数据包目的IP判断是否需要转送出去。 \n- 如果数据包就是**`进入本机`**的，它就会到达INPUT链。数据包到了**`INPUT链`**后，任何进程都会收到它。本机上运行的程序可以发送数据包，这些数据包会经过OUTPUT链，然后到达POSTROUTING链输出。 \n- 如果数据包是要**`转发出去`**的，且内核允许转发，数据包就会如图所示向右移动，经过**`FORWARD链`**，然后到达POSTROUTING链输出。\n  \n\n![](/pics/iptable-01-1.png)\n\n\n\n```shell\n#临时生效\necho 1 > /proc/sys/net/ipv4/ip_forward\n#永久生效\ncs@debian:~/oss/hexo$ cat /etc/sysctl.conf | grep net.ipv4.ip_\nnet.ipv4.ip_forward=1\n```\n\n<!--more-->\n\n![](/pics/iptable-01-2.png)\n\n\n\n\n\n### 命令规则\n\n![](/pics/iptable-02.png)\n\n- 所有表名必须小写\n\n  filter/nat/mangle\n\n- 所有链名必须大写\n   INPUT/OUTPUT/FORWARD/PREROUTING/POSTROUTING\n\n| 名称        | 功能                                                         | 作用的表                                                     |\n| ----------- | ------------------------------------------------------------ | ------------------------------------------------------------ |\n| PREROUTING  | 主机外报文进入位置                                           | mangle, nat（目标地址转换，，通常指响应报文）                |\n| INPUT       | 报文进入本机用户空间位置                                     | filter, mangle                                               |\n| OUTPUT      | 报文从本机用户空间出去的位置                                 | filter, mangle, nat                                          |\n| FOWARD      | 报文经过路由并且发觉不是本机决定转发但还不知道从哪个网卡出去 | filter, mangle（中转）                                       |\n| POSTROUTING | 报文经过路由被转发出去                                       | 许mangle，nat（源地址转换，把原始地址转换为转发主机出口网卡地址） |\n\n \n\n- 所有匹配必须小写\n   -s/-d/-m <module_name>/-p\n\n- 所有动作必须大写\n   ACCEPT/DROP/SNAT/DNAT/MASQUERADE\n\n\n\n","slug":"linux/shell/iptable","published":1,"updated":"2022-08-28T09:10:00.944Z","__permalink":"linux/shell/iptable/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gttq0030gwi5cdgramws","content":"<h3 id=\"数据流向\"><a href=\"#数据流向\" class=\"headerlink\" title=\"数据流向\"></a>数据流向</h3><p><img src=\"/pics/iptable-01.png\"></p>\n<ul>\n<li>当一个数据包进入网卡时，它首先进入PREROUTING链，内核根据数据包目的IP判断是否需要转送出去。 </li>\n<li>如果数据包就是**<code>进入本机</code><strong>的，它就会到达INPUT链。数据包到了</strong><code>INPUT链</code>**后，任何进程都会收到它。本机上运行的程序可以发送数据包，这些数据包会经过OUTPUT链，然后到达POSTROUTING链输出。 </li>\n<li>如果数据包是要**<code>转发出去</code><strong>的，且内核允许转发，数据包就会如图所示向右移动，经过</strong><code>FORWARD链</code>**，然后到达POSTROUTING链输出。</li>\n</ul>\n<p><img src=\"/pics/iptable-01-1.png\"></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">临时生效</span></span><br><span class=\"line\">echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">永久生效</span></span><br><span class=\"line\">cs@debian:~/oss/hexo$ cat /etc/sysctl.conf | grep net.ipv4.ip_</span><br><span class=\"line\">net.ipv4.ip_forward=1</span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n<p><img src=\"/pics/iptable-01-2.png\"></p>\n<h3 id=\"命令规则\"><a href=\"#命令规则\" class=\"headerlink\" title=\"命令规则\"></a>命令规则</h3><p><img src=\"/pics/iptable-02.png\"></p>\n<ul>\n<li><p>所有表名必须小写</p>\n<p>filter&#x2F;nat&#x2F;mangle</p>\n</li>\n<li><p>所有链名必须大写<br> INPUT&#x2F;OUTPUT&#x2F;FORWARD&#x2F;PREROUTING&#x2F;POSTROUTING</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>功能</th>\n<th>作用的表</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>PREROUTING</td>\n<td>主机外报文进入位置</td>\n<td>mangle, nat（目标地址转换，，通常指响应报文）</td>\n</tr>\n<tr>\n<td>INPUT</td>\n<td>报文进入本机用户空间位置</td>\n<td>filter, mangle</td>\n</tr>\n<tr>\n<td>OUTPUT</td>\n<td>报文从本机用户空间出去的位置</td>\n<td>filter, mangle, nat</td>\n</tr>\n<tr>\n<td>FOWARD</td>\n<td>报文经过路由并且发觉不是本机决定转发但还不知道从哪个网卡出去</td>\n<td>filter, mangle（中转）</td>\n</tr>\n<tr>\n<td>POSTROUTING</td>\n<td>报文经过路由被转发出去</td>\n<td>许mangle，nat（源地址转换，把原始地址转换为转发主机出口网卡地址）</td>\n</tr>\n</tbody></table>\n<ul>\n<li><p>所有匹配必须小写<br> -s&#x2F;-d&#x2F;-m <module_name>&#x2F;-p</p>\n</li>\n<li><p>所有动作必须大写<br> ACCEPT&#x2F;DROP&#x2F;SNAT&#x2F;DNAT&#x2F;MASQUERADE</p>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"<h3 id=\"数据流向\"><a href=\"#数据流向\" class=\"headerlink\" title=\"数据流向\"></a>数据流向</h3><p><img src=\"/pics/iptable-01.png\"></p>\n<ul>\n<li>当一个数据包进入网卡时，它首先进入PREROUTING链，内核根据数据包目的IP判断是否需要转送出去。 </li>\n<li>如果数据包就是**<code>进入本机</code><strong>的，它就会到达INPUT链。数据包到了</strong><code>INPUT链</code>**后，任何进程都会收到它。本机上运行的程序可以发送数据包，这些数据包会经过OUTPUT链，然后到达POSTROUTING链输出。 </li>\n<li>如果数据包是要**<code>转发出去</code><strong>的，且内核允许转发，数据包就会如图所示向右移动，经过</strong><code>FORWARD链</code>**，然后到达POSTROUTING链输出。</li>\n</ul>\n<p><img src=\"/pics/iptable-01-1.png\"></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">临时生效</span></span><br><span class=\"line\">echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">永久生效</span></span><br><span class=\"line\">cs@debian:~/oss/hexo$ cat /etc/sysctl.conf | grep net.ipv4.ip_</span><br><span class=\"line\">net.ipv4.ip_forward=1</span><br></pre></td></tr></table></figure>","more":"<p><img src=\"/pics/iptable-01-2.png\"></p>\n<h3 id=\"命令规则\"><a href=\"#命令规则\" class=\"headerlink\" title=\"命令规则\"></a>命令规则</h3><p><img src=\"/pics/iptable-02.png\"></p>\n<ul>\n<li><p>所有表名必须小写</p>\n<p>filter&#x2F;nat&#x2F;mangle</p>\n</li>\n<li><p>所有链名必须大写<br> INPUT&#x2F;OUTPUT&#x2F;FORWARD&#x2F;PREROUTING&#x2F;POSTROUTING</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>功能</th>\n<th>作用的表</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>PREROUTING</td>\n<td>主机外报文进入位置</td>\n<td>mangle, nat（目标地址转换，，通常指响应报文）</td>\n</tr>\n<tr>\n<td>INPUT</td>\n<td>报文进入本机用户空间位置</td>\n<td>filter, mangle</td>\n</tr>\n<tr>\n<td>OUTPUT</td>\n<td>报文从本机用户空间出去的位置</td>\n<td>filter, mangle, nat</td>\n</tr>\n<tr>\n<td>FOWARD</td>\n<td>报文经过路由并且发觉不是本机决定转发但还不知道从哪个网卡出去</td>\n<td>filter, mangle（中转）</td>\n</tr>\n<tr>\n<td>POSTROUTING</td>\n<td>报文经过路由被转发出去</td>\n<td>许mangle，nat（源地址转换，把原始地址转换为转发主机出口网卡地址）</td>\n</tr>\n</tbody></table>\n<ul>\n<li><p>所有匹配必须小写<br> -s&#x2F;-d&#x2F;-m <module_name>&#x2F;-p</p>\n</li>\n<li><p>所有动作必须大写<br> ACCEPT&#x2F;DROP&#x2F;SNAT&#x2F;DNAT&#x2F;MASQUERADE</p>\n</li>\n</ul>"},{"title":"ps","date":"2022-06-03T08:56:09.000Z","_content":"\nps (process status) 命令用于显示当前进程的状态，类似于 windows 的任务管理器\n\n\n\n### 查找指定进程\n\n```\n$ ps -ef | grep  key\ncs        4565  4533  0 21:14 pts/2    00:00:00 /opt/ELK/elasticsearch-7.17.1/modules/x-pack-ml/platform/linux-x86_64/bin/controller\n```\n\n> key 运行进程的关键字 (如:ps -ef | grep  tomcat)\n>\n> UID 启动进程的用户名\n>\n> PID  进程pid\n>\n> PPID \n>\n> C \n>\n> STIME 开始启动时间 \n>\n> TTY  终端号\n>\n> TIME  运行时间\n>\n> CMD   启动进程的命令\n\n<!--more-->\n\n### 查找进程使用情况\n\n```\nps -aux | grep Typora\nUSER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND\ncs  7458  1.2  0.8 4913400 139224 ?      Sl   15:11   0:08 /usr/share/typora/Typora /home/cs/go/ps.md\n\n```\n\n- USER: 行程拥有者\n- PID: pid\n- %CPU: 占用的 CPU 使用率\n- %MEM: 占用的记忆体使用率\n- VSZ: 占用的虚拟记忆体大小\n- RSS: 占用的记忆体大小\n- TTY: 终端的次要装置号码 (minor device number of tty)\n- STAT: 该行程的状态:\n  - D: 无法中断的休眠状态 (通常 IO 的进程)\n  - R: 正在执行中\n  - S: 静止状态\n  - T: 暂停执行\n  - Z: 不存在但暂时无法消除\n  - W: 没有足够的记忆体分页可分配\n  - <: 高优先序的行程\n  - N: 低优先序的行程\n  - L: 有记忆体分页分配并锁在记忆体内 (实时系统或捱A I/O)\n- START: 行程开始时间\n- TIME: 执行的时间\n- COMMAND:所执行的指令\n\n\n\n#### 内存\n\n```\n$ ps -aux | sort -k4nr | head -3\nUSER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND\ncs   2119  4.8  1.6 1183553740 265420 ?   Sl   14:02   4:06 /opt/google/chrome/chrome -- ...\ncs   1660  5.1  1.5 34393500 254380 ?     SLl  13:59   4:30 /opt/google/chrome/chrome --...\ncs   1753  1.0  1.4 1179343396 242272 ?   Sl   13:59   0:57 /opt/google/chrome/chrome --...\n```\n\n>a all所有\n>\n>u userid,该进程用户id\n>\n>x 所有程序,不已终端区分\n>\n>sort 排序\n>\n>k 代表从第几列开始\n>\n>4n 4列(%MEM)开始\n>\n>r 反向(reverse) ,默认从小到大\n>\n>head  头几列(-3 ,显示前3列)\n\n\n\n#### cpu\n\n```\n$ ps -aux | sort -k3nr | head -3\n```\n\n","source":"_posts/linux/shell/ps.md","raw":"---\ntitle: ps\ntags:\n  - shell\ncategories:\n  - linux\n  - shell\ndate: 2022-06-03 16:56:09\n---\n\nps (process status) 命令用于显示当前进程的状态，类似于 windows 的任务管理器\n\n\n\n### 查找指定进程\n\n```\n$ ps -ef | grep  key\ncs        4565  4533  0 21:14 pts/2    00:00:00 /opt/ELK/elasticsearch-7.17.1/modules/x-pack-ml/platform/linux-x86_64/bin/controller\n```\n\n> key 运行进程的关键字 (如:ps -ef | grep  tomcat)\n>\n> UID 启动进程的用户名\n>\n> PID  进程pid\n>\n> PPID \n>\n> C \n>\n> STIME 开始启动时间 \n>\n> TTY  终端号\n>\n> TIME  运行时间\n>\n> CMD   启动进程的命令\n\n<!--more-->\n\n### 查找进程使用情况\n\n```\nps -aux | grep Typora\nUSER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND\ncs  7458  1.2  0.8 4913400 139224 ?      Sl   15:11   0:08 /usr/share/typora/Typora /home/cs/go/ps.md\n\n```\n\n- USER: 行程拥有者\n- PID: pid\n- %CPU: 占用的 CPU 使用率\n- %MEM: 占用的记忆体使用率\n- VSZ: 占用的虚拟记忆体大小\n- RSS: 占用的记忆体大小\n- TTY: 终端的次要装置号码 (minor device number of tty)\n- STAT: 该行程的状态:\n  - D: 无法中断的休眠状态 (通常 IO 的进程)\n  - R: 正在执行中\n  - S: 静止状态\n  - T: 暂停执行\n  - Z: 不存在但暂时无法消除\n  - W: 没有足够的记忆体分页可分配\n  - <: 高优先序的行程\n  - N: 低优先序的行程\n  - L: 有记忆体分页分配并锁在记忆体内 (实时系统或捱A I/O)\n- START: 行程开始时间\n- TIME: 执行的时间\n- COMMAND:所执行的指令\n\n\n\n#### 内存\n\n```\n$ ps -aux | sort -k4nr | head -3\nUSER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND\ncs   2119  4.8  1.6 1183553740 265420 ?   Sl   14:02   4:06 /opt/google/chrome/chrome -- ...\ncs   1660  5.1  1.5 34393500 254380 ?     SLl  13:59   4:30 /opt/google/chrome/chrome --...\ncs   1753  1.0  1.4 1179343396 242272 ?   Sl   13:59   0:57 /opt/google/chrome/chrome --...\n```\n\n>a all所有\n>\n>u userid,该进程用户id\n>\n>x 所有程序,不已终端区分\n>\n>sort 排序\n>\n>k 代表从第几列开始\n>\n>4n 4列(%MEM)开始\n>\n>r 反向(reverse) ,默认从小到大\n>\n>head  头几列(-3 ,显示前3列)\n\n\n\n#### cpu\n\n```\n$ ps -aux | sort -k3nr | head -3\n```\n\n","slug":"linux/shell/ps","published":1,"updated":"2022-07-14T13:55:43.621Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gttr0034gwi55yt1c5p1","content":"<p>ps (process status) 命令用于显示当前进程的状态，类似于 windows 的任务管理器</p>\n<h3 id=\"查找指定进程\"><a href=\"#查找指定进程\" class=\"headerlink\" title=\"查找指定进程\"></a>查找指定进程</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ps -ef | grep  key</span><br><span class=\"line\">cs        4565  4533  0 21:14 pts/2    00:00:00 /opt/ELK/elasticsearch-7.17.1/modules/x-pack-ml/platform/linux-x86_64/bin/controller</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>key 运行进程的关键字 (如:ps -ef | grep  tomcat)</p>\n<p>UID 启动进程的用户名</p>\n<p>PID  进程pid</p>\n<p>PPID </p>\n<p>C </p>\n<p>STIME 开始启动时间 </p>\n<p>TTY  终端号</p>\n<p>TIME  运行时间</p>\n<p>CMD   启动进程的命令</p>\n</blockquote>\n<span id=\"more\"></span>\n\n<h3 id=\"查找进程使用情况\"><a href=\"#查找进程使用情况\" class=\"headerlink\" title=\"查找进程使用情况\"></a>查找进程使用情况</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps -aux | grep Typora</span><br><span class=\"line\">USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND</span><br><span class=\"line\">cs  7458  1.2  0.8 4913400 139224 ?      Sl   15:11   0:08 /usr/share/typora/Typora /home/cs/go/ps.md</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>USER: 行程拥有者</li>\n<li>PID: pid</li>\n<li>%CPU: 占用的 CPU 使用率</li>\n<li>%MEM: 占用的记忆体使用率</li>\n<li>VSZ: 占用的虚拟记忆体大小</li>\n<li>RSS: 占用的记忆体大小</li>\n<li>TTY: 终端的次要装置号码 (minor device number of tty)</li>\n<li>STAT: 该行程的状态:<ul>\n<li>D: 无法中断的休眠状态 (通常 IO 的进程)</li>\n<li>R: 正在执行中</li>\n<li>S: 静止状态</li>\n<li>T: 暂停执行</li>\n<li>Z: 不存在但暂时无法消除</li>\n<li>W: 没有足够的记忆体分页可分配</li>\n<li>&lt;: 高优先序的行程</li>\n<li>N: 低优先序的行程</li>\n<li>L: 有记忆体分页分配并锁在记忆体内 (实时系统或捱A I&#x2F;O)</li>\n</ul>\n</li>\n<li>START: 行程开始时间</li>\n<li>TIME: 执行的时间</li>\n<li>COMMAND:所执行的指令</li>\n</ul>\n<h4 id=\"内存\"><a href=\"#内存\" class=\"headerlink\" title=\"内存\"></a>内存</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ps -aux | sort -k4nr | head -3</span><br><span class=\"line\">USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND</span><br><span class=\"line\">cs   2119  4.8  1.6 1183553740 265420 ?   Sl   14:02   4:06 /opt/google/chrome/chrome -- ...</span><br><span class=\"line\">cs   1660  5.1  1.5 34393500 254380 ?     SLl  13:59   4:30 /opt/google/chrome/chrome --...</span><br><span class=\"line\">cs   1753  1.0  1.4 1179343396 242272 ?   Sl   13:59   0:57 /opt/google/chrome/chrome --...</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>a all所有</p>\n<p>u userid,该进程用户id</p>\n<p>x 所有程序,不已终端区分</p>\n<p>sort 排序</p>\n<p>k 代表从第几列开始</p>\n<p>4n 4列(%MEM)开始</p>\n<p>r 反向(reverse) ,默认从小到大</p>\n<p>head  头几列(-3 ,显示前3列)</p>\n</blockquote>\n<h4 id=\"cpu\"><a href=\"#cpu\" class=\"headerlink\" title=\"cpu\"></a>cpu</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ps -aux | sort -k3nr | head -3</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>ps (process status) 命令用于显示当前进程的状态，类似于 windows 的任务管理器</p>\n<h3 id=\"查找指定进程\"><a href=\"#查找指定进程\" class=\"headerlink\" title=\"查找指定进程\"></a>查找指定进程</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ps -ef | grep  key</span><br><span class=\"line\">cs        4565  4533  0 21:14 pts/2    00:00:00 /opt/ELK/elasticsearch-7.17.1/modules/x-pack-ml/platform/linux-x86_64/bin/controller</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>key 运行进程的关键字 (如:ps -ef | grep  tomcat)</p>\n<p>UID 启动进程的用户名</p>\n<p>PID  进程pid</p>\n<p>PPID </p>\n<p>C </p>\n<p>STIME 开始启动时间 </p>\n<p>TTY  终端号</p>\n<p>TIME  运行时间</p>\n<p>CMD   启动进程的命令</p>\n</blockquote>","more":"<h3 id=\"查找进程使用情况\"><a href=\"#查找进程使用情况\" class=\"headerlink\" title=\"查找进程使用情况\"></a>查找进程使用情况</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps -aux | grep Typora</span><br><span class=\"line\">USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND</span><br><span class=\"line\">cs  7458  1.2  0.8 4913400 139224 ?      Sl   15:11   0:08 /usr/share/typora/Typora /home/cs/go/ps.md</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>USER: 行程拥有者</li>\n<li>PID: pid</li>\n<li>%CPU: 占用的 CPU 使用率</li>\n<li>%MEM: 占用的记忆体使用率</li>\n<li>VSZ: 占用的虚拟记忆体大小</li>\n<li>RSS: 占用的记忆体大小</li>\n<li>TTY: 终端的次要装置号码 (minor device number of tty)</li>\n<li>STAT: 该行程的状态:<ul>\n<li>D: 无法中断的休眠状态 (通常 IO 的进程)</li>\n<li>R: 正在执行中</li>\n<li>S: 静止状态</li>\n<li>T: 暂停执行</li>\n<li>Z: 不存在但暂时无法消除</li>\n<li>W: 没有足够的记忆体分页可分配</li>\n<li>&lt;: 高优先序的行程</li>\n<li>N: 低优先序的行程</li>\n<li>L: 有记忆体分页分配并锁在记忆体内 (实时系统或捱A I&#x2F;O)</li>\n</ul>\n</li>\n<li>START: 行程开始时间</li>\n<li>TIME: 执行的时间</li>\n<li>COMMAND:所执行的指令</li>\n</ul>\n<h4 id=\"内存\"><a href=\"#内存\" class=\"headerlink\" title=\"内存\"></a>内存</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ps -aux | sort -k4nr | head -3</span><br><span class=\"line\">USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND</span><br><span class=\"line\">cs   2119  4.8  1.6 1183553740 265420 ?   Sl   14:02   4:06 /opt/google/chrome/chrome -- ...</span><br><span class=\"line\">cs   1660  5.1  1.5 34393500 254380 ?     SLl  13:59   4:30 /opt/google/chrome/chrome --...</span><br><span class=\"line\">cs   1753  1.0  1.4 1179343396 242272 ?   Sl   13:59   0:57 /opt/google/chrome/chrome --...</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>a all所有</p>\n<p>u userid,该进程用户id</p>\n<p>x 所有程序,不已终端区分</p>\n<p>sort 排序</p>\n<p>k 代表从第几列开始</p>\n<p>4n 4列(%MEM)开始</p>\n<p>r 反向(reverse) ,默认从小到大</p>\n<p>head  头几列(-3 ,显示前3列)</p>\n</blockquote>\n<h4 id=\"cpu\"><a href=\"#cpu\" class=\"headerlink\" title=\"cpu\"></a>cpu</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ps -aux | sort -k3nr | head -3</span><br></pre></td></tr></table></figure>"},{"title":"sed替换查找","date":"2022-07-09T13:18:56.000Z","_content":"\n### 参数\n\n```\nsed [options] 'command' file(s) \n\nsed [options] -f scriptfile file(s)\n\n\ng 表示行内全面替换。     global 全局   \np 表示打印行。 P 打印模板第一行\nr 读文件\n-n ：使用安静(silent)模式。在一般 sed 的用法中，所有来自 STDIN 的数据一般都会被列出到终端上。但如果加上 -n 参数后，则只有经过sed 特殊处理的那一行(或者动作)才会被列出来。 \n-e ：直接在命令列模式上进行 sed 的动作编辑； \n-f ：直接将 sed 的动作写在一个文件内， -f filename 则可以运行 filename 内的 sed 动作；\n-r ：sed 的动作支持的是延伸型正规表示法的语法。(默认是基础正规表示法语法) -i ：直接修改读取的文件内容，而不是输出到终端   \n w 表示把行写入一个文件。\n x 表示互换模板块中的文本和缓冲区中的文本。\n y 表示把一个字符翻译为另外的字符（但是不用于正则表达式）\n \\1 子串匹配标记 \n& 已匹配字符串标记元字符集\n^ 匹配行开始，如：/^sed/匹配所有以sed开头的行。 \n$ 匹配行结束，如：/sed$/匹配所有以sed结尾的行。\n . 匹配一个非换行符的任意字符，如：/s.d/匹配s后接一个任意字符，最后是d。\n * 匹配0个或多个字符，如：/*sed/匹配所有模板是一个或多个空格后紧跟sed的行。\n [] 匹配一个指定范围内的字符，如/[ss]ed/匹配sed和Sed。\n [^] 匹配一个不在指定范围内的字符，如：/[^A-RT-Z]ed/匹配不包含A-R和T-Z的一个字母开头，紧跟ed的行。\n \\(..\\) 匹配子串，保存匹配的字符，如s/\\(love\\)able/\\1rs，loveable被替换成lovers。\n & 保存搜索字符用来替换其他字符，如s/love/**&**/，love这成**love**。\n \\< 匹配单词的开始，如:/\\ 匹配单词的结束，如/love\\>/匹配包含以love结尾的单词的行。\n x\\{m\\} 重复字符x，m次，如：/0\\{5\\}/匹配包含5个0的行。\n x\\{m,\\} 重复字符x，至少m次，如：/0\\{5,\\}/匹配至少有5个0的行。\n x\\{m,n\\} 重复字符x，至少m次，不多于n次，如：/0\\{5,10\\}/匹配5~10个0的行。\n```\n\n \n\n### 批量替换\n\n把目录下所有格式文件内容进行批量替换\n\n```shell\nsed -n \"s#$src#$dest#g\"p `grep $src -rl --include=\\*.{yaml,md} $path`\n```\n\n>扫描path路径对应格式的文件,把src替换成dest,\n\n>**sed** \n>\n>-n p  结合打印改变内容,不执行变更\n>\n>**grep**\n>\n>-r 表示查找当前目录以及所有子目录\n>\n>-l 表示仅列出符合条件的文件名\n>\n>--include=\"*.[ch]\" 表示仅查找.c、.h文件\n>\n>上面不适用大多数情况,推荐下面\n>\n>--include=*.{yaml,md}\n\n<!--more-->\n\n​           \n\n样本1 test.txt   (cat -n 显示行号)\n\n```\n111111111 \n222222222   \n```\n\n \n\n#### **a\\ ** 追加\n\n在当前行下面插入文本。  append  追加\n\nN;2a  指定第二行后追加append\n\n```shell\ncs@debian:~/～$ sed -i 'N;2a这是a' test.txt \ncs@debian:~/～$ cat -n test.txt    \n1\t11111111    \n2\t22222222    \n3\t这是a      \n```\n\n​        \n\n/匹配/  不确定行数 a\\ **反斜杠可以不要** a\n\n```shell\n cs@debian:~/～$ sed -i \"/这是a/a\\匹配追加\" test.txt \n cs@debian:~/～$ cat -n test.txt    \n 1\t这是i    \n 2\t11111111    \n 3\t22222222    \n 4\t这是a    \n 5  匹配追加      \n```\n\n​        \n\n####  **i\\ **  插入\n\n在当前行上面插入文本。 insert 插入\n\n N;2i 指定第二行前插入insert  'N;2i\\这是i' （\\省略）\n\n```\ncs@debian:~/～$ sed -i 'N;2i这是i' test.txt\ncs@debian:~/～$ cat -n test.txt    \n1\t这是i    \n2\t11111111    \n3\t22222222    \n```\n\n​          \n\n/匹配/  不确定行数\n\n```\ncs@debian:~/～$ sed -i \"/这是i/i\\匹配插入\" test.txt \ncs@debian:~/～$ cat -n test.txt    \n1\t匹配插入    \n2\t这是i    \n3\t11111111    \n4\t22222222    \n5\t这是a      \n```\n\n​        \n\n匹配多个---》 批量插入\n\n```\n cs@debian:~/～$ sed -i \"/这是/i\\匹配多个\" test.txt \n cs@debian:~/～$ cat -n test.txt    \n 1\t匹配多个    \n 2\t这是i    \n 3\t11111111    \n 4\t22222222    \n 5\t匹配多个    \n 6\t这是a   \n```\n\n​           \n\n c\\ 把选定的行改为新的文本。 \n\n\n\n#### d 删除\n\n删除选择的行。\n\n确定行数\n\n```\ncs@debian:~/～$  sed '2,5d' test.txt\n```\n\n> #2-5行删除  \n>\n>  '2d' 第2行\n>\n>   '10,$d' 10到最后一行\n\n​             \n\n匹配删除 删除匹配下一行  d删除 p打印  #加 -i 直接修改 \n\n\n\n样本2\n\n```\ncs@debian:~/～$ cat -n test.txt     \n1\t11111111     \n2\t这是i     \n3\t22222222     \n4\t这是a     \n5\t33333333             \n```\n\n\n\n#### n N p\n\n```shell\ncs@debian:~/～$ sed '/这是i/{n;d;p}' test.txt\n11111111     \n这是i     \n这是a     \n33333333\ncs@debian:~/～$ sed '/这是i/{N;d;p}' test.txt \n11111111     \n这是a     \n33333333\n```\n\n>n匹配下一行  \n>\n>N匹配当前行和下一行\n\n\n\nn命令-->移动到匹配行的下一行  {n;操作;}\n\n```\n$ sed -i '/^ZOOKEEPER_PREFIX/{n;s#$#JAVA_HOME=/opt/jdk/jdk-11.0.12#;}' ./zkEnv.sh\n```\n\n>ZOOKEEPER_PREFIX=\"${ZOOBINDIR}/..\"\n>\n>JAVA_HOME=/opt/jdk/jdk-11.0.12\n>\n>#check to see if the conf dir is given as an optional argument\n\n\n\n上一行 (提供多的特征匹配)\n\n```\nsed -n '/^if.*JAVA_HOME/i\\JAVA_HOME=/opt/jdk/jdk-11.0.12' ./zkEnv.sh \n```\n\n>JAVA_HOME=/opt/jdk/jdk-11.0.12\n>\n>if [[ -n \"$JAVA_HOME\" ]] && [[ -x \"$JAVA_HOME/bin/java\" ]];  then\n>\n>​    JAVA=\"$JAVA_HOME/bin/java\"\n>\n>elif type -p java; then\n\n\n\n\n\n N 将下一行读入并附加到当前行后面放到当前空间模式\n\n 最后一行结束\n\n```shell\ncs@debian:~/～$ echo -e \"11111\\n2222222\\n3333\" | sed 'N;p'\n11111\n2222222\n11111\n2222222\n333\n```\n\n\n\n P模式空间第一行 N再次执行就到了3 ，隔行  \n\n```shell\ncs@debian:~/～$ echo -e \"11111\\n2222222\\n3333\\n44\\n55\\n6\" | sed 'N;P'\n1111111111\n2222222\n33333333\n44\n5555\n6\n```\n\n\n\n```\ncs@debian:~$ cat /etc/hosts\n127.0.0.1\tlocalhost\n192.168.56.1  master01 ui.k8s.cn k8s.org jenkins.k8s.cn  gogs.k8s.cn\n192.168.56.101  node01\n192.168.56.108  node02 \ncs@debian:/ip$ ip=192.168.56.108\ncs@debian:/ip$ cat hosts | sed -e  \"s/^\\(${ip}\\)\\([[:space:]]*\\)\\(.*\\)/\\3/g\" p\nnode01\n```\n\n\n\n```\ncs@debian:/ip$ ip=node02\ncs@debian:/ip$ cat hosts | sed -n \"s/\\(.*\\)\\([[:space:]]*\\)\\(${ip}\\)/\\1/g\"p\n192.168.56.108  \n```\n\n\n\n```shell\nzookeeper.connect=localhost:2181\n cat ./config/server.properties | sed -n 's/^zookeeper\\.connect=\\(.*\\)/\\1/'p\nlocalhost:2181\ncat ./config/server.properties | sed -n \"s#^listeners=PLAINTEXT://\\(.*\\)#\\1#\"p\n127.0.0.1:9092\n```\n\n\n\n​         \n\n\n\n####  D\n\n 删除模板块的第一行。\n\n\n\n####  s 替换\n\ns/指定字符/替换字符/\n\nrelative/directory/  改为/etc/supervisor.conf.d/\n\n```shell\ncs@debian:~/～$ sed -n   's/relative\\/directory\\//\\/etc\\/supervisor.conf.d\\//'p /etc/supervisord.conf\n```\n\n> -n选项和p命令一起使用表示只打印发生替换的行\n\n  \n\n 防火墙关闭\n\n```\ncat /etc/selinux/config | grep ^SELINUX= | sed  's/^SELINUX=.*/SELINUX=disabled/'\nsed -i '/SELINUX/s/enforcing/disabled/' /etc/selinux/config\n```\n\n\n\n替换整行\n\n  ```shell\ncs@debian:~/～$  sed  -i  '2s/^.*$/xxxxx/'  file  \n  ```\n\n\n\n\n\n#### 截取 \n\n```shell\ncs@debian:~/～$ echo \"tinkle-app-style-0.0.1-SNAPSHOT.jar\" | sed 's/\\([a-z]-*\\)-[0-9].*/\\1/'\n```\n\n\n\n```shell\ncs@debian:~/～$  echo \"abcdef-shea-df\" | sed 's/\\(.*\\)-\\(.*\\)-\\(.*\\)/\\2/g'\n命令解释\n\\(.*\\)- : 表示第一个引号前的内容\n-\\(.*\\)-：表示两引号之间的内容\n-\\(.*\\)：表示引号后的内容\n\\2: 表示第二对括号里面的内容\n括号里的表达式匹配的内容，可以用\\1，\\2等进行引用，第n个括号对内的内容，就用\\n引用。\n这个命令的意思是：\n用\\2代表的第二个括号的内容（shea）去替换整个字符串，这样就得到了我们所需要的子字符串了。\n```\n\n\n\n```shell\ncs@debian:~$ echo \"etch-master.sh\" | sed 's/\\(.*\\)-\\(.*\\)\\.\\(.*\\)/\\2/g'\nmaster\ncs@debian:~$ echo \"gen-flanneld.sh\" | sed 's/^gen-\\(.*\\)\\..*/\\1/g'\nflanneld\n```\n\n\n\n```shell\ncs@debian:~$ systemctl status flanneld.service\n● flanneld.service - Flanneld overlay address etcd agent\n   Loaded: loaded (/opt/kubernetes/flanneld/flanneld.service; disabled; vendor p\n   Active: inactive (dead)\ncs@debian:~$ systemctl status flanneld.service | grep Active: | sed 's/.*(\\([a-z]*\\)).*/\\1/g'\ndead\ncs@debian:~$ systemctl status nginx | grep Active | sed 's/.*(\\(.*\\)).*/\\1/g'\nrunning\ncs@debian:~$ systemctl status kube-scheduler  |  sed -n 's/.*ctive:.*(\\(.*\\)).*/\\1/g'p\ndead\n```\n\n\n\n### 标记跳转\n\n删除前一行  (:a  ;ta) a标记，ta执行成功在跳转，类似循环\n\n   ```shell\ncs@debian:~/～$ sed -e :a -e '$!N;s/.*\\n\\(.*是.*\\)/\\1/;ta' -e 'P;D'  test.txt\n这是i\n这是a\n33333333 \n   ```\n\n\n\n前置 s/正则/\\1/    $最后一行 ！不进行 \n\n```shell\ncs@debian:~/～$ sed -e   '$!N;s/.*\\n\\(.*是i\\)/\\1/' -e 'p;d'  test.txt\n这是i\n22222222\n这是a\n33333333\ncs@debian:~/～$ sed -e   '$!N;s/.*\\n\\(.*是i\\)/\\1/' -e 'P;D'  test.txt\n这是i\n22222222\n这是a\n33333333\ncs@debian:~/～$ sed -e :a -e '$!N;s/.*\\n\\(.*是.*\\)/\\1/;ta' -e 'P;D'  test.txt\n这是i\n这是a\n33333333\n```\n\n\n\n\n\ntest\n\n```\n3d5f\n<Proxy>\n这是i\n<P>\n22222222\n</Proxy>\nabcde\n```\n\n替换Proxy 标签中间部分\n\n```shell\nsed '/<P/{:a;N;/<\\//!ba;s/>[^<].*</>\\n替换你们\\n</}'  test\n\n<p  :a;N;/<\\//!ba\n匹配<Proxy  :a标记  </ 结束匹配标记  !b （匹配不了，执行下句命令）\ns/>[^<]*</>\\n1234567\\n</\n>把中间内容<  替换指定内容\n```\n\n\n\n\n\n\n\n\n\n### 注释       \n\njoin.yaml\n\n```\n#kind: JoinConfiguration\n\nnodeRegistration:\n  name: debian  #节点名,master要能解析\n```\n\n#### 添加\n\n```\nsed -n '/debian/s/^/#/'p ./join.yaml\n```\n\n> \\#  name: debian  #节点名,master要能解析\n\n```\nsed -n 's/debian/#&/'p ./join.yaml\n```\n\n>  name: #debian  #节点名,master要能解析\n\n\n\n```\ncs@debian:~$ cat /etc/fstab | grep swap | sed '/swap/s/^/#/' \n## swap was on /dev/sda5 during installation\n##UUID=0fd6cee8-fdfa-459b-a7c6-1898ea2ade8e none            swap    sw              0       0\n[vagrant@master03 ~]$ cat /etc/fstab | grep swap | sed '/swap/s/^/#/' \n##/swapfile none swap defaults 0 0\n```\n\n\n\n```\nsed -i '/匹配字符串/,+4 s/^/#/' 文件名   #匹配行和下面4行\n```\n\n> +4表示匹配行和下面4行，一共5行注释\n\n\n\n\n\n#### 删除\n\n```\n#去掉所有行注释\nsed -n '/^#.*$/s/^#//'p ./join.yaml\n#去匹配行注释\nsed -n '/^#.*debian.*$/s/^#//'p ./join.yaml\n```\n\n>  name: debian  #节点名,master要能解析\n\n\n\n```shell\nsed 's/^#.*\\(en_US.UTF-8\\)/\\1/' test\n```\n\n\n\n\n\n```\n#去注释行\nsed -i '/^#/d' ./join.yaml\n#去空行和注释行\nsed -i '/^$/d;/^#/' ./join.yaml\n```\n\n\n\n```\nsed -i '/匹配字符串/,+4 s/^#*//' 文件名\n\n[vagrant@node06 ~]$ grep 'HOME'  /etc/profile\nexport JAVA_HOME=/opt/mq/jre\nexport CLASSPATH=.:${JAVA_HOME}/lib\nexport PATH=${JAVA_HOME}/bin:$PATH\n# echo $(sed -n  '/export\\ JAVA_HOME/,+2 s/export/#/'p /etc/profile)\n# sed -i '/export\\ JAVA_HOME/,+2 s/export/#/' /etc/profile\n```\n\n","source":"_posts/linux/shell/sed.md","raw":"---\ntitle: sed替换查找\npermalink: linux/shell/sed/\ntags:\n  - sed\ncategories:\n  - linux\n  - shell\ndate: 2022-07-09 21:18:56\n---\n\n### 参数\n\n```\nsed [options] 'command' file(s) \n\nsed [options] -f scriptfile file(s)\n\n\ng 表示行内全面替换。     global 全局   \np 表示打印行。 P 打印模板第一行\nr 读文件\n-n ：使用安静(silent)模式。在一般 sed 的用法中，所有来自 STDIN 的数据一般都会被列出到终端上。但如果加上 -n 参数后，则只有经过sed 特殊处理的那一行(或者动作)才会被列出来。 \n-e ：直接在命令列模式上进行 sed 的动作编辑； \n-f ：直接将 sed 的动作写在一个文件内， -f filename 则可以运行 filename 内的 sed 动作；\n-r ：sed 的动作支持的是延伸型正规表示法的语法。(默认是基础正规表示法语法) -i ：直接修改读取的文件内容，而不是输出到终端   \n w 表示把行写入一个文件。\n x 表示互换模板块中的文本和缓冲区中的文本。\n y 表示把一个字符翻译为另外的字符（但是不用于正则表达式）\n \\1 子串匹配标记 \n& 已匹配字符串标记元字符集\n^ 匹配行开始，如：/^sed/匹配所有以sed开头的行。 \n$ 匹配行结束，如：/sed$/匹配所有以sed结尾的行。\n . 匹配一个非换行符的任意字符，如：/s.d/匹配s后接一个任意字符，最后是d。\n * 匹配0个或多个字符，如：/*sed/匹配所有模板是一个或多个空格后紧跟sed的行。\n [] 匹配一个指定范围内的字符，如/[ss]ed/匹配sed和Sed。\n [^] 匹配一个不在指定范围内的字符，如：/[^A-RT-Z]ed/匹配不包含A-R和T-Z的一个字母开头，紧跟ed的行。\n \\(..\\) 匹配子串，保存匹配的字符，如s/\\(love\\)able/\\1rs，loveable被替换成lovers。\n & 保存搜索字符用来替换其他字符，如s/love/**&**/，love这成**love**。\n \\< 匹配单词的开始，如:/\\ 匹配单词的结束，如/love\\>/匹配包含以love结尾的单词的行。\n x\\{m\\} 重复字符x，m次，如：/0\\{5\\}/匹配包含5个0的行。\n x\\{m,\\} 重复字符x，至少m次，如：/0\\{5,\\}/匹配至少有5个0的行。\n x\\{m,n\\} 重复字符x，至少m次，不多于n次，如：/0\\{5,10\\}/匹配5~10个0的行。\n```\n\n \n\n### 批量替换\n\n把目录下所有格式文件内容进行批量替换\n\n```shell\nsed -n \"s#$src#$dest#g\"p `grep $src -rl --include=\\*.{yaml,md} $path`\n```\n\n>扫描path路径对应格式的文件,把src替换成dest,\n\n>**sed** \n>\n>-n p  结合打印改变内容,不执行变更\n>\n>**grep**\n>\n>-r 表示查找当前目录以及所有子目录\n>\n>-l 表示仅列出符合条件的文件名\n>\n>--include=\"*.[ch]\" 表示仅查找.c、.h文件\n>\n>上面不适用大多数情况,推荐下面\n>\n>--include=*.{yaml,md}\n\n<!--more-->\n\n​           \n\n样本1 test.txt   (cat -n 显示行号)\n\n```\n111111111 \n222222222   \n```\n\n \n\n#### **a\\ ** 追加\n\n在当前行下面插入文本。  append  追加\n\nN;2a  指定第二行后追加append\n\n```shell\ncs@debian:~/～$ sed -i 'N;2a这是a' test.txt \ncs@debian:~/～$ cat -n test.txt    \n1\t11111111    \n2\t22222222    \n3\t这是a      \n```\n\n​        \n\n/匹配/  不确定行数 a\\ **反斜杠可以不要** a\n\n```shell\n cs@debian:~/～$ sed -i \"/这是a/a\\匹配追加\" test.txt \n cs@debian:~/～$ cat -n test.txt    \n 1\t这是i    \n 2\t11111111    \n 3\t22222222    \n 4\t这是a    \n 5  匹配追加      \n```\n\n​        \n\n####  **i\\ **  插入\n\n在当前行上面插入文本。 insert 插入\n\n N;2i 指定第二行前插入insert  'N;2i\\这是i' （\\省略）\n\n```\ncs@debian:~/～$ sed -i 'N;2i这是i' test.txt\ncs@debian:~/～$ cat -n test.txt    \n1\t这是i    \n2\t11111111    \n3\t22222222    \n```\n\n​          \n\n/匹配/  不确定行数\n\n```\ncs@debian:~/～$ sed -i \"/这是i/i\\匹配插入\" test.txt \ncs@debian:~/～$ cat -n test.txt    \n1\t匹配插入    \n2\t这是i    \n3\t11111111    \n4\t22222222    \n5\t这是a      \n```\n\n​        \n\n匹配多个---》 批量插入\n\n```\n cs@debian:~/～$ sed -i \"/这是/i\\匹配多个\" test.txt \n cs@debian:~/～$ cat -n test.txt    \n 1\t匹配多个    \n 2\t这是i    \n 3\t11111111    \n 4\t22222222    \n 5\t匹配多个    \n 6\t这是a   \n```\n\n​           \n\n c\\ 把选定的行改为新的文本。 \n\n\n\n#### d 删除\n\n删除选择的行。\n\n确定行数\n\n```\ncs@debian:~/～$  sed '2,5d' test.txt\n```\n\n> #2-5行删除  \n>\n>  '2d' 第2行\n>\n>   '10,$d' 10到最后一行\n\n​             \n\n匹配删除 删除匹配下一行  d删除 p打印  #加 -i 直接修改 \n\n\n\n样本2\n\n```\ncs@debian:~/～$ cat -n test.txt     \n1\t11111111     \n2\t这是i     \n3\t22222222     \n4\t这是a     \n5\t33333333             \n```\n\n\n\n#### n N p\n\n```shell\ncs@debian:~/～$ sed '/这是i/{n;d;p}' test.txt\n11111111     \n这是i     \n这是a     \n33333333\ncs@debian:~/～$ sed '/这是i/{N;d;p}' test.txt \n11111111     \n这是a     \n33333333\n```\n\n>n匹配下一行  \n>\n>N匹配当前行和下一行\n\n\n\nn命令-->移动到匹配行的下一行  {n;操作;}\n\n```\n$ sed -i '/^ZOOKEEPER_PREFIX/{n;s#$#JAVA_HOME=/opt/jdk/jdk-11.0.12#;}' ./zkEnv.sh\n```\n\n>ZOOKEEPER_PREFIX=\"${ZOOBINDIR}/..\"\n>\n>JAVA_HOME=/opt/jdk/jdk-11.0.12\n>\n>#check to see if the conf dir is given as an optional argument\n\n\n\n上一行 (提供多的特征匹配)\n\n```\nsed -n '/^if.*JAVA_HOME/i\\JAVA_HOME=/opt/jdk/jdk-11.0.12' ./zkEnv.sh \n```\n\n>JAVA_HOME=/opt/jdk/jdk-11.0.12\n>\n>if [[ -n \"$JAVA_HOME\" ]] && [[ -x \"$JAVA_HOME/bin/java\" ]];  then\n>\n>​    JAVA=\"$JAVA_HOME/bin/java\"\n>\n>elif type -p java; then\n\n\n\n\n\n N 将下一行读入并附加到当前行后面放到当前空间模式\n\n 最后一行结束\n\n```shell\ncs@debian:~/～$ echo -e \"11111\\n2222222\\n3333\" | sed 'N;p'\n11111\n2222222\n11111\n2222222\n333\n```\n\n\n\n P模式空间第一行 N再次执行就到了3 ，隔行  \n\n```shell\ncs@debian:~/～$ echo -e \"11111\\n2222222\\n3333\\n44\\n55\\n6\" | sed 'N;P'\n1111111111\n2222222\n33333333\n44\n5555\n6\n```\n\n\n\n```\ncs@debian:~$ cat /etc/hosts\n127.0.0.1\tlocalhost\n192.168.56.1  master01 ui.k8s.cn k8s.org jenkins.k8s.cn  gogs.k8s.cn\n192.168.56.101  node01\n192.168.56.108  node02 \ncs@debian:/ip$ ip=192.168.56.108\ncs@debian:/ip$ cat hosts | sed -e  \"s/^\\(${ip}\\)\\([[:space:]]*\\)\\(.*\\)/\\3/g\" p\nnode01\n```\n\n\n\n```\ncs@debian:/ip$ ip=node02\ncs@debian:/ip$ cat hosts | sed -n \"s/\\(.*\\)\\([[:space:]]*\\)\\(${ip}\\)/\\1/g\"p\n192.168.56.108  \n```\n\n\n\n```shell\nzookeeper.connect=localhost:2181\n cat ./config/server.properties | sed -n 's/^zookeeper\\.connect=\\(.*\\)/\\1/'p\nlocalhost:2181\ncat ./config/server.properties | sed -n \"s#^listeners=PLAINTEXT://\\(.*\\)#\\1#\"p\n127.0.0.1:9092\n```\n\n\n\n​         \n\n\n\n####  D\n\n 删除模板块的第一行。\n\n\n\n####  s 替换\n\ns/指定字符/替换字符/\n\nrelative/directory/  改为/etc/supervisor.conf.d/\n\n```shell\ncs@debian:~/～$ sed -n   's/relative\\/directory\\//\\/etc\\/supervisor.conf.d\\//'p /etc/supervisord.conf\n```\n\n> -n选项和p命令一起使用表示只打印发生替换的行\n\n  \n\n 防火墙关闭\n\n```\ncat /etc/selinux/config | grep ^SELINUX= | sed  's/^SELINUX=.*/SELINUX=disabled/'\nsed -i '/SELINUX/s/enforcing/disabled/' /etc/selinux/config\n```\n\n\n\n替换整行\n\n  ```shell\ncs@debian:~/～$  sed  -i  '2s/^.*$/xxxxx/'  file  \n  ```\n\n\n\n\n\n#### 截取 \n\n```shell\ncs@debian:~/～$ echo \"tinkle-app-style-0.0.1-SNAPSHOT.jar\" | sed 's/\\([a-z]-*\\)-[0-9].*/\\1/'\n```\n\n\n\n```shell\ncs@debian:~/～$  echo \"abcdef-shea-df\" | sed 's/\\(.*\\)-\\(.*\\)-\\(.*\\)/\\2/g'\n命令解释\n\\(.*\\)- : 表示第一个引号前的内容\n-\\(.*\\)-：表示两引号之间的内容\n-\\(.*\\)：表示引号后的内容\n\\2: 表示第二对括号里面的内容\n括号里的表达式匹配的内容，可以用\\1，\\2等进行引用，第n个括号对内的内容，就用\\n引用。\n这个命令的意思是：\n用\\2代表的第二个括号的内容（shea）去替换整个字符串，这样就得到了我们所需要的子字符串了。\n```\n\n\n\n```shell\ncs@debian:~$ echo \"etch-master.sh\" | sed 's/\\(.*\\)-\\(.*\\)\\.\\(.*\\)/\\2/g'\nmaster\ncs@debian:~$ echo \"gen-flanneld.sh\" | sed 's/^gen-\\(.*\\)\\..*/\\1/g'\nflanneld\n```\n\n\n\n```shell\ncs@debian:~$ systemctl status flanneld.service\n● flanneld.service - Flanneld overlay address etcd agent\n   Loaded: loaded (/opt/kubernetes/flanneld/flanneld.service; disabled; vendor p\n   Active: inactive (dead)\ncs@debian:~$ systemctl status flanneld.service | grep Active: | sed 's/.*(\\([a-z]*\\)).*/\\1/g'\ndead\ncs@debian:~$ systemctl status nginx | grep Active | sed 's/.*(\\(.*\\)).*/\\1/g'\nrunning\ncs@debian:~$ systemctl status kube-scheduler  |  sed -n 's/.*ctive:.*(\\(.*\\)).*/\\1/g'p\ndead\n```\n\n\n\n### 标记跳转\n\n删除前一行  (:a  ;ta) a标记，ta执行成功在跳转，类似循环\n\n   ```shell\ncs@debian:~/～$ sed -e :a -e '$!N;s/.*\\n\\(.*是.*\\)/\\1/;ta' -e 'P;D'  test.txt\n这是i\n这是a\n33333333 \n   ```\n\n\n\n前置 s/正则/\\1/    $最后一行 ！不进行 \n\n```shell\ncs@debian:~/～$ sed -e   '$!N;s/.*\\n\\(.*是i\\)/\\1/' -e 'p;d'  test.txt\n这是i\n22222222\n这是a\n33333333\ncs@debian:~/～$ sed -e   '$!N;s/.*\\n\\(.*是i\\)/\\1/' -e 'P;D'  test.txt\n这是i\n22222222\n这是a\n33333333\ncs@debian:~/～$ sed -e :a -e '$!N;s/.*\\n\\(.*是.*\\)/\\1/;ta' -e 'P;D'  test.txt\n这是i\n这是a\n33333333\n```\n\n\n\n\n\ntest\n\n```\n3d5f\n<Proxy>\n这是i\n<P>\n22222222\n</Proxy>\nabcde\n```\n\n替换Proxy 标签中间部分\n\n```shell\nsed '/<P/{:a;N;/<\\//!ba;s/>[^<].*</>\\n替换你们\\n</}'  test\n\n<p  :a;N;/<\\//!ba\n匹配<Proxy  :a标记  </ 结束匹配标记  !b （匹配不了，执行下句命令）\ns/>[^<]*</>\\n1234567\\n</\n>把中间内容<  替换指定内容\n```\n\n\n\n\n\n\n\n\n\n### 注释       \n\njoin.yaml\n\n```\n#kind: JoinConfiguration\n\nnodeRegistration:\n  name: debian  #节点名,master要能解析\n```\n\n#### 添加\n\n```\nsed -n '/debian/s/^/#/'p ./join.yaml\n```\n\n> \\#  name: debian  #节点名,master要能解析\n\n```\nsed -n 's/debian/#&/'p ./join.yaml\n```\n\n>  name: #debian  #节点名,master要能解析\n\n\n\n```\ncs@debian:~$ cat /etc/fstab | grep swap | sed '/swap/s/^/#/' \n## swap was on /dev/sda5 during installation\n##UUID=0fd6cee8-fdfa-459b-a7c6-1898ea2ade8e none            swap    sw              0       0\n[vagrant@master03 ~]$ cat /etc/fstab | grep swap | sed '/swap/s/^/#/' \n##/swapfile none swap defaults 0 0\n```\n\n\n\n```\nsed -i '/匹配字符串/,+4 s/^/#/' 文件名   #匹配行和下面4行\n```\n\n> +4表示匹配行和下面4行，一共5行注释\n\n\n\n\n\n#### 删除\n\n```\n#去掉所有行注释\nsed -n '/^#.*$/s/^#//'p ./join.yaml\n#去匹配行注释\nsed -n '/^#.*debian.*$/s/^#//'p ./join.yaml\n```\n\n>  name: debian  #节点名,master要能解析\n\n\n\n```shell\nsed 's/^#.*\\(en_US.UTF-8\\)/\\1/' test\n```\n\n\n\n\n\n```\n#去注释行\nsed -i '/^#/d' ./join.yaml\n#去空行和注释行\nsed -i '/^$/d;/^#/' ./join.yaml\n```\n\n\n\n```\nsed -i '/匹配字符串/,+4 s/^#*//' 文件名\n\n[vagrant@node06 ~]$ grep 'HOME'  /etc/profile\nexport JAVA_HOME=/opt/mq/jre\nexport CLASSPATH=.:${JAVA_HOME}/lib\nexport PATH=${JAVA_HOME}/bin:$PATH\n# echo $(sed -n  '/export\\ JAVA_HOME/,+2 s/export/#/'p /etc/profile)\n# sed -i '/export\\ JAVA_HOME/,+2 s/export/#/' /etc/profile\n```\n\n","slug":"linux/shell/sed","published":1,"updated":"2022-08-28T09:10:00.948Z","__permalink":"linux/shell/sed/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtts0037gwi5doim2ect","content":"<h3 id=\"参数\"><a href=\"#参数\" class=\"headerlink\" title=\"参数\"></a>参数</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed [options] &#x27;command&#x27; file(s) </span><br><span class=\"line\"></span><br><span class=\"line\">sed [options] -f scriptfile file(s)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">g 表示行内全面替换。     global 全局   </span><br><span class=\"line\">p 表示打印行。 P 打印模板第一行</span><br><span class=\"line\">r 读文件</span><br><span class=\"line\">-n ：使用安静(silent)模式。在一般 sed 的用法中，所有来自 STDIN 的数据一般都会被列出到终端上。但如果加上 -n 参数后，则只有经过sed 特殊处理的那一行(或者动作)才会被列出来。 </span><br><span class=\"line\">-e ：直接在命令列模式上进行 sed 的动作编辑； </span><br><span class=\"line\">-f ：直接将 sed 的动作写在一个文件内， -f filename 则可以运行 filename 内的 sed 动作；</span><br><span class=\"line\">-r ：sed 的动作支持的是延伸型正规表示法的语法。(默认是基础正规表示法语法) -i ：直接修改读取的文件内容，而不是输出到终端   </span><br><span class=\"line\"> w 表示把行写入一个文件。</span><br><span class=\"line\"> x 表示互换模板块中的文本和缓冲区中的文本。</span><br><span class=\"line\"> y 表示把一个字符翻译为另外的字符（但是不用于正则表达式）</span><br><span class=\"line\"> \\1 子串匹配标记 </span><br><span class=\"line\">&amp; 已匹配字符串标记元字符集</span><br><span class=\"line\">^ 匹配行开始，如：/^sed/匹配所有以sed开头的行。 </span><br><span class=\"line\">$ 匹配行结束，如：/sed$/匹配所有以sed结尾的行。</span><br><span class=\"line\"> . 匹配一个非换行符的任意字符，如：/s.d/匹配s后接一个任意字符，最后是d。</span><br><span class=\"line\"> * 匹配0个或多个字符，如：/*sed/匹配所有模板是一个或多个空格后紧跟sed的行。</span><br><span class=\"line\"> [] 匹配一个指定范围内的字符，如/[ss]ed/匹配sed和Sed。</span><br><span class=\"line\"> [^] 匹配一个不在指定范围内的字符，如：/[^A-RT-Z]ed/匹配不包含A-R和T-Z的一个字母开头，紧跟ed的行。</span><br><span class=\"line\"> \\(..\\) 匹配子串，保存匹配的字符，如s/\\(love\\)able/\\1rs，loveable被替换成lovers。</span><br><span class=\"line\"> &amp; 保存搜索字符用来替换其他字符，如s/love/**&amp;**/，love这成**love**。</span><br><span class=\"line\"> \\&lt; 匹配单词的开始，如:/\\ 匹配单词的结束，如/love\\&gt;/匹配包含以love结尾的单词的行。</span><br><span class=\"line\"> x\\&#123;m\\&#125; 重复字符x，m次，如：/0\\&#123;5\\&#125;/匹配包含5个0的行。</span><br><span class=\"line\"> x\\&#123;m,\\&#125; 重复字符x，至少m次，如：/0\\&#123;5,\\&#125;/匹配至少有5个0的行。</span><br><span class=\"line\"> x\\&#123;m,n\\&#125; 重复字符x，至少m次，不多于n次，如：/0\\&#123;5,10\\&#125;/匹配5~10个0的行。</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"批量替换\"><a href=\"#批量替换\" class=\"headerlink\" title=\"批量替换\"></a>批量替换</h3><p>把目录下所有格式文件内容进行批量替换</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -n &quot;s#$src#$dest#g&quot;p `grep $src -rl --include=\\*.&#123;yaml,md&#125; $path`</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>扫描path路径对应格式的文件,把src替换成dest,</p>\n</blockquote>\n<blockquote>\n<p><strong>sed</strong> </p>\n<p>-n p  结合打印改变内容,不执行变更</p>\n<p><strong>grep</strong></p>\n<p>-r 表示查找当前目录以及所有子目录</p>\n<p>-l 表示仅列出符合条件的文件名</p>\n<p>–include&#x3D;”*.[ch]” 表示仅查找.c、.h文件</p>\n<p>上面不适用大多数情况,推荐下面</p>\n<p>–include&#x3D;*.{yaml,md}</p>\n</blockquote>\n<span id=\"more\"></span>\n\n<p>​           </p>\n<p>样本1 test.txt   (cat -n 显示行号)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">111111111 </span><br><span class=\"line\">222222222   </span><br></pre></td></tr></table></figure>\n\n<h4 id=\"a-追加\"><a href=\"#a-追加\" class=\"headerlink\" title=\"**a\\ ** 追加\"></a>**a\\ ** 追加</h4><p>在当前行下面插入文本。  append  追加</p>\n<p>N;2a  指定第二行后追加append</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ sed -i &#x27;N;2a这是a&#x27; test.txt </span><br><span class=\"line\">cs@debian:~/～$ cat -n test.txt    </span><br><span class=\"line\">1\t11111111    </span><br><span class=\"line\">2\t22222222    </span><br><span class=\"line\">3\t这是a      </span><br></pre></td></tr></table></figure>\n\n<p>​        </p>\n<p>&#x2F;匹配&#x2F;  不确定行数 a\\ <strong>反斜杠可以不要</strong> a</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ sed -i &quot;/这是a/a\\匹配追加&quot; test.txt </span><br><span class=\"line\">cs@debian:~/～$ cat -n test.txt    </span><br><span class=\"line\">1\t这是i    </span><br><span class=\"line\">2\t11111111    </span><br><span class=\"line\">3\t22222222    </span><br><span class=\"line\">4\t这是a    </span><br><span class=\"line\">5  匹配追加      </span><br></pre></td></tr></table></figure>\n\n<p>​        </p>\n<h4 id=\"i-插入\"><a href=\"#i-插入\" class=\"headerlink\" title=\"**i\\ **  插入\"></a>**i\\ **  插入</h4><p>在当前行上面插入文本。 insert 插入</p>\n<p> N;2i 指定第二行前插入insert  ‘N;2i\\这是i’ （\\省略）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ sed -i &#x27;N;2i这是i&#x27; test.txt</span><br><span class=\"line\">cs@debian:~/～$ cat -n test.txt    </span><br><span class=\"line\">1\t这是i    </span><br><span class=\"line\">2\t11111111    </span><br><span class=\"line\">3\t22222222    </span><br></pre></td></tr></table></figure>\n\n<p>​          </p>\n<p>&#x2F;匹配&#x2F;  不确定行数</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ sed -i &quot;/这是i/i\\匹配插入&quot; test.txt </span><br><span class=\"line\">cs@debian:~/～$ cat -n test.txt    </span><br><span class=\"line\">1\t匹配插入    </span><br><span class=\"line\">2\t这是i    </span><br><span class=\"line\">3\t11111111    </span><br><span class=\"line\">4\t22222222    </span><br><span class=\"line\">5\t这是a      </span><br></pre></td></tr></table></figure>\n\n<p>​        </p>\n<p>匹配多个—》 批量插入</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ sed -i &quot;/这是/i\\匹配多个&quot; test.txt </span><br><span class=\"line\">cs@debian:~/～$ cat -n test.txt    </span><br><span class=\"line\">1\t匹配多个    </span><br><span class=\"line\">2\t这是i    </span><br><span class=\"line\">3\t11111111    </span><br><span class=\"line\">4\t22222222    </span><br><span class=\"line\">5\t匹配多个    </span><br><span class=\"line\">6\t这是a   </span><br></pre></td></tr></table></figure>\n\n<p>​           </p>\n<p> c\\ 把选定的行改为新的文本。 </p>\n<h4 id=\"d-删除\"><a href=\"#d-删除\" class=\"headerlink\" title=\"d 删除\"></a>d 删除</h4><p>删除选择的行。</p>\n<p>确定行数</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$  sed &#x27;2,5d&#x27; test.txt</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>#2-5行删除  </p>\n<p> ‘2d’ 第2行</p>\n<p>  ‘10,$d’ 10到最后一行</p>\n</blockquote>\n<p>​             </p>\n<p>匹配删除 删除匹配下一行  d删除 p打印  #加 -i 直接修改 </p>\n<p>样本2</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ cat -n test.txt     </span><br><span class=\"line\">1\t11111111     </span><br><span class=\"line\">2\t这是i     </span><br><span class=\"line\">3\t22222222     </span><br><span class=\"line\">4\t这是a     </span><br><span class=\"line\">5\t33333333             </span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"n-N-p\"><a href=\"#n-N-p\" class=\"headerlink\" title=\"n N p\"></a>n N p</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ sed &#x27;/这是i/&#123;n;d;p&#125;&#x27; test.txt</span><br><span class=\"line\">11111111     </span><br><span class=\"line\">这是i     </span><br><span class=\"line\">这是a     </span><br><span class=\"line\">33333333</span><br><span class=\"line\">cs@debian:~/～$ sed &#x27;/这是i/&#123;N;d;p&#125;&#x27; test.txt </span><br><span class=\"line\">11111111     </span><br><span class=\"line\">这是a     </span><br><span class=\"line\">33333333</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>n匹配下一行  </p>\n<p>N匹配当前行和下一行</p>\n</blockquote>\n<p>n命令–&gt;移动到匹配行的下一行  {n;操作;}</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed -i &#x27;/^ZOOKEEPER_PREFIX/&#123;n;s#$#JAVA_HOME=/opt/jdk/jdk-11.0.12#;&#125;&#x27; ./zkEnv.sh</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>ZOOKEEPER_PREFIX&#x3D;”${ZOOBINDIR}&#x2F;..”</p>\n<p>JAVA_HOME&#x3D;&#x2F;opt&#x2F;jdk&#x2F;jdk-11.0.12</p>\n<p>#check to see if the conf dir is given as an optional argument</p>\n</blockquote>\n<p>上一行 (提供多的特征匹配)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -n &#x27;/^if.*JAVA_HOME/i\\JAVA_HOME=/opt/jdk/jdk-11.0.12&#x27; ./zkEnv.sh </span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>JAVA_HOME&#x3D;&#x2F;opt&#x2F;jdk&#x2F;jdk-11.0.12</p>\n<p>if [[ -n “$JAVA_HOME” ]] &amp;&amp; [[ -x “$JAVA_HOME&#x2F;bin&#x2F;java” ]];  then</p>\n<p>​    JAVA&#x3D;”$JAVA_HOME&#x2F;bin&#x2F;java”</p>\n<p>elif type -p java; then</p>\n</blockquote>\n<p> N 将下一行读入并附加到当前行后面放到当前空间模式</p>\n<p> 最后一行结束</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ echo -e &quot;11111\\n2222222\\n3333&quot; | sed &#x27;N;p&#x27;</span><br><span class=\"line\">11111</span><br><span class=\"line\">2222222</span><br><span class=\"line\">11111</span><br><span class=\"line\">2222222</span><br><span class=\"line\">333</span><br></pre></td></tr></table></figure>\n\n\n\n<p> P模式空间第一行 N再次执行就到了3 ，隔行  </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ echo -e &quot;11111\\n2222222\\n3333\\n44\\n55\\n6&quot; | sed &#x27;N;P&#x27;</span><br><span class=\"line\">1111111111</span><br><span class=\"line\">2222222</span><br><span class=\"line\">33333333</span><br><span class=\"line\">44</span><br><span class=\"line\">5555</span><br><span class=\"line\">6</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ cat /etc/hosts</span><br><span class=\"line\">127.0.0.1\tlocalhost</span><br><span class=\"line\">192.168.56.1  master01 ui.k8s.cn k8s.org jenkins.k8s.cn  gogs.k8s.cn</span><br><span class=\"line\">192.168.56.101  node01</span><br><span class=\"line\">192.168.56.108  node02 </span><br><span class=\"line\">cs@debian:/ip$ ip=192.168.56.108</span><br><span class=\"line\">cs@debian:/ip$ cat hosts | sed -e  &quot;s/^\\($&#123;ip&#125;\\)\\([[:space:]]*\\)\\(.*\\)/\\3/g&quot; p</span><br><span class=\"line\">node01</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/ip$ ip=node02</span><br><span class=\"line\">cs@debian:/ip$ cat hosts | sed -n &quot;s/\\(.*\\)\\([[:space:]]*\\)\\($&#123;ip&#125;\\)/\\1/g&quot;p</span><br><span class=\"line\">192.168.56.108  </span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zookeeper.connect=localhost:2181</span><br><span class=\"line\"> cat ./config/server.properties | sed -n &#x27;s/^zookeeper\\.connect=\\(.*\\)/\\1/&#x27;p</span><br><span class=\"line\">localhost:2181</span><br><span class=\"line\">cat ./config/server.properties | sed -n &quot;s#^listeners=PLAINTEXT://\\(.*\\)#\\1#&quot;p</span><br><span class=\"line\">127.0.0.1:9092</span><br></pre></td></tr></table></figure>\n\n\n\n<p>​         </p>\n<h4 id=\"D\"><a href=\"#D\" class=\"headerlink\" title=\"D\"></a>D</h4><p> 删除模板块的第一行。</p>\n<h4 id=\"s-替换\"><a href=\"#s-替换\" class=\"headerlink\" title=\"s 替换\"></a>s 替换</h4><p>s&#x2F;指定字符&#x2F;替换字符&#x2F;</p>\n<p>relative&#x2F;directory&#x2F;  改为&#x2F;etc&#x2F;supervisor.conf.d&#x2F;</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ sed -n   &#x27;s/relative\\/directory\\//\\/etc\\/supervisor.conf.d\\//&#x27;p /etc/supervisord.conf</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>-n选项和p命令一起使用表示只打印发生替换的行</p>\n</blockquote>\n<p> 防火墙关闭</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat /etc/selinux/config | grep ^SELINUX= | sed  &#x27;s/^SELINUX=.*/SELINUX=disabled/&#x27;</span><br><span class=\"line\">sed -i &#x27;/SELINUX/s/enforcing/disabled/&#x27; /etc/selinux/config</span><br></pre></td></tr></table></figure>\n\n\n\n<p>替换整行</p>\n  <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$  sed  -i  &#x27;2s/^.*$/xxxxx/&#x27;  file  </span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h4 id=\"截取\"><a href=\"#截取\" class=\"headerlink\" title=\"截取\"></a>截取</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ echo &quot;tinkle-app-style-0.0.1-SNAPSHOT.jar&quot; | sed &#x27;s/\\([a-z]-*\\)-[0-9].*/\\1/&#x27;</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$  echo &quot;abcdef-shea-df&quot; | sed &#x27;s/\\(.*\\)-\\(.*\\)-\\(.*\\)/\\2/g&#x27;</span><br><span class=\"line\">命令解释</span><br><span class=\"line\">\\(.*\\)- : 表示第一个引号前的内容</span><br><span class=\"line\">-\\(.*\\)-：表示两引号之间的内容</span><br><span class=\"line\">-\\(.*\\)：表示引号后的内容</span><br><span class=\"line\">\\2: 表示第二对括号里面的内容</span><br><span class=\"line\">括号里的表达式匹配的内容，可以用\\1，\\2等进行引用，第n个括号对内的内容，就用\\n引用。</span><br><span class=\"line\">这个命令的意思是：</span><br><span class=\"line\">用\\2代表的第二个括号的内容（shea）去替换整个字符串，这样就得到了我们所需要的子字符串了。</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ echo &quot;etch-master.sh&quot; | sed &#x27;s/\\(.*\\)-\\(.*\\)\\.\\(.*\\)/\\2/g&#x27;</span><br><span class=\"line\">master</span><br><span class=\"line\">cs@debian:~$ echo &quot;gen-flanneld.sh&quot; | sed &#x27;s/^gen-\\(.*\\)\\..*/\\1/g&#x27;</span><br><span class=\"line\">flanneld</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ systemctl status flanneld.service</span><br><span class=\"line\">● flanneld.service - Flanneld overlay address etcd agent</span><br><span class=\"line\">   Loaded: loaded (/opt/kubernetes/flanneld/flanneld.service; disabled; vendor p</span><br><span class=\"line\">   Active: inactive (dead)</span><br><span class=\"line\">cs@debian:~$ systemctl status flanneld.service | grep Active: | sed &#x27;s/.*(\\([a-z]*\\)).*/\\1/g&#x27;</span><br><span class=\"line\">dead</span><br><span class=\"line\">cs@debian:~$ systemctl status nginx | grep Active | sed &#x27;s/.*(\\(.*\\)).*/\\1/g&#x27;</span><br><span class=\"line\">running</span><br><span class=\"line\">cs@debian:~$ systemctl status kube-scheduler  |  sed -n &#x27;s/.*ctive:.*(\\(.*\\)).*/\\1/g&#x27;p</span><br><span class=\"line\">dead</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"标记跳转\"><a href=\"#标记跳转\" class=\"headerlink\" title=\"标记跳转\"></a>标记跳转</h3><p>删除前一行  (:a  ;ta) a标记，ta执行成功在跳转，类似循环</p>\n   <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ sed -e :a -e &#x27;$!N;s/.*\\n\\(.*是.*\\)/\\1/;ta&#x27; -e &#x27;P;D&#x27;  test.txt</span><br><span class=\"line\">这是i</span><br><span class=\"line\">这是a</span><br><span class=\"line\">33333333 </span><br></pre></td></tr></table></figure>\n\n\n\n<p>前置 s&#x2F;正则&#x2F;\\1&#x2F;    $最后一行 ！不进行 </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ sed -e   &#x27;$!N;s/.*\\n\\(.*是i\\)/\\1/&#x27; -e &#x27;p;d&#x27;  test.txt</span><br><span class=\"line\">这是i</span><br><span class=\"line\">22222222</span><br><span class=\"line\">这是a</span><br><span class=\"line\">33333333</span><br><span class=\"line\">cs@debian:~/～$ sed -e   &#x27;$!N;s/.*\\n\\(.*是i\\)/\\1/&#x27; -e &#x27;P;D&#x27;  test.txt</span><br><span class=\"line\">这是i</span><br><span class=\"line\">22222222</span><br><span class=\"line\">这是a</span><br><span class=\"line\">33333333</span><br><span class=\"line\">cs@debian:~/～$ sed -e :a -e &#x27;$!N;s/.*\\n\\(.*是.*\\)/\\1/;ta&#x27; -e &#x27;P;D&#x27;  test.txt</span><br><span class=\"line\">这是i</span><br><span class=\"line\">这是a</span><br><span class=\"line\">33333333</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>test</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">3d5f</span><br><span class=\"line\">&lt;Proxy&gt;</span><br><span class=\"line\">这是i</span><br><span class=\"line\">&lt;P&gt;</span><br><span class=\"line\">22222222</span><br><span class=\"line\">&lt;/Proxy&gt;</span><br><span class=\"line\">abcde</span><br></pre></td></tr></table></figure>\n\n<p>替换Proxy 标签中间部分</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed &#x27;/&lt;P/&#123;:a;N;/&lt;\\//!ba;s/&gt;[^&lt;].*&lt;/&gt;\\n替换你们\\n&lt;/&#125;&#x27;  test</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;p  :a;N;/&lt;\\//!ba</span><br><span class=\"line\">匹配&lt;Proxy  :a标记  &lt;/ 结束匹配标记  !b （匹配不了，执行下句命令）</span><br><span class=\"line\"><span class=\"meta prompt_\">s/&gt;</span><span class=\"language-bash\">[^&lt;]*&lt;/&gt;\\n1234567\\n&lt;/</span></span><br><span class=\"line\"><span class=\"meta prompt_\">&gt;</span><span class=\"language-bash\">把中间内容&lt;  替换指定内容</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n<h3 id=\"注释\"><a href=\"#注释\" class=\"headerlink\" title=\"注释\"></a>注释</h3><p>join.yaml</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#kind: JoinConfiguration</span><br><span class=\"line\"></span><br><span class=\"line\">nodeRegistration:</span><br><span class=\"line\">  name: debian  #节点名,master要能解析</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"添加\"><a href=\"#添加\" class=\"headerlink\" title=\"添加\"></a>添加</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -n &#x27;/debian/s/^/#/&#x27;p ./join.yaml</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>#  name: debian  #节点名,master要能解析</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -n &#x27;s/debian/#&amp;/&#x27;p ./join.yaml</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> name: #debian  #节点名,master要能解析</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ cat /etc/fstab | grep swap | sed &#x27;/swap/s/^/#/&#x27; </span><br><span class=\"line\">## swap was on /dev/sda5 during installation</span><br><span class=\"line\">##UUID=0fd6cee8-fdfa-459b-a7c6-1898ea2ade8e none            swap    sw              0       0</span><br><span class=\"line\">[vagrant@master03 ~]$ cat /etc/fstab | grep swap | sed &#x27;/swap/s/^/#/&#x27; </span><br><span class=\"line\">##/swapfile none swap defaults 0 0</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i &#x27;/匹配字符串/,+4 s/^/#/&#x27; 文件名   #匹配行和下面4行</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>+4表示匹配行和下面4行，一共5行注释</p>\n</blockquote>\n<h4 id=\"删除\"><a href=\"#删除\" class=\"headerlink\" title=\"删除\"></a>删除</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#去掉所有行注释</span><br><span class=\"line\">sed -n &#x27;/^#.*$/s/^#//&#x27;p ./join.yaml</span><br><span class=\"line\">#去匹配行注释</span><br><span class=\"line\">sed -n &#x27;/^#.*debian.*$/s/^#//&#x27;p ./join.yaml</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> name: debian  #节点名,master要能解析</p>\n</blockquote>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed &#x27;s/^#.*\\(en_US.UTF-8\\)/\\1/&#x27; test</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#去注释行</span><br><span class=\"line\">sed -i &#x27;/^#/d&#x27; ./join.yaml</span><br><span class=\"line\">#去空行和注释行</span><br><span class=\"line\">sed -i &#x27;/^$/d;/^#/&#x27; ./join.yaml</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i &#x27;/匹配字符串/,+4 s/^#*//&#x27; 文件名</span><br><span class=\"line\"></span><br><span class=\"line\">[vagrant@node06 ~]$ grep &#x27;HOME&#x27;  /etc/profile</span><br><span class=\"line\">export JAVA_HOME=/opt/mq/jre</span><br><span class=\"line\">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib</span><br><span class=\"line\">export PATH=$&#123;JAVA_HOME&#125;/bin:$PATH</span><br><span class=\"line\"># echo $(sed -n  &#x27;/export\\ JAVA_HOME/,+2 s/export/#/&#x27;p /etc/profile)</span><br><span class=\"line\"># sed -i &#x27;/export\\ JAVA_HOME/,+2 s/export/#/&#x27; /etc/profile</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h3 id=\"参数\"><a href=\"#参数\" class=\"headerlink\" title=\"参数\"></a>参数</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed [options] &#x27;command&#x27; file(s) </span><br><span class=\"line\"></span><br><span class=\"line\">sed [options] -f scriptfile file(s)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">g 表示行内全面替换。     global 全局   </span><br><span class=\"line\">p 表示打印行。 P 打印模板第一行</span><br><span class=\"line\">r 读文件</span><br><span class=\"line\">-n ：使用安静(silent)模式。在一般 sed 的用法中，所有来自 STDIN 的数据一般都会被列出到终端上。但如果加上 -n 参数后，则只有经过sed 特殊处理的那一行(或者动作)才会被列出来。 </span><br><span class=\"line\">-e ：直接在命令列模式上进行 sed 的动作编辑； </span><br><span class=\"line\">-f ：直接将 sed 的动作写在一个文件内， -f filename 则可以运行 filename 内的 sed 动作；</span><br><span class=\"line\">-r ：sed 的动作支持的是延伸型正规表示法的语法。(默认是基础正规表示法语法) -i ：直接修改读取的文件内容，而不是输出到终端   </span><br><span class=\"line\"> w 表示把行写入一个文件。</span><br><span class=\"line\"> x 表示互换模板块中的文本和缓冲区中的文本。</span><br><span class=\"line\"> y 表示把一个字符翻译为另外的字符（但是不用于正则表达式）</span><br><span class=\"line\"> \\1 子串匹配标记 </span><br><span class=\"line\">&amp; 已匹配字符串标记元字符集</span><br><span class=\"line\">^ 匹配行开始，如：/^sed/匹配所有以sed开头的行。 </span><br><span class=\"line\">$ 匹配行结束，如：/sed$/匹配所有以sed结尾的行。</span><br><span class=\"line\"> . 匹配一个非换行符的任意字符，如：/s.d/匹配s后接一个任意字符，最后是d。</span><br><span class=\"line\"> * 匹配0个或多个字符，如：/*sed/匹配所有模板是一个或多个空格后紧跟sed的行。</span><br><span class=\"line\"> [] 匹配一个指定范围内的字符，如/[ss]ed/匹配sed和Sed。</span><br><span class=\"line\"> [^] 匹配一个不在指定范围内的字符，如：/[^A-RT-Z]ed/匹配不包含A-R和T-Z的一个字母开头，紧跟ed的行。</span><br><span class=\"line\"> \\(..\\) 匹配子串，保存匹配的字符，如s/\\(love\\)able/\\1rs，loveable被替换成lovers。</span><br><span class=\"line\"> &amp; 保存搜索字符用来替换其他字符，如s/love/**&amp;**/，love这成**love**。</span><br><span class=\"line\"> \\&lt; 匹配单词的开始，如:/\\ 匹配单词的结束，如/love\\&gt;/匹配包含以love结尾的单词的行。</span><br><span class=\"line\"> x\\&#123;m\\&#125; 重复字符x，m次，如：/0\\&#123;5\\&#125;/匹配包含5个0的行。</span><br><span class=\"line\"> x\\&#123;m,\\&#125; 重复字符x，至少m次，如：/0\\&#123;5,\\&#125;/匹配至少有5个0的行。</span><br><span class=\"line\"> x\\&#123;m,n\\&#125; 重复字符x，至少m次，不多于n次，如：/0\\&#123;5,10\\&#125;/匹配5~10个0的行。</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"批量替换\"><a href=\"#批量替换\" class=\"headerlink\" title=\"批量替换\"></a>批量替换</h3><p>把目录下所有格式文件内容进行批量替换</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -n &quot;s#$src#$dest#g&quot;p `grep $src -rl --include=\\*.&#123;yaml,md&#125; $path`</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>扫描path路径对应格式的文件,把src替换成dest,</p>\n</blockquote>\n<blockquote>\n<p><strong>sed</strong> </p>\n<p>-n p  结合打印改变内容,不执行变更</p>\n<p><strong>grep</strong></p>\n<p>-r 表示查找当前目录以及所有子目录</p>\n<p>-l 表示仅列出符合条件的文件名</p>\n<p>–include&#x3D;”*.[ch]” 表示仅查找.c、.h文件</p>\n<p>上面不适用大多数情况,推荐下面</p>\n<p>–include&#x3D;*.{yaml,md}</p>\n</blockquote>","more":"<p>​           </p>\n<p>样本1 test.txt   (cat -n 显示行号)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">111111111 </span><br><span class=\"line\">222222222   </span><br></pre></td></tr></table></figure>\n\n<h4 id=\"a-追加\"><a href=\"#a-追加\" class=\"headerlink\" title=\"**a\\ ** 追加\"></a>**a\\ ** 追加</h4><p>在当前行下面插入文本。  append  追加</p>\n<p>N;2a  指定第二行后追加append</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ sed -i &#x27;N;2a这是a&#x27; test.txt </span><br><span class=\"line\">cs@debian:~/～$ cat -n test.txt    </span><br><span class=\"line\">1\t11111111    </span><br><span class=\"line\">2\t22222222    </span><br><span class=\"line\">3\t这是a      </span><br></pre></td></tr></table></figure>\n\n<p>​        </p>\n<p>&#x2F;匹配&#x2F;  不确定行数 a\\ <strong>反斜杠可以不要</strong> a</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ sed -i &quot;/这是a/a\\匹配追加&quot; test.txt </span><br><span class=\"line\">cs@debian:~/～$ cat -n test.txt    </span><br><span class=\"line\">1\t这是i    </span><br><span class=\"line\">2\t11111111    </span><br><span class=\"line\">3\t22222222    </span><br><span class=\"line\">4\t这是a    </span><br><span class=\"line\">5  匹配追加      </span><br></pre></td></tr></table></figure>\n\n<p>​        </p>\n<h4 id=\"i-插入\"><a href=\"#i-插入\" class=\"headerlink\" title=\"**i\\ **  插入\"></a>**i\\ **  插入</h4><p>在当前行上面插入文本。 insert 插入</p>\n<p> N;2i 指定第二行前插入insert  ‘N;2i\\这是i’ （\\省略）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ sed -i &#x27;N;2i这是i&#x27; test.txt</span><br><span class=\"line\">cs@debian:~/～$ cat -n test.txt    </span><br><span class=\"line\">1\t这是i    </span><br><span class=\"line\">2\t11111111    </span><br><span class=\"line\">3\t22222222    </span><br></pre></td></tr></table></figure>\n\n<p>​          </p>\n<p>&#x2F;匹配&#x2F;  不确定行数</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ sed -i &quot;/这是i/i\\匹配插入&quot; test.txt </span><br><span class=\"line\">cs@debian:~/～$ cat -n test.txt    </span><br><span class=\"line\">1\t匹配插入    </span><br><span class=\"line\">2\t这是i    </span><br><span class=\"line\">3\t11111111    </span><br><span class=\"line\">4\t22222222    </span><br><span class=\"line\">5\t这是a      </span><br></pre></td></tr></table></figure>\n\n<p>​        </p>\n<p>匹配多个—》 批量插入</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ sed -i &quot;/这是/i\\匹配多个&quot; test.txt </span><br><span class=\"line\">cs@debian:~/～$ cat -n test.txt    </span><br><span class=\"line\">1\t匹配多个    </span><br><span class=\"line\">2\t这是i    </span><br><span class=\"line\">3\t11111111    </span><br><span class=\"line\">4\t22222222    </span><br><span class=\"line\">5\t匹配多个    </span><br><span class=\"line\">6\t这是a   </span><br></pre></td></tr></table></figure>\n\n<p>​           </p>\n<p> c\\ 把选定的行改为新的文本。 </p>\n<h4 id=\"d-删除\"><a href=\"#d-删除\" class=\"headerlink\" title=\"d 删除\"></a>d 删除</h4><p>删除选择的行。</p>\n<p>确定行数</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$  sed &#x27;2,5d&#x27; test.txt</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>#2-5行删除  </p>\n<p> ‘2d’ 第2行</p>\n<p>  ‘10,$d’ 10到最后一行</p>\n</blockquote>\n<p>​             </p>\n<p>匹配删除 删除匹配下一行  d删除 p打印  #加 -i 直接修改 </p>\n<p>样本2</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ cat -n test.txt     </span><br><span class=\"line\">1\t11111111     </span><br><span class=\"line\">2\t这是i     </span><br><span class=\"line\">3\t22222222     </span><br><span class=\"line\">4\t这是a     </span><br><span class=\"line\">5\t33333333             </span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"n-N-p\"><a href=\"#n-N-p\" class=\"headerlink\" title=\"n N p\"></a>n N p</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ sed &#x27;/这是i/&#123;n;d;p&#125;&#x27; test.txt</span><br><span class=\"line\">11111111     </span><br><span class=\"line\">这是i     </span><br><span class=\"line\">这是a     </span><br><span class=\"line\">33333333</span><br><span class=\"line\">cs@debian:~/～$ sed &#x27;/这是i/&#123;N;d;p&#125;&#x27; test.txt </span><br><span class=\"line\">11111111     </span><br><span class=\"line\">这是a     </span><br><span class=\"line\">33333333</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>n匹配下一行  </p>\n<p>N匹配当前行和下一行</p>\n</blockquote>\n<p>n命令–&gt;移动到匹配行的下一行  {n;操作;}</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed -i &#x27;/^ZOOKEEPER_PREFIX/&#123;n;s#$#JAVA_HOME=/opt/jdk/jdk-11.0.12#;&#125;&#x27; ./zkEnv.sh</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>ZOOKEEPER_PREFIX&#x3D;”${ZOOBINDIR}&#x2F;..”</p>\n<p>JAVA_HOME&#x3D;&#x2F;opt&#x2F;jdk&#x2F;jdk-11.0.12</p>\n<p>#check to see if the conf dir is given as an optional argument</p>\n</blockquote>\n<p>上一行 (提供多的特征匹配)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -n &#x27;/^if.*JAVA_HOME/i\\JAVA_HOME=/opt/jdk/jdk-11.0.12&#x27; ./zkEnv.sh </span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>JAVA_HOME&#x3D;&#x2F;opt&#x2F;jdk&#x2F;jdk-11.0.12</p>\n<p>if [[ -n “$JAVA_HOME” ]] &amp;&amp; [[ -x “$JAVA_HOME&#x2F;bin&#x2F;java” ]];  then</p>\n<p>​    JAVA&#x3D;”$JAVA_HOME&#x2F;bin&#x2F;java”</p>\n<p>elif type -p java; then</p>\n</blockquote>\n<p> N 将下一行读入并附加到当前行后面放到当前空间模式</p>\n<p> 最后一行结束</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ echo -e &quot;11111\\n2222222\\n3333&quot; | sed &#x27;N;p&#x27;</span><br><span class=\"line\">11111</span><br><span class=\"line\">2222222</span><br><span class=\"line\">11111</span><br><span class=\"line\">2222222</span><br><span class=\"line\">333</span><br></pre></td></tr></table></figure>\n\n\n\n<p> P模式空间第一行 N再次执行就到了3 ，隔行  </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ echo -e &quot;11111\\n2222222\\n3333\\n44\\n55\\n6&quot; | sed &#x27;N;P&#x27;</span><br><span class=\"line\">1111111111</span><br><span class=\"line\">2222222</span><br><span class=\"line\">33333333</span><br><span class=\"line\">44</span><br><span class=\"line\">5555</span><br><span class=\"line\">6</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ cat /etc/hosts</span><br><span class=\"line\">127.0.0.1\tlocalhost</span><br><span class=\"line\">192.168.56.1  master01 ui.k8s.cn k8s.org jenkins.k8s.cn  gogs.k8s.cn</span><br><span class=\"line\">192.168.56.101  node01</span><br><span class=\"line\">192.168.56.108  node02 </span><br><span class=\"line\">cs@debian:/ip$ ip=192.168.56.108</span><br><span class=\"line\">cs@debian:/ip$ cat hosts | sed -e  &quot;s/^\\($&#123;ip&#125;\\)\\([[:space:]]*\\)\\(.*\\)/\\3/g&quot; p</span><br><span class=\"line\">node01</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/ip$ ip=node02</span><br><span class=\"line\">cs@debian:/ip$ cat hosts | sed -n &quot;s/\\(.*\\)\\([[:space:]]*\\)\\($&#123;ip&#125;\\)/\\1/g&quot;p</span><br><span class=\"line\">192.168.56.108  </span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zookeeper.connect=localhost:2181</span><br><span class=\"line\"> cat ./config/server.properties | sed -n &#x27;s/^zookeeper\\.connect=\\(.*\\)/\\1/&#x27;p</span><br><span class=\"line\">localhost:2181</span><br><span class=\"line\">cat ./config/server.properties | sed -n &quot;s#^listeners=PLAINTEXT://\\(.*\\)#\\1#&quot;p</span><br><span class=\"line\">127.0.0.1:9092</span><br></pre></td></tr></table></figure>\n\n\n\n<p>​         </p>\n<h4 id=\"D\"><a href=\"#D\" class=\"headerlink\" title=\"D\"></a>D</h4><p> 删除模板块的第一行。</p>\n<h4 id=\"s-替换\"><a href=\"#s-替换\" class=\"headerlink\" title=\"s 替换\"></a>s 替换</h4><p>s&#x2F;指定字符&#x2F;替换字符&#x2F;</p>\n<p>relative&#x2F;directory&#x2F;  改为&#x2F;etc&#x2F;supervisor.conf.d&#x2F;</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ sed -n   &#x27;s/relative\\/directory\\//\\/etc\\/supervisor.conf.d\\//&#x27;p /etc/supervisord.conf</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>-n选项和p命令一起使用表示只打印发生替换的行</p>\n</blockquote>\n<p> 防火墙关闭</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat /etc/selinux/config | grep ^SELINUX= | sed  &#x27;s/^SELINUX=.*/SELINUX=disabled/&#x27;</span><br><span class=\"line\">sed -i &#x27;/SELINUX/s/enforcing/disabled/&#x27; /etc/selinux/config</span><br></pre></td></tr></table></figure>\n\n\n\n<p>替换整行</p>\n  <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$  sed  -i  &#x27;2s/^.*$/xxxxx/&#x27;  file  </span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h4 id=\"截取\"><a href=\"#截取\" class=\"headerlink\" title=\"截取\"></a>截取</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ echo &quot;tinkle-app-style-0.0.1-SNAPSHOT.jar&quot; | sed &#x27;s/\\([a-z]-*\\)-[0-9].*/\\1/&#x27;</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$  echo &quot;abcdef-shea-df&quot; | sed &#x27;s/\\(.*\\)-\\(.*\\)-\\(.*\\)/\\2/g&#x27;</span><br><span class=\"line\">命令解释</span><br><span class=\"line\">\\(.*\\)- : 表示第一个引号前的内容</span><br><span class=\"line\">-\\(.*\\)-：表示两引号之间的内容</span><br><span class=\"line\">-\\(.*\\)：表示引号后的内容</span><br><span class=\"line\">\\2: 表示第二对括号里面的内容</span><br><span class=\"line\">括号里的表达式匹配的内容，可以用\\1，\\2等进行引用，第n个括号对内的内容，就用\\n引用。</span><br><span class=\"line\">这个命令的意思是：</span><br><span class=\"line\">用\\2代表的第二个括号的内容（shea）去替换整个字符串，这样就得到了我们所需要的子字符串了。</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ echo &quot;etch-master.sh&quot; | sed &#x27;s/\\(.*\\)-\\(.*\\)\\.\\(.*\\)/\\2/g&#x27;</span><br><span class=\"line\">master</span><br><span class=\"line\">cs@debian:~$ echo &quot;gen-flanneld.sh&quot; | sed &#x27;s/^gen-\\(.*\\)\\..*/\\1/g&#x27;</span><br><span class=\"line\">flanneld</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ systemctl status flanneld.service</span><br><span class=\"line\">● flanneld.service - Flanneld overlay address etcd agent</span><br><span class=\"line\">   Loaded: loaded (/opt/kubernetes/flanneld/flanneld.service; disabled; vendor p</span><br><span class=\"line\">   Active: inactive (dead)</span><br><span class=\"line\">cs@debian:~$ systemctl status flanneld.service | grep Active: | sed &#x27;s/.*(\\([a-z]*\\)).*/\\1/g&#x27;</span><br><span class=\"line\">dead</span><br><span class=\"line\">cs@debian:~$ systemctl status nginx | grep Active | sed &#x27;s/.*(\\(.*\\)).*/\\1/g&#x27;</span><br><span class=\"line\">running</span><br><span class=\"line\">cs@debian:~$ systemctl status kube-scheduler  |  sed -n &#x27;s/.*ctive:.*(\\(.*\\)).*/\\1/g&#x27;p</span><br><span class=\"line\">dead</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"标记跳转\"><a href=\"#标记跳转\" class=\"headerlink\" title=\"标记跳转\"></a>标记跳转</h3><p>删除前一行  (:a  ;ta) a标记，ta执行成功在跳转，类似循环</p>\n   <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ sed -e :a -e &#x27;$!N;s/.*\\n\\(.*是.*\\)/\\1/;ta&#x27; -e &#x27;P;D&#x27;  test.txt</span><br><span class=\"line\">这是i</span><br><span class=\"line\">这是a</span><br><span class=\"line\">33333333 </span><br></pre></td></tr></table></figure>\n\n\n\n<p>前置 s&#x2F;正则&#x2F;\\1&#x2F;    $最后一行 ！不进行 </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/～$ sed -e   &#x27;$!N;s/.*\\n\\(.*是i\\)/\\1/&#x27; -e &#x27;p;d&#x27;  test.txt</span><br><span class=\"line\">这是i</span><br><span class=\"line\">22222222</span><br><span class=\"line\">这是a</span><br><span class=\"line\">33333333</span><br><span class=\"line\">cs@debian:~/～$ sed -e   &#x27;$!N;s/.*\\n\\(.*是i\\)/\\1/&#x27; -e &#x27;P;D&#x27;  test.txt</span><br><span class=\"line\">这是i</span><br><span class=\"line\">22222222</span><br><span class=\"line\">这是a</span><br><span class=\"line\">33333333</span><br><span class=\"line\">cs@debian:~/～$ sed -e :a -e &#x27;$!N;s/.*\\n\\(.*是.*\\)/\\1/;ta&#x27; -e &#x27;P;D&#x27;  test.txt</span><br><span class=\"line\">这是i</span><br><span class=\"line\">这是a</span><br><span class=\"line\">33333333</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>test</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">3d5f</span><br><span class=\"line\">&lt;Proxy&gt;</span><br><span class=\"line\">这是i</span><br><span class=\"line\">&lt;P&gt;</span><br><span class=\"line\">22222222</span><br><span class=\"line\">&lt;/Proxy&gt;</span><br><span class=\"line\">abcde</span><br></pre></td></tr></table></figure>\n\n<p>替换Proxy 标签中间部分</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed &#x27;/&lt;P/&#123;:a;N;/&lt;\\//!ba;s/&gt;[^&lt;].*&lt;/&gt;\\n替换你们\\n&lt;/&#125;&#x27;  test</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;p  :a;N;/&lt;\\//!ba</span><br><span class=\"line\">匹配&lt;Proxy  :a标记  &lt;/ 结束匹配标记  !b （匹配不了，执行下句命令）</span><br><span class=\"line\"><span class=\"meta prompt_\">s/&gt;</span><span class=\"language-bash\">[^&lt;]*&lt;/&gt;\\n1234567\\n&lt;/</span></span><br><span class=\"line\"><span class=\"meta prompt_\">&gt;</span><span class=\"language-bash\">把中间内容&lt;  替换指定内容</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n<h3 id=\"注释\"><a href=\"#注释\" class=\"headerlink\" title=\"注释\"></a>注释</h3><p>join.yaml</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#kind: JoinConfiguration</span><br><span class=\"line\"></span><br><span class=\"line\">nodeRegistration:</span><br><span class=\"line\">  name: debian  #节点名,master要能解析</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"添加\"><a href=\"#添加\" class=\"headerlink\" title=\"添加\"></a>添加</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -n &#x27;/debian/s/^/#/&#x27;p ./join.yaml</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>#  name: debian  #节点名,master要能解析</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -n &#x27;s/debian/#&amp;/&#x27;p ./join.yaml</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> name: #debian  #节点名,master要能解析</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~$ cat /etc/fstab | grep swap | sed &#x27;/swap/s/^/#/&#x27; </span><br><span class=\"line\">## swap was on /dev/sda5 during installation</span><br><span class=\"line\">##UUID=0fd6cee8-fdfa-459b-a7c6-1898ea2ade8e none            swap    sw              0       0</span><br><span class=\"line\">[vagrant@master03 ~]$ cat /etc/fstab | grep swap | sed &#x27;/swap/s/^/#/&#x27; </span><br><span class=\"line\">##/swapfile none swap defaults 0 0</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i &#x27;/匹配字符串/,+4 s/^/#/&#x27; 文件名   #匹配行和下面4行</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>+4表示匹配行和下面4行，一共5行注释</p>\n</blockquote>\n<h4 id=\"删除\"><a href=\"#删除\" class=\"headerlink\" title=\"删除\"></a>删除</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#去掉所有行注释</span><br><span class=\"line\">sed -n &#x27;/^#.*$/s/^#//&#x27;p ./join.yaml</span><br><span class=\"line\">#去匹配行注释</span><br><span class=\"line\">sed -n &#x27;/^#.*debian.*$/s/^#//&#x27;p ./join.yaml</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> name: debian  #节点名,master要能解析</p>\n</blockquote>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed &#x27;s/^#.*\\(en_US.UTF-8\\)/\\1/&#x27; test</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#去注释行</span><br><span class=\"line\">sed -i &#x27;/^#/d&#x27; ./join.yaml</span><br><span class=\"line\">#去空行和注释行</span><br><span class=\"line\">sed -i &#x27;/^$/d;/^#/&#x27; ./join.yaml</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i &#x27;/匹配字符串/,+4 s/^#*//&#x27; 文件名</span><br><span class=\"line\"></span><br><span class=\"line\">[vagrant@node06 ~]$ grep &#x27;HOME&#x27;  /etc/profile</span><br><span class=\"line\">export JAVA_HOME=/opt/mq/jre</span><br><span class=\"line\">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib</span><br><span class=\"line\">export PATH=$&#123;JAVA_HOME&#125;/bin:$PATH</span><br><span class=\"line\"># echo $(sed -n  &#x27;/export\\ JAVA_HOME/,+2 s/export/#/&#x27;p /etc/profile)</span><br><span class=\"line\"># sed -i &#x27;/export\\ JAVA_HOME/,+2 s/export/#/&#x27; /etc/profile</span><br></pre></td></tr></table></figure>"},{"title":"top排查服务器","date":"2022-06-12T13:39:53.000Z","_content":"\n\n\ntop -M  \n\ntop -c \n\ntop -p $pid\n\n![](/pics/top-4834.png)\n\n>排序默认从大到小,R反向排序\n>\n>M：根据内存排序\n>\n>P：根据CPU使用排序\n>\n>T：根据使用时间排序\n>\n>\\>：向右移动一列排序\n>\n><:向左移动一列排序\n\n界面shift+m (根据内存排序)\n\n![](/pics/top-M-5210.png)\n\n\n\n### 第一行top\n\n等同命令uptime\n\n```\ncs@debian:~/go$ uptime\n 22:00:22 up  8:59,  1 user,  load average: 0.13, 0.32, 0.36\n```\n\n<!--more-->\n\n>系统当前时间 up 系统到目前为止运行的时间，\n>\n> 当前系统的登陆用户数量，\n>\n>load average后面的三个数字分别表示距离现在一分钟，五分钟，十五分钟的负载情况\n\nload average数据是每隔5秒钟检查一次活跃的进程数，然后按特定算法计算出的数值。如果这个数除以逻辑CPU的数量，结果高于5的时候就表明系统在超负荷运转了\n\n\n\n\n\n\n\n### 第二行 Tasks\n\n```\nTasks: 241 total,   1 running, 240 sleeping,   0 stopped,   0 zombie\n```\n\n>tasks表示任务（进程），214则表示现在有241个进程，\n>\n>running  其中处于运行中的有1个，\n>\n>sleeping  240个在休眠(挂起)，\n>\n>stopped  停止的进程数为0，\n>\n>zombie   僵尸的进程数为0个\n\n\n\n### 第三行%Cpu\n\n```\n%Cpu(s):  3.6 us,  0.6 sy,  0.0 ni, 95.8 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st\n```\n\n>us——用户空间(user)占用cpu的百分比\n>sy——内核空间(system)占用cpu的百分比\n>ni——改变过优先级(niced)的进程占用cpu的百分比\n>id——空闲（idolt）CPU百分比\n>wa——IO等待(wait)占用cpu的百分比\n>hi——IRQ 硬中断(Hardware)占用cpu的百分比\n>si——软中断（software）占用cpu的百分比\n>st——被hypervisor偷去的时间\n\n\n\n### 第四五行 kib内存\n\n```\nKiB Mem : 16257204 total, 12933272 free,  1288736 used,  2035196 buff/cache\nKiB Swap:  7812092 total,  7812092 free,        0 used. 14425716 avail Mem \n```\n\n>Mem：物理内存总量（16G）\n>free: 空闲内存总量(1G)\n>used: 使用中的内存总量\n>buff/cache: 用作内核缓存的内存量\n\n>Swap： 交换区总量\n>free：空闲交换区总量\n>used： 使用的交换区总量\n>avail Mem：表示可用于进程下一次分配的物理内存数量，这个大小一般比free大一点，因为除了free的空间外，系统还能立即释放出一些空间来\n\n\n\n\n\n### 第七行 进程信息区\n\n```\n PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND  \n```\n\n>PID — 进程id\n>USER — 进程所有者\n>PR — 进程优先级\n>NI — nice值。负值表示高优先级，正值表示低优先级\n>VIRT — 进程使用的`虚拟内存`总量，单位kb。VIRT=SWAP+RES\n>RES — `常驻内存`,进程使用的、未被换出的物理内存大小，单位kb。RES=CODE+DATA\n>SHR — `共享内存`大小，单位kb\n>S — 进程状态。D=不可中断的睡眠状态 R=运行 S=睡眠 T=跟踪/停止 Z=僵尸进程\n>%CPU — 上次更新到现在的CPU时间占用百分比\n>%MEM — 进程使用的物理内存百分比\n>TIME+ — 进程使用的CPU时间总计，单位1/100秒\n>COMMAND — 进程名称（命令名/命令行）\n\n\n\n### 其他\n\n```\ncs@debian:~/go$ sudo netstat -anp|grep 12347\ntcp        0      0 0.0.0.0:4000            0.0.0.0:*               LISTEN      12347/hexo \n```\n\n\n\n```\ncs@debian:~/go$ lsof -i:4000\nCOMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME\nhexo    12347   cs   21u  IPv4 324187      0t0  TCP *:4000 (LISTEN)\ncs@debian:~/go$ ps -ef|grep 12347\ncs       12347  1640  0 21:56 pts/2    00:00:03 hexo\ncs       13306  1622  0 22:23 pts/0    00:00:00 grep 12347\n```\n\n\n\n列出所有正在运行的java进程\n\n```\ncs@debian:~/go$ jps\n13600 Jps\n```\n\n>| 参数 | 说明                            |\n>| ---- | ------------------------------- |\n>| `-l` | 输出主类全名或jar路径           |\n>| `-q` | 只输出LVMID                     |\n>| `-m` | 输出JVM启动时传递给main()的参数 |\n>| `-v` | 输出JVM启动时显示指定的JVM参数  |\n\n\n\n\n\n\n","source":"_posts/linux/shell/top.md","raw":"---\ntitle: top排查服务器\npermalink: linux/shell/top/\ntags:\n  - shell\ncategories:\n  - linux\n  - shell\ndate: 2022-06-12 21:39:53\n---\n\n\n\ntop -M  \n\ntop -c \n\ntop -p $pid\n\n![](/pics/top-4834.png)\n\n>排序默认从大到小,R反向排序\n>\n>M：根据内存排序\n>\n>P：根据CPU使用排序\n>\n>T：根据使用时间排序\n>\n>\\>：向右移动一列排序\n>\n><:向左移动一列排序\n\n界面shift+m (根据内存排序)\n\n![](/pics/top-M-5210.png)\n\n\n\n### 第一行top\n\n等同命令uptime\n\n```\ncs@debian:~/go$ uptime\n 22:00:22 up  8:59,  1 user,  load average: 0.13, 0.32, 0.36\n```\n\n<!--more-->\n\n>系统当前时间 up 系统到目前为止运行的时间，\n>\n> 当前系统的登陆用户数量，\n>\n>load average后面的三个数字分别表示距离现在一分钟，五分钟，十五分钟的负载情况\n\nload average数据是每隔5秒钟检查一次活跃的进程数，然后按特定算法计算出的数值。如果这个数除以逻辑CPU的数量，结果高于5的时候就表明系统在超负荷运转了\n\n\n\n\n\n\n\n### 第二行 Tasks\n\n```\nTasks: 241 total,   1 running, 240 sleeping,   0 stopped,   0 zombie\n```\n\n>tasks表示任务（进程），214则表示现在有241个进程，\n>\n>running  其中处于运行中的有1个，\n>\n>sleeping  240个在休眠(挂起)，\n>\n>stopped  停止的进程数为0，\n>\n>zombie   僵尸的进程数为0个\n\n\n\n### 第三行%Cpu\n\n```\n%Cpu(s):  3.6 us,  0.6 sy,  0.0 ni, 95.8 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st\n```\n\n>us——用户空间(user)占用cpu的百分比\n>sy——内核空间(system)占用cpu的百分比\n>ni——改变过优先级(niced)的进程占用cpu的百分比\n>id——空闲（idolt）CPU百分比\n>wa——IO等待(wait)占用cpu的百分比\n>hi——IRQ 硬中断(Hardware)占用cpu的百分比\n>si——软中断（software）占用cpu的百分比\n>st——被hypervisor偷去的时间\n\n\n\n### 第四五行 kib内存\n\n```\nKiB Mem : 16257204 total, 12933272 free,  1288736 used,  2035196 buff/cache\nKiB Swap:  7812092 total,  7812092 free,        0 used. 14425716 avail Mem \n```\n\n>Mem：物理内存总量（16G）\n>free: 空闲内存总量(1G)\n>used: 使用中的内存总量\n>buff/cache: 用作内核缓存的内存量\n\n>Swap： 交换区总量\n>free：空闲交换区总量\n>used： 使用的交换区总量\n>avail Mem：表示可用于进程下一次分配的物理内存数量，这个大小一般比free大一点，因为除了free的空间外，系统还能立即释放出一些空间来\n\n\n\n\n\n### 第七行 进程信息区\n\n```\n PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND  \n```\n\n>PID — 进程id\n>USER — 进程所有者\n>PR — 进程优先级\n>NI — nice值。负值表示高优先级，正值表示低优先级\n>VIRT — 进程使用的`虚拟内存`总量，单位kb。VIRT=SWAP+RES\n>RES — `常驻内存`,进程使用的、未被换出的物理内存大小，单位kb。RES=CODE+DATA\n>SHR — `共享内存`大小，单位kb\n>S — 进程状态。D=不可中断的睡眠状态 R=运行 S=睡眠 T=跟踪/停止 Z=僵尸进程\n>%CPU — 上次更新到现在的CPU时间占用百分比\n>%MEM — 进程使用的物理内存百分比\n>TIME+ — 进程使用的CPU时间总计，单位1/100秒\n>COMMAND — 进程名称（命令名/命令行）\n\n\n\n### 其他\n\n```\ncs@debian:~/go$ sudo netstat -anp|grep 12347\ntcp        0      0 0.0.0.0:4000            0.0.0.0:*               LISTEN      12347/hexo \n```\n\n\n\n```\ncs@debian:~/go$ lsof -i:4000\nCOMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME\nhexo    12347   cs   21u  IPv4 324187      0t0  TCP *:4000 (LISTEN)\ncs@debian:~/go$ ps -ef|grep 12347\ncs       12347  1640  0 21:56 pts/2    00:00:03 hexo\ncs       13306  1622  0 22:23 pts/0    00:00:00 grep 12347\n```\n\n\n\n列出所有正在运行的java进程\n\n```\ncs@debian:~/go$ jps\n13600 Jps\n```\n\n>| 参数 | 说明                            |\n>| ---- | ------------------------------- |\n>| `-l` | 输出主类全名或jar路径           |\n>| `-q` | 只输出LVMID                     |\n>| `-m` | 输出JVM启动时传递给main()的参数 |\n>| `-v` | 输出JVM启动时显示指定的JVM参数  |\n\n\n\n\n\n\n","slug":"linux/shell/top","published":1,"updated":"2022-08-28T09:10:00.948Z","__permalink":"linux/shell/top/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtts003agwi51glv4n0q","content":"<p>top -M  </p>\n<p>top -c </p>\n<p>top -p $pid</p>\n<p><img src=\"/pics/top-4834.png\"></p>\n<blockquote>\n<p>排序默认从大到小,R反向排序</p>\n<p>M：根据内存排序</p>\n<p>P：根据CPU使用排序</p>\n<p>T：根据使用时间排序</p>\n<p>&gt;：向右移动一列排序</p>\n<p>&lt;:向左移动一列排序</p>\n</blockquote>\n<p>界面shift+m (根据内存排序)</p>\n<p><img src=\"/pics/top-M-5210.png\"></p>\n<h3 id=\"第一行top\"><a href=\"#第一行top\" class=\"headerlink\" title=\"第一行top\"></a>第一行top</h3><p>等同命令uptime</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/go$ uptime</span><br><span class=\"line\"> 22:00:22 up  8:59,  1 user,  load average: 0.13, 0.32, 0.36</span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n<blockquote>\n<p>系统当前时间 up 系统到目前为止运行的时间，</p>\n<p>当前系统的登陆用户数量，</p>\n<p>load average后面的三个数字分别表示距离现在一分钟，五分钟，十五分钟的负载情况</p>\n</blockquote>\n<p>load average数据是每隔5秒钟检查一次活跃的进程数，然后按特定算法计算出的数值。如果这个数除以逻辑CPU的数量，结果高于5的时候就表明系统在超负荷运转了</p>\n<h3 id=\"第二行-Tasks\"><a href=\"#第二行-Tasks\" class=\"headerlink\" title=\"第二行 Tasks\"></a>第二行 Tasks</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Tasks: 241 total,   1 running, 240 sleeping,   0 stopped,   0 zombie</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>tasks表示任务（进程），214则表示现在有241个进程，</p>\n<p>running  其中处于运行中的有1个，</p>\n<p>sleeping  240个在休眠(挂起)，</p>\n<p>stopped  停止的进程数为0，</p>\n<p>zombie   僵尸的进程数为0个</p>\n</blockquote>\n<h3 id=\"第三行-Cpu\"><a href=\"#第三行-Cpu\" class=\"headerlink\" title=\"第三行%Cpu\"></a>第三行%Cpu</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">%Cpu(s):  3.6 us,  0.6 sy,  0.0 ni, 95.8 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>us——用户空间(user)占用cpu的百分比<br>sy——内核空间(system)占用cpu的百分比<br>ni——改变过优先级(niced)的进程占用cpu的百分比<br>id——空闲（idolt）CPU百分比<br>wa——IO等待(wait)占用cpu的百分比<br>hi——IRQ 硬中断(Hardware)占用cpu的百分比<br>si——软中断（software）占用cpu的百分比<br>st——被hypervisor偷去的时间</p>\n</blockquote>\n<h3 id=\"第四五行-kib内存\"><a href=\"#第四五行-kib内存\" class=\"headerlink\" title=\"第四五行 kib内存\"></a>第四五行 kib内存</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">KiB Mem : 16257204 total, 12933272 free,  1288736 used,  2035196 buff/cache</span><br><span class=\"line\">KiB Swap:  7812092 total,  7812092 free,        0 used. 14425716 avail Mem </span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Mem：物理内存总量（16G）<br>free: 空闲内存总量(1G)<br>used: 使用中的内存总量<br>buff&#x2F;cache: 用作内核缓存的内存量</p>\n</blockquote>\n<blockquote>\n<p>Swap： 交换区总量<br>free：空闲交换区总量<br>used： 使用的交换区总量<br>avail Mem：表示可用于进程下一次分配的物理内存数量，这个大小一般比free大一点，因为除了free的空间外，系统还能立即释放出一些空间来</p>\n</blockquote>\n<h3 id=\"第七行-进程信息区\"><a href=\"#第七行-进程信息区\" class=\"headerlink\" title=\"第七行 进程信息区\"></a>第七行 进程信息区</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND  </span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>PID — 进程id<br>USER — 进程所有者<br>PR — 进程优先级<br>NI — nice值。负值表示高优先级，正值表示低优先级<br>VIRT — 进程使用的<code>虚拟内存</code>总量，单位kb。VIRT&#x3D;SWAP+RES<br>RES — <code>常驻内存</code>,进程使用的、未被换出的物理内存大小，单位kb。RES&#x3D;CODE+DATA<br>SHR — <code>共享内存</code>大小，单位kb<br>S — 进程状态。D&#x3D;不可中断的睡眠状态 R&#x3D;运行 S&#x3D;睡眠 T&#x3D;跟踪&#x2F;停止 Z&#x3D;僵尸进程<br>%CPU — 上次更新到现在的CPU时间占用百分比<br>%MEM — 进程使用的物理内存百分比<br>TIME+ — 进程使用的CPU时间总计，单位1&#x2F;100秒<br>COMMAND — 进程名称（命令名&#x2F;命令行）</p>\n</blockquote>\n<h3 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/go$ sudo netstat -anp|grep 12347</span><br><span class=\"line\">tcp        0      0 0.0.0.0:4000            0.0.0.0:*               LISTEN      12347/hexo </span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/go$ lsof -i:4000</span><br><span class=\"line\">COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class=\"line\">hexo    12347   cs   21u  IPv4 324187      0t0  TCP *:4000 (LISTEN)</span><br><span class=\"line\">cs@debian:~/go$ ps -ef|grep 12347</span><br><span class=\"line\">cs       12347  1640  0 21:56 pts/2    00:00:03 hexo</span><br><span class=\"line\">cs       13306  1622  0 22:23 pts/0    00:00:00 grep 12347</span><br></pre></td></tr></table></figure>\n\n\n\n<p>列出所有正在运行的java进程</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/go$ jps</span><br><span class=\"line\">13600 Jps</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>-l</code></td>\n<td>输出主类全名或jar路径</td>\n</tr>\n<tr>\n<td><code>-q</code></td>\n<td>只输出LVMID</td>\n</tr>\n<tr>\n<td><code>-m</code></td>\n<td>输出JVM启动时传递给main()的参数</td>\n</tr>\n<tr>\n<td><code>-v</code></td>\n<td>输出JVM启动时显示指定的JVM参数</td>\n</tr>\n</tbody></table>\n</blockquote>\n","site":{"data":{}},"excerpt":"<p>top -M  </p>\n<p>top -c </p>\n<p>top -p $pid</p>\n<p><img src=\"/pics/top-4834.png\"></p>\n<blockquote>\n<p>排序默认从大到小,R反向排序</p>\n<p>M：根据内存排序</p>\n<p>P：根据CPU使用排序</p>\n<p>T：根据使用时间排序</p>\n<p>&gt;：向右移动一列排序</p>\n<p>&lt;:向左移动一列排序</p>\n</blockquote>\n<p>界面shift+m (根据内存排序)</p>\n<p><img src=\"/pics/top-M-5210.png\"></p>\n<h3 id=\"第一行top\"><a href=\"#第一行top\" class=\"headerlink\" title=\"第一行top\"></a>第一行top</h3><p>等同命令uptime</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/go$ uptime</span><br><span class=\"line\"> 22:00:22 up  8:59,  1 user,  load average: 0.13, 0.32, 0.36</span><br></pre></td></tr></table></figure>","more":"<blockquote>\n<p>系统当前时间 up 系统到目前为止运行的时间，</p>\n<p>当前系统的登陆用户数量，</p>\n<p>load average后面的三个数字分别表示距离现在一分钟，五分钟，十五分钟的负载情况</p>\n</blockquote>\n<p>load average数据是每隔5秒钟检查一次活跃的进程数，然后按特定算法计算出的数值。如果这个数除以逻辑CPU的数量，结果高于5的时候就表明系统在超负荷运转了</p>\n<h3 id=\"第二行-Tasks\"><a href=\"#第二行-Tasks\" class=\"headerlink\" title=\"第二行 Tasks\"></a>第二行 Tasks</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Tasks: 241 total,   1 running, 240 sleeping,   0 stopped,   0 zombie</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>tasks表示任务（进程），214则表示现在有241个进程，</p>\n<p>running  其中处于运行中的有1个，</p>\n<p>sleeping  240个在休眠(挂起)，</p>\n<p>stopped  停止的进程数为0，</p>\n<p>zombie   僵尸的进程数为0个</p>\n</blockquote>\n<h3 id=\"第三行-Cpu\"><a href=\"#第三行-Cpu\" class=\"headerlink\" title=\"第三行%Cpu\"></a>第三行%Cpu</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">%Cpu(s):  3.6 us,  0.6 sy,  0.0 ni, 95.8 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>us——用户空间(user)占用cpu的百分比<br>sy——内核空间(system)占用cpu的百分比<br>ni——改变过优先级(niced)的进程占用cpu的百分比<br>id——空闲（idolt）CPU百分比<br>wa——IO等待(wait)占用cpu的百分比<br>hi——IRQ 硬中断(Hardware)占用cpu的百分比<br>si——软中断（software）占用cpu的百分比<br>st——被hypervisor偷去的时间</p>\n</blockquote>\n<h3 id=\"第四五行-kib内存\"><a href=\"#第四五行-kib内存\" class=\"headerlink\" title=\"第四五行 kib内存\"></a>第四五行 kib内存</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">KiB Mem : 16257204 total, 12933272 free,  1288736 used,  2035196 buff/cache</span><br><span class=\"line\">KiB Swap:  7812092 total,  7812092 free,        0 used. 14425716 avail Mem </span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Mem：物理内存总量（16G）<br>free: 空闲内存总量(1G)<br>used: 使用中的内存总量<br>buff&#x2F;cache: 用作内核缓存的内存量</p>\n</blockquote>\n<blockquote>\n<p>Swap： 交换区总量<br>free：空闲交换区总量<br>used： 使用的交换区总量<br>avail Mem：表示可用于进程下一次分配的物理内存数量，这个大小一般比free大一点，因为除了free的空间外，系统还能立即释放出一些空间来</p>\n</blockquote>\n<h3 id=\"第七行-进程信息区\"><a href=\"#第七行-进程信息区\" class=\"headerlink\" title=\"第七行 进程信息区\"></a>第七行 进程信息区</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND  </span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>PID — 进程id<br>USER — 进程所有者<br>PR — 进程优先级<br>NI — nice值。负值表示高优先级，正值表示低优先级<br>VIRT — 进程使用的<code>虚拟内存</code>总量，单位kb。VIRT&#x3D;SWAP+RES<br>RES — <code>常驻内存</code>,进程使用的、未被换出的物理内存大小，单位kb。RES&#x3D;CODE+DATA<br>SHR — <code>共享内存</code>大小，单位kb<br>S — 进程状态。D&#x3D;不可中断的睡眠状态 R&#x3D;运行 S&#x3D;睡眠 T&#x3D;跟踪&#x2F;停止 Z&#x3D;僵尸进程<br>%CPU — 上次更新到现在的CPU时间占用百分比<br>%MEM — 进程使用的物理内存百分比<br>TIME+ — 进程使用的CPU时间总计，单位1&#x2F;100秒<br>COMMAND — 进程名称（命令名&#x2F;命令行）</p>\n</blockquote>\n<h3 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/go$ sudo netstat -anp|grep 12347</span><br><span class=\"line\">tcp        0      0 0.0.0.0:4000            0.0.0.0:*               LISTEN      12347/hexo </span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/go$ lsof -i:4000</span><br><span class=\"line\">COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class=\"line\">hexo    12347   cs   21u  IPv4 324187      0t0  TCP *:4000 (LISTEN)</span><br><span class=\"line\">cs@debian:~/go$ ps -ef|grep 12347</span><br><span class=\"line\">cs       12347  1640  0 21:56 pts/2    00:00:03 hexo</span><br><span class=\"line\">cs       13306  1622  0 22:23 pts/0    00:00:00 grep 12347</span><br></pre></td></tr></table></figure>\n\n\n\n<p>列出所有正在运行的java进程</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/go$ jps</span><br><span class=\"line\">13600 Jps</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>-l</code></td>\n<td>输出主类全名或jar路径</td>\n</tr>\n<tr>\n<td><code>-q</code></td>\n<td>只输出LVMID</td>\n</tr>\n<tr>\n<td><code>-m</code></td>\n<td>输出JVM启动时传递给main()的参数</td>\n</tr>\n<tr>\n<td><code>-v</code></td>\n<td>输出JVM启动时显示指定的JVM参数</td>\n</tr>\n</tbody></table>\n</blockquote>"},{"title":"tree工具","date":"2022-07-30T13:55:42.000Z","_content":"\n\n\n\n\n### 目录层级 -Ld\n\n-d 目录\n\n-L  level 层级\n\n\n\n```\ncs@debian:/$ tree -Ld  1\n.\n├── bin\n├── boot\n├── dev\n├── etc\n├── home\n├── lib\n├── lib64\n├── lost+found\n├── media\n├── mnt\n├── opt\n├── proc\n├── root\n├── run\n├── sbin\n├── snap\n├── srv\n├── sys\n├── tmp\n├── usr\n└── var\n```\n\n\n\n### 路径前缀 -f\n\n-f   打印路径的前缀(根据命令指定显示)\n\n```\ncs@debian:/opt/apache$ tree -Ldf  1 ./\n.\n├── ./apache-maven-3.8.6\n├── ./kafka-2.1.1\n├── ./maven-3.6.0\n├── ./tomcat-8.5.38\n└── ./zookeeper-3.4.13\n\n5 directories\ncs@debian:/opt/apache$ tree -Ldf  1 /opt/apache/\n/opt/apache\n├── /opt/apache/apache-maven-3.8.6\n├── /opt/apache/kafka-2.1.1\n├── /opt/apache/maven-3.6.0\n├── /opt/apache/tomcat-8.5.38\n└── /opt/apache/zookeeper-3.4.13\n\n5 directories\n```\n\n\n\n<!--more-->\n\n\n\n### 过滤 -I\n\n\n\n```\ncs@debian:~/oss/0s$ tree -L 3  -I \"src|target\" ./spring-boot/cs-framework/  ./spring-boot/cs-framework/\n├── cs-msc\n│   ├── lib\n│   │   ├── json-jena-1.0.jar\n│   │   └── Msc.jar\n│   ├── msc\n│   │   ├── libmsc32.so\n│   │   ├── libmsc64.so\n│   │   ├── msc32.dll\n│   │   └── msc64.dll\n│   ├── pom.xml\n│   └── READER.md\n├── cs-ocr\n│   ├── libs\n│   │   └── ocr_sdk-1.3.6.jar\n│   └── pom.xml\n└── pom.xml\n\n5 directories, 11 files\n```\n\n\n\n```\ncs@debian:~/oss/0s$ tree -L 3  -I *.jar* ./spring-boot/cs-framework/  \n./spring-boot/cs-framework/\n├── cs-msc\n│   ├── lib\n│   ├── msc\n│   │   ├── libmsc32.so\n│   │   ├── libmsc64.so\n│   │   ├── msc32.dll\n│   │   └── msc64.dll\n│   ├── pom.xml\n│   ├── READER.md\n│   ├── src\n│   │   └── main\n│   └── target\n│       ├── classes\n│       ├── generated-sources\n│       ├── maven-archiver\n│       └── maven-status\n├── cs-ocr\n│   ├── libs\n│   ├── pom.xml\n│   ├── src\n│   │   └── main\n│   └── target\n│       ├── classes\n│       ├── generated-sources\n│       ├── maven-archiver\n│       └── maven-status\n└── pom.xml\n\n19 directories, 8 files\n```\n\n\n\n\n\n### 匹配 -P\n\n```\ncs@debian:~/oss/0s$ tree -L 3 -P *xml -I \"src|target\" ./spring-boot/cs-framework/  \n./spring-boot/cs-framework/\n├── cs-msc\n│   ├── lib\n│   ├── msc\n│   └── pom.xml\n├── cs-ocr\n│   ├── libs\n│   └── pom.xml\n└── pom.xml\n\n5 directories, 3 files\n```\n\n\n\n### 大小时间 -ts\n\n-t 时间排序(默认从旧到新,r反序)\n\n-s 大小\n\n```\ncs@debian:/opt/apache$ tree -Ldrts  1 /opt/apache/\n/opt/apache/\n├── [       4096]  apache-maven-3.8.6\n├── [       4096]  tomcat-8.5.38\n├── [       4096]  maven-3.6.0\n├── [       4096]  kafka-2.1.1\n└── [       4096]  zookeeper-3.4.13\n\n5 directories\n```\n\n\n\n### 权限角色 -pus\n\n-p 权限\n\n-u  角色\n\n-g 组\n\n```\ncs@debian:/opt/apache$ tree -Ldpu  1 /opt/apache/\n/opt/apache/\n├── [drwxr-xr-x cs      ]  apache-maven-3.8.6\n├── [drwxr-xr-x cs      ]  kafka-2.1.1\n├── [drwxr-xr-x cs      ]  maven-3.6.0\n├── [drwxr-xr-x cs      ]  tomcat-8.5.38\n└── [drwxr-xr-x cs      ]  zookeeper-3.4.13\n\n5 directories\n\n```\n\n\n\n\n\n\n\n### 着色 -C\n\n-n 关闭\n\n-C 打开\n\n```shell\ncs@debian:/opt/apache$ tree -LdC  1 /opt/apache/\n/opt/apache/\n├── [       4096]  apache-maven-3.8.6\n├── [       4096]  tomcat-8.5.38\n├── [       4096]  maven-3.6.0\n├── [       4096]  kafka-2.1.1\n└── [       4096]  zookeeper-3.4.13\n\n5 directories\n\n```\n\n\n\n\n\n### 格式  -j\n\n -i 不打印虚线\n\n-X xml格式 \n\n-J   json格式\n\n```\ncs@debian:/opt/apache$ tree -Ldrtsi  1 /opt/apache/\n/opt/apache/\n[       4096]  apache-maven-3.8.6\n[       4096]  tomcat-8.5.38\n[       4096]  maven-3.6.0\n[       4096]  kafka-2.1.1\n[       4096]  zookeeper-3.4.13\n\n5 directories\ncs@debian:/opt/apache$ tree -LdrtsX  1 /opt/apache/\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<tree>\n  <directory name=\"/opt/apache/\">\n    <directory name=\"apache-maven-3.8.6\" size=\"4096\">\n    </directory>\n    <directory name=\"tomcat-8.5.38\" size=\"4096\">\n    </directory>\n    <directory name=\"maven-3.6.0\" size=\"4096\">\n    </directory>\n    <directory name=\"kafka-2.1.1\" size=\"4096\">\n    </directory>\n    <directory name=\"zookeeper-3.4.13\" size=\"4096\">\n    </directory>\n  </directory>\n  <report>\n    <directories>5</directories>\n  </report>\n</tree>\ncs@debian:/opt/apache$ tree -LdrtsJ  1 /opt/apache/\n[\n  {\"type\":\"directory\",\"name\":\"/opt/apache/\",\"contents\":[\n    {\"type\":\"directory\",\"name\":\"apache-maven-3.8.6\",\"size\":4096,\"contents\":[\n    ]},\n    {\"type\":\"directory\",\"name\":\"tomcat-8.5.38\",\"size\":4096,\"contents\":[\n    ]},\n    {\"type\":\"directory\",\"name\":\"maven-3.6.0\",\"size\":4096,\"contents\":[\n    ]},\n    {\"type\":\"directory\",\"name\":\"kafka-2.1.1\",\"size\":4096,\"contents\":[\n    ]},\n    {\"type\":\"directory\",\"name\":\"zookeeper-3.4.13\",\"size\":4096,\"contents\":[\n    ]}\n  ]},\n  {\"type\":\"report\",\"directories\":5}\n]\n```\n\n\n\n","source":"_posts/linux/shell/tree.md","raw":"---\ntitle: tree工具\npermalink: linux/shell/tree/\ntags:\n  - tree\ncategories:\n  - linux\n  - shell\ndate: 2022-07-30 21:55:42\n---\n\n\n\n\n\n### 目录层级 -Ld\n\n-d 目录\n\n-L  level 层级\n\n\n\n```\ncs@debian:/$ tree -Ld  1\n.\n├── bin\n├── boot\n├── dev\n├── etc\n├── home\n├── lib\n├── lib64\n├── lost+found\n├── media\n├── mnt\n├── opt\n├── proc\n├── root\n├── run\n├── sbin\n├── snap\n├── srv\n├── sys\n├── tmp\n├── usr\n└── var\n```\n\n\n\n### 路径前缀 -f\n\n-f   打印路径的前缀(根据命令指定显示)\n\n```\ncs@debian:/opt/apache$ tree -Ldf  1 ./\n.\n├── ./apache-maven-3.8.6\n├── ./kafka-2.1.1\n├── ./maven-3.6.0\n├── ./tomcat-8.5.38\n└── ./zookeeper-3.4.13\n\n5 directories\ncs@debian:/opt/apache$ tree -Ldf  1 /opt/apache/\n/opt/apache\n├── /opt/apache/apache-maven-3.8.6\n├── /opt/apache/kafka-2.1.1\n├── /opt/apache/maven-3.6.0\n├── /opt/apache/tomcat-8.5.38\n└── /opt/apache/zookeeper-3.4.13\n\n5 directories\n```\n\n\n\n<!--more-->\n\n\n\n### 过滤 -I\n\n\n\n```\ncs@debian:~/oss/0s$ tree -L 3  -I \"src|target\" ./spring-boot/cs-framework/  ./spring-boot/cs-framework/\n├── cs-msc\n│   ├── lib\n│   │   ├── json-jena-1.0.jar\n│   │   └── Msc.jar\n│   ├── msc\n│   │   ├── libmsc32.so\n│   │   ├── libmsc64.so\n│   │   ├── msc32.dll\n│   │   └── msc64.dll\n│   ├── pom.xml\n│   └── READER.md\n├── cs-ocr\n│   ├── libs\n│   │   └── ocr_sdk-1.3.6.jar\n│   └── pom.xml\n└── pom.xml\n\n5 directories, 11 files\n```\n\n\n\n```\ncs@debian:~/oss/0s$ tree -L 3  -I *.jar* ./spring-boot/cs-framework/  \n./spring-boot/cs-framework/\n├── cs-msc\n│   ├── lib\n│   ├── msc\n│   │   ├── libmsc32.so\n│   │   ├── libmsc64.so\n│   │   ├── msc32.dll\n│   │   └── msc64.dll\n│   ├── pom.xml\n│   ├── READER.md\n│   ├── src\n│   │   └── main\n│   └── target\n│       ├── classes\n│       ├── generated-sources\n│       ├── maven-archiver\n│       └── maven-status\n├── cs-ocr\n│   ├── libs\n│   ├── pom.xml\n│   ├── src\n│   │   └── main\n│   └── target\n│       ├── classes\n│       ├── generated-sources\n│       ├── maven-archiver\n│       └── maven-status\n└── pom.xml\n\n19 directories, 8 files\n```\n\n\n\n\n\n### 匹配 -P\n\n```\ncs@debian:~/oss/0s$ tree -L 3 -P *xml -I \"src|target\" ./spring-boot/cs-framework/  \n./spring-boot/cs-framework/\n├── cs-msc\n│   ├── lib\n│   ├── msc\n│   └── pom.xml\n├── cs-ocr\n│   ├── libs\n│   └── pom.xml\n└── pom.xml\n\n5 directories, 3 files\n```\n\n\n\n### 大小时间 -ts\n\n-t 时间排序(默认从旧到新,r反序)\n\n-s 大小\n\n```\ncs@debian:/opt/apache$ tree -Ldrts  1 /opt/apache/\n/opt/apache/\n├── [       4096]  apache-maven-3.8.6\n├── [       4096]  tomcat-8.5.38\n├── [       4096]  maven-3.6.0\n├── [       4096]  kafka-2.1.1\n└── [       4096]  zookeeper-3.4.13\n\n5 directories\n```\n\n\n\n### 权限角色 -pus\n\n-p 权限\n\n-u  角色\n\n-g 组\n\n```\ncs@debian:/opt/apache$ tree -Ldpu  1 /opt/apache/\n/opt/apache/\n├── [drwxr-xr-x cs      ]  apache-maven-3.8.6\n├── [drwxr-xr-x cs      ]  kafka-2.1.1\n├── [drwxr-xr-x cs      ]  maven-3.6.0\n├── [drwxr-xr-x cs      ]  tomcat-8.5.38\n└── [drwxr-xr-x cs      ]  zookeeper-3.4.13\n\n5 directories\n\n```\n\n\n\n\n\n\n\n### 着色 -C\n\n-n 关闭\n\n-C 打开\n\n```shell\ncs@debian:/opt/apache$ tree -LdC  1 /opt/apache/\n/opt/apache/\n├── [       4096]  apache-maven-3.8.6\n├── [       4096]  tomcat-8.5.38\n├── [       4096]  maven-3.6.0\n├── [       4096]  kafka-2.1.1\n└── [       4096]  zookeeper-3.4.13\n\n5 directories\n\n```\n\n\n\n\n\n### 格式  -j\n\n -i 不打印虚线\n\n-X xml格式 \n\n-J   json格式\n\n```\ncs@debian:/opt/apache$ tree -Ldrtsi  1 /opt/apache/\n/opt/apache/\n[       4096]  apache-maven-3.8.6\n[       4096]  tomcat-8.5.38\n[       4096]  maven-3.6.0\n[       4096]  kafka-2.1.1\n[       4096]  zookeeper-3.4.13\n\n5 directories\ncs@debian:/opt/apache$ tree -LdrtsX  1 /opt/apache/\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<tree>\n  <directory name=\"/opt/apache/\">\n    <directory name=\"apache-maven-3.8.6\" size=\"4096\">\n    </directory>\n    <directory name=\"tomcat-8.5.38\" size=\"4096\">\n    </directory>\n    <directory name=\"maven-3.6.0\" size=\"4096\">\n    </directory>\n    <directory name=\"kafka-2.1.1\" size=\"4096\">\n    </directory>\n    <directory name=\"zookeeper-3.4.13\" size=\"4096\">\n    </directory>\n  </directory>\n  <report>\n    <directories>5</directories>\n  </report>\n</tree>\ncs@debian:/opt/apache$ tree -LdrtsJ  1 /opt/apache/\n[\n  {\"type\":\"directory\",\"name\":\"/opt/apache/\",\"contents\":[\n    {\"type\":\"directory\",\"name\":\"apache-maven-3.8.6\",\"size\":4096,\"contents\":[\n    ]},\n    {\"type\":\"directory\",\"name\":\"tomcat-8.5.38\",\"size\":4096,\"contents\":[\n    ]},\n    {\"type\":\"directory\",\"name\":\"maven-3.6.0\",\"size\":4096,\"contents\":[\n    ]},\n    {\"type\":\"directory\",\"name\":\"kafka-2.1.1\",\"size\":4096,\"contents\":[\n    ]},\n    {\"type\":\"directory\",\"name\":\"zookeeper-3.4.13\",\"size\":4096,\"contents\":[\n    ]}\n  ]},\n  {\"type\":\"report\",\"directories\":5}\n]\n```\n\n\n\n","slug":"linux/shell/tree","published":1,"updated":"2022-08-28T09:10:00.944Z","__permalink":"linux/shell/tree/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gttt003dgwi56uapcy2s","content":"<h3 id=\"目录层级-Ld\"><a href=\"#目录层级-Ld\" class=\"headerlink\" title=\"目录层级 -Ld\"></a>目录层级 -Ld</h3><p>-d 目录</p>\n<p>-L  level 层级</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/$ tree -Ld  1</span><br><span class=\"line\">.</span><br><span class=\"line\">├── bin</span><br><span class=\"line\">├── boot</span><br><span class=\"line\">├── dev</span><br><span class=\"line\">├── etc</span><br><span class=\"line\">├── home</span><br><span class=\"line\">├── lib</span><br><span class=\"line\">├── lib64</span><br><span class=\"line\">├── lost+found</span><br><span class=\"line\">├── media</span><br><span class=\"line\">├── mnt</span><br><span class=\"line\">├── opt</span><br><span class=\"line\">├── proc</span><br><span class=\"line\">├── root</span><br><span class=\"line\">├── run</span><br><span class=\"line\">├── sbin</span><br><span class=\"line\">├── snap</span><br><span class=\"line\">├── srv</span><br><span class=\"line\">├── sys</span><br><span class=\"line\">├── tmp</span><br><span class=\"line\">├── usr</span><br><span class=\"line\">└── var</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"路径前缀-f\"><a href=\"#路径前缀-f\" class=\"headerlink\" title=\"路径前缀 -f\"></a>路径前缀 -f</h3><p>-f   打印路径的前缀(根据命令指定显示)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/apache$ tree -Ldf  1 ./</span><br><span class=\"line\">.</span><br><span class=\"line\">├── ./apache-maven-3.8.6</span><br><span class=\"line\">├── ./kafka-2.1.1</span><br><span class=\"line\">├── ./maven-3.6.0</span><br><span class=\"line\">├── ./tomcat-8.5.38</span><br><span class=\"line\">└── ./zookeeper-3.4.13</span><br><span class=\"line\"></span><br><span class=\"line\">5 directories</span><br><span class=\"line\">cs@debian:/opt/apache$ tree -Ldf  1 /opt/apache/</span><br><span class=\"line\">/opt/apache</span><br><span class=\"line\">├── /opt/apache/apache-maven-3.8.6</span><br><span class=\"line\">├── /opt/apache/kafka-2.1.1</span><br><span class=\"line\">├── /opt/apache/maven-3.6.0</span><br><span class=\"line\">├── /opt/apache/tomcat-8.5.38</span><br><span class=\"line\">└── /opt/apache/zookeeper-3.4.13</span><br><span class=\"line\"></span><br><span class=\"line\">5 directories</span><br></pre></td></tr></table></figure>\n\n\n\n<span id=\"more\"></span>\n\n\n\n<h3 id=\"过滤-I\"><a href=\"#过滤-I\" class=\"headerlink\" title=\"过滤 -I\"></a>过滤 -I</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/0s$ tree -L 3  -I &quot;src|target&quot; ./spring-boot/cs-framework/  ./spring-boot/cs-framework/</span><br><span class=\"line\">├── cs-msc</span><br><span class=\"line\">│   ├── lib</span><br><span class=\"line\">│   │   ├── json-jena-1.0.jar</span><br><span class=\"line\">│   │   └── Msc.jar</span><br><span class=\"line\">│   ├── msc</span><br><span class=\"line\">│   │   ├── libmsc32.so</span><br><span class=\"line\">│   │   ├── libmsc64.so</span><br><span class=\"line\">│   │   ├── msc32.dll</span><br><span class=\"line\">│   │   └── msc64.dll</span><br><span class=\"line\">│   ├── pom.xml</span><br><span class=\"line\">│   └── READER.md</span><br><span class=\"line\">├── cs-ocr</span><br><span class=\"line\">│   ├── libs</span><br><span class=\"line\">│   │   └── ocr_sdk-1.3.6.jar</span><br><span class=\"line\">│   └── pom.xml</span><br><span class=\"line\">└── pom.xml</span><br><span class=\"line\"></span><br><span class=\"line\">5 directories, 11 files</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/0s$ tree -L 3  -I *.jar* ./spring-boot/cs-framework/  </span><br><span class=\"line\">./spring-boot/cs-framework/</span><br><span class=\"line\">├── cs-msc</span><br><span class=\"line\">│   ├── lib</span><br><span class=\"line\">│   ├── msc</span><br><span class=\"line\">│   │   ├── libmsc32.so</span><br><span class=\"line\">│   │   ├── libmsc64.so</span><br><span class=\"line\">│   │   ├── msc32.dll</span><br><span class=\"line\">│   │   └── msc64.dll</span><br><span class=\"line\">│   ├── pom.xml</span><br><span class=\"line\">│   ├── READER.md</span><br><span class=\"line\">│   ├── src</span><br><span class=\"line\">│   │   └── main</span><br><span class=\"line\">│   └── target</span><br><span class=\"line\">│       ├── classes</span><br><span class=\"line\">│       ├── generated-sources</span><br><span class=\"line\">│       ├── maven-archiver</span><br><span class=\"line\">│       └── maven-status</span><br><span class=\"line\">├── cs-ocr</span><br><span class=\"line\">│   ├── libs</span><br><span class=\"line\">│   ├── pom.xml</span><br><span class=\"line\">│   ├── src</span><br><span class=\"line\">│   │   └── main</span><br><span class=\"line\">│   └── target</span><br><span class=\"line\">│       ├── classes</span><br><span class=\"line\">│       ├── generated-sources</span><br><span class=\"line\">│       ├── maven-archiver</span><br><span class=\"line\">│       └── maven-status</span><br><span class=\"line\">└── pom.xml</span><br><span class=\"line\"></span><br><span class=\"line\">19 directories, 8 files</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"匹配-P\"><a href=\"#匹配-P\" class=\"headerlink\" title=\"匹配 -P\"></a>匹配 -P</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/0s$ tree -L 3 -P *xml -I &quot;src|target&quot; ./spring-boot/cs-framework/  </span><br><span class=\"line\">./spring-boot/cs-framework/</span><br><span class=\"line\">├── cs-msc</span><br><span class=\"line\">│   ├── lib</span><br><span class=\"line\">│   ├── msc</span><br><span class=\"line\">│   └── pom.xml</span><br><span class=\"line\">├── cs-ocr</span><br><span class=\"line\">│   ├── libs</span><br><span class=\"line\">│   └── pom.xml</span><br><span class=\"line\">└── pom.xml</span><br><span class=\"line\"></span><br><span class=\"line\">5 directories, 3 files</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"大小时间-ts\"><a href=\"#大小时间-ts\" class=\"headerlink\" title=\"大小时间 -ts\"></a>大小时间 -ts</h3><p>-t 时间排序(默认从旧到新,r反序)</p>\n<p>-s 大小</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/apache$ tree -Ldrts  1 /opt/apache/</span><br><span class=\"line\">/opt/apache/</span><br><span class=\"line\">├── [       4096]  apache-maven-3.8.6</span><br><span class=\"line\">├── [       4096]  tomcat-8.5.38</span><br><span class=\"line\">├── [       4096]  maven-3.6.0</span><br><span class=\"line\">├── [       4096]  kafka-2.1.1</span><br><span class=\"line\">└── [       4096]  zookeeper-3.4.13</span><br><span class=\"line\"></span><br><span class=\"line\">5 directories</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"权限角色-pus\"><a href=\"#权限角色-pus\" class=\"headerlink\" title=\"权限角色 -pus\"></a>权限角色 -pus</h3><p>-p 权限</p>\n<p>-u  角色</p>\n<p>-g 组</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/apache$ tree -Ldpu  1 /opt/apache/</span><br><span class=\"line\">/opt/apache/</span><br><span class=\"line\">├── [drwxr-xr-x cs      ]  apache-maven-3.8.6</span><br><span class=\"line\">├── [drwxr-xr-x cs      ]  kafka-2.1.1</span><br><span class=\"line\">├── [drwxr-xr-x cs      ]  maven-3.6.0</span><br><span class=\"line\">├── [drwxr-xr-x cs      ]  tomcat-8.5.38</span><br><span class=\"line\">└── [drwxr-xr-x cs      ]  zookeeper-3.4.13</span><br><span class=\"line\"></span><br><span class=\"line\">5 directories</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<h3 id=\"着色-C\"><a href=\"#着色-C\" class=\"headerlink\" title=\"着色 -C\"></a>着色 -C</h3><p>-n 关闭</p>\n<p>-C 打开</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/apache$ tree -LdC  1 /opt/apache/</span><br><span class=\"line\">/opt/apache/</span><br><span class=\"line\">├── [       4096]  apache-maven-3.8.6</span><br><span class=\"line\">├── [       4096]  tomcat-8.5.38</span><br><span class=\"line\">├── [       4096]  maven-3.6.0</span><br><span class=\"line\">├── [       4096]  kafka-2.1.1</span><br><span class=\"line\">└── [       4096]  zookeeper-3.4.13</span><br><span class=\"line\"></span><br><span class=\"line\">5 directories</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"格式-j\"><a href=\"#格式-j\" class=\"headerlink\" title=\"格式  -j\"></a>格式  -j</h3><p> -i 不打印虚线</p>\n<p>-X xml格式 </p>\n<p>-J   json格式</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/apache$ tree -Ldrtsi  1 /opt/apache/</span><br><span class=\"line\">/opt/apache/</span><br><span class=\"line\">[       4096]  apache-maven-3.8.6</span><br><span class=\"line\">[       4096]  tomcat-8.5.38</span><br><span class=\"line\">[       4096]  maven-3.6.0</span><br><span class=\"line\">[       4096]  kafka-2.1.1</span><br><span class=\"line\">[       4096]  zookeeper-3.4.13</span><br><span class=\"line\"></span><br><span class=\"line\">5 directories</span><br><span class=\"line\">cs@debian:/opt/apache$ tree -LdrtsX  1 /opt/apache/</span><br><span class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class=\"line\">&lt;tree&gt;</span><br><span class=\"line\">  &lt;directory name=&quot;/opt/apache/&quot;&gt;</span><br><span class=\"line\">    &lt;directory name=&quot;apache-maven-3.8.6&quot; size=&quot;4096&quot;&gt;</span><br><span class=\"line\">    &lt;/directory&gt;</span><br><span class=\"line\">    &lt;directory name=&quot;tomcat-8.5.38&quot; size=&quot;4096&quot;&gt;</span><br><span class=\"line\">    &lt;/directory&gt;</span><br><span class=\"line\">    &lt;directory name=&quot;maven-3.6.0&quot; size=&quot;4096&quot;&gt;</span><br><span class=\"line\">    &lt;/directory&gt;</span><br><span class=\"line\">    &lt;directory name=&quot;kafka-2.1.1&quot; size=&quot;4096&quot;&gt;</span><br><span class=\"line\">    &lt;/directory&gt;</span><br><span class=\"line\">    &lt;directory name=&quot;zookeeper-3.4.13&quot; size=&quot;4096&quot;&gt;</span><br><span class=\"line\">    &lt;/directory&gt;</span><br><span class=\"line\">  &lt;/directory&gt;</span><br><span class=\"line\">  &lt;report&gt;</span><br><span class=\"line\">    &lt;directories&gt;5&lt;/directories&gt;</span><br><span class=\"line\">  &lt;/report&gt;</span><br><span class=\"line\">&lt;/tree&gt;</span><br><span class=\"line\">cs@debian:/opt/apache$ tree -LdrtsJ  1 /opt/apache/</span><br><span class=\"line\">[</span><br><span class=\"line\">  &#123;&quot;type&quot;:&quot;directory&quot;,&quot;name&quot;:&quot;/opt/apache/&quot;,&quot;contents&quot;:[</span><br><span class=\"line\">    &#123;&quot;type&quot;:&quot;directory&quot;,&quot;name&quot;:&quot;apache-maven-3.8.6&quot;,&quot;size&quot;:4096,&quot;contents&quot;:[</span><br><span class=\"line\">    ]&#125;,</span><br><span class=\"line\">    &#123;&quot;type&quot;:&quot;directory&quot;,&quot;name&quot;:&quot;tomcat-8.5.38&quot;,&quot;size&quot;:4096,&quot;contents&quot;:[</span><br><span class=\"line\">    ]&#125;,</span><br><span class=\"line\">    &#123;&quot;type&quot;:&quot;directory&quot;,&quot;name&quot;:&quot;maven-3.6.0&quot;,&quot;size&quot;:4096,&quot;contents&quot;:[</span><br><span class=\"line\">    ]&#125;,</span><br><span class=\"line\">    &#123;&quot;type&quot;:&quot;directory&quot;,&quot;name&quot;:&quot;kafka-2.1.1&quot;,&quot;size&quot;:4096,&quot;contents&quot;:[</span><br><span class=\"line\">    ]&#125;,</span><br><span class=\"line\">    &#123;&quot;type&quot;:&quot;directory&quot;,&quot;name&quot;:&quot;zookeeper-3.4.13&quot;,&quot;size&quot;:4096,&quot;contents&quot;:[</span><br><span class=\"line\">    ]&#125;</span><br><span class=\"line\">  ]&#125;,</span><br><span class=\"line\">  &#123;&quot;type&quot;:&quot;report&quot;,&quot;directories&quot;:5&#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n\n\n","site":{"data":{}},"excerpt":"<h3 id=\"目录层级-Ld\"><a href=\"#目录层级-Ld\" class=\"headerlink\" title=\"目录层级 -Ld\"></a>目录层级 -Ld</h3><p>-d 目录</p>\n<p>-L  level 层级</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/$ tree -Ld  1</span><br><span class=\"line\">.</span><br><span class=\"line\">├── bin</span><br><span class=\"line\">├── boot</span><br><span class=\"line\">├── dev</span><br><span class=\"line\">├── etc</span><br><span class=\"line\">├── home</span><br><span class=\"line\">├── lib</span><br><span class=\"line\">├── lib64</span><br><span class=\"line\">├── lost+found</span><br><span class=\"line\">├── media</span><br><span class=\"line\">├── mnt</span><br><span class=\"line\">├── opt</span><br><span class=\"line\">├── proc</span><br><span class=\"line\">├── root</span><br><span class=\"line\">├── run</span><br><span class=\"line\">├── sbin</span><br><span class=\"line\">├── snap</span><br><span class=\"line\">├── srv</span><br><span class=\"line\">├── sys</span><br><span class=\"line\">├── tmp</span><br><span class=\"line\">├── usr</span><br><span class=\"line\">└── var</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"路径前缀-f\"><a href=\"#路径前缀-f\" class=\"headerlink\" title=\"路径前缀 -f\"></a>路径前缀 -f</h3><p>-f   打印路径的前缀(根据命令指定显示)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/apache$ tree -Ldf  1 ./</span><br><span class=\"line\">.</span><br><span class=\"line\">├── ./apache-maven-3.8.6</span><br><span class=\"line\">├── ./kafka-2.1.1</span><br><span class=\"line\">├── ./maven-3.6.0</span><br><span class=\"line\">├── ./tomcat-8.5.38</span><br><span class=\"line\">└── ./zookeeper-3.4.13</span><br><span class=\"line\"></span><br><span class=\"line\">5 directories</span><br><span class=\"line\">cs@debian:/opt/apache$ tree -Ldf  1 /opt/apache/</span><br><span class=\"line\">/opt/apache</span><br><span class=\"line\">├── /opt/apache/apache-maven-3.8.6</span><br><span class=\"line\">├── /opt/apache/kafka-2.1.1</span><br><span class=\"line\">├── /opt/apache/maven-3.6.0</span><br><span class=\"line\">├── /opt/apache/tomcat-8.5.38</span><br><span class=\"line\">└── /opt/apache/zookeeper-3.4.13</span><br><span class=\"line\"></span><br><span class=\"line\">5 directories</span><br></pre></td></tr></table></figure>","more":"<h3 id=\"过滤-I\"><a href=\"#过滤-I\" class=\"headerlink\" title=\"过滤 -I\"></a>过滤 -I</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/0s$ tree -L 3  -I &quot;src|target&quot; ./spring-boot/cs-framework/  ./spring-boot/cs-framework/</span><br><span class=\"line\">├── cs-msc</span><br><span class=\"line\">│   ├── lib</span><br><span class=\"line\">│   │   ├── json-jena-1.0.jar</span><br><span class=\"line\">│   │   └── Msc.jar</span><br><span class=\"line\">│   ├── msc</span><br><span class=\"line\">│   │   ├── libmsc32.so</span><br><span class=\"line\">│   │   ├── libmsc64.so</span><br><span class=\"line\">│   │   ├── msc32.dll</span><br><span class=\"line\">│   │   └── msc64.dll</span><br><span class=\"line\">│   ├── pom.xml</span><br><span class=\"line\">│   └── READER.md</span><br><span class=\"line\">├── cs-ocr</span><br><span class=\"line\">│   ├── libs</span><br><span class=\"line\">│   │   └── ocr_sdk-1.3.6.jar</span><br><span class=\"line\">│   └── pom.xml</span><br><span class=\"line\">└── pom.xml</span><br><span class=\"line\"></span><br><span class=\"line\">5 directories, 11 files</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/0s$ tree -L 3  -I *.jar* ./spring-boot/cs-framework/  </span><br><span class=\"line\">./spring-boot/cs-framework/</span><br><span class=\"line\">├── cs-msc</span><br><span class=\"line\">│   ├── lib</span><br><span class=\"line\">│   ├── msc</span><br><span class=\"line\">│   │   ├── libmsc32.so</span><br><span class=\"line\">│   │   ├── libmsc64.so</span><br><span class=\"line\">│   │   ├── msc32.dll</span><br><span class=\"line\">│   │   └── msc64.dll</span><br><span class=\"line\">│   ├── pom.xml</span><br><span class=\"line\">│   ├── READER.md</span><br><span class=\"line\">│   ├── src</span><br><span class=\"line\">│   │   └── main</span><br><span class=\"line\">│   └── target</span><br><span class=\"line\">│       ├── classes</span><br><span class=\"line\">│       ├── generated-sources</span><br><span class=\"line\">│       ├── maven-archiver</span><br><span class=\"line\">│       └── maven-status</span><br><span class=\"line\">├── cs-ocr</span><br><span class=\"line\">│   ├── libs</span><br><span class=\"line\">│   ├── pom.xml</span><br><span class=\"line\">│   ├── src</span><br><span class=\"line\">│   │   └── main</span><br><span class=\"line\">│   └── target</span><br><span class=\"line\">│       ├── classes</span><br><span class=\"line\">│       ├── generated-sources</span><br><span class=\"line\">│       ├── maven-archiver</span><br><span class=\"line\">│       └── maven-status</span><br><span class=\"line\">└── pom.xml</span><br><span class=\"line\"></span><br><span class=\"line\">19 directories, 8 files</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"匹配-P\"><a href=\"#匹配-P\" class=\"headerlink\" title=\"匹配 -P\"></a>匹配 -P</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:~/oss/0s$ tree -L 3 -P *xml -I &quot;src|target&quot; ./spring-boot/cs-framework/  </span><br><span class=\"line\">./spring-boot/cs-framework/</span><br><span class=\"line\">├── cs-msc</span><br><span class=\"line\">│   ├── lib</span><br><span class=\"line\">│   ├── msc</span><br><span class=\"line\">│   └── pom.xml</span><br><span class=\"line\">├── cs-ocr</span><br><span class=\"line\">│   ├── libs</span><br><span class=\"line\">│   └── pom.xml</span><br><span class=\"line\">└── pom.xml</span><br><span class=\"line\"></span><br><span class=\"line\">5 directories, 3 files</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"大小时间-ts\"><a href=\"#大小时间-ts\" class=\"headerlink\" title=\"大小时间 -ts\"></a>大小时间 -ts</h3><p>-t 时间排序(默认从旧到新,r反序)</p>\n<p>-s 大小</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/apache$ tree -Ldrts  1 /opt/apache/</span><br><span class=\"line\">/opt/apache/</span><br><span class=\"line\">├── [       4096]  apache-maven-3.8.6</span><br><span class=\"line\">├── [       4096]  tomcat-8.5.38</span><br><span class=\"line\">├── [       4096]  maven-3.6.0</span><br><span class=\"line\">├── [       4096]  kafka-2.1.1</span><br><span class=\"line\">└── [       4096]  zookeeper-3.4.13</span><br><span class=\"line\"></span><br><span class=\"line\">5 directories</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"权限角色-pus\"><a href=\"#权限角色-pus\" class=\"headerlink\" title=\"权限角色 -pus\"></a>权限角色 -pus</h3><p>-p 权限</p>\n<p>-u  角色</p>\n<p>-g 组</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/apache$ tree -Ldpu  1 /opt/apache/</span><br><span class=\"line\">/opt/apache/</span><br><span class=\"line\">├── [drwxr-xr-x cs      ]  apache-maven-3.8.6</span><br><span class=\"line\">├── [drwxr-xr-x cs      ]  kafka-2.1.1</span><br><span class=\"line\">├── [drwxr-xr-x cs      ]  maven-3.6.0</span><br><span class=\"line\">├── [drwxr-xr-x cs      ]  tomcat-8.5.38</span><br><span class=\"line\">└── [drwxr-xr-x cs      ]  zookeeper-3.4.13</span><br><span class=\"line\"></span><br><span class=\"line\">5 directories</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<h3 id=\"着色-C\"><a href=\"#着色-C\" class=\"headerlink\" title=\"着色 -C\"></a>着色 -C</h3><p>-n 关闭</p>\n<p>-C 打开</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/apache$ tree -LdC  1 /opt/apache/</span><br><span class=\"line\">/opt/apache/</span><br><span class=\"line\">├── [       4096]  apache-maven-3.8.6</span><br><span class=\"line\">├── [       4096]  tomcat-8.5.38</span><br><span class=\"line\">├── [       4096]  maven-3.6.0</span><br><span class=\"line\">├── [       4096]  kafka-2.1.1</span><br><span class=\"line\">└── [       4096]  zookeeper-3.4.13</span><br><span class=\"line\"></span><br><span class=\"line\">5 directories</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"格式-j\"><a href=\"#格式-j\" class=\"headerlink\" title=\"格式  -j\"></a>格式  -j</h3><p> -i 不打印虚线</p>\n<p>-X xml格式 </p>\n<p>-J   json格式</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/apache$ tree -Ldrtsi  1 /opt/apache/</span><br><span class=\"line\">/opt/apache/</span><br><span class=\"line\">[       4096]  apache-maven-3.8.6</span><br><span class=\"line\">[       4096]  tomcat-8.5.38</span><br><span class=\"line\">[       4096]  maven-3.6.0</span><br><span class=\"line\">[       4096]  kafka-2.1.1</span><br><span class=\"line\">[       4096]  zookeeper-3.4.13</span><br><span class=\"line\"></span><br><span class=\"line\">5 directories</span><br><span class=\"line\">cs@debian:/opt/apache$ tree -LdrtsX  1 /opt/apache/</span><br><span class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class=\"line\">&lt;tree&gt;</span><br><span class=\"line\">  &lt;directory name=&quot;/opt/apache/&quot;&gt;</span><br><span class=\"line\">    &lt;directory name=&quot;apache-maven-3.8.6&quot; size=&quot;4096&quot;&gt;</span><br><span class=\"line\">    &lt;/directory&gt;</span><br><span class=\"line\">    &lt;directory name=&quot;tomcat-8.5.38&quot; size=&quot;4096&quot;&gt;</span><br><span class=\"line\">    &lt;/directory&gt;</span><br><span class=\"line\">    &lt;directory name=&quot;maven-3.6.0&quot; size=&quot;4096&quot;&gt;</span><br><span class=\"line\">    &lt;/directory&gt;</span><br><span class=\"line\">    &lt;directory name=&quot;kafka-2.1.1&quot; size=&quot;4096&quot;&gt;</span><br><span class=\"line\">    &lt;/directory&gt;</span><br><span class=\"line\">    &lt;directory name=&quot;zookeeper-3.4.13&quot; size=&quot;4096&quot;&gt;</span><br><span class=\"line\">    &lt;/directory&gt;</span><br><span class=\"line\">  &lt;/directory&gt;</span><br><span class=\"line\">  &lt;report&gt;</span><br><span class=\"line\">    &lt;directories&gt;5&lt;/directories&gt;</span><br><span class=\"line\">  &lt;/report&gt;</span><br><span class=\"line\">&lt;/tree&gt;</span><br><span class=\"line\">cs@debian:/opt/apache$ tree -LdrtsJ  1 /opt/apache/</span><br><span class=\"line\">[</span><br><span class=\"line\">  &#123;&quot;type&quot;:&quot;directory&quot;,&quot;name&quot;:&quot;/opt/apache/&quot;,&quot;contents&quot;:[</span><br><span class=\"line\">    &#123;&quot;type&quot;:&quot;directory&quot;,&quot;name&quot;:&quot;apache-maven-3.8.6&quot;,&quot;size&quot;:4096,&quot;contents&quot;:[</span><br><span class=\"line\">    ]&#125;,</span><br><span class=\"line\">    &#123;&quot;type&quot;:&quot;directory&quot;,&quot;name&quot;:&quot;tomcat-8.5.38&quot;,&quot;size&quot;:4096,&quot;contents&quot;:[</span><br><span class=\"line\">    ]&#125;,</span><br><span class=\"line\">    &#123;&quot;type&quot;:&quot;directory&quot;,&quot;name&quot;:&quot;maven-3.6.0&quot;,&quot;size&quot;:4096,&quot;contents&quot;:[</span><br><span class=\"line\">    ]&#125;,</span><br><span class=\"line\">    &#123;&quot;type&quot;:&quot;directory&quot;,&quot;name&quot;:&quot;kafka-2.1.1&quot;,&quot;size&quot;:4096,&quot;contents&quot;:[</span><br><span class=\"line\">    ]&#125;,</span><br><span class=\"line\">    &#123;&quot;type&quot;:&quot;directory&quot;,&quot;name&quot;:&quot;zookeeper-3.4.13&quot;,&quot;size&quot;:4096,&quot;contents&quot;:[</span><br><span class=\"line\">    ]&#125;</span><br><span class=\"line\">  ]&#125;,</span><br><span class=\"line\">  &#123;&quot;type&quot;:&quot;report&quot;,&quot;directories&quot;:5&#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>"},{"title":"磁盘或Inode使用率高","date":"2022-06-23T12:26:14.000Z","_content":"\n\n\n## Inode\n\n**一个文件占用一个inode ，且inode是固定的，小文件过多就可能造成磁盘空间剩余挺多，但是inode耗尽的情况。**\n\n### df -i\n\n查看当前系统inode使用情况\n\n\n\n![](/pics/inode-1-2848.png)\n\n一级一级往下，统计inode文件数量。数字大就表示占用inode多\n\n<!--more-->\n\n如果命令在那个目录卡住,表示该目录,文件特多,ctrl+c停止,从该目录开始排查\n\n![](/pics/inode-3-4837.png)\n\n\n\n### wc  -l \n\n```\nfor i in /home/* ; do echo $i; find $i | wc -l; done\n```\n\n![](/pics/inode-2-4723.png)\n\n删除\n\n```\n find  /home/go/test/  -maxdepth 1  -type f   -mtime +0   -exec  rm  -rf  {} \\;\n```\n\n>+1 内表示 1 * 24 +24小时以外..\n>+0 才表示 0 * 24 +24小时以外\n>1 表示 1*24 + 24 到 24 之间..\n>0 表示 0*24 + 24 到 0 之间..\n\n\n\n修改大小\n\n```\n#卸载\numount /home/cs/go \n#建立文件系统，指定inode节点数 \nmkfs.ext3 /dev/sda6 -N 18276352 \n#修改fstab文件 \nvim /etc/fstab \n/dev/sda6 /home/cs/go ext3 defaults 1 2 \n#重新加载并检查挂载文件 \nmount -a \n#查看修改后的inode参数 \ndumpe2fs -h /dev/sda6 | grep node\n\n```\n\n\n\n\n\n多核cpu生成百万文件\n\n```\ncd ~/go/test\nseq 1000000 | xargs -i  -P 0 dd if=/dev/urandom of={}.txt bs=1024 count=1\n```\n\n\n\n## disk\n\n### df  -h\n\n排查目录\n\ndu -sh * | sort  -nr | head -5\n\n\n\n查找大于1G的文件\n\n```console-bash\nfind /  -type f -size +1G\n```\n\n\n\n 没有大文件,查看已经删除的文件\n\n```\nlsof -n |grep deleted\n```\n\n删除的文件有程序在使用,一直没有释放掉,kill掉pid\n\n\n\n## cpu\n\nps -aux | sort -k3nr | head -5\n\n\n\n### top  \n\n shift+p    切到cpu排序高到低\n\n### tid\n\nps -Lfp pid或者ps -mp pid -o THREAD，tid，time或者top -Hp pid\n\n```\nps -mp $pid -o THREAD，tid，time | sort -nr\n```\n\n\n\n#线程ID转成16进制用于查询\n\n```\n$ printf \"%x\\n\"  $tid\na221\n```\n\n### jstack\n\n```\njstack $pid | grep \"a221\"  -A  30\n```\n\n> -A  -B -C(大写)  后面都跟阿拉伯数字 \n>-A是显示匹配后和它后面的n行。after \n>-B是显示匹配行和它前面的n行。 before\n>-C是匹配行和它前后各n行。 context\n\n\n\n```\nps -ef | grep $name\njstack $pid >> ./dump.log\n```\n\n\n\n### Thread Dump\n\n***\\*kill -3 PID命令只能打印那一瞬间java进程的堆栈信息\\****，适合在服务器响应慢，cpu、内存快速飙升等异常情况下使用，可以方便地定位到导致异常发生的java类，解决如死锁、连接超时等原因导致的系统异常问题。**该命令不会杀死进程。**\n\n- tomcat  堆栈信息会打印在catalina.out\n- nohup启动 堆栈信息会在nohup.out\n\n\n\n## mem\n\n\n\n### free -m\n\n\n\nps -aux | sort -k4nr | head -5\n\n\n\n\n\n## 工具\n\narthas  \n\n下载 https://github.com/alibaba/arthas/releases\n\n文档 https://arthas.aliyun.com/doc/advanced-use.html\n\n\n\njvisualvm\n\n${JDK_HOME}\\bin\\jvisualvm\n\nhttps://www.cnblogs.com/mzq123/p/11166640.html","source":"_posts/linux/shell/usage_high.md","raw":"---\ntitle: 磁盘或Inode使用率高\npermalink: linux/shell/usage_high/\ntags:\n  - usage_high\ncategories:\n  - linux\n  - shell\ndate: 2022-06-23 20:26:14\n---\n\n\n\n## Inode\n\n**一个文件占用一个inode ，且inode是固定的，小文件过多就可能造成磁盘空间剩余挺多，但是inode耗尽的情况。**\n\n### df -i\n\n查看当前系统inode使用情况\n\n\n\n![](/pics/inode-1-2848.png)\n\n一级一级往下，统计inode文件数量。数字大就表示占用inode多\n\n<!--more-->\n\n如果命令在那个目录卡住,表示该目录,文件特多,ctrl+c停止,从该目录开始排查\n\n![](/pics/inode-3-4837.png)\n\n\n\n### wc  -l \n\n```\nfor i in /home/* ; do echo $i; find $i | wc -l; done\n```\n\n![](/pics/inode-2-4723.png)\n\n删除\n\n```\n find  /home/go/test/  -maxdepth 1  -type f   -mtime +0   -exec  rm  -rf  {} \\;\n```\n\n>+1 内表示 1 * 24 +24小时以外..\n>+0 才表示 0 * 24 +24小时以外\n>1 表示 1*24 + 24 到 24 之间..\n>0 表示 0*24 + 24 到 0 之间..\n\n\n\n修改大小\n\n```\n#卸载\numount /home/cs/go \n#建立文件系统，指定inode节点数 \nmkfs.ext3 /dev/sda6 -N 18276352 \n#修改fstab文件 \nvim /etc/fstab \n/dev/sda6 /home/cs/go ext3 defaults 1 2 \n#重新加载并检查挂载文件 \nmount -a \n#查看修改后的inode参数 \ndumpe2fs -h /dev/sda6 | grep node\n\n```\n\n\n\n\n\n多核cpu生成百万文件\n\n```\ncd ~/go/test\nseq 1000000 | xargs -i  -P 0 dd if=/dev/urandom of={}.txt bs=1024 count=1\n```\n\n\n\n## disk\n\n### df  -h\n\n排查目录\n\ndu -sh * | sort  -nr | head -5\n\n\n\n查找大于1G的文件\n\n```console-bash\nfind /  -type f -size +1G\n```\n\n\n\n 没有大文件,查看已经删除的文件\n\n```\nlsof -n |grep deleted\n```\n\n删除的文件有程序在使用,一直没有释放掉,kill掉pid\n\n\n\n## cpu\n\nps -aux | sort -k3nr | head -5\n\n\n\n### top  \n\n shift+p    切到cpu排序高到低\n\n### tid\n\nps -Lfp pid或者ps -mp pid -o THREAD，tid，time或者top -Hp pid\n\n```\nps -mp $pid -o THREAD，tid，time | sort -nr\n```\n\n\n\n#线程ID转成16进制用于查询\n\n```\n$ printf \"%x\\n\"  $tid\na221\n```\n\n### jstack\n\n```\njstack $pid | grep \"a221\"  -A  30\n```\n\n> -A  -B -C(大写)  后面都跟阿拉伯数字 \n>-A是显示匹配后和它后面的n行。after \n>-B是显示匹配行和它前面的n行。 before\n>-C是匹配行和它前后各n行。 context\n\n\n\n```\nps -ef | grep $name\njstack $pid >> ./dump.log\n```\n\n\n\n### Thread Dump\n\n***\\*kill -3 PID命令只能打印那一瞬间java进程的堆栈信息\\****，适合在服务器响应慢，cpu、内存快速飙升等异常情况下使用，可以方便地定位到导致异常发生的java类，解决如死锁、连接超时等原因导致的系统异常问题。**该命令不会杀死进程。**\n\n- tomcat  堆栈信息会打印在catalina.out\n- nohup启动 堆栈信息会在nohup.out\n\n\n\n## mem\n\n\n\n### free -m\n\n\n\nps -aux | sort -k4nr | head -5\n\n\n\n\n\n## 工具\n\narthas  \n\n下载 https://github.com/alibaba/arthas/releases\n\n文档 https://arthas.aliyun.com/doc/advanced-use.html\n\n\n\njvisualvm\n\n${JDK_HOME}\\bin\\jvisualvm\n\nhttps://www.cnblogs.com/mzq123/p/11166640.html","slug":"linux/shell/usage_high","published":1,"updated":"2022-08-28T09:10:00.944Z","__permalink":"linux/shell/usage_high/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gttu003ggwi50fin0li9","content":"<h2 id=\"Inode\"><a href=\"#Inode\" class=\"headerlink\" title=\"Inode\"></a>Inode</h2><p><strong>一个文件占用一个inode ，且inode是固定的，小文件过多就可能造成磁盘空间剩余挺多，但是inode耗尽的情况。</strong></p>\n<h3 id=\"df-i\"><a href=\"#df-i\" class=\"headerlink\" title=\"df -i\"></a>df -i</h3><p>查看当前系统inode使用情况</p>\n<p><img src=\"/pics/inode-1-2848.png\"></p>\n<p>一级一级往下，统计inode文件数量。数字大就表示占用inode多</p>\n<span id=\"more\"></span>\n\n<p>如果命令在那个目录卡住,表示该目录,文件特多,ctrl+c停止,从该目录开始排查</p>\n<p><img src=\"/pics/inode-3-4837.png\"></p>\n<h3 id=\"wc-l\"><a href=\"#wc-l\" class=\"headerlink\" title=\"wc  -l\"></a>wc  -l</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for i in /home/* ; do echo $i; find $i | wc -l; done</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/pics/inode-2-4723.png\"></p>\n<p>删除</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find  /home/go/test/  -maxdepth 1  -type f   -mtime +0   -exec  rm  -rf  &#123;&#125; \\;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>+1 内表示 1 * 24 +24小时以外..<br>+0 才表示 0 * 24 +24小时以外<br>1 表示 1<em>24 + 24 到 24 之间..<br>0 表示 0</em>24 + 24 到 0 之间..</p>\n</blockquote>\n<p>修改大小</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#卸载</span><br><span class=\"line\">umount /home/cs/go </span><br><span class=\"line\">#建立文件系统，指定inode节点数 </span><br><span class=\"line\">mkfs.ext3 /dev/sda6 -N 18276352 </span><br><span class=\"line\">#修改fstab文件 </span><br><span class=\"line\">vim /etc/fstab </span><br><span class=\"line\">/dev/sda6 /home/cs/go ext3 defaults 1 2 </span><br><span class=\"line\">#重新加载并检查挂载文件 </span><br><span class=\"line\">mount -a </span><br><span class=\"line\">#查看修改后的inode参数 </span><br><span class=\"line\">dumpe2fs -h /dev/sda6 | grep node</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>多核cpu生成百万文件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~/go/test</span><br><span class=\"line\">seq 1000000 | xargs -i  -P 0 dd if=/dev/urandom of=&#123;&#125;.txt bs=1024 count=1</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"disk\"><a href=\"#disk\" class=\"headerlink\" title=\"disk\"></a>disk</h2><h3 id=\"df-h\"><a href=\"#df-h\" class=\"headerlink\" title=\"df  -h\"></a>df  -h</h3><p>排查目录</p>\n<p>du -sh * | sort  -nr | head -5</p>\n<p>查找大于1G的文件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find /  -type f -size +1G</span><br></pre></td></tr></table></figure>\n\n\n\n<p> 没有大文件,查看已经删除的文件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lsof -n |grep deleted</span><br></pre></td></tr></table></figure>\n\n<p>删除的文件有程序在使用,一直没有释放掉,kill掉pid</p>\n<h2 id=\"cpu\"><a href=\"#cpu\" class=\"headerlink\" title=\"cpu\"></a>cpu</h2><p>ps -aux | sort -k3nr | head -5</p>\n<h3 id=\"top\"><a href=\"#top\" class=\"headerlink\" title=\"top\"></a>top</h3><p> shift+p    切到cpu排序高到低</p>\n<h3 id=\"tid\"><a href=\"#tid\" class=\"headerlink\" title=\"tid\"></a>tid</h3><p>ps -Lfp pid或者ps -mp pid -o THREAD，tid，time或者top -Hp pid</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps -mp $pid -o THREAD，tid，time | sort -nr</span><br></pre></td></tr></table></figure>\n\n\n\n<p>#线程ID转成16进制用于查询</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ printf &quot;%x\\n&quot;  $tid</span><br><span class=\"line\">a221</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"jstack\"><a href=\"#jstack\" class=\"headerlink\" title=\"jstack\"></a>jstack</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jstack $pid | grep &quot;a221&quot;  -A  30</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>-A  -B -C(大写)  后面都跟阿拉伯数字<br>-A是显示匹配后和它后面的n行。after<br>-B是显示匹配行和它前面的n行。 before<br>-C是匹配行和它前后各n行。 context</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps -ef | grep $name</span><br><span class=\"line\">jstack $pid &gt;&gt; ./dump.log</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"Thread-Dump\"><a href=\"#Thread-Dump\" class=\"headerlink\" title=\"Thread Dump\"></a>Thread Dump</h3><p>****kill -3 PID命令只能打印那一瞬间java进程的堆栈信息*<em><strong>，适合在服务器响应慢，cpu、内存快速飙升等异常情况下使用，可以方便地定位到导致异常发生的java类，解决如死锁、连接超时等原因导致的系统异常问题。</strong>该命令不会杀死进程。</em>*</p>\n<ul>\n<li>tomcat  堆栈信息会打印在catalina.out</li>\n<li>nohup启动 堆栈信息会在nohup.out</li>\n</ul>\n<h2 id=\"mem\"><a href=\"#mem\" class=\"headerlink\" title=\"mem\"></a>mem</h2><h3 id=\"free-m\"><a href=\"#free-m\" class=\"headerlink\" title=\"free -m\"></a>free -m</h3><p>ps -aux | sort -k4nr | head -5</p>\n<h2 id=\"工具\"><a href=\"#工具\" class=\"headerlink\" title=\"工具\"></a>工具</h2><p>arthas  </p>\n<p>下载 <a href=\"https://github.com/alibaba/arthas/releases\">https://github.com/alibaba/arthas/releases</a></p>\n<p>文档 <a href=\"https://arthas.aliyun.com/doc/advanced-use.html\">https://arthas.aliyun.com/doc/advanced-use.html</a></p>\n<p>jvisualvm</p>\n<p>${JDK_HOME}\\bin\\jvisualvm</p>\n<p><a href=\"https://www.cnblogs.com/mzq123/p/11166640.html\">https://www.cnblogs.com/mzq123/p/11166640.html</a></p>\n","site":{"data":{}},"excerpt":"<h2 id=\"Inode\"><a href=\"#Inode\" class=\"headerlink\" title=\"Inode\"></a>Inode</h2><p><strong>一个文件占用一个inode ，且inode是固定的，小文件过多就可能造成磁盘空间剩余挺多，但是inode耗尽的情况。</strong></p>\n<h3 id=\"df-i\"><a href=\"#df-i\" class=\"headerlink\" title=\"df -i\"></a>df -i</h3><p>查看当前系统inode使用情况</p>\n<p><img src=\"/pics/inode-1-2848.png\"></p>\n<p>一级一级往下，统计inode文件数量。数字大就表示占用inode多</p>","more":"<p>如果命令在那个目录卡住,表示该目录,文件特多,ctrl+c停止,从该目录开始排查</p>\n<p><img src=\"/pics/inode-3-4837.png\"></p>\n<h3 id=\"wc-l\"><a href=\"#wc-l\" class=\"headerlink\" title=\"wc  -l\"></a>wc  -l</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for i in /home/* ; do echo $i; find $i | wc -l; done</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/pics/inode-2-4723.png\"></p>\n<p>删除</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find  /home/go/test/  -maxdepth 1  -type f   -mtime +0   -exec  rm  -rf  &#123;&#125; \\;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>+1 内表示 1 * 24 +24小时以外..<br>+0 才表示 0 * 24 +24小时以外<br>1 表示 1<em>24 + 24 到 24 之间..<br>0 表示 0</em>24 + 24 到 0 之间..</p>\n</blockquote>\n<p>修改大小</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#卸载</span><br><span class=\"line\">umount /home/cs/go </span><br><span class=\"line\">#建立文件系统，指定inode节点数 </span><br><span class=\"line\">mkfs.ext3 /dev/sda6 -N 18276352 </span><br><span class=\"line\">#修改fstab文件 </span><br><span class=\"line\">vim /etc/fstab </span><br><span class=\"line\">/dev/sda6 /home/cs/go ext3 defaults 1 2 </span><br><span class=\"line\">#重新加载并检查挂载文件 </span><br><span class=\"line\">mount -a </span><br><span class=\"line\">#查看修改后的inode参数 </span><br><span class=\"line\">dumpe2fs -h /dev/sda6 | grep node</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>多核cpu生成百万文件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~/go/test</span><br><span class=\"line\">seq 1000000 | xargs -i  -P 0 dd if=/dev/urandom of=&#123;&#125;.txt bs=1024 count=1</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"disk\"><a href=\"#disk\" class=\"headerlink\" title=\"disk\"></a>disk</h2><h3 id=\"df-h\"><a href=\"#df-h\" class=\"headerlink\" title=\"df  -h\"></a>df  -h</h3><p>排查目录</p>\n<p>du -sh * | sort  -nr | head -5</p>\n<p>查找大于1G的文件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find /  -type f -size +1G</span><br></pre></td></tr></table></figure>\n\n\n\n<p> 没有大文件,查看已经删除的文件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lsof -n |grep deleted</span><br></pre></td></tr></table></figure>\n\n<p>删除的文件有程序在使用,一直没有释放掉,kill掉pid</p>\n<h2 id=\"cpu\"><a href=\"#cpu\" class=\"headerlink\" title=\"cpu\"></a>cpu</h2><p>ps -aux | sort -k3nr | head -5</p>\n<h3 id=\"top\"><a href=\"#top\" class=\"headerlink\" title=\"top\"></a>top</h3><p> shift+p    切到cpu排序高到低</p>\n<h3 id=\"tid\"><a href=\"#tid\" class=\"headerlink\" title=\"tid\"></a>tid</h3><p>ps -Lfp pid或者ps -mp pid -o THREAD，tid，time或者top -Hp pid</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps -mp $pid -o THREAD，tid，time | sort -nr</span><br></pre></td></tr></table></figure>\n\n\n\n<p>#线程ID转成16进制用于查询</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ printf &quot;%x\\n&quot;  $tid</span><br><span class=\"line\">a221</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"jstack\"><a href=\"#jstack\" class=\"headerlink\" title=\"jstack\"></a>jstack</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jstack $pid | grep &quot;a221&quot;  -A  30</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>-A  -B -C(大写)  后面都跟阿拉伯数字<br>-A是显示匹配后和它后面的n行。after<br>-B是显示匹配行和它前面的n行。 before<br>-C是匹配行和它前后各n行。 context</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps -ef | grep $name</span><br><span class=\"line\">jstack $pid &gt;&gt; ./dump.log</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"Thread-Dump\"><a href=\"#Thread-Dump\" class=\"headerlink\" title=\"Thread Dump\"></a>Thread Dump</h3><p>****kill -3 PID命令只能打印那一瞬间java进程的堆栈信息*<em><strong>，适合在服务器响应慢，cpu、内存快速飙升等异常情况下使用，可以方便地定位到导致异常发生的java类，解决如死锁、连接超时等原因导致的系统异常问题。</strong>该命令不会杀死进程。</em>*</p>\n<ul>\n<li>tomcat  堆栈信息会打印在catalina.out</li>\n<li>nohup启动 堆栈信息会在nohup.out</li>\n</ul>\n<h2 id=\"mem\"><a href=\"#mem\" class=\"headerlink\" title=\"mem\"></a>mem</h2><h3 id=\"free-m\"><a href=\"#free-m\" class=\"headerlink\" title=\"free -m\"></a>free -m</h3><p>ps -aux | sort -k4nr | head -5</p>\n<h2 id=\"工具\"><a href=\"#工具\" class=\"headerlink\" title=\"工具\"></a>工具</h2><p>arthas  </p>\n<p>下载 <a href=\"https://github.com/alibaba/arthas/releases\">https://github.com/alibaba/arthas/releases</a></p>\n<p>文档 <a href=\"https://arthas.aliyun.com/doc/advanced-use.html\">https://arthas.aliyun.com/doc/advanced-use.html</a></p>\n<p>jvisualvm</p>\n<p>${JDK_HOME}\\bin\\jvisualvm</p>\n<p><a href=\"https://www.cnblogs.com/mzq123/p/11166640.html\">https://www.cnblogs.com/mzq123/p/11166640.html</a></p>"},{"title":"vi/vim基本命令","date":"2022-06-13T12:51:38.000Z","_content":"\n\n\n![](/pics/vim-4855.png)\n\necs 退出 **编辑状态**  到  **命令状态** \n\n### 插入\n\n在光标前 `i`\n\n移到在行首 `I`\n\n光标后 `a`\n\n当前行尾 `A`\n\n当前行之下另起一行 `o` 进入编辑状态\n\n当前行之上另起一行 `O`\n\n##### 替换\n\n当前字符 `r`\n<!--more-->\n\n当前及其后,直到按Esc `R`\n\n#####  粘贴\n\n 剪切  `dd`当前行  ,移动到目标行 `p`粘贴\n\n复制  `yy`当前行  ,`p`粘贴  \n\n复制2个单词 `y2w`  向下2行 `y2j`  向上2行 `y2k`\n\n寄存器 `:reg [args]`  **+**剪切板\n\n复制当前行 `\"+yy`   `\"+nyy`\n\n剪切板内容粘贴到光标后 `\"+p`\n\n\n\n##### 搜索\n\n跳到指定行(21行) `:21`  或 `21G`   \n\n返回原光标处 ` ``  `\n\n##### 移动\n\n左`j` 下`j` 上`k` 右`l`\n\n单词末尾 `e`\n\n2个单词   前移  `2b`  后移 `2w`\n\n行首  `0` 或 `^`           行尾 `$`  2行行尾 `2$`\n\n上行(减号)  `-`   下行  `+`\n\n\n\n跳到对应括号(代码块)  `%`\n\n### 恢复\n\n撤销(本次编辑模式没有改动) `u`\n\n恢复上一步撤销  `ctrl+r`\n\n### 删除\n\n删除字符 `x`\n\n删除当前行及后面n-1行  `ndd` \n\n\n\n### 退出\n\n保存 `:wq` 或 `:x`\n\n强制退出 `:q!`\n\n\n\n\n\n### 编辑压缩包内文件\n\n 打开压缩包 进入文件可以编辑  （/name ）  **待验证**\n\n\n\n\n\nLANG=”Zn_CN.UTF-8”  #临时设置语言\n\necho $LANG #当前系统设置编码 \n","source":"_posts/linux/shell/vim.md","raw":"---\ntitle: vi/vim基本命令\npermalink: linux/shell/vim/\ntags:\n  - vim\ncategories:\n  - linux\n  - shell\ndate: 2022-06-13 20:51:38\n---\n\n\n\n![](/pics/vim-4855.png)\n\necs 退出 **编辑状态**  到  **命令状态** \n\n### 插入\n\n在光标前 `i`\n\n移到在行首 `I`\n\n光标后 `a`\n\n当前行尾 `A`\n\n当前行之下另起一行 `o` 进入编辑状态\n\n当前行之上另起一行 `O`\n\n##### 替换\n\n当前字符 `r`\n<!--more-->\n\n当前及其后,直到按Esc `R`\n\n#####  粘贴\n\n 剪切  `dd`当前行  ,移动到目标行 `p`粘贴\n\n复制  `yy`当前行  ,`p`粘贴  \n\n复制2个单词 `y2w`  向下2行 `y2j`  向上2行 `y2k`\n\n寄存器 `:reg [args]`  **+**剪切板\n\n复制当前行 `\"+yy`   `\"+nyy`\n\n剪切板内容粘贴到光标后 `\"+p`\n\n\n\n##### 搜索\n\n跳到指定行(21行) `:21`  或 `21G`   \n\n返回原光标处 ` ``  `\n\n##### 移动\n\n左`j` 下`j` 上`k` 右`l`\n\n单词末尾 `e`\n\n2个单词   前移  `2b`  后移 `2w`\n\n行首  `0` 或 `^`           行尾 `$`  2行行尾 `2$`\n\n上行(减号)  `-`   下行  `+`\n\n\n\n跳到对应括号(代码块)  `%`\n\n### 恢复\n\n撤销(本次编辑模式没有改动) `u`\n\n恢复上一步撤销  `ctrl+r`\n\n### 删除\n\n删除字符 `x`\n\n删除当前行及后面n-1行  `ndd` \n\n\n\n### 退出\n\n保存 `:wq` 或 `:x`\n\n强制退出 `:q!`\n\n\n\n\n\n### 编辑压缩包内文件\n\n 打开压缩包 进入文件可以编辑  （/name ）  **待验证**\n\n\n\n\n\nLANG=”Zn_CN.UTF-8”  #临时设置语言\n\necho $LANG #当前系统设置编码 \n","slug":"linux/shell/vim","published":1,"updated":"2022-08-28T09:10:00.948Z","__permalink":"linux/shell/vim/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gttu003jgwi59jxf75k3","content":"<p><img src=\"/pics/vim-4855.png\"></p>\n<p>ecs 退出 <strong>编辑状态</strong>  到  <strong>命令状态</strong> </p>\n<h3 id=\"插入\"><a href=\"#插入\" class=\"headerlink\" title=\"插入\"></a>插入</h3><p>在光标前 <code>i</code></p>\n<p>移到在行首 <code>I</code></p>\n<p>光标后 <code>a</code></p>\n<p>当前行尾 <code>A</code></p>\n<p>当前行之下另起一行 <code>o</code> 进入编辑状态</p>\n<p>当前行之上另起一行 <code>O</code></p>\n<h5 id=\"替换\"><a href=\"#替换\" class=\"headerlink\" title=\"替换\"></a>替换</h5><p>当前字符 <code>r</code></p>\n<span id=\"more\"></span>\n\n<p>当前及其后,直到按Esc <code>R</code></p>\n<h5 id=\"粘贴\"><a href=\"#粘贴\" class=\"headerlink\" title=\"粘贴\"></a>粘贴</h5><p> 剪切  <code>dd</code>当前行  ,移动到目标行 <code>p</code>粘贴</p>\n<p>复制  <code>yy</code>当前行  ,<code>p</code>粘贴  </p>\n<p>复制2个单词 <code>y2w</code>  向下2行 <code>y2j</code>  向上2行 <code>y2k</code></p>\n<p>寄存器 <code>:reg [args]</code>  **+**剪切板</p>\n<p>复制当前行 <code>&quot;+yy</code>   <code>&quot;+nyy</code></p>\n<p>剪切板内容粘贴到光标后 <code>&quot;+p</code></p>\n<h5 id=\"搜索\"><a href=\"#搜索\" class=\"headerlink\" title=\"搜索\"></a>搜索</h5><p>跳到指定行(21行) <code>:21</code>  或 <code>21G</code>   </p>\n<p>返回原光标处 <code>`` </code></p>\n<h5 id=\"移动\"><a href=\"#移动\" class=\"headerlink\" title=\"移动\"></a>移动</h5><p>左<code>j</code> 下<code>j</code> 上<code>k</code> 右<code>l</code></p>\n<p>单词末尾 <code>e</code></p>\n<p>2个单词   前移  <code>2b</code>  后移 <code>2w</code></p>\n<p>行首  <code>0</code> 或 <code>^</code>           行尾 <code>$</code>  2行行尾 <code>2$</code></p>\n<p>上行(减号)  <code>-</code>   下行  <code>+</code></p>\n<p>跳到对应括号(代码块)  <code>%</code></p>\n<h3 id=\"恢复\"><a href=\"#恢复\" class=\"headerlink\" title=\"恢复\"></a>恢复</h3><p>撤销(本次编辑模式没有改动) <code>u</code></p>\n<p>恢复上一步撤销  <code>ctrl+r</code></p>\n<h3 id=\"删除\"><a href=\"#删除\" class=\"headerlink\" title=\"删除\"></a>删除</h3><p>删除字符 <code>x</code></p>\n<p>删除当前行及后面n-1行  <code>ndd</code> </p>\n<h3 id=\"退出\"><a href=\"#退出\" class=\"headerlink\" title=\"退出\"></a>退出</h3><p>保存 <code>:wq</code> 或 <code>:x</code></p>\n<p>强制退出 <code>:q!</code></p>\n<h3 id=\"编辑压缩包内文件\"><a href=\"#编辑压缩包内文件\" class=\"headerlink\" title=\"编辑压缩包内文件\"></a>编辑压缩包内文件</h3><p> 打开压缩包 进入文件可以编辑  （&#x2F;name ）  <strong>待验证</strong></p>\n<p>LANG&#x3D;”Zn_CN.UTF-8”  #临时设置语言</p>\n<p>echo $LANG #当前系统设置编码 </p>\n","site":{"data":{}},"excerpt":"<p><img src=\"/pics/vim-4855.png\"></p>\n<p>ecs 退出 <strong>编辑状态</strong>  到  <strong>命令状态</strong> </p>\n<h3 id=\"插入\"><a href=\"#插入\" class=\"headerlink\" title=\"插入\"></a>插入</h3><p>在光标前 <code>i</code></p>\n<p>移到在行首 <code>I</code></p>\n<p>光标后 <code>a</code></p>\n<p>当前行尾 <code>A</code></p>\n<p>当前行之下另起一行 <code>o</code> 进入编辑状态</p>\n<p>当前行之上另起一行 <code>O</code></p>\n<h5 id=\"替换\"><a href=\"#替换\" class=\"headerlink\" title=\"替换\"></a>替换</h5><p>当前字符 <code>r</code></p>","more":"<p>当前及其后,直到按Esc <code>R</code></p>\n<h5 id=\"粘贴\"><a href=\"#粘贴\" class=\"headerlink\" title=\"粘贴\"></a>粘贴</h5><p> 剪切  <code>dd</code>当前行  ,移动到目标行 <code>p</code>粘贴</p>\n<p>复制  <code>yy</code>当前行  ,<code>p</code>粘贴  </p>\n<p>复制2个单词 <code>y2w</code>  向下2行 <code>y2j</code>  向上2行 <code>y2k</code></p>\n<p>寄存器 <code>:reg [args]</code>  **+**剪切板</p>\n<p>复制当前行 <code>&quot;+yy</code>   <code>&quot;+nyy</code></p>\n<p>剪切板内容粘贴到光标后 <code>&quot;+p</code></p>\n<h5 id=\"搜索\"><a href=\"#搜索\" class=\"headerlink\" title=\"搜索\"></a>搜索</h5><p>跳到指定行(21行) <code>:21</code>  或 <code>21G</code>   </p>\n<p>返回原光标处 <code>`` </code></p>\n<h5 id=\"移动\"><a href=\"#移动\" class=\"headerlink\" title=\"移动\"></a>移动</h5><p>左<code>j</code> 下<code>j</code> 上<code>k</code> 右<code>l</code></p>\n<p>单词末尾 <code>e</code></p>\n<p>2个单词   前移  <code>2b</code>  后移 <code>2w</code></p>\n<p>行首  <code>0</code> 或 <code>^</code>           行尾 <code>$</code>  2行行尾 <code>2$</code></p>\n<p>上行(减号)  <code>-</code>   下行  <code>+</code></p>\n<p>跳到对应括号(代码块)  <code>%</code></p>\n<h3 id=\"恢复\"><a href=\"#恢复\" class=\"headerlink\" title=\"恢复\"></a>恢复</h3><p>撤销(本次编辑模式没有改动) <code>u</code></p>\n<p>恢复上一步撤销  <code>ctrl+r</code></p>\n<h3 id=\"删除\"><a href=\"#删除\" class=\"headerlink\" title=\"删除\"></a>删除</h3><p>删除字符 <code>x</code></p>\n<p>删除当前行及后面n-1行  <code>ndd</code> </p>\n<h3 id=\"退出\"><a href=\"#退出\" class=\"headerlink\" title=\"退出\"></a>退出</h3><p>保存 <code>:wq</code> 或 <code>:x</code></p>\n<p>强制退出 <code>:q!</code></p>\n<h3 id=\"编辑压缩包内文件\"><a href=\"#编辑压缩包内文件\" class=\"headerlink\" title=\"编辑压缩包内文件\"></a>编辑压缩包内文件</h3><p> 打开压缩包 进入文件可以编辑  （&#x2F;name ）  <strong>待验证</strong></p>\n<p>LANG&#x3D;”Zn_CN.UTF-8”  #临时设置语言</p>\n<p>echo $LANG #当前系统设置编码 </p>"},{"title":"tomcat优化","date":"2022-07-16T09:00:55.000Z","_content":"\n\n\n\n\n## jvm参数\n\n\n\n```\nJAVA_OPTS=\"-server -XX:NewSize=256m -XX:MaxNewSize=256m -XX:PermSize=512M -XX:MaxPermSize=1024m -Xms2048m -Xmx2048m \"\n```\n\n\n\n>-Xms：Java虚拟机初始化时堆的最小内存，一般与 Xmx配置为相同值，这样的好处是GC不必再为扩展内存空间而消耗性能；\n>\n>-Xmx：Java虚拟机可使用堆的最大内存；\n>\n>-XX:PermSize：Java虚拟机永久代大小；\n>\n>-XX:MaxPermSize：Java虚拟机永久代大小最大值；\n>\n>-XX:NewSize=：新生代空间初始化大小 \n>\n>-XX:MaxNewSize=：新生代空间最大值\n\n## 配置优化\n\n### 连接属性\n\n/tomcat-8.5.38/conf/server.xml\n\n\n\nhttps://tomcat.apache.org/tomcat-8.5-doc/config/executor.html\n\n```\n<Executor   name=\"tomcatThreadPool\"\n  namePrefix=\"req-thead-exc\"\n  maxHttpHeaderSize=\"8192\" \n  maxThreads=\"1000\"\n  minSpareThreads=\"75\"\n  maxQueueSize=\"Integer.MAX_VALUE\"\n  maxIdleTime=\"60000\"\n  threadPriority=\"5\"\n  className=\"org.apache.catalina.core.StandardThreadExecutor\"\n />\n```\n\n> maxThreads:  服务器端最佳线程数量=((线程等待时间+线程cpu时间)/线程cpu时间) * cpu数量,压测计算,要排除单纯处理业务耗时方法,如果未指定，默认值为200\n>\n> minSpareThreads：线程的最小运行数目，这些始终保持运行。如果未指定，默认值为10。\n>\n> maxHttpHeaderSize：请求和响应的HTTP头的最大大小，以字节为单位指定。如果没有指定，这个属性被设置为8192（8 KB）。\n\n\n\n\n\n```\nsed -i '/connectionTimeout=/i\\  executor=\"tomcatThreadPool\"' /opt/apache/tomcat-8.5.38/conf/server.xml \n\n<Connector port=\"8080\" protocol=\"HTTP/1.1\" \n  executor=\"tomcatThreadPool\"\n  connectionTimeout=\"20000\"   \n  redirectPort=\"8443\" />  \n```\n\n> connectionTimeout代表连接超时时间，单位为毫秒,默认值为60000。通常情况下设置为30000。\n\nhttps://tomcat.apache.org/tomcat-8.5-doc/config/http.html\n\n\n\n###  cache\n\n/tomcat-8.5.38/conf/context.xml\n\ntomcat8以上对resource采取了cache，而默认的大小是10M\n\n\n\nconsider increasing the maximum size of the cache\n\n\n\n```\nsed -i '/^<\\/Context>/i\\<Resources cachingAllowed=\"true\"  cacheMaxSize=\"102400\" \\/>'  /opt/apache/tomcat-8.5.38/conf/context.xml\n```\n\n><Resources cachingAllowed=\"true\"  cacheMaxSize=\"102400\" />\n>\n>context.xml文件内添加到<Context>节点内</Context>\n>\n>cacheMaxSize值按需设置,单位K , ","source":"_posts/services/container/tomcat.md","raw":"---\ntitle: tomcat优化\npermalink: services/container/tomcat/\ntags:\n  - tomcat\ncategories:\n  - services\n  - container\ndate: 2022-07-16 17:00:55\n---\n\n\n\n\n\n## jvm参数\n\n\n\n```\nJAVA_OPTS=\"-server -XX:NewSize=256m -XX:MaxNewSize=256m -XX:PermSize=512M -XX:MaxPermSize=1024m -Xms2048m -Xmx2048m \"\n```\n\n\n\n>-Xms：Java虚拟机初始化时堆的最小内存，一般与 Xmx配置为相同值，这样的好处是GC不必再为扩展内存空间而消耗性能；\n>\n>-Xmx：Java虚拟机可使用堆的最大内存；\n>\n>-XX:PermSize：Java虚拟机永久代大小；\n>\n>-XX:MaxPermSize：Java虚拟机永久代大小最大值；\n>\n>-XX:NewSize=：新生代空间初始化大小 \n>\n>-XX:MaxNewSize=：新生代空间最大值\n\n## 配置优化\n\n### 连接属性\n\n/tomcat-8.5.38/conf/server.xml\n\n\n\nhttps://tomcat.apache.org/tomcat-8.5-doc/config/executor.html\n\n```\n<Executor   name=\"tomcatThreadPool\"\n  namePrefix=\"req-thead-exc\"\n  maxHttpHeaderSize=\"8192\" \n  maxThreads=\"1000\"\n  minSpareThreads=\"75\"\n  maxQueueSize=\"Integer.MAX_VALUE\"\n  maxIdleTime=\"60000\"\n  threadPriority=\"5\"\n  className=\"org.apache.catalina.core.StandardThreadExecutor\"\n />\n```\n\n> maxThreads:  服务器端最佳线程数量=((线程等待时间+线程cpu时间)/线程cpu时间) * cpu数量,压测计算,要排除单纯处理业务耗时方法,如果未指定，默认值为200\n>\n> minSpareThreads：线程的最小运行数目，这些始终保持运行。如果未指定，默认值为10。\n>\n> maxHttpHeaderSize：请求和响应的HTTP头的最大大小，以字节为单位指定。如果没有指定，这个属性被设置为8192（8 KB）。\n\n\n\n\n\n```\nsed -i '/connectionTimeout=/i\\  executor=\"tomcatThreadPool\"' /opt/apache/tomcat-8.5.38/conf/server.xml \n\n<Connector port=\"8080\" protocol=\"HTTP/1.1\" \n  executor=\"tomcatThreadPool\"\n  connectionTimeout=\"20000\"   \n  redirectPort=\"8443\" />  \n```\n\n> connectionTimeout代表连接超时时间，单位为毫秒,默认值为60000。通常情况下设置为30000。\n\nhttps://tomcat.apache.org/tomcat-8.5-doc/config/http.html\n\n\n\n###  cache\n\n/tomcat-8.5.38/conf/context.xml\n\ntomcat8以上对resource采取了cache，而默认的大小是10M\n\n\n\nconsider increasing the maximum size of the cache\n\n\n\n```\nsed -i '/^<\\/Context>/i\\<Resources cachingAllowed=\"true\"  cacheMaxSize=\"102400\" \\/>'  /opt/apache/tomcat-8.5.38/conf/context.xml\n```\n\n><Resources cachingAllowed=\"true\"  cacheMaxSize=\"102400\" />\n>\n>context.xml文件内添加到<Context>节点内</Context>\n>\n>cacheMaxSize值按需设置,单位K , ","slug":"services/container/tomcat","published":1,"updated":"2022-08-28T09:10:00.936Z","__permalink":"services/container/tomcat/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gttv003mgwi59eonekan","content":"<h2 id=\"jvm参数\"><a href=\"#jvm参数\" class=\"headerlink\" title=\"jvm参数\"></a>jvm参数</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JAVA_OPTS=&quot;-server -XX:NewSize=256m -XX:MaxNewSize=256m -XX:PermSize=512M -XX:MaxPermSize=1024m -Xms2048m -Xmx2048m &quot;</span><br></pre></td></tr></table></figure>\n\n\n\n<blockquote>\n<p>-Xms：Java虚拟机初始化时堆的最小内存，一般与 Xmx配置为相同值，这样的好处是GC不必再为扩展内存空间而消耗性能；</p>\n<p>-Xmx：Java虚拟机可使用堆的最大内存；</p>\n<p>-XX:PermSize：Java虚拟机永久代大小；</p>\n<p>-XX:MaxPermSize：Java虚拟机永久代大小最大值；</p>\n<p>-XX:NewSize&#x3D;：新生代空间初始化大小 </p>\n<p>-XX:MaxNewSize&#x3D;：新生代空间最大值</p>\n</blockquote>\n<h2 id=\"配置优化\"><a href=\"#配置优化\" class=\"headerlink\" title=\"配置优化\"></a>配置优化</h2><h3 id=\"连接属性\"><a href=\"#连接属性\" class=\"headerlink\" title=\"连接属性\"></a>连接属性</h3><p>&#x2F;tomcat-8.5.38&#x2F;conf&#x2F;server.xml</p>\n<p><a href=\"https://tomcat.apache.org/tomcat-8.5-doc/config/executor.html\">https://tomcat.apache.org/tomcat-8.5-doc/config/executor.html</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;Executor   name=&quot;tomcatThreadPool&quot;</span><br><span class=\"line\">  namePrefix=&quot;req-thead-exc&quot;</span><br><span class=\"line\">  maxHttpHeaderSize=&quot;8192&quot; </span><br><span class=\"line\">  maxThreads=&quot;1000&quot;</span><br><span class=\"line\">  minSpareThreads=&quot;75&quot;</span><br><span class=\"line\">  maxQueueSize=&quot;Integer.MAX_VALUE&quot;</span><br><span class=\"line\">  maxIdleTime=&quot;60000&quot;</span><br><span class=\"line\">  threadPriority=&quot;5&quot;</span><br><span class=\"line\">  className=&quot;org.apache.catalina.core.StandardThreadExecutor&quot;</span><br><span class=\"line\"> /&gt;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>maxThreads:  服务器端最佳线程数量&#x3D;((线程等待时间+线程cpu时间)&#x2F;线程cpu时间) * cpu数量,压测计算,要排除单纯处理业务耗时方法,如果未指定，默认值为200</p>\n<p>minSpareThreads：线程的最小运行数目，这些始终保持运行。如果未指定，默认值为10。</p>\n<p>maxHttpHeaderSize：请求和响应的HTTP头的最大大小，以字节为单位指定。如果没有指定，这个属性被设置为8192（8 KB）。</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i &#x27;/connectionTimeout=/i\\  executor=&quot;tomcatThreadPool&quot;&#x27; /opt/apache/tomcat-8.5.38/conf/server.xml </span><br><span class=\"line\"></span><br><span class=\"line\">&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot; </span><br><span class=\"line\">  executor=&quot;tomcatThreadPool&quot;</span><br><span class=\"line\">  connectionTimeout=&quot;20000&quot;   </span><br><span class=\"line\">  redirectPort=&quot;8443&quot; /&gt;  </span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>connectionTimeout代表连接超时时间，单位为毫秒,默认值为60000。通常情况下设置为30000。</p>\n</blockquote>\n<p><a href=\"https://tomcat.apache.org/tomcat-8.5-doc/config/http.html\">https://tomcat.apache.org/tomcat-8.5-doc/config/http.html</a></p>\n<h3 id=\"cache\"><a href=\"#cache\" class=\"headerlink\" title=\"cache\"></a>cache</h3><p>&#x2F;tomcat-8.5.38&#x2F;conf&#x2F;context.xml</p>\n<p>tomcat8以上对resource采取了cache，而默认的大小是10M</p>\n<p>consider increasing the maximum size of the cache</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i &#x27;/^&lt;\\/Context&gt;/i\\&lt;Resources cachingAllowed=&quot;true&quot;  cacheMaxSize=&quot;102400&quot; \\/&gt;&#x27;  /opt/apache/tomcat-8.5.38/conf/context.xml</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<Resources cachingAllowed=\"true\"  cacheMaxSize=\"102400\" />\n\n<p>context.xml文件内添加到<Context>节点内</Context></p>\n<p>cacheMaxSize值按需设置,单位K , </p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"jvm参数\"><a href=\"#jvm参数\" class=\"headerlink\" title=\"jvm参数\"></a>jvm参数</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JAVA_OPTS=&quot;-server -XX:NewSize=256m -XX:MaxNewSize=256m -XX:PermSize=512M -XX:MaxPermSize=1024m -Xms2048m -Xmx2048m &quot;</span><br></pre></td></tr></table></figure>\n\n\n\n<blockquote>\n<p>-Xms：Java虚拟机初始化时堆的最小内存，一般与 Xmx配置为相同值，这样的好处是GC不必再为扩展内存空间而消耗性能；</p>\n<p>-Xmx：Java虚拟机可使用堆的最大内存；</p>\n<p>-XX:PermSize：Java虚拟机永久代大小；</p>\n<p>-XX:MaxPermSize：Java虚拟机永久代大小最大值；</p>\n<p>-XX:NewSize&#x3D;：新生代空间初始化大小 </p>\n<p>-XX:MaxNewSize&#x3D;：新生代空间最大值</p>\n</blockquote>\n<h2 id=\"配置优化\"><a href=\"#配置优化\" class=\"headerlink\" title=\"配置优化\"></a>配置优化</h2><h3 id=\"连接属性\"><a href=\"#连接属性\" class=\"headerlink\" title=\"连接属性\"></a>连接属性</h3><p>&#x2F;tomcat-8.5.38&#x2F;conf&#x2F;server.xml</p>\n<p><a href=\"https://tomcat.apache.org/tomcat-8.5-doc/config/executor.html\">https://tomcat.apache.org/tomcat-8.5-doc/config/executor.html</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;Executor   name=&quot;tomcatThreadPool&quot;</span><br><span class=\"line\">  namePrefix=&quot;req-thead-exc&quot;</span><br><span class=\"line\">  maxHttpHeaderSize=&quot;8192&quot; </span><br><span class=\"line\">  maxThreads=&quot;1000&quot;</span><br><span class=\"line\">  minSpareThreads=&quot;75&quot;</span><br><span class=\"line\">  maxQueueSize=&quot;Integer.MAX_VALUE&quot;</span><br><span class=\"line\">  maxIdleTime=&quot;60000&quot;</span><br><span class=\"line\">  threadPriority=&quot;5&quot;</span><br><span class=\"line\">  className=&quot;org.apache.catalina.core.StandardThreadExecutor&quot;</span><br><span class=\"line\"> /&gt;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>maxThreads:  服务器端最佳线程数量&#x3D;((线程等待时间+线程cpu时间)&#x2F;线程cpu时间) * cpu数量,压测计算,要排除单纯处理业务耗时方法,如果未指定，默认值为200</p>\n<p>minSpareThreads：线程的最小运行数目，这些始终保持运行。如果未指定，默认值为10。</p>\n<p>maxHttpHeaderSize：请求和响应的HTTP头的最大大小，以字节为单位指定。如果没有指定，这个属性被设置为8192（8 KB）。</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i &#x27;/connectionTimeout=/i\\  executor=&quot;tomcatThreadPool&quot;&#x27; /opt/apache/tomcat-8.5.38/conf/server.xml </span><br><span class=\"line\"></span><br><span class=\"line\">&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot; </span><br><span class=\"line\">  executor=&quot;tomcatThreadPool&quot;</span><br><span class=\"line\">  connectionTimeout=&quot;20000&quot;   </span><br><span class=\"line\">  redirectPort=&quot;8443&quot; /&gt;  </span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>connectionTimeout代表连接超时时间，单位为毫秒,默认值为60000。通常情况下设置为30000。</p>\n</blockquote>\n<p><a href=\"https://tomcat.apache.org/tomcat-8.5-doc/config/http.html\">https://tomcat.apache.org/tomcat-8.5-doc/config/http.html</a></p>\n<h3 id=\"cache\"><a href=\"#cache\" class=\"headerlink\" title=\"cache\"></a>cache</h3><p>&#x2F;tomcat-8.5.38&#x2F;conf&#x2F;context.xml</p>\n<p>tomcat8以上对resource采取了cache，而默认的大小是10M</p>\n<p>consider increasing the maximum size of the cache</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i &#x27;/^&lt;\\/Context&gt;/i\\&lt;Resources cachingAllowed=&quot;true&quot;  cacheMaxSize=&quot;102400&quot; \\/&gt;&#x27;  /opt/apache/tomcat-8.5.38/conf/context.xml</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<Resources cachingAllowed=\"true\"  cacheMaxSize=\"102400\" />\n\n<p>context.xml文件内添加到<Context>节点内</Context></p>\n<p>cacheMaxSize值按需设置,单位K , </p>\n</blockquote>\n"},{"title":"mongodb","date":"2022-07-13T13:16:06.000Z","_content":"\n\n\n# linux 环境\n\n## 下载 \n\nwget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-debian81-3.4.4.tgz\n\n```\ntar zxvf mongodb*.tar\nmv /opt/mongo*  /opt\ncd /opt/mongodb*  && touch  mongodb.conf\n```\n\n## 配置文件\n\n```\ndbpath=/home/cs/Download/mongodb/data #数据库路径\nlogpath=/home/cs/Download/mongodb/data/logs/mongodb.log #日志输出文件路径\nlogappend=true #错误日志采用追加模式，配置这个选项后mongodb的日志会追加到现有的日志文件，而不是从新创建一个新文件\njournal=true #启用日志文件，默认启用\nquiet=true #这个选项可以过滤掉一些无用的日志信息，若需要调试使用请设置为false\nport=27017 #端口号 默认为27017\n```\n\n启动\n\n```\ncs@debian:/opt/mongodb-3.4.4/bin$ ./mongod  --config  /opt/mongodb-3.4.4/mongodb.conf\n```\n\n\n后台运行\n\n```\nmongo  -f   mongo.conf   & \n```\n\n\n使用 fork 必须加上logpath\n\n```\nmongo   --fork  --logpath=log/mongodb.log   \n\n```\n\n多条命令执行时 &&  可以把 fork配置到conf\n\n\n```\necho   { \\\n                echo 'dbpath=/data/db'; \\\n                echo 'port=27017'; \\\n                echo 'logpath=/data/mongo.log'; \\\n                echo 'logappend=true'; \\\n                echo 'fork=true'; \\\n             } > mongod.conf  \n```\n\n\n\n## 启动\n\nmongo-start.sh\n\n```\n#!/bin/bash\ncd /opt/mongodb-3.4.4/bin \n./mongod  --config  /opt/mongodb-3.4.4/mongodb.conf  &\nexit\n!\n```\n\n\n\n# win 环境\n\n下载  http://dl.mongodb.org/dl/win32/x86_64\nzip 免安装包\n\n\n\n启动\n\n```\nE:\\MongoDB\\Server\\bin>mongod.exe --config  E:\\MongoDB\\mongo.conf\n```\n\nmongo.conf\n\n```\ndbpath=E:\\MongoDB\\data #数据库路径\nlogpath=E:\\MongoDB\\logs\\mongodb.log #日志输出文件路径\nlogappend=true #错误日志采用追加模式，配置这个选项后mongodb的日志会追加到现有的日志文件，而不是从新创建一个新文件\njournal=true #启用日志文件，默认启用\nquiet=true #这个选项可以过滤掉一些无用的日志信息，若需要调试使用请设置为false\nport=27017 #端口号 默认为27017\n```\n\n打开 http://127.0.0.1:27017/ \nIt looks like you are trying to access MongoDB over HTTP on the native driver port.\n\n## 安装服务\n\n管理员cmd\nE:\\MongoDB\\Server\\bin>`mongod --install --serviceName \"MongoDB\" --config` \"E:\\MongoDB\\mongo.conf\"\nE:\\MongoDB\\Server\\bin>  `net  start MongoDB`  \n\n## 删除服务\n\n`sc delete MongoDB`\n\n\n\n\n\nhttps://www.runoob.com/mongodb/mongodb-connections.html","source":"_posts/services/database/mongo.md","raw":"---\ntitle: mongodb\npermalink: database/mongo/\ntags:\n  - mongodb\ncategories:\n  - database\ndate: 2022-07-13 21:16:06\n---\n\n\n\n# linux 环境\n\n## 下载 \n\nwget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-debian81-3.4.4.tgz\n\n```\ntar zxvf mongodb*.tar\nmv /opt/mongo*  /opt\ncd /opt/mongodb*  && touch  mongodb.conf\n```\n\n## 配置文件\n\n```\ndbpath=/home/cs/Download/mongodb/data #数据库路径\nlogpath=/home/cs/Download/mongodb/data/logs/mongodb.log #日志输出文件路径\nlogappend=true #错误日志采用追加模式，配置这个选项后mongodb的日志会追加到现有的日志文件，而不是从新创建一个新文件\njournal=true #启用日志文件，默认启用\nquiet=true #这个选项可以过滤掉一些无用的日志信息，若需要调试使用请设置为false\nport=27017 #端口号 默认为27017\n```\n\n启动\n\n```\ncs@debian:/opt/mongodb-3.4.4/bin$ ./mongod  --config  /opt/mongodb-3.4.4/mongodb.conf\n```\n\n\n后台运行\n\n```\nmongo  -f   mongo.conf   & \n```\n\n\n使用 fork 必须加上logpath\n\n```\nmongo   --fork  --logpath=log/mongodb.log   \n\n```\n\n多条命令执行时 &&  可以把 fork配置到conf\n\n\n```\necho   { \\\n                echo 'dbpath=/data/db'; \\\n                echo 'port=27017'; \\\n                echo 'logpath=/data/mongo.log'; \\\n                echo 'logappend=true'; \\\n                echo 'fork=true'; \\\n             } > mongod.conf  \n```\n\n\n\n## 启动\n\nmongo-start.sh\n\n```\n#!/bin/bash\ncd /opt/mongodb-3.4.4/bin \n./mongod  --config  /opt/mongodb-3.4.4/mongodb.conf  &\nexit\n!\n```\n\n\n\n# win 环境\n\n下载  http://dl.mongodb.org/dl/win32/x86_64\nzip 免安装包\n\n\n\n启动\n\n```\nE:\\MongoDB\\Server\\bin>mongod.exe --config  E:\\MongoDB\\mongo.conf\n```\n\nmongo.conf\n\n```\ndbpath=E:\\MongoDB\\data #数据库路径\nlogpath=E:\\MongoDB\\logs\\mongodb.log #日志输出文件路径\nlogappend=true #错误日志采用追加模式，配置这个选项后mongodb的日志会追加到现有的日志文件，而不是从新创建一个新文件\njournal=true #启用日志文件，默认启用\nquiet=true #这个选项可以过滤掉一些无用的日志信息，若需要调试使用请设置为false\nport=27017 #端口号 默认为27017\n```\n\n打开 http://127.0.0.1:27017/ \nIt looks like you are trying to access MongoDB over HTTP on the native driver port.\n\n## 安装服务\n\n管理员cmd\nE:\\MongoDB\\Server\\bin>`mongod --install --serviceName \"MongoDB\" --config` \"E:\\MongoDB\\mongo.conf\"\nE:\\MongoDB\\Server\\bin>  `net  start MongoDB`  \n\n## 删除服务\n\n`sc delete MongoDB`\n\n\n\n\n\nhttps://www.runoob.com/mongodb/mongodb-connections.html","slug":"services/database/mongo","published":1,"updated":"2022-08-28T09:10:00.936Z","__permalink":"database/mongo/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gttw003qgwi54hkd9tt9","content":"<h1 id=\"linux-环境\"><a href=\"#linux-环境\" class=\"headerlink\" title=\"linux 环境\"></a>linux 环境</h1><h2 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h2><p>wget <a href=\"https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-debian81-3.4.4.tgz\">https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-debian81-3.4.4.tgz</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar zxvf mongodb*.tar</span><br><span class=\"line\">mv /opt/mongo*  /opt</span><br><span class=\"line\">cd /opt/mongodb*  &amp;&amp; touch  mongodb.conf</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置文件\"><a href=\"#配置文件\" class=\"headerlink\" title=\"配置文件\"></a>配置文件</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dbpath=/home/cs/Download/mongodb/data #数据库路径</span><br><span class=\"line\">logpath=/home/cs/Download/mongodb/data/logs/mongodb.log #日志输出文件路径</span><br><span class=\"line\">logappend=true #错误日志采用追加模式，配置这个选项后mongodb的日志会追加到现有的日志文件，而不是从新创建一个新文件</span><br><span class=\"line\">journal=true #启用日志文件，默认启用</span><br><span class=\"line\">quiet=true #这个选项可以过滤掉一些无用的日志信息，若需要调试使用请设置为false</span><br><span class=\"line\">port=27017 #端口号 默认为27017</span><br></pre></td></tr></table></figure>\n\n<p>启动</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/mongodb-3.4.4/bin$ ./mongod  --config  /opt/mongodb-3.4.4/mongodb.conf</span><br></pre></td></tr></table></figure>\n\n\n<p>后台运行</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongo  -f   mongo.conf   &amp; </span><br></pre></td></tr></table></figure>\n\n\n<p>使用 fork 必须加上logpath</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongo   --fork  --logpath=log/mongodb.log   </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>多条命令执行时 &amp;&amp;  可以把 fork配置到conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo   &#123; \\</span><br><span class=\"line\">                echo &#x27;dbpath=/data/db&#x27;; \\</span><br><span class=\"line\">                echo &#x27;port=27017&#x27;; \\</span><br><span class=\"line\">                echo &#x27;logpath=/data/mongo.log&#x27;; \\</span><br><span class=\"line\">                echo &#x27;logappend=true&#x27;; \\</span><br><span class=\"line\">                echo &#x27;fork=true&#x27;; \\</span><br><span class=\"line\">             &#125; &gt; mongod.conf  </span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h2><p>mongo-start.sh</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\">cd /opt/mongodb-3.4.4/bin </span><br><span class=\"line\">./mongod  --config  /opt/mongodb-3.4.4/mongodb.conf  &amp;</span><br><span class=\"line\">exit</span><br><span class=\"line\">!</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"win-环境\"><a href=\"#win-环境\" class=\"headerlink\" title=\"win 环境\"></a>win 环境</h1><p>下载  <a href=\"http://dl.mongodb.org/dl/win32/x86_64\">http://dl.mongodb.org/dl/win32/x86_64</a><br>zip 免安装包</p>\n<p>启动</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">E:\\MongoDB\\Server\\bin&gt;mongod.exe --config  E:\\MongoDB\\mongo.conf</span><br></pre></td></tr></table></figure>\n\n<p>mongo.conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dbpath=E:\\MongoDB\\data #数据库路径</span><br><span class=\"line\">logpath=E:\\MongoDB\\logs\\mongodb.log #日志输出文件路径</span><br><span class=\"line\">logappend=true #错误日志采用追加模式，配置这个选项后mongodb的日志会追加到现有的日志文件，而不是从新创建一个新文件</span><br><span class=\"line\">journal=true #启用日志文件，默认启用</span><br><span class=\"line\">quiet=true #这个选项可以过滤掉一些无用的日志信息，若需要调试使用请设置为false</span><br><span class=\"line\">port=27017 #端口号 默认为27017</span><br></pre></td></tr></table></figure>\n\n<p>打开 <a href=\"http://127.0.0.1:27017/\">http://127.0.0.1:27017/</a><br>It looks like you are trying to access MongoDB over HTTP on the native driver port.</p>\n<h2 id=\"安装服务\"><a href=\"#安装服务\" class=\"headerlink\" title=\"安装服务\"></a>安装服务</h2><p>管理员cmd<br>E:\\MongoDB\\Server\\bin&gt;<code>mongod --install --serviceName &quot;MongoDB&quot; --config</code> “E:\\MongoDB\\mongo.conf”<br>E:\\MongoDB\\Server\\bin&gt;  <code>net  start MongoDB</code>  </p>\n<h2 id=\"删除服务\"><a href=\"#删除服务\" class=\"headerlink\" title=\"删除服务\"></a>删除服务</h2><p><code>sc delete MongoDB</code></p>\n<p><a href=\"https://www.runoob.com/mongodb/mongodb-connections.html\">https://www.runoob.com/mongodb/mongodb-connections.html</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"linux-环境\"><a href=\"#linux-环境\" class=\"headerlink\" title=\"linux 环境\"></a>linux 环境</h1><h2 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h2><p>wget <a href=\"https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-debian81-3.4.4.tgz\">https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-debian81-3.4.4.tgz</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar zxvf mongodb*.tar</span><br><span class=\"line\">mv /opt/mongo*  /opt</span><br><span class=\"line\">cd /opt/mongodb*  &amp;&amp; touch  mongodb.conf</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置文件\"><a href=\"#配置文件\" class=\"headerlink\" title=\"配置文件\"></a>配置文件</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dbpath=/home/cs/Download/mongodb/data #数据库路径</span><br><span class=\"line\">logpath=/home/cs/Download/mongodb/data/logs/mongodb.log #日志输出文件路径</span><br><span class=\"line\">logappend=true #错误日志采用追加模式，配置这个选项后mongodb的日志会追加到现有的日志文件，而不是从新创建一个新文件</span><br><span class=\"line\">journal=true #启用日志文件，默认启用</span><br><span class=\"line\">quiet=true #这个选项可以过滤掉一些无用的日志信息，若需要调试使用请设置为false</span><br><span class=\"line\">port=27017 #端口号 默认为27017</span><br></pre></td></tr></table></figure>\n\n<p>启动</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/mongodb-3.4.4/bin$ ./mongod  --config  /opt/mongodb-3.4.4/mongodb.conf</span><br></pre></td></tr></table></figure>\n\n\n<p>后台运行</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongo  -f   mongo.conf   &amp; </span><br></pre></td></tr></table></figure>\n\n\n<p>使用 fork 必须加上logpath</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongo   --fork  --logpath=log/mongodb.log   </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>多条命令执行时 &amp;&amp;  可以把 fork配置到conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo   &#123; \\</span><br><span class=\"line\">                echo &#x27;dbpath=/data/db&#x27;; \\</span><br><span class=\"line\">                echo &#x27;port=27017&#x27;; \\</span><br><span class=\"line\">                echo &#x27;logpath=/data/mongo.log&#x27;; \\</span><br><span class=\"line\">                echo &#x27;logappend=true&#x27;; \\</span><br><span class=\"line\">                echo &#x27;fork=true&#x27;; \\</span><br><span class=\"line\">             &#125; &gt; mongod.conf  </span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h2><p>mongo-start.sh</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\">cd /opt/mongodb-3.4.4/bin </span><br><span class=\"line\">./mongod  --config  /opt/mongodb-3.4.4/mongodb.conf  &amp;</span><br><span class=\"line\">exit</span><br><span class=\"line\">!</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"win-环境\"><a href=\"#win-环境\" class=\"headerlink\" title=\"win 环境\"></a>win 环境</h1><p>下载  <a href=\"http://dl.mongodb.org/dl/win32/x86_64\">http://dl.mongodb.org/dl/win32/x86_64</a><br>zip 免安装包</p>\n<p>启动</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">E:\\MongoDB\\Server\\bin&gt;mongod.exe --config  E:\\MongoDB\\mongo.conf</span><br></pre></td></tr></table></figure>\n\n<p>mongo.conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dbpath=E:\\MongoDB\\data #数据库路径</span><br><span class=\"line\">logpath=E:\\MongoDB\\logs\\mongodb.log #日志输出文件路径</span><br><span class=\"line\">logappend=true #错误日志采用追加模式，配置这个选项后mongodb的日志会追加到现有的日志文件，而不是从新创建一个新文件</span><br><span class=\"line\">journal=true #启用日志文件，默认启用</span><br><span class=\"line\">quiet=true #这个选项可以过滤掉一些无用的日志信息，若需要调试使用请设置为false</span><br><span class=\"line\">port=27017 #端口号 默认为27017</span><br></pre></td></tr></table></figure>\n\n<p>打开 <a href=\"http://127.0.0.1:27017/\">http://127.0.0.1:27017/</a><br>It looks like you are trying to access MongoDB over HTTP on the native driver port.</p>\n<h2 id=\"安装服务\"><a href=\"#安装服务\" class=\"headerlink\" title=\"安装服务\"></a>安装服务</h2><p>管理员cmd<br>E:\\MongoDB\\Server\\bin&gt;<code>mongod --install --serviceName &quot;MongoDB&quot; --config</code> “E:\\MongoDB\\mongo.conf”<br>E:\\MongoDB\\Server\\bin&gt;  <code>net  start MongoDB</code>  </p>\n<h2 id=\"删除服务\"><a href=\"#删除服务\" class=\"headerlink\" title=\"删除服务\"></a>删除服务</h2><p><code>sc delete MongoDB</code></p>\n<p><a href=\"https://www.runoob.com/mongodb/mongodb-connections.html\">https://www.runoob.com/mongodb/mongodb-connections.html</a></p>\n"},{"title":"shield","date":"2017-10-20T11:36:33.000Z","_content":"\n### 简介\n  **Shield**拦截所有对ElasticSearch的请求，并加上认证与加密，保障ElasticSearch及相关系统的安全性\n  \n  [<span id='top'>安装 doc</span>]( https://www.elastic.co/guide/en/shield/2.4/installing-shield.html)\n \n### 准备\n\n版本2.4.2{% post_link 安装ElasticSearch 安装ElasticSearch %}\n <!--more--> \n**以下操作需要你安装了elasticsearch为前提**\n\n\n\n* [license-2.4.2](https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/license/2.4.2/license-2.4.2.zip)\n* [shield-2.4.2](https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/shield/2.4.2/shield-2.4.2.zip)\n\n### 安装\n**以es，插件为<span id='custom'>自定义</span>目录为背景**\n\nes自定义目录**/opt/elasticsearch**\n\n安装脚本**plugin**注意下面变量值\n\n* CONF_DIR (elasticsearch.yml目录)\n `CONF_DIR=\"/opt/elasticsearch/config\"`\n* ES_ENV_FILE (elasticsearch目录)\n `ES_ENV_FILE=\"/opt/elasticsearch/config/default/elasticsearch\"`\n\nlicense\n```\ncs@debian:/opt/elasticsearch$ bin/plugin install file:///home/cs/Download/license-2.4.2.zip\n```\n>Installed license into /home/cs/Download/es/plugins/license\n\n\nshield\n```\ncs@debian:/opt/elasticsearch$ bin/plugin install file:///home/cs/Download/shield-2.4.2.zip\n```\n >Installed license into /home/cs/Download/es/plugins/shield\n \n安装成功目录（部分）\n```\ncs@debian:/opt/elasticsearch$ tree -L 3 /opt/elasticsearch\n/opt/elasticsearch\n├── bin\n│   ├── elasticsearch\n│   ├── elasticsearch.in.sh\n│   ├── elasticsearch-systemd-pre-exec\n│   ├── plugin\n│   ├── shield\n│   │   ├── esusers  添加角色密码脚本\n│   │   ├── esusers.bat\n│   │   ├── migrate\n│   │   ├── migrate.bat\n│   │   ├── syskeygen\n│   │   └── syskeygen.bat\n│   └── watcher\n│       ├── croneval\n│       └── croneval.bat\n├── config\n│   ├── default\n│   │   └── elasticsearch\n│   ├── elasticsearch.yml\n│   ├── logging.yml\n│   ├── scripts\n│   └── shield\n│       ├── logging.yml\n│       ├── role_mapping.yml\n│       ├── roles.yml\n│       ├── users\n│       └── users_roles\n├── lib\n```\n\n### 添加新用户\n\n执行脚本**esusers**需要注意参数\n* CONF_DIR ( 判断 $CONF_DIR/shield 目录)\n   后面密码会写入到配置文件（usersusers_roles）内\n* ES_CLASSPATH (shield 生成密码的执行类)\n  ```\n  java -cp org.elasticsearch.shield.authc.esusers.tool.ESUsersTool\n  ```\n  \nESUsersTool类在shield插件目录**shield-2.4.2.jar**\n  \n  **注意** [自定义目录](#custom)即 *plugins* 不再 *ES_HOME* 目录下，执行脚本需要确认**ES_CLASSPATH**位置正确\n  \n  1.添加变量 ES_PLUGIN\n  ```shell\n  ES_PLUGIN=`dirname $(sed -n 's/path.plugins://p'  $ES_HOME/config/elasticsearch.yml)`\n```\n   2.修改\n  ```shell\n#ES_CLASSPATH=\"$ES_CLASSPATH:$ES_HOME/plugins/shield/*\"\nES_CLASSPATH=\"$ES_CLASSPATH:$ES_PLUGIN/plugins/shield/*\"  \n```\n\n<br/>\n\n执行添加命令[文档](#top)\n```\ncs@debian:/opt/elasticsearch$ ./bin/shield/esusers useradd cs -p cs@121 -r admin\n```\n>useradd 添加的新用户名 cs <br/>\n-p  密码   cs@121    <br/>\n-r  角色（role） admin  <br/>\n\n启动\n```\ncs@debian:/opt/elasticsearch$ ./bin/elasticsearch -d\n```\n>cs@debian:`$ curl -u cs  \"http://localhost:9200/?pretty\"  <br/>\nEnter host password for user 'cs': <br/>\n{ <br/>\n  \"name\" : \"Sepulchre\",<br/>\n  \"cluster_name\" : \"elasticsearch\",<br/>\n  \"cluster_uuid\" : \"Ey7sWEIPRZGstn2LSKCCTQ\",<br/>\n  \"version\" : {<br/>\n    \"number\" : \"2.4.2\",<br/>\n    \"build_hash\" : \"161c65a337d4b422ac0c805f284565cf2014bb84\",<br/>\n    \"build_timestamp\" : \"2016-11-17T11:51:03Z\",<br/>\n    \"build_snapshot\" : false,<br/>\n    \"lucene_version\" : \"5.5.2\"<br/>\n  },<br/>\n  \"tagline\" : \"You Know, for Search\"<br/>\n}\n\n\n### 总结\n注意脚本运行，主要参数（变量）值\n","source":"_posts/services/elk/es-shield.md","raw":"---\ntitle: shield\ndate: 2017-10-20 19:36:33\ntags: \n  - auth\n  - safe\ncategories: \n - ELK\n - elasticsearch\n---\n\n### 简介\n  **Shield**拦截所有对ElasticSearch的请求，并加上认证与加密，保障ElasticSearch及相关系统的安全性\n  \n  [<span id='top'>安装 doc</span>]( https://www.elastic.co/guide/en/shield/2.4/installing-shield.html)\n \n### 准备\n\n版本2.4.2{% post_link 安装ElasticSearch 安装ElasticSearch %}\n <!--more--> \n**以下操作需要你安装了elasticsearch为前提**\n\n\n\n* [license-2.4.2](https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/license/2.4.2/license-2.4.2.zip)\n* [shield-2.4.2](https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/shield/2.4.2/shield-2.4.2.zip)\n\n### 安装\n**以es，插件为<span id='custom'>自定义</span>目录为背景**\n\nes自定义目录**/opt/elasticsearch**\n\n安装脚本**plugin**注意下面变量值\n\n* CONF_DIR (elasticsearch.yml目录)\n `CONF_DIR=\"/opt/elasticsearch/config\"`\n* ES_ENV_FILE (elasticsearch目录)\n `ES_ENV_FILE=\"/opt/elasticsearch/config/default/elasticsearch\"`\n\nlicense\n```\ncs@debian:/opt/elasticsearch$ bin/plugin install file:///home/cs/Download/license-2.4.2.zip\n```\n>Installed license into /home/cs/Download/es/plugins/license\n\n\nshield\n```\ncs@debian:/opt/elasticsearch$ bin/plugin install file:///home/cs/Download/shield-2.4.2.zip\n```\n >Installed license into /home/cs/Download/es/plugins/shield\n \n安装成功目录（部分）\n```\ncs@debian:/opt/elasticsearch$ tree -L 3 /opt/elasticsearch\n/opt/elasticsearch\n├── bin\n│   ├── elasticsearch\n│   ├── elasticsearch.in.sh\n│   ├── elasticsearch-systemd-pre-exec\n│   ├── plugin\n│   ├── shield\n│   │   ├── esusers  添加角色密码脚本\n│   │   ├── esusers.bat\n│   │   ├── migrate\n│   │   ├── migrate.bat\n│   │   ├── syskeygen\n│   │   └── syskeygen.bat\n│   └── watcher\n│       ├── croneval\n│       └── croneval.bat\n├── config\n│   ├── default\n│   │   └── elasticsearch\n│   ├── elasticsearch.yml\n│   ├── logging.yml\n│   ├── scripts\n│   └── shield\n│       ├── logging.yml\n│       ├── role_mapping.yml\n│       ├── roles.yml\n│       ├── users\n│       └── users_roles\n├── lib\n```\n\n### 添加新用户\n\n执行脚本**esusers**需要注意参数\n* CONF_DIR ( 判断 $CONF_DIR/shield 目录)\n   后面密码会写入到配置文件（usersusers_roles）内\n* ES_CLASSPATH (shield 生成密码的执行类)\n  ```\n  java -cp org.elasticsearch.shield.authc.esusers.tool.ESUsersTool\n  ```\n  \nESUsersTool类在shield插件目录**shield-2.4.2.jar**\n  \n  **注意** [自定义目录](#custom)即 *plugins* 不再 *ES_HOME* 目录下，执行脚本需要确认**ES_CLASSPATH**位置正确\n  \n  1.添加变量 ES_PLUGIN\n  ```shell\n  ES_PLUGIN=`dirname $(sed -n 's/path.plugins://p'  $ES_HOME/config/elasticsearch.yml)`\n```\n   2.修改\n  ```shell\n#ES_CLASSPATH=\"$ES_CLASSPATH:$ES_HOME/plugins/shield/*\"\nES_CLASSPATH=\"$ES_CLASSPATH:$ES_PLUGIN/plugins/shield/*\"  \n```\n\n<br/>\n\n执行添加命令[文档](#top)\n```\ncs@debian:/opt/elasticsearch$ ./bin/shield/esusers useradd cs -p cs@121 -r admin\n```\n>useradd 添加的新用户名 cs <br/>\n-p  密码   cs@121    <br/>\n-r  角色（role） admin  <br/>\n\n启动\n```\ncs@debian:/opt/elasticsearch$ ./bin/elasticsearch -d\n```\n>cs@debian:`$ curl -u cs  \"http://localhost:9200/?pretty\"  <br/>\nEnter host password for user 'cs': <br/>\n{ <br/>\n  \"name\" : \"Sepulchre\",<br/>\n  \"cluster_name\" : \"elasticsearch\",<br/>\n  \"cluster_uuid\" : \"Ey7sWEIPRZGstn2LSKCCTQ\",<br/>\n  \"version\" : {<br/>\n    \"number\" : \"2.4.2\",<br/>\n    \"build_hash\" : \"161c65a337d4b422ac0c805f284565cf2014bb84\",<br/>\n    \"build_timestamp\" : \"2016-11-17T11:51:03Z\",<br/>\n    \"build_snapshot\" : false,<br/>\n    \"lucene_version\" : \"5.5.2\"<br/>\n  },<br/>\n  \"tagline\" : \"You Know, for Search\"<br/>\n}\n\n\n### 总结\n注意脚本运行，主要参数（变量）值\n","slug":"services/elk/es-shield","published":1,"updated":"2022-06-03T08:35:30.095Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gttx003ugwi5ep4rfasb","content":"<h3 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h3><p>  <strong>Shield</strong>拦截所有对ElasticSearch的请求，并加上认证与加密，保障ElasticSearch及相关系统的安全性</p>\n<p>  <a href=\"https://www.elastic.co/guide/en/shield/2.4/installing-shield.html\"><span id='top'>安装 doc</span></a></p>\n<h3 id=\"准备\"><a href=\"#准备\" class=\"headerlink\" title=\"准备\"></a>准备</h3><p>版本2.4.2<a href=\"#\">Post not found: 安装ElasticSearch 安装ElasticSearch</a><br> <span id=\"more\"></span><br><strong>以下操作需要你安装了elasticsearch为前提</strong></p>\n<ul>\n<li><a href=\"https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/license/2.4.2/license-2.4.2.zip\">license-2.4.2</a></li>\n<li><a href=\"https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/shield/2.4.2/shield-2.4.2.zip\">shield-2.4.2</a></li>\n</ul>\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><p><strong>以es，插件为<span id='custom'>自定义</span>目录为背景</strong></p>\n<p>es自定义目录**&#x2F;opt&#x2F;elasticsearch**</p>\n<p>安装脚本<strong>plugin</strong>注意下面变量值</p>\n<ul>\n<li>CONF_DIR (elasticsearch.yml目录)<br> <code>CONF_DIR=&quot;/opt/elasticsearch/config&quot;</code></li>\n<li>ES_ENV_FILE (elasticsearch目录)<br> <code>ES_ENV_FILE=&quot;/opt/elasticsearch/config/default/elasticsearch&quot;</code></li>\n</ul>\n<p>license</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/elasticsearch$ bin/plugin install file:///home/cs/Download/license-2.4.2.zip</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>Installed license into &#x2F;home&#x2F;cs&#x2F;Download&#x2F;es&#x2F;plugins&#x2F;license</p>\n</blockquote>\n<p>shield</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/elasticsearch$ bin/plugin install file:///home/cs/Download/shield-2.4.2.zip</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>Installed license into &#x2F;home&#x2F;cs&#x2F;Download&#x2F;es&#x2F;plugins&#x2F;shield</p>\n</blockquote>\n<p>安装成功目录（部分）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/elasticsearch$ tree -L 3 /opt/elasticsearch</span><br><span class=\"line\">/opt/elasticsearch</span><br><span class=\"line\">├── bin</span><br><span class=\"line\">│   ├── elasticsearch</span><br><span class=\"line\">│   ├── elasticsearch.in.sh</span><br><span class=\"line\">│   ├── elasticsearch-systemd-pre-exec</span><br><span class=\"line\">│   ├── plugin</span><br><span class=\"line\">│   ├── shield</span><br><span class=\"line\">│   │   ├── esusers  添加角色密码脚本</span><br><span class=\"line\">│   │   ├── esusers.bat</span><br><span class=\"line\">│   │   ├── migrate</span><br><span class=\"line\">│   │   ├── migrate.bat</span><br><span class=\"line\">│   │   ├── syskeygen</span><br><span class=\"line\">│   │   └── syskeygen.bat</span><br><span class=\"line\">│   └── watcher</span><br><span class=\"line\">│       ├── croneval</span><br><span class=\"line\">│       └── croneval.bat</span><br><span class=\"line\">├── config</span><br><span class=\"line\">│   ├── default</span><br><span class=\"line\">│   │   └── elasticsearch</span><br><span class=\"line\">│   ├── elasticsearch.yml</span><br><span class=\"line\">│   ├── logging.yml</span><br><span class=\"line\">│   ├── scripts</span><br><span class=\"line\">│   └── shield</span><br><span class=\"line\">│       ├── logging.yml</span><br><span class=\"line\">│       ├── role_mapping.yml</span><br><span class=\"line\">│       ├── roles.yml</span><br><span class=\"line\">│       ├── users</span><br><span class=\"line\">│       └── users_roles</span><br><span class=\"line\">├── lib</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"添加新用户\"><a href=\"#添加新用户\" class=\"headerlink\" title=\"添加新用户\"></a>添加新用户</h3><p>执行脚本<strong>esusers</strong>需要注意参数</p>\n<ul>\n<li>CONF_DIR ( 判断 $CONF_DIR&#x2F;shield 目录)<br> 后面密码会写入到配置文件（usersusers_roles）内</li>\n<li>ES_CLASSPATH (shield 生成密码的执行类)<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -cp org.elasticsearch.shield.authc.esusers.tool.ESUsersTool</span><br></pre></td></tr></table></figure></li>\n</ul>\n<p>ESUsersTool类在shield插件目录<strong>shield-2.4.2.jar</strong></p>\n<p>  <strong>注意</strong> <a href=\"#custom\">自定义目录</a>即 <em>plugins</em> 不再 <em>ES_HOME</em> 目录下，执行脚本需要确认<strong>ES_CLASSPATH</strong>位置正确</p>\n<p>  1.添加变量 ES_PLUGIN<br>  <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ES_PLUGIN=`dirname $(sed -n &#x27;s/path.plugins://p&#x27;  $ES_HOME/config/elasticsearch.yml)`</span><br></pre></td></tr></table></figure><br>   2.修改<br>  <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">ES_CLASSPATH=<span class=\"string\">&quot;<span class=\"variable\">$ES_CLASSPATH</span>:<span class=\"variable\">$ES_HOME</span>/plugins/shield/*&quot;</span></span></span><br><span class=\"line\">ES_CLASSPATH=&quot;$ES_CLASSPATH:$ES_PLUGIN/plugins/shield/*&quot;  </span><br></pre></td></tr></table></figure></p>\n<br/>\n\n<p>执行添加命令<a href=\"#top\">文档</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/elasticsearch$ ./bin/shield/esusers useradd cs -p cs@121 -r admin</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>useradd 添加的新用户名 cs <br/><br>-p  密码   cs@121    <br/><br>-r  角色（role） admin  <br/></p>\n</blockquote>\n<p>启动</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/elasticsearch$ ./bin/elasticsearch -d</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>cs@debian:&#96;$ curl -u cs  “<a href=\"http://localhost:9200/?pretty&quot;\">http://localhost:9200/?pretty&quot;</a>  <br/><br>Enter host password for user ‘cs’: <br/><br>{ <br/><br>  “name” : “Sepulchre”,<br/><br>  “cluster_name” : “elasticsearch”,<br/><br>  “cluster_uuid” : “Ey7sWEIPRZGstn2LSKCCTQ”,<br/><br>  “version” : {<br/><br>    “number” : “2.4.2”,<br/><br>    “build_hash” : “161c65a337d4b422ac0c805f284565cf2014bb84”,<br/><br>    “build_timestamp” : “2016-11-17T11:51:03Z”,<br/><br>    “build_snapshot” : false,<br/><br>    “lucene_version” : “5.5.2”<br/><br>  },<br/><br>  “tagline” : “You Know, for Search”<br/><br>}</p>\n</blockquote>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>注意脚本运行，主要参数（变量）值</p>\n","site":{"data":{}},"excerpt":"<h3 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h3><p>  <strong>Shield</strong>拦截所有对ElasticSearch的请求，并加上认证与加密，保障ElasticSearch及相关系统的安全性</p>\n<p>  <a href=\"https://www.elastic.co/guide/en/shield/2.4/installing-shield.html\"><span id='top'>安装 doc</span></a></p>\n<h3 id=\"准备\"><a href=\"#准备\" class=\"headerlink\" title=\"准备\"></a>准备</h3><p>版本2.4.2<a href=\"#\">Post not found: 安装ElasticSearch 安装ElasticSearch</a><br>","more":"<br><strong>以下操作需要你安装了elasticsearch为前提</strong></p>\n<ul>\n<li><a href=\"https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/license/2.4.2/license-2.4.2.zip\">license-2.4.2</a></li>\n<li><a href=\"https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/shield/2.4.2/shield-2.4.2.zip\">shield-2.4.2</a></li>\n</ul>\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><p><strong>以es，插件为<span id='custom'>自定义</span>目录为背景</strong></p>\n<p>es自定义目录**&#x2F;opt&#x2F;elasticsearch**</p>\n<p>安装脚本<strong>plugin</strong>注意下面变量值</p>\n<ul>\n<li>CONF_DIR (elasticsearch.yml目录)<br> <code>CONF_DIR=&quot;/opt/elasticsearch/config&quot;</code></li>\n<li>ES_ENV_FILE (elasticsearch目录)<br> <code>ES_ENV_FILE=&quot;/opt/elasticsearch/config/default/elasticsearch&quot;</code></li>\n</ul>\n<p>license</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/elasticsearch$ bin/plugin install file:///home/cs/Download/license-2.4.2.zip</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>Installed license into &#x2F;home&#x2F;cs&#x2F;Download&#x2F;es&#x2F;plugins&#x2F;license</p>\n</blockquote>\n<p>shield</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/elasticsearch$ bin/plugin install file:///home/cs/Download/shield-2.4.2.zip</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>Installed license into &#x2F;home&#x2F;cs&#x2F;Download&#x2F;es&#x2F;plugins&#x2F;shield</p>\n</blockquote>\n<p>安装成功目录（部分）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/elasticsearch$ tree -L 3 /opt/elasticsearch</span><br><span class=\"line\">/opt/elasticsearch</span><br><span class=\"line\">├── bin</span><br><span class=\"line\">│   ├── elasticsearch</span><br><span class=\"line\">│   ├── elasticsearch.in.sh</span><br><span class=\"line\">│   ├── elasticsearch-systemd-pre-exec</span><br><span class=\"line\">│   ├── plugin</span><br><span class=\"line\">│   ├── shield</span><br><span class=\"line\">│   │   ├── esusers  添加角色密码脚本</span><br><span class=\"line\">│   │   ├── esusers.bat</span><br><span class=\"line\">│   │   ├── migrate</span><br><span class=\"line\">│   │   ├── migrate.bat</span><br><span class=\"line\">│   │   ├── syskeygen</span><br><span class=\"line\">│   │   └── syskeygen.bat</span><br><span class=\"line\">│   └── watcher</span><br><span class=\"line\">│       ├── croneval</span><br><span class=\"line\">│       └── croneval.bat</span><br><span class=\"line\">├── config</span><br><span class=\"line\">│   ├── default</span><br><span class=\"line\">│   │   └── elasticsearch</span><br><span class=\"line\">│   ├── elasticsearch.yml</span><br><span class=\"line\">│   ├── logging.yml</span><br><span class=\"line\">│   ├── scripts</span><br><span class=\"line\">│   └── shield</span><br><span class=\"line\">│       ├── logging.yml</span><br><span class=\"line\">│       ├── role_mapping.yml</span><br><span class=\"line\">│       ├── roles.yml</span><br><span class=\"line\">│       ├── users</span><br><span class=\"line\">│       └── users_roles</span><br><span class=\"line\">├── lib</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"添加新用户\"><a href=\"#添加新用户\" class=\"headerlink\" title=\"添加新用户\"></a>添加新用户</h3><p>执行脚本<strong>esusers</strong>需要注意参数</p>\n<ul>\n<li>CONF_DIR ( 判断 $CONF_DIR&#x2F;shield 目录)<br> 后面密码会写入到配置文件（usersusers_roles）内</li>\n<li>ES_CLASSPATH (shield 生成密码的执行类)<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -cp org.elasticsearch.shield.authc.esusers.tool.ESUsersTool</span><br></pre></td></tr></table></figure></li>\n</ul>\n<p>ESUsersTool类在shield插件目录<strong>shield-2.4.2.jar</strong></p>\n<p>  <strong>注意</strong> <a href=\"#custom\">自定义目录</a>即 <em>plugins</em> 不再 <em>ES_HOME</em> 目录下，执行脚本需要确认<strong>ES_CLASSPATH</strong>位置正确</p>\n<p>  1.添加变量 ES_PLUGIN<br>  <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ES_PLUGIN=`dirname $(sed -n &#x27;s/path.plugins://p&#x27;  $ES_HOME/config/elasticsearch.yml)`</span><br></pre></td></tr></table></figure><br>   2.修改<br>  <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">ES_CLASSPATH=<span class=\"string\">&quot;<span class=\"variable\">$ES_CLASSPATH</span>:<span class=\"variable\">$ES_HOME</span>/plugins/shield/*&quot;</span></span></span><br><span class=\"line\">ES_CLASSPATH=&quot;$ES_CLASSPATH:$ES_PLUGIN/plugins/shield/*&quot;  </span><br></pre></td></tr></table></figure></p>\n<br/>\n\n<p>执行添加命令<a href=\"#top\">文档</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/elasticsearch$ ./bin/shield/esusers useradd cs -p cs@121 -r admin</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>useradd 添加的新用户名 cs <br/><br>-p  密码   cs@121    <br/><br>-r  角色（role） admin  <br/></p>\n</blockquote>\n<p>启动</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cs@debian:/opt/elasticsearch$ ./bin/elasticsearch -d</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>cs@debian:&#96;$ curl -u cs  “<a href=\"http://localhost:9200/?pretty&quot;\">http://localhost:9200/?pretty&quot;</a>  <br/><br>Enter host password for user ‘cs’: <br/><br>{ <br/><br>  “name” : “Sepulchre”,<br/><br>  “cluster_name” : “elasticsearch”,<br/><br>  “cluster_uuid” : “Ey7sWEIPRZGstn2LSKCCTQ”,<br/><br>  “version” : {<br/><br>    “number” : “2.4.2”,<br/><br>    “build_hash” : “161c65a337d4b422ac0c805f284565cf2014bb84”,<br/><br>    “build_timestamp” : “2016-11-17T11:51:03Z”,<br/><br>    “build_snapshot” : false,<br/><br>    “lucene_version” : “5.5.2”<br/><br>  },<br/><br>  “tagline” : “You Know, for Search”<br/><br>}</p>\n</blockquote>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>注意脚本运行，主要参数（变量）值</p>"},{"title":"kibana","date":"2017-01-25T13:34:20.000Z","_content":"\n#### debian\n```\n$>sudo dpkg -i kibana-4.6.1-amd64.deb\n$>dpkg -L  kibana \n```\n \n#### win\n[nssm](#)\n\n#### 创建索引\n** logstash.conf **  \n <!--more--> \n```\noutput {\n    elasticsearch {\n        hosts => [\"127.0.0.1:9200\"]\n        index => \"logstash-nginx-json-%{+YYYY.MM}\"\n    }\n   stdout {codec => rubydebug}\n}\n```\n* 只有日志输入到es，才会触发创建索引","source":"_posts/services/elk/kibana.md","raw":"---\ntitle: kibana\ndate: 2017-01-25 21:34:20\ntags:\n - install\n - win\ncategories:\n - ELK\n - kibana\n---\n\n#### debian\n```\n$>sudo dpkg -i kibana-4.6.1-amd64.deb\n$>dpkg -L  kibana \n```\n \n#### win\n[nssm](#)\n\n#### 创建索引\n** logstash.conf **  \n <!--more--> \n```\noutput {\n    elasticsearch {\n        hosts => [\"127.0.0.1:9200\"]\n        index => \"logstash-nginx-json-%{+YYYY.MM}\"\n    }\n   stdout {codec => rubydebug}\n}\n```\n* 只有日志输入到es，才会触发创建索引","slug":"services/elk/kibana","published":1,"updated":"2022-06-03T08:37:16.059Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtty003xgwi563vl6mdg","content":"<h4 id=\"debian\"><a href=\"#debian\" class=\"headerlink\" title=\"debian\"></a>debian</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$&gt;sudo dpkg -i kibana-4.6.1-amd64.deb</span><br><span class=\"line\">$&gt;dpkg -L  kibana </span><br></pre></td></tr></table></figure>\n<h4 id=\"win\"><a href=\"#win\" class=\"headerlink\" title=\"win\"></a>win</h4><p><a href=\"#\">nssm</a></p>\n<h4 id=\"创建索引\"><a href=\"#创建索引\" class=\"headerlink\" title=\"创建索引\"></a>创建索引</h4><p>** logstash.conf **<br> <span id=\"more\"></span> </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">output &#123;</span><br><span class=\"line\">    elasticsearch &#123;</span><br><span class=\"line\">        hosts =&gt; [&quot;127.0.0.1:9200&quot;]</span><br><span class=\"line\">        index =&gt; &quot;logstash-nginx-json-%&#123;+YYYY.MM&#125;&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">   stdout &#123;codec =&gt; rubydebug&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>只有日志输入到es，才会触发创建索引</li>\n</ul>\n","site":{"data":{}},"excerpt":"<h4 id=\"debian\"><a href=\"#debian\" class=\"headerlink\" title=\"debian\"></a>debian</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$&gt;sudo dpkg -i kibana-4.6.1-amd64.deb</span><br><span class=\"line\">$&gt;dpkg -L  kibana </span><br></pre></td></tr></table></figure>\n<h4 id=\"win\"><a href=\"#win\" class=\"headerlink\" title=\"win\"></a>win</h4><p><a href=\"#\">nssm</a></p>\n<h4 id=\"创建索引\"><a href=\"#创建索引\" class=\"headerlink\" title=\"创建索引\"></a>创建索引</h4><p>** logstash.conf **<br>","more":"</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">output &#123;</span><br><span class=\"line\">    elasticsearch &#123;</span><br><span class=\"line\">        hosts =&gt; [&quot;127.0.0.1:9200&quot;]</span><br><span class=\"line\">        index =&gt; &quot;logstash-nginx-json-%&#123;+YYYY.MM&#125;&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">   stdout &#123;codec =&gt; rubydebug&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>只有日志输入到es，才会触发创建索引</li>\n</ul>"},{"title":"logstash","date":"2017-01-25T13:27:53.000Z","_content":"\n#### debian安装\n```\n $>sudo dpkg -i logstash-2.4.1_all.deb\n$> dpkg -L  logstash\n```\n#### win安装\nservice工具 [nssm](#)\n <!--more--> \n#### 配置\nlogstash.conf\n```\ninput {\n    file {\n        path => [ \"F:/ELK/nginx-1.10.2/logs/access.log\" ]\n\t\ttype => \"nginx_access\"\n        start_position => \"beginning\"\n        ignore_older => 0\n    }\n\tfile {\n        path => [ \"F:/ELK/nginx-1.10.2/logs/access_json.log\" ]\n\t\t#codec => \"json\"\n\t\ttype => \"nginx_json\"\n        start_position => \"beginning\"\n        ignore_older => 0\n    }\n}\n\nfilter {\n if [type] == \"nginx_access\" {\n    grok {\n\t    patterns_dir => \"F:/ELK/logstash-2.4.1/patterns\"        #设置自定义正则路径\n        match => { \"message\" => \"%{NGINXACCESS}\" }\n    }\n\n\n    date {\n      match => [ \"log_timestamp\",\"dd/MMM/yyyy:HH:mm:ss Z\"]\n\n    }\n   \n  }\n  \n  if [type] == \"nginx_json\" {\n        json {\n            source => \"message\"\n            #target => \"doc\"\n            remove_field => [\"message\"]\n        }\n\t\tif [@fields][ip] != \"-\" {\n\t\t\tgeoip {\n\t\t\t\t\tsource => \"[@fields][ip]\"\n \t\t\t\t\ttarget => \"geoip\"\n\t\t\t\t\tfields => [\"city_name\", \"continent_code\", \"country_code3\", \"country_name\", \"ip\", \"postal_code\", \"region_name\"]\n\t\t\t\t\tdatabase => \"F:/ELK/logstash-2.4.1/ip/GeoLiteCity.dat\"\n\t\t\t\t\tadd_field => [ \"[geoip][coordinates]\", \"%{[geoip][longitude]}\" ]\n\t\t\t\t\tadd_field => [ \"[geoip][coordinates]\", \"%{[geoip][latitude]}\"  ]\n\t\t\t}\n\t\t\n\t\t\tmutate {\n\t\t\t\t\tconvert => [ \"[geoip][coordinates]\", \"float\"]\n\t\t\t\t\t\n\t\t\t}\n   \n\t\t}\n \t}\n \n}\noutput {\n if [type] == \"nginx_access\" {\n    elasticsearch {\n        hosts => [\"127.0.0.1:9200\"]\n        index => \"logstash-nginx-access-%{+YYYY.MM}\"\n    }\n   stdout {codec => rubydebug}\n  }\n  if [type] == \"nginx_json\" {\n    elasticsearch {\n        hosts => [\"127.0.0.1:9200\"]\n        index => \"logstash-nginx-json-%{+YYYY.MM}\"\n    }\n   stdout {codec => rubydebug}\n  }\n \n}\n```","source":"_posts/services/elk/logstash.md","raw":"---\ntitle: logstash\ndate: 2017-01-25 21:27:53\ntags:\n - log\n - install\n - win\ncategories:\n - ELK\n - logstash\n---\n\n#### debian安装\n```\n $>sudo dpkg -i logstash-2.4.1_all.deb\n$> dpkg -L  logstash\n```\n#### win安装\nservice工具 [nssm](#)\n <!--more--> \n#### 配置\nlogstash.conf\n```\ninput {\n    file {\n        path => [ \"F:/ELK/nginx-1.10.2/logs/access.log\" ]\n\t\ttype => \"nginx_access\"\n        start_position => \"beginning\"\n        ignore_older => 0\n    }\n\tfile {\n        path => [ \"F:/ELK/nginx-1.10.2/logs/access_json.log\" ]\n\t\t#codec => \"json\"\n\t\ttype => \"nginx_json\"\n        start_position => \"beginning\"\n        ignore_older => 0\n    }\n}\n\nfilter {\n if [type] == \"nginx_access\" {\n    grok {\n\t    patterns_dir => \"F:/ELK/logstash-2.4.1/patterns\"        #设置自定义正则路径\n        match => { \"message\" => \"%{NGINXACCESS}\" }\n    }\n\n\n    date {\n      match => [ \"log_timestamp\",\"dd/MMM/yyyy:HH:mm:ss Z\"]\n\n    }\n   \n  }\n  \n  if [type] == \"nginx_json\" {\n        json {\n            source => \"message\"\n            #target => \"doc\"\n            remove_field => [\"message\"]\n        }\n\t\tif [@fields][ip] != \"-\" {\n\t\t\tgeoip {\n\t\t\t\t\tsource => \"[@fields][ip]\"\n \t\t\t\t\ttarget => \"geoip\"\n\t\t\t\t\tfields => [\"city_name\", \"continent_code\", \"country_code3\", \"country_name\", \"ip\", \"postal_code\", \"region_name\"]\n\t\t\t\t\tdatabase => \"F:/ELK/logstash-2.4.1/ip/GeoLiteCity.dat\"\n\t\t\t\t\tadd_field => [ \"[geoip][coordinates]\", \"%{[geoip][longitude]}\" ]\n\t\t\t\t\tadd_field => [ \"[geoip][coordinates]\", \"%{[geoip][latitude]}\"  ]\n\t\t\t}\n\t\t\n\t\t\tmutate {\n\t\t\t\t\tconvert => [ \"[geoip][coordinates]\", \"float\"]\n\t\t\t\t\t\n\t\t\t}\n   \n\t\t}\n \t}\n \n}\noutput {\n if [type] == \"nginx_access\" {\n    elasticsearch {\n        hosts => [\"127.0.0.1:9200\"]\n        index => \"logstash-nginx-access-%{+YYYY.MM}\"\n    }\n   stdout {codec => rubydebug}\n  }\n  if [type] == \"nginx_json\" {\n    elasticsearch {\n        hosts => [\"127.0.0.1:9200\"]\n        index => \"logstash-nginx-json-%{+YYYY.MM}\"\n    }\n   stdout {codec => rubydebug}\n  }\n \n}\n```","slug":"services/elk/logstash","published":1,"updated":"2022-06-03T08:37:32.535Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gttz003zgwi5f6652ffx","content":"<h4 id=\"debian安装\"><a href=\"#debian安装\" class=\"headerlink\" title=\"debian安装\"></a>debian安装</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> $&gt;sudo dpkg -i logstash-2.4.1_all.deb</span><br><span class=\"line\">$&gt; dpkg -L  logstash</span><br></pre></td></tr></table></figure>\n<h4 id=\"win安装\"><a href=\"#win安装\" class=\"headerlink\" title=\"win安装\"></a>win安装</h4><p>service工具 <a href=\"#\">nssm</a><br> <span id=\"more\"></span> </p>\n<h4 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h4><p>logstash.conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input &#123;</span><br><span class=\"line\">    file &#123;</span><br><span class=\"line\">        path =&gt; [ &quot;F:/ELK/nginx-1.10.2/logs/access.log&quot; ]</span><br><span class=\"line\">\t\ttype =&gt; &quot;nginx_access&quot;</span><br><span class=\"line\">        start_position =&gt; &quot;beginning&quot;</span><br><span class=\"line\">        ignore_older =&gt; 0</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">\tfile &#123;</span><br><span class=\"line\">        path =&gt; [ &quot;F:/ELK/nginx-1.10.2/logs/access_json.log&quot; ]</span><br><span class=\"line\">\t\t#codec =&gt; &quot;json&quot;</span><br><span class=\"line\">\t\ttype =&gt; &quot;nginx_json&quot;</span><br><span class=\"line\">        start_position =&gt; &quot;beginning&quot;</span><br><span class=\"line\">        ignore_older =&gt; 0</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">filter &#123;</span><br><span class=\"line\"> if [type] == &quot;nginx_access&quot; &#123;</span><br><span class=\"line\">    grok &#123;</span><br><span class=\"line\">\t    patterns_dir =&gt; &quot;F:/ELK/logstash-2.4.1/patterns&quot;        #设置自定义正则路径</span><br><span class=\"line\">        match =&gt; &#123; &quot;message&quot; =&gt; &quot;%&#123;NGINXACCESS&#125;&quot; &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    date &#123;</span><br><span class=\"line\">      match =&gt; [ &quot;log_timestamp&quot;,&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  if [type] == &quot;nginx_json&quot; &#123;</span><br><span class=\"line\">        json &#123;</span><br><span class=\"line\">            source =&gt; &quot;message&quot;</span><br><span class=\"line\">            #target =&gt; &quot;doc&quot;</span><br><span class=\"line\">            remove_field =&gt; [&quot;message&quot;]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">\t\tif [@fields][ip] != &quot;-&quot; &#123;</span><br><span class=\"line\">\t\t\tgeoip &#123;</span><br><span class=\"line\">\t\t\t\t\tsource =&gt; &quot;[@fields][ip]&quot;</span><br><span class=\"line\"> \t\t\t\t\ttarget =&gt; &quot;geoip&quot;</span><br><span class=\"line\">\t\t\t\t\tfields =&gt; [&quot;city_name&quot;, &quot;continent_code&quot;, &quot;country_code3&quot;, &quot;country_name&quot;, &quot;ip&quot;, &quot;postal_code&quot;, &quot;region_name&quot;]</span><br><span class=\"line\">\t\t\t\t\tdatabase =&gt; &quot;F:/ELK/logstash-2.4.1/ip/GeoLiteCity.dat&quot;</span><br><span class=\"line\">\t\t\t\t\tadd_field =&gt; [ &quot;[geoip][coordinates]&quot;, &quot;%&#123;[geoip][longitude]&#125;&quot; ]</span><br><span class=\"line\">\t\t\t\t\tadd_field =&gt; [ &quot;[geoip][coordinates]&quot;, &quot;%&#123;[geoip][latitude]&#125;&quot;  ]</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t\tmutate &#123;</span><br><span class=\"line\">\t\t\t\t\tconvert =&gt; [ &quot;[geoip][coordinates]&quot;, &quot;float&quot;]</span><br><span class=\"line\">\t\t\t\t\t</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"> \t&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">output &#123;</span><br><span class=\"line\"> if [type] == &quot;nginx_access&quot; &#123;</span><br><span class=\"line\">    elasticsearch &#123;</span><br><span class=\"line\">        hosts =&gt; [&quot;127.0.0.1:9200&quot;]</span><br><span class=\"line\">        index =&gt; &quot;logstash-nginx-access-%&#123;+YYYY.MM&#125;&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">   stdout &#123;codec =&gt; rubydebug&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  if [type] == &quot;nginx_json&quot; &#123;</span><br><span class=\"line\">    elasticsearch &#123;</span><br><span class=\"line\">        hosts =&gt; [&quot;127.0.0.1:9200&quot;]</span><br><span class=\"line\">        index =&gt; &quot;logstash-nginx-json-%&#123;+YYYY.MM&#125;&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">   stdout &#123;codec =&gt; rubydebug&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<h4 id=\"debian安装\"><a href=\"#debian安装\" class=\"headerlink\" title=\"debian安装\"></a>debian安装</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> $&gt;sudo dpkg -i logstash-2.4.1_all.deb</span><br><span class=\"line\">$&gt; dpkg -L  logstash</span><br></pre></td></tr></table></figure>\n<h4 id=\"win安装\"><a href=\"#win安装\" class=\"headerlink\" title=\"win安装\"></a>win安装</h4><p>service工具 <a href=\"#\">nssm</a><br>","more":"</p>\n<h4 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h4><p>logstash.conf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input &#123;</span><br><span class=\"line\">    file &#123;</span><br><span class=\"line\">        path =&gt; [ &quot;F:/ELK/nginx-1.10.2/logs/access.log&quot; ]</span><br><span class=\"line\">\t\ttype =&gt; &quot;nginx_access&quot;</span><br><span class=\"line\">        start_position =&gt; &quot;beginning&quot;</span><br><span class=\"line\">        ignore_older =&gt; 0</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">\tfile &#123;</span><br><span class=\"line\">        path =&gt; [ &quot;F:/ELK/nginx-1.10.2/logs/access_json.log&quot; ]</span><br><span class=\"line\">\t\t#codec =&gt; &quot;json&quot;</span><br><span class=\"line\">\t\ttype =&gt; &quot;nginx_json&quot;</span><br><span class=\"line\">        start_position =&gt; &quot;beginning&quot;</span><br><span class=\"line\">        ignore_older =&gt; 0</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">filter &#123;</span><br><span class=\"line\"> if [type] == &quot;nginx_access&quot; &#123;</span><br><span class=\"line\">    grok &#123;</span><br><span class=\"line\">\t    patterns_dir =&gt; &quot;F:/ELK/logstash-2.4.1/patterns&quot;        #设置自定义正则路径</span><br><span class=\"line\">        match =&gt; &#123; &quot;message&quot; =&gt; &quot;%&#123;NGINXACCESS&#125;&quot; &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    date &#123;</span><br><span class=\"line\">      match =&gt; [ &quot;log_timestamp&quot;,&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  if [type] == &quot;nginx_json&quot; &#123;</span><br><span class=\"line\">        json &#123;</span><br><span class=\"line\">            source =&gt; &quot;message&quot;</span><br><span class=\"line\">            #target =&gt; &quot;doc&quot;</span><br><span class=\"line\">            remove_field =&gt; [&quot;message&quot;]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">\t\tif [@fields][ip] != &quot;-&quot; &#123;</span><br><span class=\"line\">\t\t\tgeoip &#123;</span><br><span class=\"line\">\t\t\t\t\tsource =&gt; &quot;[@fields][ip]&quot;</span><br><span class=\"line\"> \t\t\t\t\ttarget =&gt; &quot;geoip&quot;</span><br><span class=\"line\">\t\t\t\t\tfields =&gt; [&quot;city_name&quot;, &quot;continent_code&quot;, &quot;country_code3&quot;, &quot;country_name&quot;, &quot;ip&quot;, &quot;postal_code&quot;, &quot;region_name&quot;]</span><br><span class=\"line\">\t\t\t\t\tdatabase =&gt; &quot;F:/ELK/logstash-2.4.1/ip/GeoLiteCity.dat&quot;</span><br><span class=\"line\">\t\t\t\t\tadd_field =&gt; [ &quot;[geoip][coordinates]&quot;, &quot;%&#123;[geoip][longitude]&#125;&quot; ]</span><br><span class=\"line\">\t\t\t\t\tadd_field =&gt; [ &quot;[geoip][coordinates]&quot;, &quot;%&#123;[geoip][latitude]&#125;&quot;  ]</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t\tmutate &#123;</span><br><span class=\"line\">\t\t\t\t\tconvert =&gt; [ &quot;[geoip][coordinates]&quot;, &quot;float&quot;]</span><br><span class=\"line\">\t\t\t\t\t</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"> \t&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">output &#123;</span><br><span class=\"line\"> if [type] == &quot;nginx_access&quot; &#123;</span><br><span class=\"line\">    elasticsearch &#123;</span><br><span class=\"line\">        hosts =&gt; [&quot;127.0.0.1:9200&quot;]</span><br><span class=\"line\">        index =&gt; &quot;logstash-nginx-access-%&#123;+YYYY.MM&#125;&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">   stdout &#123;codec =&gt; rubydebug&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  if [type] == &quot;nginx_json&quot; &#123;</span><br><span class=\"line\">    elasticsearch &#123;</span><br><span class=\"line\">        hosts =&gt; [&quot;127.0.0.1:9200&quot;]</span><br><span class=\"line\">        index =&gt; &quot;logstash-nginx-json-%&#123;+YYYY.MM&#125;&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">   stdout &#123;codec =&gt; rubydebug&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"安装elasticsearch","date":"2017-01-25T11:56:10.000Z","_content":"## elasticsearch 目录结构\n\n|type | description | location |\n|-------|---------------------|-------|\n|home | Home of elasticsearch installation |\t/usr/share/elasticsearch \n| bin\t| Binary scripts including elasticsearch to start a node |\t/usr/share/elasticsearch/bin\n|conf\t| Configuration files elasticsearch.yml and logging.yml\t|/etc/elasticsearch\n|conf |Environment variables including heap size,file descriptors\t|/etc/default/elasticsearch\n|data\t| The location of the data files\t|/var/lib/elasticsearch/\n|logs\t| Log files location\t|/var/log/elasticsearch\n|plugins\t| Plugin files location\t|/usr/share/elasticsearch/plugins\n\n下载地址\n\n####  window7\nbin目录执行安装\n```\nF:\\ELK\\elasticsearch-2.4.1\\bin>service install\nInstalling service      :  \"elasticsearch-service-x64\"\nUsing JAVA_HOME (64-bit):  \"F:\\java\\jdk8\"\nThe service 'elasticsearch-service-x64' has been installed.\n```\n安装成功，如果启动失败（进logs目录，查看错误信息）\n <!--more--> \n```\n[error] [ 6376] Failed creating java %JAVA_HOME%\\jre\\bin\\server\\jvm.dll\n [error] [ 6376] 系统找不到指定的路径。\n ```\n 直接利用管理服务\n ```\n #运行 service manager 会弹出服务管理界面 修改jvm指定路径\nF:\\ELK\\elasticsearch-2.4.1\\bin>service manager\n```\n\n#### debian8\n```\nsudo dpkg -i  elasticsearch-2.4.2.deb\nbin$> ./elasticsearch   #启动提示没有权限\n```\n需要授权执行命令** chmod +x bin/elasticsearch  ** \n再次执行** ./elasticsearch -d **即可后台启动 \n使用** ps aux|grep elasticsearch **可以查看是否启动\n\n**设置开机启动**\n创建脚本 start.sh\n```\n#!bin/bash\nexport JAVA_HOME=/usr/bin/java\nexport JRE_HOME=${JAVA_HOME}/jre\nexport CLASSPATH=.:${JAVA_HOME}/lib:${JRE_HOME}/lib\nexport PATH=${JAVA_HOME}/bin:$PATH\n #切换到cs用户（带环境变量）\nsu -cs<<!\ncd /opt/elasticsearch/bin\n./elasticsearch &\nexit\n!\n```\n修改启动文件 mousepad /etc/init.d/elasticsearch\n```\n#!bin/bash\n### BEGIN INIT INFO\n# Provides:          elasticsearch\n# Required-Start:    $all\n# Required-Stop:     $all\n# Default-Start:     2 3 4 5\n# Default-Stop:      0 1 6\n# Short-De.ion: starts the elasticsearch  server\n# De.ion:       starts elasticsearch using start-stop-daemon\n### END INIT INFO\nsh /opt/elasticsearch/start.sh\n```\n","source":"_posts/services/elk/安装ElasticSearch.md","raw":"---\ntitle: 安装elasticsearch\ndate: 2017-01-25 19:56:10\ntags:  \n - search\n - install\n - win\ncategories: \n - ELK\n - elasticsearch\n---\n## elasticsearch 目录结构\n\n|type | description | location |\n|-------|---------------------|-------|\n|home | Home of elasticsearch installation |\t/usr/share/elasticsearch \n| bin\t| Binary scripts including elasticsearch to start a node |\t/usr/share/elasticsearch/bin\n|conf\t| Configuration files elasticsearch.yml and logging.yml\t|/etc/elasticsearch\n|conf |Environment variables including heap size,file descriptors\t|/etc/default/elasticsearch\n|data\t| The location of the data files\t|/var/lib/elasticsearch/\n|logs\t| Log files location\t|/var/log/elasticsearch\n|plugins\t| Plugin files location\t|/usr/share/elasticsearch/plugins\n\n下载地址\n\n####  window7\nbin目录执行安装\n```\nF:\\ELK\\elasticsearch-2.4.1\\bin>service install\nInstalling service      :  \"elasticsearch-service-x64\"\nUsing JAVA_HOME (64-bit):  \"F:\\java\\jdk8\"\nThe service 'elasticsearch-service-x64' has been installed.\n```\n安装成功，如果启动失败（进logs目录，查看错误信息）\n <!--more--> \n```\n[error] [ 6376] Failed creating java %JAVA_HOME%\\jre\\bin\\server\\jvm.dll\n [error] [ 6376] 系统找不到指定的路径。\n ```\n 直接利用管理服务\n ```\n #运行 service manager 会弹出服务管理界面 修改jvm指定路径\nF:\\ELK\\elasticsearch-2.4.1\\bin>service manager\n```\n\n#### debian8\n```\nsudo dpkg -i  elasticsearch-2.4.2.deb\nbin$> ./elasticsearch   #启动提示没有权限\n```\n需要授权执行命令** chmod +x bin/elasticsearch  ** \n再次执行** ./elasticsearch -d **即可后台启动 \n使用** ps aux|grep elasticsearch **可以查看是否启动\n\n**设置开机启动**\n创建脚本 start.sh\n```\n#!bin/bash\nexport JAVA_HOME=/usr/bin/java\nexport JRE_HOME=${JAVA_HOME}/jre\nexport CLASSPATH=.:${JAVA_HOME}/lib:${JRE_HOME}/lib\nexport PATH=${JAVA_HOME}/bin:$PATH\n #切换到cs用户（带环境变量）\nsu -cs<<!\ncd /opt/elasticsearch/bin\n./elasticsearch &\nexit\n!\n```\n修改启动文件 mousepad /etc/init.d/elasticsearch\n```\n#!bin/bash\n### BEGIN INIT INFO\n# Provides:          elasticsearch\n# Required-Start:    $all\n# Required-Stop:     $all\n# Default-Start:     2 3 4 5\n# Default-Stop:      0 1 6\n# Short-De.ion: starts the elasticsearch  server\n# De.ion:       starts elasticsearch using start-stop-daemon\n### END INIT INFO\nsh /opt/elasticsearch/start.sh\n```\n","slug":"services/elk/安装ElasticSearch","published":1,"updated":"2022-06-03T08:39:13.675Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gttz0042gwi5941k5bhb","content":"<h2 id=\"elasticsearch-目录结构\"><a href=\"#elasticsearch-目录结构\" class=\"headerlink\" title=\"elasticsearch 目录结构\"></a>elasticsearch 目录结构</h2><table>\n<thead>\n<tr>\n<th>type</th>\n<th>description</th>\n<th>location</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>home</td>\n<td>Home of elasticsearch installation</td>\n<td>&#x2F;usr&#x2F;share&#x2F;elasticsearch</td>\n</tr>\n<tr>\n<td>bin</td>\n<td>Binary scripts including elasticsearch to start a node</td>\n<td>&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;bin</td>\n</tr>\n<tr>\n<td>conf</td>\n<td>Configuration files elasticsearch.yml and logging.yml</td>\n<td>&#x2F;etc&#x2F;elasticsearch</td>\n</tr>\n<tr>\n<td>conf</td>\n<td>Environment variables including heap size,file descriptors</td>\n<td>&#x2F;etc&#x2F;default&#x2F;elasticsearch</td>\n</tr>\n<tr>\n<td>data</td>\n<td>The location of the data files</td>\n<td>&#x2F;var&#x2F;lib&#x2F;elasticsearch&#x2F;</td>\n</tr>\n<tr>\n<td>logs</td>\n<td>Log files location</td>\n<td>&#x2F;var&#x2F;log&#x2F;elasticsearch</td>\n</tr>\n<tr>\n<td>plugins</td>\n<td>Plugin files location</td>\n<td>&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;plugins</td>\n</tr>\n</tbody></table>\n<p>下载地址</p>\n<h4 id=\"window7\"><a href=\"#window7\" class=\"headerlink\" title=\"window7\"></a>window7</h4><p>bin目录执行安装</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">F:\\ELK\\elasticsearch-2.4.1\\bin&gt;service install</span><br><span class=\"line\">Installing service      :  &quot;elasticsearch-service-x64&quot;</span><br><span class=\"line\">Using JAVA_HOME (64-bit):  &quot;F:\\java\\jdk8&quot;</span><br><span class=\"line\">The service &#x27;elasticsearch-service-x64&#x27; has been installed.</span><br></pre></td></tr></table></figure>\n<p>安装成功，如果启动失败（进logs目录，查看错误信息）<br> <span id=\"more\"></span> </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[error] [ 6376] Failed creating java %JAVA_HOME%\\jre\\bin\\server\\jvm.dll</span><br><span class=\"line\"> [error] [ 6376] 系统找不到指定的路径。</span><br></pre></td></tr></table></figure>\n<p> 直接利用管理服务<br> <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> #运行 service manager 会弹出服务管理界面 修改jvm指定路径</span><br><span class=\"line\">F:\\ELK\\elasticsearch-2.4.1\\bin&gt;service manager</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"debian8\"><a href=\"#debian8\" class=\"headerlink\" title=\"debian8\"></a>debian8</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo dpkg -i  elasticsearch-2.4.2.deb</span><br><span class=\"line\">bin$&gt; ./elasticsearch   #启动提示没有权限</span><br></pre></td></tr></table></figure>\n<p>需要授权执行命令** chmod +x bin&#x2F;elasticsearch  **<br>再次执行** .&#x2F;elasticsearch -d <strong>即可后台启动<br>使用</strong> ps aux|grep elasticsearch **可以查看是否启动</p>\n<p><strong>设置开机启动</strong><br>创建脚本 start.sh</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!bin/bash</span><br><span class=\"line\">export JAVA_HOME=/usr/bin/java</span><br><span class=\"line\">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre</span><br><span class=\"line\">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib</span><br><span class=\"line\">export PATH=$&#123;JAVA_HOME&#125;/bin:$PATH</span><br><span class=\"line\"> #切换到cs用户（带环境变量）</span><br><span class=\"line\">su -cs&lt;&lt;!</span><br><span class=\"line\">cd /opt/elasticsearch/bin</span><br><span class=\"line\">./elasticsearch &amp;</span><br><span class=\"line\">exit</span><br><span class=\"line\">!</span><br></pre></td></tr></table></figure>\n<p>修改启动文件 mousepad &#x2F;etc&#x2F;init.d&#x2F;elasticsearch</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!bin/bash</span><br><span class=\"line\">### BEGIN INIT INFO</span><br><span class=\"line\"># Provides:          elasticsearch</span><br><span class=\"line\"># Required-Start:    $all</span><br><span class=\"line\"># Required-Stop:     $all</span><br><span class=\"line\"># Default-Start:     2 3 4 5</span><br><span class=\"line\"># Default-Stop:      0 1 6</span><br><span class=\"line\"># Short-De.ion: starts the elasticsearch  server</span><br><span class=\"line\"># De.ion:       starts elasticsearch using start-stop-daemon</span><br><span class=\"line\">### END INIT INFO</span><br><span class=\"line\">sh /opt/elasticsearch/start.sh</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<h2 id=\"elasticsearch-目录结构\"><a href=\"#elasticsearch-目录结构\" class=\"headerlink\" title=\"elasticsearch 目录结构\"></a>elasticsearch 目录结构</h2><table>\n<thead>\n<tr>\n<th>type</th>\n<th>description</th>\n<th>location</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>home</td>\n<td>Home of elasticsearch installation</td>\n<td>&#x2F;usr&#x2F;share&#x2F;elasticsearch</td>\n</tr>\n<tr>\n<td>bin</td>\n<td>Binary scripts including elasticsearch to start a node</td>\n<td>&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;bin</td>\n</tr>\n<tr>\n<td>conf</td>\n<td>Configuration files elasticsearch.yml and logging.yml</td>\n<td>&#x2F;etc&#x2F;elasticsearch</td>\n</tr>\n<tr>\n<td>conf</td>\n<td>Environment variables including heap size,file descriptors</td>\n<td>&#x2F;etc&#x2F;default&#x2F;elasticsearch</td>\n</tr>\n<tr>\n<td>data</td>\n<td>The location of the data files</td>\n<td>&#x2F;var&#x2F;lib&#x2F;elasticsearch&#x2F;</td>\n</tr>\n<tr>\n<td>logs</td>\n<td>Log files location</td>\n<td>&#x2F;var&#x2F;log&#x2F;elasticsearch</td>\n</tr>\n<tr>\n<td>plugins</td>\n<td>Plugin files location</td>\n<td>&#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;plugins</td>\n</tr>\n</tbody></table>\n<p>下载地址</p>\n<h4 id=\"window7\"><a href=\"#window7\" class=\"headerlink\" title=\"window7\"></a>window7</h4><p>bin目录执行安装</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">F:\\ELK\\elasticsearch-2.4.1\\bin&gt;service install</span><br><span class=\"line\">Installing service      :  &quot;elasticsearch-service-x64&quot;</span><br><span class=\"line\">Using JAVA_HOME (64-bit):  &quot;F:\\java\\jdk8&quot;</span><br><span class=\"line\">The service &#x27;elasticsearch-service-x64&#x27; has been installed.</span><br></pre></td></tr></table></figure>\n<p>安装成功，如果启动失败（进logs目录，查看错误信息）<br>","more":"</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[error] [ 6376] Failed creating java %JAVA_HOME%\\jre\\bin\\server\\jvm.dll</span><br><span class=\"line\"> [error] [ 6376] 系统找不到指定的路径。</span><br></pre></td></tr></table></figure>\n<p> 直接利用管理服务<br> <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> #运行 service manager 会弹出服务管理界面 修改jvm指定路径</span><br><span class=\"line\">F:\\ELK\\elasticsearch-2.4.1\\bin&gt;service manager</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"debian8\"><a href=\"#debian8\" class=\"headerlink\" title=\"debian8\"></a>debian8</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo dpkg -i  elasticsearch-2.4.2.deb</span><br><span class=\"line\">bin$&gt; ./elasticsearch   #启动提示没有权限</span><br></pre></td></tr></table></figure>\n<p>需要授权执行命令** chmod +x bin&#x2F;elasticsearch  **<br>再次执行** .&#x2F;elasticsearch -d <strong>即可后台启动<br>使用</strong> ps aux|grep elasticsearch **可以查看是否启动</p>\n<p><strong>设置开机启动</strong><br>创建脚本 start.sh</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!bin/bash</span><br><span class=\"line\">export JAVA_HOME=/usr/bin/java</span><br><span class=\"line\">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre</span><br><span class=\"line\">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib</span><br><span class=\"line\">export PATH=$&#123;JAVA_HOME&#125;/bin:$PATH</span><br><span class=\"line\"> #切换到cs用户（带环境变量）</span><br><span class=\"line\">su -cs&lt;&lt;!</span><br><span class=\"line\">cd /opt/elasticsearch/bin</span><br><span class=\"line\">./elasticsearch &amp;</span><br><span class=\"line\">exit</span><br><span class=\"line\">!</span><br></pre></td></tr></table></figure>\n<p>修改启动文件 mousepad &#x2F;etc&#x2F;init.d&#x2F;elasticsearch</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!bin/bash</span><br><span class=\"line\">### BEGIN INIT INFO</span><br><span class=\"line\"># Provides:          elasticsearch</span><br><span class=\"line\"># Required-Start:    $all</span><br><span class=\"line\"># Required-Stop:     $all</span><br><span class=\"line\"># Default-Start:     2 3 4 5</span><br><span class=\"line\"># Default-Stop:      0 1 6</span><br><span class=\"line\"># Short-De.ion: starts the elasticsearch  server</span><br><span class=\"line\"># De.ion:       starts elasticsearch using start-stop-daemon</span><br><span class=\"line\">### END INIT INFO</span><br><span class=\"line\">sh /opt/elasticsearch/start.sh</span><br></pre></td></tr></table></figure>"},{"title":"zk选举","date":"2022-06-03T10:24:28.000Z","_content":"\n#### 核心机制\n\n- 逻辑时间 epoch ,判断是否是同一轮投票(网络原因导致投票广播信息滞后)\n- 事物ID(Zxid),事物ID最大的数据最新  \n- 服务器ID(myid),数值大的权重大  \n\n<!--more-->\n\n```flow\nstart=>start: 选self\ninfo=>operation: 广播信息\nj1=>condition: 投票结果状态\n\nj2=>condition:  是否过时\nyj2=>operation: 清空投票信息\nnj2=>operation: 更新投票信息\n\nj3=>condition: 是否同一轮\nyj3=>operation: 比较投票信息\nnj3=>operation: 已完成投票信息\n\nj=>condition:  是否形成共识\nend=>end: 退出\n\nstart->info->j1\nj1(yes)->j3\nj1(no)->j2\n\nj2(yes)->yj2(right)->nj2\nj2(no)->nj2\n\nj3(yes)->yj3->j\nj3(no)->nj3->j\n\nnj2->yj3->j\nj(no)->info\nj(yes)->end\n\n```\n\n\n\n\n\n####  比较逻辑\n\n![](/pics/zk_flow_2232.png)\n\n\n\n同一轮,对投票信息(epoch,zxid,myid)进行比较(zxid,myid)\n\n是否过时:\n\n*过时*(小于),更新使用self信息(epoch,zxid,myid)\n\n非过时(大于),清空信息,更新(epoch)进行比较(zxid,myid)\n\n  \n\n根据以下规则,超过半数收到相同投票选出leader\n\n> 逻辑时钟小的选举结果被忽略，重新投票\n>\n> 统一逻辑时钟后，事物ID大的胜出\n>\n> 事物ID相同的情况下，服务器ID大的胜出\n\n","source":"_posts/services/zookeeper/选举机制.md","raw":"---\ntitle: zk选举\npermalink: services/zookeeper/选举机制/\ntags:\n  - 服务发现\n  - 选举\ncategories:\n  - services\n  - zookeeper\ndate: 2022-06-03 18:24:28\n---\n\n#### 核心机制\n\n- 逻辑时间 epoch ,判断是否是同一轮投票(网络原因导致投票广播信息滞后)\n- 事物ID(Zxid),事物ID最大的数据最新  \n- 服务器ID(myid),数值大的权重大  \n\n<!--more-->\n\n```flow\nstart=>start: 选self\ninfo=>operation: 广播信息\nj1=>condition: 投票结果状态\n\nj2=>condition:  是否过时\nyj2=>operation: 清空投票信息\nnj2=>operation: 更新投票信息\n\nj3=>condition: 是否同一轮\nyj3=>operation: 比较投票信息\nnj3=>operation: 已完成投票信息\n\nj=>condition:  是否形成共识\nend=>end: 退出\n\nstart->info->j1\nj1(yes)->j3\nj1(no)->j2\n\nj2(yes)->yj2(right)->nj2\nj2(no)->nj2\n\nj3(yes)->yj3->j\nj3(no)->nj3->j\n\nnj2->yj3->j\nj(no)->info\nj(yes)->end\n\n```\n\n\n\n\n\n####  比较逻辑\n\n![](/pics/zk_flow_2232.png)\n\n\n\n同一轮,对投票信息(epoch,zxid,myid)进行比较(zxid,myid)\n\n是否过时:\n\n*过时*(小于),更新使用self信息(epoch,zxid,myid)\n\n非过时(大于),清空信息,更新(epoch)进行比较(zxid,myid)\n\n  \n\n根据以下规则,超过半数收到相同投票选出leader\n\n> 逻辑时钟小的选举结果被忽略，重新投票\n>\n> 统一逻辑时钟后，事物ID大的胜出\n>\n> 事物ID相同的情况下，服务器ID大的胜出\n\n","slug":"services/zookeeper/选举机制","published":1,"updated":"2022-08-28T09:10:00.936Z","__permalink":"services/zookeeper/选举机制/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtu00043gwi5g235h254","content":"<h4 id=\"核心机制\"><a href=\"#核心机制\" class=\"headerlink\" title=\"核心机制\"></a>核心机制</h4><ul>\n<li>逻辑时间 epoch ,判断是否是同一轮投票(网络原因导致投票广播信息滞后)</li>\n<li>事物ID(Zxid),事物ID最大的数据最新  </li>\n<li>服务器ID(myid),数值大的权重大</li>\n</ul>\n<span id=\"more\"></span>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">start=&gt;start: 选self</span><br><span class=\"line\">info=&gt;operation: 广播信息</span><br><span class=\"line\">j1=&gt;condition: 投票结果状态</span><br><span class=\"line\"></span><br><span class=\"line\">j2=&gt;condition:  是否过时</span><br><span class=\"line\">yj2=&gt;operation: 清空投票信息</span><br><span class=\"line\">nj2=&gt;operation: 更新投票信息</span><br><span class=\"line\"></span><br><span class=\"line\">j3=&gt;condition: 是否同一轮</span><br><span class=\"line\">yj3=&gt;operation: 比较投票信息</span><br><span class=\"line\">nj3=&gt;operation: 已完成投票信息</span><br><span class=\"line\"></span><br><span class=\"line\">j=&gt;condition:  是否形成共识</span><br><span class=\"line\">end=&gt;end: 退出</span><br><span class=\"line\"></span><br><span class=\"line\">start-&gt;info-&gt;j1</span><br><span class=\"line\">j1(yes)-&gt;j3</span><br><span class=\"line\">j1(no)-&gt;j2</span><br><span class=\"line\"></span><br><span class=\"line\">j2(yes)-&gt;yj2(right)-&gt;nj2</span><br><span class=\"line\">j2(no)-&gt;nj2</span><br><span class=\"line\"></span><br><span class=\"line\">j3(yes)-&gt;yj3-&gt;j</span><br><span class=\"line\">j3(no)-&gt;nj3-&gt;j</span><br><span class=\"line\"></span><br><span class=\"line\">nj2-&gt;yj3-&gt;j</span><br><span class=\"line\">j(no)-&gt;info</span><br><span class=\"line\">j(yes)-&gt;end</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h4 id=\"比较逻辑\"><a href=\"#比较逻辑\" class=\"headerlink\" title=\"比较逻辑\"></a>比较逻辑</h4><p><img src=\"/pics/zk_flow_2232.png\"></p>\n<p>同一轮,对投票信息(epoch,zxid,myid)进行比较(zxid,myid)</p>\n<p>是否过时:</p>\n<p><em>过时</em>(小于),更新使用self信息(epoch,zxid,myid)</p>\n<p>非过时(大于),清空信息,更新(epoch)进行比较(zxid,myid)</p>\n<p>根据以下规则,超过半数收到相同投票选出leader</p>\n<blockquote>\n<p>逻辑时钟小的选举结果被忽略，重新投票</p>\n<p>统一逻辑时钟后，事物ID大的胜出</p>\n<p>事物ID相同的情况下，服务器ID大的胜出</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<h4 id=\"核心机制\"><a href=\"#核心机制\" class=\"headerlink\" title=\"核心机制\"></a>核心机制</h4><ul>\n<li>逻辑时间 epoch ,判断是否是同一轮投票(网络原因导致投票广播信息滞后)</li>\n<li>事物ID(Zxid),事物ID最大的数据最新  </li>\n<li>服务器ID(myid),数值大的权重大</li>\n</ul>","more":"<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">start=&gt;start: 选self</span><br><span class=\"line\">info=&gt;operation: 广播信息</span><br><span class=\"line\">j1=&gt;condition: 投票结果状态</span><br><span class=\"line\"></span><br><span class=\"line\">j2=&gt;condition:  是否过时</span><br><span class=\"line\">yj2=&gt;operation: 清空投票信息</span><br><span class=\"line\">nj2=&gt;operation: 更新投票信息</span><br><span class=\"line\"></span><br><span class=\"line\">j3=&gt;condition: 是否同一轮</span><br><span class=\"line\">yj3=&gt;operation: 比较投票信息</span><br><span class=\"line\">nj3=&gt;operation: 已完成投票信息</span><br><span class=\"line\"></span><br><span class=\"line\">j=&gt;condition:  是否形成共识</span><br><span class=\"line\">end=&gt;end: 退出</span><br><span class=\"line\"></span><br><span class=\"line\">start-&gt;info-&gt;j1</span><br><span class=\"line\">j1(yes)-&gt;j3</span><br><span class=\"line\">j1(no)-&gt;j2</span><br><span class=\"line\"></span><br><span class=\"line\">j2(yes)-&gt;yj2(right)-&gt;nj2</span><br><span class=\"line\">j2(no)-&gt;nj2</span><br><span class=\"line\"></span><br><span class=\"line\">j3(yes)-&gt;yj3-&gt;j</span><br><span class=\"line\">j3(no)-&gt;nj3-&gt;j</span><br><span class=\"line\"></span><br><span class=\"line\">nj2-&gt;yj3-&gt;j</span><br><span class=\"line\">j(no)-&gt;info</span><br><span class=\"line\">j(yes)-&gt;end</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h4 id=\"比较逻辑\"><a href=\"#比较逻辑\" class=\"headerlink\" title=\"比较逻辑\"></a>比较逻辑</h4><p><img src=\"/pics/zk_flow_2232.png\"></p>\n<p>同一轮,对投票信息(epoch,zxid,myid)进行比较(zxid,myid)</p>\n<p>是否过时:</p>\n<p><em>过时</em>(小于),更新使用self信息(epoch,zxid,myid)</p>\n<p>非过时(大于),清空信息,更新(epoch)进行比较(zxid,myid)</p>\n<p>根据以下规则,超过半数收到相同投票选出leader</p>\n<blockquote>\n<p>逻辑时钟小的选举结果被忽略，重新投票</p>\n<p>统一逻辑时钟后，事物ID大的胜出</p>\n<p>事物ID相同的情况下，服务器ID大的胜出</p>\n</blockquote>"},{"title":"hexo插件","date":"2022-08-20T05:24:54.000Z","_content":"\n\n\n\n\n\n## 本地搜索\n\n```\nnpm install --save hexo-generator-search\n```\n\n<!--more-->\n\n### hexo\n\n_config.yml\n\n```\nsearch:\n  path: search.json\n  field: all\n  content: true\n  limit: 1000\n```\n\n\n\n\n\n### 主题spfk\n\n#### _config.yml\n\n```\nsearch_box: true\n```\n\n#### 左侧left-col.ejs\n\n/hexo/themes/spfk/layout/_partial/left-col.ejs\n\n```ejs\n<div id=\"id_search\"   onclick = \"document.getElementById('local_search').style.display='block'\">\n <span class=\"search-icon\">\n\t<i class=\"fa fa-search\"> </i>\n   </span> 搜索\n</div>\n```\n\n#### 弹出层layout.ejs\n\n/hexo/themes/spfk/layout/layout.ejs\n\n```ejs\n<div id=\"local_search\" class=\"search-popup\" >\n  <div class=\"search-header\">\n\t    <i class=\"fa fa-search\"> </i> <input id=\"local-search-input\" class=\"search-input\" placeholder=\"搜索...\" spellcheck=\"false\" type=\"search\"/>\n  </div>\n  <div id=\"local-search-result\"></div>\n</div>\n```\n\n####  触发搜索 after-footer.ejs\n\n/hexo/themes/spfk/layout/_partial/after-footer.ejs\n\n##### 引入search.js\n\n```js\n<%- js('js/jquery-1.9.1.min') %>\n<%- js('js/search') %>\n\n<% if (theme.search_box) { %>\n   <script type=\"text/javascript\">\n\tvar inputArea       = document.querySelector(\"#local-search-input\");\n\tinputArea.onclick   = function(){ getSearchFile(); this.onclick = null }\n\tinputArea.onkeydown = function(){ if(event.keyCode == 13) return false }\n\tvar getSearchFile = function(){\n\t      searchFunc(\"<%= config.root %>\" + \"search.json\", 'local-search-input', 'local-search-result');\n\t}\n          $(document).on('click', function(e) {\n\t\t   var si= $(e.target).closest('#id_search').length;\n           var d= $(e.target).closest('#local_search').length;\n             if(si==1){ \n\t\t\tdocument.body.style.overflow='hidden';\n\t\t}\n             if( si==0 && d==0){\n              document.body.style.overflow=''\n               $('#local_search').hide();\n              }    \n\n       });\n\n  </script>\n<% } %>\n```\n\n##### search.js\n\n/hexo/themes/spfk/source/js/search.js\n\n```js\nvar searchFunc = function (path, search_id, content_id) {\n  // 0x00. environment initialization\n  'use strict';\n  var $input = document.getElementById(search_id);\n  var $resultContent = document.getElementById(content_id);\n  $resultContent.innerHTML = \"<ul><span class='local-search-empty'>首次搜索，正在载入索引文件，请稍后……<span></ul>\";\n  $.ajax({\n    // 0x01. load xml file\n    url: path,\n    dataType: \"json\",\n    success: function (datas) {\n      $resultContent.innerHTML = \"\";\n      $input.addEventListener('input', function () {\n        // 0x03. parse query to keywords list\n        var str = '<ul class=\\\"search-result-list\\\">';\n        var keywords = this.value.trim().toLowerCase().split(/[\\s\\-]+/);\n        $resultContent.innerHTML = \"\";\n        if (this.value.trim().length <= 0) {\n          return;\n        }\n        // 0x04. perform local searching\n        datas.forEach(function (data) {\n          var isMatch = true;\n          var content_index = [];\n          if (!data.title || data.title.trim() === '') {\n            data.title = \"Untitled\";\n          }\n          var orig_data_title = data.title.trim();\n          var data_title = orig_data_title.toLowerCase();\n             if (!data.content || data.content.trim() === '') {\n                         console.log(data.content)//空文章\n                      data.content = \"no content\";\n                 }\n          var orig_data_content = data.content.trim().replace(/<[^>]+>/g, \"\");\n          var data_content = orig_data_content.toLowerCase();\n          var data_url = data.url;\n     \n          var index_title = -1;\n          var index_content = -1;\n          var first_occur = -1;\n          // only match artiles with not empty contents\n          if (data_content !== '') {\n            keywords.forEach(function (keyword, i) {\n              index_title = data_title.indexOf(keyword);\n              index_content = data_content.indexOf(keyword);\n\n              if (index_title < 0 && index_content < 0) {\n                isMatch = false;\n              } else {\n                if (index_content < 0) {\n                  index_content = 0;\n                }\n                if (i == 0) {\n                  first_occur = index_content;\n                }\n                // content_index.push({index_content:index_content, keyword_len:keyword_len});\n              }\n            });\n          } else {\n            isMatch = false;\n          }\n          // 0x05. show search results\n          if (isMatch) {\n            str += \"<li><a href='\" + data_url + \"' class='search-result-title' target='_blank'>\" + orig_data_title + \"</a>\";\n            var content = orig_data_content;\n            if (first_occur >= 0) {\n              // cut out 100 characters\n              var start = first_occur - 20;\n              var end = first_occur + 10;\n\n              if (start < 0) {\n                start = 0;\n              }\n\n              if (start == 0) {\n                end = 100;\n              }\n\n              if (end > content.length) {\n                end = content.length;\n              }\n\n              var match_content = content.substr(start, end);\n\n              // highlight all keywords\n              keywords.forEach(function (keyword) {\n                var regS = new RegExp(keyword, \"gi\");\n                match_content = match_content.replace(regS, \"<em class=\\\"search-keyword\\\">\" + keyword + \"</em>\");\n              });\n\n              str += \"<p class=\\\"search-result\\\">\" + match_content + \"...</p>\"\n            }\n            str += \"</li>\";\n          }\n        });\n        str += \"</ul>\";\n        if (str.indexOf('<li>') === -1) {\n          return $resultContent.innerHTML =  \"<ul><span class='local-search-empty'>没有找到内容，请尝试更换检索词。<span></ul>\";\n        }\n        $resultContent.innerHTML =  str;\n      });\n    }\n  });\n}\n```\n\n##### css\n\n/hexo/themes/spfk/source/css/search.css\n\n```css\n\n.search-popup {\n  display: none;\n  background: #32503d;\n  border-radius: 5px;\n  height: 80%;\n  left: calc(50% - 350px);\n  position: fixed;\n  top: 10%;\n  width: 700px;\n  z-index: 1500;\n}\n\n.search-popup .search-header {\n  background: #eee;\n  border-top-left-radius: 5px;\n  border-top-right-radius: 5px;\n  display: flex;\n  padding: 5px;\n}\n.search-popup input.search-input {\n  background: transparent;\n  border: 0;\n  outline: 0;\n  width: 100%;\n}\n\n\n.search-popup ul.search-result-list {\n  margin: 0 5px;\n  padding: 0;\n  width: 100%;\n \n}\n\nul.search-result-list li::marker {\n content: '😩';\n}\n\n\n.search-popup p.search-result {\n  border-bottom: 2px dashed #7de485d4;\n  padding: 5px 0;\n  line-height: 21px;\n}\n.search-popup a.search-result-title {\n  font-weight: bold;\n}\n.search-popup .search-keyword {\n  border-bottom: 1px dashed #ff2a2a;\n  color: #ff2a2a;\n  font-weight: bold;\n}\n.search-popup #local-search-result{\n  display: flex;\n  height: calc(100% - 55px);\n  overflow: auto;\n  padding: 5px 25px;\n}\n.search-popup #no-result {\n  color: #ccc;\n  margin: auto;\n}\n```\n\n\n\n## live2d\n\n### helper\n\n```\nnpm install --save hexo-helper-live2d\n```\n\n\n\n_config.yml\n\n```\nlive2d:\nenable: true\nscriptFrom: local\nmodel: \n  use: live2d-widget-model-hibiki #模型选择\ndisplay: \n  position: right  #模型位置\n  width: 150       #模型宽度\n  height: 300      #模型高度\nmobile: \n  show: false      #是否在手机端显示\n```\n\n\n\n### js  推荐\n\n放在合适位置 footer.ejs  \n\n```\n<script src=\"https://eqcn.ajz.miesnfu.com/wp-content/plugins/wp-3d-pony/live2dw/lib/L2Dwidget.min.js\"></script>\n<script>\n    L2Dwidget.init({\n        \"model\": {\n　　　　　　　//jsonpath控制显示那个小萝莉模型\n            jsonPath: \"https://unpkg.com/live2d-widget-model-haruto@1.0.5/assets/haruto.model.json\",\n            \"scale\": 1\n        },\n        \"display\": {\n            \"position\": \"right\", //看板娘的表现位置\n            \"width\": 150,  //小萝莉的宽度\n            \"height\": 300, //小萝莉的高度\n            \"hOffset\": 0,\n            \"vOffset\": -20\n        },\n        \"mobile\": {\n            \"show\": true,\n            \"scale\": 0.5\n        },\n        \"react\": {\n            \"opacityDefault\": 0.7,\n            \"opacityOnHover\": 0.2\n        }\n    });\n</script>\n```\n\n","source":"_posts/lang/node/hexo/hexo.md","raw":"---\ntitle: hexo插件\npermalink: node/npm/hexo/\ntags:\n  - hexo\n  - search\ncategories:\n  - lang \n  - npm\ndate: 2022-08-20 13:24:54\n---\n\n\n\n\n\n\n## 本地搜索\n\n```\nnpm install --save hexo-generator-search\n```\n\n<!--more-->\n\n### hexo\n\n_config.yml\n\n```\nsearch:\n  path: search.json\n  field: all\n  content: true\n  limit: 1000\n```\n\n\n\n\n\n### 主题spfk\n\n#### _config.yml\n\n```\nsearch_box: true\n```\n\n#### 左侧left-col.ejs\n\n/hexo/themes/spfk/layout/_partial/left-col.ejs\n\n```ejs\n<div id=\"id_search\"   onclick = \"document.getElementById('local_search').style.display='block'\">\n <span class=\"search-icon\">\n\t<i class=\"fa fa-search\"> </i>\n   </span> 搜索\n</div>\n```\n\n#### 弹出层layout.ejs\n\n/hexo/themes/spfk/layout/layout.ejs\n\n```ejs\n<div id=\"local_search\" class=\"search-popup\" >\n  <div class=\"search-header\">\n\t    <i class=\"fa fa-search\"> </i> <input id=\"local-search-input\" class=\"search-input\" placeholder=\"搜索...\" spellcheck=\"false\" type=\"search\"/>\n  </div>\n  <div id=\"local-search-result\"></div>\n</div>\n```\n\n####  触发搜索 after-footer.ejs\n\n/hexo/themes/spfk/layout/_partial/after-footer.ejs\n\n##### 引入search.js\n\n```js\n<%- js('js/jquery-1.9.1.min') %>\n<%- js('js/search') %>\n\n<% if (theme.search_box) { %>\n   <script type=\"text/javascript\">\n\tvar inputArea       = document.querySelector(\"#local-search-input\");\n\tinputArea.onclick   = function(){ getSearchFile(); this.onclick = null }\n\tinputArea.onkeydown = function(){ if(event.keyCode == 13) return false }\n\tvar getSearchFile = function(){\n\t      searchFunc(\"<%= config.root %>\" + \"search.json\", 'local-search-input', 'local-search-result');\n\t}\n          $(document).on('click', function(e) {\n\t\t   var si= $(e.target).closest('#id_search').length;\n           var d= $(e.target).closest('#local_search').length;\n             if(si==1){ \n\t\t\tdocument.body.style.overflow='hidden';\n\t\t}\n             if( si==0 && d==0){\n              document.body.style.overflow=''\n               $('#local_search').hide();\n              }    \n\n       });\n\n  </script>\n<% } %>\n```\n\n##### search.js\n\n/hexo/themes/spfk/source/js/search.js\n\n```js\nvar searchFunc = function (path, search_id, content_id) {\n  // 0x00. environment initialization\n  'use strict';\n  var $input = document.getElementById(search_id);\n  var $resultContent = document.getElementById(content_id);\n  $resultContent.innerHTML = \"<ul><span class='local-search-empty'>首次搜索，正在载入索引文件，请稍后……<span></ul>\";\n  $.ajax({\n    // 0x01. load xml file\n    url: path,\n    dataType: \"json\",\n    success: function (datas) {\n      $resultContent.innerHTML = \"\";\n      $input.addEventListener('input', function () {\n        // 0x03. parse query to keywords list\n        var str = '<ul class=\\\"search-result-list\\\">';\n        var keywords = this.value.trim().toLowerCase().split(/[\\s\\-]+/);\n        $resultContent.innerHTML = \"\";\n        if (this.value.trim().length <= 0) {\n          return;\n        }\n        // 0x04. perform local searching\n        datas.forEach(function (data) {\n          var isMatch = true;\n          var content_index = [];\n          if (!data.title || data.title.trim() === '') {\n            data.title = \"Untitled\";\n          }\n          var orig_data_title = data.title.trim();\n          var data_title = orig_data_title.toLowerCase();\n             if (!data.content || data.content.trim() === '') {\n                         console.log(data.content)//空文章\n                      data.content = \"no content\";\n                 }\n          var orig_data_content = data.content.trim().replace(/<[^>]+>/g, \"\");\n          var data_content = orig_data_content.toLowerCase();\n          var data_url = data.url;\n     \n          var index_title = -1;\n          var index_content = -1;\n          var first_occur = -1;\n          // only match artiles with not empty contents\n          if (data_content !== '') {\n            keywords.forEach(function (keyword, i) {\n              index_title = data_title.indexOf(keyword);\n              index_content = data_content.indexOf(keyword);\n\n              if (index_title < 0 && index_content < 0) {\n                isMatch = false;\n              } else {\n                if (index_content < 0) {\n                  index_content = 0;\n                }\n                if (i == 0) {\n                  first_occur = index_content;\n                }\n                // content_index.push({index_content:index_content, keyword_len:keyword_len});\n              }\n            });\n          } else {\n            isMatch = false;\n          }\n          // 0x05. show search results\n          if (isMatch) {\n            str += \"<li><a href='\" + data_url + \"' class='search-result-title' target='_blank'>\" + orig_data_title + \"</a>\";\n            var content = orig_data_content;\n            if (first_occur >= 0) {\n              // cut out 100 characters\n              var start = first_occur - 20;\n              var end = first_occur + 10;\n\n              if (start < 0) {\n                start = 0;\n              }\n\n              if (start == 0) {\n                end = 100;\n              }\n\n              if (end > content.length) {\n                end = content.length;\n              }\n\n              var match_content = content.substr(start, end);\n\n              // highlight all keywords\n              keywords.forEach(function (keyword) {\n                var regS = new RegExp(keyword, \"gi\");\n                match_content = match_content.replace(regS, \"<em class=\\\"search-keyword\\\">\" + keyword + \"</em>\");\n              });\n\n              str += \"<p class=\\\"search-result\\\">\" + match_content + \"...</p>\"\n            }\n            str += \"</li>\";\n          }\n        });\n        str += \"</ul>\";\n        if (str.indexOf('<li>') === -1) {\n          return $resultContent.innerHTML =  \"<ul><span class='local-search-empty'>没有找到内容，请尝试更换检索词。<span></ul>\";\n        }\n        $resultContent.innerHTML =  str;\n      });\n    }\n  });\n}\n```\n\n##### css\n\n/hexo/themes/spfk/source/css/search.css\n\n```css\n\n.search-popup {\n  display: none;\n  background: #32503d;\n  border-radius: 5px;\n  height: 80%;\n  left: calc(50% - 350px);\n  position: fixed;\n  top: 10%;\n  width: 700px;\n  z-index: 1500;\n}\n\n.search-popup .search-header {\n  background: #eee;\n  border-top-left-radius: 5px;\n  border-top-right-radius: 5px;\n  display: flex;\n  padding: 5px;\n}\n.search-popup input.search-input {\n  background: transparent;\n  border: 0;\n  outline: 0;\n  width: 100%;\n}\n\n\n.search-popup ul.search-result-list {\n  margin: 0 5px;\n  padding: 0;\n  width: 100%;\n \n}\n\nul.search-result-list li::marker {\n content: '😩';\n}\n\n\n.search-popup p.search-result {\n  border-bottom: 2px dashed #7de485d4;\n  padding: 5px 0;\n  line-height: 21px;\n}\n.search-popup a.search-result-title {\n  font-weight: bold;\n}\n.search-popup .search-keyword {\n  border-bottom: 1px dashed #ff2a2a;\n  color: #ff2a2a;\n  font-weight: bold;\n}\n.search-popup #local-search-result{\n  display: flex;\n  height: calc(100% - 55px);\n  overflow: auto;\n  padding: 5px 25px;\n}\n.search-popup #no-result {\n  color: #ccc;\n  margin: auto;\n}\n```\n\n\n\n## live2d\n\n### helper\n\n```\nnpm install --save hexo-helper-live2d\n```\n\n\n\n_config.yml\n\n```\nlive2d:\nenable: true\nscriptFrom: local\nmodel: \n  use: live2d-widget-model-hibiki #模型选择\ndisplay: \n  position: right  #模型位置\n  width: 150       #模型宽度\n  height: 300      #模型高度\nmobile: \n  show: false      #是否在手机端显示\n```\n\n\n\n### js  推荐\n\n放在合适位置 footer.ejs  \n\n```\n<script src=\"https://eqcn.ajz.miesnfu.com/wp-content/plugins/wp-3d-pony/live2dw/lib/L2Dwidget.min.js\"></script>\n<script>\n    L2Dwidget.init({\n        \"model\": {\n　　　　　　　//jsonpath控制显示那个小萝莉模型\n            jsonPath: \"https://unpkg.com/live2d-widget-model-haruto@1.0.5/assets/haruto.model.json\",\n            \"scale\": 1\n        },\n        \"display\": {\n            \"position\": \"right\", //看板娘的表现位置\n            \"width\": 150,  //小萝莉的宽度\n            \"height\": 300, //小萝莉的高度\n            \"hOffset\": 0,\n            \"vOffset\": -20\n        },\n        \"mobile\": {\n            \"show\": true,\n            \"scale\": 0.5\n        },\n        \"react\": {\n            \"opacityDefault\": 0.7,\n            \"opacityOnHover\": 0.2\n        }\n    });\n</script>\n```\n\n","slug":"lang/node/hexo/hexo","published":1,"updated":"2022-08-29T13:43:31.836Z","__permalink":"node/npm/hexo/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtu10046gwi59kbq2pnx","content":"<h2 id=\"本地搜索\"><a href=\"#本地搜索\" class=\"headerlink\" title=\"本地搜索\"></a>本地搜索</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save hexo-generator-search</span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n<h3 id=\"hexo\"><a href=\"#hexo\" class=\"headerlink\" title=\"hexo\"></a>hexo</h3><p>_config.yml</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">search:</span><br><span class=\"line\">  path: search.json</span><br><span class=\"line\">  field: all</span><br><span class=\"line\">  content: true</span><br><span class=\"line\">  limit: 1000</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"主题spfk\"><a href=\"#主题spfk\" class=\"headerlink\" title=\"主题spfk\"></a>主题spfk</h3><h4 id=\"config-yml\"><a href=\"#config-yml\" class=\"headerlink\" title=\"_config.yml\"></a>_config.yml</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">search_box: true</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"左侧left-col-ejs\"><a href=\"#左侧left-col-ejs\" class=\"headerlink\" title=\"左侧left-col.ejs\"></a>左侧left-col.ejs</h4><p>&#x2F;hexo&#x2F;themes&#x2F;spfk&#x2F;layout&#x2F;_partial&#x2F;left-col.ejs</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id=&quot;id_search&quot;   onclick = &quot;document.getElementById(&#x27;local_search&#x27;).style.display=&#x27;block&#x27;&quot;&gt;</span><br><span class=\"line\"> &lt;span class=&quot;search-icon&quot;&gt;</span><br><span class=\"line\">\t&lt;i class=&quot;fa fa-search&quot;&gt; &lt;/i&gt;</span><br><span class=\"line\">   &lt;/span&gt; 搜索</span><br><span class=\"line\">&lt;/div&gt;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"弹出层layout-ejs\"><a href=\"#弹出层layout-ejs\" class=\"headerlink\" title=\"弹出层layout.ejs\"></a>弹出层layout.ejs</h4><p>&#x2F;hexo&#x2F;themes&#x2F;spfk&#x2F;layout&#x2F;layout.ejs</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id=&quot;local_search&quot; class=&quot;search-popup&quot; &gt;</span><br><span class=\"line\">  &lt;div class=&quot;search-header&quot;&gt;</span><br><span class=\"line\">\t    &lt;i class=&quot;fa fa-search&quot;&gt; &lt;/i&gt; &lt;input id=&quot;local-search-input&quot; class=&quot;search-input&quot; placeholder=&quot;搜索...&quot; spellcheck=&quot;false&quot; type=&quot;search&quot;/&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">  &lt;div id=&quot;local-search-result&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"触发搜索-after-footer-ejs\"><a href=\"#触发搜索-after-footer-ejs\" class=\"headerlink\" title=\"触发搜索 after-footer.ejs\"></a>触发搜索 after-footer.ejs</h4><p>&#x2F;hexo&#x2F;themes&#x2F;spfk&#x2F;layout&#x2F;_partial&#x2F;after-footer.ejs</p>\n<h5 id=\"引入search-js\"><a href=\"#引入search-js\" class=\"headerlink\" title=\"引入search.js\"></a>引入search.js</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;%- <span class=\"title function_\">js</span>(<span class=\"string\">&#x27;js/jquery-1.9.1.min&#x27;</span>) %&gt;</span><br><span class=\"line\">&lt;%- <span class=\"title function_\">js</span>(<span class=\"string\">&#x27;js/search&#x27;</span>) %&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;% <span class=\"keyword\">if</span> (theme.<span class=\"property\">search_box</span>) &#123; %&gt;</span><br><span class=\"line\">   <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">\t<span class=\"keyword\">var</span> inputArea       = <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&quot;#local-search-input&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">\tinputArea.<span class=\"property\">onclick</span>   = <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123; <span class=\"title function_\">getSearchFile</span>(); <span class=\"variable language_\">this</span>.<span class=\"property\">onclick</span> = <span class=\"literal\">null</span> &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">\tinputArea.<span class=\"property\">onkeydown</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123; <span class=\"keyword\">if</span>(event.<span class=\"property\">keyCode</span> == <span class=\"number\">13</span>) <span class=\"keyword\">return</span> <span class=\"literal\">false</span> &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">\t<span class=\"keyword\">var</span> getSearchFile = <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">\t      <span class=\"title function_\">searchFunc</span>(<span class=\"string\">&quot;&lt;%= config.root %&gt;&quot;</span> + <span class=\"string\">&quot;search.json&quot;</span>, <span class=\"string\">&#x27;local-search-input&#x27;</span>, <span class=\"string\">&#x27;local-search-result&#x27;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">\t&#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">          $(<span class=\"variable language_\">document</span>).<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;click&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">\t\t   <span class=\"keyword\">var</span> si= $(e.<span class=\"property\">target</span>).<span class=\"title function_\">closest</span>(<span class=\"string\">&#x27;#id_search&#x27;</span>).<span class=\"property\">length</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">           <span class=\"keyword\">var</span> d= $(e.<span class=\"property\">target</span>).<span class=\"title function_\">closest</span>(<span class=\"string\">&#x27;#local_search&#x27;</span>).<span class=\"property\">length</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">             <span class=\"keyword\">if</span>(si==<span class=\"number\">1</span>)&#123; </span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">\t\t\t<span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">style</span>.<span class=\"property\">overflow</span>=<span class=\"string\">&#x27;hidden&#x27;</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">\t\t&#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">             <span class=\"keyword\">if</span>( si==<span class=\"number\">0</span> &amp;&amp; d==<span class=\"number\">0</span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">              <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">style</span>.<span class=\"property\">overflow</span>=<span class=\"string\">&#x27;&#x27;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">               $(<span class=\"string\">&#x27;#local_search&#x27;</span>).<span class=\"title function_\">hide</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">              &#125;    </span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">       &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">  </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"search-js\"><a href=\"#search-js\" class=\"headerlink\" title=\"search.js\"></a>search.js</h5><p>&#x2F;hexo&#x2F;themes&#x2F;spfk&#x2F;source&#x2F;js&#x2F;search.js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> searchFunc = <span class=\"keyword\">function</span> (<span class=\"params\">path, search_id, content_id</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 0x00. environment initialization</span></span><br><span class=\"line\">  <span class=\"string\">&#x27;use strict&#x27;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> $input = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(search_id);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> $resultContent = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(content_id);</span><br><span class=\"line\">  $resultContent.<span class=\"property\">innerHTML</span> = <span class=\"string\">&quot;&lt;ul&gt;&lt;span class=&#x27;local-search-empty&#x27;&gt;首次搜索，正在载入索引文件，请稍后……&lt;span&gt;&lt;/ul&gt;&quot;</span>;</span><br><span class=\"line\">  $.<span class=\"title function_\">ajax</span>(&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 0x01. load xml file</span></span><br><span class=\"line\">    <span class=\"attr\">url</span>: path,</span><br><span class=\"line\">    <span class=\"attr\">dataType</span>: <span class=\"string\">&quot;json&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">success</span>: <span class=\"keyword\">function</span> (<span class=\"params\">datas</span>) &#123;</span><br><span class=\"line\">      $resultContent.<span class=\"property\">innerHTML</span> = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">      $input.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;input&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 0x03. parse query to keywords list</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> str = <span class=\"string\">&#x27;&lt;ul class=\\&quot;search-result-list\\&quot;&gt;&#x27;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> keywords = <span class=\"variable language_\">this</span>.<span class=\"property\">value</span>.<span class=\"title function_\">trim</span>().<span class=\"title function_\">toLowerCase</span>().<span class=\"title function_\">split</span>(<span class=\"regexp\">/[\\s\\-]+/</span>);</span><br><span class=\"line\">        $resultContent.<span class=\"property\">innerHTML</span> = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>.<span class=\"title function_\">trim</span>().<span class=\"property\">length</span> &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 0x04. perform local searching</span></span><br><span class=\"line\">        datas.<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> (<span class=\"params\">data</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> isMatch = <span class=\"literal\">true</span>;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> content_index = [];</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (!data.<span class=\"property\">title</span> || data.<span class=\"property\">title</span>.<span class=\"title function_\">trim</span>() === <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">            data.<span class=\"property\">title</span> = <span class=\"string\">&quot;Untitled&quot;</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> orig_data_title = data.<span class=\"property\">title</span>.<span class=\"title function_\">trim</span>();</span><br><span class=\"line\">          <span class=\"keyword\">var</span> data_title = orig_data_title.<span class=\"title function_\">toLowerCase</span>();</span><br><span class=\"line\">             <span class=\"keyword\">if</span> (!data.<span class=\"property\">content</span> || data.<span class=\"property\">content</span>.<span class=\"title function_\">trim</span>() === <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">                         <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(data.<span class=\"property\">content</span>)<span class=\"comment\">//空文章</span></span><br><span class=\"line\">                      data.<span class=\"property\">content</span> = <span class=\"string\">&quot;no content&quot;</span>;</span><br><span class=\"line\">                 &#125;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> orig_data_content = data.<span class=\"property\">content</span>.<span class=\"title function_\">trim</span>().<span class=\"title function_\">replace</span>(<span class=\"regexp\">/&lt;[^&gt;]+&gt;/g</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">          <span class=\"keyword\">var</span> data_content = orig_data_content.<span class=\"title function_\">toLowerCase</span>();</span><br><span class=\"line\">          <span class=\"keyword\">var</span> data_url = data.<span class=\"property\">url</span>;</span><br><span class=\"line\">     </span><br><span class=\"line\">          <span class=\"keyword\">var</span> index_title = -<span class=\"number\">1</span>;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> index_content = -<span class=\"number\">1</span>;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> first_occur = -<span class=\"number\">1</span>;</span><br><span class=\"line\">          <span class=\"comment\">// only match artiles with not empty contents</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> (data_content !== <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">            keywords.<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> (<span class=\"params\">keyword, i</span>) &#123;</span><br><span class=\"line\">              index_title = data_title.<span class=\"title function_\">indexOf</span>(keyword);</span><br><span class=\"line\">              index_content = data_content.<span class=\"title function_\">indexOf</span>(keyword);</span><br><span class=\"line\"></span><br><span class=\"line\">              <span class=\"keyword\">if</span> (index_title &lt; <span class=\"number\">0</span> &amp;&amp; index_content &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                isMatch = <span class=\"literal\">false</span>;</span><br><span class=\"line\">              &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (index_content &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                  index_content = <span class=\"number\">0</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (i == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                  first_occur = index_content;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">// content_index.push(&#123;index_content:index_content, keyword_len:keyword_len&#125;);</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            isMatch = <span class=\"literal\">false</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"comment\">// 0x05. show search results</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> (isMatch) &#123;</span><br><span class=\"line\">            str += <span class=\"string\">&quot;&lt;li&gt;&lt;a href=&#x27;&quot;</span> + data_url + <span class=\"string\">&quot;&#x27; class=&#x27;search-result-title&#x27; target=&#x27;_blank&#x27;&gt;&quot;</span> + orig_data_title + <span class=\"string\">&quot;&lt;/a&gt;&quot;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> content = orig_data_content;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (first_occur &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">              <span class=\"comment\">// cut out 100 characters</span></span><br><span class=\"line\">              <span class=\"keyword\">var</span> start = first_occur - <span class=\"number\">20</span>;</span><br><span class=\"line\">              <span class=\"keyword\">var</span> end = first_occur + <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">              <span class=\"keyword\">if</span> (start &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                start = <span class=\"number\">0</span>;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">              <span class=\"keyword\">if</span> (start == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                end = <span class=\"number\">100</span>;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">              <span class=\"keyword\">if</span> (end &gt; content.<span class=\"property\">length</span>) &#123;</span><br><span class=\"line\">                end = content.<span class=\"property\">length</span>;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">              <span class=\"keyword\">var</span> match_content = content.<span class=\"title function_\">substr</span>(start, end);</span><br><span class=\"line\"></span><br><span class=\"line\">              <span class=\"comment\">// highlight all keywords</span></span><br><span class=\"line\">              keywords.<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> (<span class=\"params\">keyword</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> regS = <span class=\"keyword\">new</span> <span class=\"title class_\">RegExp</span>(keyword, <span class=\"string\">&quot;gi&quot;</span>);</span><br><span class=\"line\">                match_content = match_content.<span class=\"title function_\">replace</span>(regS, <span class=\"string\">&quot;&lt;em class=\\&quot;search-keyword\\&quot;&gt;&quot;</span> + keyword + <span class=\"string\">&quot;&lt;/em&gt;&quot;</span>);</span><br><span class=\"line\">              &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">              str += <span class=\"string\">&quot;&lt;p class=\\&quot;search-result\\&quot;&gt;&quot;</span> + match_content + <span class=\"string\">&quot;...&lt;/p&gt;&quot;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            str += <span class=\"string\">&quot;&lt;/li&gt;&quot;</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        str += <span class=\"string\">&quot;&lt;/ul&gt;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (str.<span class=\"title function_\">indexOf</span>(<span class=\"string\">&#x27;&lt;li&gt;&#x27;</span>) === -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> $resultContent.<span class=\"property\">innerHTML</span> =  <span class=\"string\">&quot;&lt;ul&gt;&lt;span class=&#x27;local-search-empty&#x27;&gt;没有找到内容，请尝试更换检索词。&lt;span&gt;&lt;/ul&gt;&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $resultContent.<span class=\"property\">innerHTML</span> =  str;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"css\"><a href=\"#css\" class=\"headerlink\" title=\"css\"></a>css</h5><p>&#x2F;hexo&#x2F;themes&#x2F;spfk&#x2F;source&#x2F;css&#x2F;search.css</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.search-popup</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: none;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: <span class=\"number\">#32503d</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">80%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">left</span>: <span class=\"built_in\">calc</span>(<span class=\"number\">50%</span> - <span class=\"number\">350px</span>);</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: fixed;</span><br><span class=\"line\">  <span class=\"attribute\">top</span>: <span class=\"number\">10%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">700px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">z-index</span>: <span class=\"number\">1500</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.search-popup</span> <span class=\"selector-class\">.search-header</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: <span class=\"number\">#eee</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border-top-left-radius</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border-top-right-radius</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.search-popup</span> <span class=\"selector-tag\">input</span><span class=\"selector-class\">.search-input</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: transparent;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">outline</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.search-popup</span> <span class=\"selector-tag\">ul</span><span class=\"selector-class\">.search-result-list</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> <span class=\"number\">5px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-tag\">ul</span><span class=\"selector-class\">.search-result-list</span> <span class=\"selector-tag\">li</span><span class=\"selector-pseudo\">::marker</span> &#123;</span><br><span class=\"line\"> <span class=\"attribute\">content</span>: <span class=\"string\">&#x27;😩&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.search-popup</span> <span class=\"selector-tag\">p</span><span class=\"selector-class\">.search-result</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border-bottom</span>: <span class=\"number\">2px</span> dashed <span class=\"number\">#7de485d4</span>;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">5px</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">line-height</span>: <span class=\"number\">21px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.search-popup</span> <span class=\"selector-tag\">a</span><span class=\"selector-class\">.search-result-title</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-weight</span>: bold;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.search-popup</span> <span class=\"selector-class\">.search-keyword</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border-bottom</span>: <span class=\"number\">1px</span> dashed <span class=\"number\">#ff2a2a</span>;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: <span class=\"number\">#ff2a2a</span>;</span><br><span class=\"line\">  <span class=\"attribute\">font-weight</span>: bold;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.search-popup</span> <span class=\"selector-id\">#local-search-result</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"built_in\">calc</span>(<span class=\"number\">100%</span> - <span class=\"number\">55px</span>);</span><br><span class=\"line\">  <span class=\"attribute\">overflow</span>: auto;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">5px</span> <span class=\"number\">25px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.search-popup</span> <span class=\"selector-id\">#no-result</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: <span class=\"number\">#ccc</span>;</span><br><span class=\"line\">  <span class=\"attribute\">margin</span>: auto;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"live2d\"><a href=\"#live2d\" class=\"headerlink\" title=\"live2d\"></a>live2d</h2><h3 id=\"helper\"><a href=\"#helper\" class=\"headerlink\" title=\"helper\"></a>helper</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save hexo-helper-live2d</span><br></pre></td></tr></table></figure>\n\n\n\n<p>_config.yml</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">live2d:</span><br><span class=\"line\">enable: true</span><br><span class=\"line\">scriptFrom: local</span><br><span class=\"line\">model: </span><br><span class=\"line\">  use: live2d-widget-model-hibiki #模型选择</span><br><span class=\"line\">display: </span><br><span class=\"line\">  position: right  #模型位置</span><br><span class=\"line\">  width: 150       #模型宽度</span><br><span class=\"line\">  height: 300      #模型高度</span><br><span class=\"line\">mobile: </span><br><span class=\"line\">  show: false      #是否在手机端显示</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"js-推荐\"><a href=\"#js-推荐\" class=\"headerlink\" title=\"js  推荐\"></a>js  推荐</h3><p>放在合适位置 footer.ejs  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script src=&quot;https://eqcn.ajz.miesnfu.com/wp-content/plugins/wp-3d-pony/live2dw/lib/L2Dwidget.min.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">    L2Dwidget.init(&#123;</span><br><span class=\"line\">        &quot;model&quot;: &#123;</span><br><span class=\"line\">　　　　　　　//jsonpath控制显示那个小萝莉模型</span><br><span class=\"line\">            jsonPath: &quot;https://unpkg.com/live2d-widget-model-haruto@1.0.5/assets/haruto.model.json&quot;,</span><br><span class=\"line\">            &quot;scale&quot;: 1</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &quot;display&quot;: &#123;</span><br><span class=\"line\">            &quot;position&quot;: &quot;right&quot;, //看板娘的表现位置</span><br><span class=\"line\">            &quot;width&quot;: 150,  //小萝莉的宽度</span><br><span class=\"line\">            &quot;height&quot;: 300, //小萝莉的高度</span><br><span class=\"line\">            &quot;hOffset&quot;: 0,</span><br><span class=\"line\">            &quot;vOffset&quot;: -20</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &quot;mobile&quot;: &#123;</span><br><span class=\"line\">            &quot;show&quot;: true,</span><br><span class=\"line\">            &quot;scale&quot;: 0.5</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &quot;react&quot;: &#123;</span><br><span class=\"line\">            &quot;opacityDefault&quot;: 0.7,</span><br><span class=\"line\">            &quot;opacityOnHover&quot;: 0.2</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"本地搜索\"><a href=\"#本地搜索\" class=\"headerlink\" title=\"本地搜索\"></a>本地搜索</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save hexo-generator-search</span><br></pre></td></tr></table></figure>","more":"<h3 id=\"hexo\"><a href=\"#hexo\" class=\"headerlink\" title=\"hexo\"></a>hexo</h3><p>_config.yml</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">search:</span><br><span class=\"line\">  path: search.json</span><br><span class=\"line\">  field: all</span><br><span class=\"line\">  content: true</span><br><span class=\"line\">  limit: 1000</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"主题spfk\"><a href=\"#主题spfk\" class=\"headerlink\" title=\"主题spfk\"></a>主题spfk</h3><h4 id=\"config-yml\"><a href=\"#config-yml\" class=\"headerlink\" title=\"_config.yml\"></a>_config.yml</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">search_box: true</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"左侧left-col-ejs\"><a href=\"#左侧left-col-ejs\" class=\"headerlink\" title=\"左侧left-col.ejs\"></a>左侧left-col.ejs</h4><p>&#x2F;hexo&#x2F;themes&#x2F;spfk&#x2F;layout&#x2F;_partial&#x2F;left-col.ejs</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id=&quot;id_search&quot;   onclick = &quot;document.getElementById(&#x27;local_search&#x27;).style.display=&#x27;block&#x27;&quot;&gt;</span><br><span class=\"line\"> &lt;span class=&quot;search-icon&quot;&gt;</span><br><span class=\"line\">\t&lt;i class=&quot;fa fa-search&quot;&gt; &lt;/i&gt;</span><br><span class=\"line\">   &lt;/span&gt; 搜索</span><br><span class=\"line\">&lt;/div&gt;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"弹出层layout-ejs\"><a href=\"#弹出层layout-ejs\" class=\"headerlink\" title=\"弹出层layout.ejs\"></a>弹出层layout.ejs</h4><p>&#x2F;hexo&#x2F;themes&#x2F;spfk&#x2F;layout&#x2F;layout.ejs</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id=&quot;local_search&quot; class=&quot;search-popup&quot; &gt;</span><br><span class=\"line\">  &lt;div class=&quot;search-header&quot;&gt;</span><br><span class=\"line\">\t    &lt;i class=&quot;fa fa-search&quot;&gt; &lt;/i&gt; &lt;input id=&quot;local-search-input&quot; class=&quot;search-input&quot; placeholder=&quot;搜索...&quot; spellcheck=&quot;false&quot; type=&quot;search&quot;/&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">  &lt;div id=&quot;local-search-result&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"触发搜索-after-footer-ejs\"><a href=\"#触发搜索-after-footer-ejs\" class=\"headerlink\" title=\"触发搜索 after-footer.ejs\"></a>触发搜索 after-footer.ejs</h4><p>&#x2F;hexo&#x2F;themes&#x2F;spfk&#x2F;layout&#x2F;_partial&#x2F;after-footer.ejs</p>\n<h5 id=\"引入search-js\"><a href=\"#引入search-js\" class=\"headerlink\" title=\"引入search.js\"></a>引入search.js</h5><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;%- <span class=\"title function_\">js</span>(<span class=\"string\">&#x27;js/jquery-1.9.1.min&#x27;</span>) %&gt;</span><br><span class=\"line\">&lt;%- <span class=\"title function_\">js</span>(<span class=\"string\">&#x27;js/search&#x27;</span>) %&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;% <span class=\"keyword\">if</span> (theme.<span class=\"property\">search_box</span>) &#123; %&gt;</span><br><span class=\"line\">   <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span><span class=\"language-javascript\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">\t<span class=\"keyword\">var</span> inputArea       = <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&quot;#local-search-input&quot;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">\tinputArea.<span class=\"property\">onclick</span>   = <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123; <span class=\"title function_\">getSearchFile</span>(); <span class=\"variable language_\">this</span>.<span class=\"property\">onclick</span> = <span class=\"literal\">null</span> &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">\tinputArea.<span class=\"property\">onkeydown</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123; <span class=\"keyword\">if</span>(event.<span class=\"property\">keyCode</span> == <span class=\"number\">13</span>) <span class=\"keyword\">return</span> <span class=\"literal\">false</span> &#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">\t<span class=\"keyword\">var</span> getSearchFile = <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">\t      <span class=\"title function_\">searchFunc</span>(<span class=\"string\">&quot;&lt;%= config.root %&gt;&quot;</span> + <span class=\"string\">&quot;search.json&quot;</span>, <span class=\"string\">&#x27;local-search-input&#x27;</span>, <span class=\"string\">&#x27;local-search-result&#x27;</span>);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">\t&#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">          $(<span class=\"variable language_\">document</span>).<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;click&#x27;</span>, <span class=\"keyword\">function</span>(<span class=\"params\">e</span>) &#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">\t\t   <span class=\"keyword\">var</span> si= $(e.<span class=\"property\">target</span>).<span class=\"title function_\">closest</span>(<span class=\"string\">&#x27;#id_search&#x27;</span>).<span class=\"property\">length</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">           <span class=\"keyword\">var</span> d= $(e.<span class=\"property\">target</span>).<span class=\"title function_\">closest</span>(<span class=\"string\">&#x27;#local_search&#x27;</span>).<span class=\"property\">length</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">             <span class=\"keyword\">if</span>(si==<span class=\"number\">1</span>)&#123; </span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">\t\t\t<span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">style</span>.<span class=\"property\">overflow</span>=<span class=\"string\">&#x27;hidden&#x27;</span>;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">\t\t&#125;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">             <span class=\"keyword\">if</span>( si==<span class=\"number\">0</span> &amp;&amp; d==<span class=\"number\">0</span>)&#123;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">              <span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"property\">style</span>.<span class=\"property\">overflow</span>=<span class=\"string\">&#x27;&#x27;</span></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">               $(<span class=\"string\">&#x27;#local_search&#x27;</span>).<span class=\"title function_\">hide</span>();</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">              &#125;    </span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">       &#125;);</span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\"></span></span></span><br><span class=\"line\"><span class=\"language-javascript\"><span class=\"language-xml\">  </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"search-js\"><a href=\"#search-js\" class=\"headerlink\" title=\"search.js\"></a>search.js</h5><p>&#x2F;hexo&#x2F;themes&#x2F;spfk&#x2F;source&#x2F;js&#x2F;search.js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> searchFunc = <span class=\"keyword\">function</span> (<span class=\"params\">path, search_id, content_id</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 0x00. environment initialization</span></span><br><span class=\"line\">  <span class=\"string\">&#x27;use strict&#x27;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> $input = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(search_id);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> $resultContent = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(content_id);</span><br><span class=\"line\">  $resultContent.<span class=\"property\">innerHTML</span> = <span class=\"string\">&quot;&lt;ul&gt;&lt;span class=&#x27;local-search-empty&#x27;&gt;首次搜索，正在载入索引文件，请稍后……&lt;span&gt;&lt;/ul&gt;&quot;</span>;</span><br><span class=\"line\">  $.<span class=\"title function_\">ajax</span>(&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 0x01. load xml file</span></span><br><span class=\"line\">    <span class=\"attr\">url</span>: path,</span><br><span class=\"line\">    <span class=\"attr\">dataType</span>: <span class=\"string\">&quot;json&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">success</span>: <span class=\"keyword\">function</span> (<span class=\"params\">datas</span>) &#123;</span><br><span class=\"line\">      $resultContent.<span class=\"property\">innerHTML</span> = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">      $input.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;input&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 0x03. parse query to keywords list</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> str = <span class=\"string\">&#x27;&lt;ul class=\\&quot;search-result-list\\&quot;&gt;&#x27;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> keywords = <span class=\"variable language_\">this</span>.<span class=\"property\">value</span>.<span class=\"title function_\">trim</span>().<span class=\"title function_\">toLowerCase</span>().<span class=\"title function_\">split</span>(<span class=\"regexp\">/[\\s\\-]+/</span>);</span><br><span class=\"line\">        $resultContent.<span class=\"property\">innerHTML</span> = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">value</span>.<span class=\"title function_\">trim</span>().<span class=\"property\">length</span> &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 0x04. perform local searching</span></span><br><span class=\"line\">        datas.<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> (<span class=\"params\">data</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> isMatch = <span class=\"literal\">true</span>;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> content_index = [];</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (!data.<span class=\"property\">title</span> || data.<span class=\"property\">title</span>.<span class=\"title function_\">trim</span>() === <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">            data.<span class=\"property\">title</span> = <span class=\"string\">&quot;Untitled&quot;</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> orig_data_title = data.<span class=\"property\">title</span>.<span class=\"title function_\">trim</span>();</span><br><span class=\"line\">          <span class=\"keyword\">var</span> data_title = orig_data_title.<span class=\"title function_\">toLowerCase</span>();</span><br><span class=\"line\">             <span class=\"keyword\">if</span> (!data.<span class=\"property\">content</span> || data.<span class=\"property\">content</span>.<span class=\"title function_\">trim</span>() === <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">                         <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(data.<span class=\"property\">content</span>)<span class=\"comment\">//空文章</span></span><br><span class=\"line\">                      data.<span class=\"property\">content</span> = <span class=\"string\">&quot;no content&quot;</span>;</span><br><span class=\"line\">                 &#125;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> orig_data_content = data.<span class=\"property\">content</span>.<span class=\"title function_\">trim</span>().<span class=\"title function_\">replace</span>(<span class=\"regexp\">/&lt;[^&gt;]+&gt;/g</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">          <span class=\"keyword\">var</span> data_content = orig_data_content.<span class=\"title function_\">toLowerCase</span>();</span><br><span class=\"line\">          <span class=\"keyword\">var</span> data_url = data.<span class=\"property\">url</span>;</span><br><span class=\"line\">     </span><br><span class=\"line\">          <span class=\"keyword\">var</span> index_title = -<span class=\"number\">1</span>;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> index_content = -<span class=\"number\">1</span>;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> first_occur = -<span class=\"number\">1</span>;</span><br><span class=\"line\">          <span class=\"comment\">// only match artiles with not empty contents</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> (data_content !== <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\">            keywords.<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> (<span class=\"params\">keyword, i</span>) &#123;</span><br><span class=\"line\">              index_title = data_title.<span class=\"title function_\">indexOf</span>(keyword);</span><br><span class=\"line\">              index_content = data_content.<span class=\"title function_\">indexOf</span>(keyword);</span><br><span class=\"line\"></span><br><span class=\"line\">              <span class=\"keyword\">if</span> (index_title &lt; <span class=\"number\">0</span> &amp;&amp; index_content &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                isMatch = <span class=\"literal\">false</span>;</span><br><span class=\"line\">              &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (index_content &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                  index_content = <span class=\"number\">0</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (i == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                  first_occur = index_content;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">// content_index.push(&#123;index_content:index_content, keyword_len:keyword_len&#125;);</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            isMatch = <span class=\"literal\">false</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"comment\">// 0x05. show search results</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> (isMatch) &#123;</span><br><span class=\"line\">            str += <span class=\"string\">&quot;&lt;li&gt;&lt;a href=&#x27;&quot;</span> + data_url + <span class=\"string\">&quot;&#x27; class=&#x27;search-result-title&#x27; target=&#x27;_blank&#x27;&gt;&quot;</span> + orig_data_title + <span class=\"string\">&quot;&lt;/a&gt;&quot;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> content = orig_data_content;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (first_occur &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">              <span class=\"comment\">// cut out 100 characters</span></span><br><span class=\"line\">              <span class=\"keyword\">var</span> start = first_occur - <span class=\"number\">20</span>;</span><br><span class=\"line\">              <span class=\"keyword\">var</span> end = first_occur + <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">              <span class=\"keyword\">if</span> (start &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                start = <span class=\"number\">0</span>;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">              <span class=\"keyword\">if</span> (start == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                end = <span class=\"number\">100</span>;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">              <span class=\"keyword\">if</span> (end &gt; content.<span class=\"property\">length</span>) &#123;</span><br><span class=\"line\">                end = content.<span class=\"property\">length</span>;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">              <span class=\"keyword\">var</span> match_content = content.<span class=\"title function_\">substr</span>(start, end);</span><br><span class=\"line\"></span><br><span class=\"line\">              <span class=\"comment\">// highlight all keywords</span></span><br><span class=\"line\">              keywords.<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span> (<span class=\"params\">keyword</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> regS = <span class=\"keyword\">new</span> <span class=\"title class_\">RegExp</span>(keyword, <span class=\"string\">&quot;gi&quot;</span>);</span><br><span class=\"line\">                match_content = match_content.<span class=\"title function_\">replace</span>(regS, <span class=\"string\">&quot;&lt;em class=\\&quot;search-keyword\\&quot;&gt;&quot;</span> + keyword + <span class=\"string\">&quot;&lt;/em&gt;&quot;</span>);</span><br><span class=\"line\">              &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">              str += <span class=\"string\">&quot;&lt;p class=\\&quot;search-result\\&quot;&gt;&quot;</span> + match_content + <span class=\"string\">&quot;...&lt;/p&gt;&quot;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            str += <span class=\"string\">&quot;&lt;/li&gt;&quot;</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        str += <span class=\"string\">&quot;&lt;/ul&gt;&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (str.<span class=\"title function_\">indexOf</span>(<span class=\"string\">&#x27;&lt;li&gt;&#x27;</span>) === -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> $resultContent.<span class=\"property\">innerHTML</span> =  <span class=\"string\">&quot;&lt;ul&gt;&lt;span class=&#x27;local-search-empty&#x27;&gt;没有找到内容，请尝试更换检索词。&lt;span&gt;&lt;/ul&gt;&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $resultContent.<span class=\"property\">innerHTML</span> =  str;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"css\"><a href=\"#css\" class=\"headerlink\" title=\"css\"></a>css</h5><p>&#x2F;hexo&#x2F;themes&#x2F;spfk&#x2F;source&#x2F;css&#x2F;search.css</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.search-popup</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: none;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: <span class=\"number\">#32503d</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border-radius</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">80%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">left</span>: <span class=\"built_in\">calc</span>(<span class=\"number\">50%</span> - <span class=\"number\">350px</span>);</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: fixed;</span><br><span class=\"line\">  <span class=\"attribute\">top</span>: <span class=\"number\">10%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">700px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">z-index</span>: <span class=\"number\">1500</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.search-popup</span> <span class=\"selector-class\">.search-header</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: <span class=\"number\">#eee</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border-top-left-radius</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border-top-right-radius</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">5px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.search-popup</span> <span class=\"selector-tag\">input</span><span class=\"selector-class\">.search-input</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: transparent;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">outline</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.search-popup</span> <span class=\"selector-tag\">ul</span><span class=\"selector-class\">.search-result-list</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> <span class=\"number\">5px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-tag\">ul</span><span class=\"selector-class\">.search-result-list</span> <span class=\"selector-tag\">li</span><span class=\"selector-pseudo\">::marker</span> &#123;</span><br><span class=\"line\"> <span class=\"attribute\">content</span>: <span class=\"string\">&#x27;😩&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.search-popup</span> <span class=\"selector-tag\">p</span><span class=\"selector-class\">.search-result</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border-bottom</span>: <span class=\"number\">2px</span> dashed <span class=\"number\">#7de485d4</span>;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">5px</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">line-height</span>: <span class=\"number\">21px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.search-popup</span> <span class=\"selector-tag\">a</span><span class=\"selector-class\">.search-result-title</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-weight</span>: bold;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.search-popup</span> <span class=\"selector-class\">.search-keyword</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">border-bottom</span>: <span class=\"number\">1px</span> dashed <span class=\"number\">#ff2a2a</span>;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: <span class=\"number\">#ff2a2a</span>;</span><br><span class=\"line\">  <span class=\"attribute\">font-weight</span>: bold;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.search-popup</span> <span class=\"selector-id\">#local-search-result</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"built_in\">calc</span>(<span class=\"number\">100%</span> - <span class=\"number\">55px</span>);</span><br><span class=\"line\">  <span class=\"attribute\">overflow</span>: auto;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">5px</span> <span class=\"number\">25px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.search-popup</span> <span class=\"selector-id\">#no-result</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: <span class=\"number\">#ccc</span>;</span><br><span class=\"line\">  <span class=\"attribute\">margin</span>: auto;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"live2d\"><a href=\"#live2d\" class=\"headerlink\" title=\"live2d\"></a>live2d</h2><h3 id=\"helper\"><a href=\"#helper\" class=\"headerlink\" title=\"helper\"></a>helper</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save hexo-helper-live2d</span><br></pre></td></tr></table></figure>\n\n\n\n<p>_config.yml</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">live2d:</span><br><span class=\"line\">enable: true</span><br><span class=\"line\">scriptFrom: local</span><br><span class=\"line\">model: </span><br><span class=\"line\">  use: live2d-widget-model-hibiki #模型选择</span><br><span class=\"line\">display: </span><br><span class=\"line\">  position: right  #模型位置</span><br><span class=\"line\">  width: 150       #模型宽度</span><br><span class=\"line\">  height: 300      #模型高度</span><br><span class=\"line\">mobile: </span><br><span class=\"line\">  show: false      #是否在手机端显示</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"js-推荐\"><a href=\"#js-推荐\" class=\"headerlink\" title=\"js  推荐\"></a>js  推荐</h3><p>放在合适位置 footer.ejs  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script src=&quot;https://eqcn.ajz.miesnfu.com/wp-content/plugins/wp-3d-pony/live2dw/lib/L2Dwidget.min.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">    L2Dwidget.init(&#123;</span><br><span class=\"line\">        &quot;model&quot;: &#123;</span><br><span class=\"line\">　　　　　　　//jsonpath控制显示那个小萝莉模型</span><br><span class=\"line\">            jsonPath: &quot;https://unpkg.com/live2d-widget-model-haruto@1.0.5/assets/haruto.model.json&quot;,</span><br><span class=\"line\">            &quot;scale&quot;: 1</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &quot;display&quot;: &#123;</span><br><span class=\"line\">            &quot;position&quot;: &quot;right&quot;, //看板娘的表现位置</span><br><span class=\"line\">            &quot;width&quot;: 150,  //小萝莉的宽度</span><br><span class=\"line\">            &quot;height&quot;: 300, //小萝莉的高度</span><br><span class=\"line\">            &quot;hOffset&quot;: 0,</span><br><span class=\"line\">            &quot;vOffset&quot;: -20</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &quot;mobile&quot;: &#123;</span><br><span class=\"line\">            &quot;show&quot;: true,</span><br><span class=\"line\">            &quot;scale&quot;: 0.5</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &quot;react&quot;: &#123;</span><br><span class=\"line\">            &quot;opacityDefault&quot;: 0.7,</span><br><span class=\"line\">            &quot;opacityOnHover&quot;: 0.2</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>"},{"title":"搭建hexo","date":"2017-01-12T16:46:10.000Z","_content":"\n\n\n\n\n### 准备工具\n\nnode https://nodejs.org/zh-cn/download/\ngit\nhexo\n\n### node 安装\n\n#### linux\n\n``` bash\n$tar  -zxvf  node.tar.gz\n$cd node\n$./config  --prefix=/opt/node\n$sudo make\n$sudo make install\n```\n添加环境变量\n```bash\n#set nodejs\nexport NODE_HOME=/opt/node\nexport PATH=$NODE_HOME/bin:$PATH\n$node -v #显示版本号\n$sudo node -v #当用root执行，commond not found\n#mousepad  ~/.bashrc\nalias sudo='sudo env PATH=$PATH'\n```\n <!--more--> \n\n#### win10\n\n‪C:/Users/Shea/.npmrc\n\n```\nprefix=K:\\node\\last\\node_global\ncache=K:\\node\\last\\node_cache\nregistry=https://registry.npm.taobao.org/\n```\n\n##### 环境变量\n\n###### 用户变量path\n\nK:\\node\\last\n\nK:\\node\\last\\node_global\n\n###### 系统变量\n\nNODE_PATH=K:\\node\\last\\node_global\\node_modules\n\n#### 检查版本\n\n```powershell\nPS K:\\chengshea.github.io> node -v\nv16.17.0\nPS K:\\chengshea.github.io> npm -v\n8.15.0\n```\n\nError: EPERM: operation not permitted\n> node目录 右键----属性----安全--选择当前用户（编辑）--权限 -- 完全控制\n\n\n\n\nhexo : 无法加载文件 K:\\node\\last\\node_global\\hexo.ps1，因为在此系统上禁止运行脚本\n\n> 设置->隐私和安全性->开发者选项->**PowerShell** 勾选 应用\n\n\n\n### git\n\n\n``` bash\n$cd ~/.ssh #查看没有密钥\n$ ssh-keygen -t rsa -C \"你git的user.email\"\n```\n路径默认 最好输入密码\n最后得到两个文件：id_rsa和id_rsa.pub\n\n``` bash\n$ cat ~/.ssh/id_rsa.pub #复制到github ssh key \n$ssh git@github.com  \n```\n\n### hexo\n在指定目录下执行终端\n```bash\n$sudo npm install hexo-cli -g #安装在当前目录\n#忽略warn\n$sudo npm install hexo --save\n$hexo -v\n```\n给予文件夹权限\n初始化 ，安装组件\n```\n$hexo init\n$npm install\n```\n### 部署\n本地部署\n```\n$hexo g  #generate 简写\n$hexo s #server  默认端口4000\n```\npush \n\n```\n$hexo d #deploy\n```\n\n\n\n### themes\n\n部分主题是18,19年,node版本太高,**版本不一致**\n\n会导致hexo server 正常,但hexo generate 生成的public目录文件**全为为0kb**\n\n版本降级,或升级到一定版本,如\n\n```json\n{\n  \"name\": \"hexo-site\",\n  \"version\": \"0.0.0\",\n  \"private\": true,\n  \"scripts\": {\n    \"build\": \"hexo generate\",\n    \"clean\": \"hexo clean\",\n    \"deploy\": \"hexo deploy\",\n    \"server\": \"hexo server\"\n  },\n  \"hexo\": {\n    \"version\": \"6.2.0\"\n  },\n  \"dependencies\": {\n    \"hexo\": \"^6.2.0\",\n    \"hexo-deployer-git\": \"^3.0.0\",\n    \"hexo-generator-archive\": \"^1.0.0\",\n    \"hexo-generator-baidu-sitemap\": \"^0.1.9\",\n    \"hexo-generator-category\": \"^1.0.0\",\n    \"hexo-generator-index\": \"^2.0.0\",\n    \"hexo-generator-search\": \"^2.4.3\",\n    \"hexo-generator-tag\": \"^1.0.0\",\n    \"hexo-renderer-ejs\": \"^1.0.0\",\n    \"hexo-renderer-marked\": \"^5.0.0\",\n    \"hexo-renderer-stylus\": \"^2.1.0\",\n    \"hexo-server\": \"^3.0.0\",\n    \"highlight.js\": \"^11.6.0\"\n  }\n}\n```\n\n\n\n会导致 跳转链接变成下载文件\n\n```\n#添加\nsed -i \"/^permalink/s/$/\\//\"  `grep 'permalink:'  -rl --include=\\*.md  ./source/_posts/`\n#删除\nsed -n \"/^permalink/s/\\/$//\"p  `grep 'permalink:'  -rl --include=\\*.md  ./source/_posts/`\n```\n\n> permalink: xx/xxx/xxx/\n\n等一系列问题,**注意版本**\n\n\n\nnode版本问题https://nodejs.org/zh-cn/download/releases/\n\nhttps://www.npmjs.com/package/hexo-cli\n\n```\nnpm ls --depth 0\n\nhexo g --debug\n```\n","source":"_posts/lang/node/hexo/搭建hexo.md","raw":"---\ntitle: 搭建hexo\ndate: 2017-01-13 00:46:10\ntags: \n - hexo\ncategories: \n  - npm\n  - hexo\n---\n\n\n\n\n\n### 准备工具\n\nnode https://nodejs.org/zh-cn/download/\ngit\nhexo\n\n### node 安装\n\n#### linux\n\n``` bash\n$tar  -zxvf  node.tar.gz\n$cd node\n$./config  --prefix=/opt/node\n$sudo make\n$sudo make install\n```\n添加环境变量\n```bash\n#set nodejs\nexport NODE_HOME=/opt/node\nexport PATH=$NODE_HOME/bin:$PATH\n$node -v #显示版本号\n$sudo node -v #当用root执行，commond not found\n#mousepad  ~/.bashrc\nalias sudo='sudo env PATH=$PATH'\n```\n <!--more--> \n\n#### win10\n\n‪C:/Users/Shea/.npmrc\n\n```\nprefix=K:\\node\\last\\node_global\ncache=K:\\node\\last\\node_cache\nregistry=https://registry.npm.taobao.org/\n```\n\n##### 环境变量\n\n###### 用户变量path\n\nK:\\node\\last\n\nK:\\node\\last\\node_global\n\n###### 系统变量\n\nNODE_PATH=K:\\node\\last\\node_global\\node_modules\n\n#### 检查版本\n\n```powershell\nPS K:\\chengshea.github.io> node -v\nv16.17.0\nPS K:\\chengshea.github.io> npm -v\n8.15.0\n```\n\nError: EPERM: operation not permitted\n> node目录 右键----属性----安全--选择当前用户（编辑）--权限 -- 完全控制\n\n\n\n\nhexo : 无法加载文件 K:\\node\\last\\node_global\\hexo.ps1，因为在此系统上禁止运行脚本\n\n> 设置->隐私和安全性->开发者选项->**PowerShell** 勾选 应用\n\n\n\n### git\n\n\n``` bash\n$cd ~/.ssh #查看没有密钥\n$ ssh-keygen -t rsa -C \"你git的user.email\"\n```\n路径默认 最好输入密码\n最后得到两个文件：id_rsa和id_rsa.pub\n\n``` bash\n$ cat ~/.ssh/id_rsa.pub #复制到github ssh key \n$ssh git@github.com  \n```\n\n### hexo\n在指定目录下执行终端\n```bash\n$sudo npm install hexo-cli -g #安装在当前目录\n#忽略warn\n$sudo npm install hexo --save\n$hexo -v\n```\n给予文件夹权限\n初始化 ，安装组件\n```\n$hexo init\n$npm install\n```\n### 部署\n本地部署\n```\n$hexo g  #generate 简写\n$hexo s #server  默认端口4000\n```\npush \n\n```\n$hexo d #deploy\n```\n\n\n\n### themes\n\n部分主题是18,19年,node版本太高,**版本不一致**\n\n会导致hexo server 正常,但hexo generate 生成的public目录文件**全为为0kb**\n\n版本降级,或升级到一定版本,如\n\n```json\n{\n  \"name\": \"hexo-site\",\n  \"version\": \"0.0.0\",\n  \"private\": true,\n  \"scripts\": {\n    \"build\": \"hexo generate\",\n    \"clean\": \"hexo clean\",\n    \"deploy\": \"hexo deploy\",\n    \"server\": \"hexo server\"\n  },\n  \"hexo\": {\n    \"version\": \"6.2.0\"\n  },\n  \"dependencies\": {\n    \"hexo\": \"^6.2.0\",\n    \"hexo-deployer-git\": \"^3.0.0\",\n    \"hexo-generator-archive\": \"^1.0.0\",\n    \"hexo-generator-baidu-sitemap\": \"^0.1.9\",\n    \"hexo-generator-category\": \"^1.0.0\",\n    \"hexo-generator-index\": \"^2.0.0\",\n    \"hexo-generator-search\": \"^2.4.3\",\n    \"hexo-generator-tag\": \"^1.0.0\",\n    \"hexo-renderer-ejs\": \"^1.0.0\",\n    \"hexo-renderer-marked\": \"^5.0.0\",\n    \"hexo-renderer-stylus\": \"^2.1.0\",\n    \"hexo-server\": \"^3.0.0\",\n    \"highlight.js\": \"^11.6.0\"\n  }\n}\n```\n\n\n\n会导致 跳转链接变成下载文件\n\n```\n#添加\nsed -i \"/^permalink/s/$/\\//\"  `grep 'permalink:'  -rl --include=\\*.md  ./source/_posts/`\n#删除\nsed -n \"/^permalink/s/\\/$//\"p  `grep 'permalink:'  -rl --include=\\*.md  ./source/_posts/`\n```\n\n> permalink: xx/xxx/xxx/\n\n等一系列问题,**注意版本**\n\n\n\nnode版本问题https://nodejs.org/zh-cn/download/releases/\n\nhttps://www.npmjs.com/package/hexo-cli\n\n```\nnpm ls --depth 0\n\nhexo g --debug\n```\n","slug":"lang/node/hexo/搭建hexo","published":1,"updated":"2022-08-29T13:41:52.593Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtu10048gwi5ahgk0j0l","content":"<h3 id=\"准备工具\"><a href=\"#准备工具\" class=\"headerlink\" title=\"准备工具\"></a>准备工具</h3><p>node <a href=\"https://nodejs.org/zh-cn/download/\">https://nodejs.org/zh-cn/download/</a><br>git<br>hexo</p>\n<h3 id=\"node-安装\"><a href=\"#node-安装\" class=\"headerlink\" title=\"node 安装\"></a>node 安装</h3><h4 id=\"linux\"><a href=\"#linux\" class=\"headerlink\" title=\"linux\"></a>linux</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$tar</span>  -zxvf  node.tar.gz</span><br><span class=\"line\"><span class=\"variable\">$cd</span> node</span><br><span class=\"line\">$./config  --prefix=/opt/node</span><br><span class=\"line\"><span class=\"variable\">$sudo</span> make</span><br><span class=\"line\"><span class=\"variable\">$sudo</span> make install</span><br></pre></td></tr></table></figure>\n<p>添加环境变量</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#set nodejs</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> NODE_HOME=/opt/node</span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"variable\">$NODE_HOME</span>/bin:<span class=\"variable\">$PATH</span></span><br><span class=\"line\"><span class=\"variable\">$node</span> -v <span class=\"comment\">#显示版本号</span></span><br><span class=\"line\"><span class=\"variable\">$sudo</span> node -v <span class=\"comment\">#当用root执行，commond not found</span></span><br><span class=\"line\"><span class=\"comment\">#mousepad  ~/.bashrc</span></span><br><span class=\"line\"><span class=\"built_in\">alias</span> sudo=<span class=\"string\">&#x27;sudo env PATH=$PATH&#x27;</span></span><br></pre></td></tr></table></figure>\n <span id=\"more\"></span> \n\n<h4 id=\"win10\"><a href=\"#win10\" class=\"headerlink\" title=\"win10\"></a>win10</h4><p>‪C:&#x2F;Users&#x2F;Shea&#x2F;.npmrc</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">prefix=K:\\node\\last\\node_global</span><br><span class=\"line\">cache=K:\\node\\last\\node_cache</span><br><span class=\"line\">registry=https://registry.npm.taobao.org/</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"环境变量\"><a href=\"#环境变量\" class=\"headerlink\" title=\"环境变量\"></a>环境变量</h5><h6 id=\"用户变量path\"><a href=\"#用户变量path\" class=\"headerlink\" title=\"用户变量path\"></a>用户变量path</h6><p>K:\\node\\last</p>\n<p>K:\\node\\last\\node_global</p>\n<h6 id=\"系统变量\"><a href=\"#系统变量\" class=\"headerlink\" title=\"系统变量\"></a>系统变量</h6><p>NODE_PATH&#x3D;K:\\node\\last\\node_global\\node_modules</p>\n<h4 id=\"检查版本\"><a href=\"#检查版本\" class=\"headerlink\" title=\"检查版本\"></a>检查版本</h4><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">PS</span> K:\\chengshea.github.io&gt; node <span class=\"literal\">-v</span></span><br><span class=\"line\">v16.<span class=\"number\">17.0</span></span><br><span class=\"line\"><span class=\"built_in\">PS</span> K:\\chengshea.github.io&gt; npm <span class=\"literal\">-v</span></span><br><span class=\"line\"><span class=\"number\">8.15</span>.<span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n\n<p>Error: EPERM: operation not permitted</p>\n<blockquote>\n<p>node目录 右键—-属性—-安全–选择当前用户（编辑）–权限 – 完全控制</p>\n</blockquote>\n<p>hexo : 无法加载文件 K:\\node\\last\\node_global\\hexo.ps1，因为在此系统上禁止运行脚本</p>\n<blockquote>\n<p>设置-&gt;隐私和安全性-&gt;开发者选项-&gt;<strong>PowerShell</strong> 勾选 应用</p>\n</blockquote>\n<h3 id=\"git\"><a href=\"#git\" class=\"headerlink\" title=\"git\"></a>git</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$cd</span> ~/.ssh <span class=\"comment\">#查看没有密钥</span></span><br><span class=\"line\">$ ssh-keygen -t rsa -C <span class=\"string\">&quot;你git的user.email&quot;</span></span><br></pre></td></tr></table></figure>\n<p>路径默认 最好输入密码<br>最后得到两个文件：id_rsa和id_rsa.pub</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cat</span> ~/.ssh/id_rsa.pub <span class=\"comment\">#复制到github ssh key </span></span><br><span class=\"line\"><span class=\"variable\">$ssh</span> git@github.com  </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"hexo\"><a href=\"#hexo\" class=\"headerlink\" title=\"hexo\"></a>hexo</h3><p>在指定目录下执行终端</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$sudo</span> npm install hexo-cli -g <span class=\"comment\">#安装在当前目录</span></span><br><span class=\"line\"><span class=\"comment\">#忽略warn</span></span><br><span class=\"line\"><span class=\"variable\">$sudo</span> npm install hexo --save</span><br><span class=\"line\"><span class=\"variable\">$hexo</span> -v</span><br></pre></td></tr></table></figure>\n<p>给予文件夹权限<br>初始化 ，安装组件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$hexo init</span><br><span class=\"line\">$npm install</span><br></pre></td></tr></table></figure>\n<h3 id=\"部署\"><a href=\"#部署\" class=\"headerlink\" title=\"部署\"></a>部署</h3><p>本地部署</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$hexo g  #generate 简写</span><br><span class=\"line\">$hexo s #server  默认端口4000</span><br></pre></td></tr></table></figure>\n<p>push </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$hexo d #deploy</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"themes\"><a href=\"#themes\" class=\"headerlink\" title=\"themes\"></a>themes</h3><p>部分主题是18,19年,node版本太高,<strong>版本不一致</strong></p>\n<p>会导致hexo server 正常,但hexo generate 生成的public目录文件<strong>全为为0kb</strong></p>\n<p>版本降级,或升级到一定版本,如</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;hexo-site&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;version&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;0.0.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;private&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;scripts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;build&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;hexo generate&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;clean&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;hexo clean&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;deploy&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;hexo deploy&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;server&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;hexo server&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;hexo&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;version&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;6.2.0&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;dependencies&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^6.2.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo-deployer-git&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^3.0.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo-generator-archive&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^1.0.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo-generator-baidu-sitemap&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^0.1.9&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo-generator-category&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^1.0.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo-generator-index&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^2.0.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo-generator-search&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^2.4.3&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo-generator-tag&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^1.0.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo-renderer-ejs&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^1.0.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo-renderer-marked&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^5.0.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo-renderer-stylus&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^2.1.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo-server&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^3.0.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;highlight.js&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^11.6.0&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>会导致 跳转链接变成下载文件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#添加</span><br><span class=\"line\">sed -i &quot;/^permalink/s/$/\\//&quot;  `grep &#x27;permalink:&#x27;  -rl --include=\\*.md  ./source/_posts/`</span><br><span class=\"line\">#删除</span><br><span class=\"line\">sed -n &quot;/^permalink/s/\\/$//&quot;p  `grep &#x27;permalink:&#x27;  -rl --include=\\*.md  ./source/_posts/`</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>permalink: xx&#x2F;xxx&#x2F;xxx&#x2F;</p>\n</blockquote>\n<p>等一系列问题,<strong>注意版本</strong></p>\n<p>node版本问题<a href=\"https://nodejs.org/zh-cn/download/releases/\">https://nodejs.org/zh-cn/download/releases/</a></p>\n<p><a href=\"https://www.npmjs.com/package/hexo-cli\">https://www.npmjs.com/package/hexo-cli</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm ls --depth 0</span><br><span class=\"line\"></span><br><span class=\"line\">hexo g --debug</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<h3 id=\"准备工具\"><a href=\"#准备工具\" class=\"headerlink\" title=\"准备工具\"></a>准备工具</h3><p>node <a href=\"https://nodejs.org/zh-cn/download/\">https://nodejs.org/zh-cn/download/</a><br>git<br>hexo</p>\n<h3 id=\"node-安装\"><a href=\"#node-安装\" class=\"headerlink\" title=\"node 安装\"></a>node 安装</h3><h4 id=\"linux\"><a href=\"#linux\" class=\"headerlink\" title=\"linux\"></a>linux</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$tar</span>  -zxvf  node.tar.gz</span><br><span class=\"line\"><span class=\"variable\">$cd</span> node</span><br><span class=\"line\">$./config  --prefix=/opt/node</span><br><span class=\"line\"><span class=\"variable\">$sudo</span> make</span><br><span class=\"line\"><span class=\"variable\">$sudo</span> make install</span><br></pre></td></tr></table></figure>\n<p>添加环境变量</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#set nodejs</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> NODE_HOME=/opt/node</span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"variable\">$NODE_HOME</span>/bin:<span class=\"variable\">$PATH</span></span><br><span class=\"line\"><span class=\"variable\">$node</span> -v <span class=\"comment\">#显示版本号</span></span><br><span class=\"line\"><span class=\"variable\">$sudo</span> node -v <span class=\"comment\">#当用root执行，commond not found</span></span><br><span class=\"line\"><span class=\"comment\">#mousepad  ~/.bashrc</span></span><br><span class=\"line\"><span class=\"built_in\">alias</span> sudo=<span class=\"string\">&#x27;sudo env PATH=$PATH&#x27;</span></span><br></pre></td></tr></table></figure>","more":"<h4 id=\"win10\"><a href=\"#win10\" class=\"headerlink\" title=\"win10\"></a>win10</h4><p>‪C:&#x2F;Users&#x2F;Shea&#x2F;.npmrc</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">prefix=K:\\node\\last\\node_global</span><br><span class=\"line\">cache=K:\\node\\last\\node_cache</span><br><span class=\"line\">registry=https://registry.npm.taobao.org/</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"环境变量\"><a href=\"#环境变量\" class=\"headerlink\" title=\"环境变量\"></a>环境变量</h5><h6 id=\"用户变量path\"><a href=\"#用户变量path\" class=\"headerlink\" title=\"用户变量path\"></a>用户变量path</h6><p>K:\\node\\last</p>\n<p>K:\\node\\last\\node_global</p>\n<h6 id=\"系统变量\"><a href=\"#系统变量\" class=\"headerlink\" title=\"系统变量\"></a>系统变量</h6><p>NODE_PATH&#x3D;K:\\node\\last\\node_global\\node_modules</p>\n<h4 id=\"检查版本\"><a href=\"#检查版本\" class=\"headerlink\" title=\"检查版本\"></a>检查版本</h4><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">PS</span> K:\\chengshea.github.io&gt; node <span class=\"literal\">-v</span></span><br><span class=\"line\">v16.<span class=\"number\">17.0</span></span><br><span class=\"line\"><span class=\"built_in\">PS</span> K:\\chengshea.github.io&gt; npm <span class=\"literal\">-v</span></span><br><span class=\"line\"><span class=\"number\">8.15</span>.<span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n\n<p>Error: EPERM: operation not permitted</p>\n<blockquote>\n<p>node目录 右键—-属性—-安全–选择当前用户（编辑）–权限 – 完全控制</p>\n</blockquote>\n<p>hexo : 无法加载文件 K:\\node\\last\\node_global\\hexo.ps1，因为在此系统上禁止运行脚本</p>\n<blockquote>\n<p>设置-&gt;隐私和安全性-&gt;开发者选项-&gt;<strong>PowerShell</strong> 勾选 应用</p>\n</blockquote>\n<h3 id=\"git\"><a href=\"#git\" class=\"headerlink\" title=\"git\"></a>git</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$cd</span> ~/.ssh <span class=\"comment\">#查看没有密钥</span></span><br><span class=\"line\">$ ssh-keygen -t rsa -C <span class=\"string\">&quot;你git的user.email&quot;</span></span><br></pre></td></tr></table></figure>\n<p>路径默认 最好输入密码<br>最后得到两个文件：id_rsa和id_rsa.pub</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cat</span> ~/.ssh/id_rsa.pub <span class=\"comment\">#复制到github ssh key </span></span><br><span class=\"line\"><span class=\"variable\">$ssh</span> git@github.com  </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"hexo\"><a href=\"#hexo\" class=\"headerlink\" title=\"hexo\"></a>hexo</h3><p>在指定目录下执行终端</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$sudo</span> npm install hexo-cli -g <span class=\"comment\">#安装在当前目录</span></span><br><span class=\"line\"><span class=\"comment\">#忽略warn</span></span><br><span class=\"line\"><span class=\"variable\">$sudo</span> npm install hexo --save</span><br><span class=\"line\"><span class=\"variable\">$hexo</span> -v</span><br></pre></td></tr></table></figure>\n<p>给予文件夹权限<br>初始化 ，安装组件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$hexo init</span><br><span class=\"line\">$npm install</span><br></pre></td></tr></table></figure>\n<h3 id=\"部署\"><a href=\"#部署\" class=\"headerlink\" title=\"部署\"></a>部署</h3><p>本地部署</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$hexo g  #generate 简写</span><br><span class=\"line\">$hexo s #server  默认端口4000</span><br></pre></td></tr></table></figure>\n<p>push </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$hexo d #deploy</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"themes\"><a href=\"#themes\" class=\"headerlink\" title=\"themes\"></a>themes</h3><p>部分主题是18,19年,node版本太高,<strong>版本不一致</strong></p>\n<p>会导致hexo server 正常,但hexo generate 生成的public目录文件<strong>全为为0kb</strong></p>\n<p>版本降级,或升级到一定版本,如</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;hexo-site&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;version&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;0.0.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;private&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;scripts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;build&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;hexo generate&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;clean&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;hexo clean&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;deploy&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;hexo deploy&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;server&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;hexo server&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;hexo&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;version&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;6.2.0&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;dependencies&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^6.2.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo-deployer-git&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^3.0.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo-generator-archive&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^1.0.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo-generator-baidu-sitemap&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^0.1.9&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo-generator-category&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^1.0.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo-generator-index&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^2.0.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo-generator-search&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^2.4.3&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo-generator-tag&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^1.0.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo-renderer-ejs&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^1.0.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo-renderer-marked&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^5.0.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo-renderer-stylus&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^2.1.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hexo-server&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^3.0.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;highlight.js&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^11.6.0&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>会导致 跳转链接变成下载文件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#添加</span><br><span class=\"line\">sed -i &quot;/^permalink/s/$/\\//&quot;  `grep &#x27;permalink:&#x27;  -rl --include=\\*.md  ./source/_posts/`</span><br><span class=\"line\">#删除</span><br><span class=\"line\">sed -n &quot;/^permalink/s/\\/$//&quot;p  `grep &#x27;permalink:&#x27;  -rl --include=\\*.md  ./source/_posts/`</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>permalink: xx&#x2F;xxx&#x2F;xxx&#x2F;</p>\n</blockquote>\n<p>等一系列问题,<strong>注意版本</strong></p>\n<p>node版本问题<a href=\"https://nodejs.org/zh-cn/download/releases/\">https://nodejs.org/zh-cn/download/releases/</a></p>\n<p><a href=\"https://www.npmjs.com/package/hexo-cli\">https://www.npmjs.com/package/hexo-cli</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm ls --depth 0</span><br><span class=\"line\"></span><br><span class=\"line\">hexo g --debug</span><br></pre></td></tr></table></figure>"},{"title":"评论","date":"2017-11-14T11:36:33.000Z","_content":"\n### 由来\n\n[gitment](https://github.com/imsun/gitment)使用 **github issue** 保存评论\n\n### 准备\n\n右键新标签页打开 https://github.com/settings/applications/new\n\n创建\n![app-id](http://ojtd6k176.bkt.clouddn.com/github-new-app.png)\n\n获取 id secret\n![参数](http://ojtd6k176.bkt.clouddn.com/github-app-id.png)\n\n### hexo Theme\n\n根据 *个人主题* 添加\n\n#### 样式\n\nsource/css/gitment.css\n\n- css [详情右键新标签页](https://github.com/chengshea/record/blob/master/issue/gitment.css)\n\nsource/js/gitment.js\n\n- js [详情右键新标签页](https://github.com/chengshea/record/blob/master/issue/gitment.js)\n\n#### 布局调用\n <!--more--> \n调用认证\n/layout/_partial/comments/gitment.ejs\n\n```\n<div id=\"gitment\"></div>\n<!-- 主页不要加载gitment -->\n<%if (!index){ %>\n<script>\nvar gitment = new Gitment({\nowner: 'chengshea',\nrepo: 'chengshea.github.io',\noauth: {\nclient_id: '3478952f5e3ade06xxxxx',\nclient_secret: '3ca8b3ada58c7993cbb385839f83ba8xxxxxx',\n },\n})\ngitment.render('gitment')\n</script>\n<% } %>\n```\n\n\n\n添加评论\n/layout/_partial/article.ejs\n\n```\n<% if (!index && post.comments){ %>\n    <%  if (theme.gitment.on) { %>\n        <%- partial('comments/gitment') %>\n    <% } else if (theme.disqus.on) { %>\n        <%- partial('comments/disqus', {\n            shortname: theme.disqus.shortname\n          }) %>\n    <% } else if (config.disqus_shortname) { %>\n        <%- partial('comments/disqus', {\n            shortname: config.disqus_shortname\n          }) %>\n    <% } %>\n<% } %>\n```\n\n\n\n**_config.yml** 配置添加gitment开启\n\n```\ngitment:\n       on: true\n       enable: true\n       owner: chengshea\n       repo: chengshea.github.io\n       client_id: 3478952f5e3adexxxxx\n       client_secret: 3ca8b3ada58c7993cbb385839f83bxxxxx\n```\n\n\n\n管理OAuth Apps\n\nhttps://github.com/settings/developers","source":"_posts/lang/node/hexo/评论.md","raw":"---\ntitle: 评论\ndate: 2017-11-14 19:36:33\ntags:\n  - issues\ncategories:\n  - hexo\n---\n\n### 由来\n\n[gitment](https://github.com/imsun/gitment)使用 **github issue** 保存评论\n\n### 准备\n\n右键新标签页打开 https://github.com/settings/applications/new\n\n创建\n![app-id](http://ojtd6k176.bkt.clouddn.com/github-new-app.png)\n\n获取 id secret\n![参数](http://ojtd6k176.bkt.clouddn.com/github-app-id.png)\n\n### hexo Theme\n\n根据 *个人主题* 添加\n\n#### 样式\n\nsource/css/gitment.css\n\n- css [详情右键新标签页](https://github.com/chengshea/record/blob/master/issue/gitment.css)\n\nsource/js/gitment.js\n\n- js [详情右键新标签页](https://github.com/chengshea/record/blob/master/issue/gitment.js)\n\n#### 布局调用\n <!--more--> \n调用认证\n/layout/_partial/comments/gitment.ejs\n\n```\n<div id=\"gitment\"></div>\n<!-- 主页不要加载gitment -->\n<%if (!index){ %>\n<script>\nvar gitment = new Gitment({\nowner: 'chengshea',\nrepo: 'chengshea.github.io',\noauth: {\nclient_id: '3478952f5e3ade06xxxxx',\nclient_secret: '3ca8b3ada58c7993cbb385839f83ba8xxxxxx',\n },\n})\ngitment.render('gitment')\n</script>\n<% } %>\n```\n\n\n\n添加评论\n/layout/_partial/article.ejs\n\n```\n<% if (!index && post.comments){ %>\n    <%  if (theme.gitment.on) { %>\n        <%- partial('comments/gitment') %>\n    <% } else if (theme.disqus.on) { %>\n        <%- partial('comments/disqus', {\n            shortname: theme.disqus.shortname\n          }) %>\n    <% } else if (config.disqus_shortname) { %>\n        <%- partial('comments/disqus', {\n            shortname: config.disqus_shortname\n          }) %>\n    <% } %>\n<% } %>\n```\n\n\n\n**_config.yml** 配置添加gitment开启\n\n```\ngitment:\n       on: true\n       enable: true\n       owner: chengshea\n       repo: chengshea.github.io\n       client_id: 3478952f5e3adexxxxx\n       client_secret: 3ca8b3ada58c7993cbb385839f83bxxxxx\n```\n\n\n\n管理OAuth Apps\n\nhttps://github.com/settings/developers","slug":"lang/node/hexo/评论","published":1,"updated":"2022-08-21T10:26:02.928Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtu2004bgwi545572j8k","content":"<h3 id=\"由来\"><a href=\"#由来\" class=\"headerlink\" title=\"由来\"></a>由来</h3><p><a href=\"https://github.com/imsun/gitment\">gitment</a>使用 <strong>github issue</strong> 保存评论</p>\n<h3 id=\"准备\"><a href=\"#准备\" class=\"headerlink\" title=\"准备\"></a>准备</h3><p>右键新标签页打开 <a href=\"https://github.com/settings/applications/new\">https://github.com/settings/applications/new</a></p>\n<p>创建<br><img src=\"http://ojtd6k176.bkt.clouddn.com/github-new-app.png\" alt=\"app-id\"></p>\n<p>获取 id secret<br><img src=\"http://ojtd6k176.bkt.clouddn.com/github-app-id.png\" alt=\"参数\"></p>\n<h3 id=\"hexo-Theme\"><a href=\"#hexo-Theme\" class=\"headerlink\" title=\"hexo Theme\"></a>hexo Theme</h3><p>根据 <em>个人主题</em> 添加</p>\n<h4 id=\"样式\"><a href=\"#样式\" class=\"headerlink\" title=\"样式\"></a>样式</h4><p>source&#x2F;css&#x2F;gitment.css</p>\n<ul>\n<li>css <a href=\"https://github.com/chengshea/record/blob/master/issue/gitment.css\">详情右键新标签页</a></li>\n</ul>\n<p>source&#x2F;js&#x2F;gitment.js</p>\n<ul>\n<li>js <a href=\"https://github.com/chengshea/record/blob/master/issue/gitment.js\">详情右键新标签页</a></li>\n</ul>\n<h4 id=\"布局调用\"><a href=\"#布局调用\" class=\"headerlink\" title=\"布局调用\"></a>布局调用</h4> <span id=\"more\"></span> \n<p>调用认证<br>&#x2F;layout&#x2F;_partial&#x2F;comments&#x2F;gitment.ejs</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id=&quot;gitment&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">&lt;!-- 主页不要加载gitment --&gt;</span><br><span class=\"line\">&lt;%if (!index)&#123; %&gt;</span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">var gitment = new Gitment(&#123;</span><br><span class=\"line\">owner: &#x27;chengshea&#x27;,</span><br><span class=\"line\">repo: &#x27;chengshea.github.io&#x27;,</span><br><span class=\"line\">oauth: &#123;</span><br><span class=\"line\">client_id: &#x27;3478952f5e3ade06xxxxx&#x27;,</span><br><span class=\"line\">client_secret: &#x27;3ca8b3ada58c7993cbb385839f83ba8xxxxxx&#x27;,</span><br><span class=\"line\"> &#125;,</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">gitment.render(&#x27;gitment&#x27;)</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>添加评论<br>&#x2F;layout&#x2F;_partial&#x2F;article.ejs</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;% if (!index &amp;&amp; post.comments)&#123; %&gt;</span><br><span class=\"line\">    &lt;%  if (theme.gitment.on) &#123; %&gt;</span><br><span class=\"line\">        &lt;%- partial(&#x27;comments/gitment&#x27;) %&gt;</span><br><span class=\"line\">    &lt;% &#125; else if (theme.disqus.on) &#123; %&gt;</span><br><span class=\"line\">        &lt;%- partial(&#x27;comments/disqus&#x27;, &#123;</span><br><span class=\"line\">            shortname: theme.disqus.shortname</span><br><span class=\"line\">          &#125;) %&gt;</span><br><span class=\"line\">    &lt;% &#125; else if (config.disqus_shortname) &#123; %&gt;</span><br><span class=\"line\">        &lt;%- partial(&#x27;comments/disqus&#x27;, &#123;</span><br><span class=\"line\">            shortname: config.disqus_shortname</span><br><span class=\"line\">          &#125;) %&gt;</span><br><span class=\"line\">    &lt;% &#125; %&gt;</span><br><span class=\"line\">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>_config.yml</strong> 配置添加gitment开启</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gitment:</span><br><span class=\"line\">       on: true</span><br><span class=\"line\">       enable: true</span><br><span class=\"line\">       owner: chengshea</span><br><span class=\"line\">       repo: chengshea.github.io</span><br><span class=\"line\">       client_id: 3478952f5e3adexxxxx</span><br><span class=\"line\">       client_secret: 3ca8b3ada58c7993cbb385839f83bxxxxx</span><br></pre></td></tr></table></figure>\n\n\n\n<p>管理OAuth Apps</p>\n<p><a href=\"https://github.com/settings/developers\">https://github.com/settings/developers</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"由来\"><a href=\"#由来\" class=\"headerlink\" title=\"由来\"></a>由来</h3><p><a href=\"https://github.com/imsun/gitment\">gitment</a>使用 <strong>github issue</strong> 保存评论</p>\n<h3 id=\"准备\"><a href=\"#准备\" class=\"headerlink\" title=\"准备\"></a>准备</h3><p>右键新标签页打开 <a href=\"https://github.com/settings/applications/new\">https://github.com/settings/applications/new</a></p>\n<p>创建<br><img src=\"http://ojtd6k176.bkt.clouddn.com/github-new-app.png\" alt=\"app-id\"></p>\n<p>获取 id secret<br><img src=\"http://ojtd6k176.bkt.clouddn.com/github-app-id.png\" alt=\"参数\"></p>\n<h3 id=\"hexo-Theme\"><a href=\"#hexo-Theme\" class=\"headerlink\" title=\"hexo Theme\"></a>hexo Theme</h3><p>根据 <em>个人主题</em> 添加</p>\n<h4 id=\"样式\"><a href=\"#样式\" class=\"headerlink\" title=\"样式\"></a>样式</h4><p>source&#x2F;css&#x2F;gitment.css</p>\n<ul>\n<li>css <a href=\"https://github.com/chengshea/record/blob/master/issue/gitment.css\">详情右键新标签页</a></li>\n</ul>\n<p>source&#x2F;js&#x2F;gitment.js</p>\n<ul>\n<li>js <a href=\"https://github.com/chengshea/record/blob/master/issue/gitment.js\">详情右键新标签页</a></li>\n</ul>\n<h4 id=\"布局调用\"><a href=\"#布局调用\" class=\"headerlink\" title=\"布局调用\"></a>布局调用</h4>","more":"<p>调用认证<br>&#x2F;layout&#x2F;_partial&#x2F;comments&#x2F;gitment.ejs</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id=&quot;gitment&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">&lt;!-- 主页不要加载gitment --&gt;</span><br><span class=\"line\">&lt;%if (!index)&#123; %&gt;</span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">var gitment = new Gitment(&#123;</span><br><span class=\"line\">owner: &#x27;chengshea&#x27;,</span><br><span class=\"line\">repo: &#x27;chengshea.github.io&#x27;,</span><br><span class=\"line\">oauth: &#123;</span><br><span class=\"line\">client_id: &#x27;3478952f5e3ade06xxxxx&#x27;,</span><br><span class=\"line\">client_secret: &#x27;3ca8b3ada58c7993cbb385839f83ba8xxxxxx&#x27;,</span><br><span class=\"line\"> &#125;,</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">gitment.render(&#x27;gitment&#x27;)</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>添加评论<br>&#x2F;layout&#x2F;_partial&#x2F;article.ejs</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;% if (!index &amp;&amp; post.comments)&#123; %&gt;</span><br><span class=\"line\">    &lt;%  if (theme.gitment.on) &#123; %&gt;</span><br><span class=\"line\">        &lt;%- partial(&#x27;comments/gitment&#x27;) %&gt;</span><br><span class=\"line\">    &lt;% &#125; else if (theme.disqus.on) &#123; %&gt;</span><br><span class=\"line\">        &lt;%- partial(&#x27;comments/disqus&#x27;, &#123;</span><br><span class=\"line\">            shortname: theme.disqus.shortname</span><br><span class=\"line\">          &#125;) %&gt;</span><br><span class=\"line\">    &lt;% &#125; else if (config.disqus_shortname) &#123; %&gt;</span><br><span class=\"line\">        &lt;%- partial(&#x27;comments/disqus&#x27;, &#123;</span><br><span class=\"line\">            shortname: config.disqus_shortname</span><br><span class=\"line\">          &#125;) %&gt;</span><br><span class=\"line\">    &lt;% &#125; %&gt;</span><br><span class=\"line\">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>\n\n\n\n<p><strong>_config.yml</strong> 配置添加gitment开启</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gitment:</span><br><span class=\"line\">       on: true</span><br><span class=\"line\">       enable: true</span><br><span class=\"line\">       owner: chengshea</span><br><span class=\"line\">       repo: chengshea.github.io</span><br><span class=\"line\">       client_id: 3478952f5e3adexxxxx</span><br><span class=\"line\">       client_secret: 3ca8b3ada58c7993cbb385839f83bxxxxx</span><br></pre></td></tr></table></figure>\n\n\n\n<p>管理OAuth Apps</p>\n<p><a href=\"https://github.com/settings/developers\">https://github.com/settings/developers</a></p>"},{"title":"npm初始","date":"2022-06-13T13:07:35.000Z","_content":"\n\n\nhttps://www.npmjs.com/package/npm\n\n## 源加速\n\n设置\n\n```\necho \"registry = https://registry.npm.taobao.org\">>~/.npmrc\n```\n\n查看当前源\n\n```\nnpm config get registry\n```\n\n<!--more-->\n\n## 使用\n\n### 全局安装(-g)\n\n typescript\n\n```\nnpm install -g typescript\n```\n\n>/opt/node/bin/tsc -> /opt/node/lib/node_modules/typescript/bin/tsc\n>/opt/node/bin/tsserver -> /opt/node/lib/node_modules/typescript/bin/tsserver\n>+ typescript@4.7.3\n>added 1 package from 1 contributor in 2.252s\n>\n\n\n\n### 卸载\n\n```\nnpm uninstall -g  typescript\n```\n\n\n\n- **`i`** 是 **`install`** 的简写\n- **`-g`** 是全局安装，不带 **`-g`** 会安装在个人文件夹\n- **`-S`** 与 **`--save`** 的简写，安装包信息会写入 **`dependencies`** 中;生产阶段,项目运行时的依赖\n- **`-D`** 与 **`--save-dev`** 的简写，安装包写入 **`devDependencies`** 中;开发阶段,只在开发阶段起作用,例如代码提示工具\n\n\n\n## 后台运行\n\n### pm2\n\n```shel\nnpm install pm2  -g \n```\n\n>pm2 start run.js --name my-api # 命名进程\n>pm2 list               # 显示所有进程状态\n>pm2 monit              # 监视所有进程\n>pm2 logs               #  显示所有进程日志\n>pm2 stop all           # 停止所有进程\n>pm2 restart all        # 重启所有进程\n>pm2 reload all         # 0秒停机重载进程 (用于 NETWORKED 进程)\n>pm2 stop 0             # 停止指定的进程\n>pm2 restart 0          # 重启指定的进程\n>pm2 startup            # 产生 init 脚本 保持进程活着\n>pm2 web                # 运行健壮的 computer API endpoint (http://localhost:9615)\n>pm2 delete 0           # 杀死指定的进程\n>pm2 delete all         # 杀死全部进程\n\n\n\n```shell\ncat >run.js<<EOF\nconst { exec } = require('child_process')\nexec('hexo server',(error, stdout, stderr) => {\n    if(error){\n            console.log('exec error: ${error}')\n            return\n    }\nconsole.log('stdout: ${stdout}')\nconsole.log('stderr: ${stderr}')\n})\nEOF\n\npm2 start run.js\n\n```\n\n","source":"_posts/lang/node/npm/npm初始.md","raw":"---\ntitle: npm初始\npermalink: lang/npm/npm初始/\ntags:\n  - 源\ncategories:\n  - lang\n  - npm\ndate: 2022-06-13 21:07:35\n---\n\n\n\nhttps://www.npmjs.com/package/npm\n\n## 源加速\n\n设置\n\n```\necho \"registry = https://registry.npm.taobao.org\">>~/.npmrc\n```\n\n查看当前源\n\n```\nnpm config get registry\n```\n\n<!--more-->\n\n## 使用\n\n### 全局安装(-g)\n\n typescript\n\n```\nnpm install -g typescript\n```\n\n>/opt/node/bin/tsc -> /opt/node/lib/node_modules/typescript/bin/tsc\n>/opt/node/bin/tsserver -> /opt/node/lib/node_modules/typescript/bin/tsserver\n>+ typescript@4.7.3\n>added 1 package from 1 contributor in 2.252s\n>\n\n\n\n### 卸载\n\n```\nnpm uninstall -g  typescript\n```\n\n\n\n- **`i`** 是 **`install`** 的简写\n- **`-g`** 是全局安装，不带 **`-g`** 会安装在个人文件夹\n- **`-S`** 与 **`--save`** 的简写，安装包信息会写入 **`dependencies`** 中;生产阶段,项目运行时的依赖\n- **`-D`** 与 **`--save-dev`** 的简写，安装包写入 **`devDependencies`** 中;开发阶段,只在开发阶段起作用,例如代码提示工具\n\n\n\n## 后台运行\n\n### pm2\n\n```shel\nnpm install pm2  -g \n```\n\n>pm2 start run.js --name my-api # 命名进程\n>pm2 list               # 显示所有进程状态\n>pm2 monit              # 监视所有进程\n>pm2 logs               #  显示所有进程日志\n>pm2 stop all           # 停止所有进程\n>pm2 restart all        # 重启所有进程\n>pm2 reload all         # 0秒停机重载进程 (用于 NETWORKED 进程)\n>pm2 stop 0             # 停止指定的进程\n>pm2 restart 0          # 重启指定的进程\n>pm2 startup            # 产生 init 脚本 保持进程活着\n>pm2 web                # 运行健壮的 computer API endpoint (http://localhost:9615)\n>pm2 delete 0           # 杀死指定的进程\n>pm2 delete all         # 杀死全部进程\n\n\n\n```shell\ncat >run.js<<EOF\nconst { exec } = require('child_process')\nexec('hexo server',(error, stdout, stderr) => {\n    if(error){\n            console.log('exec error: ${error}')\n            return\n    }\nconsole.log('stdout: ${stdout}')\nconsole.log('stderr: ${stderr}')\n})\nEOF\n\npm2 start run.js\n\n```\n\n","slug":"lang/node/npm/npm初始","published":1,"updated":"2022-08-28T09:10:00.932Z","__permalink":"lang/npm/npm初始/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtu3004egwi5gwnmeock","content":"<p><a href=\"https://www.npmjs.com/package/npm\">https://www.npmjs.com/package/npm</a></p>\n<h2 id=\"源加速\"><a href=\"#源加速\" class=\"headerlink\" title=\"源加速\"></a>源加速</h2><p>设置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;registry = https://registry.npm.taobao.org&quot;&gt;&gt;~/.npmrc</span><br></pre></td></tr></table></figure>\n\n<p>查看当前源</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm config get registry</span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><h3 id=\"全局安装-g\"><a href=\"#全局安装-g\" class=\"headerlink\" title=\"全局安装(-g)\"></a>全局安装(-g)</h3><p> typescript</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g typescript</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>&#x2F;opt&#x2F;node&#x2F;bin&#x2F;tsc -&gt; &#x2F;opt&#x2F;node&#x2F;lib&#x2F;node_modules&#x2F;typescript&#x2F;bin&#x2F;tsc<br>&#x2F;opt&#x2F;node&#x2F;bin&#x2F;tsserver -&gt; &#x2F;opt&#x2F;node&#x2F;lib&#x2F;node_modules&#x2F;typescript&#x2F;bin&#x2F;tsserver</p>\n<ul>\n<li><a href=\"mailto:&#x74;&#x79;&#x70;&#x65;&#115;&#x63;&#114;&#105;&#x70;&#x74;&#64;&#52;&#46;&#x37;&#x2e;&#x33;\">&#x74;&#x79;&#x70;&#x65;&#115;&#x63;&#114;&#105;&#x70;&#x74;&#64;&#52;&#46;&#x37;&#x2e;&#x33;</a><br>added 1 package from 1 contributor in 2.252s</li>\n</ul>\n</blockquote>\n<h3 id=\"卸载\"><a href=\"#卸载\" class=\"headerlink\" title=\"卸载\"></a>卸载</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm uninstall -g  typescript</span><br></pre></td></tr></table></figure>\n\n\n\n<ul>\n<li><strong><code>i</code></strong> 是 <strong><code>install</code></strong> 的简写</li>\n<li><strong><code>-g</code></strong> 是全局安装，不带 <strong><code>-g</code></strong> 会安装在个人文件夹</li>\n<li><strong><code>-S</code></strong> 与 <strong><code>--save</code></strong> 的简写，安装包信息会写入 <strong><code>dependencies</code></strong> 中;生产阶段,项目运行时的依赖</li>\n<li><strong><code>-D</code></strong> 与 <strong><code>--save-dev</code></strong> 的简写，安装包写入 <strong><code>devDependencies</code></strong> 中;开发阶段,只在开发阶段起作用,例如代码提示工具</li>\n</ul>\n<h2 id=\"后台运行\"><a href=\"#后台运行\" class=\"headerlink\" title=\"后台运行\"></a>后台运行</h2><h3 id=\"pm2\"><a href=\"#pm2\" class=\"headerlink\" title=\"pm2\"></a>pm2</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install pm2  -g </span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>pm2 start run.js –name my-api # 命名进程<br>pm2 list               # 显示所有进程状态<br>pm2 monit              # 监视所有进程<br>pm2 logs               #  显示所有进程日志<br>pm2 stop all           # 停止所有进程<br>pm2 restart all        # 重启所有进程<br>pm2 reload all         # 0秒停机重载进程 (用于 NETWORKED 进程)<br>pm2 stop 0             # 停止指定的进程<br>pm2 restart 0          # 重启指定的进程<br>pm2 startup            # 产生 init 脚本 保持进程活着<br>pm2 web                # 运行健壮的 computer API endpoint (<a href=\"http://localhost:9615/\">http://localhost:9615</a>)<br>pm2 delete 0           # 杀死指定的进程<br>pm2 delete all         # 杀死全部进程</p>\n</blockquote>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt;run.js&lt;&lt;EOF</span><br><span class=\"line\">const &#123; exec &#125; = require(&#x27;child_process&#x27;)</span><br><span class=\"line\">exec(&#x27;hexo server&#x27;,(error, stdout, stderr) =&gt; &#123;</span><br><span class=\"line\">    if(error)&#123;</span><br><span class=\"line\">            console.log(&#x27;exec error: $&#123;error&#125;&#x27;)</span><br><span class=\"line\">            return</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">console.log(&#x27;stdout: $&#123;stdout&#125;&#x27;)</span><br><span class=\"line\">console.log(&#x27;stderr: $&#123;stderr&#125;&#x27;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">pm2 start run.js</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p><a href=\"https://www.npmjs.com/package/npm\">https://www.npmjs.com/package/npm</a></p>\n<h2 id=\"源加速\"><a href=\"#源加速\" class=\"headerlink\" title=\"源加速\"></a>源加速</h2><p>设置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;registry = https://registry.npm.taobao.org&quot;&gt;&gt;~/.npmrc</span><br></pre></td></tr></table></figure>\n\n<p>查看当前源</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm config get registry</span><br></pre></td></tr></table></figure>","more":"<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><h3 id=\"全局安装-g\"><a href=\"#全局安装-g\" class=\"headerlink\" title=\"全局安装(-g)\"></a>全局安装(-g)</h3><p> typescript</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g typescript</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>&#x2F;opt&#x2F;node&#x2F;bin&#x2F;tsc -&gt; &#x2F;opt&#x2F;node&#x2F;lib&#x2F;node_modules&#x2F;typescript&#x2F;bin&#x2F;tsc<br>&#x2F;opt&#x2F;node&#x2F;bin&#x2F;tsserver -&gt; &#x2F;opt&#x2F;node&#x2F;lib&#x2F;node_modules&#x2F;typescript&#x2F;bin&#x2F;tsserver</p>\n<ul>\n<li><a href=\"mailto:&#x74;&#x79;&#x70;&#x65;&#115;&#x63;&#114;&#105;&#x70;&#x74;&#64;&#52;&#46;&#x37;&#x2e;&#x33;\">&#x74;&#x79;&#x70;&#x65;&#115;&#x63;&#114;&#105;&#x70;&#x74;&#64;&#52;&#46;&#x37;&#x2e;&#x33;</a><br>added 1 package from 1 contributor in 2.252s</li>\n</ul>\n</blockquote>\n<h3 id=\"卸载\"><a href=\"#卸载\" class=\"headerlink\" title=\"卸载\"></a>卸载</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm uninstall -g  typescript</span><br></pre></td></tr></table></figure>\n\n\n\n<ul>\n<li><strong><code>i</code></strong> 是 <strong><code>install</code></strong> 的简写</li>\n<li><strong><code>-g</code></strong> 是全局安装，不带 <strong><code>-g</code></strong> 会安装在个人文件夹</li>\n<li><strong><code>-S</code></strong> 与 <strong><code>--save</code></strong> 的简写，安装包信息会写入 <strong><code>dependencies</code></strong> 中;生产阶段,项目运行时的依赖</li>\n<li><strong><code>-D</code></strong> 与 <strong><code>--save-dev</code></strong> 的简写，安装包写入 <strong><code>devDependencies</code></strong> 中;开发阶段,只在开发阶段起作用,例如代码提示工具</li>\n</ul>\n<h2 id=\"后台运行\"><a href=\"#后台运行\" class=\"headerlink\" title=\"后台运行\"></a>后台运行</h2><h3 id=\"pm2\"><a href=\"#pm2\" class=\"headerlink\" title=\"pm2\"></a>pm2</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install pm2  -g </span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>pm2 start run.js –name my-api # 命名进程<br>pm2 list               # 显示所有进程状态<br>pm2 monit              # 监视所有进程<br>pm2 logs               #  显示所有进程日志<br>pm2 stop all           # 停止所有进程<br>pm2 restart all        # 重启所有进程<br>pm2 reload all         # 0秒停机重载进程 (用于 NETWORKED 进程)<br>pm2 stop 0             # 停止指定的进程<br>pm2 restart 0          # 重启指定的进程<br>pm2 startup            # 产生 init 脚本 保持进程活着<br>pm2 web                # 运行健壮的 computer API endpoint (<a href=\"http://localhost:9615/\">http://localhost:9615</a>)<br>pm2 delete 0           # 杀死指定的进程<br>pm2 delete all         # 杀死全部进程</p>\n</blockquote>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt;run.js&lt;&lt;EOF</span><br><span class=\"line\">const &#123; exec &#125; = require(&#x27;child_process&#x27;)</span><br><span class=\"line\">exec(&#x27;hexo server&#x27;,(error, stdout, stderr) =&gt; &#123;</span><br><span class=\"line\">    if(error)&#123;</span><br><span class=\"line\">            console.log(&#x27;exec error: $&#123;error&#125;&#x27;)</span><br><span class=\"line\">            return</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">console.log(&#x27;stdout: $&#123;stdout&#125;&#x27;)</span><br><span class=\"line\">console.log(&#x27;stderr: $&#123;stderr&#125;&#x27;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">pm2 start run.js</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>"},{"title":"mysql安装","date":"2022-07-17T07:07:55.000Z","_content":"\n\n\n\n\n## linux\n\n下载  https://downloads.mysql.com/archives/community/\n\n**Compressed TAR Archive, Minimal Install** **不包含调试和测试工具**\n\n```\nxz -d mysql-8.0.28-linux-glibc2.17-x86_64-minimal.tar.xz\ntar -xvf mysql-8.0.28-linux-glibc2.17-x86_64-minimal.tar\n```\n\n\n\n用户组\n\n```\n# cs 换成mysql 或 ${USER}\nsudo groupadd mysql\nsudo useradd mysql -r -M -s /sbin/nologin\nsudo chown mysql:cs -R  /opt/mysql/*\n\n\ncs@debian:~/data/software$ cat /etc/group | grep mysql\nmysql:x:512:cs\ncs@debian:~/data/software$ cat /etc/passwd | grep mysql\nmysql:x:512:512::/home/mysql:/sbin/nologin\n```\n\n\n\n初始化数据库\n\n```\n$ sudo /opt/mysql/bin/mysqld  --initialize --user=mysql --console\n----2022-01-30T00:14:24.872326+08:00 6 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: bDB,fVSmt2/U\n```\n\n\n\n```\n url=/opt/mysql\n sed -n \"/^basedir=/s#=#==$url#\"p ./mysql.server\n sed -n \"/^datadir=/s#=#=$url/data#\"p ./mysql.server\n sed -n \"s#conf=.*#conf=$url/my.cnf#\"p ./mysql.server\n```\n\n\n\n开机启动\n\n```\nsudo cp /opt/mysql/support-files/mysql.server  /etc/init.d/mysql\n设置为开机自动运行\nsudo update-rc.d mysql defaults\n设置为取消开机自动运行\nsudo update-rc.d -f mysql remove\n```\n\n密码\n\n```\n##### 临时密码登录,执行语句提示 You must reset your password using ALTER USER statement before executing this statement.\n--- alter user user() identified by \"123456\";  ##密码字符串双引号\n\n---低于版本8---SET PASSWORD FOR root@localhost = '123456';\n---版本8以上---ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '123456'; \n\n##用户密码过期时间250天\nALTER USER ‘cs’@‘localhost' PASSWORD EXPIRE INTERVAL 250 DAY;\n###禁用过期     --恢复默认策略 PASSWORD EXPIRE DEFAULT----\nALTER USER 'cs'@'localhost' PASSWORD EXPIRE NEVER;\n\n###密码过期的策略\nshow variables like 'default_password_lifetime';\n---设置密码永不过期，需要把default_password_lifetime修改为 0\n---set global default_password_lifetime = 0;\n\n CREATE USER 'cs'@'localhost' IDENTIFIED BY '123456';\n\n\n###修改执行生效语句\nflush privileges;\n```\n\n\n\n## win\n\n[下载地址：http://dev.mysql.com/downloads/mysql/](http://dev.mysql.com/downloads/mysql/) \n\n管理员权限运行cmd\n\n```\nE:\\MySQL\\MySQL Server 5.7\\bin>mysqld install MySQL --defaults-file=\"E:\\MySQL\\MySQL Server 5.7\\my.ini\"\n```\n\ninstall/Remove of the Service Denied!  \n\n\n\n```\nbin>mysqld --initialize --user=mysql --console\n```\n\n启动服务\n\n```\nnet start MySQL\n```\n\n删除  \n\n```\nsc delete MySQL\n```\n\n","source":"_posts/services/database/mysql/install.md","raw":"---\ntitle: mysql安装\npermalink: services/database/mysql/install/\ntags:\n  - mysql\n  - install\ncategories:\n  - services\n  - database\ndate: 2022-07-17 15:07:55\n---\n\n\n\n\n\n## linux\n\n下载  https://downloads.mysql.com/archives/community/\n\n**Compressed TAR Archive, Minimal Install** **不包含调试和测试工具**\n\n```\nxz -d mysql-8.0.28-linux-glibc2.17-x86_64-minimal.tar.xz\ntar -xvf mysql-8.0.28-linux-glibc2.17-x86_64-minimal.tar\n```\n\n\n\n用户组\n\n```\n# cs 换成mysql 或 ${USER}\nsudo groupadd mysql\nsudo useradd mysql -r -M -s /sbin/nologin\nsudo chown mysql:cs -R  /opt/mysql/*\n\n\ncs@debian:~/data/software$ cat /etc/group | grep mysql\nmysql:x:512:cs\ncs@debian:~/data/software$ cat /etc/passwd | grep mysql\nmysql:x:512:512::/home/mysql:/sbin/nologin\n```\n\n\n\n初始化数据库\n\n```\n$ sudo /opt/mysql/bin/mysqld  --initialize --user=mysql --console\n----2022-01-30T00:14:24.872326+08:00 6 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: bDB,fVSmt2/U\n```\n\n\n\n```\n url=/opt/mysql\n sed -n \"/^basedir=/s#=#==$url#\"p ./mysql.server\n sed -n \"/^datadir=/s#=#=$url/data#\"p ./mysql.server\n sed -n \"s#conf=.*#conf=$url/my.cnf#\"p ./mysql.server\n```\n\n\n\n开机启动\n\n```\nsudo cp /opt/mysql/support-files/mysql.server  /etc/init.d/mysql\n设置为开机自动运行\nsudo update-rc.d mysql defaults\n设置为取消开机自动运行\nsudo update-rc.d -f mysql remove\n```\n\n密码\n\n```\n##### 临时密码登录,执行语句提示 You must reset your password using ALTER USER statement before executing this statement.\n--- alter user user() identified by \"123456\";  ##密码字符串双引号\n\n---低于版本8---SET PASSWORD FOR root@localhost = '123456';\n---版本8以上---ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '123456'; \n\n##用户密码过期时间250天\nALTER USER ‘cs’@‘localhost' PASSWORD EXPIRE INTERVAL 250 DAY;\n###禁用过期     --恢复默认策略 PASSWORD EXPIRE DEFAULT----\nALTER USER 'cs'@'localhost' PASSWORD EXPIRE NEVER;\n\n###密码过期的策略\nshow variables like 'default_password_lifetime';\n---设置密码永不过期，需要把default_password_lifetime修改为 0\n---set global default_password_lifetime = 0;\n\n CREATE USER 'cs'@'localhost' IDENTIFIED BY '123456';\n\n\n###修改执行生效语句\nflush privileges;\n```\n\n\n\n## win\n\n[下载地址：http://dev.mysql.com/downloads/mysql/](http://dev.mysql.com/downloads/mysql/) \n\n管理员权限运行cmd\n\n```\nE:\\MySQL\\MySQL Server 5.7\\bin>mysqld install MySQL --defaults-file=\"E:\\MySQL\\MySQL Server 5.7\\my.ini\"\n```\n\ninstall/Remove of the Service Denied!  \n\n\n\n```\nbin>mysqld --initialize --user=mysql --console\n```\n\n启动服务\n\n```\nnet start MySQL\n```\n\n删除  \n\n```\nsc delete MySQL\n```\n\n","slug":"services/database/mysql/install","published":1,"updated":"2022-08-28T09:10:00.936Z","__permalink":"services/database/mysql/install/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtu4004hgwi5h0s11cmq","content":"<h2 id=\"linux\"><a href=\"#linux\" class=\"headerlink\" title=\"linux\"></a>linux</h2><p>下载  <a href=\"https://downloads.mysql.com/archives/community/\">https://downloads.mysql.com/archives/community/</a></p>\n<p><strong>Compressed TAR Archive, Minimal Install</strong> <strong>不包含调试和测试工具</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xz -d mysql-8.0.28-linux-glibc2.17-x86_64-minimal.tar.xz</span><br><span class=\"line\">tar -xvf mysql-8.0.28-linux-glibc2.17-x86_64-minimal.tar</span><br></pre></td></tr></table></figure>\n\n\n\n<p>用户组</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># cs 换成mysql 或 $&#123;USER&#125;</span><br><span class=\"line\">sudo groupadd mysql</span><br><span class=\"line\">sudo useradd mysql -r -M -s /sbin/nologin</span><br><span class=\"line\">sudo chown mysql:cs -R  /opt/mysql/*</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">cs@debian:~/data/software$ cat /etc/group | grep mysql</span><br><span class=\"line\">mysql:x:512:cs</span><br><span class=\"line\">cs@debian:~/data/software$ cat /etc/passwd | grep mysql</span><br><span class=\"line\">mysql:x:512:512::/home/mysql:/sbin/nologin</span><br></pre></td></tr></table></figure>\n\n\n\n<p>初始化数据库</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo /opt/mysql/bin/mysqld  --initialize --user=mysql --console</span><br><span class=\"line\">----2022-01-30T00:14:24.872326+08:00 6 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: bDB,fVSmt2/U</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">url=/opt/mysql</span><br><span class=\"line\">sed -n &quot;/^basedir=/s#=#==$url#&quot;p ./mysql.server</span><br><span class=\"line\">sed -n &quot;/^datadir=/s#=#=$url/data#&quot;p ./mysql.server</span><br><span class=\"line\">sed -n &quot;s#conf=.*#conf=$url/my.cnf#&quot;p ./mysql.server</span><br></pre></td></tr></table></figure>\n\n\n\n<p>开机启动</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo cp /opt/mysql/support-files/mysql.server  /etc/init.d/mysql</span><br><span class=\"line\">设置为开机自动运行</span><br><span class=\"line\">sudo update-rc.d mysql defaults</span><br><span class=\"line\">设置为取消开机自动运行</span><br><span class=\"line\">sudo update-rc.d -f mysql remove</span><br></pre></td></tr></table></figure>\n\n<p>密码</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">##### 临时密码登录,执行语句提示 You must reset your password using ALTER USER statement before executing this statement.</span><br><span class=\"line\">--- alter user user() identified by &quot;123456&quot;;  ##密码字符串双引号</span><br><span class=\"line\"></span><br><span class=\"line\">---低于版本8---SET PASSWORD FOR root@localhost = &#x27;123456&#x27;;</span><br><span class=\"line\">---版本8以上---ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;123456&#x27;; </span><br><span class=\"line\"></span><br><span class=\"line\">##用户密码过期时间250天</span><br><span class=\"line\">ALTER USER ‘cs’@‘localhost&#x27; PASSWORD EXPIRE INTERVAL 250 DAY;</span><br><span class=\"line\">###禁用过期     --恢复默认策略 PASSWORD EXPIRE DEFAULT----</span><br><span class=\"line\">ALTER USER &#x27;cs&#x27;@&#x27;localhost&#x27; PASSWORD EXPIRE NEVER;</span><br><span class=\"line\"></span><br><span class=\"line\">###密码过期的策略</span><br><span class=\"line\">show variables like &#x27;default_password_lifetime&#x27;;</span><br><span class=\"line\">---设置密码永不过期，需要把default_password_lifetime修改为 0</span><br><span class=\"line\">---set global default_password_lifetime = 0;</span><br><span class=\"line\"></span><br><span class=\"line\"> CREATE USER &#x27;cs&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;123456&#x27;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">###修改执行生效语句</span><br><span class=\"line\">flush privileges;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"win\"><a href=\"#win\" class=\"headerlink\" title=\"win\"></a>win</h2><p><a href=\"http://dev.mysql.com/downloads/mysql/\">下载地址：http://dev.mysql.com/downloads/mysql/</a> </p>\n<p>管理员权限运行cmd</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">E:\\MySQL\\MySQL Server 5.7\\bin&gt;mysqld install MySQL --defaults-file=&quot;E:\\MySQL\\MySQL Server 5.7\\my.ini&quot;</span><br></pre></td></tr></table></figure>\n\n<p>install&#x2F;Remove of the Service Denied!  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin&gt;mysqld --initialize --user=mysql --console</span><br></pre></td></tr></table></figure>\n\n<p>启动服务</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">net start MySQL</span><br></pre></td></tr></table></figure>\n\n<p>删除  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sc delete MySQL</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"linux\"><a href=\"#linux\" class=\"headerlink\" title=\"linux\"></a>linux</h2><p>下载  <a href=\"https://downloads.mysql.com/archives/community/\">https://downloads.mysql.com/archives/community/</a></p>\n<p><strong>Compressed TAR Archive, Minimal Install</strong> <strong>不包含调试和测试工具</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xz -d mysql-8.0.28-linux-glibc2.17-x86_64-minimal.tar.xz</span><br><span class=\"line\">tar -xvf mysql-8.0.28-linux-glibc2.17-x86_64-minimal.tar</span><br></pre></td></tr></table></figure>\n\n\n\n<p>用户组</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># cs 换成mysql 或 $&#123;USER&#125;</span><br><span class=\"line\">sudo groupadd mysql</span><br><span class=\"line\">sudo useradd mysql -r -M -s /sbin/nologin</span><br><span class=\"line\">sudo chown mysql:cs -R  /opt/mysql/*</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">cs@debian:~/data/software$ cat /etc/group | grep mysql</span><br><span class=\"line\">mysql:x:512:cs</span><br><span class=\"line\">cs@debian:~/data/software$ cat /etc/passwd | grep mysql</span><br><span class=\"line\">mysql:x:512:512::/home/mysql:/sbin/nologin</span><br></pre></td></tr></table></figure>\n\n\n\n<p>初始化数据库</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo /opt/mysql/bin/mysqld  --initialize --user=mysql --console</span><br><span class=\"line\">----2022-01-30T00:14:24.872326+08:00 6 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: bDB,fVSmt2/U</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">url=/opt/mysql</span><br><span class=\"line\">sed -n &quot;/^basedir=/s#=#==$url#&quot;p ./mysql.server</span><br><span class=\"line\">sed -n &quot;/^datadir=/s#=#=$url/data#&quot;p ./mysql.server</span><br><span class=\"line\">sed -n &quot;s#conf=.*#conf=$url/my.cnf#&quot;p ./mysql.server</span><br></pre></td></tr></table></figure>\n\n\n\n<p>开机启动</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo cp /opt/mysql/support-files/mysql.server  /etc/init.d/mysql</span><br><span class=\"line\">设置为开机自动运行</span><br><span class=\"line\">sudo update-rc.d mysql defaults</span><br><span class=\"line\">设置为取消开机自动运行</span><br><span class=\"line\">sudo update-rc.d -f mysql remove</span><br></pre></td></tr></table></figure>\n\n<p>密码</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">##### 临时密码登录,执行语句提示 You must reset your password using ALTER USER statement before executing this statement.</span><br><span class=\"line\">--- alter user user() identified by &quot;123456&quot;;  ##密码字符串双引号</span><br><span class=\"line\"></span><br><span class=\"line\">---低于版本8---SET PASSWORD FOR root@localhost = &#x27;123456&#x27;;</span><br><span class=\"line\">---版本8以上---ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;123456&#x27;; </span><br><span class=\"line\"></span><br><span class=\"line\">##用户密码过期时间250天</span><br><span class=\"line\">ALTER USER ‘cs’@‘localhost&#x27; PASSWORD EXPIRE INTERVAL 250 DAY;</span><br><span class=\"line\">###禁用过期     --恢复默认策略 PASSWORD EXPIRE DEFAULT----</span><br><span class=\"line\">ALTER USER &#x27;cs&#x27;@&#x27;localhost&#x27; PASSWORD EXPIRE NEVER;</span><br><span class=\"line\"></span><br><span class=\"line\">###密码过期的策略</span><br><span class=\"line\">show variables like &#x27;default_password_lifetime&#x27;;</span><br><span class=\"line\">---设置密码永不过期，需要把default_password_lifetime修改为 0</span><br><span class=\"line\">---set global default_password_lifetime = 0;</span><br><span class=\"line\"></span><br><span class=\"line\"> CREATE USER &#x27;cs&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;123456&#x27;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">###修改执行生效语句</span><br><span class=\"line\">flush privileges;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"win\"><a href=\"#win\" class=\"headerlink\" title=\"win\"></a>win</h2><p><a href=\"http://dev.mysql.com/downloads/mysql/\">下载地址：http://dev.mysql.com/downloads/mysql/</a> </p>\n<p>管理员权限运行cmd</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">E:\\MySQL\\MySQL Server 5.7\\bin&gt;mysqld install MySQL --defaults-file=&quot;E:\\MySQL\\MySQL Server 5.7\\my.ini&quot;</span><br></pre></td></tr></table></figure>\n\n<p>install&#x2F;Remove of the Service Denied!  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin&gt;mysqld --initialize --user=mysql --console</span><br></pre></td></tr></table></figure>\n\n<p>启动服务</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">net start MySQL</span><br></pre></td></tr></table></figure>\n\n<p>删除  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sc delete MySQL</span><br></pre></td></tr></table></figure>\n\n"},{"title":"mysql配置文件","date":"2022-07-17T07:14:20.000Z","_content":"\n\n\n## linux\n\n### my.cnf\n\n```\n[mysqld]\n#server-id                      = 224\nuser = mysql\nport                           = 3305\nmysqlx_port                    = 33060\nmysqlx_socket                  = /tmp/mysqlx.sock\ndatadir                        = /opt/mysql/data\nsocket                         = /tmp/mysql.sock\npid-file                       = /tmp/mysqld.pid\nauto_increment_offset          = 2\nauto_increment_increment       = 2 \nlog-error                      = /opt/mysql/log/error.log\nslow-query-log                 = 1\nslow-query-log-file            = /opt/mysql/log/slow.log\nlong_query_time                = 0.2\nlog-bin                        = bin.log\nrelay-log                      = relay.log\nbinlog_format                 =ROW\nrelay_log_recovery            = 1\ncharacter-set-client-handshake = FALSE\ncharacter-set-server           = utf8mb4\ncollation-server               = utf8mb4_unicode_ci\ninit_connect                   ='SET NAMES utf8mb4'\ninnodb_buffer_pool_size        = 1G\njoin_buffer_size               = 128M\nsort_buffer_size               = 2M\nread_rnd_buffer_size           = 2M\nlog_timestamps                 = SYSTEM\nlower_case_table_names         = 1\ndefault-authentication-plugin  =mysql_native_password\n```\n\n\n\n\n\n## win\n\n### my.ini\n\n```\n[client]\nport=3306\n\n[mysql]\ndefault-character-set=utf8mb4\n\n\n[mysqld]\nport=3306\n#password=123456\n#character-set-client-handshake=FALSE  \ncharacter-set-server=utf8mb4 \n#collation-server = utf8mb4_general_ci  \ninit_connect='SET NAMES utf8mb4'\n\n\nbasedir=\"D:/360Downloads/mysql-5.7.20-winx64\"\n#Path to the database root\ndatadir=\"D:/360Downloads/mysql-5.7.20-winx64/data\"\n\nlog-error=\"D:/360Downloads/mysql-5.7.20-winx64/log/mysqld_err.log\"\n#log-bin=\"D:/360Downloads/mysql-5.7.20-winx64/log/mysqld_bin.bin\"\n\ndefault-storage-engine=INNODB\n#从 5.6开始，timestamp 的默认行为已经是 deprecated 了\nexplicit_defaults_for_timestamp=true\n\nsql_mode=\"STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION\" \n\n```\n\n\n\n## 主从\n\ndoc https://dev.mysql.com/doc/refman/8.0/en/replication-howto-masterstatus.html\n\n新帐号\n\n>CREATE USER 'repl'@'192.168.16.232' IDENTIFIED BY '123456';\n\n\n\n 只复制\n\n> GRANT REPLICATION SLAVE ON *.* TO 'repl'@'192.168.16.232';\n\n\n\n\n\n### 主 \n\n配置mysql.cnf \n\n```\n[mysqld]\nserver-id=1\n```\n\n```\n\nshow master status;\n```\n\n>  File: mysql-bin.000001\n>  Position: 765\n\n\n\n### 从\n\n配置mysql.cnf\n\n```\n[mysqld]\nserver-id=2\n```\n\n备份\n\n```\nmysql -uroot -h 主 -p  database >back.sql;\n\n#登陆从库\nsource back.sql;\n\n```\n\n\n\n```\n\nstop slave;\n\nreset slave;\n\nreset master;\n\n```\n\n关键 \n\n把 show master status\\G `File`和`Position`对号入座\n\n```\n\n     CHANGE MASTER TO  \n\n     MASTER_HOST='master_host_name',\n\n     MASTER_USER='主用户名',\n\n     MASTER_PASSWORD='主密码',\n\n     MASTER_LOG_FILE='主status File',\n\n     MASTER_LOG_POS=主status Position;\n\n```\n\n开启从库\n\n```\nstart slave;\n```\n\n检查状态\n\n```\n\nshow slave status\\G\n\n```\n\n>Slave_IO_Running: Yes\n>\n>Slave_SQL_Running: Yes\n","source":"_posts/services/database/mysql/my.md","raw":"---\ntitle: mysql配置文件\npermalink: services/database/mysql/my/\ntags:\n  - mysql\ncategories:\n  - services\n  - database\ndate: 2022-07-17 15:14:20\n---\n\n\n\n## linux\n\n### my.cnf\n\n```\n[mysqld]\n#server-id                      = 224\nuser = mysql\nport                           = 3305\nmysqlx_port                    = 33060\nmysqlx_socket                  = /tmp/mysqlx.sock\ndatadir                        = /opt/mysql/data\nsocket                         = /tmp/mysql.sock\npid-file                       = /tmp/mysqld.pid\nauto_increment_offset          = 2\nauto_increment_increment       = 2 \nlog-error                      = /opt/mysql/log/error.log\nslow-query-log                 = 1\nslow-query-log-file            = /opt/mysql/log/slow.log\nlong_query_time                = 0.2\nlog-bin                        = bin.log\nrelay-log                      = relay.log\nbinlog_format                 =ROW\nrelay_log_recovery            = 1\ncharacter-set-client-handshake = FALSE\ncharacter-set-server           = utf8mb4\ncollation-server               = utf8mb4_unicode_ci\ninit_connect                   ='SET NAMES utf8mb4'\ninnodb_buffer_pool_size        = 1G\njoin_buffer_size               = 128M\nsort_buffer_size               = 2M\nread_rnd_buffer_size           = 2M\nlog_timestamps                 = SYSTEM\nlower_case_table_names         = 1\ndefault-authentication-plugin  =mysql_native_password\n```\n\n\n\n\n\n## win\n\n### my.ini\n\n```\n[client]\nport=3306\n\n[mysql]\ndefault-character-set=utf8mb4\n\n\n[mysqld]\nport=3306\n#password=123456\n#character-set-client-handshake=FALSE  \ncharacter-set-server=utf8mb4 \n#collation-server = utf8mb4_general_ci  \ninit_connect='SET NAMES utf8mb4'\n\n\nbasedir=\"D:/360Downloads/mysql-5.7.20-winx64\"\n#Path to the database root\ndatadir=\"D:/360Downloads/mysql-5.7.20-winx64/data\"\n\nlog-error=\"D:/360Downloads/mysql-5.7.20-winx64/log/mysqld_err.log\"\n#log-bin=\"D:/360Downloads/mysql-5.7.20-winx64/log/mysqld_bin.bin\"\n\ndefault-storage-engine=INNODB\n#从 5.6开始，timestamp 的默认行为已经是 deprecated 了\nexplicit_defaults_for_timestamp=true\n\nsql_mode=\"STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION\" \n\n```\n\n\n\n## 主从\n\ndoc https://dev.mysql.com/doc/refman/8.0/en/replication-howto-masterstatus.html\n\n新帐号\n\n>CREATE USER 'repl'@'192.168.16.232' IDENTIFIED BY '123456';\n\n\n\n 只复制\n\n> GRANT REPLICATION SLAVE ON *.* TO 'repl'@'192.168.16.232';\n\n\n\n\n\n### 主 \n\n配置mysql.cnf \n\n```\n[mysqld]\nserver-id=1\n```\n\n```\n\nshow master status;\n```\n\n>  File: mysql-bin.000001\n>  Position: 765\n\n\n\n### 从\n\n配置mysql.cnf\n\n```\n[mysqld]\nserver-id=2\n```\n\n备份\n\n```\nmysql -uroot -h 主 -p  database >back.sql;\n\n#登陆从库\nsource back.sql;\n\n```\n\n\n\n```\n\nstop slave;\n\nreset slave;\n\nreset master;\n\n```\n\n关键 \n\n把 show master status\\G `File`和`Position`对号入座\n\n```\n\n     CHANGE MASTER TO  \n\n     MASTER_HOST='master_host_name',\n\n     MASTER_USER='主用户名',\n\n     MASTER_PASSWORD='主密码',\n\n     MASTER_LOG_FILE='主status File',\n\n     MASTER_LOG_POS=主status Position;\n\n```\n\n开启从库\n\n```\nstart slave;\n```\n\n检查状态\n\n```\n\nshow slave status\\G\n\n```\n\n>Slave_IO_Running: Yes\n>\n>Slave_SQL_Running: Yes\n","slug":"services/database/mysql/my","published":1,"updated":"2022-09-03T14:35:41.261Z","__permalink":"services/database/mysql/my/","_id":"cl7g6gtu4004kgwi5hu1lcd5n","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"linux\"><a href=\"#linux\" class=\"headerlink\" title=\"linux\"></a>linux</h2><h3 id=\"my-cnf\"><a href=\"#my-cnf\" class=\"headerlink\" title=\"my.cnf\"></a>my.cnf</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">#server-id                      = 224</span><br><span class=\"line\">user = mysql</span><br><span class=\"line\">port                           = 3305</span><br><span class=\"line\">mysqlx_port                    = 33060</span><br><span class=\"line\">mysqlx_socket                  = /tmp/mysqlx.sock</span><br><span class=\"line\">datadir                        = /opt/mysql/data</span><br><span class=\"line\">socket                         = /tmp/mysql.sock</span><br><span class=\"line\">pid-file                       = /tmp/mysqld.pid</span><br><span class=\"line\">auto_increment_offset          = 2</span><br><span class=\"line\">auto_increment_increment       = 2 </span><br><span class=\"line\">log-error                      = /opt/mysql/log/error.log</span><br><span class=\"line\">slow-query-log                 = 1</span><br><span class=\"line\">slow-query-log-file            = /opt/mysql/log/slow.log</span><br><span class=\"line\">long_query_time                = 0.2</span><br><span class=\"line\">log-bin                        = bin.log</span><br><span class=\"line\">relay-log                      = relay.log</span><br><span class=\"line\">binlog_format                 =ROW</span><br><span class=\"line\">relay_log_recovery            = 1</span><br><span class=\"line\">character-set-client-handshake = FALSE</span><br><span class=\"line\">character-set-server           = utf8mb4</span><br><span class=\"line\">collation-server               = utf8mb4_unicode_ci</span><br><span class=\"line\">init_connect                   =&#x27;SET NAMES utf8mb4&#x27;</span><br><span class=\"line\">innodb_buffer_pool_size        = 1G</span><br><span class=\"line\">join_buffer_size               = 128M</span><br><span class=\"line\">sort_buffer_size               = 2M</span><br><span class=\"line\">read_rnd_buffer_size           = 2M</span><br><span class=\"line\">log_timestamps                 = SYSTEM</span><br><span class=\"line\">lower_case_table_names         = 1</span><br><span class=\"line\">default-authentication-plugin  =mysql_native_password</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"win\"><a href=\"#win\" class=\"headerlink\" title=\"win\"></a>win</h2><h3 id=\"my-ini\"><a href=\"#my-ini\" class=\"headerlink\" title=\"my.ini\"></a>my.ini</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[client]</span><br><span class=\"line\">port=3306</span><br><span class=\"line\"></span><br><span class=\"line\">[mysql]</span><br><span class=\"line\">default-character-set=utf8mb4</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">port=3306</span><br><span class=\"line\">#password=123456</span><br><span class=\"line\">#character-set-client-handshake=FALSE  </span><br><span class=\"line\">character-set-server=utf8mb4 </span><br><span class=\"line\">#collation-server = utf8mb4_general_ci  </span><br><span class=\"line\">init_connect=&#x27;SET NAMES utf8mb4&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">basedir=&quot;D:/360Downloads/mysql-5.7.20-winx64&quot;</span><br><span class=\"line\">#Path to the database root</span><br><span class=\"line\">datadir=&quot;D:/360Downloads/mysql-5.7.20-winx64/data&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">log-error=&quot;D:/360Downloads/mysql-5.7.20-winx64/log/mysqld_err.log&quot;</span><br><span class=\"line\">#log-bin=&quot;D:/360Downloads/mysql-5.7.20-winx64/log/mysqld_bin.bin&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">default-storage-engine=INNODB</span><br><span class=\"line\">#从 5.6开始，timestamp 的默认行为已经是 deprecated 了</span><br><span class=\"line\">explicit_defaults_for_timestamp=true</span><br><span class=\"line\"></span><br><span class=\"line\">sql_mode=&quot;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&quot; </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"主从\"><a href=\"#主从\" class=\"headerlink\" title=\"主从\"></a>主从</h2><p>doc <a href=\"https://dev.mysql.com/doc/refman/8.0/en/replication-howto-masterstatus.html\">https://dev.mysql.com/doc/refman/8.0/en/replication-howto-masterstatus.html</a></p>\n<p>新帐号</p>\n<blockquote>\n<p>CREATE USER ‘repl‘@’192.168.16.232’ IDENTIFIED BY ‘123456’;</p>\n</blockquote>\n<p> 只复制</p>\n<blockquote>\n<p>GRANT REPLICATION SLAVE ON <em>.</em> TO ‘repl‘@’192.168.16.232’;</p>\n</blockquote>\n<h3 id=\"主\"><a href=\"#主\" class=\"headerlink\" title=\"主\"></a>主</h3><p>配置mysql.cnf </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">server-id=1</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">show master status;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> File: mysql-bin.000001<br> Position: 765</p>\n</blockquote>\n<h3 id=\"从\"><a href=\"#从\" class=\"headerlink\" title=\"从\"></a>从</h3><p>配置mysql.cnf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">server-id=2</span><br></pre></td></tr></table></figure>\n\n<p>备份</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql -uroot -h 主 -p  database &gt;back.sql;</span><br><span class=\"line\"></span><br><span class=\"line\">#登陆从库</span><br><span class=\"line\">source back.sql;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">stop slave;</span><br><span class=\"line\"></span><br><span class=\"line\">reset slave;</span><br><span class=\"line\"></span><br><span class=\"line\">reset master;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>关键 </p>\n<p>把 show master status\\G <code>File</code>和<code>Position</code>对号入座</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">CHANGE MASTER TO  </span><br><span class=\"line\"></span><br><span class=\"line\">MASTER_HOST=&#x27;master_host_name&#x27;,</span><br><span class=\"line\"></span><br><span class=\"line\">MASTER_USER=&#x27;主用户名&#x27;,</span><br><span class=\"line\"></span><br><span class=\"line\">MASTER_PASSWORD=&#x27;主密码&#x27;,</span><br><span class=\"line\"></span><br><span class=\"line\">MASTER_LOG_FILE=&#x27;主status File&#x27;,</span><br><span class=\"line\"></span><br><span class=\"line\">MASTER_LOG_POS=主status Position;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>开启从库</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">start slave;</span><br></pre></td></tr></table></figure>\n\n<p>检查状态</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">show slave status\\G</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Slave_IO_Running: Yes</p>\n<p>Slave_SQL_Running: Yes</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"linux\"><a href=\"#linux\" class=\"headerlink\" title=\"linux\"></a>linux</h2><h3 id=\"my-cnf\"><a href=\"#my-cnf\" class=\"headerlink\" title=\"my.cnf\"></a>my.cnf</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">#server-id                      = 224</span><br><span class=\"line\">user = mysql</span><br><span class=\"line\">port                           = 3305</span><br><span class=\"line\">mysqlx_port                    = 33060</span><br><span class=\"line\">mysqlx_socket                  = /tmp/mysqlx.sock</span><br><span class=\"line\">datadir                        = /opt/mysql/data</span><br><span class=\"line\">socket                         = /tmp/mysql.sock</span><br><span class=\"line\">pid-file                       = /tmp/mysqld.pid</span><br><span class=\"line\">auto_increment_offset          = 2</span><br><span class=\"line\">auto_increment_increment       = 2 </span><br><span class=\"line\">log-error                      = /opt/mysql/log/error.log</span><br><span class=\"line\">slow-query-log                 = 1</span><br><span class=\"line\">slow-query-log-file            = /opt/mysql/log/slow.log</span><br><span class=\"line\">long_query_time                = 0.2</span><br><span class=\"line\">log-bin                        = bin.log</span><br><span class=\"line\">relay-log                      = relay.log</span><br><span class=\"line\">binlog_format                 =ROW</span><br><span class=\"line\">relay_log_recovery            = 1</span><br><span class=\"line\">character-set-client-handshake = FALSE</span><br><span class=\"line\">character-set-server           = utf8mb4</span><br><span class=\"line\">collation-server               = utf8mb4_unicode_ci</span><br><span class=\"line\">init_connect                   =&#x27;SET NAMES utf8mb4&#x27;</span><br><span class=\"line\">innodb_buffer_pool_size        = 1G</span><br><span class=\"line\">join_buffer_size               = 128M</span><br><span class=\"line\">sort_buffer_size               = 2M</span><br><span class=\"line\">read_rnd_buffer_size           = 2M</span><br><span class=\"line\">log_timestamps                 = SYSTEM</span><br><span class=\"line\">lower_case_table_names         = 1</span><br><span class=\"line\">default-authentication-plugin  =mysql_native_password</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"win\"><a href=\"#win\" class=\"headerlink\" title=\"win\"></a>win</h2><h3 id=\"my-ini\"><a href=\"#my-ini\" class=\"headerlink\" title=\"my.ini\"></a>my.ini</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[client]</span><br><span class=\"line\">port=3306</span><br><span class=\"line\"></span><br><span class=\"line\">[mysql]</span><br><span class=\"line\">default-character-set=utf8mb4</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">port=3306</span><br><span class=\"line\">#password=123456</span><br><span class=\"line\">#character-set-client-handshake=FALSE  </span><br><span class=\"line\">character-set-server=utf8mb4 </span><br><span class=\"line\">#collation-server = utf8mb4_general_ci  </span><br><span class=\"line\">init_connect=&#x27;SET NAMES utf8mb4&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">basedir=&quot;D:/360Downloads/mysql-5.7.20-winx64&quot;</span><br><span class=\"line\">#Path to the database root</span><br><span class=\"line\">datadir=&quot;D:/360Downloads/mysql-5.7.20-winx64/data&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">log-error=&quot;D:/360Downloads/mysql-5.7.20-winx64/log/mysqld_err.log&quot;</span><br><span class=\"line\">#log-bin=&quot;D:/360Downloads/mysql-5.7.20-winx64/log/mysqld_bin.bin&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">default-storage-engine=INNODB</span><br><span class=\"line\">#从 5.6开始，timestamp 的默认行为已经是 deprecated 了</span><br><span class=\"line\">explicit_defaults_for_timestamp=true</span><br><span class=\"line\"></span><br><span class=\"line\">sql_mode=&quot;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&quot; </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"主从\"><a href=\"#主从\" class=\"headerlink\" title=\"主从\"></a>主从</h2><p>doc <a href=\"https://dev.mysql.com/doc/refman/8.0/en/replication-howto-masterstatus.html\">https://dev.mysql.com/doc/refman/8.0/en/replication-howto-masterstatus.html</a></p>\n<p>新帐号</p>\n<blockquote>\n<p>CREATE USER ‘repl‘@’192.168.16.232’ IDENTIFIED BY ‘123456’;</p>\n</blockquote>\n<p> 只复制</p>\n<blockquote>\n<p>GRANT REPLICATION SLAVE ON <em>.</em> TO ‘repl‘@’192.168.16.232’;</p>\n</blockquote>\n<h3 id=\"主\"><a href=\"#主\" class=\"headerlink\" title=\"主\"></a>主</h3><p>配置mysql.cnf </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">server-id=1</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">show master status;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p> File: mysql-bin.000001<br> Position: 765</p>\n</blockquote>\n<h3 id=\"从\"><a href=\"#从\" class=\"headerlink\" title=\"从\"></a>从</h3><p>配置mysql.cnf</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">server-id=2</span><br></pre></td></tr></table></figure>\n\n<p>备份</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql -uroot -h 主 -p  database &gt;back.sql;</span><br><span class=\"line\"></span><br><span class=\"line\">#登陆从库</span><br><span class=\"line\">source back.sql;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">stop slave;</span><br><span class=\"line\"></span><br><span class=\"line\">reset slave;</span><br><span class=\"line\"></span><br><span class=\"line\">reset master;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>关键 </p>\n<p>把 show master status\\G <code>File</code>和<code>Position</code>对号入座</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">CHANGE MASTER TO  </span><br><span class=\"line\"></span><br><span class=\"line\">MASTER_HOST=&#x27;master_host_name&#x27;,</span><br><span class=\"line\"></span><br><span class=\"line\">MASTER_USER=&#x27;主用户名&#x27;,</span><br><span class=\"line\"></span><br><span class=\"line\">MASTER_PASSWORD=&#x27;主密码&#x27;,</span><br><span class=\"line\"></span><br><span class=\"line\">MASTER_LOG_FILE=&#x27;主status File&#x27;,</span><br><span class=\"line\"></span><br><span class=\"line\">MASTER_LOG_POS=主status Position;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>开启从库</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">start slave;</span><br></pre></td></tr></table></figure>\n\n<p>检查状态</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">show slave status\\G</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Slave_IO_Running: Yes</p>\n<p>Slave_SQL_Running: Yes</p>\n</blockquote>\n"},{"title":"redis集群","date":"2022-07-17T13:04:54.000Z","_content":"","source":"_posts/services/database/redis/redis-cluster.md","raw":"---\ntitle: redis集群\npermalink: services/database/redis/redis-cluster/\ntags:\n  - redis-cluster\ncategories:\n  - services\n  - database\n  - redis\ndate: 2022-07-17 21:04:54\n---\n","slug":"services/database/redis/redis-cluster","published":1,"updated":"2022-08-28T09:10:00.936Z","__permalink":"services/database/redis/redis-cluster/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7g6gtu5004mgwi5ddvv4v90","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"jpa","date":"2022-09-01T13:32:59.000Z","_content":"\n \n\n## database面板\n\n### 自动生成实体类\n\n\n\n<img src=\"/pics/6fda574f-0050-43f7-84b2-e281a0b62989.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" />\n\n  \n\n### <span wiz-span=\"data-wiz-span\" style=\"font-size: 1rem;\">连接数据库</span>\n\n<!--more-->\n\n<img src=\"/pics/6a7e416d-f5a0-4558-8737-6a2c90ff0515.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" />\n\n  \n\n## Persistence面板\n\n<span\nstyle=\"color:rgb(47, 47, 47);font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size:1rem;font-style:normal;font-weight:400;text-align:start;text-indent:0px;background-color:rgb(255, 255, 255);display:inline !important;\"><span\nstyle=\"color:rgb(47, 47, 47);font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size:1rem;font-style:normal;font-weight:400;text-align:start;text-indent:0px;background-color:rgb(255, 255, 255);display:inline !important;\">位置是View-Tool\nWindows- Persistence （如果找不到）</span>  \n</span>\n\n<span\nstyle=\"color:rgb(47, 47, 47);font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size:1rem;font-style:normal;font-weight:400;text-align:start;text-indent:0px;background-color:rgb(255, 255, 255);display:inline !important;\"><span\nstyle=\"color:rgb(47, 47, 47);font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size:1rem;font-style:normal;font-weight:400;text-align:start;text-indent:0px;background-color:rgb(255, 255, 255);display:inline !important;\">-------先选中项目在点 <span\nwiz-span=\"data-wiz-span\"\nstyle=\"color: rgb(50, 205, 50);\">+</span></span></span>\n\n<img src=\"/pics/d4853c95-e416-4ffe-b0c9-e8d921971a0e.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" />\n\n  \n\n**spring boot  选择 jpa   选错没有 session factory**\n\n<span\nstyle=\"color: rgb(47, 47, 47); font-family: -apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 1rem; font-style: normal; text-align: start; text-indent: 0px; display: inline !important; background-color: rgb(255, 255, 255);\">**hibernate\n项目选择 hibernate  **</span>\n\n### <span style=\"color:rgb(47, 47, 47);font-family:-apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-size:1rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;display:inline !important;background-color:rgb(255, 255, 255);\">Persistence<span class=\"Apple-converted-space\"> 最下面</span></span> \n\n<span\nstyle=\"color:rgb(47, 47, 47);font-family:-apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-size:1rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;display:inline !important;background-color:rgb(255, 255, 255);\"><span\nclass=\"Apple-converted-space\">hibernate</span></span>\n\n<img src=\"/pics/11d578d1-b5cf-4f49-8623-aab65adb0837.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" />\n\n选择数据 ，表\n\n<img src=\"/pics/1cb72990-ff22-4fae-a1ee-3d03e9edf07c.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" />\n\njpa\n\n<img src=\"/pics/5541b376-5ba9-4fa7-bd9e-8ca929bae9e1.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" />\n\n  \n\n<img src=\"/pics/30c314a6-b022-4758-9b80-a152853dd1c5.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" />\n\n点击ok 生成 实体到指定 package\n\n \n\n\n\n\n\n","source":"_posts/tool/codetool/idea-jpa.md","raw":"---\ntitle: jpa\npermalink: tool/codetool/idea-jpa/\ntags:\n  - jpa\ncategories:\n  - tool\n  - idea\ndate: 2022-09-01 21:32:59\n---\n\n \n\n## database面板\n\n### 自动生成实体类\n\n\n\n<img src=\"/pics/6fda574f-0050-43f7-84b2-e281a0b62989.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" />\n\n  \n\n### <span wiz-span=\"data-wiz-span\" style=\"font-size: 1rem;\">连接数据库</span>\n\n<!--more-->\n\n<img src=\"/pics/6a7e416d-f5a0-4558-8737-6a2c90ff0515.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" />\n\n  \n\n## Persistence面板\n\n<span\nstyle=\"color:rgb(47, 47, 47);font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size:1rem;font-style:normal;font-weight:400;text-align:start;text-indent:0px;background-color:rgb(255, 255, 255);display:inline !important;\"><span\nstyle=\"color:rgb(47, 47, 47);font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size:1rem;font-style:normal;font-weight:400;text-align:start;text-indent:0px;background-color:rgb(255, 255, 255);display:inline !important;\">位置是View-Tool\nWindows- Persistence （如果找不到）</span>  \n</span>\n\n<span\nstyle=\"color:rgb(47, 47, 47);font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size:1rem;font-style:normal;font-weight:400;text-align:start;text-indent:0px;background-color:rgb(255, 255, 255);display:inline !important;\"><span\nstyle=\"color:rgb(47, 47, 47);font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size:1rem;font-style:normal;font-weight:400;text-align:start;text-indent:0px;background-color:rgb(255, 255, 255);display:inline !important;\">-------先选中项目在点 <span\nwiz-span=\"data-wiz-span\"\nstyle=\"color: rgb(50, 205, 50);\">+</span></span></span>\n\n<img src=\"/pics/d4853c95-e416-4ffe-b0c9-e8d921971a0e.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" />\n\n  \n\n**spring boot  选择 jpa   选错没有 session factory**\n\n<span\nstyle=\"color: rgb(47, 47, 47); font-family: -apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 1rem; font-style: normal; text-align: start; text-indent: 0px; display: inline !important; background-color: rgb(255, 255, 255);\">**hibernate\n项目选择 hibernate  **</span>\n\n### <span style=\"color:rgb(47, 47, 47);font-family:-apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-size:1rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;display:inline !important;background-color:rgb(255, 255, 255);\">Persistence<span class=\"Apple-converted-space\"> 最下面</span></span> \n\n<span\nstyle=\"color:rgb(47, 47, 47);font-family:-apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-size:1rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;display:inline !important;background-color:rgb(255, 255, 255);\"><span\nclass=\"Apple-converted-space\">hibernate</span></span>\n\n<img src=\"/pics/11d578d1-b5cf-4f49-8623-aab65adb0837.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" />\n\n选择数据 ，表\n\n<img src=\"/pics/1cb72990-ff22-4fae-a1ee-3d03e9edf07c.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" />\n\njpa\n\n<img src=\"/pics/5541b376-5ba9-4fa7-bd9e-8ca929bae9e1.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" />\n\n  \n\n<img src=\"/pics/30c314a6-b022-4758-9b80-a152853dd1c5.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" />\n\n点击ok 生成 实体到指定 package\n\n \n\n\n\n\n\n","slug":"tool/codetool/idea-jpa","published":1,"updated":"2022-09-01T13:38:43.909Z","__permalink":"tool/codetool/idea-jpa/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7j3sxe30000lri5hcwzg3l6","content":"<h2 id=\"database面板\"><a href=\"#database面板\" class=\"headerlink\" title=\"database面板\"></a>database面板</h2><h3 id=\"自动生成实体类\"><a href=\"#自动生成实体类\" class=\"headerlink\" title=\"自动生成实体类\"></a>自动生成实体类</h3><p><img src=\"/pics/6fda574f-0050-43f7-84b2-e281a0b62989.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" /></p>\n<h3 id=\"连接数据库\"><a href=\"#连接数据库\" class=\"headerlink\" title=\"连接数据库\"></a><span wiz-span=\"data-wiz-span\" style=\"font-size: 1rem;\">连接数据库</span></h3><span id=\"more\"></span>\n\n<p><img src=\"/pics/6a7e416d-f5a0-4558-8737-6a2c90ff0515.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" /></p>\n<h2 id=\"Persistence面板\"><a href=\"#Persistence面板\" class=\"headerlink\" title=\"Persistence面板\"></a>Persistence面板</h2><p><span\nstyle=\"color:rgb(47, 47, 47);font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size:1rem;font-style:normal;font-weight:400;text-align:start;text-indent:0px;background-color:rgb(255, 255, 255);display:inline !important;\"><span\nstyle=\"color:rgb(47, 47, 47);font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size:1rem;font-style:normal;font-weight:400;text-align:start;text-indent:0px;background-color:rgb(255, 255, 255);display:inline !important;\">位置是View-Tool<br>Windows- Persistence （如果找不到）</span><br></span></p>\n<p><span\nstyle=\"color:rgb(47, 47, 47);font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size:1rem;font-style:normal;font-weight:400;text-align:start;text-indent:0px;background-color:rgb(255, 255, 255);display:inline !important;\"><span\nstyle=\"color:rgb(47, 47, 47);font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size:1rem;font-style:normal;font-weight:400;text-align:start;text-indent:0px;background-color:rgb(255, 255, 255);display:inline !important;\">——-先选中项目在点 <span\nwiz-span=\"data-wiz-span\"\nstyle=\"color: rgb(50, 205, 50);\">+</span></span></span></p>\n<p><img src=\"/pics/d4853c95-e416-4ffe-b0c9-e8d921971a0e.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" /></p>\n<p><strong>spring boot  选择 jpa   选错没有 session factory</strong></p>\n<p><span\nstyle=\"color: rgb(47, 47, 47); font-family: -apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 1rem; font-style: normal; text-align: start; text-indent: 0px; display: inline !important; background-color: rgb(255, 255, 255);\">**hibernate<br>项目选择 hibernate  **</span></p>\n<h3 id=\"Persistence-最下面\"><a href=\"#Persistence-最下面\" class=\"headerlink\" title=\"Persistence 最下面\"></a><span style=\"color:rgb(47, 47, 47);font-family:-apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-size:1rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;display:inline !important;background-color:rgb(255, 255, 255);\">Persistence<span class=\"Apple-converted-space\"> 最下面</span></span></h3><p><span\nstyle=\"color:rgb(47, 47, 47);font-family:-apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-size:1rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;display:inline !important;background-color:rgb(255, 255, 255);\"><span\nclass=\"Apple-converted-space\">hibernate</span></span></p>\n<p><img src=\"/pics/11d578d1-b5cf-4f49-8623-aab65adb0837.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" /></p>\n<p>选择数据 ，表</p>\n<p><img src=\"/pics/1cb72990-ff22-4fae-a1ee-3d03e9edf07c.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" /></p>\n<p>jpa</p>\n<p><img src=\"/pics/5541b376-5ba9-4fa7-bd9e-8ca929bae9e1.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" /></p>\n<p><img src=\"/pics/30c314a6-b022-4758-9b80-a152853dd1c5.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" /></p>\n<p>点击ok 生成 实体到指定 package</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"database面板\"><a href=\"#database面板\" class=\"headerlink\" title=\"database面板\"></a>database面板</h2><h3 id=\"自动生成实体类\"><a href=\"#自动生成实体类\" class=\"headerlink\" title=\"自动生成实体类\"></a>自动生成实体类</h3><p><img src=\"/pics/6fda574f-0050-43f7-84b2-e281a0b62989.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" /></p>\n<h3 id=\"连接数据库\"><a href=\"#连接数据库\" class=\"headerlink\" title=\"连接数据库\"></a><span wiz-span=\"data-wiz-span\" style=\"font-size: 1rem;\">连接数据库</span></h3>","more":"<p><img src=\"/pics/6a7e416d-f5a0-4558-8737-6a2c90ff0515.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" /></p>\n<h2 id=\"Persistence面板\"><a href=\"#Persistence面板\" class=\"headerlink\" title=\"Persistence面板\"></a>Persistence面板</h2><p><span\nstyle=\"color:rgb(47, 47, 47);font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size:1rem;font-style:normal;font-weight:400;text-align:start;text-indent:0px;background-color:rgb(255, 255, 255);display:inline !important;\"><span\nstyle=\"color:rgb(47, 47, 47);font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size:1rem;font-style:normal;font-weight:400;text-align:start;text-indent:0px;background-color:rgb(255, 255, 255);display:inline !important;\">位置是View-Tool<br>Windows- Persistence （如果找不到）</span><br></span></p>\n<p><span\nstyle=\"color:rgb(47, 47, 47);font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size:1rem;font-style:normal;font-weight:400;text-align:start;text-indent:0px;background-color:rgb(255, 255, 255);display:inline !important;\"><span\nstyle=\"color:rgb(47, 47, 47);font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size:1rem;font-style:normal;font-weight:400;text-align:start;text-indent:0px;background-color:rgb(255, 255, 255);display:inline !important;\">——-先选中项目在点 <span\nwiz-span=\"data-wiz-span\"\nstyle=\"color: rgb(50, 205, 50);\">+</span></span></span></p>\n<p><img src=\"/pics/d4853c95-e416-4ffe-b0c9-e8d921971a0e.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" /></p>\n<p><strong>spring boot  选择 jpa   选错没有 session factory</strong></p>\n<p><span\nstyle=\"color: rgb(47, 47, 47); font-family: -apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 1rem; font-style: normal; text-align: start; text-indent: 0px; display: inline !important; background-color: rgb(255, 255, 255);\">**hibernate<br>项目选择 hibernate  **</span></p>\n<h3 id=\"Persistence-最下面\"><a href=\"#Persistence-最下面\" class=\"headerlink\" title=\"Persistence 最下面\"></a><span style=\"color:rgb(47, 47, 47);font-family:-apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-size:1rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;display:inline !important;background-color:rgb(255, 255, 255);\">Persistence<span class=\"Apple-converted-space\"> 最下面</span></span></h3><p><span\nstyle=\"color:rgb(47, 47, 47);font-family:-apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-size:1rem;font-style:normal;font-weight:normal;text-align:start;text-indent:0px;display:inline !important;background-color:rgb(255, 255, 255);\"><span\nclass=\"Apple-converted-space\">hibernate</span></span></p>\n<p><img src=\"/pics/11d578d1-b5cf-4f49-8623-aab65adb0837.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" /></p>\n<p>选择数据 ，表</p>\n<p><img src=\"/pics/1cb72990-ff22-4fae-a1ee-3d03e9edf07c.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" /></p>\n<p>jpa</p>\n<p><img src=\"/pics/5541b376-5ba9-4fa7-bd9e-8ca929bae9e1.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" /></p>\n<p><img src=\"/pics/30c314a6-b022-4758-9b80-a152853dd1c5.png\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" /></p>\n<p>点击ok 生成 实体到指定 package</p>"},{"title":"Sublime中文","date":"2022-09-01T12:59:31.000Z","_content":"\n### 无法输入中文\n\ngit<span\nstyle=\"font-size: 15px;\"> </span><a href=\"https://github.com/lyfeyaj/sublime-text-imfix\"\ndata-_src=\"https://github.com/lyfeyaj/sublime-text-imfix\"\nstyle=\"font-size: 15px; text-decoration: underline;\"><span\nstyle=\"font-size: 15px;\">https://github.com/lyfeyaj/sublime-text-imfix</span></a>\n\n忽略编译（已编译）\n\n<span style=\"font-size: 15px;\">sublime-imfix.c\n下面命令编译生成 libsublime-imfix.so</span>\n\n``` prettyprint\ngcc -shared -o libsublime-imfix.so sublime_imfix.c  `pkg-config --libs --cflags gtk+-2.0` -fPIC\n```\n\n<!--more-->\n\ncopy安装目录  \n\n``` prettyprint\nsudo mv libsublime-imfix.so /opt/sublime_text/\n```\n\n<img src=\"/pics/450575164.png\" data-border=\"0\"\ndata-_src=\"/pics/450575164.png\" />\n\n  \n\n### 命令行启动输入中文\n\n/usr/bin/subl\n\n``` prettyprint\nexec /opt/sublime_text/sublime_text \"$@\"    \n替换为\nLD_PRELOAD=/opt/sublime_text/libsublime-imfix.so exec /opt/sublime_text/sublime_text \"$@\"\n```\n\n  \n\n### 菜单栏打开输入中文\n\n<span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">修改文件sublime_text.desktop的内容</span>\n\n<img src=\"/pics/1133594981.png\" data-border=\"0\"/>\n\n<span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">  将\\[Desktop\nEntry\\]中的字符串</span>  \n<span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">  \n Exec=/opt/sublime_text/sublime_text %F</span>  \n<span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">  \n 修改为</span>  \n\n``` prettyprint\n    Exec=bash -c \"LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so exec /opt/sublime_text/sublime_text %F\"\n```\n\n<span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">  \n 将\\[Desktop Action Window\\]中的字符串</span>  \n<span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">  \n Exec=/opt/sublime_text/sublime_text -n</span>  \n<span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">  \n 修改为</span>  \n\n``` prettyprint\n    Exec=bash -c \"LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so exec /opt/sublime_text/sublime_text -n\"\n```\n\n<span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">  \n 将\\[Desktop Action Document\\]中的字符串</span>  \n<span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">  \n Exec=/opt/sublime_text/sublime_text --command new_file</span>  \n<span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">  \n 修改为</span>  \n\n``` prettyprint\n   Exec=bash -c \"LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so exec /opt/sublime_text/sublime_text --command new_file\"\n```\n\n  \n\n中文界面\n\n<span\nstyle=\"font-size: 15px;\"> <a href=\"https://packagecontrol.io/installation#Simple\"\ndata-_src=\"https://packagecontrol.io/installation#Simple\">https://packagecontrol.io/installation#Simple</a>\n</span>\n\n<span style=\"font-size: 15px;\">下载 <span\nstyle=\"color: rgb(111, 146, 186); text-decoration: none; font-family: Consolas, 'Driod Sans Mono', monospace; font-size: 15px; white-space: normal;\"><span\nstyle=\"\"><a href=\"https://packagecontrol.io/Package%20Control.sublime-package\"\nstyle=\"color: rgb(111, 146, 186); text-decoration: none; font-family: Consolas, &#39;Driod Sans Mono&#39;, monospace; font-size: 15px; white-space: normal;\">Package\nControl.sublime-package</a> </span></span><a href=\"https://packagecontrol.io/Package%20Control.sublime-package\"\ndata-_src=\"https://packagecontrol.io/Package%20Control.sublime-package\">https://packagecontrol.io/Package%20Control.sublime-package</a>\n</span>\n\n<span\nstyle=\"color: rgb(85, 85, 85); font-family: Helvetica, Arial, Verdana, sans-serif; font-size: 15px;\"> 点击 </span><span\nclass=\"menu\"\nstyle=\"border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(243, 243, 243); padding: 1px 4px; text-shadow: rgb(255, 255, 255) 0px 1px 0px; color: rgb(85, 85, 85); font-family: Helvetica, Arial, Verdana, sans-serif; font-size: 15px;\">Preferences *\\>* Browse\nPackages</span>\n\n进入目录软件\n\n1.  Download <a href=\"https://packagecontrol.io/Package%20Control.sublime-package\"\n    style=\"color: rgb(111, 146, 186); text-decoration: none;\">Package\n    Control.sublime-package</a> and copy it into the Installed\n    Packages/ directory\n\n2.  重启生效  \n\n3.  <span\n    style=\"color: rgb(51, 51, 51); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\">点击Preferences/Package\n    Control，然后输入Package Control：<span\n    style=\"color: rgb(255, 0, 0); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\">Install Package</span></span>\n\n4.  <span\n    style=\"color: rgb(51, 51, 51); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\"><span\n    style=\"color: rgb(255, 0, 0); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\"><span\n    style=\"color: rgb(51, 51, 51); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify; white-space: normal;\">然后在弹出的命令界面，输入Chinese，选择ChineseLocalization</span></span></span>\n\n5.  <span\n    style=\"color: rgb(51, 51, 51); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\"><span\n    style=\"color: rgb(255, 0, 0); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\"><span\n    style=\"color: rgb(51, 51, 51); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify; white-space: normal;\">安装成功</span></span></span>  \n\n  \n\n\n\n","source":"_posts/tool/codetool/sublime01.md","raw":"---\ntitle: Sublime中文\npermalink: tool/codetool/sublime01/\ntags:\n  - 中文\n  - zh-cn\n  - linux\ncategories:\n  - tool\n  - sublime\ndate: 2022-09-01 20:59:31\n---\n\n### 无法输入中文\n\ngit<span\nstyle=\"font-size: 15px;\"> </span><a href=\"https://github.com/lyfeyaj/sublime-text-imfix\"\ndata-_src=\"https://github.com/lyfeyaj/sublime-text-imfix\"\nstyle=\"font-size: 15px; text-decoration: underline;\"><span\nstyle=\"font-size: 15px;\">https://github.com/lyfeyaj/sublime-text-imfix</span></a>\n\n忽略编译（已编译）\n\n<span style=\"font-size: 15px;\">sublime-imfix.c\n下面命令编译生成 libsublime-imfix.so</span>\n\n``` prettyprint\ngcc -shared -o libsublime-imfix.so sublime_imfix.c  `pkg-config --libs --cflags gtk+-2.0` -fPIC\n```\n\n<!--more-->\n\ncopy安装目录  \n\n``` prettyprint\nsudo mv libsublime-imfix.so /opt/sublime_text/\n```\n\n<img src=\"/pics/450575164.png\" data-border=\"0\"\ndata-_src=\"/pics/450575164.png\" />\n\n  \n\n### 命令行启动输入中文\n\n/usr/bin/subl\n\n``` prettyprint\nexec /opt/sublime_text/sublime_text \"$@\"    \n替换为\nLD_PRELOAD=/opt/sublime_text/libsublime-imfix.so exec /opt/sublime_text/sublime_text \"$@\"\n```\n\n  \n\n### 菜单栏打开输入中文\n\n<span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">修改文件sublime_text.desktop的内容</span>\n\n<img src=\"/pics/1133594981.png\" data-border=\"0\"/>\n\n<span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">  将\\[Desktop\nEntry\\]中的字符串</span>  \n<span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">  \n Exec=/opt/sublime_text/sublime_text %F</span>  \n<span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">  \n 修改为</span>  \n\n``` prettyprint\n    Exec=bash -c \"LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so exec /opt/sublime_text/sublime_text %F\"\n```\n\n<span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">  \n 将\\[Desktop Action Window\\]中的字符串</span>  \n<span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">  \n Exec=/opt/sublime_text/sublime_text -n</span>  \n<span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">  \n 修改为</span>  \n\n``` prettyprint\n    Exec=bash -c \"LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so exec /opt/sublime_text/sublime_text -n\"\n```\n\n<span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">  \n 将\\[Desktop Action Document\\]中的字符串</span>  \n<span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">  \n Exec=/opt/sublime_text/sublime_text --command new_file</span>  \n<span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">  \n 修改为</span>  \n\n``` prettyprint\n   Exec=bash -c \"LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so exec /opt/sublime_text/sublime_text --command new_file\"\n```\n\n  \n\n中文界面\n\n<span\nstyle=\"font-size: 15px;\"> <a href=\"https://packagecontrol.io/installation#Simple\"\ndata-_src=\"https://packagecontrol.io/installation#Simple\">https://packagecontrol.io/installation#Simple</a>\n</span>\n\n<span style=\"font-size: 15px;\">下载 <span\nstyle=\"color: rgb(111, 146, 186); text-decoration: none; font-family: Consolas, 'Driod Sans Mono', monospace; font-size: 15px; white-space: normal;\"><span\nstyle=\"\"><a href=\"https://packagecontrol.io/Package%20Control.sublime-package\"\nstyle=\"color: rgb(111, 146, 186); text-decoration: none; font-family: Consolas, &#39;Driod Sans Mono&#39;, monospace; font-size: 15px; white-space: normal;\">Package\nControl.sublime-package</a> </span></span><a href=\"https://packagecontrol.io/Package%20Control.sublime-package\"\ndata-_src=\"https://packagecontrol.io/Package%20Control.sublime-package\">https://packagecontrol.io/Package%20Control.sublime-package</a>\n</span>\n\n<span\nstyle=\"color: rgb(85, 85, 85); font-family: Helvetica, Arial, Verdana, sans-serif; font-size: 15px;\"> 点击 </span><span\nclass=\"menu\"\nstyle=\"border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(243, 243, 243); padding: 1px 4px; text-shadow: rgb(255, 255, 255) 0px 1px 0px; color: rgb(85, 85, 85); font-family: Helvetica, Arial, Verdana, sans-serif; font-size: 15px;\">Preferences *\\>* Browse\nPackages</span>\n\n进入目录软件\n\n1.  Download <a href=\"https://packagecontrol.io/Package%20Control.sublime-package\"\n    style=\"color: rgb(111, 146, 186); text-decoration: none;\">Package\n    Control.sublime-package</a> and copy it into the Installed\n    Packages/ directory\n\n2.  重启生效  \n\n3.  <span\n    style=\"color: rgb(51, 51, 51); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\">点击Preferences/Package\n    Control，然后输入Package Control：<span\n    style=\"color: rgb(255, 0, 0); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\">Install Package</span></span>\n\n4.  <span\n    style=\"color: rgb(51, 51, 51); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\"><span\n    style=\"color: rgb(255, 0, 0); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\"><span\n    style=\"color: rgb(51, 51, 51); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify; white-space: normal;\">然后在弹出的命令界面，输入Chinese，选择ChineseLocalization</span></span></span>\n\n5.  <span\n    style=\"color: rgb(51, 51, 51); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\"><span\n    style=\"color: rgb(255, 0, 0); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\"><span\n    style=\"color: rgb(51, 51, 51); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify; white-space: normal;\">安装成功</span></span></span>  \n\n  \n\n\n\n","slug":"tool/codetool/sublime01","published":1,"updated":"2022-09-01T13:23:24.117Z","__permalink":"tool/codetool/sublime01/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7j3sxe60001lri58dwt96i1","content":"<h3 id=\"无法输入中文\"><a href=\"#无法输入中文\" class=\"headerlink\" title=\"无法输入中文\"></a>无法输入中文</h3><p>git<span\nstyle=\"font-size: 15px;\"> </span><a href=\"https://github.com/lyfeyaj/sublime-text-imfix\"\ndata-_src=\"https://github.com/lyfeyaj/sublime-text-imfix\"\nstyle=\"font-size: 15px; text-decoration: underline;\"><span\nstyle=\"font-size: 15px;\">https://github.com/lyfeyaj/sublime-text-imfix</span></a></p>\n<p>忽略编译（已编译）</p>\n<p><span style=\"font-size: 15px;\">sublime-imfix.c<br>下面命令编译生成 libsublime-imfix.so</span></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gcc -shared -o libsublime-imfix.so sublime_imfix.c  `pkg-config --libs --cflags gtk+-2.0` -fPIC</span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n<p>copy安装目录  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mv libsublime-imfix.so /opt/sublime_text/</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/pics/450575164.png\" data-border=\"0\"\ndata-_src=\"/pics/450575164.png\" /></p>\n<h3 id=\"命令行启动输入中文\"><a href=\"#命令行启动输入中文\" class=\"headerlink\" title=\"命令行启动输入中文\"></a>命令行启动输入中文</h3><p>&#x2F;usr&#x2F;bin&#x2F;subl</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">exec /opt/sublime_text/sublime_text &quot;$@&quot;    </span><br><span class=\"line\">替换为</span><br><span class=\"line\">LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so exec /opt/sublime_text/sublime_text &quot;$@&quot;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"菜单栏打开输入中文\"><a href=\"#菜单栏打开输入中文\" class=\"headerlink\" title=\"菜单栏打开输入中文\"></a>菜单栏打开输入中文</h3><p><span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">修改文件sublime_text.desktop的内容</span></p>\n<img src=\"/pics/1133594981.png\" data-border=\"0\"/>\n\n<p><span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">  将[Desktop<br>Entry]中的字符串</span><br><span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\"><br> Exec&#x3D;&#x2F;opt&#x2F;sublime_text&#x2F;sublime_text %F</span><br><span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\"><br> 修改为</span>  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Exec=bash -c &quot;LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so exec /opt/sublime_text/sublime_text %F&quot;</span><br></pre></td></tr></table></figure>\n\n<p><span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\"><br> 将[Desktop Action Window]中的字符串</span><br><span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\"><br> Exec&#x3D;&#x2F;opt&#x2F;sublime_text&#x2F;sublime_text -n</span><br><span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\"><br> 修改为</span>  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Exec=bash -c &quot;LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so exec /opt/sublime_text/sublime_text -n&quot;</span><br></pre></td></tr></table></figure>\n\n<p><span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\"><br> 将[Desktop Action Document]中的字符串</span><br><span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\"><br> Exec&#x3D;&#x2F;opt&#x2F;sublime_text&#x2F;sublime_text –command new_file</span><br><span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\"><br> 修改为</span>  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Exec=bash -c &quot;LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so exec /opt/sublime_text/sublime_text --command new_file&quot;</span><br></pre></td></tr></table></figure>\n\n<p>中文界面</p>\n<p><span\nstyle=\"font-size: 15px;\"> <a href=\"https://packagecontrol.io/installation#Simple\"\ndata-_src=\"https://packagecontrol.io/installation#Simple\">https://packagecontrol.io/installation#Simple</a><br></span></p>\n<p><span style=\"font-size: 15px;\">下载 <span\nstyle=\"color: rgb(111, 146, 186); text-decoration: none; font-family: Consolas, 'Driod Sans Mono', monospace; font-size: 15px; white-space: normal;\"><span\nstyle=\"\"><a href=\"https://packagecontrol.io/Package%20Control.sublime-package\"\nstyle=\"color: rgb(111, 146, 186); text-decoration: none; font-family: Consolas, &#39;Driod Sans Mono&#39;, monospace; font-size: 15px; white-space: normal;\">Package<br>Control.sublime-package</a> </span></span><a href=\"https://packagecontrol.io/Package%20Control.sublime-package\"\ndata-_src=\"https://packagecontrol.io/Package%20Control.sublime-package\">https://packagecontrol.io/Package%20Control.sublime-package</a><br></span></p>\n<p><span\nstyle=\"color: rgb(85, 85, 85); font-family: Helvetica, Arial, Verdana, sans-serif; font-size: 15px;\"> 点击 </span><span\nclass=\"menu\"\nstyle=\"border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(243, 243, 243); padding: 1px 4px; text-shadow: rgb(255, 255, 255) 0px 1px 0px; color: rgb(85, 85, 85); font-family: Helvetica, Arial, Verdana, sans-serif; font-size: 15px;\">Preferences <em>&gt;</em> Browse<br>Packages</span></p>\n<p>进入目录软件</p>\n<ol>\n<li><p>Download <a href=\"https://packagecontrol.io/Package%20Control.sublime-package\"\nstyle=\"color: rgb(111, 146, 186); text-decoration: none;\">Package<br>Control.sublime-package</a> and copy it into the Installed<br>Packages&#x2F; directory</p>\n</li>\n<li><p>重启生效  </p>\n</li>\n<li><p><span\nstyle=\"color: rgb(51, 51, 51); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\">点击Preferences&#x2F;Package<br>Control，然后输入Package Control：<span\nstyle=\"color: rgb(255, 0, 0); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\">Install Package</span></span></p>\n</li>\n<li><p><span\nstyle=\"color: rgb(51, 51, 51); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\"><span\nstyle=\"color: rgb(255, 0, 0); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\"><span\nstyle=\"color: rgb(51, 51, 51); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify; white-space: normal;\">然后在弹出的命令界面，输入Chinese，选择ChineseLocalization</span></span></span></p>\n</li>\n<li><p><span\nstyle=\"color: rgb(51, 51, 51); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\"><span\nstyle=\"color: rgb(255, 0, 0); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\"><span\nstyle=\"color: rgb(51, 51, 51); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify; white-space: normal;\">安装成功</span></span></span></p>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"<h3 id=\"无法输入中文\"><a href=\"#无法输入中文\" class=\"headerlink\" title=\"无法输入中文\"></a>无法输入中文</h3><p>git<span\nstyle=\"font-size: 15px;\"> </span><a href=\"https://github.com/lyfeyaj/sublime-text-imfix\"\ndata-_src=\"https://github.com/lyfeyaj/sublime-text-imfix\"\nstyle=\"font-size: 15px; text-decoration: underline;\"><span\nstyle=\"font-size: 15px;\">https://github.com/lyfeyaj/sublime-text-imfix</span></a></p>\n<p>忽略编译（已编译）</p>\n<p><span style=\"font-size: 15px;\">sublime-imfix.c<br>下面命令编译生成 libsublime-imfix.so</span></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gcc -shared -o libsublime-imfix.so sublime_imfix.c  `pkg-config --libs --cflags gtk+-2.0` -fPIC</span><br></pre></td></tr></table></figure>","more":"<p>copy安装目录  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mv libsublime-imfix.so /opt/sublime_text/</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/pics/450575164.png\" data-border=\"0\"\ndata-_src=\"/pics/450575164.png\" /></p>\n<h3 id=\"命令行启动输入中文\"><a href=\"#命令行启动输入中文\" class=\"headerlink\" title=\"命令行启动输入中文\"></a>命令行启动输入中文</h3><p>&#x2F;usr&#x2F;bin&#x2F;subl</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">exec /opt/sublime_text/sublime_text &quot;$@&quot;    </span><br><span class=\"line\">替换为</span><br><span class=\"line\">LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so exec /opt/sublime_text/sublime_text &quot;$@&quot;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"菜单栏打开输入中文\"><a href=\"#菜单栏打开输入中文\" class=\"headerlink\" title=\"菜单栏打开输入中文\"></a>菜单栏打开输入中文</h3><p><span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">修改文件sublime_text.desktop的内容</span></p>\n<img src=\"/pics/1133594981.png\" data-border=\"0\"/>\n\n<p><span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\">  将[Desktop<br>Entry]中的字符串</span><br><span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\"><br> Exec&#x3D;&#x2F;opt&#x2F;sublime_text&#x2F;sublime_text %F</span><br><span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\"><br> 修改为</span>  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Exec=bash -c &quot;LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so exec /opt/sublime_text/sublime_text %F&quot;</span><br></pre></td></tr></table></figure>\n\n<p><span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\"><br> 将[Desktop Action Window]中的字符串</span><br><span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\"><br> Exec&#x3D;&#x2F;opt&#x2F;sublime_text&#x2F;sublime_text -n</span><br><span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\"><br> 修改为</span>  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Exec=bash -c &quot;LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so exec /opt/sublime_text/sublime_text -n&quot;</span><br></pre></td></tr></table></figure>\n\n<p><span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\"><br> 将[Desktop Action Document]中的字符串</span><br><span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\"><br> Exec&#x3D;&#x2F;opt&#x2F;sublime_text&#x2F;sublime_text –command new_file</span><br><span\nstyle=\"color: rgb(61, 70, 77); font-family: 'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif; font-size: 16px; background-color: rgb(248, 248, 248);\"><br> 修改为</span>  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Exec=bash -c &quot;LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so exec /opt/sublime_text/sublime_text --command new_file&quot;</span><br></pre></td></tr></table></figure>\n\n<p>中文界面</p>\n<p><span\nstyle=\"font-size: 15px;\"> <a href=\"https://packagecontrol.io/installation#Simple\"\ndata-_src=\"https://packagecontrol.io/installation#Simple\">https://packagecontrol.io/installation#Simple</a><br></span></p>\n<p><span style=\"font-size: 15px;\">下载 <span\nstyle=\"color: rgb(111, 146, 186); text-decoration: none; font-family: Consolas, 'Driod Sans Mono', monospace; font-size: 15px; white-space: normal;\"><span\nstyle=\"\"><a href=\"https://packagecontrol.io/Package%20Control.sublime-package\"\nstyle=\"color: rgb(111, 146, 186); text-decoration: none; font-family: Consolas, &#39;Driod Sans Mono&#39;, monospace; font-size: 15px; white-space: normal;\">Package<br>Control.sublime-package</a> </span></span><a href=\"https://packagecontrol.io/Package%20Control.sublime-package\"\ndata-_src=\"https://packagecontrol.io/Package%20Control.sublime-package\">https://packagecontrol.io/Package%20Control.sublime-package</a><br></span></p>\n<p><span\nstyle=\"color: rgb(85, 85, 85); font-family: Helvetica, Arial, Verdana, sans-serif; font-size: 15px;\"> 点击 </span><span\nclass=\"menu\"\nstyle=\"border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; background-color: rgb(243, 243, 243); padding: 1px 4px; text-shadow: rgb(255, 255, 255) 0px 1px 0px; color: rgb(85, 85, 85); font-family: Helvetica, Arial, Verdana, sans-serif; font-size: 15px;\">Preferences <em>&gt;</em> Browse<br>Packages</span></p>\n<p>进入目录软件</p>\n<ol>\n<li><p>Download <a href=\"https://packagecontrol.io/Package%20Control.sublime-package\"\nstyle=\"color: rgb(111, 146, 186); text-decoration: none;\">Package<br>Control.sublime-package</a> and copy it into the Installed<br>Packages&#x2F; directory</p>\n</li>\n<li><p>重启生效  </p>\n</li>\n<li><p><span\nstyle=\"color: rgb(51, 51, 51); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\">点击Preferences&#x2F;Package<br>Control，然后输入Package Control：<span\nstyle=\"color: rgb(255, 0, 0); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\">Install Package</span></span></p>\n</li>\n<li><p><span\nstyle=\"color: rgb(51, 51, 51); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\"><span\nstyle=\"color: rgb(255, 0, 0); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\"><span\nstyle=\"color: rgb(51, 51, 51); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify; white-space: normal;\">然后在弹出的命令界面，输入Chinese，选择ChineseLocalization</span></span></span></p>\n</li>\n<li><p><span\nstyle=\"color: rgb(51, 51, 51); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\"><span\nstyle=\"color: rgb(255, 0, 0); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify;\"><span\nstyle=\"color: rgb(51, 51, 51); font-family: 'Microsoft Yahei', 微软雅黑, arial, 宋体, sans-serif; font-size: 16px; text-align: justify; white-space: normal;\">安装成功</span></span></span></p>\n</li>\n</ol>"},{"title":"Sublime运行脚本","date":"2022-09-01T13:07:03.000Z","_content":"\n### shell \n\nBuild Stytem > New Build Stytem ...\n\n```\n{    \"shell_cmd\": \"chmod a+x $file && /bin/sh $file\"}\n```\n\nctrl+s 保存 sh.sublime-build\n\n路径： ~/.config/sublime-text-3/Packages/User/sh.sublime-build\n\n执行脚本快捷键 ctrl+b\n\n<!--more-->\n\n### lua\n\n/usr/local/bin/lua\n\nlua\n\n```\n{    \"cmd\": [\"lua\", \"$file\"],    \"file_regex\": \"^(?:lua:)?[\\t ](...*?):([0-9]*):?([0-9]*)\",    \"selector\": \"source.lua\"}\n```\n\n\n\nluajit\n\n```\n{    \"cmd\": [\"luajit\", \"$file\"],    \"file_regex\": \"^(?:lua:)?[\\t ](...*?):([0-9]*):?([0-9]*)\",    \"selector\": \"source.lua\"}\n```\n\n\n\n\n\n","source":"_posts/tool/codetool/sublime02.md","raw":"---\ntitle: Sublime运行脚本\npermalink: tool/codetool/sublime02/\ntags:\n  - shell\n  - 脚本\n  - lua\ncategories:\n  - tool\n  - sublime\ndate: 2022-09-01 21:07:03\n---\n\n### shell \n\nBuild Stytem > New Build Stytem ...\n\n```\n{    \"shell_cmd\": \"chmod a+x $file && /bin/sh $file\"}\n```\n\nctrl+s 保存 sh.sublime-build\n\n路径： ~/.config/sublime-text-3/Packages/User/sh.sublime-build\n\n执行脚本快捷键 ctrl+b\n\n<!--more-->\n\n### lua\n\n/usr/local/bin/lua\n\nlua\n\n```\n{    \"cmd\": [\"lua\", \"$file\"],    \"file_regex\": \"^(?:lua:)?[\\t ](...*?):([0-9]*):?([0-9]*)\",    \"selector\": \"source.lua\"}\n```\n\n\n\nluajit\n\n```\n{    \"cmd\": [\"luajit\", \"$file\"],    \"file_regex\": \"^(?:lua:)?[\\t ](...*?):([0-9]*):?([0-9]*)\",    \"selector\": \"source.lua\"}\n```\n\n\n\n\n\n","slug":"tool/codetool/sublime02","published":1,"updated":"2022-09-01T13:15:25.305Z","__permalink":"tool/codetool/sublime02/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7j3sxeh0003lri58p8iapze","content":"<h3 id=\"shell\"><a href=\"#shell\" class=\"headerlink\" title=\"shell\"></a>shell</h3><p>Build Stytem &gt; New Build Stytem …</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;    &quot;shell_cmd&quot;: &quot;chmod a+x $file &amp;&amp; /bin/sh $file&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ctrl+s 保存 sh.sublime-build</p>\n<p>路径： ~&#x2F;.config&#x2F;sublime-text-3&#x2F;Packages&#x2F;User&#x2F;sh.sublime-build</p>\n<p>执行脚本快捷键 ctrl+b</p>\n<span id=\"more\"></span>\n\n<h3 id=\"lua\"><a href=\"#lua\" class=\"headerlink\" title=\"lua\"></a>lua</h3><p>&#x2F;usr&#x2F;local&#x2F;bin&#x2F;lua</p>\n<p>lua</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;    &quot;cmd&quot;: [&quot;lua&quot;, &quot;$file&quot;],    &quot;file_regex&quot;: &quot;^(?:lua:)?[\\t ](...*?):([0-9]*):?([0-9]*)&quot;,    &quot;selector&quot;: &quot;source.lua&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>luajit</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;    &quot;cmd&quot;: [&quot;luajit&quot;, &quot;$file&quot;],    &quot;file_regex&quot;: &quot;^(?:lua:)?[\\t ](...*?):([0-9]*):?([0-9]*)&quot;,    &quot;selector&quot;: &quot;source.lua&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n","site":{"data":{}},"excerpt":"<h3 id=\"shell\"><a href=\"#shell\" class=\"headerlink\" title=\"shell\"></a>shell</h3><p>Build Stytem &gt; New Build Stytem …</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;    &quot;shell_cmd&quot;: &quot;chmod a+x $file &amp;&amp; /bin/sh $file&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ctrl+s 保存 sh.sublime-build</p>\n<p>路径： ~&#x2F;.config&#x2F;sublime-text-3&#x2F;Packages&#x2F;User&#x2F;sh.sublime-build</p>\n<p>执行脚本快捷键 ctrl+b</p>","more":"<h3 id=\"lua\"><a href=\"#lua\" class=\"headerlink\" title=\"lua\"></a>lua</h3><p>&#x2F;usr&#x2F;local&#x2F;bin&#x2F;lua</p>\n<p>lua</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;    &quot;cmd&quot;: [&quot;lua&quot;, &quot;$file&quot;],    &quot;file_regex&quot;: &quot;^(?:lua:)?[\\t ](...*?):([0-9]*):?([0-9]*)&quot;,    &quot;selector&quot;: &quot;source.lua&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>luajit</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;    &quot;cmd&quot;: [&quot;luajit&quot;, &quot;$file&quot;],    &quot;file_regex&quot;: &quot;^(?:lua:)?[\\t ](...*?):([0-9]*):?([0-9]*)&quot;,    &quot;selector&quot;: &quot;source.lua&quot;&#125;</span><br></pre></td></tr></table></figure>"},{"title":"Sublime设置","date":"2022-09-01T13:13:45.000Z","_content":"\n###  插件\n\n#### Sublimelint3\n\nSublimelint支持显示高亮错误代码\n\n安装路径  ~/.config/sublime-text-3/Packages/\n\nctrl+shift+p  输入 install    **sublimelinter**\n\n\n>打开 SublimeLinter 的配置文件：菜单 Preferences -> Package Settings -> SublimeLinter -> Settings - User，\n>\n>加入 \"sublimelinter\": \"save-only\"\n\n\n\n<!--more-->\n\n\n\n### 设置\n\ntoolbar -> Preferences -> Browse packages  -> open User file \n\n左侧目录字体\n\nDefault.sublime-theme 手动创建\n\n```\n[\n    {\n        \"class\": \"tab_label\",\n        \"font.size\": 18\n    },\n    {\n        \"class\": \"sidebar_label\",\n        \"font.size\": 18\n    }\n]\n```\n\n","source":"_posts/tool/codetool/sublime03.md","raw":"---\ntitle: Sublime设置\npermalink: tool/codetool/sublime03/\ntags:\n  - 插件\n  - 设置\n  - xxx\ncategories:\n  - tool\n  - sublime\ndate: 2022-09-01 21:13:45\n---\n\n###  插件\n\n#### Sublimelint3\n\nSublimelint支持显示高亮错误代码\n\n安装路径  ~/.config/sublime-text-3/Packages/\n\nctrl+shift+p  输入 install    **sublimelinter**\n\n\n>打开 SublimeLinter 的配置文件：菜单 Preferences -> Package Settings -> SublimeLinter -> Settings - User，\n>\n>加入 \"sublimelinter\": \"save-only\"\n\n\n\n<!--more-->\n\n\n\n### 设置\n\ntoolbar -> Preferences -> Browse packages  -> open User file \n\n左侧目录字体\n\nDefault.sublime-theme 手动创建\n\n```\n[\n    {\n        \"class\": \"tab_label\",\n        \"font.size\": 18\n    },\n    {\n        \"class\": \"sidebar_label\",\n        \"font.size\": 18\n    }\n]\n```\n\n","slug":"tool/codetool/sublime03","published":1,"updated":"2022-09-01T13:23:01.989Z","__permalink":"tool/codetool/sublime03/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7j3sxej0005lri5c1qug0q2","content":"<h3 id=\"插件\"><a href=\"#插件\" class=\"headerlink\" title=\"插件\"></a>插件</h3><h4 id=\"Sublimelint3\"><a href=\"#Sublimelint3\" class=\"headerlink\" title=\"Sublimelint3\"></a>Sublimelint3</h4><p>Sublimelint支持显示高亮错误代码</p>\n<p>安装路径  ~&#x2F;.config&#x2F;sublime-text-3&#x2F;Packages&#x2F;</p>\n<p>ctrl+shift+p  输入 install    <strong>sublimelinter</strong></p>\n<blockquote>\n<p>打开 SublimeLinter 的配置文件：菜单 Preferences -&gt; Package Settings -&gt; SublimeLinter -&gt; Settings - User，</p>\n<p>加入 “sublimelinter”: “save-only”</p>\n</blockquote>\n<span id=\"more\"></span>\n\n\n\n<h3 id=\"设置\"><a href=\"#设置\" class=\"headerlink\" title=\"设置\"></a>设置</h3><p>toolbar -&gt; Preferences -&gt; Browse packages  -&gt; open User file </p>\n<p>左侧目录字体</p>\n<p>Default.sublime-theme 手动创建</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        &quot;class&quot;: &quot;tab_label&quot;,</span><br><span class=\"line\">        &quot;font.size&quot;: 18</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        &quot;class&quot;: &quot;sidebar_label&quot;,</span><br><span class=\"line\">        &quot;font.size&quot;: 18</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h3 id=\"插件\"><a href=\"#插件\" class=\"headerlink\" title=\"插件\"></a>插件</h3><h4 id=\"Sublimelint3\"><a href=\"#Sublimelint3\" class=\"headerlink\" title=\"Sublimelint3\"></a>Sublimelint3</h4><p>Sublimelint支持显示高亮错误代码</p>\n<p>安装路径  ~&#x2F;.config&#x2F;sublime-text-3&#x2F;Packages&#x2F;</p>\n<p>ctrl+shift+p  输入 install    <strong>sublimelinter</strong></p>\n<blockquote>\n<p>打开 SublimeLinter 的配置文件：菜单 Preferences -&gt; Package Settings -&gt; SublimeLinter -&gt; Settings - User，</p>\n<p>加入 “sublimelinter”: “save-only”</p>\n</blockquote>","more":"<h3 id=\"设置\"><a href=\"#设置\" class=\"headerlink\" title=\"设置\"></a>设置</h3><p>toolbar -&gt; Preferences -&gt; Browse packages  -&gt; open User file </p>\n<p>左侧目录字体</p>\n<p>Default.sublime-theme 手动创建</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        &quot;class&quot;: &quot;tab_label&quot;,</span><br><span class=\"line\">        &quot;font.size&quot;: 18</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        &quot;class&quot;: &quot;sidebar_label&quot;,</span><br><span class=\"line\">        &quot;font.size&quot;: 18</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>"},{"title":"PLSQL","date":"2022-09-01T13:42:31.000Z","_content":"\n###   win\n\n#### 环境变量\n\n```\nORACLE_HOME=D:\\sqlplus\\instantclient_19_3\n\npath   %ORACLE_HOME%\n```\n\noci.dll  http://download.oracle.com/otn/nt/instantclient/19300/instantclient-basic-windows.x64-19.3.0.0.0dbru.zip\n\n<!--more-->\n\n#### where 条件搜索带中文  \n\n```\nselect * from v$nls_parameters where parameter like 'NLS_CH%'; \n或\nselect * from v$nls_parameters   where  parameter='NLS_CHARACTERSET';\n```\n\n![](/pics/pl-sql-4659.png)\n\n环境变量添加  `NLS_LANG = AMERICAN_AMERICA.AL32UTF8`\n\n\n\n\n\n\n\n","source":"_posts/tool/databasetool/pl-sql.md","raw":"---\ntitle: PLSQL\npermalink: tool/databasetool/pl-sql/\ntags:\n  - PL/SQL\n  - oracle\ncategories:\n  - tool\n  - databasetool\ndate: 2022-09-01 21:42:31\n---\n\n###   win\n\n#### 环境变量\n\n```\nORACLE_HOME=D:\\sqlplus\\instantclient_19_3\n\npath   %ORACLE_HOME%\n```\n\noci.dll  http://download.oracle.com/otn/nt/instantclient/19300/instantclient-basic-windows.x64-19.3.0.0.0dbru.zip\n\n<!--more-->\n\n#### where 条件搜索带中文  \n\n```\nselect * from v$nls_parameters where parameter like 'NLS_CH%'; \n或\nselect * from v$nls_parameters   where  parameter='NLS_CHARACTERSET';\n```\n\n![](/pics/pl-sql-4659.png)\n\n环境变量添加  `NLS_LANG = AMERICAN_AMERICA.AL32UTF8`\n\n\n\n\n\n\n\n","slug":"tool/databasetool/pl-sql","published":1,"updated":"2022-09-01T13:49:21.485Z","__permalink":"tool/databasetool/pl-sql/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7j3sxek0006lri563pd4bpe","content":"<h3 id=\"win\"><a href=\"#win\" class=\"headerlink\" title=\"win\"></a>win</h3><h4 id=\"环境变量\"><a href=\"#环境变量\" class=\"headerlink\" title=\"环境变量\"></a>环境变量</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ORACLE_HOME=D:\\sqlplus\\instantclient_19_3</span><br><span class=\"line\"></span><br><span class=\"line\">path   %ORACLE_HOME%</span><br></pre></td></tr></table></figure>\n\n<p>oci.dll  <a href=\"http://download.oracle.com/otn/nt/instantclient/19300/instantclient-basic-windows.x64-19.3.0.0.0dbru.zip\">http://download.oracle.com/otn/nt/instantclient/19300/instantclient-basic-windows.x64-19.3.0.0.0dbru.zip</a></p>\n<span id=\"more\"></span>\n\n<h4 id=\"where-条件搜索带中文\"><a href=\"#where-条件搜索带中文\" class=\"headerlink\" title=\"where 条件搜索带中文\"></a>where 条件搜索带中文</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select * from v$nls_parameters where parameter like &#x27;NLS_CH%&#x27;; </span><br><span class=\"line\">或</span><br><span class=\"line\">select * from v$nls_parameters   where  parameter=&#x27;NLS_CHARACTERSET&#x27;;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/pics/pl-sql-4659.png\"></p>\n<p>环境变量添加  <code>NLS_LANG = AMERICAN_AMERICA.AL32UTF8</code></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"win\"><a href=\"#win\" class=\"headerlink\" title=\"win\"></a>win</h3><h4 id=\"环境变量\"><a href=\"#环境变量\" class=\"headerlink\" title=\"环境变量\"></a>环境变量</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ORACLE_HOME=D:\\sqlplus\\instantclient_19_3</span><br><span class=\"line\"></span><br><span class=\"line\">path   %ORACLE_HOME%</span><br></pre></td></tr></table></figure>\n\n<p>oci.dll  <a href=\"http://download.oracle.com/otn/nt/instantclient/19300/instantclient-basic-windows.x64-19.3.0.0.0dbru.zip\">http://download.oracle.com/otn/nt/instantclient/19300/instantclient-basic-windows.x64-19.3.0.0.0dbru.zip</a></p>","more":"<h4 id=\"where-条件搜索带中文\"><a href=\"#where-条件搜索带中文\" class=\"headerlink\" title=\"where 条件搜索带中文\"></a>where 条件搜索带中文</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select * from v$nls_parameters where parameter like &#x27;NLS_CH%&#x27;; </span><br><span class=\"line\">或</span><br><span class=\"line\">select * from v$nls_parameters   where  parameter=&#x27;NLS_CHARACTERSET&#x27;;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/pics/pl-sql-4659.png\"></p>\n<p>环境变量添加  <code>NLS_LANG = AMERICAN_AMERICA.AL32UTF8</code></p>"},{"title":"mysql查询过程","date":"2022-09-03T09:06:01.000Z","_content":"\n## mysql查询过程\n\n<img src=\"/pics/cd88f35d-6766-4f73-8890-4b7fb44b3361.jpg\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" />\n\n  \n\n### 客户端与服务端通信协议\n\n“双半工”  <span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">在任一时刻，要么是服务器向客户端发送数据，要么是客户端向服务器发送数据，这两个动作不能同时发生</span>\n\n \n\n在实际开发中，尽量保持查询简单且只返回必需的数据，减小通信间数据包的大小和数量是一个非常好的习惯，这也是查询中尽量避免使用SELECT\n\\*以及加上LIMIT限制的原因之一。  \n\n  <!--more-->\n\n### 查询缓存\n\n解析一个查询语句前，如果缓存是打开的，那么mysql会检查这个缓存语句是否命中缓存中的数据，如果命中，在检查用户权限后直接返回缓存中的结果，这种情况下，查询不会被解析，不会生成执行计划，更不会执行\n\n  \n\nmysql将缓存放在一个引用表 (<span\nstyle=\"font-size: 1rem; background-color: rgb(255, 255, 255);\">类似hashmap</span>)\n 利用哈希值索引\n,这个哈希值通过查询本身，数据库，客户端版本号等一些影响结果计算得到，2个查询不同（空格，注释等），不会命中\n\n<span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">如果查询中包含任何用户自定义函数、存储函数、用户变量、临时表、MySQL库中的系统表，其查询结果都不会被缓存</span>  \n\n<span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\"><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">函数NOW()或者CURRENT_DATE()\n       <span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">包含CURRENT_USER或者CONNECION_ID()</span></span>  \n</span>\n\n<span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\"><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\"><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">  \n</span></span></span>\n\n      缓存何时失效\n\n\n 查询缓存系统会跟踪查询语句中涉及的每个表，如果这些表（结构或数据）发生变化，那么和这张表相关联的所有缓存数据都将失效。\n\n\n   如何写操作都会导致缓存失效\n\n\n如果查询缓存非常大或者碎片很多，带来很大系统消耗，甚至系统僵死一会儿，查询对缓存的额外消耗不仅在写操作，读操作也不例外：\n\n1.任何查询语句开始前必须经过检查缓存，即使这条sql语句永远不会命中\n\n2.如何结果可以被缓存，那么执行完成后会将结果写入缓存，也会带来额外消耗\n\n  \n\n<span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">并不是什么情况下查询缓存都会提高系统性能，缓存和失效都会带来额外消耗，</span>只有缓存带来资源消耗大于本身消耗资源时，才会给系统带来性能提升  \n\n<span wiz-span=\"data-wiz-span\"\nstyle=\"background-color: rgb(255, 255, 0);\">优化：</span>\n\n<span wiz-span=\"data-wiz-span\"\nstyle=\"background-color: rgb(255, 255, 0);\"> \n 多个小表代替大表，避免过度设计</span>\n\n<span wiz-span=\"data-wiz-span\"\nstyle=\"background-color: rgb(255, 255, 0);\"> 缓存空间大小设置\n，几十兆</span>\n\n<span wiz-span=\"data-wiz-span\"\nstyle=\"background-color: rgb(255, 255, 0);\"> \n批量插入代替循环单条插入</span>\n\n<span wiz-span=\"data-wiz-span\"\nstyle=\"background-color: rgb(255, 255, 0);\"> 通过SQL_CACHE\n和SQL_NO_CACHE控制某条语句是否需要进行缓存</span>\n\n写密集型应用不要打开缓存，QUERY_CACHE_TYPE 设置 DEMAND\n ，只有加入SQL_CACHE的查询才会走缓存\n\n  \n\n缓存如何使用内存？\n\n缓存如何控制内存的碎片化？\n\n事务对查询缓存的影响？\n\n  \n\n### 语法解析和预处理\n\nmysql通过  关键字   将sql语句进行解析并生成一颗对应 解析树 \n\n过程解析器主要通过语法规则来验证和解析（关键字，关键字顺序是否正确）   \n\n预处理 会根据mysql规则进一步检查解析树是否合法 （数据表，列是否存在）\n\n  \n\n### 查询优化\n\n   经过解析和预处理的语法树被认为合法，并且有优化器将其转化成查询计划；\n\n一般一条查询有多种查询方式，返回相同结果，优化器会选择最好的执行计划\n\n  \n\n查询当前会话的 last_query_cost 值来计算当前查询的成本\n\n\n\n``` CodeMirror-line\nshow status like 'last_query_cost'\n```\n\n<span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">这些统计信息包括：每张表或者索引的页面个数、索引的基数、索引和数据行的长度、索引的分布情况等等。</span>  \n\n<span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">  \n</span>\n\nMySQL 和我们想的不一样（我们执行时间短，mysq\n值认为选择它认为成本小的，并不意味执行时间短）\n\n<span wiz-span=\"data-wiz-span\" style=\"color: rgb(255, 0, 0);\">驱动表\n</span>：**mysql中指定了连接条件时，满足查询条件的记录行数少的表为驱动表；如未指定查询条件，则扫描行数少的为驱动表。mysql优化器就是这么粗暴以小表驱动大表的方式来决定执行顺序的**<span\nstyle=\"color:rgb(75, 75, 75);font-size:1rem;background-color:rgb(255, 255, 255);\">。</span>\n\n<span\nstyle=\"color:rgb(75, 75, 75);font-size:1rem;background-color:rgb(255, 255, 255);\"> \n STRAIGHT_JOIN功能同join类似，但能让左边的表来驱动右边的表，能改表优化器对于联表查询的执行顺序</span>  \n\n  \n\n  \n\n查询优化器是一个非常复杂的部件，它使用非常多的优化策略来生成一个最优执行计划：\n\n1.重新定义表关联<span\nstyle=\"font-size: 1rem; background-color: rgb(255, 255, 255);\">顺序（多表关联查询时，并不一定按照SQL指定顺序进行）</span>\n\n<span\nstyle=\"color:rgb(75, 75, 75);font-size:1rem;background-color:rgb(255, 255, 255);\"> \n STRAIGHT_JOIN只适用于inner join，并不使用与left join，right join</span>\n\n``` sql\nselect t1.*\nfrom Table1 t1\nSTRAIGHT_JOIN  Table2 t2\non t1.id = t2.id\nwhere t1.stu = 1\n```\n\n2.优化MIN()和MAX()函数（找某列的最小值，如果该列有索引，只需要查找B+Tree索引最左端，反之则可以找到最大值)  \n\n3.提前终止查询 <span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\"> </span>（分页limit  ）\n\n4.优化排序（单次传输排序，也就是一次读取所有的数据行，然后根据给定的列排序）\n\n\n\n### 查询执行引擎\n\n在完成解析和优化后，MySQL会生成对应执行计划，查询执行引擎根据执行计划指令依次执行得出结果。\n\n整个过程通过调用存储引擎实现接口（handler\napi）每一张表一个handler实例表示，优化器可以根据这些实例接口来获取表的相关信息，包括列名，索引统计信息\n\n  \n\n  \n\n查询过程：\n\n-   客户端向MySQL服务器发送一条查询请求\n\n-   服务器首先检查查询缓存，如果命中缓存，则立刻返回存储在缓存中的结果。否则进入下一阶段\n\n-   服务器进行SQL解析、预处理、再由优化器生成对应的执行计划\n\n-   MySQL根据执行计划，调用存储引擎的API来执行查询\n\n-   将结果通过tcp协议进行传输返回给客户端，同时缓存查询结果\n\n  \n\n\n\n  \n\n\n\n\n\n","source":"_posts/services/database/mysql/mysql-query.md","raw":"---\ntitle: mysql查询过程\npermalink: /services/database/mysql/mysql-query/\ntags:\n  - mysql\n  - query\ncategories:\n  - services\n  - database\n  - mysql\ndate: 2022-09-03 17:06:01\n---\n\n## mysql查询过程\n\n<img src=\"/pics/cd88f35d-6766-4f73-8890-4b7fb44b3361.jpg\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" />\n\n  \n\n### 客户端与服务端通信协议\n\n“双半工”  <span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">在任一时刻，要么是服务器向客户端发送数据，要么是客户端向服务器发送数据，这两个动作不能同时发生</span>\n\n \n\n在实际开发中，尽量保持查询简单且只返回必需的数据，减小通信间数据包的大小和数量是一个非常好的习惯，这也是查询中尽量避免使用SELECT\n\\*以及加上LIMIT限制的原因之一。  \n\n  <!--more-->\n\n### 查询缓存\n\n解析一个查询语句前，如果缓存是打开的，那么mysql会检查这个缓存语句是否命中缓存中的数据，如果命中，在检查用户权限后直接返回缓存中的结果，这种情况下，查询不会被解析，不会生成执行计划，更不会执行\n\n  \n\nmysql将缓存放在一个引用表 (<span\nstyle=\"font-size: 1rem; background-color: rgb(255, 255, 255);\">类似hashmap</span>)\n 利用哈希值索引\n,这个哈希值通过查询本身，数据库，客户端版本号等一些影响结果计算得到，2个查询不同（空格，注释等），不会命中\n\n<span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">如果查询中包含任何用户自定义函数、存储函数、用户变量、临时表、MySQL库中的系统表，其查询结果都不会被缓存</span>  \n\n<span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\"><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">函数NOW()或者CURRENT_DATE()\n       <span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">包含CURRENT_USER或者CONNECION_ID()</span></span>  \n</span>\n\n<span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\"><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\"><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">  \n</span></span></span>\n\n      缓存何时失效\n\n\n 查询缓存系统会跟踪查询语句中涉及的每个表，如果这些表（结构或数据）发生变化，那么和这张表相关联的所有缓存数据都将失效。\n\n\n   如何写操作都会导致缓存失效\n\n\n如果查询缓存非常大或者碎片很多，带来很大系统消耗，甚至系统僵死一会儿，查询对缓存的额外消耗不仅在写操作，读操作也不例外：\n\n1.任何查询语句开始前必须经过检查缓存，即使这条sql语句永远不会命中\n\n2.如何结果可以被缓存，那么执行完成后会将结果写入缓存，也会带来额外消耗\n\n  \n\n<span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">并不是什么情况下查询缓存都会提高系统性能，缓存和失效都会带来额外消耗，</span>只有缓存带来资源消耗大于本身消耗资源时，才会给系统带来性能提升  \n\n<span wiz-span=\"data-wiz-span\"\nstyle=\"background-color: rgb(255, 255, 0);\">优化：</span>\n\n<span wiz-span=\"data-wiz-span\"\nstyle=\"background-color: rgb(255, 255, 0);\"> \n 多个小表代替大表，避免过度设计</span>\n\n<span wiz-span=\"data-wiz-span\"\nstyle=\"background-color: rgb(255, 255, 0);\"> 缓存空间大小设置\n，几十兆</span>\n\n<span wiz-span=\"data-wiz-span\"\nstyle=\"background-color: rgb(255, 255, 0);\"> \n批量插入代替循环单条插入</span>\n\n<span wiz-span=\"data-wiz-span\"\nstyle=\"background-color: rgb(255, 255, 0);\"> 通过SQL_CACHE\n和SQL_NO_CACHE控制某条语句是否需要进行缓存</span>\n\n写密集型应用不要打开缓存，QUERY_CACHE_TYPE 设置 DEMAND\n ，只有加入SQL_CACHE的查询才会走缓存\n\n  \n\n缓存如何使用内存？\n\n缓存如何控制内存的碎片化？\n\n事务对查询缓存的影响？\n\n  \n\n### 语法解析和预处理\n\nmysql通过  关键字   将sql语句进行解析并生成一颗对应 解析树 \n\n过程解析器主要通过语法规则来验证和解析（关键字，关键字顺序是否正确）   \n\n预处理 会根据mysql规则进一步检查解析树是否合法 （数据表，列是否存在）\n\n  \n\n### 查询优化\n\n   经过解析和预处理的语法树被认为合法，并且有优化器将其转化成查询计划；\n\n一般一条查询有多种查询方式，返回相同结果，优化器会选择最好的执行计划\n\n  \n\n查询当前会话的 last_query_cost 值来计算当前查询的成本\n\n\n\n``` CodeMirror-line\nshow status like 'last_query_cost'\n```\n\n<span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">这些统计信息包括：每张表或者索引的页面个数、索引的基数、索引和数据行的长度、索引的分布情况等等。</span>  \n\n<span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">  \n</span>\n\nMySQL 和我们想的不一样（我们执行时间短，mysq\n值认为选择它认为成本小的，并不意味执行时间短）\n\n<span wiz-span=\"data-wiz-span\" style=\"color: rgb(255, 0, 0);\">驱动表\n</span>：**mysql中指定了连接条件时，满足查询条件的记录行数少的表为驱动表；如未指定查询条件，则扫描行数少的为驱动表。mysql优化器就是这么粗暴以小表驱动大表的方式来决定执行顺序的**<span\nstyle=\"color:rgb(75, 75, 75);font-size:1rem;background-color:rgb(255, 255, 255);\">。</span>\n\n<span\nstyle=\"color:rgb(75, 75, 75);font-size:1rem;background-color:rgb(255, 255, 255);\"> \n STRAIGHT_JOIN功能同join类似，但能让左边的表来驱动右边的表，能改表优化器对于联表查询的执行顺序</span>  \n\n  \n\n  \n\n查询优化器是一个非常复杂的部件，它使用非常多的优化策略来生成一个最优执行计划：\n\n1.重新定义表关联<span\nstyle=\"font-size: 1rem; background-color: rgb(255, 255, 255);\">顺序（多表关联查询时，并不一定按照SQL指定顺序进行）</span>\n\n<span\nstyle=\"color:rgb(75, 75, 75);font-size:1rem;background-color:rgb(255, 255, 255);\"> \n STRAIGHT_JOIN只适用于inner join，并不使用与left join，right join</span>\n\n``` sql\nselect t1.*\nfrom Table1 t1\nSTRAIGHT_JOIN  Table2 t2\non t1.id = t2.id\nwhere t1.stu = 1\n```\n\n2.优化MIN()和MAX()函数（找某列的最小值，如果该列有索引，只需要查找B+Tree索引最左端，反之则可以找到最大值)  \n\n3.提前终止查询 <span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\"> </span>（分页limit  ）\n\n4.优化排序（单次传输排序，也就是一次读取所有的数据行，然后根据给定的列排序）\n\n\n\n### 查询执行引擎\n\n在完成解析和优化后，MySQL会生成对应执行计划，查询执行引擎根据执行计划指令依次执行得出结果。\n\n整个过程通过调用存储引擎实现接口（handler\napi）每一张表一个handler实例表示，优化器可以根据这些实例接口来获取表的相关信息，包括列名，索引统计信息\n\n  \n\n  \n\n查询过程：\n\n-   客户端向MySQL服务器发送一条查询请求\n\n-   服务器首先检查查询缓存，如果命中缓存，则立刻返回存储在缓存中的结果。否则进入下一阶段\n\n-   服务器进行SQL解析、预处理、再由优化器生成对应的执行计划\n\n-   MySQL根据执行计划，调用存储引擎的API来执行查询\n\n-   将结果通过tcp协议进行传输返回给客户端，同时缓存查询结果\n\n  \n\n\n\n  \n\n\n\n\n\n","slug":"services/database/mysql/mysql-query","published":1,"updated":"2022-09-03T13:43:05.259Z","__permalink":"/services/database/mysql/mysql-query/","_id":"cl7lok4bt0000j3i51wbnd3iq","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"mysql查询过程\"><a href=\"#mysql查询过程\" class=\"headerlink\" title=\"mysql查询过程\"></a>mysql查询过程</h2><p><img src=\"/pics/cd88f35d-6766-4f73-8890-4b7fb44b3361.jpg\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" /></p>\n<h3 id=\"客户端与服务端通信协议\"><a href=\"#客户端与服务端通信协议\" class=\"headerlink\" title=\"客户端与服务端通信协议\"></a>客户端与服务端通信协议</h3><p>“双半工”  <span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">在任一时刻，要么是服务器向客户端发送数据，要么是客户端向服务器发送数据，这两个动作不能同时发生</span></p>\n<p> </p>\n<p>在实际开发中，尽量保持查询简单且只返回必需的数据，减小通信间数据包的大小和数量是一个非常好的习惯，这也是查询中尽量避免使用SELECT<br>*以及加上LIMIT限制的原因之一。  </p>\n  <span id=\"more\"></span>\n\n<h3 id=\"查询缓存\"><a href=\"#查询缓存\" class=\"headerlink\" title=\"查询缓存\"></a>查询缓存</h3><p>解析一个查询语句前，如果缓存是打开的，那么mysql会检查这个缓存语句是否命中缓存中的数据，如果命中，在检查用户权限后直接返回缓存中的结果，这种情况下，查询不会被解析，不会生成执行计划，更不会执行</p>\n<p>mysql将缓存放在一个引用表 (<span\nstyle=\"font-size: 1rem; background-color: rgb(255, 255, 255);\">类似hashmap</span>)<br> 利用哈希值索引<br>,这个哈希值通过查询本身，数据库，客户端版本号等一些影响结果计算得到，2个查询不同（空格，注释等），不会命中</p>\n<p><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">如果查询中包含任何用户自定义函数、存储函数、用户变量、临时表、MySQL库中的系统表，其查询结果都不会被缓存</span>  </p>\n<p><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\"><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">函数NOW()或者CURRENT_DATE()<br>       <span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">包含CURRENT_USER或者CONNECION_ID()</span></span><br></span></p>\n<p><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\"><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\"><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\"><br></span></span></span></p>\n<p>      缓存何时失效</p>\n<p> 查询缓存系统会跟踪查询语句中涉及的每个表，如果这些表（结构或数据）发生变化，那么和这张表相关联的所有缓存数据都将失效。</p>\n<p>   如何写操作都会导致缓存失效</p>\n<p>如果查询缓存非常大或者碎片很多，带来很大系统消耗，甚至系统僵死一会儿，查询对缓存的额外消耗不仅在写操作，读操作也不例外：</p>\n<p>1.任何查询语句开始前必须经过检查缓存，即使这条sql语句永远不会命中</p>\n<p>2.如何结果可以被缓存，那么执行完成后会将结果写入缓存，也会带来额外消耗</p>\n<p><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">并不是什么情况下查询缓存都会提高系统性能，缓存和失效都会带来额外消耗，</span>只有缓存带来资源消耗大于本身消耗资源时，才会给系统带来性能提升  </p>\n<p><span wiz-span=\"data-wiz-span\"\nstyle=\"background-color: rgb(255, 255, 0);\">优化：</span></p>\n<p><span wiz-span=\"data-wiz-span\"\nstyle=\"background-color: rgb(255, 255, 0);\"><br> 多个小表代替大表，避免过度设计</span></p>\n<p><span wiz-span=\"data-wiz-span\"\nstyle=\"background-color: rgb(255, 255, 0);\"> 缓存空间大小设置<br>，几十兆</span></p>\n<p><span wiz-span=\"data-wiz-span\"\nstyle=\"background-color: rgb(255, 255, 0);\"><br>批量插入代替循环单条插入</span></p>\n<p><span wiz-span=\"data-wiz-span\"\nstyle=\"background-color: rgb(255, 255, 0);\"> 通过SQL_CACHE<br>和SQL_NO_CACHE控制某条语句是否需要进行缓存</span></p>\n<p>写密集型应用不要打开缓存，QUERY_CACHE_TYPE 设置 DEMAND<br> ，只有加入SQL_CACHE的查询才会走缓存</p>\n<p>缓存如何使用内存？</p>\n<p>缓存如何控制内存的碎片化？</p>\n<p>事务对查询缓存的影响？</p>\n<h3 id=\"语法解析和预处理\"><a href=\"#语法解析和预处理\" class=\"headerlink\" title=\"语法解析和预处理\"></a>语法解析和预处理</h3><p>mysql通过  关键字   将sql语句进行解析并生成一颗对应 解析树 </p>\n<p>过程解析器主要通过语法规则来验证和解析（关键字，关键字顺序是否正确）   </p>\n<p>预处理 会根据mysql规则进一步检查解析树是否合法 （数据表，列是否存在）</p>\n<h3 id=\"查询优化\"><a href=\"#查询优化\" class=\"headerlink\" title=\"查询优化\"></a>查询优化</h3><p>   经过解析和预处理的语法树被认为合法，并且有优化器将其转化成查询计划；</p>\n<p>一般一条查询有多种查询方式，返回相同结果，优化器会选择最好的执行计划</p>\n<p>查询当前会话的 last_query_cost 值来计算当前查询的成本</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show status like &#x27;last_query_cost&#x27;</span><br></pre></td></tr></table></figure>\n\n<p><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">这些统计信息包括：每张表或者索引的页面个数、索引的基数、索引和数据行的长度、索引的分布情况等等。</span>  </p>\n<p><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\"><br></span></p>\n<p>MySQL 和我们想的不一样（我们执行时间短，mysq<br>值认为选择它认为成本小的，并不意味执行时间短）</p>\n<p><span wiz-span=\"data-wiz-span\" style=\"color: rgb(255, 0, 0);\">驱动表<br></span>：<strong>mysql中指定了连接条件时，满足查询条件的记录行数少的表为驱动表；如未指定查询条件，则扫描行数少的为驱动表。mysql优化器就是这么粗暴以小表驱动大表的方式来决定执行顺序的</strong><span\nstyle=\"color:rgb(75, 75, 75);font-size:1rem;background-color:rgb(255, 255, 255);\">。</span></p>\n<p><span\nstyle=\"color:rgb(75, 75, 75);font-size:1rem;background-color:rgb(255, 255, 255);\"> <br> STRAIGHT_JOIN功能同join类似，但能让左边的表来驱动右边的表，能改表优化器对于联表查询的执行顺序</span>  </p>\n<p>查询优化器是一个非常复杂的部件，它使用非常多的优化策略来生成一个最优执行计划：</p>\n<p>1.重新定义表关联<span\nstyle=\"font-size: 1rem; background-color: rgb(255, 255, 255);\">顺序（多表关联查询时，并不一定按照SQL指定顺序进行）</span></p>\n<p><span\nstyle=\"color:rgb(75, 75, 75);font-size:1rem;background-color:rgb(255, 255, 255);\"> <br> STRAIGHT_JOIN只适用于inner join，并不使用与left join，right join</span></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> t1.<span class=\"operator\">*</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> Table1 t1</span><br><span class=\"line\">STRAIGHT_JOIN  Table2 t2</span><br><span class=\"line\"><span class=\"keyword\">on</span> t1.id <span class=\"operator\">=</span> t2.id</span><br><span class=\"line\"><span class=\"keyword\">where</span> t1.stu <span class=\"operator\">=</span> <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n\n<p>2.优化MIN()和MAX()函数（找某列的最小值，如果该列有索引，只需要查找B+Tree索引最左端，反之则可以找到最大值)  </p>\n<p>3.提前终止查询 <span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\"> </span>（分页limit  ）</p>\n<p>4.优化排序（单次传输排序，也就是一次读取所有的数据行，然后根据给定的列排序）</p>\n<h3 id=\"查询执行引擎\"><a href=\"#查询执行引擎\" class=\"headerlink\" title=\"查询执行引擎\"></a>查询执行引擎</h3><p>在完成解析和优化后，MySQL会生成对应执行计划，查询执行引擎根据执行计划指令依次执行得出结果。</p>\n<p>整个过程通过调用存储引擎实现接口（handler<br>api）每一张表一个handler实例表示，优化器可以根据这些实例接口来获取表的相关信息，包括列名，索引统计信息</p>\n<p>查询过程：</p>\n<ul>\n<li><p>客户端向MySQL服务器发送一条查询请求</p>\n</li>\n<li><p>服务器首先检查查询缓存，如果命中缓存，则立刻返回存储在缓存中的结果。否则进入下一阶段</p>\n</li>\n<li><p>服务器进行SQL解析、预处理、再由优化器生成对应的执行计划</p>\n</li>\n<li><p>MySQL根据执行计划，调用存储引擎的API来执行查询</p>\n</li>\n<li><p>将结果通过tcp协议进行传输返回给客户端，同时缓存查询结果</p>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"<h2 id=\"mysql查询过程\"><a href=\"#mysql查询过程\" class=\"headerlink\" title=\"mysql查询过程\"></a>mysql查询过程</h2><p><img src=\"/pics/cd88f35d-6766-4f73-8890-4b7fb44b3361.jpg\"\nstyle=\"vertical-align: bottom; max-width: 100%;\" /></p>\n<h3 id=\"客户端与服务端通信协议\"><a href=\"#客户端与服务端通信协议\" class=\"headerlink\" title=\"客户端与服务端通信协议\"></a>客户端与服务端通信协议</h3><p>“双半工”  <span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">在任一时刻，要么是服务器向客户端发送数据，要么是客户端向服务器发送数据，这两个动作不能同时发生</span></p>\n<p> </p>\n<p>在实际开发中，尽量保持查询简单且只返回必需的数据，减小通信间数据包的大小和数量是一个非常好的习惯，这也是查询中尽量避免使用SELECT<br>*以及加上LIMIT限制的原因之一。  </p>","more":"<h3 id=\"查询缓存\"><a href=\"#查询缓存\" class=\"headerlink\" title=\"查询缓存\"></a>查询缓存</h3><p>解析一个查询语句前，如果缓存是打开的，那么mysql会检查这个缓存语句是否命中缓存中的数据，如果命中，在检查用户权限后直接返回缓存中的结果，这种情况下，查询不会被解析，不会生成执行计划，更不会执行</p>\n<p>mysql将缓存放在一个引用表 (<span\nstyle=\"font-size: 1rem; background-color: rgb(255, 255, 255);\">类似hashmap</span>)<br> 利用哈希值索引<br>,这个哈希值通过查询本身，数据库，客户端版本号等一些影响结果计算得到，2个查询不同（空格，注释等），不会命中</p>\n<p><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">如果查询中包含任何用户自定义函数、存储函数、用户变量、临时表、MySQL库中的系统表，其查询结果都不会被缓存</span>  </p>\n<p><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\"><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">函数NOW()或者CURRENT_DATE()<br>       <span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">包含CURRENT_USER或者CONNECION_ID()</span></span><br></span></p>\n<p><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\"><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\"><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\"><br></span></span></span></p>\n<p>      缓存何时失效</p>\n<p> 查询缓存系统会跟踪查询语句中涉及的每个表，如果这些表（结构或数据）发生变化，那么和这张表相关联的所有缓存数据都将失效。</p>\n<p>   如何写操作都会导致缓存失效</p>\n<p>如果查询缓存非常大或者碎片很多，带来很大系统消耗，甚至系统僵死一会儿，查询对缓存的额外消耗不仅在写操作，读操作也不例外：</p>\n<p>1.任何查询语句开始前必须经过检查缓存，即使这条sql语句永远不会命中</p>\n<p>2.如何结果可以被缓存，那么执行完成后会将结果写入缓存，也会带来额外消耗</p>\n<p><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">并不是什么情况下查询缓存都会提高系统性能，缓存和失效都会带来额外消耗，</span>只有缓存带来资源消耗大于本身消耗资源时，才会给系统带来性能提升  </p>\n<p><span wiz-span=\"data-wiz-span\"\nstyle=\"background-color: rgb(255, 255, 0);\">优化：</span></p>\n<p><span wiz-span=\"data-wiz-span\"\nstyle=\"background-color: rgb(255, 255, 0);\"><br> 多个小表代替大表，避免过度设计</span></p>\n<p><span wiz-span=\"data-wiz-span\"\nstyle=\"background-color: rgb(255, 255, 0);\"> 缓存空间大小设置<br>，几十兆</span></p>\n<p><span wiz-span=\"data-wiz-span\"\nstyle=\"background-color: rgb(255, 255, 0);\"><br>批量插入代替循环单条插入</span></p>\n<p><span wiz-span=\"data-wiz-span\"\nstyle=\"background-color: rgb(255, 255, 0);\"> 通过SQL_CACHE<br>和SQL_NO_CACHE控制某条语句是否需要进行缓存</span></p>\n<p>写密集型应用不要打开缓存，QUERY_CACHE_TYPE 设置 DEMAND<br> ，只有加入SQL_CACHE的查询才会走缓存</p>\n<p>缓存如何使用内存？</p>\n<p>缓存如何控制内存的碎片化？</p>\n<p>事务对查询缓存的影响？</p>\n<h3 id=\"语法解析和预处理\"><a href=\"#语法解析和预处理\" class=\"headerlink\" title=\"语法解析和预处理\"></a>语法解析和预处理</h3><p>mysql通过  关键字   将sql语句进行解析并生成一颗对应 解析树 </p>\n<p>过程解析器主要通过语法规则来验证和解析（关键字，关键字顺序是否正确）   </p>\n<p>预处理 会根据mysql规则进一步检查解析树是否合法 （数据表，列是否存在）</p>\n<h3 id=\"查询优化\"><a href=\"#查询优化\" class=\"headerlink\" title=\"查询优化\"></a>查询优化</h3><p>   经过解析和预处理的语法树被认为合法，并且有优化器将其转化成查询计划；</p>\n<p>一般一条查询有多种查询方式，返回相同结果，优化器会选择最好的执行计划</p>\n<p>查询当前会话的 last_query_cost 值来计算当前查询的成本</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show status like &#x27;last_query_cost&#x27;</span><br></pre></td></tr></table></figure>\n\n<p><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\">这些统计信息包括：每张表或者索引的页面个数、索引的基数、索引和数据行的长度、索引的分布情况等等。</span>  </p>\n<p><span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\"><br></span></p>\n<p>MySQL 和我们想的不一样（我们执行时间短，mysq<br>值认为选择它认为成本小的，并不意味执行时间短）</p>\n<p><span wiz-span=\"data-wiz-span\" style=\"color: rgb(255, 0, 0);\">驱动表<br></span>：<strong>mysql中指定了连接条件时，满足查询条件的记录行数少的表为驱动表；如未指定查询条件，则扫描行数少的为驱动表。mysql优化器就是这么粗暴以小表驱动大表的方式来决定执行顺序的</strong><span\nstyle=\"color:rgb(75, 75, 75);font-size:1rem;background-color:rgb(255, 255, 255);\">。</span></p>\n<p><span\nstyle=\"color:rgb(75, 75, 75);font-size:1rem;background-color:rgb(255, 255, 255);\"> <br> STRAIGHT_JOIN功能同join类似，但能让左边的表来驱动右边的表，能改表优化器对于联表查询的执行顺序</span>  </p>\n<p>查询优化器是一个非常复杂的部件，它使用非常多的优化策略来生成一个最优执行计划：</p>\n<p>1.重新定义表关联<span\nstyle=\"font-size: 1rem; background-color: rgb(255, 255, 255);\">顺序（多表关联查询时，并不一定按照SQL指定顺序进行）</span></p>\n<p><span\nstyle=\"color:rgb(75, 75, 75);font-size:1rem;background-color:rgb(255, 255, 255);\"> <br> STRAIGHT_JOIN只适用于inner join，并不使用与left join，right join</span></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> t1.<span class=\"operator\">*</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> Table1 t1</span><br><span class=\"line\">STRAIGHT_JOIN  Table2 t2</span><br><span class=\"line\"><span class=\"keyword\">on</span> t1.id <span class=\"operator\">=</span> t2.id</span><br><span class=\"line\"><span class=\"keyword\">where</span> t1.stu <span class=\"operator\">=</span> <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n\n<p>2.优化MIN()和MAX()函数（找某列的最小值，如果该列有索引，只需要查找B+Tree索引最左端，反之则可以找到最大值)  </p>\n<p>3.提前终止查询 <span\nstyle=\"font-size: 0.813rem; background-color: rgb(254, 254, 242);\"> </span>（分页limit  ）</p>\n<p>4.优化排序（单次传输排序，也就是一次读取所有的数据行，然后根据给定的列排序）</p>\n<h3 id=\"查询执行引擎\"><a href=\"#查询执行引擎\" class=\"headerlink\" title=\"查询执行引擎\"></a>查询执行引擎</h3><p>在完成解析和优化后，MySQL会生成对应执行计划，查询执行引擎根据执行计划指令依次执行得出结果。</p>\n<p>整个过程通过调用存储引擎实现接口（handler<br>api）每一张表一个handler实例表示，优化器可以根据这些实例接口来获取表的相关信息，包括列名，索引统计信息</p>\n<p>查询过程：</p>\n<ul>\n<li><p>客户端向MySQL服务器发送一条查询请求</p>\n</li>\n<li><p>服务器首先检查查询缓存，如果命中缓存，则立刻返回存储在缓存中的结果。否则进入下一阶段</p>\n</li>\n<li><p>服务器进行SQL解析、预处理、再由优化器生成对应的执行计划</p>\n</li>\n<li><p>MySQL根据执行计划，调用存储引擎的API来执行查询</p>\n</li>\n<li><p>将结果通过tcp协议进行传输返回给客户端，同时缓存查询结果</p>\n</li>\n</ul>"},{"title":"pandoc文本格式转换","date":"2022-09-03T11:52:46.000Z","_content":"\n###  pandoc\n\npandoc 标记语言转换工具，可实现不同标记语言间的格式转换\n\n在线转换测试 https://pandoc.org/try/\n\n下载 https://github.com/jgm/pandoc/releases/tag/2.19.2\n\n#### linux\n\n##### html 转 md\n\n```shell\n /opt/tools/pandoc-2.19.2/bin/pandoc -i  test.html  --to markdown_github -o test.md\n```\n\n别名\n\n<!--more-->\n\n```shell\n$ cat  >> ~/.bashrc <<EOF \n######### custom start###########\nCMD(){\n  url=~/.local/custom/$1\n  [ -f \"$url\" ] && source $url\n}\n\nif [ -f \"/opt/tools/pandoc-2.19.2/bin/pandoc\" ] ; then \n   CMD pandoc.sh\n   alias tom='htomd $1 $2'\nfi\n######### custom end###########\nEOF\n\n```\n\n~/.local/custom/pamdoc.sh\n\n```shell\ntomd(){\n   [ \"help\" == $1  -o -z \"$1\"  ] && { echo \"eg: tom xx.html xxx.md\" && return; }\n   echo \"pandoc from html to md\"\n  /opt/tools/pandoc-2.19.2/bin/pandoc -i  $1  --to markdown_github -o $2\n}\n```\n\n\n\n```shell\ntom   /xx/xx.html    /xxx/xxxx.md\n```\n\n\n\n\n\n#### 文档\n\nhttps://www.pandoc.org/demos.html#\n\n","source":"_posts/markdown/pandoc.md","raw":"---\ntitle: pandoc文本格式转换\npermalink: markdown/pandoc/\ntags:\n  - format\n  - md\n  - html\ncategories:\n  - markdown\n  - pandoc\ndate: 2022-09-03 19:52:46\n---\n\n###  pandoc\n\npandoc 标记语言转换工具，可实现不同标记语言间的格式转换\n\n在线转换测试 https://pandoc.org/try/\n\n下载 https://github.com/jgm/pandoc/releases/tag/2.19.2\n\n#### linux\n\n##### html 转 md\n\n```shell\n /opt/tools/pandoc-2.19.2/bin/pandoc -i  test.html  --to markdown_github -o test.md\n```\n\n别名\n\n<!--more-->\n\n```shell\n$ cat  >> ~/.bashrc <<EOF \n######### custom start###########\nCMD(){\n  url=~/.local/custom/$1\n  [ -f \"$url\" ] && source $url\n}\n\nif [ -f \"/opt/tools/pandoc-2.19.2/bin/pandoc\" ] ; then \n   CMD pandoc.sh\n   alias tom='htomd $1 $2'\nfi\n######### custom end###########\nEOF\n\n```\n\n~/.local/custom/pamdoc.sh\n\n```shell\ntomd(){\n   [ \"help\" == $1  -o -z \"$1\"  ] && { echo \"eg: tom xx.html xxx.md\" && return; }\n   echo \"pandoc from html to md\"\n  /opt/tools/pandoc-2.19.2/bin/pandoc -i  $1  --to markdown_github -o $2\n}\n```\n\n\n\n```shell\ntom   /xx/xx.html    /xxx/xxxx.md\n```\n\n\n\n\n\n#### 文档\n\nhttps://www.pandoc.org/demos.html#\n\n","slug":"markdown/pandoc","published":1,"updated":"2022-09-04T12:29:08.913Z","__permalink":"markdown/pandoc/","_id":"cl7m1l254000076i58zym5byt","comments":1,"layout":"post","photos":[],"link":"","content":"<h3 id=\"pandoc\"><a href=\"#pandoc\" class=\"headerlink\" title=\"pandoc\"></a>pandoc</h3><p>pandoc 标记语言转换工具，可实现不同标记语言间的格式转换</p>\n<p>在线转换测试 <a href=\"https://pandoc.org/try/\">https://pandoc.org/try/</a></p>\n<p>下载 <a href=\"https://github.com/jgm/pandoc/releases/tag/2.19.2\">https://github.com/jgm/pandoc/releases/tag/2.19.2</a></p>\n<h4 id=\"linux\"><a href=\"#linux\" class=\"headerlink\" title=\"linux\"></a>linux</h4><h5 id=\"html-转-md\"><a href=\"#html-转-md\" class=\"headerlink\" title=\"html 转 md\"></a>html 转 md</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/opt/tools/pandoc-2.19.2/bin/pandoc -i  test.html  --to markdown_github -o test.md</span><br></pre></td></tr></table></figure>\n\n<p>别名</p>\n<span id=\"more\"></span>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\"><span class=\"built_in\">cat</span>  &gt;&gt; ~/.bashrc &lt;&lt;<span class=\"string\">EOF</span></span> </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\">######## custom start###########</span></span></span><br><span class=\"line\">CMD()&#123;</span><br><span class=\"line\">  url=~/.local/custom/$1</span><br><span class=\"line\">  [ -f &quot;$url&quot; ] &amp;&amp; source $url</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">if [ -f &quot;/opt/tools/pandoc-2.19.2/bin/pandoc&quot; ] ; then </span><br><span class=\"line\">   CMD pandoc.sh</span><br><span class=\"line\">   alias tom=&#x27;htomd $1 $2&#x27;</span><br><span class=\"line\">fi</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\">######## custom end###########</span></span></span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>~&#x2F;.local&#x2F;custom&#x2F;pamdoc.sh</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tomd()&#123;</span><br><span class=\"line\">   [ &quot;help&quot; == $1  -o -z &quot;$1&quot;  ] &amp;&amp; &#123; echo &quot;eg: tom xx.html xxx.md&quot; &amp;&amp; return; &#125;</span><br><span class=\"line\">   echo &quot;pandoc from html to md&quot;</span><br><span class=\"line\">  /opt/tools/pandoc-2.19.2/bin/pandoc -i  $1  --to markdown_github -o $2</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tom   /xx/xx.html    /xxx/xxxx.md</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h4 id=\"文档\"><a href=\"#文档\" class=\"headerlink\" title=\"文档\"></a>文档</h4><p><a href=\"https://www.pandoc.org/demos.html#\">https://www.pandoc.org/demos.html#</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"pandoc\"><a href=\"#pandoc\" class=\"headerlink\" title=\"pandoc\"></a>pandoc</h3><p>pandoc 标记语言转换工具，可实现不同标记语言间的格式转换</p>\n<p>在线转换测试 <a href=\"https://pandoc.org/try/\">https://pandoc.org/try/</a></p>\n<p>下载 <a href=\"https://github.com/jgm/pandoc/releases/tag/2.19.2\">https://github.com/jgm/pandoc/releases/tag/2.19.2</a></p>\n<h4 id=\"linux\"><a href=\"#linux\" class=\"headerlink\" title=\"linux\"></a>linux</h4><h5 id=\"html-转-md\"><a href=\"#html-转-md\" class=\"headerlink\" title=\"html 转 md\"></a>html 转 md</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/opt/tools/pandoc-2.19.2/bin/pandoc -i  test.html  --to markdown_github -o test.md</span><br></pre></td></tr></table></figure>\n\n<p>别名</p>","more":"<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\"><span class=\"built_in\">cat</span>  &gt;&gt; ~/.bashrc &lt;&lt;<span class=\"string\">EOF</span></span> </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\">######## custom start###########</span></span></span><br><span class=\"line\">CMD()&#123;</span><br><span class=\"line\">  url=~/.local/custom/$1</span><br><span class=\"line\">  [ -f &quot;$url&quot; ] &amp;&amp; source $url</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">if [ -f &quot;/opt/tools/pandoc-2.19.2/bin/pandoc&quot; ] ; then </span><br><span class=\"line\">   CMD pandoc.sh</span><br><span class=\"line\">   alias tom=&#x27;htomd $1 $2&#x27;</span><br><span class=\"line\">fi</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\">######## custom end###########</span></span></span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>~&#x2F;.local&#x2F;custom&#x2F;pamdoc.sh</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tomd()&#123;</span><br><span class=\"line\">   [ &quot;help&quot; == $1  -o -z &quot;$1&quot;  ] &amp;&amp; &#123; echo &quot;eg: tom xx.html xxx.md&quot; &amp;&amp; return; &#125;</span><br><span class=\"line\">   echo &quot;pandoc from html to md&quot;</span><br><span class=\"line\">  /opt/tools/pandoc-2.19.2/bin/pandoc -i  $1  --to markdown_github -o $2</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tom   /xx/xx.html    /xxx/xxxx.md</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h4 id=\"文档\"><a href=\"#文档\" class=\"headerlink\" title=\"文档\"></a>文档</h4><p><a href=\"https://www.pandoc.org/demos.html#\">https://www.pandoc.org/demos.html#</a></p>"},{"title":"explain执行计划","date":"2022-09-03T14:41:04.000Z","_content":"\n## explain\n\n\n\n执行计划\n\n```\nexplain select  .....   from  .... [  where ... ]\n```\n\n\n\n![img](/pics/1882599998.png)\n\n\n\n### id\n\n- [id](http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#id)  顺序标识整个查询过程 数值越大先执行，可能为空（union）\n\n\n\n### select_type\n\n- [select_type](http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#select_type) 查询类型（常见几种）\n\n<!--more-->\n\n SIMPLE \n\n​    简单查询，不带条件\n\n  PRIMARY \n\n​     最外层查询，union(前面查询)\n\n UNION\n\n​    UNION第二个及后面select语句\n\n DERIVED\n\n​    嵌套select查询\n\n UNION RESULT\n\n​    一个UNION查询的结果\n\n DEPENEDNET UNION\n\n   需要满足UNION条件, 及UNION第二个及后面SELECT语句，同时该语句依赖外部查询\n\n  \n\n\n```\nselect  * from user where id in\n   (  \n           select  * from  user_info  where tel=123 \n    union \n          select * from user_info  where  age>12     \n);\n\n#  in 操作符 优化为\nselect  * from user where  exists (\n        select * from user_info tel=123 \n  union \n       select * from user_info  where age > 12 \n  and   user_info.uid=user.id  \n); \n```\n\n\n\n SUBQUERY\n\n​    子查询中的第一个SELECT查询   \n\n\n\n### table\n\n- [table](http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#table)\n\n 不一名是真实表名，num代表id(执行顺序)值 <select_type[id]>\n\n   eg: <derived3>  <union2,3>\n\n   \n\n### type\n\n- [type](http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#type)\n\nconst\n\n  确定只有一行匹配，通常用在主键或唯一索引上进行比较时\n\nsystem const \n\n   表仅有一行满足条件\n\neq_ref\n\n  innodb 与 syisam 有区别\n\n  被连接使用并且索引是union或primary key\n\n  使用=操作符比较带索引的列\n\nref\n\n 关联操作只使用了索引的最左前缀，或索引不是union和primary key\n\n 使用=或< = > 操作符带索引列\n\nfulltext\n\n  全文索引 （B树）\n\nref_or_null  \n\n  与ref类似，额外搜索包含null列\n\nindex_merger \n\n 使用了索引合并优化方法\n\nunique_subquery\n\n \n\nindex_subquery\n\n\n\nrange\n\n  只检索给定范围的行，使用一个索引来选择行，\n\n  key列显示使用那个索引，key_len包含所使用索引最长关键元素\n\n   使用=、<>、>、>=、<、<=、IS NULL、<=>、BETWEEN或者IN操作符，用常量比较关键列时\n\nindex  \n\n  是否使用索引进行排序\n\nALL \n\n  全表扫描 \n\n\n\n### possible_keys\n\n- [possible_keys](http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#possible_keys)\n\n  使用哪个索引查找行\n\n\n\n### key\n\n- [key](http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#key)\n\n显示实际使用键（索引），没有索引为null\n\n 强制或忽视索引  force index,use index或ignore index\n\n\n\n### key_len\n\n- [key_len](http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#key_len)\n\n 使用的键长度。如果键是NULL，则长度为NULL ,越短越好（不损失精确度）\n\n\n\n### ref\n\n- [ref](http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#ref)\n\n 使用那个列或常数 与 key 一起从表中选择行\n\n\n\n### rows\n\n- [rows](http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#rows)\n\n执行查询时必须检测行数（预估值）\n\n\n\n### Extra\n\n- [Extra](http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#Extra) 常用\n\n using filesort\n\n   生成有序结果（排序或索引）  【order  by，group by 默认对字段排序（order by **null禁止排序**） 】\n\n using temporary\n\n  使用了临时表，要避免临时表使用\n\n not exists\n\n  优化 left join \n\n using index\n\n 查询覆盖了索引，mysql直接从索引中过滤不需要记录并发挥命中\n\nusing index condition\n\n  索引条件推送（v5.6版），在二级索引上进行like操作\n\nusing where \n\n 表示MySQL服务器将存储引擎返回服务层以后再应用WHERE条件过滤。\n\n\n\n\n\n","source":"_posts/services/database/mysql/explain.md","raw":"---\ntitle: explain执行计划\npermalink: services/database/mysql/explain/\ntags:\n  - explain执行计划\n  - xx\n  - xxx\ncategories:\n  - services\n  - database\n  - mysql\n  - explain\ndate: 2022-09-03 22:41:04\n---\n\n## explain\n\n\n\n执行计划\n\n```\nexplain select  .....   from  .... [  where ... ]\n```\n\n\n\n![img](/pics/1882599998.png)\n\n\n\n### id\n\n- [id](http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#id)  顺序标识整个查询过程 数值越大先执行，可能为空（union）\n\n\n\n### select_type\n\n- [select_type](http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#select_type) 查询类型（常见几种）\n\n<!--more-->\n\n SIMPLE \n\n​    简单查询，不带条件\n\n  PRIMARY \n\n​     最外层查询，union(前面查询)\n\n UNION\n\n​    UNION第二个及后面select语句\n\n DERIVED\n\n​    嵌套select查询\n\n UNION RESULT\n\n​    一个UNION查询的结果\n\n DEPENEDNET UNION\n\n   需要满足UNION条件, 及UNION第二个及后面SELECT语句，同时该语句依赖外部查询\n\n  \n\n\n```\nselect  * from user where id in\n   (  \n           select  * from  user_info  where tel=123 \n    union \n          select * from user_info  where  age>12     \n);\n\n#  in 操作符 优化为\nselect  * from user where  exists (\n        select * from user_info tel=123 \n  union \n       select * from user_info  where age > 12 \n  and   user_info.uid=user.id  \n); \n```\n\n\n\n SUBQUERY\n\n​    子查询中的第一个SELECT查询   \n\n\n\n### table\n\n- [table](http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#table)\n\n 不一名是真实表名，num代表id(执行顺序)值 <select_type[id]>\n\n   eg: <derived3>  <union2,3>\n\n   \n\n### type\n\n- [type](http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#type)\n\nconst\n\n  确定只有一行匹配，通常用在主键或唯一索引上进行比较时\n\nsystem const \n\n   表仅有一行满足条件\n\neq_ref\n\n  innodb 与 syisam 有区别\n\n  被连接使用并且索引是union或primary key\n\n  使用=操作符比较带索引的列\n\nref\n\n 关联操作只使用了索引的最左前缀，或索引不是union和primary key\n\n 使用=或< = > 操作符带索引列\n\nfulltext\n\n  全文索引 （B树）\n\nref_or_null  \n\n  与ref类似，额外搜索包含null列\n\nindex_merger \n\n 使用了索引合并优化方法\n\nunique_subquery\n\n \n\nindex_subquery\n\n\n\nrange\n\n  只检索给定范围的行，使用一个索引来选择行，\n\n  key列显示使用那个索引，key_len包含所使用索引最长关键元素\n\n   使用=、<>、>、>=、<、<=、IS NULL、<=>、BETWEEN或者IN操作符，用常量比较关键列时\n\nindex  \n\n  是否使用索引进行排序\n\nALL \n\n  全表扫描 \n\n\n\n### possible_keys\n\n- [possible_keys](http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#possible_keys)\n\n  使用哪个索引查找行\n\n\n\n### key\n\n- [key](http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#key)\n\n显示实际使用键（索引），没有索引为null\n\n 强制或忽视索引  force index,use index或ignore index\n\n\n\n### key_len\n\n- [key_len](http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#key_len)\n\n 使用的键长度。如果键是NULL，则长度为NULL ,越短越好（不损失精确度）\n\n\n\n### ref\n\n- [ref](http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#ref)\n\n 使用那个列或常数 与 key 一起从表中选择行\n\n\n\n### rows\n\n- [rows](http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#rows)\n\n执行查询时必须检测行数（预估值）\n\n\n\n### Extra\n\n- [Extra](http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#Extra) 常用\n\n using filesort\n\n   生成有序结果（排序或索引）  【order  by，group by 默认对字段排序（order by **null禁止排序**） 】\n\n using temporary\n\n  使用了临时表，要避免临时表使用\n\n not exists\n\n  优化 left join \n\n using index\n\n 查询覆盖了索引，mysql直接从索引中过滤不需要记录并发挥命中\n\nusing index condition\n\n  索引条件推送（v5.6版），在二级索引上进行like操作\n\nusing where \n\n 表示MySQL服务器将存储引擎返回服务层以后再应用WHERE条件过滤。\n\n\n\n\n\n","slug":"services/database/mysql/explain","published":1,"updated":"2022-09-04T12:06:56.733Z","__permalink":"services/database/mysql/explain/","_id":"cl7m1l25j000276i55jblgef3","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"explain\"><a href=\"#explain\" class=\"headerlink\" title=\"explain\"></a>explain</h2><p>执行计划</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">explain select  .....   from  .... [  where ... ]</span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/pics/1882599998.png\" alt=\"img\"></p>\n<h3 id=\"id\"><a href=\"#id\" class=\"headerlink\" title=\"id\"></a>id</h3><ul>\n<li><a href=\"http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#id\">id</a>  顺序标识整个查询过程 数值越大先执行，可能为空（union）</li>\n</ul>\n<h3 id=\"select-type\"><a href=\"#select-type\" class=\"headerlink\" title=\"select_type\"></a>select_type</h3><ul>\n<li><a href=\"http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#select_type\">select_type</a> 查询类型（常见几种）</li>\n</ul>\n<span id=\"more\"></span>\n\n<p> SIMPLE </p>\n<p>​    简单查询，不带条件</p>\n<p>  PRIMARY </p>\n<p>​     最外层查询，union(前面查询)</p>\n<p> UNION</p>\n<p>​    UNION第二个及后面select语句</p>\n<p> DERIVED</p>\n<p>​    嵌套select查询</p>\n<p> UNION RESULT</p>\n<p>​    一个UNION查询的结果</p>\n<p> DEPENEDNET UNION</p>\n<p>   需要满足UNION条件, 及UNION第二个及后面SELECT语句，同时该语句依赖外部查询</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select  * from user where id in</span><br><span class=\"line\">   (  </span><br><span class=\"line\">           select  * from  user_info  where tel=123 </span><br><span class=\"line\">    union </span><br><span class=\"line\">          select * from user_info  where  age&gt;12     </span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">#  in 操作符 优化为</span><br><span class=\"line\">select  * from user where  exists (</span><br><span class=\"line\">        select * from user_info tel=123 </span><br><span class=\"line\">  union </span><br><span class=\"line\">       select * from user_info  where age &gt; 12 </span><br><span class=\"line\">  and   user_info.uid=user.id  </span><br><span class=\"line\">); </span><br></pre></td></tr></table></figure>\n\n\n\n<p> SUBQUERY</p>\n<p>​    子查询中的第一个SELECT查询   </p>\n<h3 id=\"table\"><a href=\"#table\" class=\"headerlink\" title=\"table\"></a>table</h3><ul>\n<li><a href=\"http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#table\">table</a></li>\n</ul>\n<p> 不一名是真实表名，num代表id(执行顺序)值 &lt;select_type[id]&gt;</p>\n<p>   eg: <derived3>  &lt;union2,3&gt;</p>\n<h3 id=\"type\"><a href=\"#type\" class=\"headerlink\" title=\"type\"></a>type</h3><ul>\n<li><a href=\"http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#type\">type</a></li>\n</ul>\n<p>const</p>\n<p>  确定只有一行匹配，通常用在主键或唯一索引上进行比较时</p>\n<p>system const </p>\n<p>   表仅有一行满足条件</p>\n<p>eq_ref</p>\n<p>  innodb 与 syisam 有区别</p>\n<p>  被连接使用并且索引是union或primary key</p>\n<p>  使用&#x3D;操作符比较带索引的列</p>\n<p>ref</p>\n<p> 关联操作只使用了索引的最左前缀，或索引不是union和primary key</p>\n<p> 使用&#x3D;或&lt; &#x3D; &gt; 操作符带索引列</p>\n<p>fulltext</p>\n<p>  全文索引 （B树）</p>\n<p>ref_or_null  </p>\n<p>  与ref类似，额外搜索包含null列</p>\n<p>index_merger </p>\n<p> 使用了索引合并优化方法</p>\n<p>unique_subquery</p>\n<p>index_subquery</p>\n<p>range</p>\n<p>  只检索给定范围的行，使用一个索引来选择行，</p>\n<p>  key列显示使用那个索引，key_len包含所使用索引最长关键元素</p>\n<p>   使用&#x3D;、&lt;&gt;、&gt;、&gt;&#x3D;、&lt;、&lt;&#x3D;、IS NULL、&lt;&#x3D;&gt;、BETWEEN或者IN操作符，用常量比较关键列时</p>\n<p>index  </p>\n<p>  是否使用索引进行排序</p>\n<p>ALL </p>\n<p>  全表扫描 </p>\n<h3 id=\"possible-keys\"><a href=\"#possible-keys\" class=\"headerlink\" title=\"possible_keys\"></a>possible_keys</h3><ul>\n<li><p><a href=\"http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#possible_keys\">possible_keys</a></p>\n<p>使用哪个索引查找行</p>\n</li>\n</ul>\n<h3 id=\"key\"><a href=\"#key\" class=\"headerlink\" title=\"key\"></a>key</h3><ul>\n<li><a href=\"http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#key\">key</a></li>\n</ul>\n<p>显示实际使用键（索引），没有索引为null</p>\n<p> 强制或忽视索引  force index,use index或ignore index</p>\n<h3 id=\"key-len\"><a href=\"#key-len\" class=\"headerlink\" title=\"key_len\"></a>key_len</h3><ul>\n<li><a href=\"http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#key_len\">key_len</a></li>\n</ul>\n<p> 使用的键长度。如果键是NULL，则长度为NULL ,越短越好（不损失精确度）</p>\n<h3 id=\"ref\"><a href=\"#ref\" class=\"headerlink\" title=\"ref\"></a>ref</h3><ul>\n<li><a href=\"http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#ref\">ref</a></li>\n</ul>\n<p> 使用那个列或常数 与 key 一起从表中选择行</p>\n<h3 id=\"rows\"><a href=\"#rows\" class=\"headerlink\" title=\"rows\"></a>rows</h3><ul>\n<li><a href=\"http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#rows\">rows</a></li>\n</ul>\n<p>执行查询时必须检测行数（预估值）</p>\n<h3 id=\"Extra\"><a href=\"#Extra\" class=\"headerlink\" title=\"Extra\"></a>Extra</h3><ul>\n<li><a href=\"http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#Extra\">Extra</a> 常用</li>\n</ul>\n<p> using filesort</p>\n<p>   生成有序结果（排序或索引）  【order  by，group by 默认对字段排序（order by <strong>null禁止排序</strong>） 】</p>\n<p> using temporary</p>\n<p>  使用了临时表，要避免临时表使用</p>\n<p> not exists</p>\n<p>  优化 left join </p>\n<p> using index</p>\n<p> 查询覆盖了索引，mysql直接从索引中过滤不需要记录并发挥命中</p>\n<p>using index condition</p>\n<p>  索引条件推送（v5.6版），在二级索引上进行like操作</p>\n<p>using where </p>\n<p> 表示MySQL服务器将存储引擎返回服务层以后再应用WHERE条件过滤。</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"explain\"><a href=\"#explain\" class=\"headerlink\" title=\"explain\"></a>explain</h2><p>执行计划</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">explain select  .....   from  .... [  where ... ]</span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/pics/1882599998.png\" alt=\"img\"></p>\n<h3 id=\"id\"><a href=\"#id\" class=\"headerlink\" title=\"id\"></a>id</h3><ul>\n<li><a href=\"http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#id\">id</a>  顺序标识整个查询过程 数值越大先执行，可能为空（union）</li>\n</ul>\n<h3 id=\"select-type\"><a href=\"#select-type\" class=\"headerlink\" title=\"select_type\"></a>select_type</h3><ul>\n<li><a href=\"http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#select_type\">select_type</a> 查询类型（常见几种）</li>\n</ul>","more":"<p> SIMPLE </p>\n<p>​    简单查询，不带条件</p>\n<p>  PRIMARY </p>\n<p>​     最外层查询，union(前面查询)</p>\n<p> UNION</p>\n<p>​    UNION第二个及后面select语句</p>\n<p> DERIVED</p>\n<p>​    嵌套select查询</p>\n<p> UNION RESULT</p>\n<p>​    一个UNION查询的结果</p>\n<p> DEPENEDNET UNION</p>\n<p>   需要满足UNION条件, 及UNION第二个及后面SELECT语句，同时该语句依赖外部查询</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select  * from user where id in</span><br><span class=\"line\">   (  </span><br><span class=\"line\">           select  * from  user_info  where tel=123 </span><br><span class=\"line\">    union </span><br><span class=\"line\">          select * from user_info  where  age&gt;12     </span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">#  in 操作符 优化为</span><br><span class=\"line\">select  * from user where  exists (</span><br><span class=\"line\">        select * from user_info tel=123 </span><br><span class=\"line\">  union </span><br><span class=\"line\">       select * from user_info  where age &gt; 12 </span><br><span class=\"line\">  and   user_info.uid=user.id  </span><br><span class=\"line\">); </span><br></pre></td></tr></table></figure>\n\n\n\n<p> SUBQUERY</p>\n<p>​    子查询中的第一个SELECT查询   </p>\n<h3 id=\"table\"><a href=\"#table\" class=\"headerlink\" title=\"table\"></a>table</h3><ul>\n<li><a href=\"http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#table\">table</a></li>\n</ul>\n<p> 不一名是真实表名，num代表id(执行顺序)值 &lt;select_type[id]&gt;</p>\n<p>   eg: <derived3>  &lt;union2,3&gt;</p>\n<h3 id=\"type\"><a href=\"#type\" class=\"headerlink\" title=\"type\"></a>type</h3><ul>\n<li><a href=\"http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#type\">type</a></li>\n</ul>\n<p>const</p>\n<p>  确定只有一行匹配，通常用在主键或唯一索引上进行比较时</p>\n<p>system const </p>\n<p>   表仅有一行满足条件</p>\n<p>eq_ref</p>\n<p>  innodb 与 syisam 有区别</p>\n<p>  被连接使用并且索引是union或primary key</p>\n<p>  使用&#x3D;操作符比较带索引的列</p>\n<p>ref</p>\n<p> 关联操作只使用了索引的最左前缀，或索引不是union和primary key</p>\n<p> 使用&#x3D;或&lt; &#x3D; &gt; 操作符带索引列</p>\n<p>fulltext</p>\n<p>  全文索引 （B树）</p>\n<p>ref_or_null  </p>\n<p>  与ref类似，额外搜索包含null列</p>\n<p>index_merger </p>\n<p> 使用了索引合并优化方法</p>\n<p>unique_subquery</p>\n<p>index_subquery</p>\n<p>range</p>\n<p>  只检索给定范围的行，使用一个索引来选择行，</p>\n<p>  key列显示使用那个索引，key_len包含所使用索引最长关键元素</p>\n<p>   使用&#x3D;、&lt;&gt;、&gt;、&gt;&#x3D;、&lt;、&lt;&#x3D;、IS NULL、&lt;&#x3D;&gt;、BETWEEN或者IN操作符，用常量比较关键列时</p>\n<p>index  </p>\n<p>  是否使用索引进行排序</p>\n<p>ALL </p>\n<p>  全表扫描 </p>\n<h3 id=\"possible-keys\"><a href=\"#possible-keys\" class=\"headerlink\" title=\"possible_keys\"></a>possible_keys</h3><ul>\n<li><p><a href=\"http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#possible_keys\">possible_keys</a></p>\n<p>使用哪个索引查找行</p>\n</li>\n</ul>\n<h3 id=\"key\"><a href=\"#key\" class=\"headerlink\" title=\"key\"></a>key</h3><ul>\n<li><a href=\"http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#key\">key</a></li>\n</ul>\n<p>显示实际使用键（索引），没有索引为null</p>\n<p> 强制或忽视索引  force index,use index或ignore index</p>\n<h3 id=\"key-len\"><a href=\"#key-len\" class=\"headerlink\" title=\"key_len\"></a>key_len</h3><ul>\n<li><a href=\"http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#key_len\">key_len</a></li>\n</ul>\n<p> 使用的键长度。如果键是NULL，则长度为NULL ,越短越好（不损失精确度）</p>\n<h3 id=\"ref\"><a href=\"#ref\" class=\"headerlink\" title=\"ref\"></a>ref</h3><ul>\n<li><a href=\"http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#ref\">ref</a></li>\n</ul>\n<p> 使用那个列或常数 与 key 一起从表中选择行</p>\n<h3 id=\"rows\"><a href=\"#rows\" class=\"headerlink\" title=\"rows\"></a>rows</h3><ul>\n<li><a href=\"http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#rows\">rows</a></li>\n</ul>\n<p>执行查询时必须检测行数（预估值）</p>\n<h3 id=\"Extra\"><a href=\"#Extra\" class=\"headerlink\" title=\"Extra\"></a>Extra</h3><ul>\n<li><a href=\"http://www.cnblogs.com/magialmoon/archive/2013/11/23/3439042.html#Extra\">Extra</a> 常用</li>\n</ul>\n<p> using filesort</p>\n<p>   生成有序结果（排序或索引）  【order  by，group by 默认对字段排序（order by <strong>null禁止排序</strong>） 】</p>\n<p> using temporary</p>\n<p>  使用了临时表，要避免临时表使用</p>\n<p> not exists</p>\n<p>  优化 left join </p>\n<p> using index</p>\n<p> 查询覆盖了索引，mysql直接从索引中过滤不需要记录并发挥命中</p>\n<p>using index condition</p>\n<p>  索引条件推送（v5.6版），在二级索引上进行like操作</p>\n<p>using where </p>\n<p> 表示MySQL服务器将存储引擎返回服务层以后再应用WHERE条件过滤。</p>"},{"title":"mysql函数","date":"2022-09-03T14:23:54.000Z","_content":"\n\n\n## 函数\n\n\n\n### case  .... when\n\n```sql\nselect \ncount(case age when 10 then age else null end) as age_num,\ncount(case name when '张五' then name end) as name_num \nfrom test_list;\n```\n\n#### 多条件统计\n\n```\nSELECT year,\n SUM(CASE WHEN type=1 THEN value ELSE 0 END) as type1,\n SUM(CASE WHEN type=2 THEN value ELSE 0 END) as type2,\n SUM(CASE WHEN type=3 THEN value ELSE 0 END) as type3,\n FROM table_test GROUP BY year\n```\n\n#### 统计状态（sum累加）\n\n```\nsum(case when type=1 then 1 else 0 end)  t1\nsum(case when type=2 then 1 else 0 end)  t2\n```\n\n\n\n<!--more-->\n\n\n\n## 存储过程\n\n### 存储过程体\n\n\\* 局部变量\n\n声明局部变量，用来存储临时结果\n\n```\nDECLARE` `var_name[,…] type [``DEFAULT` `value]\nVar_name:指定局部变量的名称\nType:用于声明局部变量的数据类型\ndefault``子句:用于为局部变量指定一个默认值。若没有指定，默认为``null``.\n```\n\n begin  ......    end  \n\n\\* set\n\n局部变量赋值\n\n 可以是任意类型数据，包括sql 查询返回值\n\n\\* select ... into  语句\n\n把返回列的值直接存储(into)到局部变量中   **结果集只能是一条数据**\n\n\\* 异常处理\n\n### 示例\n\n多个参数彼此间用逗号分隔。输入参数、输出参数和输入/输出参数，分别用in/out/inout标识。参数的取名不要与数  据表的列名相同。\n\n```\nDROP PROCEDURE IF EXISTS `test`; -- 存在删除\n\n  DELIMITER //\n  CREATE PROCEDURE test(IN `p_id` BIGINT,OUT `v_error` VARCHAR(1000))  comment \"输入，输出参数\"\n  BEGIN\n  -- 声明变量\n  DECLARE v_status INT;-- 状态\n  -- 查询\n  select [数据库字段] into [声明变量] from  表  where 条件 ;\n  -- 判断声明变量 逻辑处理  \n  SET v_status =(SELECT  DISTINCT is_flag  FROM tm_meal_standard_set_info WHERE ORG_ID =p_id AND is_flag=1 ); \n  IF(v_status IS NULL) THEN \n  SET v_status =(SELECT DISTINCT is_flag  FROM tm_meal_standard_set_info WHERE ORG_ID =p_id AND is_flag=0 );\n            IF(v_status < 1) THEN SET v_error = '失效';\n            -- ELSE SET v_error='没有0';\n              END IF;\n        -- else SET v_error='有1';\n          END IF;\n  END //\n  DELIMITER; \n\nSELECT  is_flag  FROM tm_meal_standard_set_info WHERE ORG_ID =10001268  AND  is_flag=0 AND \n NOT EXISTS (\n     SELECT  *  FROM tm_meal_standard_set_info WHERE ORG_ID =10001268  AND is_flag=1\n );\n\n\n调用\n赋值 set @p_id;\n运行 call test(@p_id,@smg);\n查询结果 select @smg;\n```\n\n\n\n","source":"_posts/services/database/mysql/function.md","raw":"---\ntitle: mysql函数\npermalink: services/database/mysql/function/\ntags:\n  - 函数\n  - function\n  - xxx\ncategories:\n  - services\n  - database\n  - mysql\ndate: 2022-09-03 22:23:54\n---\n\n\n\n## 函数\n\n\n\n### case  .... when\n\n```sql\nselect \ncount(case age when 10 then age else null end) as age_num,\ncount(case name when '张五' then name end) as name_num \nfrom test_list;\n```\n\n#### 多条件统计\n\n```\nSELECT year,\n SUM(CASE WHEN type=1 THEN value ELSE 0 END) as type1,\n SUM(CASE WHEN type=2 THEN value ELSE 0 END) as type2,\n SUM(CASE WHEN type=3 THEN value ELSE 0 END) as type3,\n FROM table_test GROUP BY year\n```\n\n#### 统计状态（sum累加）\n\n```\nsum(case when type=1 then 1 else 0 end)  t1\nsum(case when type=2 then 1 else 0 end)  t2\n```\n\n\n\n<!--more-->\n\n\n\n## 存储过程\n\n### 存储过程体\n\n\\* 局部变量\n\n声明局部变量，用来存储临时结果\n\n```\nDECLARE` `var_name[,…] type [``DEFAULT` `value]\nVar_name:指定局部变量的名称\nType:用于声明局部变量的数据类型\ndefault``子句:用于为局部变量指定一个默认值。若没有指定，默认为``null``.\n```\n\n begin  ......    end  \n\n\\* set\n\n局部变量赋值\n\n 可以是任意类型数据，包括sql 查询返回值\n\n\\* select ... into  语句\n\n把返回列的值直接存储(into)到局部变量中   **结果集只能是一条数据**\n\n\\* 异常处理\n\n### 示例\n\n多个参数彼此间用逗号分隔。输入参数、输出参数和输入/输出参数，分别用in/out/inout标识。参数的取名不要与数  据表的列名相同。\n\n```\nDROP PROCEDURE IF EXISTS `test`; -- 存在删除\n\n  DELIMITER //\n  CREATE PROCEDURE test(IN `p_id` BIGINT,OUT `v_error` VARCHAR(1000))  comment \"输入，输出参数\"\n  BEGIN\n  -- 声明变量\n  DECLARE v_status INT;-- 状态\n  -- 查询\n  select [数据库字段] into [声明变量] from  表  where 条件 ;\n  -- 判断声明变量 逻辑处理  \n  SET v_status =(SELECT  DISTINCT is_flag  FROM tm_meal_standard_set_info WHERE ORG_ID =p_id AND is_flag=1 ); \n  IF(v_status IS NULL) THEN \n  SET v_status =(SELECT DISTINCT is_flag  FROM tm_meal_standard_set_info WHERE ORG_ID =p_id AND is_flag=0 );\n            IF(v_status < 1) THEN SET v_error = '失效';\n            -- ELSE SET v_error='没有0';\n              END IF;\n        -- else SET v_error='有1';\n          END IF;\n  END //\n  DELIMITER; \n\nSELECT  is_flag  FROM tm_meal_standard_set_info WHERE ORG_ID =10001268  AND  is_flag=0 AND \n NOT EXISTS (\n     SELECT  *  FROM tm_meal_standard_set_info WHERE ORG_ID =10001268  AND is_flag=1\n );\n\n\n调用\n赋值 set @p_id;\n运行 call test(@p_id,@smg);\n查询结果 select @smg;\n```\n\n\n\n","slug":"services/database/mysql/function","published":1,"updated":"2022-09-03T14:39:32.216Z","__permalink":"services/database/mysql/function/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7m1l25l000476i5hfdwge8m","content":"<h2 id=\"函数\"><a href=\"#函数\" class=\"headerlink\" title=\"函数\"></a>函数</h2><h3 id=\"case-…-when\"><a href=\"#case-…-when\" class=\"headerlink\" title=\"case  …. when\"></a>case  …. when</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> </span><br><span class=\"line\"><span class=\"built_in\">count</span>(<span class=\"keyword\">case</span> age <span class=\"keyword\">when</span> <span class=\"number\">10</span> <span class=\"keyword\">then</span> age <span class=\"keyword\">else</span> <span class=\"keyword\">null</span> <span class=\"keyword\">end</span>) <span class=\"keyword\">as</span> age_num,</span><br><span class=\"line\"><span class=\"built_in\">count</span>(<span class=\"keyword\">case</span> name <span class=\"keyword\">when</span> <span class=\"string\">&#x27;张五&#x27;</span> <span class=\"keyword\">then</span> name <span class=\"keyword\">end</span>) <span class=\"keyword\">as</span> name_num </span><br><span class=\"line\"><span class=\"keyword\">from</span> test_list;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"多条件统计\"><a href=\"#多条件统计\" class=\"headerlink\" title=\"多条件统计\"></a>多条件统计</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT year,</span><br><span class=\"line\"> SUM(CASE WHEN type=1 THEN value ELSE 0 END) as type1,</span><br><span class=\"line\"> SUM(CASE WHEN type=2 THEN value ELSE 0 END) as type2,</span><br><span class=\"line\"> SUM(CASE WHEN type=3 THEN value ELSE 0 END) as type3,</span><br><span class=\"line\"> FROM table_test GROUP BY year</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"统计状态（sum累加）\"><a href=\"#统计状态（sum累加）\" class=\"headerlink\" title=\"统计状态（sum累加）\"></a>统计状态（sum累加）</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sum(case when type=1 then 1 else 0 end)  t1</span><br><span class=\"line\">sum(case when type=2 then 1 else 0 end)  t2</span><br></pre></td></tr></table></figure>\n\n\n\n<span id=\"more\"></span>\n\n\n\n<h2 id=\"存储过程\"><a href=\"#存储过程\" class=\"headerlink\" title=\"存储过程\"></a>存储过程</h2><h3 id=\"存储过程体\"><a href=\"#存储过程体\" class=\"headerlink\" title=\"存储过程体\"></a>存储过程体</h3><p>* 局部变量</p>\n<p>声明局部变量，用来存储临时结果</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DECLARE` `var_name[,…] type [``DEFAULT` `value]</span><br><span class=\"line\">Var_name:指定局部变量的名称</span><br><span class=\"line\">Type:用于声明局部变量的数据类型</span><br><span class=\"line\">default``子句:用于为局部变量指定一个默认值。若没有指定，默认为``null``.</span><br></pre></td></tr></table></figure>\n\n<p> begin  ……    end  </p>\n<p>* set</p>\n<p>局部变量赋值</p>\n<p> 可以是任意类型数据，包括sql 查询返回值</p>\n<p>* select … into  语句</p>\n<p>把返回列的值直接存储(into)到局部变量中   <strong>结果集只能是一条数据</strong></p>\n<p>* 异常处理</p>\n<h3 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h3><p>多个参数彼此间用逗号分隔。输入参数、输出参数和输入&#x2F;输出参数，分别用in&#x2F;out&#x2F;inout标识。参数的取名不要与数  据表的列名相同。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DROP PROCEDURE IF EXISTS `test`; -- 存在删除</span><br><span class=\"line\"></span><br><span class=\"line\">  DELIMITER //</span><br><span class=\"line\">  CREATE PROCEDURE test(IN `p_id` BIGINT,OUT `v_error` VARCHAR(1000))  comment &quot;输入，输出参数&quot;</span><br><span class=\"line\">  BEGIN</span><br><span class=\"line\">  -- 声明变量</span><br><span class=\"line\">  DECLARE v_status INT;-- 状态</span><br><span class=\"line\">  -- 查询</span><br><span class=\"line\">  select [数据库字段] into [声明变量] from  表  where 条件 ;</span><br><span class=\"line\">  -- 判断声明变量 逻辑处理  </span><br><span class=\"line\">  SET v_status =(SELECT  DISTINCT is_flag  FROM tm_meal_standard_set_info WHERE ORG_ID =p_id AND is_flag=1 ); </span><br><span class=\"line\">  IF(v_status IS NULL) THEN </span><br><span class=\"line\">  SET v_status =(SELECT DISTINCT is_flag  FROM tm_meal_standard_set_info WHERE ORG_ID =p_id AND is_flag=0 );</span><br><span class=\"line\">            IF(v_status &lt; 1) THEN SET v_error = &#x27;失效&#x27;;</span><br><span class=\"line\">            -- ELSE SET v_error=&#x27;没有0&#x27;;</span><br><span class=\"line\">              END IF;</span><br><span class=\"line\">        -- else SET v_error=&#x27;有1&#x27;;</span><br><span class=\"line\">          END IF;</span><br><span class=\"line\">  END //</span><br><span class=\"line\">  DELIMITER; </span><br><span class=\"line\"></span><br><span class=\"line\">SELECT  is_flag  FROM tm_meal_standard_set_info WHERE ORG_ID =10001268  AND  is_flag=0 AND </span><br><span class=\"line\"> NOT EXISTS (</span><br><span class=\"line\">     SELECT  *  FROM tm_meal_standard_set_info WHERE ORG_ID =10001268  AND is_flag=1</span><br><span class=\"line\"> );</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">调用</span><br><span class=\"line\">赋值 set @p_id;</span><br><span class=\"line\">运行 call test(@p_id,@smg);</span><br><span class=\"line\">查询结果 select @smg;</span><br></pre></td></tr></table></figure>\n\n\n\n","site":{"data":{}},"excerpt":"<h2 id=\"函数\"><a href=\"#函数\" class=\"headerlink\" title=\"函数\"></a>函数</h2><h3 id=\"case-…-when\"><a href=\"#case-…-when\" class=\"headerlink\" title=\"case  …. when\"></a>case  …. when</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> </span><br><span class=\"line\"><span class=\"built_in\">count</span>(<span class=\"keyword\">case</span> age <span class=\"keyword\">when</span> <span class=\"number\">10</span> <span class=\"keyword\">then</span> age <span class=\"keyword\">else</span> <span class=\"keyword\">null</span> <span class=\"keyword\">end</span>) <span class=\"keyword\">as</span> age_num,</span><br><span class=\"line\"><span class=\"built_in\">count</span>(<span class=\"keyword\">case</span> name <span class=\"keyword\">when</span> <span class=\"string\">&#x27;张五&#x27;</span> <span class=\"keyword\">then</span> name <span class=\"keyword\">end</span>) <span class=\"keyword\">as</span> name_num </span><br><span class=\"line\"><span class=\"keyword\">from</span> test_list;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"多条件统计\"><a href=\"#多条件统计\" class=\"headerlink\" title=\"多条件统计\"></a>多条件统计</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT year,</span><br><span class=\"line\"> SUM(CASE WHEN type=1 THEN value ELSE 0 END) as type1,</span><br><span class=\"line\"> SUM(CASE WHEN type=2 THEN value ELSE 0 END) as type2,</span><br><span class=\"line\"> SUM(CASE WHEN type=3 THEN value ELSE 0 END) as type3,</span><br><span class=\"line\"> FROM table_test GROUP BY year</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"统计状态（sum累加）\"><a href=\"#统计状态（sum累加）\" class=\"headerlink\" title=\"统计状态（sum累加）\"></a>统计状态（sum累加）</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sum(case when type=1 then 1 else 0 end)  t1</span><br><span class=\"line\">sum(case when type=2 then 1 else 0 end)  t2</span><br></pre></td></tr></table></figure>","more":"<h2 id=\"存储过程\"><a href=\"#存储过程\" class=\"headerlink\" title=\"存储过程\"></a>存储过程</h2><h3 id=\"存储过程体\"><a href=\"#存储过程体\" class=\"headerlink\" title=\"存储过程体\"></a>存储过程体</h3><p>* 局部变量</p>\n<p>声明局部变量，用来存储临时结果</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DECLARE` `var_name[,…] type [``DEFAULT` `value]</span><br><span class=\"line\">Var_name:指定局部变量的名称</span><br><span class=\"line\">Type:用于声明局部变量的数据类型</span><br><span class=\"line\">default``子句:用于为局部变量指定一个默认值。若没有指定，默认为``null``.</span><br></pre></td></tr></table></figure>\n\n<p> begin  ……    end  </p>\n<p>* set</p>\n<p>局部变量赋值</p>\n<p> 可以是任意类型数据，包括sql 查询返回值</p>\n<p>* select … into  语句</p>\n<p>把返回列的值直接存储(into)到局部变量中   <strong>结果集只能是一条数据</strong></p>\n<p>* 异常处理</p>\n<h3 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h3><p>多个参数彼此间用逗号分隔。输入参数、输出参数和输入&#x2F;输出参数，分别用in&#x2F;out&#x2F;inout标识。参数的取名不要与数  据表的列名相同。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DROP PROCEDURE IF EXISTS `test`; -- 存在删除</span><br><span class=\"line\"></span><br><span class=\"line\">  DELIMITER //</span><br><span class=\"line\">  CREATE PROCEDURE test(IN `p_id` BIGINT,OUT `v_error` VARCHAR(1000))  comment &quot;输入，输出参数&quot;</span><br><span class=\"line\">  BEGIN</span><br><span class=\"line\">  -- 声明变量</span><br><span class=\"line\">  DECLARE v_status INT;-- 状态</span><br><span class=\"line\">  -- 查询</span><br><span class=\"line\">  select [数据库字段] into [声明变量] from  表  where 条件 ;</span><br><span class=\"line\">  -- 判断声明变量 逻辑处理  </span><br><span class=\"line\">  SET v_status =(SELECT  DISTINCT is_flag  FROM tm_meal_standard_set_info WHERE ORG_ID =p_id AND is_flag=1 ); </span><br><span class=\"line\">  IF(v_status IS NULL) THEN </span><br><span class=\"line\">  SET v_status =(SELECT DISTINCT is_flag  FROM tm_meal_standard_set_info WHERE ORG_ID =p_id AND is_flag=0 );</span><br><span class=\"line\">            IF(v_status &lt; 1) THEN SET v_error = &#x27;失效&#x27;;</span><br><span class=\"line\">            -- ELSE SET v_error=&#x27;没有0&#x27;;</span><br><span class=\"line\">              END IF;</span><br><span class=\"line\">        -- else SET v_error=&#x27;有1&#x27;;</span><br><span class=\"line\">          END IF;</span><br><span class=\"line\">  END //</span><br><span class=\"line\">  DELIMITER; </span><br><span class=\"line\"></span><br><span class=\"line\">SELECT  is_flag  FROM tm_meal_standard_set_info WHERE ORG_ID =10001268  AND  is_flag=0 AND </span><br><span class=\"line\"> NOT EXISTS (</span><br><span class=\"line\">     SELECT  *  FROM tm_meal_standard_set_info WHERE ORG_ID =10001268  AND is_flag=1</span><br><span class=\"line\"> );</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">调用</span><br><span class=\"line\">赋值 set @p_id;</span><br><span class=\"line\">运行 call test(@p_id,@smg);</span><br><span class=\"line\">查询结果 select @smg;</span><br></pre></td></tr></table></figure>"},{"title":"mysql参数配置","date":"2022-09-03T13:41:01.000Z","_content":"\n## \n\n### 慢查询日志\n\n```\n#查看开启状态 单位秒\nshow variables like 'slow_query_log';\n#查询日志\nshow variables like '%log%';\n```\n\n\n\n- `long_query_time`是查询执行时间的阈值，超过该阈值将被记录下来。记录花费时间超过阈值的所有查询，无论它们是否使用索引。\n\n- `log_queries_not_using_indexes`告诉MySQL另外记录所有不使用索引来限制扫描行数的查询。无论执行时间如何，都会记录此条件。\n\n  https://dev.mysql.com/doc/refman/8.0/en/slow-query-log.html\n\n<!--more-->\n\n```\n#0禁用 1启用\nslow-query-log=1\n#相对路径为 datadir 目录下\nslow_query_log_file=\"cs-slow.log\"\n#缺省10秒\nlong_query_time=2\n```\n\n\n\n\n\n### emoji表情\n\n```\n#字符存储编码\nSHOW VARIABLES LIKE 'character_set_%';\n#字符连接编码\nSHOW VARIABLES LIKE 'collation_%';\n```\n\n\n\n```shell\nmysql>  SHOW VARIABLES LIKE 'character_set_%';\n+--------------------------+----------------------------+\n| Variable_name            | Value                      |\n+--------------------------+----------------------------+\n| character_set_client     | utf8mb4                    |\n| character_set_connection | utf8mb4                    |\n| character_set_database   | utf8                       |\n| character_set_filesystem | binary                     |\n| character_set_results    | utf8mb4                    |\n| character_set_server     | utf8mb4                    |\n| character_set_system     | utf8                       |\n| character_sets_dir       | /opt/mysql/share/charsets/ |\n+--------------------------+----------------------------+\n8 rows in set (0.01 sec)\n\nmysql> SHOW VARIABLES LIKE 'collation_%';\n+----------------------+--------------------+\n| Variable_name        | Value              |\n+----------------------+--------------------+\n| collation_connection | utf8mb4_unicode_ci |\n| collation_database   | utf8_bin           |\n| collation_server     | utf8mb4_unicode_ci |\n+----------------------+--------------------+\n3 rows in set (0.00 sec)\n\n```\n\n\n\n```\n[client]  \ndefault-character-set = utf8mb4\n \n[mysql]  \ndefault-character-set = utf8mb4  \n \n[mysqld]  \ncharacter-set-client-handshake = FALSE  \ncharacter-set-server=utf8mb4 \ncollation-server = utf8mb4_general_ci  \ninit_connect='SET NAMES utf8mb4'\n```\n\n> <property name=\"connectionInitSqls\" value=\"set names utf8mb4;\" />\n\n\n\nERROR Lost connection to MySQL server during query\n\n```\nmax_allowed_packet=100M\n```\n\n> 默认64M\n>\n> 如果您使用大 [`BLOB`](https://dev.mysql.com/doc/refman/8.0/en/blob.html)列或长字符串，则必须增加此值。它应该与 [`BLOB`](https://dev.mysql.com/doc/refman/8.0/en/blob.html)您要使用的最大一样大。协议限制为 [`max_allowed_packet`](https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_max_allowed_packet)1GB。该值应为 1024 的倍数；非倍数向下舍入到最接近的倍数。\n\n\n\n### console grc\n\n#### install\n\n1. Install grc (for debian systems: `apt-get install grc`)\n2. Copy both config files into your home directory: [.grcat](https://github.com/nitso/colour-mysql-console/blob/master/.grcat) and [.my.cnf](https://github.com/nitso/colour-mysql-console/blob/master/.my.cnf)\n3. Run mysql client `mysql -u <user> -p -h <hostname>`\n\n#### 配置 ~/.grcat\n\n```\n#default word color\n#regexp=[\\w.,\\:\\-_/]+\nregexp=.+\ncolours=green\n-\n#table borders\nregexp=[+\\-]+[+\\-]|[|]\ncolours=red\n-\n#data in ( ) and ' '\nregexp=\\([\\w\\d,']+\\)\ncolours=white\n-\n#numeric\nregexp=\\s[\\d\\.]+\\s*($|(?=\\|))\ncolours=yellow\n-\n#date\nregexp=\\d{4}-\\d{2}-\\d{2}\ncolours=cyan\n-\n#time\nregexp=\\d{2}:\\d{2}:\\d{2}\ncolours=cyan\n-\n#IP\nregexp=(\\d{1,3}\\.){3}\\d{1,3}(:\\d{1,5})?\ncolours=cyan\n-\n#schema\nregexp=`\\w+`\ncolours=yellow\n-\n#email\nregexp=[\\w\\.\\-_]+@[\\w\\.\\-_]+\ncolours=magenta\n-\n#row delimeter when using \\G key\nregexp=[*]+.+[*]+\ncount=stop\ncolours=white\n-\n#column names when using \\G key\nregexp=^\\s*\\w+:\ncolours=white\n```\n\n\n\n#### my.cnf\n\n```\n[mysql]\npager  = grcat  ~/.grcat\n```\n\n","source":"_posts/services/database/mysql/my-conf.md","raw":"---\ntitle: mysql参数配置\npermalink: services/database/mysql/my-conf/\ntags:\n  - mysql\n  - config\n  - xxx\ncategories:\n  - services\n  - database\n  - mysql\ndate: 2022-09-03 21:41:01\n---\n\n## \n\n### 慢查询日志\n\n```\n#查看开启状态 单位秒\nshow variables like 'slow_query_log';\n#查询日志\nshow variables like '%log%';\n```\n\n\n\n- `long_query_time`是查询执行时间的阈值，超过该阈值将被记录下来。记录花费时间超过阈值的所有查询，无论它们是否使用索引。\n\n- `log_queries_not_using_indexes`告诉MySQL另外记录所有不使用索引来限制扫描行数的查询。无论执行时间如何，都会记录此条件。\n\n  https://dev.mysql.com/doc/refman/8.0/en/slow-query-log.html\n\n<!--more-->\n\n```\n#0禁用 1启用\nslow-query-log=1\n#相对路径为 datadir 目录下\nslow_query_log_file=\"cs-slow.log\"\n#缺省10秒\nlong_query_time=2\n```\n\n\n\n\n\n### emoji表情\n\n```\n#字符存储编码\nSHOW VARIABLES LIKE 'character_set_%';\n#字符连接编码\nSHOW VARIABLES LIKE 'collation_%';\n```\n\n\n\n```shell\nmysql>  SHOW VARIABLES LIKE 'character_set_%';\n+--------------------------+----------------------------+\n| Variable_name            | Value                      |\n+--------------------------+----------------------------+\n| character_set_client     | utf8mb4                    |\n| character_set_connection | utf8mb4                    |\n| character_set_database   | utf8                       |\n| character_set_filesystem | binary                     |\n| character_set_results    | utf8mb4                    |\n| character_set_server     | utf8mb4                    |\n| character_set_system     | utf8                       |\n| character_sets_dir       | /opt/mysql/share/charsets/ |\n+--------------------------+----------------------------+\n8 rows in set (0.01 sec)\n\nmysql> SHOW VARIABLES LIKE 'collation_%';\n+----------------------+--------------------+\n| Variable_name        | Value              |\n+----------------------+--------------------+\n| collation_connection | utf8mb4_unicode_ci |\n| collation_database   | utf8_bin           |\n| collation_server     | utf8mb4_unicode_ci |\n+----------------------+--------------------+\n3 rows in set (0.00 sec)\n\n```\n\n\n\n```\n[client]  \ndefault-character-set = utf8mb4\n \n[mysql]  \ndefault-character-set = utf8mb4  \n \n[mysqld]  \ncharacter-set-client-handshake = FALSE  \ncharacter-set-server=utf8mb4 \ncollation-server = utf8mb4_general_ci  \ninit_connect='SET NAMES utf8mb4'\n```\n\n> <property name=\"connectionInitSqls\" value=\"set names utf8mb4;\" />\n\n\n\nERROR Lost connection to MySQL server during query\n\n```\nmax_allowed_packet=100M\n```\n\n> 默认64M\n>\n> 如果您使用大 [`BLOB`](https://dev.mysql.com/doc/refman/8.0/en/blob.html)列或长字符串，则必须增加此值。它应该与 [`BLOB`](https://dev.mysql.com/doc/refman/8.0/en/blob.html)您要使用的最大一样大。协议限制为 [`max_allowed_packet`](https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_max_allowed_packet)1GB。该值应为 1024 的倍数；非倍数向下舍入到最接近的倍数。\n\n\n\n### console grc\n\n#### install\n\n1. Install grc (for debian systems: `apt-get install grc`)\n2. Copy both config files into your home directory: [.grcat](https://github.com/nitso/colour-mysql-console/blob/master/.grcat) and [.my.cnf](https://github.com/nitso/colour-mysql-console/blob/master/.my.cnf)\n3. Run mysql client `mysql -u <user> -p -h <hostname>`\n\n#### 配置 ~/.grcat\n\n```\n#default word color\n#regexp=[\\w.,\\:\\-_/]+\nregexp=.+\ncolours=green\n-\n#table borders\nregexp=[+\\-]+[+\\-]|[|]\ncolours=red\n-\n#data in ( ) and ' '\nregexp=\\([\\w\\d,']+\\)\ncolours=white\n-\n#numeric\nregexp=\\s[\\d\\.]+\\s*($|(?=\\|))\ncolours=yellow\n-\n#date\nregexp=\\d{4}-\\d{2}-\\d{2}\ncolours=cyan\n-\n#time\nregexp=\\d{2}:\\d{2}:\\d{2}\ncolours=cyan\n-\n#IP\nregexp=(\\d{1,3}\\.){3}\\d{1,3}(:\\d{1,5})?\ncolours=cyan\n-\n#schema\nregexp=`\\w+`\ncolours=yellow\n-\n#email\nregexp=[\\w\\.\\-_]+@[\\w\\.\\-_]+\ncolours=magenta\n-\n#row delimeter when using \\G key\nregexp=[*]+.+[*]+\ncount=stop\ncolours=white\n-\n#column names when using \\G key\nregexp=^\\s*\\w+:\ncolours=white\n```\n\n\n\n#### my.cnf\n\n```\n[mysql]\npager  = grcat  ~/.grcat\n```\n\n","slug":"services/database/mysql/my-conf","published":1,"updated":"2022-09-03T14:21:39.205Z","__permalink":"services/database/mysql/my-conf/","comments":1,"layout":"post","photos":[],"link":"","_id":"cl7m1l25m000576i52kji5m49","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"慢查询日志\"><a href=\"#慢查询日志\" class=\"headerlink\" title=\"慢查询日志\"></a>慢查询日志</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#查看开启状态 单位秒</span><br><span class=\"line\">show variables like &#x27;slow_query_log&#x27;;</span><br><span class=\"line\">#查询日志</span><br><span class=\"line\">show variables like &#x27;%log%&#x27;;</span><br></pre></td></tr></table></figure>\n\n\n\n<ul>\n<li><p><code>long_query_time</code>是查询执行时间的阈值，超过该阈值将被记录下来。记录花费时间超过阈值的所有查询，无论它们是否使用索引。</p>\n</li>\n<li><p><code>log_queries_not_using_indexes</code>告诉MySQL另外记录所有不使用索引来限制扫描行数的查询。无论执行时间如何，都会记录此条件。</p>\n<p><a href=\"https://dev.mysql.com/doc/refman/8.0/en/slow-query-log.html\">https://dev.mysql.com/doc/refman/8.0/en/slow-query-log.html</a></p>\n</li>\n</ul>\n<span id=\"more\"></span>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#0禁用 1启用</span><br><span class=\"line\">slow-query-log=1</span><br><span class=\"line\">#相对路径为 datadir 目录下</span><br><span class=\"line\">slow_query_log_file=&quot;cs-slow.log&quot;</span><br><span class=\"line\">#缺省10秒</span><br><span class=\"line\">long_query_time=2</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"emoji表情\"><a href=\"#emoji表情\" class=\"headerlink\" title=\"emoji表情\"></a>emoji表情</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#字符存储编码</span><br><span class=\"line\">SHOW VARIABLES LIKE &#x27;character_set_%&#x27;;</span><br><span class=\"line\">#字符连接编码</span><br><span class=\"line\">SHOW VARIABLES LIKE &#x27;collation_%&#x27;;</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">mysql&gt; </span><span class=\"language-bash\"> SHOW VARIABLES LIKE <span class=\"string\">&#x27;character_set_%&#x27;</span>;</span></span><br><span class=\"line\">+--------------------------+----------------------------+</span><br><span class=\"line\">| Variable_name            | Value                      |</span><br><span class=\"line\">+--------------------------+----------------------------+</span><br><span class=\"line\">| character_set_client     | utf8mb4                    |</span><br><span class=\"line\">| character_set_connection | utf8mb4                    |</span><br><span class=\"line\">| character_set_database   | utf8                       |</span><br><span class=\"line\">| character_set_filesystem | binary                     |</span><br><span class=\"line\">| character_set_results    | utf8mb4                    |</span><br><span class=\"line\">| character_set_server     | utf8mb4                    |</span><br><span class=\"line\">| character_set_system     | utf8                       |</span><br><span class=\"line\">| character_sets_dir       | /opt/mysql/share/charsets/ |</span><br><span class=\"line\">+--------------------------+----------------------------+</span><br><span class=\"line\">8 rows in set (0.01 sec)</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">mysql&gt; </span><span class=\"language-bash\">SHOW VARIABLES LIKE <span class=\"string\">&#x27;collation_%&#x27;</span>;</span></span><br><span class=\"line\">+----------------------+--------------------+</span><br><span class=\"line\">| Variable_name        | Value              |</span><br><span class=\"line\">+----------------------+--------------------+</span><br><span class=\"line\">| collation_connection | utf8mb4_unicode_ci |</span><br><span class=\"line\">| collation_database   | utf8_bin           |</span><br><span class=\"line\">| collation_server     | utf8mb4_unicode_ci |</span><br><span class=\"line\">+----------------------+--------------------+</span><br><span class=\"line\">3 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[client]  </span><br><span class=\"line\">default-character-set = utf8mb4</span><br><span class=\"line\"> </span><br><span class=\"line\">[mysql]  </span><br><span class=\"line\">default-character-set = utf8mb4  </span><br><span class=\"line\"> </span><br><span class=\"line\">[mysqld]  </span><br><span class=\"line\">character-set-client-handshake = FALSE  </span><br><span class=\"line\">character-set-server=utf8mb4 </span><br><span class=\"line\">collation-server = utf8mb4_general_ci  </span><br><span class=\"line\">init_connect=&#x27;SET NAMES utf8mb4&#x27;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<property name=\"connectionInitSqls\" value=\"set names utf8mb4;\" />\n</blockquote>\n<p>ERROR Lost connection to MySQL server during query</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">max_allowed_packet=100M</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>默认64M</p>\n<p>如果您使用大 <a href=\"https://dev.mysql.com/doc/refman/8.0/en/blob.html\"><code>BLOB</code></a>列或长字符串，则必须增加此值。它应该与 <a href=\"https://dev.mysql.com/doc/refman/8.0/en/blob.html\"><code>BLOB</code></a>您要使用的最大一样大。协议限制为 <a href=\"https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_max_allowed_packet\"><code>max_allowed_packet</code></a>1GB。该值应为 1024 的倍数；非倍数向下舍入到最接近的倍数。</p>\n</blockquote>\n<h3 id=\"console-grc\"><a href=\"#console-grc\" class=\"headerlink\" title=\"console grc\"></a>console grc</h3><h4 id=\"install\"><a href=\"#install\" class=\"headerlink\" title=\"install\"></a>install</h4><ol>\n<li>Install grc (for debian systems: <code>apt-get install grc</code>)</li>\n<li>Copy both config files into your home directory: <a href=\"https://github.com/nitso/colour-mysql-console/blob/master/.grcat\">.grcat</a> and <a href=\"https://github.com/nitso/colour-mysql-console/blob/master/.my.cnf\">.my.cnf</a></li>\n<li>Run mysql client <code>mysql -u &lt;user&gt; -p -h &lt;hostname&gt;</code></li>\n</ol>\n<h4 id=\"配置-x2F-grcat\"><a href=\"#配置-x2F-grcat\" class=\"headerlink\" title=\"配置 ~&#x2F;.grcat\"></a>配置 ~&#x2F;.grcat</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#default word color</span><br><span class=\"line\">#regexp=[\\w.,\\:\\-_/]+</span><br><span class=\"line\">regexp=.+</span><br><span class=\"line\">colours=green</span><br><span class=\"line\">-</span><br><span class=\"line\">#table borders</span><br><span class=\"line\">regexp=[+\\-]+[+\\-]|[|]</span><br><span class=\"line\">colours=red</span><br><span class=\"line\">-</span><br><span class=\"line\">#data in ( ) and &#x27; &#x27;</span><br><span class=\"line\">regexp=\\([\\w\\d,&#x27;]+\\)</span><br><span class=\"line\">colours=white</span><br><span class=\"line\">-</span><br><span class=\"line\">#numeric</span><br><span class=\"line\">regexp=\\s[\\d\\.]+\\s*($|(?=\\|))</span><br><span class=\"line\">colours=yellow</span><br><span class=\"line\">-</span><br><span class=\"line\">#date</span><br><span class=\"line\">regexp=\\d&#123;4&#125;-\\d&#123;2&#125;-\\d&#123;2&#125;</span><br><span class=\"line\">colours=cyan</span><br><span class=\"line\">-</span><br><span class=\"line\">#time</span><br><span class=\"line\">regexp=\\d&#123;2&#125;:\\d&#123;2&#125;:\\d&#123;2&#125;</span><br><span class=\"line\">colours=cyan</span><br><span class=\"line\">-</span><br><span class=\"line\">#IP</span><br><span class=\"line\">regexp=(\\d&#123;1,3&#125;\\.)&#123;3&#125;\\d&#123;1,3&#125;(:\\d&#123;1,5&#125;)?</span><br><span class=\"line\">colours=cyan</span><br><span class=\"line\">-</span><br><span class=\"line\">#schema</span><br><span class=\"line\">regexp=`\\w+`</span><br><span class=\"line\">colours=yellow</span><br><span class=\"line\">-</span><br><span class=\"line\">#email</span><br><span class=\"line\">regexp=[\\w\\.\\-_]+@[\\w\\.\\-_]+</span><br><span class=\"line\">colours=magenta</span><br><span class=\"line\">-</span><br><span class=\"line\">#row delimeter when using \\G key</span><br><span class=\"line\">regexp=[*]+.+[*]+</span><br><span class=\"line\">count=stop</span><br><span class=\"line\">colours=white</span><br><span class=\"line\">-</span><br><span class=\"line\">#column names when using \\G key</span><br><span class=\"line\">regexp=^\\s*\\w+:</span><br><span class=\"line\">colours=white</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"my-cnf\"><a href=\"#my-cnf\" class=\"headerlink\" title=\"my.cnf\"></a>my.cnf</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysql]</span><br><span class=\"line\">pager  = grcat  ~/.grcat</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"慢查询日志\"><a href=\"#慢查询日志\" class=\"headerlink\" title=\"慢查询日志\"></a>慢查询日志</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#查看开启状态 单位秒</span><br><span class=\"line\">show variables like &#x27;slow_query_log&#x27;;</span><br><span class=\"line\">#查询日志</span><br><span class=\"line\">show variables like &#x27;%log%&#x27;;</span><br></pre></td></tr></table></figure>\n\n\n\n<ul>\n<li><p><code>long_query_time</code>是查询执行时间的阈值，超过该阈值将被记录下来。记录花费时间超过阈值的所有查询，无论它们是否使用索引。</p>\n</li>\n<li><p><code>log_queries_not_using_indexes</code>告诉MySQL另外记录所有不使用索引来限制扫描行数的查询。无论执行时间如何，都会记录此条件。</p>\n<p><a href=\"https://dev.mysql.com/doc/refman/8.0/en/slow-query-log.html\">https://dev.mysql.com/doc/refman/8.0/en/slow-query-log.html</a></p>\n</li>\n</ul>","more":"<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#0禁用 1启用</span><br><span class=\"line\">slow-query-log=1</span><br><span class=\"line\">#相对路径为 datadir 目录下</span><br><span class=\"line\">slow_query_log_file=&quot;cs-slow.log&quot;</span><br><span class=\"line\">#缺省10秒</span><br><span class=\"line\">long_query_time=2</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"emoji表情\"><a href=\"#emoji表情\" class=\"headerlink\" title=\"emoji表情\"></a>emoji表情</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#字符存储编码</span><br><span class=\"line\">SHOW VARIABLES LIKE &#x27;character_set_%&#x27;;</span><br><span class=\"line\">#字符连接编码</span><br><span class=\"line\">SHOW VARIABLES LIKE &#x27;collation_%&#x27;;</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">mysql&gt; </span><span class=\"language-bash\"> SHOW VARIABLES LIKE <span class=\"string\">&#x27;character_set_%&#x27;</span>;</span></span><br><span class=\"line\">+--------------------------+----------------------------+</span><br><span class=\"line\">| Variable_name            | Value                      |</span><br><span class=\"line\">+--------------------------+----------------------------+</span><br><span class=\"line\">| character_set_client     | utf8mb4                    |</span><br><span class=\"line\">| character_set_connection | utf8mb4                    |</span><br><span class=\"line\">| character_set_database   | utf8                       |</span><br><span class=\"line\">| character_set_filesystem | binary                     |</span><br><span class=\"line\">| character_set_results    | utf8mb4                    |</span><br><span class=\"line\">| character_set_server     | utf8mb4                    |</span><br><span class=\"line\">| character_set_system     | utf8                       |</span><br><span class=\"line\">| character_sets_dir       | /opt/mysql/share/charsets/ |</span><br><span class=\"line\">+--------------------------+----------------------------+</span><br><span class=\"line\">8 rows in set (0.01 sec)</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">mysql&gt; </span><span class=\"language-bash\">SHOW VARIABLES LIKE <span class=\"string\">&#x27;collation_%&#x27;</span>;</span></span><br><span class=\"line\">+----------------------+--------------------+</span><br><span class=\"line\">| Variable_name        | Value              |</span><br><span class=\"line\">+----------------------+--------------------+</span><br><span class=\"line\">| collation_connection | utf8mb4_unicode_ci |</span><br><span class=\"line\">| collation_database   | utf8_bin           |</span><br><span class=\"line\">| collation_server     | utf8mb4_unicode_ci |</span><br><span class=\"line\">+----------------------+--------------------+</span><br><span class=\"line\">3 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[client]  </span><br><span class=\"line\">default-character-set = utf8mb4</span><br><span class=\"line\"> </span><br><span class=\"line\">[mysql]  </span><br><span class=\"line\">default-character-set = utf8mb4  </span><br><span class=\"line\"> </span><br><span class=\"line\">[mysqld]  </span><br><span class=\"line\">character-set-client-handshake = FALSE  </span><br><span class=\"line\">character-set-server=utf8mb4 </span><br><span class=\"line\">collation-server = utf8mb4_general_ci  </span><br><span class=\"line\">init_connect=&#x27;SET NAMES utf8mb4&#x27;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<property name=\"connectionInitSqls\" value=\"set names utf8mb4;\" />\n</blockquote>\n<p>ERROR Lost connection to MySQL server during query</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">max_allowed_packet=100M</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>默认64M</p>\n<p>如果您使用大 <a href=\"https://dev.mysql.com/doc/refman/8.0/en/blob.html\"><code>BLOB</code></a>列或长字符串，则必须增加此值。它应该与 <a href=\"https://dev.mysql.com/doc/refman/8.0/en/blob.html\"><code>BLOB</code></a>您要使用的最大一样大。协议限制为 <a href=\"https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_max_allowed_packet\"><code>max_allowed_packet</code></a>1GB。该值应为 1024 的倍数；非倍数向下舍入到最接近的倍数。</p>\n</blockquote>\n<h3 id=\"console-grc\"><a href=\"#console-grc\" class=\"headerlink\" title=\"console grc\"></a>console grc</h3><h4 id=\"install\"><a href=\"#install\" class=\"headerlink\" title=\"install\"></a>install</h4><ol>\n<li>Install grc (for debian systems: <code>apt-get install grc</code>)</li>\n<li>Copy both config files into your home directory: <a href=\"https://github.com/nitso/colour-mysql-console/blob/master/.grcat\">.grcat</a> and <a href=\"https://github.com/nitso/colour-mysql-console/blob/master/.my.cnf\">.my.cnf</a></li>\n<li>Run mysql client <code>mysql -u &lt;user&gt; -p -h &lt;hostname&gt;</code></li>\n</ol>\n<h4 id=\"配置-x2F-grcat\"><a href=\"#配置-x2F-grcat\" class=\"headerlink\" title=\"配置 ~&#x2F;.grcat\"></a>配置 ~&#x2F;.grcat</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#default word color</span><br><span class=\"line\">#regexp=[\\w.,\\:\\-_/]+</span><br><span class=\"line\">regexp=.+</span><br><span class=\"line\">colours=green</span><br><span class=\"line\">-</span><br><span class=\"line\">#table borders</span><br><span class=\"line\">regexp=[+\\-]+[+\\-]|[|]</span><br><span class=\"line\">colours=red</span><br><span class=\"line\">-</span><br><span class=\"line\">#data in ( ) and &#x27; &#x27;</span><br><span class=\"line\">regexp=\\([\\w\\d,&#x27;]+\\)</span><br><span class=\"line\">colours=white</span><br><span class=\"line\">-</span><br><span class=\"line\">#numeric</span><br><span class=\"line\">regexp=\\s[\\d\\.]+\\s*($|(?=\\|))</span><br><span class=\"line\">colours=yellow</span><br><span class=\"line\">-</span><br><span class=\"line\">#date</span><br><span class=\"line\">regexp=\\d&#123;4&#125;-\\d&#123;2&#125;-\\d&#123;2&#125;</span><br><span class=\"line\">colours=cyan</span><br><span class=\"line\">-</span><br><span class=\"line\">#time</span><br><span class=\"line\">regexp=\\d&#123;2&#125;:\\d&#123;2&#125;:\\d&#123;2&#125;</span><br><span class=\"line\">colours=cyan</span><br><span class=\"line\">-</span><br><span class=\"line\">#IP</span><br><span class=\"line\">regexp=(\\d&#123;1,3&#125;\\.)&#123;3&#125;\\d&#123;1,3&#125;(:\\d&#123;1,5&#125;)?</span><br><span class=\"line\">colours=cyan</span><br><span class=\"line\">-</span><br><span class=\"line\">#schema</span><br><span class=\"line\">regexp=`\\w+`</span><br><span class=\"line\">colours=yellow</span><br><span class=\"line\">-</span><br><span class=\"line\">#email</span><br><span class=\"line\">regexp=[\\w\\.\\-_]+@[\\w\\.\\-_]+</span><br><span class=\"line\">colours=magenta</span><br><span class=\"line\">-</span><br><span class=\"line\">#row delimeter when using \\G key</span><br><span class=\"line\">regexp=[*]+.+[*]+</span><br><span class=\"line\">count=stop</span><br><span class=\"line\">colours=white</span><br><span class=\"line\">-</span><br><span class=\"line\">#column names when using \\G key</span><br><span class=\"line\">regexp=^\\s*\\w+:</span><br><span class=\"line\">colours=white</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"my-cnf\"><a href=\"#my-cnf\" class=\"headerlink\" title=\"my.cnf\"></a>my.cnf</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysql]</span><br><span class=\"line\">pager  = grcat  ~/.grcat</span><br></pre></td></tr></table></figure>"}],"PostAsset":[],"PostCategory":[{"post_id":"cl7g6gtsa0001gwi5by46dfr0","category_id":"cl7g6gtsd0004gwi5coe6217t","_id":"cl7g6gtsk000ggwi525y1ctdu"},{"post_id":"cl7g6gtsc0003gwi5fd4722r3","category_id":"cl7g6gtsi000bgwi54t3z9u8d","_id":"cl7g6gtso000mgwi536k1htn2"},{"post_id":"cl7g6gtsf0007gwi57o6y2qhm","category_id":"cl7g6gtsk000hgwi5h2kx5b3l","_id":"cl7g6gtsr000sgwi5f49e1lt4"},{"post_id":"cl7g6gtsg0009gwi5fkgj01j6","category_id":"cl7g6gtso000ngwi55o0ldhvk","_id":"cl7g6gtsu000ygwi5fbux7z6s"},{"post_id":"cl7g6gtsh000agwi52t8of12e","category_id":"cl7g6gtso000ngwi55o0ldhvk","_id":"cl7g6gtsx0014gwi5eocs8njr"},{"post_id":"cl7g6gtsi000egwi59j1p3wqx","category_id":"cl7g6gtso000ngwi55o0ldhvk","_id":"cl7g6gtsz001agwi54dzfe49c"},{"post_id":"cl7g6gtsj000fgwi50ptegehe","category_id":"cl7g6gtsw0013gwi58a55fqge","_id":"cl7g6gtt1001hgwi552zp3b1h"},{"post_id":"cl7g6gtsm000lgwi56qahcx34","category_id":"cl7g6gtt1001igwi51vluhoff","_id":"cl7g6gtt6001sgwi5cgaebgt6"},{"post_id":"cl7g6gtsr000vgwi54ydp7lvj","category_id":"cl7g6gtt8001xgwi54o0fb176","_id":"cl7g6gttc002agwi56tvv0bor"},{"post_id":"cl7g6gtst000wgwi5c263fg9a","category_id":"cl7g6gtt8001xgwi54o0fb176","_id":"cl7g6gtte002fgwi5fr1gdnmp"},{"post_id":"cl7g6gtsu000zgwi58g35gxdw","category_id":"cl7g6gtt8001xgwi54o0fb176","_id":"cl7g6gttf002jgwi57dexhmjp"},{"post_id":"cl7g6gtsx0016gwi54q448qxo","category_id":"cl7g6gtsk000hgwi5h2kx5b3l","_id":"cl7g6gttp002ugwi5hvzpay6d"},{"post_id":"cl7g6gtsx0016gwi54q448qxo","category_id":"cl7g6gttf002lgwi59j2y5isv","_id":"cl7g6gttq002ygwi5efpu78vu"},{"post_id":"cl7g6gtsy0018gwi5fy88a6h8","category_id":"cl7g6gtsk000hgwi5h2kx5b3l","_id":"cl7g6gttr0032gwi50h6tc8vf"},{"post_id":"cl7g6gtsy0018gwi5fy88a6h8","category_id":"cl7g6gtth002qgwi58w0wdhuc","_id":"cl7g6gtts0036gwi5gg6l4ar1"},{"post_id":"cl7g6gtsz001bgwi5eyub3q23","category_id":"cl7g6gtsk000hgwi5h2kx5b3l","_id":"cl7g6gttt003bgwi58lfb53v8"},{"post_id":"cl7g6gtsz001bgwi5eyub3q23","category_id":"cl7g6gttp002wgwi5589f3k2z","_id":"cl7g6gttt003egwi57bjihf7a"},{"post_id":"cl7g6gtt0001egwi5ggg62sqs","category_id":"cl7g6gtsk000hgwi5h2kx5b3l","_id":"cl7g6gttu003hgwi52ovj41b5"},{"post_id":"cl7g6gtt0001egwi5ggg62sqs","category_id":"cl7g6gttr0035gwi5a75mbexo","_id":"cl7g6gttv003kgwi54rmu65oo"},{"post_id":"cl7g6gtsl000jgwi537gg3n41","category_id":"cl7g6gtt0001cgwi53vzvcig3","_id":"cl7g6gttw003ogwi5e33wf5jj"},{"post_id":"cl7g6gtsl000jgwi537gg3n41","category_id":"cl7g6gttt003cgwi5bsbvfec9","_id":"cl7g6gttx003sgwi5f8c5b2y3"},{"post_id":"cl7g6gtt1001ggwi50rpfg45y","category_id":"cl7g6gtsk000hgwi5h2kx5b3l","_id":"cl7g6gtty003wgwi5cjlf9m5c"},{"post_id":"cl7g6gtt1001ggwi50rpfg45y","category_id":"cl7g6gttu003igwi58dbjh1z7","_id":"cl7g6gttz003ygwi58p2gdq4i"},{"post_id":"cl7g6gtsp000pgwi52qm966ib","category_id":"cl7g6gtt1001igwi51vluhoff","_id":"cl7g6gtu4004jgwi55o9947v4"},{"post_id":"cl7g6gtsp000pgwi52qm966ib","category_id":"cl7g6gtu10045gwi5crsc35jw","_id":"cl7g6gtu4004lgwi57oksgc9l"},{"post_id":"cl7g6gtt6001ugwi5gyti7jh7","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtu6004rgwi5hkl66j22"},{"post_id":"cl7g6gtt6001ugwi5gyti7jh7","category_id":"cl7g6gtu4004igwi5hopi2fk2","_id":"cl7g6gtu7004vgwi51fqm5p75"},{"post_id":"cl7g6gtsq000rgwi58of44yca","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtu7004xgwi54gt3cmk5"},{"post_id":"cl7g6gtsq000rgwi58of44yca","category_id":"cl7g6gtu5004ogwi53a2j8opk","_id":"cl7g6gtu70050gwi5d79q9r0j"},{"post_id":"cl7g6gtt7001wgwi50q4f8ofd","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtu70052gwi51uns6mid"},{"post_id":"cl7g6gtt7001wgwi50q4f8ofd","category_id":"cl7g6gtu4004igwi5hopi2fk2","_id":"cl7g6gtu90054gwi5g0r2a55f"},{"post_id":"cl7g6gtt8001ygwi50f1df6d3","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtu90056gwi5gsfcfrnm"},{"post_id":"cl7g6gtt8001ygwi50f1df6d3","category_id":"cl7g6gtu4004igwi5hopi2fk2","_id":"cl7g6gtu90058gwi5hvi7f1ix"},{"post_id":"cl7g6gtt90020gwi5end53qyz","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtua005agwi59r31hlk4"},{"post_id":"cl7g6gtt90020gwi5end53qyz","category_id":"cl7g6gtu4004igwi5hopi2fk2","_id":"cl7g6gtua005cgwi5gc054qam"},{"post_id":"cl7g6gtta0022gwi50xf875y2","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtua005fgwi51c29go1k"},{"post_id":"cl7g6gtta0022gwi50xf875y2","category_id":"cl7g6gtu4004igwi5hopi2fk2","_id":"cl7g6gtub005hgwi51npv4gou"},{"post_id":"cl7g6gttb0026gwi5f4b79mo0","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtub005lgwi51eu3aveg"},{"post_id":"cl7g6gttb0026gwi5f4b79mo0","category_id":"cl7g6gtu4004igwi5hopi2fk2","_id":"cl7g6gtub005ngwi56dkk3ioy"},{"post_id":"cl7g6gttc0028gwi5gkq2ey3a","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtuc005qgwi5anjoaoj5"},{"post_id":"cl7g6gttc0028gwi5gkq2ey3a","category_id":"cl7g6gtu4004igwi5hopi2fk2","_id":"cl7g6gtuc005rgwi59hn09cjv"},{"post_id":"cl7g6gttd002bgwi5g9yf2jdf","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtuc005ugwi59iyicu2c"},{"post_id":"cl7g6gttd002bgwi5g9yf2jdf","category_id":"cl7g6gtu4004igwi5hopi2fk2","_id":"cl7g6gtud005wgwi5ghej30tt"},{"post_id":"cl7g6gttd002dgwi57ycd0o4b","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtud0060gwi52qf9dl8l"},{"post_id":"cl7g6gttd002dgwi57ycd0o4b","category_id":"cl7g6gtu4004igwi5hopi2fk2","_id":"cl7g6gtud0061gwi5eobaewvg"},{"post_id":"cl7g6gtte002ggwi546vsga9y","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtue0063gwi53lrz8bf9"},{"post_id":"cl7g6gtte002ggwi546vsga9y","category_id":"cl7g6gtu4004igwi5hopi2fk2","_id":"cl7g6gtue0065gwi5g67i3ulf"},{"post_id":"cl7g6gtsv0012gwi5heta5p5x","category_id":"cl7g6gtte002egwi59pssf03f","_id":"cl7g6gtuf0068gwi53e2i3irl"},{"post_id":"cl7g6gtsv0012gwi5heta5p5x","category_id":"cl7g6gtud005zgwi55gnjaj6x","_id":"cl7g6gtuf006agwi55kqb1pj7"},{"post_id":"cl7g6gttf002igwi5afj1holm","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtuf006dgwi5g8zse9ji"},{"post_id":"cl7g6gttf002igwi5afj1holm","category_id":"cl7g6gtu4004igwi5hopi2fk2","_id":"cl7g6gtug006ggwi5fbsra1pw"},{"post_id":"cl7g6gttg002mgwi5hl0p130c","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtug006igwi52hd9hj2t"},{"post_id":"cl7g6gttg002mgwi5hl0p130c","category_id":"cl7g6gtuf0067gwi59mh6gs6u","_id":"cl7g6gtug006kgwi57ur5f72i"},{"post_id":"cl7g6gtth002pgwi52wxb9yyc","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtui006ogwi56am51itd"},{"post_id":"cl7g6gtth002pgwi52wxb9yyc","category_id":"cl7g6gtuf006egwi5b3pb64tl","_id":"cl7g6gtui006qgwi53gjv2u2s"},{"post_id":"cl7g6gtth002rgwi52cnkaud6","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtui006ugwi5g0fbc1oe"},{"post_id":"cl7g6gtth002rgwi52cnkaud6","category_id":"cl7g6gtuf006egwi5b3pb64tl","_id":"cl7g6gtuj006wgwi59ljt3duw"},{"post_id":"cl7g6gtto002tgwi5c9vv1n7t","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtuj006zgwi5151lgtdk"},{"post_id":"cl7g6gtto002tgwi5c9vv1n7t","category_id":"cl7g6gtuf006egwi5b3pb64tl","_id":"cl7g6gtuj0071gwi5gi8w1hmm"},{"post_id":"cl7g6gttp002xgwi56kvh2ha9","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtuk0074gwi5fu6b8k1u"},{"post_id":"cl7g6gttp002xgwi56kvh2ha9","category_id":"cl7g6gtuf006egwi5b3pb64tl","_id":"cl7g6gtuk0076gwi5aq7a28ck"},{"post_id":"cl7g6gttq0030gwi5cdgramws","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtuk0078gwi57xaihwiz"},{"post_id":"cl7g6gttq0030gwi5cdgramws","category_id":"cl7g6gtuf006egwi5b3pb64tl","_id":"cl7g6gtum007bgwi5h3l95pgu"},{"post_id":"cl7g6gttr0034gwi55yt1c5p1","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtum007dgwi50buu3lke"},{"post_id":"cl7g6gttr0034gwi55yt1c5p1","category_id":"cl7g6gtuf006egwi5b3pb64tl","_id":"cl7g6gtum007fgwi51jqg7msu"},{"post_id":"cl7g6gtts0037gwi5doim2ect","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtun007igwi59fs7fh2a"},{"post_id":"cl7g6gtts0037gwi5doim2ect","category_id":"cl7g6gtuf006egwi5b3pb64tl","_id":"cl7g6gtun007kgwi5fd8e4w6m"},{"post_id":"cl7g6gtts003agwi51glv4n0q","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtun007ngwi5eig56tm5"},{"post_id":"cl7g6gtts003agwi51glv4n0q","category_id":"cl7g6gtuf006egwi5b3pb64tl","_id":"cl7g6gtuo007pgwi53paadxkv"},{"post_id":"cl7g6gttt003dgwi56uapcy2s","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtuo007rgwi58qhc6m9h"},{"post_id":"cl7g6gttt003dgwi56uapcy2s","category_id":"cl7g6gtuf006egwi5b3pb64tl","_id":"cl7g6gtuo007tgwi50m821tkq"},{"post_id":"cl7g6gttu003ggwi50fin0li9","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtup007wgwi54hoch0ye"},{"post_id":"cl7g6gttu003ggwi50fin0li9","category_id":"cl7g6gtuf006egwi5b3pb64tl","_id":"cl7g6gtuq007ygwi5aks753mi"},{"post_id":"cl7g6gttu003jgwi59jxf75k3","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtuq0081gwi50bed8diz"},{"post_id":"cl7g6gttu003jgwi59jxf75k3","category_id":"cl7g6gtuf006egwi5b3pb64tl","_id":"cl7g6gtuq0083gwi53mpe83rq"},{"post_id":"cl7g6gttw003qgwi54hkd9tt9","category_id":"cl7g6gtuq0082gwi5c7wsbgq4","_id":"cl7g6gtur0088gwi58bok82mc"},{"post_id":"cl7g6gtt2001kgwi58rvt927l","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtus008ggwi5exwm7tb1"},{"post_id":"cl7g6gtt2001kgwi58rvt927l","category_id":"cl7g6gtur0089gwi578e87bx8","_id":"cl7g6gtus008hgwi5gzi0f03a"},{"post_id":"cl7g6gtu10046gwi59kbq2pnx","category_id":"cl7g6gtsk000hgwi5h2kx5b3l","_id":"cl7g6gtuw0090gwi55ir1g0br"},{"post_id":"cl7g6gtu10046gwi59kbq2pnx","category_id":"cl7g6gtuv008vgwi5aenc3314","_id":"cl7g6gtuw0094gwi5d9az2pxo"},{"post_id":"cl7g6gtu2004bgwi545572j8k","category_id":"cl7g6gtuw0092gwi50k2679ko","_id":"cl7g6gtux0098gwi58vo30ylo"},{"post_id":"cl7g6gtu3004egwi5gwnmeock","category_id":"cl7g6gtsk000hgwi5h2kx5b3l","_id":"cl7g6gtux009dgwi5dkg8dggr"},{"post_id":"cl7g6gtu3004egwi5gwnmeock","category_id":"cl7g6gtuv008vgwi5aenc3314","_id":"cl7g6gtuy009ggwi540ndh04l"},{"post_id":"cl7g6gttv003mgwi59eonekan","category_id":"cl7g6gtup007vgwi545yt6fll","_id":"cl7g6gtv0009ugwi52cnq0xkr"},{"post_id":"cl7g6gttv003mgwi59eonekan","category_id":"cl7g6gtuz009ogwi5c21yfmk4","_id":"cl7g6gtv0009wgwi5bmeabv9r"},{"post_id":"cl7g6gttx003ugwi5ep4rfasb","category_id":"cl7g6gtur0086gwi5hn7vgiyn","_id":"cl7g6gtv0009zgwi5flmk5cna"},{"post_id":"cl7g6gttx003ugwi5ep4rfasb","category_id":"cl7g6gtuz009rgwi59cn2exc8","_id":"cl7g6gtv100a1gwi524p26jh4"},{"post_id":"cl7g6gtty003xgwi563vl6mdg","category_id":"cl7g6gtur0086gwi5hn7vgiyn","_id":"cl7g6gtv100a4gwi55xsm7r1i"},{"post_id":"cl7g6gtty003xgwi563vl6mdg","category_id":"cl7g6gtv0009vgwi5gxi96r39","_id":"cl7g6gtv100a6gwi5au5qdow5"},{"post_id":"cl7g6gttz003zgwi5f6652ffx","category_id":"cl7g6gtur0086gwi5hn7vgiyn","_id":"cl7g6gtv100a9gwi56pukbsxp"},{"post_id":"cl7g6gttz003zgwi5f6652ffx","category_id":"cl7g6gtv000a0gwi5ecaeg8ad","_id":"cl7g6gtv200abgwi5exou3xos"},{"post_id":"cl7g6gtt3001lgwi57hthezr7","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtv200afgwi5ago6fivc"},{"post_id":"cl7g6gtt3001lgwi57hthezr7","category_id":"cl7g6gtur0089gwi578e87bx8","_id":"cl7g6gtv200aggwi5hvbj7a03"},{"post_id":"cl7g6gtt3001lgwi57hthezr7","category_id":"cl7g6gtv100a5gwi59tax0ytr","_id":"cl7g6gtv300ajgwi5e1fo8c9j"},{"post_id":"cl7g6gttz0042gwi5941k5bhb","category_id":"cl7g6gtur0086gwi5hn7vgiyn","_id":"cl7g6gtv300algwi56hm45e4y"},{"post_id":"cl7g6gttz0042gwi5941k5bhb","category_id":"cl7g6gtuz009rgwi59cn2exc8","_id":"cl7g6gtv300angwi598e2femu"},{"post_id":"cl7g6gtu00043gwi5g235h254","category_id":"cl7g6gtup007vgwi545yt6fll","_id":"cl7g6gtv300aqgwi5fjwublws"},{"post_id":"cl7g6gtu00043gwi5g235h254","category_id":"cl7g6gtv200aegwi5fx0pd1gy","_id":"cl7g6gtv400asgwi56naz8gev"},{"post_id":"cl7g6gtt4001ngwi5c8wxhy1o","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtv400augwi5f47cgdrl"},{"post_id":"cl7g6gtt4001ngwi5c8wxhy1o","category_id":"cl7g6gtu4004igwi5hopi2fk2","_id":"cl7g6gtv400awgwi58wnx1xd3"},{"post_id":"cl7g6gtt4001ngwi5c8wxhy1o","category_id":"cl7g6gtv300akgwi5c2sh24fi","_id":"cl7g6gtv400azgwi55ngve6eu"},{"post_id":"cl7g6gtu10048gwi5ahgk0j0l","category_id":"cl7g6gtuv008xgwi5e8d6dso6","_id":"cl7g6gtv500b2gwi5bcga4d93"},{"post_id":"cl7g6gtu10048gwi5ahgk0j0l","category_id":"cl7g6gtv300apgwi52u9ghfcp","_id":"cl7g6gtv500b3gwi57ainbhs7"},{"post_id":"cl7g6gtt5001qgwi57zry7ihf","category_id":"cl7g6gtt6001rgwi53w7wdb6k","_id":"cl7g6gtv500b5gwi55km93k7e"},{"post_id":"cl7g6gtt5001qgwi57zry7ihf","category_id":"cl7g6gtur0089gwi578e87bx8","_id":"cl7g6gtv500b8gwi5exl6fqqm"},{"post_id":"cl7g6gtt5001qgwi57zry7ihf","category_id":"cl7g6gtv400atgwi56g9k27qg","_id":"cl7g6gtv600bbgwi52vw597uq"},{"post_id":"cl7g6gtu4004hgwi5h0s11cmq","category_id":"cl7g6gtup007vgwi545yt6fll","_id":"cl7g6gtv600bdgwi549xp5jdu"},{"post_id":"cl7g6gtu4004hgwi5h0s11cmq","category_id":"cl7g6gtv400aygwi59r1h100c","_id":"cl7g6gtv600begwi540o2ab81"},{"post_id":"cl7g6gtu4004kgwi5hu1lcd5n","category_id":"cl7g6gtup007vgwi545yt6fll","_id":"cl7g6gtv700bhgwi54i0f8hob"},{"post_id":"cl7g6gtu4004kgwi5hu1lcd5n","category_id":"cl7g6gtv400aygwi59r1h100c","_id":"cl7g6gtv700bigwi52is2g5hd"},{"post_id":"cl7g6gtu5004mgwi5ddvv4v90","category_id":"cl7g6gtup007vgwi545yt6fll","_id":"cl7g6gtv700bmgwi5d1ukf54k"},{"post_id":"cl7g6gtu5004mgwi5ddvv4v90","category_id":"cl7g6gtv400aygwi59r1h100c","_id":"cl7g6gtv700bpgwi583rbcbjy"},{"post_id":"cl7g6gtu5004mgwi5ddvv4v90","category_id":"cl7g6gtv600bfgwi57acjd5wj","_id":"cl7g6gtv700bqgwi508dgeaqt"},{"post_id":"cl7j3sxe30000lri5hcwzg3l6","category_id":"cl7g6gtt8001xgwi54o0fb176","_id":"cl7j3sxen000alri53ovkbs52"},{"post_id":"cl7j3sxe30000lri5hcwzg3l6","category_id":"cl7j3sxei0004lri5e0zu7ud0","_id":"cl7j3sxeo000dlri5hosj7fxc"},{"post_id":"cl7j3sxe60001lri58dwt96i1","category_id":"cl7g6gtt8001xgwi54o0fb176","_id":"cl7j3sxep000flri5edrva9xd"},{"post_id":"cl7j3sxe60001lri58dwt96i1","category_id":"cl7j3sxel0008lri5ct81fzsv","_id":"cl7j3sxeq000hlri5foqreyya"},{"post_id":"cl7j3sxeh0003lri58p8iapze","category_id":"cl7g6gtt8001xgwi54o0fb176","_id":"cl7j3sxeq000jlri5hhp1379e"},{"post_id":"cl7j3sxeh0003lri58p8iapze","category_id":"cl7j3sxel0008lri5ct81fzsv","_id":"cl7j3sxer000llri52jmnf52v"},{"post_id":"cl7j3sxej0005lri5c1qug0q2","category_id":"cl7g6gtt8001xgwi54o0fb176","_id":"cl7j3sxer000nlri54rxu6e9n"},{"post_id":"cl7j3sxej0005lri5c1qug0q2","category_id":"cl7j3sxel0008lri5ct81fzsv","_id":"cl7j3sxer000qlri5a3tw7biu"},{"post_id":"cl7j3sxek0006lri563pd4bpe","category_id":"cl7g6gtt8001xgwi54o0fb176","_id":"cl7j3sxer000slri581zs36x1"},{"post_id":"cl7j3sxek0006lri563pd4bpe","category_id":"cl7j3sxeq000ilri5gbiqa8jh","_id":"cl7j3sxes000ulri5dqnuf3ld"},{"post_id":"cl7lok4bt0000j3i51wbnd3iq","category_id":"cl7g6gtup007vgwi545yt6fll","_id":"cl7lok4bx0008j3i5786e6cyk"},{"post_id":"cl7lok4bt0000j3i51wbnd3iq","category_id":"cl7g6gtv400aygwi59r1h100c","_id":"cl7lok4bx0009j3i561g52g72"},{"post_id":"cl7m1l254000076i58zym5byt","category_id":"cl7g6gtso000ngwi55o0ldhvk","_id":"cl7m1l25o000876i5byr17poi"},{"post_id":"cl7m1l254000076i58zym5byt","category_id":"cl7m1l25k000376i58c9lhazg","_id":"cl7m1l25p000a76i565b6d1fg"},{"post_id":"cl7m1l25l000476i5hfdwge8m","category_id":"cl7g6gtup007vgwi545yt6fll","_id":"cl7m1l25p000b76i5h0yw2dyi"},{"post_id":"cl7m1l25l000476i5hfdwge8m","category_id":"cl7g6gtv400aygwi59r1h100c","_id":"cl7m1l25q000d76i58ayf0sx8"},{"post_id":"cl7m1l25l000476i5hfdwge8m","category_id":"cl7lok4bv0002j3i5a32fhz28","_id":"cl7m1l25q000f76i52vo29q6t"},{"post_id":"cl7m1l25m000576i52kji5m49","category_id":"cl7g6gtup007vgwi545yt6fll","_id":"cl7m1l25r000i76i5fmbj795s"},{"post_id":"cl7m1l25m000576i52kji5m49","category_id":"cl7g6gtv400aygwi59r1h100c","_id":"cl7m1l25r000k76i5c8imcfus"},{"post_id":"cl7m1l25m000576i52kji5m49","category_id":"cl7lok4bv0002j3i5a32fhz28","_id":"cl7m1l25r000n76i5h2sxhqx0"},{"post_id":"cl7m1l25j000276i55jblgef3","category_id":"cl7g6gtup007vgwi545yt6fll","_id":"cl7m1l25r000p76i58vupdjsp"},{"post_id":"cl7m1l25j000276i55jblgef3","category_id":"cl7g6gtv400aygwi59r1h100c","_id":"cl7m1l25s000r76i5gf5565bq"},{"post_id":"cl7m1l25j000276i55jblgef3","category_id":"cl7lok4bv0002j3i5a32fhz28","_id":"cl7m1l25s000u76i553yvafke"},{"post_id":"cl7m1l25j000276i55jblgef3","category_id":"cl7m1l25n000776i5d91qb33p","_id":"cl7m1l25s000w76i557co815l"},{"post_id":"cl7lok4bt0000j3i51wbnd3iq","category_id":"cl7lok4bv0002j3i5a32fhz28","_id":"cl7m1l25w001176i50aiu0kkp"}],"PostTag":[{"post_id":"cl7g6gtsa0001gwi5by46dfr0","tag_id":"cl7g6gtse0005gwi59eb44zuy","_id":"cl7g6gtsi000dgwi512hs0dpd"},{"post_id":"cl7g6gtsc0003gwi5fd4722r3","tag_id":"cl7g6gtsi000cgwi52871e2e7","_id":"cl7g6gtsm000kgwi5fxub5wxf"},{"post_id":"cl7g6gtsf0007gwi57o6y2qhm","tag_id":"cl7g6gtsk000igwi5fvg16ofl","_id":"cl7g6gtsq000qgwi5304sgoky"},{"post_id":"cl7g6gtsg0009gwi5fkgj01j6","tag_id":"cl7g6gtso000ogwi57hs1h4sq","_id":"cl7g6gtsv0011gwi53tmb3xx2"},{"post_id":"cl7g6gtsg0009gwi5fkgj01j6","tag_id":"cl7g6gtsr000ugwi5fy0ib5rx","_id":"cl7g6gtsx0015gwi5eksw1zuq"},{"post_id":"cl7g6gtsh000agwi52t8of12e","tag_id":"cl7g6gtsv0010gwi5dh7u5qa0","_id":"cl7g6gtsz0019gwi58ngb4z4k"},{"post_id":"cl7g6gtsi000egwi59j1p3wqx","tag_id":"cl7g6gtsy0017gwi5e9ntfvzc","_id":"cl7g6gtt1001fgwi59xfteaue"},{"post_id":"cl7g6gtsj000fgwi50ptegehe","tag_id":"cl7g6gtt0001dgwi56kyv5d5r","_id":"cl7g6gtt5001pgwi5feikbyqa"},{"post_id":"cl7g6gtsj000fgwi50ptegehe","tag_id":"cl7g6gtt2001jgwi5gxlt71gd","_id":"cl7g6gtt6001tgwi59y0s1b57"},{"post_id":"cl7g6gtsl000jgwi537gg3n41","tag_id":"cl7g6gtt4001ogwi51wjv4z3b","_id":"cl7g6gtta0021gwi51n8n37uh"},{"post_id":"cl7g6gtsl000jgwi537gg3n41","tag_id":"cl7g6gtt7001vgwi54c1212jy","_id":"cl7g6gttb0024gwi5f3cr0990"},{"post_id":"cl7g6gtsm000lgwi56qahcx34","tag_id":"cl7g6gtt8001zgwi56etp39r1","_id":"cl7g6gttc0027gwi56vuy91m6"},{"post_id":"cl7g6gtsp000pgwi52qm966ib","tag_id":"cl7g6gttb0025gwi5gquh1j0k","_id":"cl7g6gttf002kgwi57ffv0sa6"},{"post_id":"cl7g6gtsp000pgwi52qm966ib","tag_id":"cl7g6gttd002cgwi5g7bc2ijp","_id":"cl7g6gttg002ngwi588u6ex7v"},{"post_id":"cl7g6gtsq000rgwi58of44yca","tag_id":"cl7g6gttf002hgwi5e7v43ljt","_id":"cl7g6gttp002vgwi5dqmf9zpa"},{"post_id":"cl7g6gtsq000rgwi58of44yca","tag_id":"cl7g6gttg002ogwi5cvd0hhan","_id":"cl7g6gttq002zgwi53mbtfh9g"},{"post_id":"cl7g6gtsr000vgwi54ydp7lvj","tag_id":"cl7g6gtto002sgwi54a9l9otd","_id":"cl7g6gttr0033gwi50s4l1rbt"},{"post_id":"cl7g6gtst000wgwi5c263fg9a","tag_id":"cl7g6gtto002sgwi54a9l9otd","_id":"cl7g6gtts0039gwi5esn5broh"},{"post_id":"cl7g6gtsu000zgwi58g35gxdw","tag_id":"cl7g6gtts0038gwi51twt9k6m","_id":"cl7g6gttw003ngwi5ci735l72"},{"post_id":"cl7g6gtsu000zgwi58g35gxdw","tag_id":"cl7g6gttu003fgwi55ix24nos","_id":"cl7g6gttx003rgwi5auc6behf"},{"post_id":"cl7g6gtsv0012gwi5heta5p5x","tag_id":"cl7g6gttv003lgwi59s7882lf","_id":"cl7g6gtu10047gwi5cmy491y8"},{"post_id":"cl7g6gtsv0012gwi5heta5p5x","tag_id":"cl7g6gttx003tgwi57rbf304p","_id":"cl7g6gtu20049gwi5gukchz8o"},{"post_id":"cl7g6gtsv0012gwi5heta5p5x","tag_id":"cl7g6gttz0040gwi5gl1a45j7","_id":"cl7g6gtu3004dgwi5dep53owy"},{"post_id":"cl7g6gtsx0016gwi54q448qxo","tag_id":"cl7g6gtu00044gwi5hdb5d39h","_id":"cl7g6gtu3004fgwi55zboczxl"},{"post_id":"cl7g6gtsy0018gwi5fy88a6h8","tag_id":"cl7g6gtu2004agwi5609t0hu5","_id":"cl7g6gtu6004pgwi59tj6fyy7"},{"post_id":"cl7g6gtsy0018gwi5fy88a6h8","tag_id":"cl7g6gtu3004ggwi56tmdg87x","_id":"cl7g6gtu6004qgwi5dohy3cq5"},{"post_id":"cl7g6gtsz001bgwi5eyub3q23","tag_id":"cl7g6gtu5004ngwi5cjlq0fro","_id":"cl7g6gtu6004ugwi5e5pa9iok"},{"post_id":"cl7g6gtt0001egwi5ggg62sqs","tag_id":"cl7g6gtu6004sgwi59v6677lu","_id":"cl7g6gtu7004zgwi59j2wgmsn"},{"post_id":"cl7g6gtt1001ggwi50rpfg45y","tag_id":"cl7g6gtu7004ygwi5ft6r1xca","_id":"cl7g6gtua005dgwi51yg13q8x"},{"post_id":"cl7g6gtt1001ggwi50rpfg45y","tag_id":"cl7g6gtu80053gwi58795gn1r","_id":"cl7g6gtua005ggwi59iv26x7k"},{"post_id":"cl7g6gtt1001ggwi50rpfg45y","tag_id":"cl7g6gtu90057gwi50sqm3zuh","_id":"cl7g6gtub005jgwi5ccn4a3w4"},{"post_id":"cl7g6gtt2001kgwi58rvt927l","tag_id":"cl7g6gtua005bgwi52l9q84jw","_id":"cl7g6gtub005mgwi57fx19zwo"},{"post_id":"cl7g6gtt3001lgwi57hthezr7","tag_id":"cl7g6gttz0040gwi5gl1a45j7","_id":"cl7g6gtuc005vgwi590ku65qw"},{"post_id":"cl7g6gtt3001lgwi57hthezr7","tag_id":"cl7g6gtub005ogwi5gtqj0v98","_id":"cl7g6gtud005xgwi59zndg2a3"},{"post_id":"cl7g6gtt4001ngwi5c8wxhy1o","tag_id":"cl7g6gttz0040gwi5gl1a45j7","_id":"cl7g6gtuf0069gwi51qem6amo"},{"post_id":"cl7g6gtt4001ngwi5c8wxhy1o","tag_id":"cl7g6gtud005ygwi5clplaojf","_id":"cl7g6gtuf006bgwi5f91vg2kl"},{"post_id":"cl7g6gtt4001ngwi5c8wxhy1o","tag_id":"cl7g6gtud0062gwi5522n9qgu","_id":"cl7g6gtug006fgwi5eyc1b74c"},{"post_id":"cl7g6gtt5001qgwi57zry7ihf","tag_id":"cl7g6gttz0040gwi5gl1a45j7","_id":"cl7g6gtuh006mgwi54juzdrud"},{"post_id":"cl7g6gtt5001qgwi57zry7ihf","tag_id":"cl7g6gtud005ygwi5clplaojf","_id":"cl7g6gtui006pgwi519g00gww"},{"post_id":"cl7g6gtt5001qgwi57zry7ihf","tag_id":"cl7g6gtud0062gwi5522n9qgu","_id":"cl7g6gtui006sgwi55gkb5k20"},{"post_id":"cl7g6gtt6001ugwi5gyti7jh7","tag_id":"cl7g6gtuh006lgwi5cv6o8m5x","_id":"cl7g6gtuj006vgwi58vnfe5p6"},{"post_id":"cl7g6gtt7001wgwi50q4f8ofd","tag_id":"cl7g6gtui006rgwi50ttv67r3","_id":"cl7g6gtuj0070gwi5fn9x7lu3"},{"post_id":"cl7g6gtt8001ygwi50f1df6d3","tag_id":"cl7g6gtuj006xgwi5hzlc7shs","_id":"cl7g6gtuk0075gwi599qp5flh"},{"post_id":"cl7g6gtt90020gwi5end53qyz","tag_id":"cl7g6gtuj0072gwi57ahxdwfv","_id":"cl7g6gtum007agwi5fmwzaq3v"},{"post_id":"cl7g6gtta0022gwi50xf875y2","tag_id":"cl7g6gtul0079gwi56h6rbmfh","_id":"cl7g6gtum007ggwi56yy78zrz"},{"post_id":"cl7g6gttb0026gwi5f4b79mo0","tag_id":"cl7g6gtum007egwi5gui68vn0","_id":"cl7g6gtun007lgwi54vk1huu2"},{"post_id":"cl7g6gttc0028gwi5gkq2ey3a","tag_id":"cl7g6gtum007egwi5gui68vn0","_id":"cl7g6gtuo007ugwi530bo6rv1"},{"post_id":"cl7g6gttc0028gwi5gkq2ey3a","tag_id":"cl7g6gtun007ogwi57j7gaisn","_id":"cl7g6gtuq007xgwi5be180eg7"},{"post_id":"cl7g6gttd002bgwi5g9yf2jdf","tag_id":"cl7g6gtuo007sgwi53si8bf0r","_id":"cl7g6gtuq0080gwi5c1zz2ehc"},{"post_id":"cl7g6gttd002dgwi57ycd0o4b","tag_id":"cl7g6gtuq007zgwi5aesh0h62","_id":"cl7g6gtuq0085gwi572gy9mgj"},{"post_id":"cl7g6gtte002ggwi546vsga9y","tag_id":"cl7g6gttv003lgwi59s7882lf","_id":"cl7g6gtur008bgwi51erbgohg"},{"post_id":"cl7g6gtte002ggwi546vsga9y","tag_id":"cl7g6gtur0087gwi595duhgc6","_id":"cl7g6gtus008dgwi51d6i4ees"},{"post_id":"cl7g6gttf002igwi5afj1holm","tag_id":"cl7g6gtur008agwi5dvje9ltu","_id":"cl7g6gtut008jgwi5cgu4azrv"},{"post_id":"cl7g6gttf002igwi5afj1holm","tag_id":"cl7g6gtus008egwi5e8m736pm","_id":"cl7g6gtut008lgwi5h6xr8bfh"},{"post_id":"cl7g6gttg002mgwi5hl0p130c","tag_id":"cl7g6gtus008igwi531z9bwnf","_id":"cl7g6gtuu008qgwi54t9l2m8s"},{"post_id":"cl7g6gttg002mgwi5hl0p130c","tag_id":"cl7g6gtuh006lgwi5cv6o8m5x","_id":"cl7g6gtuu008rgwi58n66er8b"},{"post_id":"cl7g6gtth002pgwi52wxb9yyc","tag_id":"cl7g6gtut008ogwi5882d1pov","_id":"cl7g6gtuv008ygwi5cuqm21np"},{"post_id":"cl7g6gtth002pgwi52wxb9yyc","tag_id":"cl7g6gtuu008sgwi5fac03mtz","_id":"cl7g6gtuw008zgwi56x547km7"},{"post_id":"cl7g6gtth002pgwi52wxb9yyc","tag_id":"cl7g6gtuv008ugwi5f7yf5h1c","_id":"cl7g6gtuw0093gwi5eytjcag6"},{"post_id":"cl7g6gtth002rgwi52cnkaud6","tag_id":"cl7g6gtuv008wgwi58szibtsl","_id":"cl7g6gtux009agwi58mvndlea"},{"post_id":"cl7g6gtth002rgwi52cnkaud6","tag_id":"cl7g6gtuw0091gwi5an8y19dl","_id":"cl7g6gtux009bgwi50rybg0rb"},{"post_id":"cl7g6gtth002rgwi52cnkaud6","tag_id":"cl7g6gtuw0095gwi5e3m96rq2","_id":"cl7g6gtux009fgwi5amrc7vcv"},{"post_id":"cl7g6gtto002tgwi5c9vv1n7t","tag_id":"cl7g6gtux0099gwi58yjpcja0","_id":"cl7g6gtuy009hgwi5et6p1b2i"},{"post_id":"cl7g6gttp002xgwi56kvh2ha9","tag_id":"cl7g6gtux009egwi501ataeaf","_id":"cl7g6gtuy009kgwi56juqch48"},{"post_id":"cl7g6gttq0030gwi5cdgramws","tag_id":"cl7g6gtuy009jgwi58s4q1ubn","_id":"cl7g6gtuy009ngwi53cvff49o"},{"post_id":"cl7g6gttr0034gwi55yt1c5p1","tag_id":"cl7g6gtuy009mgwi5dzkhfp87","_id":"cl7g6gtuz009qgwi521ap360e"},{"post_id":"cl7g6gtts0037gwi5doim2ect","tag_id":"cl7g6gtuz009pgwi51buyeezm","_id":"cl7g6gtv0009tgwi5g4ufdlfx"},{"post_id":"cl7g6gtts003agwi51glv4n0q","tag_id":"cl7g6gtuy009mgwi5dzkhfp87","_id":"cl7g6gtv0009ygwi59ftx1s6g"},{"post_id":"cl7g6gttt003dgwi56uapcy2s","tag_id":"cl7g6gtv0009xgwi53vjf3zsc","_id":"cl7g6gtv100a3gwi54twj2olt"},{"post_id":"cl7g6gttu003ggwi50fin0li9","tag_id":"cl7g6gtv100a2gwi5d2y53vp3","_id":"cl7g6gtv100a8gwi5a1j430e1"},{"post_id":"cl7g6gttu003jgwi59jxf75k3","tag_id":"cl7g6gtv100a7gwi5aims55a0","_id":"cl7g6gtv200adgwi5gjiz1hem"},{"post_id":"cl7g6gttv003mgwi59eonekan","tag_id":"cl7g6gtv200acgwi5b4wi82s7","_id":"cl7g6gtv300aigwi5eal1cfxu"},{"post_id":"cl7g6gttw003qgwi54hkd9tt9","tag_id":"cl7g6gtv200ahgwi5fur8dudw","_id":"cl7g6gtv300aogwi52gjng19w"},{"post_id":"cl7g6gttx003ugwi5ep4rfasb","tag_id":"cl7g6gtv300amgwi51fenfz1y","_id":"cl7g6gtv400axgwi57zk06do2"},{"post_id":"cl7g6gttx003ugwi5ep4rfasb","tag_id":"cl7g6gtv300argwi5hfde808s","_id":"cl7g6gtv500b0gwi5da0r437g"},{"post_id":"cl7g6gtty003xgwi563vl6mdg","tag_id":"cl7g6gttz0040gwi5gl1a45j7","_id":"cl7g6gtv500b7gwi55jta5fp7"},{"post_id":"cl7g6gtty003xgwi563vl6mdg","tag_id":"cl7g6gtv500b1gwi5g3jc9d2d","_id":"cl7g6gtv600bagwi590qac5ku"},{"post_id":"cl7g6gttz003zgwi5f6652ffx","tag_id":"cl7g6gtv500b6gwi5agwbghg2","_id":"cl7g6gtv700bkgwi51nvocnn6"},{"post_id":"cl7g6gttz003zgwi5f6652ffx","tag_id":"cl7g6gttz0040gwi5gl1a45j7","_id":"cl7g6gtv700blgwi55khd452j"},{"post_id":"cl7g6gttz003zgwi5f6652ffx","tag_id":"cl7g6gtv500b1gwi5g3jc9d2d","_id":"cl7g6gtv700bogwi5hux426un"},{"post_id":"cl7g6gttz0042gwi5941k5bhb","tag_id":"cl7g6gtv700bjgwi53o8je1qi","_id":"cl7g6gtv800bsgwi5f0z61k3v"},{"post_id":"cl7g6gttz0042gwi5941k5bhb","tag_id":"cl7g6gttz0040gwi5gl1a45j7","_id":"cl7g6gtv800btgwi5hr563ncp"},{"post_id":"cl7g6gttz0042gwi5941k5bhb","tag_id":"cl7g6gtv500b1gwi5g3jc9d2d","_id":"cl7g6gtv800bvgwi54m1xb23t"},{"post_id":"cl7g6gtu00043gwi5g235h254","tag_id":"cl7g6gtv700brgwi57uoockrb","_id":"cl7g6gtv800bxgwi5824uec5m"},{"post_id":"cl7g6gtu00043gwi5g235h254","tag_id":"cl7g6gtv800bugwi5ah4c3vb7","_id":"cl7g6gtv800bygwi5306l832v"},{"post_id":"cl7g6gtu10046gwi59kbq2pnx","tag_id":"cl7g6gtv800bwgwi57kzm48pf","_id":"cl7g6gtv900c1gwi5e4aiht7e"},{"post_id":"cl7g6gtu10046gwi59kbq2pnx","tag_id":"cl7g6gtv700bjgwi53o8je1qi","_id":"cl7g6gtv900c2gwi5brf38u7l"},{"post_id":"cl7g6gtu10048gwi5ahgk0j0l","tag_id":"cl7g6gtv800bwgwi57kzm48pf","_id":"cl7g6gtv900c4gwi5bxpzdtxy"},{"post_id":"cl7g6gtu2004bgwi545572j8k","tag_id":"cl7g6gtv900c3gwi52hp6e2es","_id":"cl7g6gtv900c6gwi5eio453by"},{"post_id":"cl7g6gtu3004egwi5gwnmeock","tag_id":"cl7g6gtv900c5gwi5d9mh7fe2","_id":"cl7g6gtva00c8gwi597ozdnms"},{"post_id":"cl7g6gtu4004hgwi5h0s11cmq","tag_id":"cl7g6gtv900c7gwi5bgy3e707","_id":"cl7g6gtva00cagwi5955e1x78"},{"post_id":"cl7g6gtu4004hgwi5h0s11cmq","tag_id":"cl7g6gttz0040gwi5gl1a45j7","_id":"cl7g6gtva00cbgwi5g1r4ak9e"},{"post_id":"cl7g6gtu4004kgwi5hu1lcd5n","tag_id":"cl7g6gtv900c7gwi5bgy3e707","_id":"cl7g6gtva00cdgwi56khw1q98"},{"post_id":"cl7g6gtu5004mgwi5ddvv4v90","tag_id":"cl7g6gtur0087gwi595duhgc6","_id":"cl7g6gtva00cegwi578b3e7mn"},{"post_id":"cl7j3sxe30000lri5hcwzg3l6","tag_id":"cl7j3sxe80002lri50og44jq4","_id":"cl7j3sxem0009lri5dxaw69ot"},{"post_id":"cl7j3sxe60001lri58dwt96i1","tag_id":"cl7j3sxel0007lri5dg9i4j5a","_id":"cl7j3sxer000mlri56ere655g"},{"post_id":"cl7j3sxe60001lri58dwt96i1","tag_id":"cl7j3sxen000blri5bdfna2fj","_id":"cl7j3sxer000olri5aecwhr9b"},{"post_id":"cl7j3sxe60001lri58dwt96i1","tag_id":"cl7j3sxep000glri5cjgycs4n","_id":"cl7j3sxer000rlri51a9kd33t"},{"post_id":"cl7j3sxeh0003lri58p8iapze","tag_id":"cl7g6gtuy009mgwi5dzkhfp87","_id":"cl7j3sxes000vlri50lue13yw"},{"post_id":"cl7j3sxeh0003lri58p8iapze","tag_id":"cl7j3sxeq000klri53yuef638","_id":"cl7j3sxes000wlri5efki2ucz"},{"post_id":"cl7j3sxeh0003lri58p8iapze","tag_id":"cl7j3sxer000plri5fmmua4ag","_id":"cl7j3sxet000ylri58ket2lq8"},{"post_id":"cl7j3sxej0005lri5c1qug0q2","tag_id":"cl7j3sxes000tlri57o83gotl","_id":"cl7j3sxeu0011lri5eb6j3923"},{"post_id":"cl7j3sxej0005lri5c1qug0q2","tag_id":"cl7j3sxes000xlri52ht8ebho","_id":"cl7j3sxeu0012lri56u0s7lfd"},{"post_id":"cl7j3sxej0005lri5c1qug0q2","tag_id":"cl7j3sxeu000zlri54snq1p8x","_id":"cl7j3sxev0014lri5gpd1e52x"},{"post_id":"cl7j3sxek0006lri563pd4bpe","tag_id":"cl7j3sxeu0010lri53voxf2cf","_id":"cl7j3sxev0015lri5c4nz5gjk"},{"post_id":"cl7j3sxek0006lri563pd4bpe","tag_id":"cl7j3sxeu0013lri53lo24mos","_id":"cl7j3sxev0016lri59an874o6"},{"post_id":"cl7lok4bt0000j3i51wbnd3iq","tag_id":"cl7lolc8n000ej3i5d2x69nyt","_id":"cl7lolc8p000fj3i5721j3ups"},{"post_id":"cl7lok4bt0000j3i51wbnd3iq","tag_id":"cl7g6gtv900c7gwi5bgy3e707","_id":"cl7lolf56000gj3i59xw8dhbt"},{"post_id":"cl7m1l254000076i58zym5byt","tag_id":"cl7m1l259000176i5beiq1sqt","_id":"cl7m1l25q000e76i5cbib1ng5"},{"post_id":"cl7m1l254000076i58zym5byt","tag_id":"cl7m1l25n000676i50xbjg5cc","_id":"cl7m1l25q000g76i5094581b8"},{"post_id":"cl7m1l254000076i58zym5byt","tag_id":"cl7m1l25o000976i5hwi0gcih","_id":"cl7m1l25r000j76i5aa9afs9e"},{"post_id":"cl7m1l25j000276i55jblgef3","tag_id":"cl7m1l25p000c76i574s9f2m4","_id":"cl7m1l25r000l76i5high1z93"},{"post_id":"cl7m1l25j000276i55jblgef3","tag_id":"cl7lok4bw0003j3i545a16n2n","_id":"cl7m1l25r000o76i53lmf9m0t"},{"post_id":"cl7m1l25j000276i55jblgef3","tag_id":"cl7j3sxeu000zlri54snq1p8x","_id":"cl7m1l25r000q76i50djlgrkr"},{"post_id":"cl7m1l25l000476i5hfdwge8m","tag_id":"cl7m1l25q000h76i55zxj0mnq","_id":"cl7m1l25s000t76i5371120zv"},{"post_id":"cl7m1l25l000476i5hfdwge8m","tag_id":"cl7m1l25r000m76i5ar5lgn6k","_id":"cl7m1l25s000v76i5bv4c0f6u"},{"post_id":"cl7m1l25l000476i5hfdwge8m","tag_id":"cl7j3sxeu000zlri54snq1p8x","_id":"cl7m1l25s000x76i5aaee43ky"},{"post_id":"cl7m1l25m000576i52kji5m49","tag_id":"cl7g6gtv900c7gwi5bgy3e707","_id":"cl7m1l25s000y76i5hg0hdeyh"},{"post_id":"cl7m1l25m000576i52kji5m49","tag_id":"cl7m1l25s000s76i54ge0ewb1","_id":"cl7m1l25s000z76i5ajnjei72"},{"post_id":"cl7m1l25m000576i52kji5m49","tag_id":"cl7j3sxeu000zlri54snq1p8x","_id":"cl7m1l25t001076i5a2ef6t28"}],"Tag":[{"name":"草稿","_id":"cl7g6gtse0005gwi59eb44zuy"},{"name":"singleton","_id":"cl7g6gtsi000cgwi52871e2e7"},{"name":"强弱类型","_id":"cl7g6gtsk000igwi5fvg16ofl"},{"name":"流程图","_id":"cl7g6gtso000ogwi57hs1h4sq"},{"name":"flow","_id":"cl7g6gtsr000ugwi5fy0ib5rx"},{"name":"formula","_id":"cl7g6gtsv0010gwi5dh7u5qa0"},{"name":"grammar","_id":"cl7g6gtsy0017gwi5e9ntfvzc"},{"name":"tcp","_id":"cl7g6gtt0001dgwi56kyv5d5r"},{"name":"http","_id":"cl7g6gtt2001jgwi5gxlt71gd"},{"name":"https","_id":"cl7g6gtt4001ogwi51wjv4z3b"},{"name":"签名","_id":"cl7g6gtt7001vgwi54c1212jy"},{"name":"online","_id":"cl7g6gtt8001zgwi56etp39r1"},{"name":"ngrok","_id":"cl7g6gttb0025gwi5gquh1j0k"},{"name":"内网穿透","_id":"cl7g6gttd002cgwi5g7bc2ijp"},{"name":"android","_id":"cl7g6gttf002hgwi5e7v43ljt"},{"name":"Simulator","_id":"cl7g6gttg002ogwi5cvd0hhan"},{"name":"git","_id":"cl7g6gtto002sgwi54a9l9otd"},{"name":"maven","_id":"cl7g6gtts0038gwi51twt9k6m"},{"name":"mvn","_id":"cl7g6gttu003fgwi55ix24nos"},{"name":"redis","_id":"cl7g6gttv003lgwi59s7882lf"},{"name":"监控工具","_id":"cl7g6gttx003tgwi57rbf304p"},{"name":"install","_id":"cl7g6gttz0040gwi5gl1a45j7"},{"name":"jvm","_id":"cl7g6gtu00044gwi5hdb5d39h"},{"name":"规则","_id":"cl7g6gtu2004agwi5609t0hu5"},{"name":"语法","_id":"cl7g6gtu3004ggwi56tmdg87x"},{"name":"stream","_id":"cl7g6gtu5004ngwi5cjlq0fro"},{"name":"pip","_id":"cl7g6gtu6004sgwi59v6677lu"},{"name":"api","_id":"cl7g6gtu7004ygwi5ft6r1xca"},{"name":"request","_id":"cl7g6gtu80053gwi58795gn1r"},{"name":"response","_id":"cl7g6gtu90057gwi50sqm3zuh"},{"name":"apt","_id":"cl7g6gtua005bgwi52l9q84jw"},{"name":"dpkg","_id":"cl7g6gtub005ogwi5gtqj0v98"},{"name":"docker-engine","_id":"cl7g6gtud005ygwi5clplaojf"},{"name":"docker compose","_id":"cl7g6gtud0062gwi5522n9qgu"},{"name":"docker","_id":"cl7g6gtuh006lgwi5cv6o8m5x"},{"name":"etcd","_id":"cl7g6gtui006rgwi50ttv67r3"},{"name":"flanneld","_id":"cl7g6gtuj006xgwi5hzlc7shs"},{"name":"harbor","_id":"cl7g6gtuj0072gwi57ahxdwfv"},{"name":"helm","_id":"cl7g6gtul0079gwi56h6rbmfh"},{"name":"kubernetes","_id":"cl7g6gtum007egwi5gui68vn0"},{"name":"kubectl","_id":"cl7g6gtun007ogwi57j7gaisn"},{"name":"kubeadm","_id":"cl7g6gtuo007sgwi53si8bf0r"},{"name":"kubelet","_id":"cl7g6gtuq007zgwi5aesh0h62"},{"name":"redis-cluster","_id":"cl7g6gtur0087gwi595duhgc6"},{"name":"traefik","_id":"cl7g6gtur008agwi5dvje9ltu"},{"name":"ingress","_id":"cl7g6gtus008egwi5e8m736pm"},{"name":"k8s","_id":"cl7g6gtus008igwi531z9bwnf"},{"name":"tar","_id":"cl7g6gtut008ogwi5882d1pov"},{"name":"unzip","_id":"cl7g6gtuu008sgwi5fac03mtz"},{"name":"xz","_id":"cl7g6gtuv008ugwi5f7yf5h1c"},{"name":"download","_id":"cl7g6gtuv008wgwi58szibtsl"},{"name":"wget","_id":"cl7g6gtuw0091gwi5an8y19dl"},{"name":"curl","_id":"cl7g6gtuw0095gwi5e3m96rq2"},{"name":"find","_id":"cl7g6gtux0099gwi58yjpcja0"},{"name":"grep","_id":"cl7g6gtux009egwi501ataeaf"},{"name":"iptable","_id":"cl7g6gtuy009jgwi58s4q1ubn"},{"name":"shell","_id":"cl7g6gtuy009mgwi5dzkhfp87"},{"name":"sed","_id":"cl7g6gtuz009pgwi51buyeezm"},{"name":"tree","_id":"cl7g6gtv0009xgwi53vjf3zsc"},{"name":"usage_high","_id":"cl7g6gtv100a2gwi5d2y53vp3"},{"name":"vim","_id":"cl7g6gtv100a7gwi5aims55a0"},{"name":"tomcat","_id":"cl7g6gtv200acgwi5b4wi82s7"},{"name":"mongodb","_id":"cl7g6gtv200ahgwi5fur8dudw"},{"name":"auth","_id":"cl7g6gtv300amgwi51fenfz1y"},{"name":"safe","_id":"cl7g6gtv300argwi5hfde808s"},{"name":"win","_id":"cl7g6gtv500b1gwi5g3jc9d2d"},{"name":"log","_id":"cl7g6gtv500b6gwi5agwbghg2"},{"name":"search","_id":"cl7g6gtv700bjgwi53o8je1qi"},{"name":"服务发现","_id":"cl7g6gtv700brgwi57uoockrb"},{"name":"选举","_id":"cl7g6gtv800bugwi5ah4c3vb7"},{"name":"hexo","_id":"cl7g6gtv800bwgwi57kzm48pf"},{"name":"issues","_id":"cl7g6gtv900c3gwi52hp6e2es"},{"name":"源","_id":"cl7g6gtv900c5gwi5d9mh7fe2"},{"name":"mysql","_id":"cl7g6gtv900c7gwi5bgy3e707"},{"name":"jpa","_id":"cl7j3sxe80002lri50og44jq4"},{"name":"中文","_id":"cl7j3sxel0007lri5dg9i4j5a"},{"name":"zh-cn","_id":"cl7j3sxen000blri5bdfna2fj"},{"name":"linux","_id":"cl7j3sxep000glri5cjgycs4n"},{"name":"脚本","_id":"cl7j3sxeq000klri53yuef638"},{"name":"lua","_id":"cl7j3sxer000plri5fmmua4ag"},{"name":"插件","_id":"cl7j3sxes000tlri57o83gotl"},{"name":"设置","_id":"cl7j3sxes000xlri52ht8ebho"},{"name":"xxx","_id":"cl7j3sxeu000zlri54snq1p8x"},{"name":"PL/SQL","_id":"cl7j3sxeu0010lri53voxf2cf"},{"name":"oracle","_id":"cl7j3sxeu0013lri53lo24mos"},{"name":"mysql查询过程","_id":"cl7lok4bu0001j3i54pxl1p84"},{"name":"xx","_id":"cl7lok4bw0003j3i545a16n2n"},{"name":"quer","_id":"cl7lolbcz000cj3i55z0c6zja"},{"name":"query","_id":"cl7lolc8n000ej3i5d2x69nyt"},{"name":"format","_id":"cl7m1l259000176i5beiq1sqt"},{"name":"md","_id":"cl7m1l25n000676i50xbjg5cc"},{"name":"html","_id":"cl7m1l25o000976i5hwi0gcih"},{"name":"explain执行计划","_id":"cl7m1l25p000c76i574s9f2m4"},{"name":"函数","_id":"cl7m1l25q000h76i55zxj0mnq"},{"name":"function","_id":"cl7m1l25r000m76i5ar5lgn6k"},{"name":"config","_id":"cl7m1l25s000s76i54ge0ewb1"}]}}
[{"title":"hexoæ’ä»¶","url":"/lang/node/npm/hexo/","content":"\n\n\n\n\n\n## æœ¬åœ°æœç´¢\n\n```\nnpm install --save hexo-generator-search\n```\n\n\n\n### hexo\n\n_config.yml\n\n```\nsearch:\n  path: search.json\n  field: all\n  content: true\n  limit: 1000\n```\n\n\n\n\n\n### ä¸»é¢˜spfk\n\n#### _config.yml\n\n```\nsearch_box: true\n```\n\n#### å·¦ä¾§left-col.ejs\n\n/hexo/themes/spfk/layout/_partial/left-col.ejs\n\n```ejs\n<div id=\"id_search\"   onclick = \"document.getElementById('local_search').style.display='block'\">\n <span class=\"search-icon\">\n\t<i class=\"fa fa-search\"> </i>\n   </span> æœç´¢\n</div>\n```\n\n#### å¼¹å‡ºå±‚layout.ejs\n\n/hexo/themes/spfk/layout/layout.ejs\n\n```ejs\n<div id=\"local_search\" class=\"search-popup\" >\n  <div class=\"search-header\">\n\t    <i class=\"fa fa-search\"> </i> <input id=\"local-search-input\" class=\"search-input\" placeholder=\"æœç´¢...\" spellcheck=\"false\" type=\"search\"/>\n  </div>\n  <div id=\"local-search-result\"></div>\n</div>\n```\n\n####  è§¦å‘æœç´¢ after-footer.ejs\n\n/hexo/themes/spfk/layout/_partial/after-footer.ejs\n\n##### å¼•å…¥search.js\n\n```\n<%- js('js/jquery-1.9.1.min') %>\n<%- js('js/search') %>\n\n<% if (theme.search_box) { %>\n   <script type=\"text/javascript\">\n\tvar inputArea       = document.querySelector(\"#local-search-input\");\n\tinputArea.onclick   = function(){ getSearchFile(); this.onclick = null }\n\tinputArea.onkeydown = function(){ if(event.keyCode == 13) return false }\n\tvar getSearchFile = function(){\n\t      searchFunc(\"<%= config.root %>\" + \"search.json\", 'local-search-input', 'local-search-result');\n\t}\n          $(document).on('click', function(e) {\n\t\t   var si= $(e.target).closest('#id_search').length;\n           var d= $(e.target).closest('#local_search').length;\n             if( si==0 && d==0){\n               $('#local_search').hide();\n              }    \n\n       });\n\n  </script>\n<% } %>\n```\n\n##### search.js\n\n/hexo/themes/spfk/source/js/search.js\n\n```js\nvar searchFunc = function (path, search_id, content_id) {\n  // 0x00. environment initialization\n  'use strict';\n  var $input = document.getElementById(search_id);\n  var $resultContent = document.getElementById(content_id);\n  $resultContent.innerHTML = \"<ul><span class='local-search-empty'>é¦–æ¬¡æœç´¢ï¼Œæ­£åœ¨è½½å…¥ç´¢å¼•æ–‡ä»¶ï¼Œè¯·ç¨åâ€¦â€¦<span></ul>\";\n  $.ajax({\n    // 0x01. load xml file\n    url: path,\n    dataType: \"json\",\n    success: function (datas) {\n      $resultContent.innerHTML = \"\";\n      $input.addEventListener('input', function () {\n        // 0x03. parse query to keywords list\n        var str = '<ul class=\\\"search-result-list\\\">';\n        var keywords = this.value.trim().toLowerCase().split(/[\\s\\-]+/);\n        $resultContent.innerHTML = \"\";\n        if (this.value.trim().length <= 0) {\n          return;\n        }\n        // 0x04. perform local searching\n        datas.forEach(function (data) {\n          var isMatch = true;\n          var content_index = [];\n          if (!data.title || data.title.trim() === '') {\n            data.title = \"Untitled\";\n          }\n          var orig_data_title = data.title.trim();\n          var data_title = orig_data_title.toLowerCase();\n             if (!data.content || data.content.trim() === '') {\n                         console.log(data.content)//ç©ºæ–‡ç« \n                      data.content = \"no content\";\n                 }\n          var orig_data_content = data.content.trim().replace(/<[^>]+>/g, \"\");\n          var data_content = orig_data_content.toLowerCase();\n          var data_url = data.url;\n     \n          var index_title = -1;\n          var index_content = -1;\n          var first_occur = -1;\n          // only match artiles with not empty contents\n          if (data_content !== '') {\n            keywords.forEach(function (keyword, i) {\n              index_title = data_title.indexOf(keyword);\n              index_content = data_content.indexOf(keyword);\n\n              if (index_title < 0 && index_content < 0) {\n                isMatch = false;\n              } else {\n                if (index_content < 0) {\n                  index_content = 0;\n                }\n                if (i == 0) {\n                  first_occur = index_content;\n                }\n                // content_index.push({index_content:index_content, keyword_len:keyword_len});\n              }\n            });\n          } else {\n            isMatch = false;\n          }\n          // 0x05. show search results\n          if (isMatch) {\n            str += \"<li><a href='\" + data_url + \"' class='search-result-title' target='_blank'>\" + orig_data_title + \"</a>\";\n            var content = orig_data_content;\n            if (first_occur >= 0) {\n              // cut out 100 characters\n              var start = first_occur - 20;\n              var end = first_occur + 10;\n\n              if (start < 0) {\n                start = 0;\n              }\n\n              if (start == 0) {\n                end = 100;\n              }\n\n              if (end > content.length) {\n                end = content.length;\n              }\n\n              var match_content = content.substr(start, end);\n\n              // highlight all keywords\n              keywords.forEach(function (keyword) {\n                var regS = new RegExp(keyword, \"gi\");\n                match_content = match_content.replace(regS, \"<em class=\\\"search-keyword\\\">\" + keyword + \"</em>\");\n              });\n\n              str += \"<p class=\\\"search-result\\\">\" + match_content + \"...</p>\"\n            }\n            str += \"</li>\";\n          }\n        });\n        str += \"</ul>\";\n        if (str.indexOf('<li>') === -1) {\n          return $resultContent.innerHTML =  \"<ul><span class='local-search-empty'>æ²¡æœ‰æ‰¾åˆ°å†…å®¹ï¼Œè¯·å°è¯•æ›´æ¢æ£€ç´¢è¯ã€‚<span></ul>\";\n        }\n        $resultContent.innerHTML =  str;\n      });\n    }\n  });\n}\n```\n\n##### css\n\n/hexo/themes/spfk/source/css/search.css\n\n```css\n\n.search-popup {\n  display: none;\n  background: #32503d;\n  border-radius: 5px;\n  height: 80%;\n  left: calc(50% - 350px);\n  position: fixed;\n  top: 10%;\n  width: 700px;\n  z-index: 1500;\n}\n\n.search-popup .search-header {\n  background: #eee;\n  border-top-left-radius: 5px;\n  border-top-right-radius: 5px;\n  display: flex;\n  padding: 5px;\n}\n.search-popup input.search-input {\n  background: transparent;\n  border: 0;\n  outline: 0;\n  width: 100%;\n}\n\n\n.search-popup ul.search-result-list {\n  margin: 0 5px;\n  padding: 0;\n  width: 100%;\n \n}\n\nul.search-result-list li::marker {\n content: 'ğŸ˜©';\n}\n\n\n.search-popup p.search-result {\n  border-bottom: 2px dashed #7de485d4;\n  padding: 5px 0;\n  line-height: 21px;\n}\n.search-popup a.search-result-title {\n  font-weight: bold;\n}\n.search-popup .search-keyword {\n  border-bottom: 1px dashed #ff2a2a;\n  color: #ff2a2a;\n  font-weight: bold;\n}\n.search-popup #local-search-result{\n  display: flex;\n  height: calc(100% - 55px);\n  overflow: auto;\n  padding: 5px 25px;\n}\n.search-popup #no-result {\n  color: #ccc;\n  margin: auto;\n}\n```\n\n\n\n\n\n\n\n","tags":["search","hexo"],"categories":["lang","node","npm"]},{"title":"decompressè§£å‹/å‹ç¼©","url":"/linux/shell/decompress/","content":"\n\n\n## tar\n\n### è§£å‹\n\n```\ntar -zxvf  helm-v3.9.3-linux-amd64.tar.gz\n```\n\n>-z    tar.gz  tgz\n>\n>-j    tar.bz2   tbz\n>\n>-C  æ¥æŒ‡å®šç›®å½•\n\n\n\n### å‹ç¼©\n\n\n\n```\ntar zcvf /dir/file.tar.gz   /dir/file\n```\n\n> -z  gzipå‹ç¼©\n>\n> -j  bzip2å‹ç¼©\n>\n> -zp  gzipå‹ç¼©ï¼Œå¹¶ä¸”ä¿ç•™æƒé™ä¿¡æ¯(-pçš„å±æ€§æ˜¯å¾ˆé‡è¦çš„ï¼Œå°¤å…¶æ˜¯å½“æ‚¨è¦ä¿ç•™åŸæœ¬æ–‡ä»¶çš„å±æ€§æ—¶)\n>\n> --strip-components 1  å»æ‰æœ€å¤–å±‚ç›®å½•\n","tags":["tar","unzip","xz"],"categories":["linux","shell"]},{"title":"downloadå·¥å…·å‘½ä»¤","url":"/linux/k8s/download/","content":"\n\n\n## wget\n\n### å¸¸è§„ä½¿ç”¨\n\n```\nwget [options] [url]\n```\n\n#### æŒ‡å®šæ–‡ä»¶\n\n```\nwget  -P /opt/docker  https://get.helm.sh/helm-v3.9.3-linux-amd64.tar.gz\n```\n\n>-c æ–­ç‚¹ç»­ä¼ \n>\n>-O ä¸‹è½½å¹¶ä»¥ä¸åŒçš„æ–‡ä»¶åä¿å­˜\n>\n> -b åå°ä¸‹è½½\n>\n>â€“spider æµ‹è¯•ä¸‹è½½é“¾æ¥\n>\n>--limit-rate=1m  é€Ÿåº¦é™åˆ¶ä¸º1m/s\n\n\n\n### æ‰¹é‡ä¸‹è½½\n\n#### æœ‰è§„å¾‹\n\n```\nwget http://www.xxxx.com/file_{1..4}.txt\n```\n\n> æ¯”å¦‚ï¼šfile_1.txtï¼Œfile_2.txtï¼Œfile_3.txt\n\n\n\n#### æ²¡æœ‰è§„å¾‹\n\n```\ncat >downloads.txt<<EOF\nhttp://www.xxxx.com/xxx\nhttp://www.xxxx.com/xxx\nEOF\nwget -i downloads.txt\n```\n\n\n\n### ä¸‹è½½æ•´ä¸ªç›®å½•\n\n\n\n```\nwget -r -np -nH -R index.html http://url/files/download/\n```\n\n>-r : éå†æ‰€æœ‰å­ç›®å½•\n>-np : ä¸åˆ°ä¸Šä¸€å±‚å­ç›®å½•å»\n>-nH : ä¸è¦å°†æ–‡ä»¶ä¿å­˜åˆ°ä¸»æœºåæ–‡ä»¶å¤¹\n>-R index.html : ä¸ä¸‹è½½ index.html æ–‡ä»¶\n>\n>-k å°†ç½‘é¡µå†…ç»å¯¹é“¾æ¥è½¬ä¸ºç›¸å¯¹é“¾æ¥\n\n\n\n### æ¨¡æ‹Ÿ\n\næ¨¡æ‹Ÿ Edge æµè§ˆå™¨å‘å‡ºæ¥çš„è¯·æ±‚\n\n```\nwget --debug --header=\"User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36 Edg/91.0.864.59\" http://www.baidu.com\n```\n\næ¨¡æ‹Ÿæ‰‹æœº\n\n```\nwget --debug --header=\"User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 13_5_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1.1 Mobile/15E148 Safari /604.1\" http://www.baidu.com\n```\n\n\n\n\n\n## curl\n\n\n\n```\ncurl   -ikv   http://www.baidu.com\n```\n\n","tags":["download","wget","curl"],"categories":["linux","shell"]},{"title":"helmå·¥å…·","url":"/linux/k8s/helm/","content":"\n\n\n### å®‰è£…\n\nä¸‹è½½ https://helm.sh/docs/intro/install/\n\n```\nwget  -P /opt/docker  https://get.helm.sh/helm-v3.9.3-linux-amd64.tar.gz\nmkdir /opt/docker/helm-v3.9.3\ntar -zxvf  helm-v3.9.3-linux-amd64.tar.gz  -C  ./helm-v3.9.3   --strip-components 1\n```\n\n\n\n### è®¾ç½®ç¯å¢ƒå˜é‡\n\n```\n$ cat >> ~/.bashrc <<EOF\n#helm\nexport PATH=$PATH:/opt/docker/helm-v3.9.3\nEOF\n$ helm version\nversion.BuildInfo{Version:\"v3.9.3\", GitCommit:\"414ff28d4029ae8c8b05d62aa06c7fe3dee2bc58\", GitTreeState:\"clean\", GoVersion:\"go1.17.13\"}\n\n```\n\n\n\n### æ·»åŠ æº\n\n\n\n```\nhelm repo add stable http://mirror.azure.cn/kubernetes/charts \nhelm repo add aliyun https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts \nhelm repo list\n```\n\n\n\nshow\n\n```\nhelm show chart stable/mysql\n```\n\n\n\ninstall\n\n```\n helm install db stable/mysql\nWARNING: This chart is deprecated\nNAME: db\nLAST DEPLOYED: Thu Aug 18 21:33:05 2022\nNAMESPACE: default\nSTATUS: deployed\nREVISION: 1\nNOTES:\nMySQL can be accessed via port 3306 on the following DNS name from within your cluster:\ndb-mysql.default.svc.cluster.local\n\nTo get your root password run:\n\n    MYSQL_ROOT_PASSWORD=$(kubectl get secret --namespace default db-mysql -o jsonpath=\"{.data.mysql-root-password}\" | base64 --decode; echo)\n\nTo connect to your database:\n\n1. Run an Ubuntu pod that you can use as a client:\n\n    kubectl run -i --tty ubuntu --image=ubuntu:16.04 --restart=Never -- bash -il\n\n2. Install the mysql client:\n\n    $ apt-get update && apt-get install mysql-client -y\n\n3. Connect using the mysql cli, then provide your password:\n    $ mysql -h db-mysql -p\n\nTo connect to your database directly from outside the K8s cluster:\n    MYSQL_HOST=127.0.0.1\n    MYSQL_PORT=3306\n\n    # Execute the following command to route the connection:\n    kubectl port-forward svc/db-mysql 3306\n\n    mysql -h ${MYSQL_HOST} -P${MYSQL_PORT} -u root -p${MYSQL_ROOT_PASSWORD}\n```\n\n\n\n```\ns@debian:~$ kubectl  get pod -A\nNAMESPACE     NAME                          READY   STATUS    RESTARTS   AGE\ndefault       db-mysql-7f4fdddfd5-2dqql     0/1     Pending   0          67s\n```\n\n","tags":["helm"],"categories":["linux","k8s"]},{"title":"kubeletç»„ä»¶","url":"/linux/k8s/kubelet/","content":"\n\n\n\n\n#### äºŒè¿›åˆ¶\n\nversion 1.18\n\n##### kubelet.env\n\n```shell\n[vagrant@k8s kubernetes]$ cat > /opt/kubernetes/kubelet/kubelet.env <<EOF\nKUBELET_OPTIONS=\" --pod-infra-container-image=k8s.org/k8s/pause:3.2   \\\n--bootstrap-kubeconfig=/opt/kubernetes/config/bootstrap.kubeconfig   \\\n--kubeconfig=/opt/kubernetes/config/kubelet.kubeconfig   \\\n--config=/opt/kubernetes/kubelet/kubelet-config.yaml    \\\n--cni-bin-dir=/opt/kubernetes/cni/bin    \\\n--cni-conf-dir=/opt/kubernetes/cni/net.d    \\\n--network-plugin=cni    \\\n-runtime-cgroups=/systemd/system.slice    \\\n--log-dir=/var/log/kubernetes/kubelet     \\\n--logtostderr=false    \\\n--v=2\"\nEOF\n```\n\n<!--more-->\n\n##### kubelet-config.yaml\n\n```\napiVersion: kubelet.config.k8s.io/v1beta1\nkind: KubeletConfiguration\naddress: \"192.168.56.102\"\nport: 10250\nhealthzBindAddress: \"192.168.56.102\"\nhealthzPort: 10248\nreadOnlyPort: 0\ncgroupDriver: \"cgroupfs\"\nclusterDomain: \"cluster.local\"\nclusterDNS: [\"121.21.0.0\"]\nfailSwapOn: false\ntlsCertFile: \"/opt/kubernetes/pem/kubelet.pem\"\ntlsPrivateKeyFile: \"/opt/kubernetes/pem/kubelet-key.pem\"\nauthentication:\n    x509:\n        clientCAFile: \"/opt/kubernetes/pem/ca.pem\"\n    webhook:\n        enabled: true\n        cacheTTL: \"2m0s\"\n    anonymous:\n        enabled: false\nauthorization:\n    mode: Webhook\n    webhook:\n        cacheAuthorizedTTL: \"5m0s\"\n        cacheUnauthorizedTTL: \"30s\"\nhairpinMode: \"promiscuous-bridge\"\nserializeImagePulls: false\nfeatureGates:\n    RotateKubeletClientCertificate: true\n    RotateKubeletServerCertificate: true\n```\n\n\n\n#### å®¹å™¨\n\nversion 1.22\n\n##### kubelet.env\n\n```shell\n[vagrant@k8s kubernetes]$ cat > /opt/kubernetes/kubelet.env <<EOF\n KUBELET_OPTIONS=\" --hostname-override=k8s  \\\n --pod-infra-container-image=k8s.org/k8s/pause:3.4.1 \\\n --kubeconfig=/etc/kubernetes/kubelet.conf    \\\n --config=/var/lib/kubelet/config.yaml     \\\n --register-node=true        \\\n --runtime-cgroups=/systemd/system.slice    \\\n --logtostderr=true \"\nEOF\n```\n\n> --network-plugin=cni  **å»æ‰**\n\n\n\n##### kubelet.conf\n\n/etc/kubernetes/kubelet.conf\n\n```\napiVersion: v1\nclusters:\n- cluster:\n    certificate-authority-data: xxxx..xxxxxxx==\n    server: https://192.168.56.108:6443\n  name: k8s\ncontexts:\n- context:\n    cluster: k8s\n    user: system:node:k8s\n  name: system:node:k8s@k8s\ncurrent-context: system:node:k8s@k8s\nkind: Config\npreferences: {}\nusers:\n- name: system:node:k8s\n  user:\n    client-certificate: /var/lib/kubelet/pki/kubelet-client-current.pem\n    client-key: /var/lib/kubelet/pki/kubelet-client-current.pem\n```\n\n\n\n##### config.yaml\n\n/var/lib/kubelet/config.yaml\n\n```\napiVersion: kubelet.config.k8s.io/v1beta1\nauthentication:\n  anonymous:\n    enabled: false\n  webhook:\n    cacheTTL: 0s\n    enabled: true\n  x509:\n    clientCAFile: /etc/kubernetes/pki/ca.crt\nauthorization:\n  mode: Webhook\n  webhook:\n    cacheAuthorizedTTL: 0s\n    cacheUnauthorizedTTL: 0s\ncgroupDriver: cgroupfs\nclusterDNS:\n- 10.96.0.10\nclusterDomain: cluster.local\ncpuManagerReconcilePeriod: 0s\nevictionPressureTransitionPeriod: 0s\nfailSwapOn: false\nfileCheckFrequency: 0s\nhealthzBindAddress: 127.0.0.1\nhealthzPort: 10248\nhttpCheckFrequency: 0s\nimageMinimumGCAge: 0s\nkind: KubeletConfiguration\nlogging: {}\nnodeStatusReportFrequency: 0s\nnodeStatusUpdateFrequency: 0s\nrotateCertificates: true\nruntimeRequestTimeout: 0s\nshutdownGracePeriod: 0s\nshutdownGracePeriodCriticalPods: 0s\nstaticPodPath: /etc/kubernetes/manifests\nstreamingConnectionIdleTimeout: 0s\nsyncFrequency: 0s\nvolumeStatsAggPeriod: 0s\n```\n\n\n\n#### service<a id=\"id-service\"/>\n\n##### kubelet.service\n\n```\n[vagrant@k8s kubernetes]$ cat >/usr/lib/systemd/system/kubelet.service <<EOF\n[Unit]\nDescription=Kubernetes Kubelet Server\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nWorkingDirectory=/var/lib/kubelet\nEnvironmentFile=/opt/kubernetes/kubelet.env\nExecStart=/opt/kubernetes/bin/kubelet  $KUBELET_OPTIONS\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\nEOF\n```\n\nkubeadméƒ¨ç½²,ä¸ç”¨å¯åŠ¨,ä¼šè‡ªåŠ¨æ‹‰èµ·\n\nåˆå§‹åŒ–è‡ªåŠ¨ç”Ÿæˆ\n\n/etc/kubernetes/kubelet.conf\n\n/var/lib/kubelet/config.yaml\n\n\n\nå¼€æœºè‡ªå¯åŠ¨\n\n```\nsystemctl enable kubelet\n```\n\n","tags":["kubelet"],"categories":["linux","k8s"]},{"title":"Mathjaxå…¬å¼","url":"/markdown/formula/","content":"\n\n\nWhen $a \\ne 0$, there are two solutions to \\(ax^2 + bx + c = 0\\) and they are\n\n$$x = {-b \\pm \\sqrt{b^2-4ac} \\over 2a}.$$\n\n![](/pics/mathjax01.png)\n\n\n\n<!--more-->\n\nhttp://mathjax.josephjctang.com/\n\n```shell\n$ grep theme.mathjax -rl --include=\\*.{ejs,js} /home/cs/oss/hexo/themes/spfk\n/home/cs/oss/hexo/themes/spfk/layout/_partial/head.ejs\n$ sed -i 's/theme.mathjax/page.mathjax/' /hexo/themes/spfk/layout/_partial/after-footer.ejs\n```\n\n> <% if (page.mathjax){ %>\n\n\n\n/hexo/public/js/MathJax.js æ·»åŠ å¼•å…¥\n\n```\n  <script type=\"text/javascript\"\n     src=\"http://mathjax.josephjctang.com/MathJax.js?config=TeX-MML-AM_HTMLorMML\">\n  </script>\n```\n\næ–‡ç« å¼€å¤´åŠ å…¥\n\n```\ntitle: xxxx\npermalink: xxxx\ntags: xxxx\ndate: xxxx\nmathjax: true\n```\n\n> mathjax: true\n\n\n\nå¼•å…¥ç›®å½•\n\n![](/pics/mathjax.png)\n","tags":["formula"],"categories":["markdown"]},{"title":"harboré•œåƒç§åº“","url":"/linux/k8s/harbor/","content":"\n## é…ç½®è¦æ±‚\n\n### ç¡¬ä»¶\n\n| èµ„æº | æœ€ä½  | æ¨è   |\n| ---- | ----- | ------ |\n| CPU  | 2 CPU | 4 CPU  |\n| Mem  | 4 GB  | 8 GB   |\n| Disk | 40 GB | 160 GB |\n\n\n\n### è½¯ä»¶\n\ndocker  v17.06.0-ce+  [Docker å¼•æ“æ–‡æ¡£](https://docs.docker.com/engine/installation/)\n\ndocker-compose v1.18.0+  [Docker Compose æ–‡æ¡£](https://docs.docker.com/compose/install/)\n\nOpenSSL\n\n\n\n### ç½‘ç»œç«¯å£\n\nHTTPS  443/4443\n\nHTTP  80\n\n\n\n## å®‰è£…\n\nä»“åº“\n\nhttps://github.com/goharbor/harbor/releases\n\næ–‡æ¡£\n\nhttps://goharbor.io/docs/2.5.3/install-config/download-installer/\n\n\n\n### harbor\n\n#### è¯ä¹¦ca.key\n\nhttps://goharbor.io/docs/2.5.3/install-config/configure-https/\n\n##### ç”ŸæˆCAç§é’¥\n\n```shell\n openssl genrsa -out ca.key 4096\n```\n\n<!--more-->\n\n##### ç”ŸæˆCAè¯ä¹¦\n\n```shell\n openssl req -x509 -new -nodes -sha512 -days 3650 \\\n -subj \"/C=CN/ST=GD/L=SZ/O=cs/OU=shea/CN=k8s.org\" \\\n  -key ca.key \\\n  -out ca.crtopenssl genrsa -out ca.key 4096\n```\n\n#### æœåŠ¡å™¨è¯ä¹¦\n\n##### ç”Ÿæˆç§é’¥\n\n```shell\n openssl genrsa -out k8s.org.key 4096\n```\n\n##### ç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCSRï¼‰\n\n```shell\nopenssl  req -sha512 -new \\\n -subj \"/C=CN/ST=GD/L=SZ/O=cs/OU=shea/CN=k8s.org\" \\\n -key k8s.org.key \\\n -out k8s.org.csr\n```\n\n##### ç”Ÿæˆä¸€ä¸ªx509 v3æ‰©å±•æ–‡ä»¶\n\n```shell\n cat > v3.ext <<-EOF\nauthorityKeyIdentifier=keyid,issuer\nbasicConstraints=CA:FALSE\nkeyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment\nextendedKeyUsage = serverAuth\nsubjectAltName = @alt_names\n\n[alt_names]\nDNS.1=k8s.org\nDNS.2=k8s\nDNS.3=k8s\nEOF\n```\n\n##### ä½¿ç”¨è¯¥v3.extæ–‡ä»¶ä¸ºæ‚¨çš„Harborä¸»æœºç”Ÿæˆè¯ä¹¦\n\n```shell\nopenssl x509 -req -sha512 -days 3650 \\\n    -extfile v3.ext \\\n    -CA ca.crt -CAkey ca.key -CAcreateserial \\\n    -in k8s.org.csr \\\n    -out k8s.org.crt\n```\n\n\n\nDockerå®ˆæŠ¤ç¨‹åºå°†.crtæ–‡ä»¶è§£é‡Šä¸ºCAè¯ä¹¦ï¼Œå¹¶å°†.certæ–‡ä»¶è§£é‡Šä¸ºå®¢æˆ·ç«¯è¯ä¹¦\n\n```shell\nopenssl x509 -inform PEM -in k8s.org.crt -out k8s.org.cert\n```\n\n\n\n#### harbor.yml\n\nä»£ç†ç½‘å€ https://ghproxy.com  ä¸‹è½½\n\nhttps://ghproxy.com/https://github.com/goharbor/harbor/releases/download/v2.5.3/harbor-offline-installer-v2.5.3.tgz\n\n```\ncs@debian:~/ä¸‹è½½/æ–°å»ºæ–‡ä»¶å¤¹$ md5sum harbor-offline-installer-v2.5.3.tgz \nd858f6969829e4ce2769a790ecaa0cf7  harbor-offline-installer-v2.5.3.tgz\n\ncs@debian:~/ä¸‹è½½/æ–°å»ºæ–‡ä»¶å¤¹$ tar xzvf harbor-offline-installer-v2.5.3.tgz\ncs@debian:~/ä¸‹è½½/æ–°å»ºæ–‡ä»¶å¤¹$ tree -L 1 ./harbor\n./harbor\nâ”œâ”€â”€ common.sh\nâ”œâ”€â”€ harbor.v2.5.3.tar.gz\nâ”œâ”€â”€ harbor.yml.tmpl\nâ”œâ”€â”€ install.sh\nâ”œâ”€â”€ LICENSE\nâ””â”€â”€ prepare\n\n0 directories, 6 files\n```\n\n\n\n```\nsed -n '/hostname/s/reg.mydomain.com/192.168.56.1/'p ./harbor/harbor.yml.tmpl \nhostname: 192.168.56.1\nsed -n '/port:/s/443/8443/'p ./harbor/harbor.yml.tmpl \n  port: 8443\nsed -n '/certificate:/s/\\/your.*path/\\/opt\\/nginx\\/conf\\/conf.d\\/ssl\\/k8s.org.crt/'p ./harbor/harbor.yml.tmpl \n  certificate: /opt/nginx/conf/conf.d/ssl/k8s.org.crt\n```\n\n>hostname\n>\n>https   port ,certificate,private_key\n>\n>external_url\n>\n>harbor_admin_password\n>\n>data_volume\n>\n>ç”¨å¤–éƒ¨æ•°æ®åº“,redisæ—¶éœ€è¦é…ç½® external_database,external_redis \n\n\n\n```\nsudo ./install.sh\n```\n\n> é»˜è®¤çš„ Harbor å®‰è£…ä¸åŒ…æ‹¬ Notary æˆ– Trivy ç­‰æœåŠ¡\n>\n> ./install.sh --with-notary --with-trivy --with-chartmuseum\n>\n>  --with-notary  æ•°æ®æƒé™\n>\n> --with-trivy   æ¼æ´æ‰«æ\n>\n> --with-chartmuseum helm\n\n\n\n### docker\n\n#### certs.d\n\n```shell\ntree -L 3 /etc/docker/\n/etc/docker/\nâ”œâ”€â”€ certs.d\nâ”‚Â Â  â””â”€â”€ k8s.org\nâ”‚Â Â      â”œâ”€â”€ ca.crt\nâ”‚Â Â      â”œâ”€â”€ k8s.org.cert\nâ”‚Â Â      â””â”€â”€ k8s.org.key\nâ”œâ”€â”€ daemon.json\nâ””â”€â”€ key.json\n\n2 directories, 5 files\n```\n\n> cp yourdomain.com.cert /etc/docker/certs.d/yourdomain.com/\n>cp yourdomain.com.key /etc/docker/certs.d/yourdomain.com/\n>cp ca.crt /etc/docker/certs.d/yourdomain.com/\n\n\n\n#### daemon.json\n\n```json\n{\n    \"data-root\": \"/opt/data/docker\",\n   \"registry-mirrors\" : [\n    \"http://hub-mirror.c.163.com\"\n  ],\n\"insecure-registries\":[\n  \"https://k8s.org\"\n  ],\n  \"debug\" : true,\n  \"experimental\" : true\n}\n\n```\n\n> insecure-registries ç§åº“åœ°å€,éåŸŸåæ ¼å¼ ip:ç«¯å£\n\n\n\n#### login\n\nç™»å½•å¯†ç ä¼šä¿å­˜è®¤è¯,ä¸‹æ¬¡pushé•œåƒå°±ä¸éœ€è¦è¾“å…¥å¯†ç äº†\n\n```shell\ncs@debian:~$ docker login k8s.org\ncs@debian:~$ cat  ~/.docker/config.json \n{\n\t\"auths\": {\n\t\t\"cs.org\": {\n\t\t\t\"auth\": \"YWRtaW46YWRtaW4=\"\n\t\t},\n\t\t\"k8s.org\": {\n\t\t\t\"auth\": \"YWRtaW46Y3MxMjM0NTY=\"\n\t\t}\n\t},\n\t\"HttpHeaders\": {\n\t\t\"User-Agent\": \"Docker-Client/18.09.3 (linux)\"\n\t}\n}\n```\n\n\n\n\n\n### nginx\n\n/opt/nginx/conf/conf.d/http/harbor.conf\n\n```\nupstream harbors{\n     server 192.168.56.1:8443;\n     #server 192.168.56.2:8443;\n}\n\n\nlog_format  harbor_log  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                     '$status $body_bytes_sent \"$http_referer\" '\n                     '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n\nserver {\n       listen       443 ssl;\n       server_name  k8s.org;\n\n        ssl_certificate      conf.d/ssl/k8s.org.crt;\n        ssl_certificate_key  conf.d/ssl/k8s.org.key;\n\n        ssl_session_cache    shared:SSL:1m;\n        ssl_session_timeout  5m;\n\n        ssl_ciphers  HIGH:!aNULL:!MD5;\n        ssl_prefer_server_ciphers  on;\n\n       access_log  logs/harbors.log  harbor_log;\n       location / {\n            client_max_body_size  1024m;  # è®¾ç½®æ¥æ”¶å®¢æˆ·ç«¯ body æœ€å¤§é•¿åº¦ä¸º 1024M\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_pass https://harbors;\n        }\n}\n```\n\n> error parsing HTTP 413 response body: ...... <title>413 Request Entity Too Large</title>\n>\n> **client_max_body_size**\n\n\n\n## æ¨é€\n\nåŸŸå/ç›®å½•/é•œåƒå:ç‰ˆæœ¬å·\n\n```shell\n$ docker images | grep etcd\nk8s.org/k8s/etcd                      3.4.13-0            51401ddb110e        23 months ago       145MB\n\n$ docker push  k8s.org/k8s/etcd:3.4.13-0\n```\n\n\n\n### é¡¹ç›® \n\n![](/pics/harbor-01.png)\n\n### é•œåƒ\n\n![](/pics/harbor-02.png)\n\n\n\n## é«˜å¯ç”¨\n\né€šè¿‡é…ç½®æ•°æ®åº“(mysql ,redisé›†ç¾¤),å­˜å‚¨æ¥å®ç°\n\n\n\n## ERROR\n\n### pull Retrying in\n\nhttps://github.com/vmware/harbor/issues/3062\n\n/opt/nginx/conf/nginx.conf\n\n```\nhttp {\n    ......\n      ####æ·»åŠ ä»¥ä¸‹é…ç½®\n      proxy_buffers 4 32k;\n      proxy_busy_buffers_size 64k;\n      proxy_temp_file_write_size 64k;\n      #unlimit the proxy temp file size limitaion. Look at issue #3062 (https://github.com/vmware/harbor/issues/3062)\n      proxy_max_temp_file_size 0;\n\n  ....      \n  }\n```\n\n\n\n```\nhttp:\n  relativeurls: true\n```\n\nharborçš„helmé‡Œéœ€è¦åŠ ä¸Šregistry.relativeurls=true\n\nå‚è€ƒï¼šhttps://github.com/docker/distribution/issues/970#issuecomment-284227065\n\n\n\n### ImagePullBackOff\n\n#### åˆ›å»ºä¸€ä¸ªåŸºäºç°æœ‰å‡­è¯çš„ Secret\n\n```\n$ kubectl create secret generic login --from-file=.dockerconfigjson=/home/cs/.docker/config.json  --type=kubernetes.io/dockerconfigjson \nsecret/login created\n```\n\n\n\n#### åœ¨å‘½ä»¤è¡Œä¸Šæä¾›å‡­è¯æ¥åˆ›å»º Secret\n\n```\nkubectl create secret docker-registry regcred \\\n--docker-server=<ä½ çš„é•œåƒä»“åº“æœåŠ¡å™¨> \\\n--docker-username=<ä½ çš„ç”¨æˆ·å> \\\n--docker-password=<ä½ çš„å¯†ç > \\\n--docker-email=<ä½ çš„é‚®ç®±åœ°å€>\n```\n\n>åœ¨è¿™é‡Œï¼š\n\n>-  æ˜¯ä½ çš„ç§æœ‰ Docker ä»“åº“å…¨é™å®šåŸŸåï¼ˆFQDNï¼‰ã€‚ DockerHub ä½¿ç”¨ https://index.docker.io/v1/ã€‚\n>-  æ˜¯ä½ çš„ Docker ç”¨æˆ·åã€‚\n>-  æ˜¯ä½ çš„ Docker å¯†ç ã€‚\n>-  æ˜¯ä½ çš„ Docker é‚®ç®±ã€‚\n\nè¿™æ ·ä½ å°±æˆåŠŸåœ°å°†é›†ç¾¤ä¸­çš„ Docker å‡­è¯è®¾ç½®ä¸ºåä¸º regcred çš„ Secret\n\n#### æ£€æŸ¥ Secret \n\n\n\n```yaml\n$ kubectl get secrets\nNAME                  TYPE                                  DATA   AGE\nlogin                 kubernetes.io/dockerconfigjson        1      85d\n$ kubectl get secret login --output=yaml  \napiVersion: v1\ndata:\n  .dockerconfigjson: ewoJImF1dGhzIjogewoJCSJjcy5vcmciOiB7CgkJCSJhdXRoIjogIllXUnRhVzQ2WVdSdGFXND0iCgkJfSwKCQkiazhzLm9yZyI6IHsKCQkJImF1dGgiOiAiWVdSdGFXNDZZM014TWpNME5UWT0iCgkJfQoJfSwKCSJIdHRwSGVhZGVycyI6IHsKCQkiVXNlci1BZ2VudCI6ICJEb2NrZXItQ2xpZW50LzE4LjA5LjMgKGxpbnV4KSIKCX0KfQ==\nkind: Secret\n....\n```\n\n\n\n```\n$ kubectl get secret login --output=\"jsonpath={.data.\\.dockerconfigjson}\" | base64 --decode\n{\n\t\"auths\": {\n\t\t\"cs.org\": {\n\t\t\t\"auth\": \"YWRtaW46YWRtaW4=\"\n\t\t},\n\t\t\"k8s.org\": {\n\t\t\t\"auth\": \"YWRtaW46Y3MxMjM0NTY=\"\n\t\t}\n\t},\n\t\"HttpHeaders\": {\n\t\t\"User-Agent\": \"Docker-Client/18.09.3 (linux)\"\n\t}\n}\n```\n\n\n\n```\necho \"YWRtaW46Y3MxMjM0NTY=\" | base64 --decode \nadmin:cs12xx\n```\n\n\n\n#### pod\n\nåˆ›å»ºä¸€ä¸ªä½¿ç”¨ä½ çš„ Secret çš„ Pod\n\n```\napiVersion: v1\nkind: Pod\nmetadata:\n  name: private-reg\nspec:\n  containers:\n  - name: private-reg-container\n    image: <your-private-image>\n  imagePullSecrets:\n  - name: login\n```\n\n","tags":["harbor"],"categories":["linux","k8s"]},{"title":"kubeadmå®¹å™¨åŒ–å®‰è£…","url":"/linux/k8s/kubeadm/","content":"\n### docker\n\n#### daemon.json\n\n```shell\n[vagrant@k8s ~]$ sudo vi /etc/docker/daemon.json\n[vagrant@k8s ~]$ docker info | grep Driver\nStorage Driver: overlay2\nLogging Driver: json-file\nCgroup Driver: cgroupfs\n[vagrant@k8s ~]$ sudo systemctl restart docker \n[vagrant@k8s ~]$ docker info | grep Driver\nStorage Driver: overlay2\nLogging Driver: json-file\nCgroup Driver: systemd\n[vagrant@k8s ~]$ sudo cat  /etc/docker/daemon.json\n{\n \"exec-opts\": [\"native.cgroupdriver=systemd\"],\n \"insecure-registries\":[\"https://k8s.org\"]\n\n}\n```\n\n>\"exec-opts\": [\"native.cgroupdriver=systemd\"]\n\n Error response from daemon: OCI runtime create failed: systemd cgroup flag passed, but systemd support for managing cgroups is not available\n\n\n\n/etc/sysconfig/modules/ipvs.modules\n\n```\ncat > /etc/sysconfig/modules/ipvs.modules <<EOF\n#!/bin/bash\nmodprobe -- br_netfilter\nmodprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- nf_conntrack_ipv4\nEOF\nchmod 755 /etc/sysconfig/modules/ipvs.modules\n```\n\n\n\n```\n cat  /etc/sysctl.conf\nnet.ipv4.vs.conntrack=1\nnet.ipv4.vs.conn_reuse_mode=0\nnet.ipv4.vs.expire_nodest_conn=1\n```\n\n\n\n\n\n### å‡†å¤‡images list\n\n```\n./kubeadm config images list\nI0809 21:56:57.334915    4785 version.go:254] remote version is much newer: v1.24.3; falling back to: stable-1.21\nk8s.gcr.io/kube-apiserver:v1.21.14\nk8s.gcr.io/kube-controller-manager:v1.21.14\nk8s.gcr.io/kube-scheduler:v1.21.14\nk8s.gcr.io/kube-proxy:v1.21.14\nk8s.gcr.io/pause:3.4.1\nk8s.gcr.io/etcd:3.4.13-0\nk8s.gcr.io/coredns/coredns:v1.8.0\n```\n\n<!--more-->\n\n\n\n### ä¾èµ–conntrack\n\n![](/pics/k8s-not-ipvs-02.png)\n\n```\nyum -y install socat conntrack-tools\n```\n\n\n\n### inité…ç½®æ–‡ä»¶\n\n#### å‘½ä»¤ç”Ÿæˆé»˜è®¤æ–‡ä»¶\n\n```\nkubeadm config print init-defaults  > config.yaml\n```\n\n\n\n```\n#ç”ŸæˆKubeletConfigurationç¤ºä¾‹æ–‡ä»¶ \nkubeadm config print init-defaults --component-configs KubeletConfiguration\n\n#ç”ŸæˆKubeProxyConfigurationç¤ºä¾‹æ–‡ä»¶ \nkubeadm config print init-defaults --component-configs KubeProxyConfiguration\n```\n\n\n\n```\nansible k8s-108 -m copy -a \"src=/opt/kubernetes/client/k8s-1.21-11/bin/config.yaml dest=/opt/kubernetes  mode=0644\"   -b --become-method sudo --become-user root\n```\n\n\n\n\n\n#### config.yaml\n\n```yaml\napiVersion: kubeadm.k8s.io/v1beta2\nbootstrapTokens:\n- groups:\n  - system:bootstrappers:kubeadm:default-node-token\n  token: abcdef.0123456789abcdef\n  ttl: 24h0m0s\n  usages:\n  - signing\n  - authentication\nkind: InitConfiguration\nlocalAPIEndpoint:\n  advertiseAddress: 192.168.56.108 #ip\n  bindPort: 6443\nnodeRegistration:\n  criSocket: /var/run/dockershim.sock\n  name: k8s # hostname â€œxxxâ€ could not be reached\n  taints: null\n---\napiServer:\n  timeoutForControlPlane: 4m0s\napiVersion: kubeadm.k8s.io/v1beta2\ncertificatesDir: /etc/kubernetes/pki\nclusterName: kubernetes\ncontrollerManager: {}\ndns:\n  type: CoreDNS\netcd:\n  local:\n    dataDir: /var/lib/etcd\nimageRepository: k8s.org/k8s  # é•œåƒä»“åº“æº\nkind: ClusterConfiguration\nkubernetesVersion: 1.21.12  #ç‰ˆæœ¬\nnetworking:\n  dnsDomain: cluster.local\n  serviceSubnet: 10.96.0.0/12\nscheduler: {}\n---\napiVersion: kubelet.config.k8s.io/v1beta1\nkind: KubeletConfiguration\ncgroupDriver: systemd\nfailSwapOn: False\n---\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nkind: KubeProxyConfiguration\nipvs:\n  minSyncPeriod: 0s\n  scheduler: \"rr\"\n  syncPeriod: 30s\nmode: \"ipvs\"\n```\n\n\n\n#### kubectl\n\n![](/pics/k8s-get-pend-01.png)\n\ndocker: network plugin is not ready: cni config uninitialized\n\n[kubelet.serviceè¯¦è§£](/linux/k8s/kubelet#id-service)\n\n\n\n### åˆå§‹åŒ–è¿‡ç¨‹\n\n```shell\n[vagrant@k8s kubernetes]$ sudo ./bin/kubeadm   init --config config.yaml\nW0809 20:30:08.653353    3073 kubelet.go:215] detected \"cgroupfs\" as the Docker cgroup driver, the provided value \"systemd\" in \"KubeletConfiguration\" will be overrided\n[init] Using Kubernetes version: v1.21.12\n[preflight] Running pre-flight checks\n\t[WARNING IsDockerSystemdCheck]: detected \"cgroupfs\" as the Docker cgroup driver. The recommended driver is \"systemd\". Please follow the guide at https://kubernetes.io/docs/setup/cri/\n\t[WARNING Service-Kubelet]: kubelet service is not enabled, please run 'systemctl enable kubelet.service'\n[preflight] Pulling images required for setting up a Kubernetes cluster\n[preflight] This might take a minute or two, depending on the speed of your internet connection\n[preflight] You can also perform this action in beforehand using 'kubeadm config images pull'\n[certs] Using certificateDir folder \"/etc/kubernetes/pki\"\n[certs] Generating \"ca\" certificate and key\n[certs] Generating \"apiserver\" certificate and key\n[certs] apiserver serving cert is signed for DNS names [k8s kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 192.168.56.108]\n[certs] Generating \"apiserver-kubelet-client\" certificate and key\n[certs] Generating \"front-proxy-ca\" certificate and key\n[certs] Generating \"front-proxy-client\" certificate and key\n[certs] Generating \"etcd/ca\" certificate and key\n[certs] Generating \"etcd/server\" certificate and key\n[certs] etcd/server serving cert is signed for DNS names [k8s localhost] and IPs [192.168.56.108 127.0.0.1 ::1]\n[certs] Generating \"etcd/peer\" certificate and key\n[certs] etcd/peer serving cert is signed for DNS names [k8s localhost] and IPs [192.168.56.108 127.0.0.1 ::1]\n[certs] Generating \"etcd/healthcheck-client\" certificate and key\n[certs] Generating \"apiserver-etcd-client\" certificate and key\n[certs] Generating \"sa\" key and public key\n[kubeconfig] Using kubeconfig folder \"/etc/kubernetes\"\n[kubeconfig] Writing \"admin.conf\" kubeconfig file\n[kubeconfig] Writing \"kubelet.conf\" kubeconfig file\n[kubeconfig] Writing \"controller-manager.conf\" kubeconfig file\n[kubeconfig] Writing \"scheduler.conf\" kubeconfig file\n[kubelet-start] Writing kubelet environment file with flags to file \"/var/lib/kubelet/kubeadm-flags.env\"\n[kubelet-start] Writing kubelet configuration to file \"/var/lib/kubelet/config.yaml\"\n[kubelet-start] Starting the kubelet\n[control-plane] Using manifest folder \"/etc/kubernetes/manifests\"\n[control-plane] Creating static Pod manifest for \"kube-apiserver\"\n[control-plane] Creating static Pod manifest for \"kube-controller-manager\"\n[control-plane] Creating static Pod manifest for \"kube-scheduler\"\n[etcd] Creating static Pod manifest for local etcd in \"/etc/kubernetes/manifests\"\n[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory \"/etc/kubernetes/manifests\". This can take up to 4m0s\n[apiclient] All control plane components are healthy after 12.505234 seconds\n[upload-config] Storing the configuration used in ConfigMap \"kubeadm-config\" in the \"kube-system\" Namespace\n[kubelet] Creating a ConfigMap \"kubelet-config-1.21\" in namespace kube-system with the configuration for the kubelets in the cluster\n[upload-certs] Skipping phase. Please see --upload-certs\n[mark-control-plane] Marking the node k8s as control-plane by adding the labels: [node-role.kubernetes.io/master(deprecated) node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]\n[mark-control-plane] Marking the node k8s as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]\n[bootstrap-token] Using token: abcdef.0123456789abcdef\n[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles\n[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to get nodes\n[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials\n[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token\n[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster\n[bootstrap-token] Creating the \"cluster-info\" ConfigMap in the \"kube-public\" namespace\n[kubelet-finalize] Updating \"/etc/kubernetes/kubelet.conf\" to point to a rotatable kubelet client certificate and key\n[addons] Applied essential addon: CoreDNS\n[addons] Applied essential addon: kube-proxy\n\nYour Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\nAlternatively, if you are the root user, you can run:\n\n  export KUBECONFIG=/etc/kubernetes/admin.conf\n\nYou should now deploy a pod network to the cluster.\nRun \"kubectl apply -f [podnetwork].yaml\" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join 192.168.56.108:6443 --token abcdef.0123456789abcdef \\\n\t--discovery-token-ca-cert-hash sha256:01661c34149742e27fa96db2f1c4a8d4675d2f0b5133f8cd25a45e031eb23653 \n```\n\n\n\n### èŠ‚ç‚¹é…ç½®æ–‡ä»¶\n\n```\nkubeadm config print join-defaults > join-config.yaml\n```\n\n\n\n\n\n```\nkubectl create clusterrolebinding kubelet-bootstrap --clusterrole=system:node-bootstrapper --user=kubelet-bootstrap\n```\n\n>error: failed to run Kubelet: cannot create certificate signing request: certificatesigningrequests.certificates.k8s.io is forbidden: User \"kubelet-bootstrap\" cannot create certificatesigningrequests.certificates.k8s.io at the cluster scope\n>\n\n\n\n\n\n### ç½‘ç»œæ’ä»¶podnetwork\n\nhttps://kubernetes.io/docs/concepts/cluster-administration/addons/\n\n\n\n#### flanneld\n\n[æŸ¥çœ‹flanneld.yaml](/linux/k8s/flanneld)\n\n```shell\nansible k8s-108 -m copy -a \"src=/home/cs/oss/0s/k8s/kube/kube-flanneld.yml  dest=/opt/kubernetes  mode=0644\"   -b --become-method sudo --become-user root\n```\n\n\n\n```shell\n[vagrant@k8s kubernetes]$ kubectl apply -f kube-flanneld.yaml \nWarning: policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+\npodsecuritypolicy.policy/psp.flannel.unprivileged created\nWarning: rbac.authorization.k8s.io/v1beta1 ClusterRole is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRole\nclusterrole.rbac.authorization.k8s.io/flannel created\nWarning: rbac.authorization.k8s.io/v1beta1 ClusterRoleBinding is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRoleBinding\nclusterrolebinding.rbac.authorization.k8s.io/flannel created\nserviceaccount/flannel created\nconfigmap/kube-flannel-cfg created\ndaemonset.apps/kube-flannel-ds-amd64 created\n```\n\n\n\n#### calico\n\nhttps://docs.projectcalico.org/getting-started/kubernetes/self-managed-onprem/onpremises\n\ncalico.yaml https://docs.projectcalico.org/manifests/calico.yaml\n\n\n\n### kubectlæƒé™\n\n#### ~/.kube/config\n\n```\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n```\n\n\n\n\n\n### ç»„ä»¶çŠ¶æ€cs\n\n#### Unhealthy \n\n![](/pics/k8s-get-cs-01.png)\n\n\n\næ³¨é‡Š`port=0`è¡Œ\n\n```shell\n[vagrant@k8s kubernetes]$ sudo sed -i '/port=0/s/^/#/'  /etc/kubernetes/manifests/kube-controller-manager.yaml\n[vagrant@k8s kubernetes]$ sudo sed -i '/port=0/s/^/#/'  /etc/kubernetes/manifests/kube-scheduler.yaml\n```\n\n![](/pics/k8s-get-cs-02.png)\n\n\n\n### åŠ å…¥é›†ç¾¤\n\né›†ç¾¤åˆå§‹åŒ–æ—¶çš„æ·»åŠ å‘½ä»¤\n\n```\nkubeadm join 192.168.56.108:6443 --token abcdef.0123456789abcdef \\\n\t--discovery-token-ca-cert-hash sha256:01661c34149742e27fa96db2f1c4a8d4675d2f0b5133f8cd25a45e031eb23653\n```\n\nå‘½ä»¤æ–¹å¼è·å–joinå‚æ•°\n\n```\nkubeadm token create --print-join-command\n```\n\n\n\n\n\né‡æ–°ç”Ÿæˆcertificate-key,ç”Ÿæˆç”¨äºåŠ å…¥æ§åˆ¶å¹³é¢çš„secret\n\n```\nkubeadm init phase upload-certs --upload-certs\n```\n\n> Using certificate key:xxxx\n\n\n\n#### åŠ å…¥æ§åˆ¶èŠ‚ç‚¹\n\n```\nkubeadm join 192.168.56.108:6443 --token abcdef.0123456789abcdef \\\n\t--discovery-token-ca-cert-hash sha256:01661c34149742e27fa96db2f1c4a8d4675d2f0b5133f8cd25a45e031eb23653    --control-plane --certificate-key xxxx\n```\n\n\n\n\n\n\n\n### PendingçŠ¶æ€\n\n```\nkubectl logs kube-flannel-ds-amd64-7wjtn -n kube-system\n```\n\n> Error registering network: failed to acquire lease: node \"k8s\" pod cidr not assigned\n\n![](/pics/k8s-get-node-01.png)\n\nmasterèŠ‚ç‚¹ä¸€ç›´notready  å’Œ  coredns podä¸€ç›´pending\n\nå®‰è£…flannel\n\n![](/pics/k8s-get-node-02.png)\n\n\n\n### pod-network-cidr\n\n#### ä¿®æ”¹ \n\n--pod-network-cidr\n\n```\n1ï¼‰kubectl -n kube-system edit cm kubeadm-config\n2ï¼‰vim /etc/kubernetes/manifests/kube-scheduler.yaml\n```\n\n#### æ£€æŸ¥é…ç½®\n\n```\nkubectl cluster-info dump | grep -m 1 cluster-cidr\n```\n\n**kube-proxyçš„cluster-cidrä¸kuber-controller-managerçš„cluster-cidr**\n\n\n\n\n\n```objectivec\n kubectl scale deployment --replicas=0 dns-autoscaler -n kube-system\ndeployment.extensions/dns-autoscaler scaled\n# kubectl patch deployment coredns -p '{\"spec\":{\"replicas\":17}}' -n kube-system\ndeployment.extensions/coredns patched\n# kubectl get pod -n kube-system |grep coredns |wc -l\n```\n\n\n\n### é‡å¯\n\n```\nsystemctl status kubelet\nsudo systemctl start kubelet\n```\n\n> *é™æ€ Pod* åœ¨æŒ‡å®šçš„èŠ‚ç‚¹ä¸Šç”± kubelet å®ˆæŠ¤è¿›ç¨‹ç›´æ¥ç®¡ç†ï¼Œä¸éœ€è¦ [API æœåŠ¡å™¨](https://kubernetes.io/zh-cn/docs/reference/command-line-tools-reference/kube-apiserver/) ç›‘ç®¡,kubelet ç›‘è§†æ¯ä¸ªé™æ€ Podï¼ˆåœ¨å®ƒå´©æºƒä¹‹åé‡æ–°å¯åŠ¨ï¼‰\n>\n> â€“pod-manifest-path=\n\n#### å¸¸è§çš„ Static Pod\n\n- etcd\n- kube-apiserver\n- kube-controller-manager\n- kube-scheduler\n\n\n\n### å¸è½½\n\n```shell\nsudo kubeadm reset -f\nsudo rm -rf /var/lib/etcd /var/lib/kubelet /var/lib/dockershim /var/run/kubernetes /var/lib/cni /etc/kubernetes\n```\n\n\n\n\n\n### å¤šé›†ç¾¤\n\n#### å¤šä¸ªé…ç½®\n\nä¸€å°æœºå™¨ç®¡ç†å¤šä¸ªé›†ç¾¤\n\n```shell\ncs@debian:~$ ls -l ~/.kube/\næ€»ç”¨é‡ 36\ndrwxr-x--- 3 cs cs 4096 4æœˆ  20 14:37 cache\n-rw------- 1 cs cs 9852 8æœˆ  10 21:58 config\n-rw-r--r-- 1 cs cs 5597 8æœˆ  10 21:56 config1   #k8s å®¹å™¨éƒ¨ç½²\n-rw------- 1 cs cs 6201 8æœˆ   6 16:57 config2   #kubernetesäºŒè¿›åˆ¶éƒ¨ç½²\ndrwxr-x--- 3 cs cs 4096 8æœˆ  10 21:58 http-cache\n```\n\n#### åˆå¹¶é…ç½®\n\n```shell\n$ KUBECONFIG=/home/cs/.kube/config1:/home/cs/.kube/config2 kubectl config view --flatten >/home/cs/.kube/config\n```\n\n![](/pics/k8s-view-cluster.png)\n\n\n\n#### è·å–é›†ç¾¤é…ç½®\n\n```shell\ncs@debian:~$ kubectl config get-contexts\nCURRENT   NAME                   CLUSTER      AUTHINFO           NAMESPACE\n          admin@kubernetes       kubernetes   admin              \n*         kubernetes-admin@k8s   k8s          kubernetes-admin  \n```\n\n##### å®¹å™¨éƒ¨ç½²\n\n```\ncs@debian:~$ kubectl get cs\nNAME                 STATUS    MESSAGE             ERROR\nscheduler            Healthy   ok                  \ncontroller-manager   Healthy   ok                  \netcd-0               Healthy   {\"health\":\"true\"}   \ncs@debian:~$ kubectl get node\nNAME   STATUS   ROLES                  AGE     VERSION\nk8s    Ready    control-plane,master   4m57s   v1.21.11\n```\n\n\n\n\n\n#### æ¢é›†ç¾¤\n\nuse-context\n\n```shell\n#å½“å‰é›†ç¾¤\ncs@debian:~$ kubectl config current-context   \nkubernetes-admin@k8s\n\ncs@debian:~$ kubectl config use-context admin@kubernetes   \nSwitched to context \"admin@kubernetes\".\n```\n\n##### äºŒè¿›åˆ¶éƒ¨ç½²\n\n```shell\ncs@debian:~$ kubectl get cs\nNAME                 STATUS    MESSAGE              ERROR\nscheduler            Healthy   ok                   \ncontroller-manager   Healthy   ok                   \netcd-1               Healthy   {\"health\": \"true\"}   \netcd-0               Healthy   {\"health\": \"true\"}   \netcd-2               Healthy   {\"health\": \"true\"}   \ncs@debian:~$ kubectl get node\nNAME       STATUS     ROLES    AGE    VERSION\nmaster02   Ready      <none>   121d   v1.18.8\nmaster03   Ready      <none>   121d   v1.18.8\nnode04     Ready      <none>   121d   v1.18.8\nnode05     NotReady   <none>   121d   v1.18.8\nnode06     Ready      <none>   121d   v1.18.8\n```\n\n\n\n\n\n![](/pics/k8s-more-cluster.png)\n\n> current-context æ˜¾ç¤º current_context\n> delete-cluster  åˆ é™¤ kubeconfig æ–‡ä»¶ä¸­æŒ‡å®šçš„é›†ç¾¤\n> delete-context  åˆ é™¤ kubeconfig æ–‡ä»¶ä¸­æŒ‡å®šçš„ context\n> get-clusters    æ˜¾ç¤º kubeconfig æ–‡ä»¶ä¸­å®šä¹‰çš„é›†ç¾¤\n> get-contexts    æè¿°ä¸€ä¸ªæˆ–å¤šä¸ª contexts\n> rename-context  ä» kubeconfig æ–‡ä»¶é‡å‘½åä¸Šä¸‹æ–‡ã€‚\n> set             è®¾ç½® kubeconfig æ–‡ä»¶ä¸­çš„ä¸€ä¸ªå•ä¸ªå€¼\n> set-cluster     è®¾ç½® kubeconfig æ–‡ä»¶ä¸­çš„ä¸€ä¸ªé›†ç¾¤æ¡ç›®\n> set-context     è®¾ç½® kubeconfig æ–‡ä»¶ä¸­çš„ä¸€ä¸ª context æ¡ç›®\n> set-credentials è®¾ç½® kubeconfig æ–‡ä»¶ä¸­çš„ä¸€ä¸ªç”¨æˆ·æ¡ç›®\n> unset           å–æ¶ˆè®¾ç½® kubeconfig æ–‡ä»¶ä¸­çš„ä¸€ä¸ªå•ä¸ªå€¼\n> use-context     è®¾ç½® kubeconfig æ–‡ä»¶ä¸­çš„å½“å‰ä¸Šä¸‹æ–‡\n> view            æ˜¾ç¤ºåˆå¹¶çš„ kubeconfig é…ç½®æˆ–ä¸€ä¸ªæŒ‡å®šçš„ kubeconfig æ–‡ä»¶\n\n\n\n","tags":["kubeadm"],"categories":["linux","k8s"]},{"title":"flanneldè™šæ‹Ÿç½‘ç»œ","url":"/linux/k8s/flanneld/","content":"\n\n\ngithub https://github.com/flannel-io/flannel/tree/v0.16.1/Documentation\n\n\n\nflanneld.yaml \n\n```yaml\n---\napiVersion: policy/v1beta1\nkind: PodSecurityPolicy\nmetadata:\n  name: psp.flannel.unprivileged\n  annotations:\n    seccomp.security.alpha.kubernetes.io/allowedProfileNames: docker/default\n    seccomp.security.alpha.kubernetes.io/defaultProfileName: docker/default\n    apparmor.security.beta.kubernetes.io/allowedProfileNames: runtime/default\n    apparmor.security.beta.kubernetes.io/defaultProfileName: runtime/default\nspec:\n  privileged: false\n  volumes:\n  - configMap\n  - secret\n  - emptyDir\n  - hostPath\n  allowedHostPaths:\n  - pathPrefix: \"/etc/cni/net.d\"\n  - pathPrefix: \"/etc/kube-flannel\"\n  - pathPrefix: \"/run/flannel\"\n  readOnlyRootFilesystem: false\n  # Users and groups\n  runAsUser:\n    rule: RunAsAny\n  supplementalGroups:\n    rule: RunAsAny\n  fsGroup:\n    rule: RunAsAny\n  # Privilege Escalation\n  allowPrivilegeEscalation: false\n  defaultAllowPrivilegeEscalation: false\n  # Capabilities\n  allowedCapabilities: ['NET_ADMIN', 'NET_RAW']\n  defaultAddCapabilities: []\n  requiredDropCapabilities: []\n  # Host namespaces\n  hostPID: false\n  hostIPC: false\n  hostNetwork: true\n  hostPorts:\n  - min: 0\n    max: 65535\n  # SELinux\n  seLinux:\n    # SELinux is unused in CaaSP\n    rule: 'RunAsAny'\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: flannel\nrules:\n- apiGroups: ['extensions']\n  resources: ['podsecuritypolicies']\n  verbs: ['use']\n  resourceNames: ['psp.flannel.unprivileged']\n- apiGroups:\n  - \"\"\n  resources:\n  - pods\n  verbs:\n  - get\n- apiGroups:\n  - \"\"\n  resources:\n  - nodes\n  verbs:\n  - list\n  - watch\n- apiGroups:\n  - \"\"\n  resources:\n  - nodes/status\n  verbs:\n  - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"cniVersion\": \"0.3.1\",\n      \"plugins\": [\n        {\n          \"type\": \"flannel\",\n          \"delegate\": {\n            \"hairpinMode\": true,\n            \"isDefaultGateway\": true\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"capabilities\": {\n            \"portMappings\": true\n          }\n        }\n      ]\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"10.244.0.0/16\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n            - matchExpressions:\n              - key: kubernetes.io/os\n                operator: In\n                values:\n                - linux\n      hostNetwork: true\n      priorityClassName: system-node-critical\n      tolerations:\n      - operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni-plugin\n        image: k8s.org/k8s/flannel-cni-plugin:v1.0.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - /flannel\n        - /opt/cni/bin/flannel\n        volumeMounts:\n        - name: cni-plugin\n          mountPath: /opt/cni/bin\n      - name: install-cni\n        image: k8s.org/k8s/flannel:v0.15.1-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumeMounts:\n        - name: cni\n          mountPath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: k8s.org/k8s/flannel:v0.15.1-amd64\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        - --iface=eth1\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: false\n          capabilities:\n            add: [\"NET_ADMIN\", \"NET_RAW\"]\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: /run/flannel\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      volumes:\n      - name: run\n        hostPath:\n          path: /run/flannel\n      - name: cni-plugin\n        hostPath:\n          path: /opt/cni/bin\n      - name: cni\n        hostPath:\n          path: /etc/cni/net.d\n      - name: flannel-cfg\n        configMap:\n          name: kube-flannel-cfg\n```\n\n\n\n","tags":["flanneld"],"categories":["linux","k8s"]},{"title":"kuberneteséƒ¨ç½²ç»“æ„","url":"/linux/k8s/k8s/","content":"\n## go env\n\nç¼–è¯‘äºŒè¿›åˆ¶\n\nYou have a working [Go environment](https://golang.org/doc/install).\n\n```shell\nGOPATH=`go env | grep GOPATH | cut -d '\"' -f 2 `\nmkdir -p $GOPATH/src/k8s.io\ncd $GOPATH/src/k8s.io\ngit clone https://github.com/kubernetes/kubernetes\ncd kubernetes\ngit checkout v1.21.12\nmake\n```\n\n\n\n## å‰ç½®æ¡ä»¶é…ç½®\n\n- ä¸€å°å…¼å®¹çš„ Linux ä¸»æœºã€‚Kubernetes é¡¹ç›®ä¸ºåŸºäº Debian å’Œ Red Hat çš„ Linux å‘è¡Œç‰ˆä»¥åŠä¸€äº›ä¸æä¾›åŒ…ç®¡ç†å™¨çš„å‘è¡Œç‰ˆæä¾›é€šç”¨çš„æŒ‡ä»¤\n- æ¯å°æœºå™¨ `2 GB` æˆ–æ›´å¤šçš„ RAM ï¼ˆå¦‚æœå°‘äºè¿™ä¸ªæ•°å­—å°†ä¼šå½±å“ä½ åº”ç”¨çš„è¿è¡Œå†…å­˜ï¼‰\n- `2 CPU` æ ¸æˆ–æ›´å¤š\n- é›†ç¾¤ä¸­çš„æ‰€æœ‰æœºå™¨çš„ç½‘ç»œå½¼æ­¤å‡èƒ½ç›¸äº’è¿æ¥(å…¬ç½‘å’Œå†…ç½‘éƒ½å¯ä»¥)\n- èŠ‚ç‚¹ä¹‹ä¸­ä¸å¯ä»¥æœ‰é‡å¤çš„ä¸»æœºåã€MAC åœ°å€æˆ– product_uuidã€‚è¯·å‚è§[è¿™é‡Œ](https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#verify-mac-address)äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚\n- å¼€å¯æœºå™¨ä¸Šçš„æŸäº›ç«¯å£ã€‚è¯·å‚è§[è¿™é‡Œ](https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#check-required-ports) äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚\n- ç¦ç”¨äº¤æ¢åˆ†åŒºã€‚ä¸ºäº†ä¿è¯ kubelet æ­£å¸¸å·¥ä½œï¼Œä½  **å¿…é¡»** ç¦ç”¨äº¤æ¢åˆ†åŒº\n\næ›´å¤šè§ https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/\n\n\n\n## 2ç§ HA é›†ç¾¤æ–¹å¼\n\næ–‡æ¡£ https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/ha-topology/\n\n### å †å ï¼ˆStackedï¼‰etcd \n\nè¿™ç§æ‹“æ‰‘å°†æ§åˆ¶å¹³é¢å’Œ etcd æˆå‘˜è€¦åˆåœ¨åŒä¸€èŠ‚ç‚¹ä¸Š,è®¾ç½®ç®€å•.å­˜åœ¨è€¦åˆå¤±è´¥çš„é£é™©\n\n![](/pics/etcd-stacked.png)\n\n\n\n<!--more-->\n\n### å¤–éƒ¨ etcd èŠ‚ç‚¹\n\nè¿™ç§æ‹“æ‰‘ç»“æ„è§£è€¦äº†æ§åˆ¶å¹³é¢å’Œ etcd æˆå‘˜.éœ€è¦ä¸¤å€äºå †å  HA æ‹“æ‰‘çš„ä¸»æœºæ•°é‡\n\n![](/pics/etcd-external.png)\n","tags":["kubernetes"],"categories":["linux","k8s"]},{"title":"iptableé˜²ç«å¢™","url":"/linux/shell/iptable/","content":"\n\n\n\n\n\n\n\n\n### æ•°æ®æµå‘\n\n![](/pics/iptable-01.png)\n\n\n\n-  å½“ä¸€ä¸ªæ•°æ®åŒ…è¿›å…¥ç½‘å¡æ—¶ï¼Œå®ƒé¦–å…ˆè¿›å…¥PREROUTINGé“¾ï¼Œå†…æ ¸æ ¹æ®æ•°æ®åŒ…ç›®çš„IPåˆ¤æ–­æ˜¯å¦éœ€è¦è½¬é€å‡ºå»ã€‚ \n- å¦‚æœæ•°æ®åŒ…å°±æ˜¯**`è¿›å…¥æœ¬æœº`**çš„ï¼Œå®ƒå°±ä¼šåˆ°è¾¾INPUTé“¾ã€‚æ•°æ®åŒ…åˆ°äº†**`INPUTé“¾`**åï¼Œä»»ä½•è¿›ç¨‹éƒ½ä¼šæ”¶åˆ°å®ƒã€‚æœ¬æœºä¸Šè¿è¡Œçš„ç¨‹åºå¯ä»¥å‘é€æ•°æ®åŒ…ï¼Œè¿™äº›æ•°æ®åŒ…ä¼šç»è¿‡OUTPUTé“¾ï¼Œç„¶ååˆ°è¾¾POSTROUTINGé“¾è¾“å‡ºã€‚ \n- å¦‚æœæ•°æ®åŒ…æ˜¯è¦**`è½¬å‘å‡ºå»`**çš„ï¼Œä¸”å†…æ ¸å…è®¸è½¬å‘ï¼Œæ•°æ®åŒ…å°±ä¼šå¦‚å›¾æ‰€ç¤ºå‘å³ç§»åŠ¨ï¼Œç»è¿‡**`FORWARDé“¾`**ï¼Œç„¶ååˆ°è¾¾POSTROUTINGé“¾è¾“å‡ºã€‚\n  \n\n![](/pics/iptable-01-1.png)\n\n\n\n```shell\n#ä¸´æ—¶ç”Ÿæ•ˆ\necho 1 > /proc/sys/net/ipv4/ip_forward\n#æ°¸ä¹…ç”Ÿæ•ˆ\ncs@debian:~/oss/hexo$ cat /etc/sysctl.conf | grep net.ipv4.ip_\nnet.ipv4.ip_forward=1\n```\n\n<!--more-->\n\n![](/pics/iptable-01-2.png)\n\n\n\n\n\n### å‘½ä»¤è§„åˆ™\n\n![](/pics/iptable-02.png)\n\n- æ‰€æœ‰è¡¨åå¿…é¡»å°å†™\n\n  filter/nat/mangle\n\n- æ‰€æœ‰é“¾åå¿…é¡»å¤§å†™\n   INPUT/OUTPUT/FORWARD/PREROUTING/POSTROUTING\n\n| åç§°        | åŠŸèƒ½                                                         | ä½œç”¨çš„è¡¨                                                     |\n| ----------- | ------------------------------------------------------------ | ------------------------------------------------------------ |\n| PREROUTING  | ä¸»æœºå¤–æŠ¥æ–‡è¿›å…¥ä½ç½®                                           | mangle, natï¼ˆç›®æ ‡åœ°å€è½¬æ¢ï¼Œï¼Œé€šå¸¸æŒ‡å“åº”æŠ¥æ–‡ï¼‰                |\n| INPUT       | æŠ¥æ–‡è¿›å…¥æœ¬æœºç”¨æˆ·ç©ºé—´ä½ç½®                                     | filter, mangle                                               |\n| OUTPUT      | æŠ¥æ–‡ä»æœ¬æœºç”¨æˆ·ç©ºé—´å‡ºå»çš„ä½ç½®                                 | filter, mangle, nat                                          |\n| FOWARD      | æŠ¥æ–‡ç»è¿‡è·¯ç”±å¹¶ä¸”å‘è§‰ä¸æ˜¯æœ¬æœºå†³å®šè½¬å‘ä½†è¿˜ä¸çŸ¥é“ä»å“ªä¸ªç½‘å¡å‡ºå» | filter, mangleï¼ˆä¸­è½¬ï¼‰                                       |\n| POSTROUTING | æŠ¥æ–‡ç»è¿‡è·¯ç”±è¢«è½¬å‘å‡ºå»                                       | è®¸mangleï¼Œnatï¼ˆæºåœ°å€è½¬æ¢ï¼ŒæŠŠåŸå§‹åœ°å€è½¬æ¢ä¸ºè½¬å‘ä¸»æœºå‡ºå£ç½‘å¡åœ°å€ï¼‰ |\n\n \n\n- æ‰€æœ‰åŒ¹é…å¿…é¡»å°å†™\n   -s/-d/-m <module_name>/-p\n\n- æ‰€æœ‰åŠ¨ä½œå¿…é¡»å¤§å†™\n   ACCEPT/DROP/SNAT/DNAT/MASQUERADE\n\n\n\n","tags":["iptable"],"categories":["linux","shell"]},{"title":"grepå¸¸ç”¨è¿‡æ»¤","url":"/linux/shell/grep/","content":"\n\n\n### å‰åè¡Œ A B C\n\ngrep -A æ˜¾ç¤ºåŒ¹é…æŒ‡å®šå†…å®¹åŠä¹‹åçš„nè¡Œ\n\ngrep -B æ˜¾ç¤ºåŒ¹é…æŒ‡å®šå†…å®¹åŠä¹‹å‰çš„nè¡Œ\n\ngrep -C  æ˜¾ç¤ºåŒ¹é…æŒ‡å®šå†…å®¹åŠå…¶å‰åå„nè¡Œ\n\n```shell\ncs@debian:~/oss/hexo$ cat /opt/nginx/logs/k8s-access.log | grep -C 5 \"2022:15:43:27\"\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:22 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:23 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:24 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:25 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:26 +0800] 502 0\n127.0.0.1 - 192.168.56.103:6443, 192.168.56.101:6443, 192.168.56.102:6443 - [31/Jul/2022:15:43:27 +0800] 502 0, 0, 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:28 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:29 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:30 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:30 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:31 +0800] 502 0\n```\n\n\n\n### ä¸æ“ä½œ  \n\nå¤šæ¬¡åŒ¹é…\n\n```shell\ncs@debian:~/oss/hexo$ cat /opt/nginx/logs/k8s-access.log | grep \"2022:15:43:2\" | grep 502\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:20 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:21 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:21 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:22 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:23 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:24 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:25 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:26 +0800] 502 0\n127.0.0.1 - 192.168.56.103:6443, 192.168.56.101:6443, 192.168.56.102:6443 - [31/Jul/2022:15:43:27 +0800] 502 0, 0, 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:28 +0800] 502 0\n127.0.0.1 - k8s-apiserver - [31/Jul/2022:15:43:29 +0800] 502 0\n```\n\n\n\n### æˆ–æ“ä½œ |\n\n<!--more-->\n\n```shell\ncs@debian:~/oss/hexo$ cat /opt/nginx/logs/k8s-access.log | grep \"502\\|15:43:3\\|kube-apiserver\"\n\n```\n\n>grep  -E  \"502|15:43:3|kube-apiserver\"\n>\n>egrep   \"502|15:43:3|kube-apiserver\"\n>\n>awk  \"502|15:43:3|kube-apiserver\"   file\n\n\n\n\n\n### ç‰¹æ®Šå­—ç¬¦ fgrep\n\næœç´¢æ–‡ä»¶åŒ…å«æ­£åˆ™è¡¨è¾¾å¼å…ƒå­—ç¬¦ä¸²æ—¶,ä¾‹å¦‚`$`ã€`^`ã€`/`ç­‰ï¼Œ`fgrep`å¾ˆæœ‰ç”¨\n\n```shell\ncs@debian:~/oss/hexo$ egrep \"^Hello\"  12\ncs@debian:~/oss/hexo$ grep \"^Hello\"  12\ncs@debian:~/oss/hexo$ fgrep \"^Hello\"  12\n^Hello\\\n```\n\nå®ƒ`ä¸è§£ææ­£åˆ™è¡¨è¾¾å¼`ã€æƒ³æœä»€ä¹ˆå°±è·Ÿä»€ä¹ˆ\n\n\n\n### å‹ç¼©æ–‡ä»¶  zgrep\n\n```shell\nzgrep  pattern1  ./*   |  grep  pattern2\n```\n\n>zegrep  \n>\n>\n>zcat file1.gz file2.gz\n","tags":["grep"],"categories":["linux","shell"]},{"title":"treeå·¥å…·","url":"/linux/shell/tree/","content":"\n\n\n\n\n### ç›®å½•å±‚çº§ -Ld\n\n-d ç›®å½•\n\n-L  level å±‚çº§\n\n\n\n```\ncs@debian:/$ tree -Ld  1\n.\nâ”œâ”€â”€ bin\nâ”œâ”€â”€ boot\nâ”œâ”€â”€ dev\nâ”œâ”€â”€ etc\nâ”œâ”€â”€ home\nâ”œâ”€â”€ lib\nâ”œâ”€â”€ lib64\nâ”œâ”€â”€ lost+found\nâ”œâ”€â”€ media\nâ”œâ”€â”€ mnt\nâ”œâ”€â”€ opt\nâ”œâ”€â”€ proc\nâ”œâ”€â”€ root\nâ”œâ”€â”€ run\nâ”œâ”€â”€ sbin\nâ”œâ”€â”€ snap\nâ”œâ”€â”€ srv\nâ”œâ”€â”€ sys\nâ”œâ”€â”€ tmp\nâ”œâ”€â”€ usr\nâ””â”€â”€ var\n```\n\n\n\n### è·¯å¾„å‰ç¼€ -f\n\n-f   æ‰“å°è·¯å¾„çš„å‰ç¼€(æ ¹æ®å‘½ä»¤æŒ‡å®šæ˜¾ç¤º)\n\n```\ncs@debian:/opt/apache$ tree -Ldf  1 ./\n.\nâ”œâ”€â”€ ./apache-maven-3.8.6\nâ”œâ”€â”€ ./kafka-2.1.1\nâ”œâ”€â”€ ./maven-3.6.0\nâ”œâ”€â”€ ./tomcat-8.5.38\nâ””â”€â”€ ./zookeeper-3.4.13\n\n5 directories\ncs@debian:/opt/apache$ tree -Ldf  1 /opt/apache/\n/opt/apache\nâ”œâ”€â”€ /opt/apache/apache-maven-3.8.6\nâ”œâ”€â”€ /opt/apache/kafka-2.1.1\nâ”œâ”€â”€ /opt/apache/maven-3.6.0\nâ”œâ”€â”€ /opt/apache/tomcat-8.5.38\nâ””â”€â”€ /opt/apache/zookeeper-3.4.13\n\n5 directories\n```\n\n\n\n<!--more-->\n\n\n\n### è¿‡æ»¤ -I\n\n\n\n```\ncs@debian:~/oss/0s$ tree -L 3  -I \"src|target\" ./spring-boot/cs-framework/  ./spring-boot/cs-framework/\nâ”œâ”€â”€ cs-msc\nâ”‚Â Â  â”œâ”€â”€ lib\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ json-jena-1.0.jar\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ Msc.jar\nâ”‚Â Â  â”œâ”€â”€ msc\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ libmsc32.so\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ libmsc64.so\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ msc32.dll\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ msc64.dll\nâ”‚Â Â  â”œâ”€â”€ pom.xml\nâ”‚Â Â  â””â”€â”€ READER.md\nâ”œâ”€â”€ cs-ocr\nâ”‚Â Â  â”œâ”€â”€ libs\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ ocr_sdk-1.3.6.jar\nâ”‚Â Â  â””â”€â”€ pom.xml\nâ””â”€â”€ pom.xml\n\n5 directories, 11 files\n```\n\n\n\n```\ncs@debian:~/oss/0s$ tree -L 3  -I *.jar* ./spring-boot/cs-framework/  \n./spring-boot/cs-framework/\nâ”œâ”€â”€ cs-msc\nâ”‚Â Â  â”œâ”€â”€ lib\nâ”‚Â Â  â”œâ”€â”€ msc\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ libmsc32.so\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ libmsc64.so\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ msc32.dll\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ msc64.dll\nâ”‚Â Â  â”œâ”€â”€ pom.xml\nâ”‚Â Â  â”œâ”€â”€ READER.md\nâ”‚Â Â  â”œâ”€â”€ src\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ main\nâ”‚Â Â  â””â”€â”€ target\nâ”‚Â Â      â”œâ”€â”€ classes\nâ”‚Â Â      â”œâ”€â”€ generated-sources\nâ”‚Â Â      â”œâ”€â”€ maven-archiver\nâ”‚Â Â      â””â”€â”€ maven-status\nâ”œâ”€â”€ cs-ocr\nâ”‚Â Â  â”œâ”€â”€ libs\nâ”‚Â Â  â”œâ”€â”€ pom.xml\nâ”‚Â Â  â”œâ”€â”€ src\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ main\nâ”‚Â Â  â””â”€â”€ target\nâ”‚Â Â      â”œâ”€â”€ classes\nâ”‚Â Â      â”œâ”€â”€ generated-sources\nâ”‚Â Â      â”œâ”€â”€ maven-archiver\nâ”‚Â Â      â””â”€â”€ maven-status\nâ””â”€â”€ pom.xml\n\n19 directories, 8 files\n```\n\n\n\n\n\n### åŒ¹é… -P\n\n```\ncs@debian:~/oss/0s$ tree -L 3 -P *xml -I \"src|target\" ./spring-boot/cs-framework/  \n./spring-boot/cs-framework/\nâ”œâ”€â”€ cs-msc\nâ”‚Â Â  â”œâ”€â”€ lib\nâ”‚Â Â  â”œâ”€â”€ msc\nâ”‚Â Â  â””â”€â”€ pom.xml\nâ”œâ”€â”€ cs-ocr\nâ”‚Â Â  â”œâ”€â”€ libs\nâ”‚Â Â  â””â”€â”€ pom.xml\nâ””â”€â”€ pom.xml\n\n5 directories, 3 files\n```\n\n\n\n### å¤§å°æ—¶é—´ -ts\n\n-t æ—¶é—´æ’åº(é»˜è®¤ä»æ—§åˆ°æ–°,rååº)\n\n-s å¤§å°\n\n```\ncs@debian:/opt/apache$ tree -Ldrts  1 /opt/apache/\n/opt/apache/\nâ”œâ”€â”€ [       4096]  apache-maven-3.8.6\nâ”œâ”€â”€ [       4096]  tomcat-8.5.38\nâ”œâ”€â”€ [       4096]  maven-3.6.0\nâ”œâ”€â”€ [       4096]  kafka-2.1.1\nâ””â”€â”€ [       4096]  zookeeper-3.4.13\n\n5 directories\n```\n\n\n\n### æƒé™è§’è‰² -pus\n\n-p æƒé™\n\n-u  è§’è‰²\n\n-g ç»„\n\n```\ncs@debian:/opt/apache$ tree -Ldpu  1 /opt/apache/\n/opt/apache/\nâ”œâ”€â”€ [drwxr-xr-x cs      ]  apache-maven-3.8.6\nâ”œâ”€â”€ [drwxr-xr-x cs      ]  kafka-2.1.1\nâ”œâ”€â”€ [drwxr-xr-x cs      ]  maven-3.6.0\nâ”œâ”€â”€ [drwxr-xr-x cs      ]  tomcat-8.5.38\nâ””â”€â”€ [drwxr-xr-x cs      ]  zookeeper-3.4.13\n\n5 directories\n\n```\n\n\n\n\n\n\n\n### ç€è‰² -C\n\n-n å…³é—­\n\n-C æ‰“å¼€\n\n```shell\ncs@debian:/opt/apache$ tree -LdC  1 /opt/apache/\n/opt/apache/\nâ”œâ”€â”€ [       4096]  apache-maven-3.8.6\nâ”œâ”€â”€ [       4096]  tomcat-8.5.38\nâ”œâ”€â”€ [       4096]  maven-3.6.0\nâ”œâ”€â”€ [       4096]  kafka-2.1.1\nâ””â”€â”€ [       4096]  zookeeper-3.4.13\n\n5 directories\n\n```\n\n\n\n\n\n### æ ¼å¼  -j\n\n -i ä¸æ‰“å°è™šçº¿\n\n-X xmlæ ¼å¼ \n\n-J   jsonæ ¼å¼\n\n```\ncs@debian:/opt/apache$ tree -Ldrtsi  1 /opt/apache/\n/opt/apache/\n[       4096]  apache-maven-3.8.6\n[       4096]  tomcat-8.5.38\n[       4096]  maven-3.6.0\n[       4096]  kafka-2.1.1\n[       4096]  zookeeper-3.4.13\n\n5 directories\ncs@debian:/opt/apache$ tree -LdrtsX  1 /opt/apache/\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<tree>\n  <directory name=\"/opt/apache/\">\n    <directory name=\"apache-maven-3.8.6\" size=\"4096\">\n    </directory>\n    <directory name=\"tomcat-8.5.38\" size=\"4096\">\n    </directory>\n    <directory name=\"maven-3.6.0\" size=\"4096\">\n    </directory>\n    <directory name=\"kafka-2.1.1\" size=\"4096\">\n    </directory>\n    <directory name=\"zookeeper-3.4.13\" size=\"4096\">\n    </directory>\n  </directory>\n  <report>\n    <directories>5</directories>\n  </report>\n</tree>\ncs@debian:/opt/apache$ tree -LdrtsJ  1 /opt/apache/\n[\n  {\"type\":\"directory\",\"name\":\"/opt/apache/\",\"contents\":[\n    {\"type\":\"directory\",\"name\":\"apache-maven-3.8.6\",\"size\":4096,\"contents\":[\n    ]},\n    {\"type\":\"directory\",\"name\":\"tomcat-8.5.38\",\"size\":4096,\"contents\":[\n    ]},\n    {\"type\":\"directory\",\"name\":\"maven-3.6.0\",\"size\":4096,\"contents\":[\n    ]},\n    {\"type\":\"directory\",\"name\":\"kafka-2.1.1\",\"size\":4096,\"contents\":[\n    ]},\n    {\"type\":\"directory\",\"name\":\"zookeeper-3.4.13\",\"size\":4096,\"contents\":[\n    ]}\n  ]},\n  {\"type\":\"report\",\"directories\":5}\n]\n```\n\n\n\n","tags":["tree"],"categories":["linux","shell"]},{"title":"mavenä»‹ç»","url":"/tool/maven/","content":"\n\n\n\n\n\n\n## å®‰è£…\n\n### ç¯å¢ƒå˜é‡\n\n```\ncs@debian:~/oss/hexo$ wget https://dlcdn.apache.org/maven/maven-3/3.8.6/binaries/apache-maven-3.8.6-bin.tar.gz -O apache-maven-3.8.6-bin.tar.gz\ncs@debian:~/oss/hexo$ tar -zxvf apache-maven-3.8.6-bin.tar.gz -C /opt/apache\ncs@debian:~/oss/hexo$ cat >>  ~/.bashrc <<EOF\n#maven\nif [ -d \"/opt/apache/maven-3.8.6\" ] ; then\n    export MAVEN_HOME=/opt/apache/maven-3.8.6\n    export PATH=${MAVEN_HOME}/bin:\\$PATH\nfi\nEOF\n```\n\n### ç‰ˆæœ¬\n\n```\ncs@debian:~/oss/hexo$ mvn -version\n```\n\n> Apache Maven 3.8.6 (84538c9988a25aec085021c365c560670ad80f63)\n> Maven home: /opt/apache/apache-maven-3.8.6\n> Java version: 11.0.12, vendor: Oracle Corporation, runtime: /opt/jdk/jdk-11.0.12\n> Default locale: zh_CN, platform encoding: UTF-8\n> OS name: \"linux\", version: \"4.9.0-8-amd64\", arch: \"amd64\", family: \"unix\"\n\n\n\n##  åŸºæœ¬å‘½ä»¤\n\n### ç¼–è¯‘\n\n```\nmvn compileã€€\n```\n\n  --src/main/javaç›®å½•javaæºç ç¼–è¯‘ç”Ÿæˆclass ï¼ˆtargetç›®å½•ä¸‹ï¼‰\n\nã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€\n\n### æµ‹è¯•\n\n```\nmvn testã€€\n```\n\n   --src/test/java ç›®å½•ç¼–è¯‘\n\nã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€\n\n### æ¸…ç†\n\n```\nmvn clean\n```\n\n  --åˆ é™¤targetç›®å½•ï¼Œä¹Ÿå°±æ˜¯å°†classæ–‡ä»¶ç­‰åˆ é™¤\n\nã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€\n\n### æ‰“åŒ…\n\n```\nmvn packageã€€\n```\n\n --ç”Ÿæˆå‹ç¼©æ–‡ä»¶ï¼šjavaé¡¹ç›®#jaråŒ…ï¼›webé¡¹ç›®#waråŒ…ï¼Œä¹Ÿæ˜¯æ”¾åœ¨targetç›®å½•ä¸‹\n\nã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€\n\n### å®‰è£…\n\n```\nmvn installã€€ã€€\n```\n\n--å°†å‹ç¼©æ–‡ä»¶(jaræˆ–è€…war)ä¸Šä¼ åˆ°æœ¬åœ°ä»“åº“\n\nã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€\n\n### éƒ¨ç½²|å‘å¸ƒ\n\n```\nmvn deployã€€ã€€\n```\n\n--å°†å‹ç¼©æ–‡ä»¶ä¸Šä¼ ç§æœ\n\n\n\n### [å¤šæ¨¡å—](#idmore)\n\n\n\n\n\nåœºæ™¯:å‡ ç™¾ä¸ªå¾®æœåŠ¡åªæ‰“éƒ¨åˆ†åŒ…\n\n\n\n<!--more-->\n\n\n\n### å‘¨æœŸ\n\n| **éªŒè¯ï¼ˆvalidateï¼‰**                        | éªŒè¯é¡¹ç›®æ˜¯æ­£ç¡®çš„ï¼Œæ‰€æœ‰å¿…è¦çš„ä¿¡æ¯å¯ç”¨ã€‚                       |\n| ------------------------------------------- | ------------------------------------------------------------ |\n| **åˆå§‹åŒ–ï¼ˆinitializeï¼‰**                    | åˆå§‹åŒ–æ„å»ºçŠ¶æ€ï¼Œä¾‹å¦‚è®¾ç½®å±æ€§æˆ–åˆ›å»ºç›®å½•ã€‚                     |\n| **äº§ç”Ÿæ¥æºï¼ˆgenerate-sourcesï¼‰**            | ç”ŸæˆåŒ…å«åœ¨ç¼–è¯‘ä¸­çš„ä»»ä½•æºä»£ç ã€‚                               |\n| **æµç¨‹æºï¼ˆprocess-sourcesï¼‰**               | å¤„ç†æºä»£ç ï¼Œä¾‹å¦‚è¿‡æ»¤ä»»ä½•å€¼ã€‚                                 |\n| **ç”Ÿæˆèµ„æºï¼ˆgenerate-resourcesï¼‰**          | ç”ŸæˆåŒ…å«åœ¨åŒ…ä¸­çš„èµ„æºã€‚                                       |\n| **æµç¨‹èµ„æºï¼ˆprocess-resourcesï¼‰**           | å°†èµ„æºå¤åˆ¶å¹¶å¤„ç†åˆ°ç›®æ ‡ç›®å½•ä¸­ï¼Œå‡†å¤‡æ‰“åŒ…ã€‚                     |\n| **ç¼–è¯‘ï¼ˆcompileï¼‰**                         | ç¼–è¯‘é¡¹ç›®çš„æºä»£ç ã€‚                                           |\n| **å·¥è‰ºç±»ï¼ˆprocess-classesï¼‰**               | ä»ç¼–è¯‘åå¤„ç†ç”Ÿæˆçš„æ–‡ä»¶ï¼Œä¾‹å¦‚å¯¹Javaç±»è¿›è¡Œå­—èŠ‚ç å¢å¼ºã€‚         |\n| **ç”Ÿæˆæµ‹è¯•æ¥æºï¼ˆgenerate-test-sourcesï¼‰**   | ç”ŸæˆåŒ…å«åœ¨ç¼–è¯‘ä¸­çš„ä»»ä½•æµ‹è¯•æºä»£ç ã€‚                           |\n| **æµç¨‹æµ‹è¯•æ¥æºï¼ˆprocess-test-sourcesï¼‰**    | å¤„ç†æµ‹è¯•æºä»£ç ï¼Œä¾‹å¦‚è¿‡æ»¤ä»»ä½•å€¼ã€‚                             |\n| **ç”Ÿæˆæµ‹è¯•èµ„æºï¼ˆgenerate-test-resourcesï¼‰** | åˆ›å»ºæµ‹è¯•èµ„æºã€‚                                               |\n| **æµç¨‹æµ‹è¯•èµ„æºï¼ˆprocess-test-resourcesï¼‰**  | å°†èµ„æºå¤åˆ¶å¹¶å¤„ç†åˆ°æµ‹è¯•ç›®æ ‡ç›®å½•ä¸­ã€‚                           |\n| **æµ‹è¯•ç¼–è¯‘ï¼ˆtest-compileï¼‰**                | å°†æµ‹è¯•æºä»£ç ç¼–è¯‘åˆ°æµ‹è¯•ç›®æ ‡ç›®å½•ä¸­                             |\n| **æµç¨‹æ£€éªŒç±»ï¼ˆprocess-test-classesï¼‰**      | ä»æµ‹è¯•ç¼–è¯‘ä¸­å¤„ç†ç”Ÿæˆçš„æ–‡ä»¶ï¼Œä¾‹å¦‚å¯¹Javaç±»è¿›è¡Œå­—èŠ‚ç å¢å¼ºã€‚å¯¹äºMaven 2.0.5åŠä»¥ä¸Šç‰ˆæœ¬ã€‚ |\n| **æµ‹è¯•ï¼ˆtestï¼‰**                            | ä½¿ç”¨åˆé€‚çš„å•å…ƒæµ‹è¯•æ¡†æ¶è¿è¡Œæµ‹è¯•ã€‚è¿™äº›æµ‹è¯•ä¸åº”è¯¥è¦æ±‚ä»£ç è¢«æ‰“åŒ…æˆ–éƒ¨ç½²ã€‚ |\n| **åˆ¶å¤‡åŒ…ï¼ˆprepare-packageï¼‰**               | åœ¨å®é™…åŒ…è£…ä¹‹å‰ï¼Œæ‰§è¡Œå¿…è¦çš„å‡†å¤‡åŒ…è£…çš„æ“ä½œã€‚è¿™é€šå¸¸ä¼šå¯¼è‡´æ‰“åŒ…çš„å¤„ç†ç‰ˆæœ¬çš„åŒ…ã€‚ï¼ˆMaven 2.1åŠä»¥ä¸Šï¼‰ |\n| **æ‰“åŒ…ï¼ˆpackageï¼‰**                         | é‡‡å–ç¼–è¯‘çš„ä»£ç ï¼Œå¹¶ä»¥å…¶å¯åˆ†å‘çš„æ ¼å¼ï¼ˆå¦‚JARï¼‰è¿›è¡Œæ‰“åŒ…ã€‚        |\n| **é¢„é›†æˆæµ‹è¯•ï¼ˆpre-integration-testï¼‰**      | åœ¨æ‰§è¡Œé›†æˆæµ‹è¯•ä¹‹å‰æ‰§è¡Œæ‰€éœ€çš„æ“ä½œã€‚è¿™å¯èƒ½æ¶‰åŠè¯¸å¦‚è®¾ç½®æ‰€éœ€ç¯å¢ƒç­‰ã€‚ |\n| **é›†æˆæµ‹è¯•ï¼ˆintegration-testï¼‰**            | å¦‚æœéœ€è¦ï¼Œå¯ä»¥å°†è¯¥åŒ…è¿‡ç¨‹å¹¶éƒ¨ç½²åˆ°å¯ä»¥è¿è¡Œé›†æˆæµ‹è¯•çš„ç¯å¢ƒä¸­ã€‚   |\n| **æ•´åˆåçš„æµ‹è¯•ï¼ˆpost-integration-testï¼‰**   | æ‰§è¡Œé›†æˆæµ‹è¯•åæ‰§è¡Œæ‰€éœ€çš„æ“ä½œã€‚è¿™å¯èƒ½åŒ…æ‹¬æ¸…ç†ç¯å¢ƒã€‚           |\n| **æ ¡éªŒï¼ˆverifyï¼‰**                          | è¿è¡Œä»»ä½•æ£€æŸ¥ä»¥éªŒè¯åŒ…è£…æ˜¯å¦æœ‰æ•ˆå¹¶ç¬¦åˆè´¨é‡æ ‡å‡†ã€‚               |\n| **å®‰è£…ï¼ˆinstallï¼‰**                         | å°†è½¯ä»¶åŒ…å®‰è£…åˆ°æœ¬åœ°å­˜å‚¨åº“ä¸­ï¼Œä»¥ä½œä¸ºæœ¬åœ°å…¶ä»–é¡¹ç›®çš„ä¾èµ–å…³ç³»ã€‚   |\n| **éƒ¨ç½²ï¼ˆdeployï¼‰**                          | åœ¨é›†æˆæˆ–å‘å¸ƒç¯å¢ƒä¸­å®Œæˆï¼Œå°†æœ€ç»ˆè½¯ä»¶åŒ…å¤åˆ¶åˆ°è¿œç¨‹å­˜å‚¨åº“ï¼Œä»¥ä¸å…¶ä»–å¼€å‘äººå‘˜å’Œé¡¹ç›®å…±äº«ã€‚ |\n\n\n\n## é«˜çº§å‘½ä»¤\n\nåœ¨<a id=\"idmore\">å¤šæ¨¡å—</a>Mavené¡¹ç›®ä¸­ï¼Œååº”å †ï¼ˆReactorï¼‰æ˜¯ä¸€ä¸ªåŒ…å«äº†æ‰€æœ‰éœ€è¦æ„å»ºæ¨¡å—çš„æŠ½è±¡æ¦‚å¿µï¼Œå¯¹äºMavenç”¨æˆ·æ¥è¯´ï¼Œä¸»è¦å…³å¿ƒçš„æ˜¯ä¸¤ç‚¹ï¼š\n\n1. å“ªäº›æ¨¡å—ä¼šè¢«åŒ…å«åˆ°ååº”å †ä¸­ï¼Ÿ\n2. ååº”å †ä¸­æ‰€æœ‰æ¨¡å—çš„æ„å»ºé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ\n\n\n\n```\n$ tree -L 3 -P *xml -I \"src|target\" ./spring-boot/\n./spring-boot/\nâ”œâ”€â”€ cs-framework\nâ”‚Â Â  â”œâ”€â”€ cs-msc\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ lib\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ msc\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ pom.xml\nâ”‚Â Â  â”œâ”€â”€ cs-ocr\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ libs\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ pom.xml\nâ”‚   â”œâ”€â”€ cs-shiro\nâ”‚Â Â  â”‚   â””â”€â”€ pom.xml\nâ”‚   â””â”€â”€ pom.xml\nâ”œâ”€â”€ cs-tool\nâ”‚Â Â  â”œâ”€â”€ cs-common\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ pom.xml\nâ”‚Â Â  â”œâ”€â”€ cs-email\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ pom.xml\nâ”‚Â Â  â”œâ”€â”€ cs-jpa\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ pom.xml\nâ”‚Â Â  â”œâ”€â”€ cs-rw-aop\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ pom.xml\nâ”‚Â Â  â”œâ”€â”€ cs-rw-druid\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ pom.xml\nâ”‚Â Â  â””â”€â”€ pom.xml\nâ””â”€â”€ pom.xml\n```\n\n\n\nä¸€çº§\n\n```xml\n<groupId>com.cs</groupId>\n  <artifactId>cs-parent</artifactId>\n   <version>${version}</version>\n\n  <modules>\n    <module>cs-framework</module>\n    <module>cs-tool</module>\n  </modules>\n  <packaging>pom</packaging>\n  \n  <name>cs-parent</name>\n```\n\n\n\n\n\näºŒçº§\n\n```xml\n <parent>\n    <groupId>com.cs</groupId>\n    <artifactId>cs-parent</artifactId>\n    <version>${version}</version>\n  </parent>\n\n <groupId>com.cs</groupId>\n  <artifactId>cs-framework</artifactId>\n   <version>${version}</version>\n  <name>cs-framework</name>\n  <packaging>pom</packaging>\n  \n   <modules>\n     <module>cs-shiro</module>\n    <module>cs-ocr</module>\n    <module>cs-msc</module>\n  </modules>\n```\n\n\n\nå­\n\n```xml\n  <parent>\n    <groupId>com.cs</groupId>\n    <artifactId>cs-framework</artifactId>\n    <version>${version}</version>\n  </parent>\n  <groupId>com.cs</groupId>\n  <artifactId>cs-ocr</artifactId>\n  <version>${version}</version>\n  <name>cs-ocr</name>\n```\n\n\n\n```\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for cs-parent 0.0.1-SNAPSHOT:\n[INFO] \n[INFO] cs-parent .......................................... SUCCESS [  0.163 s]\n[INFO] cs-tool ............................................ SUCCESS [  0.005 s]\n[INFO] cs-common .......................................... SUCCESS [  0.800 s]\n[INFO] cs-framework ....................................... SUCCESS [  0.006 s]\n[INFO] cs-ocr ............................................. SUCCESS [  3.194 s]\n[INFO] cs-msc ............................................. SUCCESS [  0.271 s]\n[INFO] cs-jpa ............................................. SUCCESS [  0.471 s]\n[INFO] cs-rw-aop .......................................... SUCCESS [  1.074 s]\n[INFO] cs-rw-druid ........................................ SUCCESS [  0.893 s]\n[INFO] cs-email ........................................... SUCCESS [  2.520 s]\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  9.736 s\n[INFO] Finished at: 2022-07-30T21:51:32+08:00\n[INFO] ------------------------------------------------------------------------\n```\n\n\n\n\n\n### æŒ‡å®š -pl\n\næ‰‹åŠ¨é€‰æ‹©é¡¹ç›®ï¼Œå¤šä¸ªé€—å·éš”å¼€\n\n```\nmvn install -pl web/style,web/login\n```\n\n>-pl,--projects <arg>                   \n>Build specified reactor projects instead of all projects. \n>A project can be specified by [groupId]:artifactId or by its relative path.\n\n\n\n### æ‰€éœ€ä¾èµ– -am\n\næ„å»ºæŸä¸ªå­æ¨¡å—\n\n```\nmvn install -pl web/style  -am\n```\n\n>é¡¹ç›®è¢«æŒ‡å®šï¼Œæ„å»ºè¯¥é¡¹ç›®æ‰€éœ€ä¾èµ–\n>\n> -am,--also-make                      \n>  If project list is specified, also  build projects required by the  list\n\næ„å»º parent ï¼Œframework, web, redis ,style\n\n\n\n### ä¾èµ–è¯¥æ¨¡å— -amd \n\næ„å»ºçˆ¶æ¨¡å—ï¼Œå…¬ç”¨æ¨¡å—\n\n```\nmvn install -pl web/redis  -amd\n```\n\n> é¡¹ç›®è¢«æŒ‡å®šï¼Œæ„å»ºä¾èµ–è¯¥æ¨¡å—çš„æ¨¡å— \n>\n> -amd,--also-make-dependents          \n>    If project list is specified, also  build projects that depend on projects on the list\n\næ„å»º redis, login, style\n\n\n\n### è£å‰ª -rf\n\nåœ¨å‰å‘½ä»¤è£å‰ªåŸºç¡€ä¸Šï¼Œä»rfæŒ‡å®šæ¨¡å—å¼€å§‹æ„å»º\n\n```\nmvn install -pl web/style  -am -rf  web/redis\n```\n\n>ä»åŸæœ‰æ„å»ºè¿‡ç¨‹ä¸­è£å‰ªååº”å †ï¼Œå»æ‰æŒ‡å®šæ¨¡å—åŸæœ‰æ„å»ºé¡ºåºçš„å‰é¢éƒ¨åˆ†\n>\n>-rf,--resume-from <arg>              \n>Resume reactor from specified  project\n\næ„å»º redis style\n\n\n\n\n\n\n\n## é”™è¯¯\n\n### find main class\n\n repackage failed: Unable to find main class\n\n```\n <build>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n                <executions>\n                    <execution>\n                        <phase>none</phase>\n                    </execution>\n                </executions>\n            </plugin>\n        </plugins>\n   </build>\n```\n\n","tags":["maven","mvn"],"categories":["tool"]},{"title":"k8sé›†ç¾¤","url":"/linux/k8s/k8s01/","content":"\n\n\n\n\n\n\n### å¸¸ç”¨å‘½ä»¤\n\nç¼©å†™\n\n```\ncertificatesigningrequests (ç¼©å†™ csr)\ncomponentstatuses (ç¼©å†™ cs)\nconfigmaps (ç¼©å†™ cm)\ncustomresourcedefinition (ç¼©å†™ crd)\ndaemonsets (ç¼©å†™ ds)\ndeployments (ç¼©å†™ deploy)\nendpoints (ç¼©å†™ ep)\nevents (ç¼©å†™ ev)\nhorizontalpodautoscalers (ç¼©å†™ hpa)\ningresses (ç¼©å†™ ing)\nlimitranges (ç¼©å†™ limits)\nnamespaces (ç¼©å†™ ns)\nnetworkpolicies (ç¼©å†™ netpol)\nnodes (ç¼©å†™ no)\npersistentvolumeclaims (ç¼©å†™ pvc)\npersistentvolumes (ç¼©å†™ pv)\npoddisruptionbudgets (ç¼©å†™ pdb)\npods (ç¼©å†™ po)\npodsecuritypolicies (ç¼©å†™ psp)\nreplicasets (ç¼©å†™ rs)\nreplicationcontrollers (ç¼©å†™ rc)\nresourcequotas (ç¼©å†™ quota)\nserviceaccounts (ç¼©å†™ sa)\nservices (ç¼©å†™ svc)\nstatefulsets (ç¼©å†™ sts)\nstorageclasses (ç¼©å†™ sc)\n```\n\n\n\n#### è‡ªåŠ¨è¡¥å…¨\n\n```\nsudo apt install bash-completion\n\nsource /usr/share/bash-completion/bash_completion\nsource <(kubectl completion bash)\n\necho \"source <(kubectl completion bash)\" >> ~/.bashrc\n```\n\n\n\n#### cs(masterèŠ‚ç‚¹)\n\ncomponentstatuses\n\n```\ncs@debian:~$ kubectl get cs\nNAME                 STATUS    MESSAGE              ERROR\nscheduler            Healthy   ok                   \ncontroller-manager   Healthy   ok                   \netcd-2               Healthy   {\"health\": \"true\"}   \netcd-0               Healthy   {\"health\": \"true\"}   \netcd-1               Healthy   {\"health\": \"true\"}  \n```\n\n\n\n#### nodeèŠ‚ç‚¹\n\n```\ncs@debian:~$ kubectl  get node\nNAME       STATUS   ROLES    AGE    VERSION\nmaster02   Ready    <none>   101d   v1.18.8\nmaster03   Ready    <none>   101d   v1.18.8\nnode04     Ready    <none>   101d   v1.18.8\nnode05     Ready    <none>   101d   v1.18.8\nnode06     Ready    <none>   101d   v1.18.8\n\nkubectl get node -o wide\n```\n\n<!--more-->\n\nç©ºé—´\n\n```\ncs@debian:~$ kubectl get namespaces \nNAME                   STATUS   AGE\ndefault                Active   101d\ndevops                 Active   100d\nkube-node-lease        Active   101d\nkube-public            Active   101d\nkube-system            Active   101d\nkubernetes-dashboard   Active   92d\n```\n\n\n\n#### pod\n\n```\ncs@debian:~$ kubectl get pod\nNo resources found in default namespace.\n\ncs@debian:~$ kubectl get pod -n kube-system \nNAME                                         READY   STATUS    RESTARTS   AGE\ncoredns-56ff7bc666-prc6l                     1/1     Running   4          11d\ncoredns-56ff7bc666-qwdsh                     1/1     Running   8          92d\ntraefik-ingress-controller-7769cb875-x76rs   1/1     Running   1          46h\n```\n\n>-n  æ¥namespacesçš„NAMEå€¼,çœç•¥ä¸ºdefault\n\n\n\n```\nkubectl get pods -o wide\nkubectl get pods -A -o wide\n```\n\n\n\n\n\n#### describe\n\n ingress **Tabæç¤º**\n\n```\ncs@debian:~$ kubectl get ingress -n devops \ningressclasses.networking.k8s.io      ingresses.networking.k8s.io           ingressroutetcps.traefik.containo.us  \ningresses.extensions                  ingressroutes.traefik.containo.us     ingressrouteudps.traefik.containo.us  \n\ncs@debian:~$ kubectl get ingressroutetcps.traefik.containo.us -n devops \nNAME    AGE\nredis   47h\n\ncs@debian:~$ kubectl describe ingressroutetcps.traefik.containo.us redis -n devops \nName:         redis\nNamespace:    devops\nLabels:       <none>\nAnnotations:  API Version:  traefik.containo.us/v1alpha1\nKind:         IngressRouteTCP\nMetadata:\n  Creation Timestamp:  2022-07-19T13:01:37Z\n  Generation:          1\n  Managed Fields:\n    API Version:  traefik.containo.us/v1alpha1\n    Fields Type:  FieldsV1\n    fieldsV1:\n      f:metadata:\n        f:annotations:\n          .:\n          f:kubectl.kubernetes.io/last-applied-configuration:\n      f:spec:\n        .:\n        f:entryPoints:\n        f:routes:\n    Manager:         kubectl\n    Operation:       Update\n    Time:            2022-07-19T13:01:37Z\n  Resource Version:  261095\n  Self Link:         /apis/traefik.containo.us/v1alpha1/namespaces/devops/ingressroutetcps/redis\n  UID:               c79681ee-1bf1-4843-9666-457970d78f27\nSpec:\n  Entry Points:\n    redis\n  Routes:\n    Match:  HostSNI(`*`)\n    Services:\n      Name:  redis-service\n      Port:  6379\nEvents:      <none>\n```\n\n\n\n\n\n#### log\n\n\n\n```\ncs@debian:~$ kubectl logs  --tail=5 redis-app-1 -n devops\n63:M 21 Jul 2022 12:15:34.720 * Synchronization with replica 121.21.25.3:6379 succeeded\n63:M 21 Jul 2022 12:15:36.469 # Cluster state changed: ok\n63:M 21 Jul 2022 12:15:40.604 * FAIL message received from 67f931358b8004268db0b57932293602ab3de629 about b49a123e2764b665ee898c21f983b9cda70cda00\n63:M 21 Jul 2022 12:15:42.635 * Marking node a0e2f50ba382870da1ce4d23b66a1375826d6dc8 as failing (quorum reached).\n63:M 21 Jul 2022 12:15:42.635 # Cluster state changed: fail\n\ncs@debian:~$ kubectl logs  -f  --tail=5 redis-app-1 -n devops\n63:M 21 Jul 2022 12:15:34.720 * Synchronization with replica 121.21.25.3:6379 succeeded\n63:M 21 Jul 2022 12:15:36.469 # Cluster state changed: ok\n63:M 21 Jul 2022 12:15:40.604 * FAIL message received from 67f931358b8004268db0b57932293602ab3de629 about b49a123e2764b665ee898c21f983b9cda70cda00\n63:M 21 Jul 2022 12:15:42.635 * Marking node a0e2f50ba382870da1ce4d23b66a1375826d6dc8 as failing (quorum reached).\n63:M 21 Jul 2022 12:15:42.635 # Cluster state changed: fail\n^C\n```\n\n>-f   ç±»ä¼¼ **tail -f** \n>\n>-p,  --previous[=false]: å¦‚æœä¸ºtrueï¼Œè¾“å‡ºpodä¸­æ›¾ç»è¿è¡Œè¿‡ï¼Œä½†ç›®å‰å·²ç»ˆæ­¢çš„å®¹å™¨çš„æ—¥å¿—\n>       --since=0: ä»…è¿”å›ç›¸å¯¹æ—¶é—´èŒƒå›´ï¼Œå¦‚5sã€2mæˆ–3hï¼Œä¹‹å†…çš„æ—¥å¿—ã€‚é»˜è®¤è¿”å›æ‰€æœ‰æ—¥å¿—ã€‚åªèƒ½åŒæ—¶ä½¿ç”¨since å’Œsince-timeä¸­çš„ä¸€ç§\n>      --since-time=\"\": ä»…è¿”å›æŒ‡å®šæ—¶é—´ï¼ˆRFC3339æ ¼å¼ï¼‰ä¹‹åçš„æ—¥å¿—ã€‚é»˜è®¤è¿”å›æ‰€æœ‰æ—¥å¿—ã€‚åªèƒ½åŒæ—¶ä½¿ç”¨sinceå’Œsince-timeä¸­çš„ä¸€ç§\n>      --tail=-1: è¦æ˜¾ç¤ºçš„æœ€æ–°çš„æ—¥å¿—æ¡æ•°ã€‚é»˜è®¤ä¸º-1ï¼Œæ˜¾ç¤ºæ‰€æœ‰çš„æ—¥å¿—\n\n\n\n#### patch\n\næ›´æ–°å®¹å™¨çš„é•œåƒ\n\n```\nkubectl patch pod valid-pod -p '{\"spec\":{\"containers\":[{\"name\":\"kubernetes-serve-hostname\",\"image\":\"new image\"}]}}'\næˆ–\nkubectl patch pod valid-pod --type='json' -p='[{\"op\": \"replace\", \"path\": \"/spec/containers/0/image\", \"value\":\"new image\"}]'\n```\n\nè®¾ç½®æœåŠ¡å¯¹å¤–çš„IP\n\n```\nkubectl patch svc <svc-name> -n <namespace> -p '{\"spec\": {\"type\": \"LoadBalancer\", \"externalIPs\":[\"192.168.31.241\"]}}'\n```\n\n\n\n#### scale\n\nå¯¹å‰¯æœ¬æ•°è¿›è¡Œæ‰©å±•æˆ–ç¼©å°\n\n\n\nå‰ææ¡ä»¶æ ¡éªŒ ï¼›å½“å‰å‰¯æœ¬æ•°é‡æˆ– `--resource-version`\n\n\n\nç¼©å‡å‰¯æœ¬æ•°åˆ°2\n\n```\nkubectl scale rc rc-nginx-3 â€”replicas=2\n```\n\n\n\nå½“å‰å‰¯æœ¬æ•°ä¸º2ï¼Œåˆ™å°†å…¶æ‰©å±•è‡³3\n\n```\nkubectl scale --current-replicas=2 --replicas=3 deployment/mysql\n```\n\n\n\n\n\n#### é‡å¯\n\n```\nkubectl rollout restart deployment <deployment_name> -n <namespace>\n```\n\n\n\n#### é€‰æ‹©å™¨\n\n--field-selector\n\n`status.podIP`\n\n```\ncs@debian:~/oss/hexo$  kubectl  get pod --field-selector status.podIP=121.21.35.3 -o wide -n devops\nNAME          READY   STATUS    RESTARTS   AGE   IP            NODE     NOMINATED NODE   READINESS GATES\nredis-app-1   1/1     Running   1          9d    121.21.35.3   node04   <none>           <none>\n```\n\n>1. metadata.name=my-service\n>2. metadata.namespace!=default\n>3. status.phase=Pending\n>\n>\n\né€‰æ‹©äº†æ‰€æœ‰**`status.phase`**ä¸ä¸º**`Running`**ä¸”`spec.restartPolicy`ä¸º**`Always`**çš„Pod.\n\n```\nkubectl get pods --field-selector=status.phase!=Running,spec.restartPolicy=Always\n```\n\n\n\n#### events\n\næ˜¾ç¤ºé›†ç¾¤å†…çš„è¯¦ç»†äº‹ä»¶ï¼Œå¦‚æœæœ€è¿‘å‡ºç°æ•…éšœï¼Œä½ å¯ä»¥æŸ¥çœ‹é›†ç¾¤äº‹ä»¶ä»¥äº†è§£æ•…éšœå‰åå‘ç”Ÿçš„æƒ…å†µã€‚å¦‚æœä½ çŸ¥é“åªæœ‰ç‰¹å®šåç§°ç©ºé—´ä¸­å­˜åœ¨é—®é¢˜ï¼Œä½ å¯ä»¥å°†äº‹ä»¶è¿‡æ»¤åˆ°è¯¥åç§°ç©ºé—´ã€‚\n\n```\n$ kubectl get events \nLAST SEEN   TYPE     REASON                    OBJECT     MESSAGE\n2d18h       Normal   Starting                  node/k8s   Starting kubelet.\n2d18h       Normal   NodeHasSufficientMemory   node/k8s   Node k8s status is now: NodeHasSufficientMemory\n2d18h       Normal   NodeHasNoDiskPressure     node/k8s   Node k8s status is now: NodeHasNoDiskPressure\n2d18h       Normal   NodeHasSufficientPID      node/k8s   Node k8s status is now: NodeHasSufficientPID\n2d18h       Normal   NodeAllocatableEnforced   node/k8s   Updated Node Allocatable limit across pods\n2d18h       Normal   Starting                  node/k8s   Starting kubelet.\n2d18h       Normal   NodeHasSufficientMemory   node/k8s   Node k8s status is now: NodeHasSufficientMemory\n2d18h       Normal   NodeHasNoDiskPressure     node/k8s   Node k8s status is now: NodeHasNoDiskPressure\n2d18h       Normal   NodeHasSufficientPID      node/k8s   Node k8s status is now: NodeHasSufficientPID\n2d18h       Normal   NodeAllocatableEnforced   node/k8s   Updated Node Allocatable limit across pods\n2d18h       Normal   NodeReady                 node/k8s   Node k8s status is now: NodeReady\n2d18h       Normal   RegisteredNode            node/k8s   Node k8s event: Registered Node k8s in Controller\n2d18h       Normal   Starting                  node/k8s   Starting kube-proxy.\n2d18h       Normal   RegisteredNode            node/k8s   Node k8s event: Registered Node k8s in Controller\n23m         Normal   Starting                  node/k8s   Starting kubelet.\n23m         Normal   NodeHasSufficientMemory   node/k8s   Node k8s status is now: NodeHasSufficientMemory\n23m         Normal   NodeHasNoDiskPressure     node/k8s   Node k8s status is now: NodeHasNoDiskPressure\n23m         Normal   NodeHasSufficientPID      node/k8s   Node k8s status is now: NodeHasSufficientPID\n23m         Normal   NodeAllocatableEnforced   node/k8s   Updated Node Allocatable limit across pods\n23m         Normal   Starting                  node/k8s   Starting kube-proxy.\n22m         Normal   RegisteredNode            node/k8s   Node k8s event: Registered Node k8s in Controller\n```\n\n\n\n#### api-resources\n\n```\nkubectl api-resources -o wide --sort-by name\n```\n\n\n\n#### è°ƒè¯•\n\nå¯åŠ¨å‚æ•°`--feature-gates=EphemeralContainers=true`é…ç½®åˆ°kube-apiå’ŒkubeletæœåŠ¡ä¸Šé‡å¯\n\n```\n# æŸ¥çœ‹podæ‰€åœ¨å®¿ä¸»åŠpod name\n$ kubectl get po -o wide\n# æ ¹æ®pod nameæŸ¥çœ‹å¯¹åº”çš„docker å®¹å™¨\n$ docker ps | grep centos-687ff6c787-47gvh\n# æ ¹æ®è¾“å‡ºçš„å®¹å™¨idï¼ŒæŒ‚è½½å®¹å™¨ç½‘ç»œå¹¶è¿è¡Œä¸€ä¸ªdebugå®¹å™¨ï¼Œä½¿ç”¨ nicolaka/netshoot è¿™ä¸ªé•œåƒã€‚è¿™ä¸ªé•œåƒé‡Œé›†æˆäº†å¾ˆå¤šç½‘ç»œè°ƒè¯•å·¥å…·ã€‚\n$ docker run -it --rm --name=debug --network=container:bb009aab414f nicolaka/netshoot bash\næ¥ä¸‹æ¥å°±è¿›å…¥äº†ä¸è¿™ä¸ªpodçš„ç›¸åŒçš„ç½‘ç»œnamespaceï¼Œå¯ä»¥è¿›è¡Œç½‘ç»œç›¸å…³çš„è°ƒè¯•äº†\n```\n\n\n\n```\nfor pod in $(kubectl get -o name pod  -n kube-system); \ndo\n    kubectl debug --image security/pod_scanner -p $pod /sanner.sh\ndone\n```\n\n> æ‰¹é‡è·‘æŸä¸ªå‘½åç©ºé—´ä¸‹çš„å®‰å…¨æ‰«æçš„è„šæœ¬è€Œä¸ç”¨å¹²æ‰°åŸå®¹å™¨\n\n\n\n\n\n##### æ²¡æœ‰å¼€å¯Ephemeral Containers\n\n```\nkubectl debug mypod -it \\\n--container=debug \\\n--image=busybox \\\n--copy-to=my-debugger \\\n--same-node=true \\\n--share-processes=true\n```\n\n>--copy-to   æŒ‡å®šæ–°podçš„åç§°\n>--replace=true   æ˜¯å¦åˆ é™¤åŸå®¹å™¨\n>--same-node=true  æ˜¯å¦è°ƒåº¦åˆ°å’ŒåŸå®¹å™¨ä¸€æ ·çš„nodeä¸Š\n>--share-processes=true  æ˜¯å¦å…±äº«å®¹å™¨pidç©ºé—´\n\n\n\n##### åˆ©ç”¨Ephemeral Containers\n\n```\nkubectl run ephemeral-demo --image=k8s.gcr.io/pause:3.1 --restart=Never\n```\n\n\n\n```\nkubectl debug ephemeral-demo -it --image=busybox  --target=ephemeral-demo\n```\n\n> å®¹å™¨è¿è¡Œæ—¶å¿…é¡»æ”¯æŒ--targetå‚æ•°ã€‚ å¦‚æœä¸æ”¯æŒï¼Œåˆ™ä¸´æ—¶å®¹å™¨å¯èƒ½ä¸ä¼šå¯åŠ¨ï¼Œæˆ–è€…å¯èƒ½ä½¿ç”¨éš”ç¦»çš„è¿›ç¨‹å‘½åç©ºé—´å¯åŠ¨ã€‚\n\n\n\n```\nkubectl delete pod ephemeral-demo\n```\n\n##### nsenter\n\n```\n sudo yum install -y util-linux\n```\n\n\n\n```\n$ docker inspect -f {{.State.Pid}} nginx\n#nsenterå‘½ä»¤è¿›å…¥è¯¥å®¹å™¨çš„ç½‘ç»œå‘½ä»¤ç©ºé—´\n$ nsenter -n -t6700\n```\n\n","tags":["kubernetes","kubectl"],"categories":["linux","k8s"]},{"title":"traefik","url":"/linux/k8s/traefik/","content":"\n\n\n\n\nTrÃ¦fÉªk æ˜¯ä¸€ä¸ªäº‘åŸç”Ÿçš„æ–°å‹çš„ HTTP åå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡è½¯ä»¶\n\n\n\n```\n$bash traefik.sh\n$ tree  ./test\n./test\nâ”œâ”€â”€ 1-crd.yaml\nâ”œâ”€â”€ 2-rbac.yaml\nâ”œâ”€â”€ 3-role.yaml\nâ”œâ”€â”€ 4-static_config.yaml\nâ”œâ”€â”€ 5-dynamic_toml.toml\nâ”œâ”€â”€ 6-deploy.yaml\nâ”œâ”€â”€ 7-service.yaml\nâ””â”€â”€ 8-ingress.yaml\n\n```\n\n\n\ntraefik.sh\n\n```shell\n#!/bin/bash\nDIR=\"$(cd \"$(dirname \"$0\")\" && pwd)\"\n\nbase_file=$DIR/test\ncrd=1-crd.yaml\nrbac=2-rbac.yaml\nrole=3-role.yaml\nstatic=4-static_config.yaml\ndynamic=5-dynamic_toml.toml\ndeploy=6-deploy.yaml\nsvc=7-service.yaml\ningress=8-ingress.yaml\n\n\ny_crd(){\n\tcat >$1 <<EOF\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ingressroutes.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: IngressRoute\n    plural: ingressroutes\n    singular: ingressroute\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: middlewares.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: Middleware\n    plural: middlewares\n    singular: middleware\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ingressroutetcps.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: IngressRouteTCP\n    plural: ingressroutetcps\n    singular: ingressroutetcp\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ingressrouteudps.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: IngressRouteUDP\n    plural: ingressrouteudps\n    singular: ingressrouteudp\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: tlsoptions.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: TLSOption\n    plural: tlsoptions\n    singular: tlsoption\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: tlsstores.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: TLSStore\n    plural: tlsstores\n    singular: tlsstore\n  scope: Namespaced\n\n---\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: traefikservices.traefik.containo.us\n\nspec:\n  group: traefik.containo.us\n  version: v1alpha1\n  names:\n    kind: TraefikService\n    plural: traefikservices\n    singular: traefikservice\n  scope: Namespaced\n\nEOF\n\n}\n\n\n\ny_rbac(){\n\tcat>$1 <<EOF\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: traefik-ingress-controller\n\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - services\n      - endpoints\n      - secrets\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - persistentvolumes\n    verbs:\n      - get\n      - list\n      - watch\n      - create  # persistentvolumes\n      - delete\n  - apiGroups:\n      - \"\"\n    resources:\n      - persistentvolumeclaims\n    verbs:\n      - get\n      - list\n      - watch\n      - update  # persistentvolumeclaims         \n  - apiGroups:\n      - extensions\n    resources:\n      - ingresses\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups:\n      - extensions\n    resources:\n      - ingresses/status\n    verbs:\n      - update\n  - apiGroups:\n      - traefik.containo.us\n    resources:\n      - middlewares\n      - ingressroutes\n      - traefikservices\n      - ingressroutetcps\n      - ingressrouteudps\n      - tlsoptions\n      - tlsstores\n    verbs:\n      - get\n      - list\n      - watch\nEOF\n\n}\n\n\n\ny_role(){\n   cat >$1 <<EOF\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: traefik-ingress-controller\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: traefik-ingress-controller\nsubjects:\n  - kind: ServiceAccount\n    name: traefik-ingress-controller\n    namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  namespace: kube-system\n  name: traefik-ingress-controller\nEOF\n\n}\n\n#é™æ€é…ç½®åŠ¨æ€æ–‡ä»¶======================?\ny_static_config(){\n   cat >$1 <<EOF\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: traefik-config-yaml\n  namespace: kube-system\ndata:\n  traefik.yaml: |-\n    ping: \"\"\n    serversTransport:\n      insecureSkipVerify: true\n    api:\n      insecure: true\n      dashboard: true\n      debug: false\n    metrics:\n      prometheus: \"\"\n    entryPoints:\n      web:\n        address: \":80\"\n      websecure:\n        address: \":443\"\n      mysql:\n        address: \":3306\"\n      redis:    \n        address: \":6379\"\n      jenkins:\n        address: \":8081\"\n      gogo:\n        address: \":8082\"\n      prometheus:\n        address: \":8181\"\n    providers:\n      kubernetesCRD: \"\"\n      kubernetesIngress: \"\"\n      file:\n        directory: /etc/conf.d/\n        watch: true\n    log:\n      filePath: \"\"\n      level: error \n      format: json\n    accessLog:\n      filePath: \"\"\n      format: json\n      bufferingSize: 0\n      filters:\n        #statusCodes: [\"200\"]\n        retryAttempts: true\n        minDuration: 20\n      fields:\n        defaultMode: keep\n        names:\n          ClientUsername: drop  \n        headers:\n          defaultMode: keep\n          names:\n            User-Agent: redact\n            Authorization: drop\n            Content-Type: keep\nEOF\n\n}\n\n\ngenkey(){\nopenssl req \\\n        -newkey rsa:2048 -nodes -keyout tls.key \\\n        -x509 -days 3650 -out tls.crt \\\n        -subj \"/C=CN/ST=GD/L=SZ/O=cs/OU=shea/CN=k8s.org\" \n#kubectl create secret generic traefik-cert --from-file=tls.crt --from-file=tls.key -n kube-system        \n}\n\ny_dynamic_toml(){\n   cat >$1 <<EOF\ndefaultEntryPoints = [\"http\",\"https\"]\n[entryPoints]\n  [entryPoints.http]\n  address = \":80\"\n  [entryPoints.https]\n  address = \":443\"\n    [entryPoints.https.tls]\n      [[entryPoints.https.tls.certificates]]\n      CertFile = \"/ssl/tls.crt\"\n      KeyFile = \"/ssl/tls.key\"\n\n\ntls:\n  certificates:\n    - certFile: /path/to/domain.cert\n      keyFile: /path/to/domain.key\n      stores: #stores åˆ—è¡¨å°†è¢«å¿½ç•¥ï¼Œå¹¶è‡ªåŠ¨è®¾ç½®ä¸º [\"default\"]\n        - default\n\nEOF\n}\n\n\n\n\ny_deploy(){\n   cat >$1 <<EOF\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: traefik-ingress-controller\n  namespace: kube-system\n  labels:\n    app: traefik\nspec:\n  selector:\n    matchLabels:\n      app: traefik\n  template:\n    metadata:\n      name: traefik\n      labels:\n        app: traefik\n    spec:\n      serviceAccountName: traefik-ingress-controller\n      terminationGracePeriodSeconds: 1\n      #è®¾ç½®nodeç­›é€‰å™¨ï¼Œåœ¨ç‰¹å®šlabelçš„èŠ‚ç‚¹ä¸Šå¯åŠ¨  kubectl label node 192.168.56.109 tklabel=ok\n      nodeSelector: \n         tklabel: \"ok\"\n      containers:\n        - image: k8s.org/k8s/traefik:v2.2.10\n          name: traefik\n          ports:\n            - name: web\n              containerPort: 80\n              hostPort: 80         ## å°†å®¹å™¨ç«¯å£ç»‘å®šæ‰€åœ¨æœåŠ¡å™¨çš„ 80 ç«¯å£\n            - name: websecure\n              containerPort: 443\n              hostPort: 443        ## å°†å®¹å™¨ç«¯å£ç»‘å®šæ‰€åœ¨æœåŠ¡å™¨çš„ 443 ç«¯å£\n            # - name: redis\n            #   containerPort: 6379\n            #  hostPort: 6379\n            - name: admin\n              containerPort: 8080  ## Traefik Dashboard ç«¯å£\n          resources:\n            limits:\n              cpu: 200m\n              memory: 256Mi\n            requests:\n              cpu: 100m\n              memory: 256Mi\n          securityContext:\n            capabilities:\n              drop:\n                - ALL\n              add:\n                - NET_BIND_SERVICE\n          args:\n            - --configfile=/config/traefik.yaml\n          volumeMounts:\n            - mountPath: \"/config\"\n              name: \"config\"\n            - mountPath: \"/ssl\"\n              name: \"ssl\"\n      volumes:\n        - name: config\n          configMap:\n            name: traefik-config-yaml\n        - name: ssl\n          secret:\n            secretName: traefik-cert\nEOF\n\n}\n\n\n\n\ny_service(){\n   cat >$1 <<EOF\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: traefik\n  namespace: kube-system\nspec:\n  ports:\n    - name: web\n      port: 80\n    - name: websecure\n      port: 443\n    - name: admin   #æ²¡æœ‰ä¼šæ˜¾ç¤º 404 page not found\n      port: 8080\n  selector:\n    app: traefik\n\nEOF\n}\n\n\n\n\ny_ingress(){\n   cat >$1 <<\"EOF\"\n---\napiVersion: traefik.containo.us/v1alpha1\nkind: IngressRoute\nmetadata:\n  name: traefik-dashboard-route\n  namespace: kube-system\nspec:\n  entryPoints:\n    - web\n  routes:\n    - match: Host(`master02`) #podèŠ‚ç‚¹\n      kind: Rule\n      services:\n        - name: traefik\n          port: 8080\n\nEOF\n\n}\n\n[ -d \"$base_file\" ] || { echo \"æ²¡æœ‰ç›®å½•,åˆ™åˆ›å»ºç›®å½•\" && mkdir $base_file; }\n[ -n \"$(which openssl)\" ] || { echo \"éœ€è¦ç”¨åˆ°openssl,æ²¡æœ‰æ‰¾åˆ°,é€€å‡º\" && exit 1; }\ncd $base_file\n\n# genkey  \n# [ -f \"tls.key\" ] || { echo \"æ²¡æœ‰ç”Ÿæˆå¯†é’¥,é€€å‡º\" && exit 1; }\n#kubectl create secret generic traefik-cert --from-file=tls.crt --from-file=tls.key -n kube-system\n# #kubectl create configmap traefik-conf --from-file=$dynamic -n kube-system\n\narr=($crd $rbac $role $static $dynamic $deploy  $svc $ingress)\n\nfor i in ${arr[@]}; do\necho \"å¼€å§‹ç”Ÿæˆ:\"$i \ny_${i:2:0-5}  $i\n[ -f \"$i\" ] || { echo \"æ²¡æœ‰ç”Ÿæˆ$i,é€€å‡º\" && exit 1; }\n#kubectl apply -f  $i\ndone\n\n```\n\n\n\n","tags":["traefik","ingress"],"categories":["linux","k8s"]},{"title":"etcdé›†ç¾¤","url":"/linux/k8s/etcd/","content":"etcd ä¸‹è½½\n\n\n\n\n\n\n\nhttps://github.com/bitnami/bitnami-docker-etcd\n\n\n\n\n\n```\n$ etcdctl set /atomic.io/network/config '{\"Network\":\"121.21.0.0/16\",\"Backend\":{\"Type\":\"vxlan\"}}'\n```\n\n>{\"Network\":\"121.21.0.0/16\",\"Backend\":{\"Type\":\"vxlan\"}}\n\n\n\nCouldn't fetch network config: client: response is invalid json. The endpoint is probably not valid etcd cluster endpoint. timed out\n\næŸ¥é˜… flanneld å®˜ç½‘æ–‡æ¡£ï¼Œä¸Šé¢æ ‡å‡†äº† flannel è¿™ä¸ªç‰ˆæœ¬ä¸èƒ½ç»™ etcd 3 è¿›è¡Œé€šä¿¡\n\n```\n$ etcdctl put /atomic.io/network/config '{\"Network\":\"121.21.0.0/16\",\"Backend\":{\"Type\":\"vxlan\"}}'\n$ etcdctl del /atomic.io/network/config\n```\n\n>API VERSION:3.2\n>\n>Did you mean this?\n>\tget\n>\tput\n>\tdel\n>\tuser\n\n\n\netcd environmentæ–‡æ¡£\n\nhttps://doczhcn.gitbook.io/etcd/index/index-1/configuration\n\n\n\n\n\n\n\n```shell\ncs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs\ninsmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs.ko \ncs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs_rr\ninsmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs_rr.ko \ncs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs_wrr\ninsmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs_wrr.ko \ncs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs_sh\ninsmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs_sh.ko\ncs@debian:~/oss/0s/k8s$ sudo modprobe -v ip_vs_nq\ninsmod /lib/modules/4.9.0-8-amd64/kernel/net/netfilter/ipvs/ip_vs_nq.ko\n```\n\n\n\n```shell\ncs@debian:~/oss/0s/k8s$ sudo ipvsadm -ln\nIP Virtual Server version 1.2.1 (size=4096)\nProt LocalAddress:Port Scheduler Flags\n  -> RemoteAddress:Port           Forward Weight ActiveConn InActConn\n\n```\n\n\n\n```shell\n#ä¸¤ç§ä¸´æ—¶æ–¹æ³•\n# echo 1 > /proc/sys/net/ipv4/vs/conntrack\n# sysctl -w net.ipv4.vs.conntrack=1\n```\n\n> æƒ³æ°¸ä¹…ä¿ç•™é…ç½®ï¼Œå¯ä»¥ä¿®æ”¹/etc/sysctl.confæ–‡ä»¶\n\n\n\n\n\n```\nkubectl create clusterrolebinding test:anonymous --clusterrole=cluster-admin --user=system:anonymous\n```\n\n> configmaps is forbidden: User â€œsystem:anonymousâ€ cannot list resource â€œconfigmapsâ€ in [API](https://so.csdn.net/so/search?q=API&spm=1001.2101.3001.7020) group â€œâ€ in the namespace â€œdefaultâ€\n\n\n\n```\n[vagrant@k8s master]$ kubectl create clusterrolebinding kubelet-bootstrap --clusterrole=system:node-bootstrapper --user=kubelet-bootstrap\nclusterrolebinding.rbac.authorization.k8s.io/kubelet-bootstrap created\n```\n\n>error: failed to run Kubelet: cannot create certificate signing request: certificatesigningrequests.certificates.k8s.io is forbidden: User \"kubelet-bootstrap\" cannot create certificatesigningrequests.certificates.k8s.io at the cluster\n\n\n\nproxy\n\nunable to create proxier: can't set sysctl net/ipv4/conf/all/route_localnet to 1: open /proc/sys/net/ipv4/conf/all/route_localnet: read-only file system\n\n\n\n```\n sduo  cat > /etc/sysconfig/modules/ipvs.modules <<EOF\n#!/bin/bash\nmodprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- ip_vs_nq\nmodprobe -- nf_conntrack_ipv4\nEOF\n```\n\n\n\n```yaml\n      containers:\n      - name: kube-flannel\n        image: k8s.org/k8s/flannel:v0.11.0-amd64\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        - --iface=eth1\n```\n\n> --iface=eth1\n\n\n\n\n\n```shell\ncs@debian:~$ ansible k8s-108 -m copy -a \"src=/home/cs/oss/0s/k8s/kube-apiserver/docker-compose.yml dest=/opt/kubernetes/master/docker-compose.yml\"   -b --become-method sudo --become-user root\n```\n\nansible k8s-108 -m copy -a \"src=/opt/kubernetes/client/k8s-1.21-11/bin/config.yaml dest=/opt/kubernetes  mode=0644\"   -b --become-method sudo --become-user root\n\n\n\n\n\n```\n[root@k8s kubernetes]# cat > /etc/sysctl.d/k8s.conf << EOF\nnet.ipv4.ip_forward = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\n```\n\n\n\n\n\n```\n cat>/opt/kubernetes/kubelet.env<<EOF\n KUBELET_OPTIONS=\" --hostname-override=192.168.56.108 \\\n  --pod-infra-container-image=k8s.org/k8s/pause:3.4.1 \\\n  --bootstrap-kubeconfig=/opt/kubernetes/config/bootstrap.kubeconfig \\\n  --kubeconfig=/opt/kubernetes/config/kubelet.kubeconfig \\\n   --config=/opt/kubernetes/config/kubelet-conf.yaml   \\\n  --register-node=true \\\n  --cni-bin-dir=/opt/kubernetes/cni/bin --cni-conf-dir=/opt/kubernetes/cni/net.d --network-plugin=cni  \\\n   --runtime-cgroups=/systemd/system.slice  \\\n  --logtostderr=true \"\nEOF\n```\n\n\n\n\n\n\n\n```\n\tcat>/usr/lib/systemd/system/kubelet.service<<EOF\n[Unit]\nDescription=Kubernetes Kubelet Server\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nWorkingDirectory=/var/lib/kubelet\nEnvironmentFile=/opt/kubernetes/kubelet.env\nExecStart=/opt/kubernetes/bin/kubelet  \\$KUBELET_OPTIONS\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\nEOF\n```\n\n\n\n\n\n\n\n","tags":["etcd"],"categories":["linux","k8s"]},{"title":"redisé›†ç¾¤","url":"/linux/k8s/redis/","content":"\n\n\n### pod\n\n```\nkubectl -n devops get pods\nNAME          READY   STATUS    RESTARTS   AGE\nredis-app-0   1/1     Running   0          50m\nredis-app-1   1/1     Running   0          50m\nredis-app-2   1/1     Running   0          44m\nredis-app-3   1/1     Running   0          38m\nredis-app-4   1/1     Running   0          38m\nredis-app-5   1/1     Running   0          38m\n\nkubectl -n devops exec -it redis-app-2 /bin/bash\nkubectl -n devops exec -it redis-app-4 /bin/bash\n```\n\nredis-cli -c -p 6379\n\n![](/pics/k8s-redis-c-set01.png)\n\n\n\n### svc ClusterIP\n\nä¸¤æ¬¡è®¤è¯?\n\n```\ncs@debian:~/oss/hexo$ kubectl get svc -n devops\nNAME                     TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)              AGE\njenkins                  ClusterIP   121.21.92.146    <none>        8081/TCP,50000/TCP   105d\nredis-headless-service   ClusterIP   None             <none>        6379/TCP             13d\nredis-service            ClusterIP   121.21.24.33     <none>        6379/TCP             13d\ntomcat                   ClusterIP   121.21.191.100   <none>        8082/TCP             105d\n\ncs@debian:~/oss/hexo$ kubectl exec -it redis-app-1 -n devops  /bin/bash\nkubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl kubectl exec [POD] -- [COMMAND] instead.\n.............\nroot@redis-app-1:/data# redis-cli  -c -h 121.21.24.33 -p 6379\n121.21.24.33:6379> auth 123456\nOK\n121.21.24.33:6379> ping\nPONG\n121.21.24.33:6379> get test21\n-> Redirected to slot [8530] located at 121.21.35.3:6379\n(error) NOAUTH Authentication required.  \n121.21.35.3:6379> auth 123456\nOK\n121.21.35.3:6379> get test21\n\"20220721cs\"\n```\n\n\n\n\n\n\n\ntraefik  deploay  é…ç½® redis\n\n```\ncs@debian:/opt/kubernetes/yaml/k8s/tcp/redis$ redis-cli  -c  -p  6379\n127.0.0.1:6379> auth 123456\nOK\n127.0.0.1:6379> ping\nPONG\n```\n\n>127.0.0.1 - 192.168.56.103:6379, 192.168.56.101:6379, 192.168.56.102:6379 - [19/Jul/2022:22:10:12 +0800] 200 0, 0, 82\n\n\n\n### ä¸é€šè¶…æ—¶\n\n![](/pics/k8s-redis-timeout.png)\n\n\n\n![](/pics/k8s-redis-c-set02.png)\n\næ ¹æ®podipå®šä½é›†ç¾¤pod\n\n```\ncs@debian:~/oss/hexo$  kubectl  get pod --field-selector status.podIP=121.21.35.3 -o wide -n devops\nNAME          READY   STATUS    RESTARTS   AGE   IP            NODE     NOMINATED NODE   READINESS GATES\nredis-app-1   1/1     Running   1          9d    121.21.35.3   node04   <none>           <none>\n```\n\n","tags":["redis","redis-cluster"],"categories":["linux","k8s"]},{"title":"redisé›†ç¾¤","url":"/services/database/redis/redis-cluster/","tags":["redis-cluster"],"categories":["services","database","redis"]},{"title":"mysqlé…ç½®æ–‡ä»¶","url":"/services/database/mysql/my/","content":"\n\n\n## linux\n\n### my.cnf\n\n```\n[mysqld]\n#server-id                      = 224\nuser = mysql\nport                           = 3305\nmysqlx_port                    = 33060\nmysqlx_socket                  = /tmp/mysqlx.sock\ndatadir                        = /opt/mysql/data\nsocket                         = /tmp/mysql.sock\npid-file                       = /tmp/mysqld.pid\nauto_increment_offset          = 2\nauto_increment_increment       = 2 \nlog-error                      = /opt/mysql/log/error.log\nslow-query-log                 = 1\nslow-query-log-file            = /opt/mysql/log/slow.log\nlong_query_time                = 0.2\nlog-bin                        = bin.log\nrelay-log                      = relay.log\nbinlog_format                 =ROW\nrelay_log_recovery            = 1\ncharacter-set-client-handshake = FALSE\ncharacter-set-server           = utf8mb4\ncollation-server               = utf8mb4_unicode_ci\ninit_connect                   ='SET NAMES utf8mb4'\ninnodb_buffer_pool_size        = 1G\njoin_buffer_size               = 128M\nsort_buffer_size               = 2M\nread_rnd_buffer_size           = 2M\nlog_timestamps                 = SYSTEM\nlower_case_table_names         = 1\ndefault-authentication-plugin  =mysql_native_password\n```\n\n\n\n\n\n## win\n\n### my.ini\n\n```\n[client]\nport=3306\n\n[mysql]\ndefault-character-set=utf8mb4\n\n\n[mysqld]\nport=3306\n#password=123456\n#character-set-client-handshake=FALSE  \ncharacter-set-server=utf8mb4 \n#collation-server = utf8mb4_general_ci  \ninit_connect='SET NAMES utf8mb4'\n\n\nbasedir=\"D:/360Downloads/mysql-5.7.20-winx64\"\n#Path to the database root\ndatadir=\"D:/360Downloads/mysql-5.7.20-winx64/data\"\n\nlog-error=\"D:/360Downloads/mysql-5.7.20-winx64/log/mysqld_err.log\"\n#log-bin=\"D:/360Downloads/mysql-5.7.20-winx64/log/mysqld_bin.bin\"\n\ndefault-storage-engine=INNODB\n#ä» 5.6å¼€å§‹ï¼Œtimestamp çš„é»˜è®¤è¡Œä¸ºå·²ç»æ˜¯ deprecated äº†\nexplicit_defaults_for_timestamp=true\n\nsql_mode=\"STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION\" \n\n```\n\n","tags":["mysql"],"categories":["services","database"]},{"title":"mysqlå®‰è£…","url":"/services/database/mysql/install/","content":"\n\n\n\n\n## linux\n\nä¸‹è½½  https://downloads.mysql.com/archives/community/\n\n**Compressed TAR Archive, Minimal Install** **ä¸åŒ…å«è°ƒè¯•å’Œæµ‹è¯•å·¥å…·**\n\n```\nxz -d mysql-8.0.28-linux-glibc2.17-x86_64-minimal.tar.xz\ntar -xvf mysql-8.0.28-linux-glibc2.17-x86_64-minimal.tar\n```\n\n\n\nç”¨æˆ·ç»„\n\n```\n# cs æ¢æˆmysql æˆ– ${USER}\nsudo groupadd mysql\nsudo useradd mysql -r -M -s /sbin/nologin\nsudo chown mysql:cs -R  /opt/mysql/*\n\n\ncs@debian:~/data/software$ cat /etc/group | grep mysql\nmysql:x:512:cs\ncs@debian:~/data/software$ cat /etc/passwd | grep mysql\nmysql:x:512:512::/home/mysql:/sbin/nologin\n```\n\n\n\nåˆå§‹åŒ–æ•°æ®åº“\n\n```\n$ sudo /opt/mysql/bin/mysqld  --initialize --user=mysql --console\n----2022-01-30T00:14:24.872326+08:00 6 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: bDB,fVSmt2/U\n```\n\n\n\n```\n url=/opt/mysql\n sed -n \"/^basedir=/s#=#==$url#\"p ./mysql.server\n sed -n \"/^datadir=/s#=#=$url/data#\"p ./mysql.server\n sed -n \"s#conf=.*#conf=$url/my.cnf#\"p ./mysql.server\n```\n\n\n\nå¼€æœºå¯åŠ¨\n\n```\nsudo cp /opt/mysql/support-files/mysql.server  /etc/init.d/mysql\nè®¾ç½®ä¸ºå¼€æœºè‡ªåŠ¨è¿è¡Œ\nsudo update-rc.d mysql defaults\nè®¾ç½®ä¸ºå–æ¶ˆå¼€æœºè‡ªåŠ¨è¿è¡Œ\nsudoÂ update-rc.dÂ -fÂ mysqlÂ remove\n```\n\nå¯†ç \n\n```\n##### ä¸´æ—¶å¯†ç ç™»å½•,æ‰§è¡Œè¯­å¥æç¤º You must reset your password using ALTER USER statement before executing this statement.\n--- alter user user() identified by \"123456\";  ##å¯†ç å­—ç¬¦ä¸²åŒå¼•å·\n\n---ä½äºç‰ˆæœ¬8---SET PASSWORD FOR root@localhost = '123456';\n---ç‰ˆæœ¬8ä»¥ä¸Š---ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '123456'; \n\n##ç”¨æˆ·å¯†ç è¿‡æœŸæ—¶é—´250å¤©\nALTER USER â€˜csâ€™@â€˜localhost' PASSWORD EXPIRE INTERVAL 250 DAY;\n###ç¦ç”¨è¿‡æœŸ     --æ¢å¤é»˜è®¤ç­–ç•¥ PASSWORD EXPIRE DEFAULT----\nALTER USER 'cs'@'localhost' PASSWORD EXPIRE NEVER;\n\n###å¯†ç è¿‡æœŸçš„ç­–ç•¥\nshow variables like 'default_password_lifetime';\n---è®¾ç½®å¯†ç æ°¸ä¸è¿‡æœŸï¼Œéœ€è¦æŠŠdefault_password_lifetimeä¿®æ”¹ä¸º 0\n---set global default_password_lifetime = 0;\n\n CREATE USER 'cs'@'localhost' IDENTIFIED BY '123456';\n\n\n###ä¿®æ”¹æ‰§è¡Œç”Ÿæ•ˆè¯­å¥\nflush privileges;\n```\n\n\n\n## win\n\n[ä¸‹è½½åœ°å€ï¼šhttp://dev.mysql.com/downloads/mysql/](http://dev.mysql.com/downloads/mysql/) \n\nç®¡ç†å‘˜æƒé™è¿è¡Œcmd\n\n```\nE:\\MySQL\\MySQL Server 5.7\\bin>mysqld install MySQL --defaults-file=\"E:\\MySQL\\MySQL Server 5.7\\my.ini\"\n```\n\ninstall/Remove of the Service Denied!  \n\n\n\n```\nbin>mysqld --initialize --user=mysql --console\n```\n\nå¯åŠ¨æœåŠ¡\n\n```\nnet start MySQL\n```\n\nåˆ é™¤  \n\n```\nsc delete MySQL\n```\n\n","tags":["install","mysql"],"categories":["services","database"]},{"title":"pipåŒ…ç®¡ç†","url":"/lang/python/pip/","content":"\n\n\n## å®‰è£…\n\n```\ncs@debian:~/oss/typoraCracker$ sudo apt-get install python3-pip\ncs@debian:~/oss/typoraCracker$ pip3 -V\npip 20.3.4 from /usr/local/lib/python3.5/dist-packages/pip (python 3.5)\n```\n\n\n\n## å‡çº§\n\n```\ncs@debian:~/oss/typoraCracker$ sudo pip3 install --upgrade pip\nCollecting pip\n  Downloading http://mirrors.aliyun.com/pypi/packages/27/79/8a850fe3496446ff0d584327ae44e7500daf6764ca1a382d2d02789accf7/pip-20.3.4-py2.py3-none-any.whl (1.5MB)\n    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1.5MB 5.8MB/s \nInstalling collected packages: pip\n  Found existing installation: pip 9.0.1\n    Not uninstalling pip at /usr/lib/python3/dist-packages, outside environment /usr\nSuccessfully installed pip-20.3.4\n```\n\n\n\n## å›½å†…æº\n\n```\n$ pip config set global.index-url https://mirrors.aliyun.com/pypi/simple/\nWriting to ~/.config/pip/pip.conf\n\n```\npip.ini\n\n```\n[global]\ntimeout = 6000\nindex-url = https://pypi.tuna.tsinghua.edu.cn/simple\ntrusted-host = pypi.tuna.tsinghua.edu.cn\n```\n\n\n\n## å¸è½½\n\n```\nsudo apt-get remove python3-pip\n```\n\n","tags":["pip"],"categories":["lang","python"]},{"title":"tomcatä¼˜åŒ–","url":"/services/container/tomcat/","content":"\n\n\n\n\n## jvmå‚æ•°\n\n\n\n```\nJAVA_OPTS=\"-server -XX:NewSize=256m -XX:MaxNewSize=256m -XX:PermSize=512M -XX:MaxPermSize=1024m -Xms2048m -Xmx2048m \"\n```\n\n\n\n>-Xmsï¼šJavaè™šæ‹Ÿæœºåˆå§‹åŒ–æ—¶å †çš„æœ€å°å†…å­˜ï¼Œä¸€èˆ¬ä¸ Xmxé…ç½®ä¸ºç›¸åŒå€¼ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯GCä¸å¿…å†ä¸ºæ‰©å±•å†…å­˜ç©ºé—´è€Œæ¶ˆè€—æ€§èƒ½ï¼›\n>\n>-Xmxï¼šJavaè™šæ‹Ÿæœºå¯ä½¿ç”¨å †çš„æœ€å¤§å†…å­˜ï¼›\n>\n>-XX:PermSizeï¼šJavaè™šæ‹Ÿæœºæ°¸ä¹…ä»£å¤§å°ï¼›\n>\n>-XX:MaxPermSizeï¼šJavaè™šæ‹Ÿæœºæ°¸ä¹…ä»£å¤§å°æœ€å¤§å€¼ï¼›\n>\n>-XX:NewSize=ï¼šæ–°ç”Ÿä»£ç©ºé—´åˆå§‹åŒ–å¤§å° \n>\n>-XX:MaxNewSize=ï¼šæ–°ç”Ÿä»£ç©ºé—´æœ€å¤§å€¼\n\n## é…ç½®ä¼˜åŒ–\n\n### è¿æ¥å±æ€§\n\n/tomcat-8.5.38/conf/server.xml\n\n\n\nhttps://tomcat.apache.org/tomcat-8.5-doc/config/executor.html\n\n```\n<Executor   name=\"tomcatThreadPool\"\n  namePrefix=\"req-thead-exc\"\n  maxHttpHeaderSize=\"8192\" \n  maxThreads=\"1000\"\n  minSpareThreads=\"75\"\n  maxQueueSize=\"Integer.MAX_VALUE\"\n  maxIdleTime=\"60000\"\n  threadPriority=\"5\"\n  className=\"org.apache.catalina.core.StandardThreadExecutor\"\n />\n```\n\n> maxThreads:  æœåŠ¡å™¨ç«¯æœ€ä½³çº¿ç¨‹æ•°é‡=((çº¿ç¨‹ç­‰å¾…æ—¶é—´+çº¿ç¨‹cpuæ—¶é—´)/çº¿ç¨‹cpuæ—¶é—´) * cpuæ•°é‡,å‹æµ‹è®¡ç®—,è¦æ’é™¤å•çº¯å¤„ç†ä¸šåŠ¡è€—æ—¶æ–¹æ³•,å¦‚æœæœªæŒ‡å®šï¼Œé»˜è®¤å€¼ä¸º200\n>\n> minSpareThreadsï¼šçº¿ç¨‹çš„æœ€å°è¿è¡Œæ•°ç›®ï¼Œè¿™äº›å§‹ç»ˆä¿æŒè¿è¡Œã€‚å¦‚æœæœªæŒ‡å®šï¼Œé»˜è®¤å€¼ä¸º10ã€‚\n>\n> maxHttpHeaderSizeï¼šè¯·æ±‚å’Œå“åº”çš„HTTPå¤´çš„æœ€å¤§å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½æŒ‡å®šã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œè¿™ä¸ªå±æ€§è¢«è®¾ç½®ä¸º8192ï¼ˆ8 KBï¼‰ã€‚\n\n\n\n\n\n```\nsed -i '/connectionTimeout=/i\\  executor=\"tomcatThreadPool\"' /opt/apache/tomcat-8.5.38/conf/server.xml \n\n<Connector port=\"8080\" protocol=\"HTTP/1.1\" \n  executor=\"tomcatThreadPool\"\n  connectionTimeout=\"20000\"   \n  redirectPort=\"8443\" />  \n```\n\n> connectionTimeoutä»£è¡¨è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’,é»˜è®¤å€¼ä¸º60000ã€‚é€šå¸¸æƒ…å†µä¸‹è®¾ç½®ä¸º30000ã€‚\n\nhttps://tomcat.apache.org/tomcat-8.5-doc/config/http.html\n\n\n\n###  cache\n\n/tomcat-8.5.38/conf/context.xml\n\ntomcat8ä»¥ä¸Šå¯¹resourceé‡‡å–äº†cacheï¼Œè€Œé»˜è®¤çš„å¤§å°æ˜¯10M\n\n\n\nconsider increasing the maximum size of the cache\n\n\n\n```\nsed -i '/^<\\/Context>/i\\<Resources cachingAllowed=\"true\"  cacheMaxSize=\"102400\" \\/>'  /opt/apache/tomcat-8.5.38/conf/context.xml\n```\n\n><Resources cachingAllowed=\"true\"  cacheMaxSize=\"102400\" />\n>\n>context.xmlæ–‡ä»¶å†…æ·»åŠ åˆ°<Context>èŠ‚ç‚¹å†…</Context>\n>\n>cacheMaxSizeå€¼æŒ‰éœ€è®¾ç½®,å•ä½K , ","tags":["tomcat"],"categories":["services","container"]},{"title":"apt","url":"/linux/debian/apt/","content":"\n\n\n## apt-get\n\n\n\nå‡çº§\n\n```\napt-get update\t\t\t   // æ›´æ–°æºæ–‡ä»¶ï¼Œå¹¶ä¸ä¼šåšä»»ä½•å®‰è£…å‡çº§æ“ä½œ \napt-get upgrade\t\t       // å‡çº§æ‰€æœ‰å·²å®‰è£…çš„åŒ… \n```\n\nå®‰è£…\n\n```\napt-get install packagename\t\t// å®‰è£…æŒ‡å®šçš„åŒ…\n```\n\næŸ¥è¯¢åŒ…\n\n```\napt-cache depends packagename   //è¯¥åŒ…ä¾èµ–å“ªäº›åŒ…\n```\n\nåˆ—å‡ºæ‰€æœ‰å·²ç»å®‰è£…\n\n```\napt list --installed\n```\n\n\n\nåˆ é™¤\n\n```\napt-get autoremove packagename --purge  //åˆ é™¤åŒ…åŠå…¶ä¾èµ–çš„è½¯ä»¶åŒ…+é…ç½®æ–‡ä»¶ç­‰\n```\n\n\n\næ¸…ç†\n\n```\napt-get clean \t\t\t\t\t\t// æ¸…ç†æ— ç”¨çš„åŒ…  \napt-get autoclean \t\t\t\t\t// æ¸…ç†æ— ç”¨çš„åŒ…  \napt-get check \t\t\t\t\t\t// æ£€æŸ¥æ˜¯å¦æœ‰æŸåçš„ä¾èµ–\n```\n\n\n\n## apt-mark æ ‡è®°\n\nç³»ç»Ÿä¸­ç¦ç”¨ Chrome æ›´æ–°\n\n```\ncs@debian:~$ sudo apt-mark  hold google-chrome-stable\ngoogle-chrome-stable è®¾ç½®ä¸ºä¿ç•™ã€‚\n```\n\n> auto\tæ ‡è®°æŒ‡å®šè½¯ä»¶åŒ…ä¸ºè‡ªåŠ¨å®‰è£…\n> manual\tæ ‡è®°æŒ‡å®šè½¯ä»¶åŒ…ä¸ºæ‰‹åŠ¨å®‰è£…\n> minimize-manual\tå°† meta åŒ…çš„æ‰€æœ‰ä¾èµ–é¡¹æ ‡è®°ä¸ºè‡ªåŠ¨å®‰è£…\n> hold\tæ ‡è®°æŒ‡å®šè½¯ä»¶åŒ…ä¸ºä¿ç•™ï¼ˆheld backï¼‰ï¼Œé˜»æ­¢è½¯ä»¶è‡ªåŠ¨æ›´æ–°\n> unhold\tå–æ¶ˆæŒ‡å®šè½¯ä»¶åŒ…çš„ä¿ç•™ï¼ˆheld backï¼‰æ ‡è®°ï¼Œè§£é™¤é˜»æ­¢è‡ªåŠ¨æ›´æ–°\n> showauto\tåˆ—å‡ºæ‰€æœ‰è‡ªåŠ¨å®‰è£…çš„è½¯ä»¶åŒ…\n> showmanual\tåˆ—å‡ºæ‰€æœ‰æ‰‹åŠ¨å®‰è£…çš„è½¯ä»¶åŒ…\n> showhold\tåˆ—å‡ºè®¾ä¸ºä¿ç•™çš„è½¯ä»¶åŒ…\n\n\n\ncentos\n\n```\necho 'exclude=google-chrome-stable' >> /etc/yum.conf\n```\n\n","tags":["apt"],"categories":["linux","debian"]},{"title":"å¼ºå¼±ç±»å‹è¯­è¨€","url":"/lang/sawtl/","content":"\n\n\n## å¼±ç±»å‹è¯­è¨€\n\næ˜¯ä¸€ç§å¼±ç±»å‹å®šä¹‰çš„è¯­è¨€,æŸä¸€ä¸ªå˜é‡è¢«å®šä¹‰ç±»å‹,è¯¥å˜é‡å¯ä»¥æ ¹æ®ç¯å¢ƒå˜åŒ–è‡ªåŠ¨è¿›è¡Œè½¬æ¢,ä¸éœ€è¦ç»è¿‡æ˜¾æ€§å¼ºåˆ¶è½¬æ¢ ä»£è¡¨js,php,lua\n\n\n\njs\n\n![](/pics/was-1.png)\n\n+æ“ä½œæ˜¯å°†Açš„ç±»å‹è½¬åŒ–ä¸ºäº†å­—ç¬¦ä¸²ï¼Œç„¶åè¿›è¡Œæ‹¼æ¥\n\n-æ“ä½œæ˜¯å°†Bçš„ç±»å‹è½¬åŒ–ä¸ºäº†æ•°å­—ï¼Œç„¶åè¿›è¡Œå‡æ³•\n\n\n\nlua\n\n```\n> a=5 \n> b=\"5\"\n> print(b+a)\n10.0\n> print(b-a)\n0.0\n> print(a==b)\nfalse\n\n```\n\n<!--more-->\n\n![](/pics/saw-2.png)\n\n\n\n## å¼ºç±»å‹è¯­è¨€\n\njava\n\n```\npublic class Main{\n    public static void main(String []args) {\n    int a=5;\n    String b=\"5\";\n       System.out.println(a+b);//55\n       // System.out.println(a-b);//ç¼–è¯‘ä¸é€šè¿‡,é”™è¯¯ï¼šäºŒå…ƒè¿ç®—ç¬¦â€œ-â€çš„æ“ä½œæ•°ç±»å‹é”™è¯¯\n    }\n} \n```\n\n\n\ngo\n\n```\npackage main\nvar a = 5\nvar b string = \"5\"\n\n\nfunc main(){\n    println(a+b) //æ— æ•ˆæ“ä½œï¼ša + bï¼ˆä¸åŒ¹é…çš„ç±»å‹ int å’Œ stringï¼‰\n    println(a-b) //æ— æ•ˆæ“ä½œï¼ša - bï¼ˆä¸åŒ¹é…çš„ç±»å‹ int å’Œ stringï¼‰\n}\n```\n\n","tags":["å¼ºå¼±ç±»å‹"],"categories":["lang"]},{"title":"mongodb","url":"/database/mongo/","content":"\n\n\n# linux ç¯å¢ƒ\n\n## ä¸‹è½½ \n\nwget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-debian81-3.4.4.tgz\n\n```\ntar zxvf mongodb*.tar\nmv /opt/mongo*  /opt\ncd /opt/mongodb*  && touch  mongodb.conf\n```\n\n## é…ç½®æ–‡ä»¶\n\n```\ndbpath=/home/cs/Download/mongodb/data #æ•°æ®åº“è·¯å¾„\nlogpath=/home/cs/Download/mongodb/data/logs/mongodb.log #æ—¥å¿—è¾“å‡ºæ–‡ä»¶è·¯å¾„\nlogappend=true #é”™è¯¯æ—¥å¿—é‡‡ç”¨è¿½åŠ æ¨¡å¼ï¼Œé…ç½®è¿™ä¸ªé€‰é¡¹åmongodbçš„æ—¥å¿—ä¼šè¿½åŠ åˆ°ç°æœ‰çš„æ—¥å¿—æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä»æ–°åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶\njournal=true #å¯ç”¨æ—¥å¿—æ–‡ä»¶ï¼Œé»˜è®¤å¯ç”¨\nquiet=true #è¿™ä¸ªé€‰é¡¹å¯ä»¥è¿‡æ»¤æ‰ä¸€äº›æ— ç”¨çš„æ—¥å¿—ä¿¡æ¯ï¼Œè‹¥éœ€è¦è°ƒè¯•ä½¿ç”¨è¯·è®¾ç½®ä¸ºfalse\nport=27017 #ç«¯å£å· é»˜è®¤ä¸º27017\n```\n\nå¯åŠ¨\n\n```\ncs@debian:/opt/mongodb-3.4.4/bin$ ./mongod  --config  /opt/mongodb-3.4.4/mongodb.conf\n```\n\n\nåå°è¿è¡Œ\n\n```\nmongo  -f   mongo.conf   & \n```\n\n\nä½¿ç”¨ fork å¿…é¡»åŠ ä¸Šlogpath\n\n```\nmongo   --fork  --logpath=log/mongodb.log   \n\n```\n\nå¤šæ¡å‘½ä»¤æ‰§è¡Œæ—¶ &&  å¯ä»¥æŠŠ forké…ç½®åˆ°conf\n\n\n```\necho   { \\\n                echo 'dbpath=/data/db'; \\\n                echo 'port=27017'; \\\n                echo 'logpath=/data/mongo.log'; \\\n                echo 'logappend=true'; \\\n                echo 'fork=true'; \\\n             } > mongod.conf  \n```\n\n\n\n## å¯åŠ¨\n\nmongo-start.sh\n\n```\n#!/bin/bash\ncd /opt/mongodb-3.4.4/bin \n./mongod  --config  /opt/mongodb-3.4.4/mongodb.conf  &\nexit\n!\n```\n\n\n\n# win ç¯å¢ƒ\n\nä¸‹è½½  http://dl.mongodb.org/dl/win32/x86_64\nzip å…å®‰è£…åŒ…\n\n\n\nå¯åŠ¨\n\n```\nE:\\MongoDB\\Server\\bin>mongod.exe --config  E:\\MongoDB\\mongo.conf\n```\n\nmongo.conf\n\n```\ndbpath=E:\\MongoDB\\data #æ•°æ®åº“è·¯å¾„\nlogpath=E:\\MongoDB\\logs\\mongodb.log #æ—¥å¿—è¾“å‡ºæ–‡ä»¶è·¯å¾„\nlogappend=true #é”™è¯¯æ—¥å¿—é‡‡ç”¨è¿½åŠ æ¨¡å¼ï¼Œé…ç½®è¿™ä¸ªé€‰é¡¹åmongodbçš„æ—¥å¿—ä¼šè¿½åŠ åˆ°ç°æœ‰çš„æ—¥å¿—æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä»æ–°åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶\njournal=true #å¯ç”¨æ—¥å¿—æ–‡ä»¶ï¼Œé»˜è®¤å¯ç”¨\nquiet=true #è¿™ä¸ªé€‰é¡¹å¯ä»¥è¿‡æ»¤æ‰ä¸€äº›æ— ç”¨çš„æ—¥å¿—ä¿¡æ¯ï¼Œè‹¥éœ€è¦è°ƒè¯•ä½¿ç”¨è¯·è®¾ç½®ä¸ºfalse\nport=27017 #ç«¯å£å· é»˜è®¤ä¸º27017\n```\n\næ‰“å¼€ http://127.0.0.1:27017/ \nIt looks like you are trying to access MongoDB over HTTP on the native driver port.\n\n## å®‰è£…æœåŠ¡\n\nç®¡ç†å‘˜cmd\nE:\\MongoDB\\Server\\bin>`mongod --install --serviceName \"MongoDB\" --config` \"E:\\MongoDB\\mongo.conf\"\nE:\\MongoDB\\Server\\bin>  `net  start MongoDB`  \n\n## åˆ é™¤æœåŠ¡\n\n`sc delete MongoDB`\n\n\n\n\n\nhttps://www.runoob.com/mongodb/mongodb-connections.html","tags":["mongodb"],"categories":["database"]},{"title":"singletonå•ä¾‹æ¨¡å¼","url":"/design-pattern/singleton/","content":"\n\n\n## æ‡’æ±‰  \n\n **ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶å®ä¾‹åŒ–**\n\n```\npublic class LHanDanli {\n//å®šä¹‰ä¸€ä¸ªç§æœ‰ç±»å˜é‡æ¥å­˜æ”¾å•ä¾‹ï¼Œç§æœ‰çš„ç›®çš„æ˜¯æŒ‡å¤–éƒ¨æ— æ³•ç›´æ¥è·å–è¿™ä¸ªå˜é‡ï¼Œè€Œè¦ä½¿ç”¨æä¾›çš„å…¬å…±æ–¹æ³•æ¥è·å–\nprivate static LHanDanli dl = null;\n//å®šä¹‰ç§æœ‰æ„é€ å™¨ï¼Œè¡¨ç¤ºåªåœ¨ç±»å†…éƒ¨ä½¿ç”¨ï¼Œäº¦æŒ‡å•ä¾‹çš„å®ä¾‹åªèƒ½åœ¨å•ä¾‹ç±»å†…éƒ¨åˆ›å»º\nprivate LHanDanli(){}\n//å®šä¹‰ä¸€ä¸ªå…¬å…±çš„å…¬å¼€çš„æ–¹æ³•æ¥è¿”å›è¯¥ç±»çš„å®ä¾‹ï¼Œç”±äºæ˜¯æ‡’æ±‰å¼ï¼Œéœ€è¦åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶ç”Ÿæˆå®ä¾‹ï¼Œæ‰€ä»¥ä¸ºäº†çº¿ç¨‹å®‰å…¨ï¼Œä½¿ç”¨synchronizedå…³é”®å­—æ¥ç¡®ä¿åªä¼šç”Ÿæˆå•ä¾‹\npublic static synchronized LHanDanli getInstance(){\nif(dl == null){\ndl = new LHanDanli();\n}\nreturn dl;\n}\n}\n```\n## åŒé‡åˆ¤æ–­  \n\nä¸ç”¨æ¯æ¬¡è·å–å¯¹è±¡éƒ½åŠ é”\nvolatile  å±è”½è™šæ‹Ÿæœºä»£ç ä¼˜åŒ–(ä»£ç æ‰§è¡Œé¡ºåº)ï¼Œè¿è¡Œæ•ˆç‡ä¼šæˆé—®é¢˜\n\n```\npublic class SLHanDanli {\nprivate static volatile SLHanDanli dl = null;\nprivate SLHanDanli(){}\npublic static SLHanDanli getInstance(){\nif(dl == null){\n          synchronized (SLHanDanli.class) {\n       if(dl == null){\n    dl = new SLHanDanli();\n}\n}\n }\nreturn dl;\n}\n}\n`\n\n```\n\n## é¥¿æ±‰   \n\nåŠ è½½ç±»å†…å°±å®ä¾‹åŒ–\n\n<!--more-->\n\n```\npublic class EHanDanli {\n//æ­¤å¤„å®šä¹‰ç±»å˜é‡å®ä¾‹å¹¶ç›´æ¥å®ä¾‹åŒ–ï¼Œåœ¨ç±»åŠ è½½çš„æ—¶å€™å°±å®Œæˆäº†å®ä¾‹åŒ–å¹¶ä¿å­˜åœ¨ç±»ä¸­\nprivate static EHanDanli dl = new EHanDanli();\n//å®šä¹‰æ— å‚æ„é€ å™¨ï¼Œç”¨äºå•ä¾‹å®ä¾‹\nprivate EHanDanli(){}\n//å®šä¹‰å…¬å¼€æ–¹æ³•ï¼Œè¿”å›å·²åˆ›å»ºçš„å•ä¾‹\npublic static EHanDanli getInstance(){\n    return dl;\n}\n}\n\n```\nä¼šæœ‰å ç”¨ç©ºé—´çš„é—®é¢˜å­˜åœ¨\n\n\n\n\n\n\n\n## é™æ€å†…éƒ¨ç±» \n\nç±»åŠ è½½æœºåˆ¶   åªæœ‰åœ¨è°ƒç”¨æ—¶ï¼Œæ‰ä¼šåŠ è½½å®ä¾‹ï¼Œ\né™æ€å®ä¾‹åŒ–``jvmçº¿ç¨‹å®‰å…¨``\n\n```\npublic class ClassInnerClassDanli {\n    public static class DanliHolder{\n        private static ClassInnerClassDanli dl = new ClassInnerClassDanli();\n    }\n    private ClassInnerClassDanli(){}\n        public static ClassInnerClassDanli getInstance(){\n                return DanliHolder.dl;\n        }\n    }\n}\n```\n","tags":["singleton"],"categories":["design-pattern"]},{"title":"å¸¸ç”¨è¯­æ³•","url":"/linux/k8s/docker1/","content":"\n\n\n\n\n```\n sudo  service docker status\n\n sudo service docker stop\n\n sudo service docker start\n```\n\n\n\n#### æœç´¢\n\n```\ndocker search Python\n\n```\n\n#### æ‹‰å–\n\n```\ndocker pull python:2.7\n\n```\n\n\n\n#### æŸ¥è¯¢\n\né•œåƒ  `image`\n\n```\ndocker images\n\n```\n\n\n\n å®¹å™¨ `container`\n\n```\ndocker ps  #run container\n\ndocker ps -a  #all container\n\n```\n\n##### æ—¥å¿—\n\n```\ndocker logs -f  <container or id>\n\n```\n\n##### å®¹å™¨ä¿¡æ¯\n\n```\ndocker inspect  <id>\n\n#æŸ¥çœ‹æŒ‡å®šä¿¡æ¯\ndocker inspect  <id>  --format '{{.Args}}'\n\ndocker inspect --format='{{.NetworkSettings.IPAddress}}' $CONTAINER_ID\n\n```\n\n<!--more-->\n\n#### è¿è¡Œ\n\nåˆ›å»ºé•œåƒ  å½“å‰è·¯å¾„ **.** è‹±æ–‡ç‚¹è¡¨ç¤º\n\n```\ndocker build -t  <é•œåƒå> <Dockerfileè·¯å¾„>\n\n```\n\nä¿®æ”¹åå­—,ç‰ˆæœ¬\n\n```\ndocker tag <IMAGE ID>  <åç§°:ç‰ˆæœ¬å·>\n\n```\n\nå®¹å™¨å®‰è£…ç¨‹åº\n\n```\ndocker run python:3.5.3 pip -V\n\n#æŒ‡å®šæºæ›´æ–°\ndocker run python:3.5.3 pip -i https://mirrors.aliyun.com/pypi/simple/ numpy\n\ndocker run <é•œåƒå> apt-get install -y <ç¨‹åº>  \n\n```\n\n`-y` äº¤äº’\n\n\n\n```\n# tomcat åå°è¿è¡Œ  p local port:container port     4452é•œåƒidå‰4ä½\n\n docker run -d -p 8080:8080 4452\n\n```\n\n ä¿å­˜å®¹å™¨\n\n```\ndocker commit  <id> <é•œåƒå:ç‰ˆæœ¬å·>\n\n```\n\n\n\n##### è¿›å…¥å®¹å™¨\n\n```\n# /bin/bash\ndocker run -i -t  python:3.5.3  /bin/bash\n\n```\n\n##### å…±äº«ç›®å½•\n\n```\ndocker run -it -v <å®¿ä¸»æœºç»å¯¹è·¯å¾„ç›®å½•>:<å®¹å™¨ç›®å½•>  <é•œåƒid>    /bin/bash\n\n```\n\n`-e` ç¯å¢ƒå˜é‡\n\n```\ndocker run  -e \"MYSQL_ROOT_PASSWORD=19930221\" -it 797e57bb4fea\n\n```\n\n#### åœæ­¢\n\n```\ndocker stop <CONTAINER ID>\n\n```\n\n#### åˆ é™¤\n\nè¦å…ˆåœæ­¢è¿è¡Œå®¹å™¨stop id\n\n```\ndocker rmi <tag>:<no>\n\n```\n\næ‰€æœ‰é•œåƒ\n\n```\ndocker rmi $(docker images  -q)\n\n```\n\n\n\næ‰€æœ‰å®¹å™¨\n\n```\ndocker rm $(docker ps -a -q)\n\n```\n\n#### è¿ç§»\n\nå¤‡ä»½\n\n```\ndocker save <é•œåƒå>  -o  ~/save.tar  \n\n```\n\nè¿˜åŸ\n\n```\ndocker load  -i  ~/docker/save.tar\n\n```\n\n\n\n**Ctrl + P + Q** é€€å‡ºå®¹å™¨\n\n\n\n\n\n#### æ€§èƒ½é™åˆ¶\n\n\n\nå®¹å™¨ä½¿ç”¨çŠ¶æ€\n\n```\ndocker stats  containerId  \n```\n\nk,b,m,gå†…å­˜\n\ndoc https://docs.docker.com/engine/reference/run/#runtime-constraints-on-resources\n\n\n\nnginxä»£ç†\n\n\n\n```\ntinkle-style-dev:\n  restart: always\n  ports:\n    - '18082:8080/tcp'\n  environment:\n    - TZ=Asia/Shanghai\n    - TERM=xterm\n  memswap_limit: 0\n  labels:\n    aliyun.scale: '1'\n  shm_size: 0\n  image: >-\n    registry-internal.cn-shenzhen.aliyuncs.com/tinkle/docker-registry:centos7-lite-1.0\n  memswap_reservation: 0\n  volumes:\n    - >-\n      /mnt/acs_mnt/nas/21ac64b65d/baopinghui/style-service:/app/0.0.1-SNAPSHOT/style-service/:rw\n    - '/home/data/tmpfile/style-service:/tmp:rw'\n    - /mnt/acs_mnt/nas/21ac64b65d/baopinghui/style-service/tinkle-style.conf:/etc/supervisor.conf.d/tinkle-style.conf:rw\n  kernel_memory: 0\n  mem_limit: 0\n```\n\n\n\n/tinkle-style-dev/docker-compose.yml  ä¸æŒ‡æ˜`container_name`å®¹å™¨å\n\n`docker-compose up -d` é»˜è®¤ tinkle-style-dev_tinkle-style-dev_1\n\n```\nupstream backend {\n    server tinkle-core-dev_tinkle-core-dev_1:8080;\n}\nupstream style{\n    server tinkle-style-dev_tinkle-style-dev_1:8080;\n}\nupstream ocr{\n    server tinkle-ocr-dev_tinkle-ocr-dev_1:8080;\n}\n log_format  main1  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"'\n                       '$upstream_addr $upstream_response_time $request_time ';\nserver {\n\tlisten       80;\n\tserver_name  api.baopinghui.com;\n\tcharset utf-8;\n\taccess_log  logs/host.access.log  main1;\n      \n      \n\tlocation / {\n\t\t#root   html;\n\t\t#index  index.html index.htm;\n\t\tif ( $request_uri ~* /fastNeuralStyleController ) {\n  \t\t\tproxy_pass http://style;\n\t\t }\n\t\tif ( $request_uri ~* /(style)/(.*) ){\n\t\t\tproxy_pass http://style/$2;\n\t\t}\n\t\tproxy_pass http://backend/;\n\t\tproxy_set_header   Host    $host;\n\t\tproxy_set_header   Cookie $http_cookie; \n\t\tproxy_set_header   X-Real-IP        $remote_addr;\n\t\tproxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;\n\t\tadd_header From localhost;\n\t\tproxy_cookie_path / /; \n\t}\n}\n```\n\n\n\n#### GPU\n\n\n\n```\nlspci | grep -i vga\n```\n\næ”¯æŒåˆ—è¡¨ https://developer.nvidia.com/cuda-gpus\n\nä¸‹è½½ http://www.geforce.cn/drivers\n\n\n\né©±åŠ¨ç‰ˆæœ¬\n\n```\ncat /proc/driver/nvidia/version\n```\n\næœ¬æœºæ˜¾å¡\n\n```\nls -l /dev/nvidia*\n```\n\n\n\n```\nsudo nvidia-smi\n```\n\n![](/pics/nvidia.png)\n\n\n\næ¸©åº¦\n\n```\nsudo nvidia-smi -q -d TEMPERATURE\n```\n\n10s ä¸€æ¬¡\n\n```\nwatch -n 10 nvidia-smi\n```\n\n\n\n\n\n```\nexport LD_LIBRARY_PATH=\"$LD_LIBRARY_PATH:/usr/local/cuda/lib64\"`\nexport CUDA_HOME=/usr/local/cuda`\n```\n\n> Check failed: s.ok() could not find cudnnCreate in cudnn DSO xxxxx undefined symbol: cudnnCreate\n\n\n\n\n\n#### é”™è¯¯\n\nNo `command` specified\n\n```\ndocker run -it   xidx  /bin/bash  -c \"ls\"\n```\n\n\n\nOCI runtime create failed: container_linux.go:344: starting container process caused \"exec: \\\"/bin/bash\\\": stat `/bin/bash: no such file or directory`\": unknown.  \n\n```\ndocker run -it   xidx  sh\n```\n\n\n\n","tags":["docker"],"categories":["linux","k8s"]},{"title":"sedæ›¿æ¢æŸ¥æ‰¾","url":"/linux/shell/sed/","content":"\n### å‚æ•°\n\n```\nsed [options] 'command' file(s) \n\nsed [options] -f scriptfile file(s)\n\n\ng è¡¨ç¤ºè¡Œå†…å…¨é¢æ›¿æ¢ã€‚Â Â  Â  global å…¨å±€ Â Â \np è¡¨ç¤ºæ‰“å°è¡Œã€‚ P æ‰“å°æ¨¡æ¿ç¬¬ä¸€è¡Œ\nr è¯»æ–‡ä»¶\n-n ï¼šä½¿ç”¨å®‰é™(silent)æ¨¡å¼ã€‚åœ¨ä¸€èˆ¬ sed çš„ç”¨æ³•ä¸­ï¼Œæ‰€æœ‰æ¥è‡ª STDIN çš„æ•°æ®ä¸€èˆ¬éƒ½ä¼šè¢«åˆ—å‡ºåˆ°ç»ˆç«¯ä¸Šã€‚ä½†å¦‚æœåŠ ä¸Š -n å‚æ•°åï¼Œåˆ™åªæœ‰ç»è¿‡sed ç‰¹æ®Šå¤„ç†çš„é‚£ä¸€è¡Œ(æˆ–è€…åŠ¨ä½œ)æ‰ä¼šè¢«åˆ—å‡ºæ¥ã€‚ \n-e ï¼šç›´æ¥åœ¨å‘½ä»¤åˆ—æ¨¡å¼ä¸Šè¿›è¡Œ sed çš„åŠ¨ä½œç¼–è¾‘ï¼› \n-f ï¼šç›´æ¥å°† sed çš„åŠ¨ä½œå†™åœ¨ä¸€ä¸ªæ–‡ä»¶å†…ï¼Œ -f filename åˆ™å¯ä»¥è¿è¡Œ filename å†…çš„ sed åŠ¨ä½œï¼›\n-r ï¼šsed çš„åŠ¨ä½œæ”¯æŒçš„æ˜¯å»¶ä¼¸å‹æ­£è§„è¡¨ç¤ºæ³•çš„è¯­æ³•ã€‚(é»˜è®¤æ˜¯åŸºç¡€æ­£è§„è¡¨ç¤ºæ³•è¯­æ³•) -i ï¼šç›´æ¥ä¿®æ”¹è¯»å–çš„æ–‡ä»¶å†…å®¹ï¼Œè€Œä¸æ˜¯è¾“å‡ºåˆ°ç»ˆç«¯  Â \nÂ w è¡¨ç¤ºæŠŠè¡Œå†™å…¥ä¸€ä¸ªæ–‡ä»¶ã€‚\nÂ x è¡¨ç¤ºäº’æ¢æ¨¡æ¿å—ä¸­çš„æ–‡æœ¬å’Œç¼“å†²åŒºä¸­çš„æ–‡æœ¬ã€‚\nÂ y è¡¨ç¤ºæŠŠä¸€ä¸ªå­—ç¬¦ç¿»è¯‘ä¸ºå¦å¤–çš„å­—ç¬¦ï¼ˆä½†æ˜¯ä¸ç”¨äºæ­£åˆ™è¡¨è¾¾å¼ï¼‰\n \\1 å­ä¸²åŒ¹é…æ ‡è®°Â \n& å·²åŒ¹é…å­—ç¬¦ä¸²æ ‡è®°å…ƒå­—ç¬¦é›†\n^ åŒ¹é…è¡Œå¼€å§‹ï¼Œå¦‚ï¼š/^sed/åŒ¹é…æ‰€æœ‰ä»¥sedå¼€å¤´çš„è¡Œã€‚Â \n$ åŒ¹é…è¡Œç»“æŸï¼Œå¦‚ï¼š/sed$/åŒ¹é…æ‰€æœ‰ä»¥sedç»“å°¾çš„è¡Œã€‚\nÂ . åŒ¹é…ä¸€ä¸ªéæ¢è¡Œç¬¦çš„ä»»æ„å­—ç¬¦ï¼Œå¦‚ï¼š/s.d/åŒ¹é…såæ¥ä¸€ä¸ªä»»æ„å­—ç¬¦ï¼Œæœ€åæ˜¯dã€‚\nÂ * åŒ¹é…0ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ï¼Œå¦‚ï¼š/*sed/åŒ¹é…æ‰€æœ‰æ¨¡æ¿æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ ¼åç´§è·Ÿsedçš„è¡Œã€‚\nÂ [] åŒ¹é…ä¸€ä¸ªæŒ‡å®šèŒƒå›´å†…çš„å­—ç¬¦ï¼Œå¦‚/[ss]ed/åŒ¹é…sedå’ŒSedã€‚\nÂ [^] åŒ¹é…ä¸€ä¸ªä¸åœ¨æŒ‡å®šèŒƒå›´å†…çš„å­—ç¬¦ï¼Œå¦‚ï¼š/[^A-RT-Z]ed/åŒ¹é…ä¸åŒ…å«A-Rå’ŒT-Zçš„ä¸€ä¸ªå­—æ¯å¼€å¤´ï¼Œç´§è·Ÿedçš„è¡Œã€‚\nÂ \\(..\\) åŒ¹é…å­ä¸²ï¼Œä¿å­˜åŒ¹é…çš„å­—ç¬¦ï¼Œå¦‚s/\\(love\\)able/\\1rsï¼Œloveableè¢«æ›¿æ¢æˆloversã€‚\nÂ & ä¿å­˜æœç´¢å­—ç¬¦ç”¨æ¥æ›¿æ¢å…¶ä»–å­—ç¬¦ï¼Œå¦‚s/love/**&**/ï¼Œloveè¿™æˆ**love**ã€‚\nÂ \\< åŒ¹é…å•è¯çš„å¼€å§‹ï¼Œå¦‚:/\\Â åŒ¹é…å•è¯çš„ç»“æŸï¼Œå¦‚/love\\>/åŒ¹é…åŒ…å«ä»¥loveç»“å°¾çš„å•è¯çš„è¡Œã€‚\nÂ x\\{m\\} é‡å¤å­—ç¬¦xï¼Œmæ¬¡ï¼Œå¦‚ï¼š/0\\{5\\}/åŒ¹é…åŒ…å«5ä¸ª0çš„è¡Œã€‚\nÂ x\\{m,\\} é‡å¤å­—ç¬¦xï¼Œè‡³å°‘mæ¬¡ï¼Œå¦‚ï¼š/0\\{5,\\}/åŒ¹é…è‡³å°‘æœ‰5ä¸ª0çš„è¡Œã€‚\nÂ x\\{m,n\\} é‡å¤å­—ç¬¦xï¼Œè‡³å°‘mæ¬¡ï¼Œä¸å¤šäºnæ¬¡ï¼Œå¦‚ï¼š/0\\{5,10\\}/åŒ¹é…5~10ä¸ª0çš„è¡Œã€‚\n```\n\n \n\n### æ‰¹é‡æ›¿æ¢\n\næŠŠç›®å½•ä¸‹æ‰€æœ‰æ ¼å¼æ–‡ä»¶å†…å®¹è¿›è¡Œæ‰¹é‡æ›¿æ¢\n\n```shell\nsed -n \"s#$src#$dest#g\"p `grep $src -rl --include=\\*.{yaml,md} $path`\n```\n\n>æ‰«æpathè·¯å¾„å¯¹åº”æ ¼å¼çš„æ–‡ä»¶,æŠŠsrcæ›¿æ¢æˆdest,\n\n>**sed** \n>\n>-n p  ç»“åˆæ‰“å°æ”¹å˜å†…å®¹,ä¸æ‰§è¡Œå˜æ›´\n>\n>**grep**\n>\n>-r è¡¨ç¤ºæŸ¥æ‰¾å½“å‰ç›®å½•ä»¥åŠæ‰€æœ‰å­ç›®å½•\n>\n>-l è¡¨ç¤ºä»…åˆ—å‡ºç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶å\n>\n>--include=\"*.[ch]\" è¡¨ç¤ºä»…æŸ¥æ‰¾.cã€.hæ–‡ä»¶\n>\n>ä¸Šé¢ä¸é€‚ç”¨å¤§å¤šæ•°æƒ…å†µ,æ¨èä¸‹é¢\n>\n>--include=*.{yaml,md}\n\n<!--more-->\n\nâ€‹           \n\næ ·æœ¬1 test.txt   (cat -n æ˜¾ç¤ºè¡Œå·)\n\n```\n111111111 \n222222222   \n```\n\n \n\n#### **a\\ ** è¿½åŠ \n\nåœ¨å½“å‰è¡Œä¸‹é¢æ’å…¥æ–‡æœ¬ã€‚  append  è¿½åŠ \n\nN;2a  æŒ‡å®šç¬¬äºŒè¡Œåè¿½åŠ append\n\n```shell\ncs@debian:~/ï½$ sed -i 'N;2aè¿™æ˜¯a' test.txt \ncs@debian:~/ï½$ cat -n test.txt    \n1\t11111111    \n2\t22222222    \n3\tè¿™æ˜¯a      \n```\n\nâ€‹        \n\n/åŒ¹é…/  ä¸ç¡®å®šè¡Œæ•° a\\ **åæ–œæ å¯ä»¥ä¸è¦** a\n\n```shell\n cs@debian:~/ï½$ sed -i \"/è¿™æ˜¯a/a\\åŒ¹é…è¿½åŠ \" test.txt \n cs@debian:~/ï½$ cat -n test.txt    \n 1\tè¿™æ˜¯i    \n 2\t11111111    \n 3\t22222222    \n 4\tè¿™æ˜¯a    \n 5  åŒ¹é…è¿½åŠ       \n```\n\nâ€‹        \n\n####  **i\\ **  æ’å…¥\n\nåœ¨å½“å‰è¡Œä¸Šé¢æ’å…¥æ–‡æœ¬ã€‚ insert æ’å…¥\n\n N;2i æŒ‡å®šç¬¬äºŒè¡Œå‰æ’å…¥insert  'N;2i\\è¿™æ˜¯i' ï¼ˆ\\çœç•¥ï¼‰\n\n```\ncs@debian:~/ï½$ sed -i 'N;2iè¿™æ˜¯i' test.txt\ncs@debian:~/ï½$ cat -n test.txt    \n1\tè¿™æ˜¯i    \n2\t11111111    \n3\t22222222    \n```\n\nâ€‹          \n\n/åŒ¹é…/  ä¸ç¡®å®šè¡Œæ•°\n\n```\ncs@debian:~/ï½$ sed -i \"/è¿™æ˜¯i/i\\åŒ¹é…æ’å…¥\" test.txt \ncs@debian:~/ï½$ cat -n test.txt    \n1\tåŒ¹é…æ’å…¥    \n2\tè¿™æ˜¯i    \n3\t11111111    \n4\t22222222    \n5\tè¿™æ˜¯a      \n```\n\nâ€‹        \n\nåŒ¹é…å¤šä¸ª---ã€‹ æ‰¹é‡æ’å…¥\n\n```\n cs@debian:~/ï½$ sed -i \"/è¿™æ˜¯/i\\åŒ¹é…å¤šä¸ª\" test.txt \n cs@debian:~/ï½$ cat -n test.txt    \n 1\tåŒ¹é…å¤šä¸ª    \n 2\tè¿™æ˜¯i    \n 3\t11111111    \n 4\t22222222    \n 5\tåŒ¹é…å¤šä¸ª    \n 6\tè¿™æ˜¯a   \n```\n\nâ€‹           \n\n c\\ æŠŠé€‰å®šçš„è¡Œæ”¹ä¸ºæ–°çš„æ–‡æœ¬ã€‚ \n\n\n\n#### d åˆ é™¤\n\nåˆ é™¤é€‰æ‹©çš„è¡Œã€‚\n\nç¡®å®šè¡Œæ•°\n\n```\ncs@debian:~/ï½$  sed '2,5d' test.txt\n```\n\n> #2-5è¡Œåˆ é™¤  \n>\n>  '2d' ç¬¬2è¡Œ\n>\n>   '10,$d' 10åˆ°æœ€åä¸€è¡Œ\n\nâ€‹             \n\nåŒ¹é…åˆ é™¤ åˆ é™¤åŒ¹é…ä¸‹ä¸€è¡Œ  dåˆ é™¤ pæ‰“å°  #åŠ  -i ç›´æ¥ä¿®æ”¹ \n\n\n\næ ·æœ¬2\n\n```\ncs@debian:~/ï½$ cat -n test.txt     \n1\t11111111     \n2\tè¿™æ˜¯i     \n3\t22222222     \n4\tè¿™æ˜¯a     \n5\t33333333             \n```\n\n\n\n#### n N p\n\n```shell\ncs@debian:~/ï½$ sed '/è¿™æ˜¯i/{n;d;p}' test.txt\n11111111 Â  Â  \nè¿™æ˜¯i Â  Â  \nè¿™æ˜¯a Â  Â  \n33333333\ncs@debian:~/ï½$ sed '/è¿™æ˜¯i/{N;d;p}' test.txt \n11111111 Â  Â  \nè¿™æ˜¯a Â  Â  \n33333333\n```\n\n>nåŒ¹é…ä¸‹ä¸€è¡Œ  \n>\n>NåŒ¹é…å½“å‰è¡Œå’Œä¸‹ä¸€è¡Œ\n\n\n\nnå‘½ä»¤-->ç§»åŠ¨åˆ°åŒ¹é…è¡Œçš„ä¸‹ä¸€è¡Œ  {n;æ“ä½œ;}\n\n```\n$ sed -i '/^ZOOKEEPER_PREFIX/{n;s#$#JAVA_HOME=/opt/jdk/jdk-11.0.12#;}' ./zkEnv.sh\n```\n\n>ZOOKEEPER_PREFIX=\"${ZOOBINDIR}/..\"\n>\n>JAVA_HOME=/opt/jdk/jdk-11.0.12\n>\n>#check to see if the conf dir is given as an optional argument\n\n\n\nä¸Šä¸€è¡Œ (æä¾›å¤šçš„ç‰¹å¾åŒ¹é…)\n\n```\nsed -n '/^if.*JAVA_HOME/i\\JAVA_HOME=/opt/jdk/jdk-11.0.12' ./zkEnv.sh \n```\n\n>JAVA_HOME=/opt/jdk/jdk-11.0.12\n>\n>if [[ -n \"$JAVA_HOME\" ]] && [[ -x \"$JAVA_HOME/bin/java\" ]];  then\n>\n>â€‹    JAVA=\"$JAVA_HOME/bin/java\"\n>\n>elif type -p java; then\n\n\n\n\n\n N å°†ä¸‹ä¸€è¡Œè¯»å…¥å¹¶é™„åŠ åˆ°å½“å‰è¡Œåé¢æ”¾åˆ°å½“å‰ç©ºé—´æ¨¡å¼\n\n æœ€åä¸€è¡Œç»“æŸ\n\n```shell\ncs@debian:~/ï½$ echo -e \"11111\\n2222222\\n3333\" | sed 'N;p'\n11111\n2222222\n11111\n2222222\n333\n```\n\n\n\n Pæ¨¡å¼ç©ºé—´ç¬¬ä¸€è¡Œ Nå†æ¬¡æ‰§è¡Œå°±åˆ°äº†3 ï¼Œéš”è¡Œ  \n\n```shell\ncs@debian:~/ï½$ echo -e \"11111\\n2222222\\n3333\\n44\\n55\\n6\" | sed 'N;P'\n1111111111\n2222222\n33333333\n44\n5555\n6\n```\n\n\n\n```\ncs@debian:~$ cat /etc/hosts\n127.0.0.1\tlocalhost\n192.168.56.1  master01 ui.k8s.cn k8s.org jenkins.k8s.cn  gogs.k8s.cn\n192.168.56.101  node01\n192.168.56.108  node02 \ncs@debian:/ip$ ip=192.168.56.108\ncs@debian:/ip$ cat hosts | sed -e  \"s/^\\(${ip}\\)\\([[:space:]]*\\)\\(.*\\)/\\3/g\" p\nnode01\n```\n\n\n\n```\ncs@debian:/ip$ ip=node02\ncs@debian:/ip$ cat hosts | sed -n \"s/\\(.*\\)\\([[:space:]]*\\)\\(${ip}\\)/\\1/g\"p\n192.168.56.108  \n```\n\n\n\n```shell\nzookeeper.connect=localhost:2181\n cat ./config/server.properties | sed -n 's/^zookeeper\\.connect=\\(.*\\)/\\1/'p\nlocalhost:2181\ncat ./config/server.properties | sed -n \"s#^listeners=PLAINTEXT://\\(.*\\)#\\1#\"p\n127.0.0.1:9092\n```\n\n\n\nâ€‹         \n\n\n\n####  D\n\n åˆ é™¤æ¨¡æ¿å—çš„ç¬¬ä¸€è¡Œã€‚\n\n\n\n####  s æ›¿æ¢\n\ns/æŒ‡å®šå­—ç¬¦/æ›¿æ¢å­—ç¬¦/\n\nrelative/directory/  æ”¹ä¸º/etc/supervisor.conf.d/\n\n```shell\ncs@debian:~/ï½$ sed -n Â  's/relative\\/directory\\//\\/etc\\/supervisor.conf.d\\//'p /etc/supervisord.conf\n```\n\n> -né€‰é¡¹å’Œpå‘½ä»¤ä¸€èµ·ä½¿ç”¨è¡¨ç¤ºåªæ‰“å°å‘ç”Ÿæ›¿æ¢çš„è¡Œ\n\n  \n\n é˜²ç«å¢™å…³é—­\n\n```\ncat /etc/selinux/config | grep ^SELINUX= | sed  's/^SELINUX=.*/SELINUX=disabled/'\nsed -i '/SELINUX/s/enforcing/disabled/' /etc/selinux/config\n```\n\n\n\næ›¿æ¢æ•´è¡Œ\n\n  ```shell\ncs@debian:~/ï½$  sed  -i  '2s/^.*$/xxxxx/'  file  \n  ```\n\n\n\n\n\n#### æˆªå– \n\n```shell\ncs@debian:~/ï½$ echo \"tinkle-app-style-0.0.1-SNAPSHOT.jar\" | sed 's/\\([a-z]-*\\)-[0-9].*/\\1/'\n```\n\n\n\n```shell\ncs@debian:~/ï½$  echo \"abcdef-shea-df\" | sed 's/\\(.*\\)-\\(.*\\)-\\(.*\\)/\\2/g'\nå‘½ä»¤è§£é‡Š\n\\(.*\\)- : è¡¨ç¤ºç¬¬ä¸€ä¸ªå¼•å·å‰çš„å†…å®¹\n-\\(.*\\)-ï¼šè¡¨ç¤ºä¸¤å¼•å·ä¹‹é—´çš„å†…å®¹\n-\\(.*\\)ï¼šè¡¨ç¤ºå¼•å·åçš„å†…å®¹\n\\2: è¡¨ç¤ºç¬¬äºŒå¯¹æ‹¬å·é‡Œé¢çš„å†…å®¹\næ‹¬å·é‡Œçš„è¡¨è¾¾å¼åŒ¹é…çš„å†…å®¹ï¼Œå¯ä»¥ç”¨\\1ï¼Œ\\2ç­‰è¿›è¡Œå¼•ç”¨ï¼Œç¬¬nä¸ªæ‹¬å·å¯¹å†…çš„å†…å®¹ï¼Œå°±ç”¨\\nå¼•ç”¨ã€‚\nè¿™ä¸ªå‘½ä»¤çš„æ„æ€æ˜¯ï¼š\nç”¨\\2ä»£è¡¨çš„ç¬¬äºŒä¸ªæ‹¬å·çš„å†…å®¹ï¼ˆsheaï¼‰å»æ›¿æ¢æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™æ ·å°±å¾—åˆ°äº†æˆ‘ä»¬æ‰€éœ€è¦çš„å­å­—ç¬¦ä¸²äº†ã€‚\n```\n\n\n\n```shell\ncs@debian:~$ echo \"etch-master.sh\" | sed 's/\\(.*\\)-\\(.*\\)\\.\\(.*\\)/\\2/g'\nmaster\ncs@debian:~$ echo \"gen-flanneld.sh\" | sed 's/^gen-\\(.*\\)\\..*/\\1/g'\nflanneld\n```\n\n\n\n```shell\ncs@debian:~$ systemctl status flanneld.service\nâ— flanneld.service - Flanneld overlay address etcd agent\n   Loaded: loaded (/opt/kubernetes/flanneld/flanneld.service; disabled; vendor p\n   Active: inactive (dead)\ncs@debian:~$ systemctl status flanneld.service | grep Active: | sed 's/.*(\\([a-z]*\\)).*/\\1/g'\ndead\ncs@debian:~$ systemctl status nginx | grep Active | sed 's/.*(\\(.*\\)).*/\\1/g'\nrunning\ncs@debian:~$ systemctl status kube-scheduler  |  sed -n 's/.*ctive:.*(\\(.*\\)).*/\\1/g'p\ndead\n```\n\n\n\n### æ ‡è®°è·³è½¬\n\nåˆ é™¤å‰ä¸€è¡Œ  (:a  ;ta) aæ ‡è®°ï¼Œtaæ‰§è¡ŒæˆåŠŸåœ¨è·³è½¬ï¼Œç±»ä¼¼å¾ªç¯\n\n   ```shell\ncs@debian:~/ï½$ sed -e :a -e '$!N;s/.*\\n\\(.*æ˜¯.*\\)/\\1/;ta' -e 'P;D' Â test.txt\nè¿™æ˜¯i\nè¿™æ˜¯a\n33333333 \n   ```\n\n\n\nå‰ç½® s/æ­£åˆ™/\\1/    $æœ€åä¸€è¡Œ ï¼ä¸è¿›è¡Œ \n\n```shell\ncs@debian:~/ï½$ sed -e Â  '$!N;s/.*\\n\\(.*æ˜¯i\\)/\\1/' -e 'p;d' Â test.txt\nè¿™æ˜¯i\n22222222\nè¿™æ˜¯a\n33333333\ncs@debian:~/ï½$ sed -e Â  '$!N;s/.*\\n\\(.*æ˜¯i\\)/\\1/' -e 'P;D' Â test.txt\nè¿™æ˜¯i\n22222222\nè¿™æ˜¯a\n33333333\ncs@debian:~/ï½$ sed -e :a -e '$!N;s/.*\\n\\(.*æ˜¯.*\\)/\\1/;ta' -e 'P;D' Â test.txt\nè¿™æ˜¯i\nè¿™æ˜¯a\n33333333\n```\n\n\n\n\n\ntest\n\n```\n3d5f\n<Proxy>\nè¿™æ˜¯i\n<P>\n22222222\n</Proxy>\nabcde\n```\n\næ›¿æ¢Proxy æ ‡ç­¾ä¸­é—´éƒ¨åˆ†\n\n```shell\nsed '/<P/{:a;N;/<\\//!ba;s/>[^<].*</>\\næ›¿æ¢ä½ ä»¬\\n</}' Â test\n\n<p Â :a;N;/<\\//!ba\nåŒ¹é…<Proxy Â :aæ ‡è®° Â </ ç»“æŸåŒ¹é…æ ‡è®° Â !b ï¼ˆåŒ¹é…ä¸äº†ï¼Œæ‰§è¡Œä¸‹å¥å‘½ä»¤ï¼‰\ns/>[^<]*</>\\n1234567\\n</\n>æŠŠä¸­é—´å†…å®¹< Â æ›¿æ¢æŒ‡å®šå†…å®¹\n```\n\n\n\n\n\n\n\n\n\n### æ³¨é‡Š       \n\njoin.yaml\n\n```\n#kind: JoinConfiguration\n\nnodeRegistration:\n  name: debian  #èŠ‚ç‚¹å,masterè¦èƒ½è§£æ\n```\n\n#### æ·»åŠ \n\n```\nsed -n '/debian/s/^/#/'p ./join.yaml\n```\n\n> \\#  name: debian  #èŠ‚ç‚¹å,masterè¦èƒ½è§£æ\n\n```\nsed -n 's/debian/#&/'p ./join.yaml\n```\n\n>  name: #debian  #èŠ‚ç‚¹å,masterè¦èƒ½è§£æ\n\n\n\n```\ncs@debian:~$ cat /etc/fstab | grep swap | sed '/swap/s/^/#/' \n## swap was on /dev/sda5 during installation\n##UUID=0fd6cee8-fdfa-459b-a7c6-1898ea2ade8e none            swap    sw              0       0\n[vagrant@master03 ~]$ cat /etc/fstab | grep swap | sed '/swap/s/^/#/' \n##/swapfile none swap defaults 0 0\n```\n\n\n\n```\nsed -i '/åŒ¹é…å­—ç¬¦ä¸²/,+4 s/^/#/' æ–‡ä»¶å   #åŒ¹é…è¡Œå’Œä¸‹é¢4è¡Œ\n```\n\n> +4è¡¨ç¤ºåŒ¹é…è¡Œå’Œä¸‹é¢4è¡Œï¼Œä¸€å…±5è¡Œæ³¨é‡Š\n\n\n\n\n\n#### åˆ é™¤\n\n```\n#å»æ‰æ‰€æœ‰è¡Œæ³¨é‡Š\nsed -n '/^#.*$/s/^#//'p ./join.yaml\n#å»åŒ¹é…è¡Œæ³¨é‡Š\nsed -n '/^#.*debian.*$/s/^#//'p ./join.yaml\n```\n\n>  name: debian  #èŠ‚ç‚¹å,masterè¦èƒ½è§£æ\n\n\n\n```shell\nsed 's/^#.*\\(en_US.UTF-8\\)/\\1/' test\n```\n\n\n\n\n\n```\n#å»æ³¨é‡Šè¡Œ\nsed -i '/^#/d' ./join.yaml\n#å»ç©ºè¡Œå’Œæ³¨é‡Šè¡Œ\nsed -i '/^$/d;/^#/' ./join.yaml\n```\n\n\n\n```\nsed -i '/åŒ¹é…å­—ç¬¦ä¸²/,+4 s/^#*//' æ–‡ä»¶å\n\n[vagrant@node06 ~]$ grep 'HOME'  /etc/profile\nexport JAVA_HOME=/opt/mq/jre\nexport CLASSPATH=.:${JAVA_HOME}/lib\nexport PATH=${JAVA_HOME}/bin:$PATH\n# echo $(sed -n  '/export\\ JAVA_HOME/,+2 s/export/#/'p /etc/profile)\n# sed -i '/export\\ JAVA_HOME/,+2 s/export/#/' /etc/profile\n```\n\n","tags":["sed"],"categories":["linux","shell"]},{"title":"ç£ç›˜æˆ–Inodeä½¿ç”¨ç‡é«˜","url":"/linux/shell/usage_high/","content":"\n\n\n## Inode\n\n**ä¸€ä¸ªæ–‡ä»¶å ç”¨ä¸€ä¸ªinode ï¼Œä¸”inodeæ˜¯å›ºå®šçš„ï¼Œå°æ–‡ä»¶è¿‡å¤šå°±å¯èƒ½é€ æˆç£ç›˜ç©ºé—´å‰©ä½™æŒºå¤šï¼Œä½†æ˜¯inodeè€—å°½çš„æƒ…å†µã€‚**\n\n### df -i\n\næŸ¥çœ‹å½“å‰ç³»ç»Ÿinodeä½¿ç”¨æƒ…å†µ\n\n\n\n![](/pics/inode-1-2848.png)\n\nä¸€çº§ä¸€çº§å¾€ä¸‹ï¼Œç»Ÿè®¡inodeæ–‡ä»¶æ•°é‡ã€‚æ•°å­—å¤§å°±è¡¨ç¤ºå ç”¨inodeå¤š\n\n<!--more-->\n\nå¦‚æœå‘½ä»¤åœ¨é‚£ä¸ªç›®å½•å¡ä½,è¡¨ç¤ºè¯¥ç›®å½•,æ–‡ä»¶ç‰¹å¤š,ctrl+cåœæ­¢,ä»è¯¥ç›®å½•å¼€å§‹æ’æŸ¥\n\n![](/pics/inode-3-4837.png)\n\n\n\n### wc  -l \n\n```\nfor i in /home/* ; do echo $i; find $i | wc -l; done\n```\n\n![](/pics/inode-2-4723.png)\n\nåˆ é™¤\n\n```\n find  /home/go/test/  -maxdepth 1  -type f   -mtime +0   -exec  rm  -rf  {} \\;\n```\n\n>+1 å†…è¡¨ç¤º 1 * 24 +24å°æ—¶ä»¥å¤–..\n>+0 æ‰è¡¨ç¤º 0 * 24 +24å°æ—¶ä»¥å¤–\n>1 è¡¨ç¤º 1*24 + 24 åˆ° 24 ä¹‹é—´..\n>0 è¡¨ç¤º 0*24 + 24 åˆ° 0 ä¹‹é—´..\n\n\n\nä¿®æ”¹å¤§å°\n\n```\n#å¸è½½\numount /home/cs/go \n#å»ºç«‹æ–‡ä»¶ç³»ç»Ÿï¼ŒæŒ‡å®šinodeèŠ‚ç‚¹æ•° \nmkfs.ext3 /dev/sda6 -N 18276352 \n#ä¿®æ”¹fstabæ–‡ä»¶ \nvim /etc/fstab \n/dev/sda6 /home/cs/go ext3 defaults 1 2 \n#é‡æ–°åŠ è½½å¹¶æ£€æŸ¥æŒ‚è½½æ–‡ä»¶ \nmount -a \n#æŸ¥çœ‹ä¿®æ”¹åçš„inodeå‚æ•° \ndumpe2fs -h /dev/sda6 | grep node\n\n```\n\n\n\n\n\nå¤šæ ¸cpuç”Ÿæˆç™¾ä¸‡æ–‡ä»¶\n\n```\ncd ~/go/test\nseq 1000000 | xargs -i  -P 0 dd if=/dev/urandom of={}.txt bs=1024 count=1\n```\n\n\n\n## disk\n\n### df  -h\n\næ’æŸ¥ç›®å½•\n\ndu -sh * | sort  -nr | head -5\n\n\n\næŸ¥æ‰¾å¤§äº1Gçš„æ–‡ä»¶\n\n```console-bash\nfind /  -type f -size +1G\n```\n\n\n\n æ²¡æœ‰å¤§æ–‡ä»¶,æŸ¥çœ‹å·²ç»åˆ é™¤çš„æ–‡ä»¶\n\n```\nlsof -n |grep deleted\n```\n\nåˆ é™¤çš„æ–‡ä»¶æœ‰ç¨‹åºåœ¨ä½¿ç”¨,ä¸€ç›´æ²¡æœ‰é‡Šæ”¾æ‰,killæ‰pid\n\n\n\n## cpu\n\nps -aux | sort -k3nr | head -5\n\n\n\n### top  \n\n shift+p    åˆ‡åˆ°cpuæ’åºé«˜åˆ°ä½\n\n### tid\n\nps -Lfp pidæˆ–è€…ps -mp pid -o THREADï¼Œtidï¼Œtimeæˆ–è€…top -Hp pid\n\n```\nps -mp $pid -o THREADï¼Œtidï¼Œtime | sort -nr\n```\n\n\n\n#çº¿ç¨‹IDè½¬æˆ16è¿›åˆ¶ç”¨äºæŸ¥è¯¢\n\n```\n$ printf \"%x\\n\"  $tid\na221\n```\n\n### jstack\n\n```\njstack $pid | grep \"a221\"  -A  30\n```\n\n> -A  -B -C(å¤§å†™)  åé¢éƒ½è·Ÿé˜¿æ‹‰ä¼¯æ•°å­— \n>-Aæ˜¯æ˜¾ç¤ºåŒ¹é…åå’Œå®ƒåé¢çš„nè¡Œã€‚after \n>-Bæ˜¯æ˜¾ç¤ºåŒ¹é…è¡Œå’Œå®ƒå‰é¢çš„nè¡Œã€‚ before\n>-Cæ˜¯åŒ¹é…è¡Œå’Œå®ƒå‰åå„nè¡Œã€‚ context\n\n\n\n```\nps -ef | grep $name\njstack $pid >> ./dump.log\n```\n\n\n\n### Thread Dump\n\n***\\*kill -3 PIDå‘½ä»¤åªèƒ½æ‰“å°é‚£ä¸€ç¬é—´javaè¿›ç¨‹çš„å †æ ˆä¿¡æ¯\\****ï¼Œé€‚åˆåœ¨æœåŠ¡å™¨å“åº”æ…¢ï¼Œcpuã€å†…å­˜å¿«é€Ÿé£™å‡ç­‰å¼‚å¸¸æƒ…å†µä¸‹ä½¿ç”¨ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å®šä½åˆ°å¯¼è‡´å¼‚å¸¸å‘ç”Ÿçš„javaç±»ï¼Œè§£å†³å¦‚æ­»é”ã€è¿æ¥è¶…æ—¶ç­‰åŸå› å¯¼è‡´çš„ç³»ç»Ÿå¼‚å¸¸é—®é¢˜ã€‚**è¯¥å‘½ä»¤ä¸ä¼šæ€æ­»è¿›ç¨‹ã€‚**\n\n- tomcat  å †æ ˆä¿¡æ¯ä¼šæ‰“å°åœ¨catalina.out\n- nohupå¯åŠ¨ å †æ ˆä¿¡æ¯ä¼šåœ¨nohup.out\n\n\n\n## mem\n\n\n\n### free -m\n\n\n\nps -aux | sort -k4nr | head -5\n\n\n\n\n\n## å·¥å…·\n\narthas  \n\nä¸‹è½½ https://github.com/alibaba/arthas/releases\n\næ–‡æ¡£ https://arthas.aliyun.com/doc/advanced-use.html\n\n\n\njvisualvm\n\n${JDK_HOME}\\bin\\jvisualvm\n\nhttps://www.cnblogs.com/mzq123/p/11166640.html","tags":["usage_high"],"categories":["linux","shell"]},{"title":"ç½‘ç»œæ¦‚å¿µä»‹ç»","url":"/network/network/","content":"\n\n\n## http åº”ç”¨å±‚\n\nåœ¨ä¸¤å°è®¡ç®—æœºç›¸äº’ä¼ é€’ä¿¡æ¯æ—¶ï¼ŒHTTPè§„å®šäº†æ¯æ®µæ•°æ®ä»¥ä»€ä¹ˆå½¢å¼è¡¨è¾¾æ‰æ˜¯èƒ½å¤Ÿè¢«å¦å¤–ä¸€å°è®¡ç®—æœºç†è§£\n\n\n\nç¬¬ä¸€æ­¥ï¼šåœ¨æµè§ˆå™¨è¾“å…¥å†…å®¹ï¼ˆç½‘å€ï¼‰\n\nç¬¬äºŒæ­¥ï¼šæµè§ˆå™¨æŠŠ åŸŸå å‘é€åˆ°DNSä¸Š ï¼Œè¿›è¡Œè§£æ å¾—åˆ°IPä¹‹åé“¾æ¥åˆ°æŒ‡å®š\n\nâ€‹    æœåŠ¡å™¨ ï¼ˆæœåŠ¡å™¨åœ°å€110,102.13.32:80 ä»æµè§ˆå™¨åˆ°æœåŠ¡å™¨ä½¿ç”¨åº•å±‚TCP/IPï¼‰\n\nç¬¬ä¸‰æ­¥ï¼šå®ç°TCP/IPåè®®ç”¨Socket ç”¨Socketå¥—æ¥å­—\n\nç¬¬å››æ­¥ï¼šæœåŠ¡å™¨ç«¯å£80ç›‘å¬å®¢æˆ·ç«¯é“¾æ¥ï¼ˆå®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨ç«¯é“¾æ¥ï¼‰\n\n\n\nHTTP 1.0 ä¸€ä¸ªé“¾æ¥å‘é€ä¸€ä¸ªè¯·æ±‚\n\nHTTP 1.1 ä¸€ä¸ªé“¾æ¥å‘é€å¤šä¸ªè¯·æ±‚\n\n\n\nget  å‘æœåŠ¡å™¨ ã€ç´¢å–ã€‘ æ•°æ®çš„ä¸€ç§ è¯·æ±‚\n\n  ä¸€èˆ¬ç”¨äº è·å–/æŸ¥è¯¢  èµ„æºä¿¡æ¯\n\n  getç”¨äºä¿¡æ¯è·å–ï¼Œè€Œä¸”åº”è¯¥æ˜¯å®‰å…¨ï¼ˆæŒ‡éä¿®æ”¹ä¿¡æ¯ï¼‰å’Œå¹‚ç­‰\n\n  å¦‚ï¼šæ–°é—»å¤´ç‰ˆä¸æ–­æ›´æ–°ï¼Œè¯¥æ“ä½œè¢«è®¤ä¸ºå®‰å…¨å’Œå¹‚ç­‰ï¼Œä»è‡ªèº«è§’åº¦æ¥çœ‹æ²¡æœ‰æ”¹å˜èµ„æº\n\n\n\npost  å‘æœåŠ¡å™¨ ã€æäº¤ã€‘ æ•°æ®çš„ä¸€ç§ è¯·æ±‚\n\n  ä¸€èˆ¬ç”¨äº æ›´æ–° èµ„æºä¿¡æ¯\n\nâ€‹\tpostè¡¨ç¤ºå¯èƒ½ä¿®æ”¹æœåŠ¡å™¨ä¸Šçš„èµ„æºè¯·æ±‚\n\nâ€‹\tå¦‚ï¼šè¯„è®ºæ–°é—»ï¼Œæäº¤åç«™ç‚¹èµ„æºä¸åŒï¼Œèµ„æºè¢«ä¿®æ”¹\n\n\n\nè¡¨é¢ç°è±¡\n\nâ€‹\tgetè¯·æ±‚æ•°æ®é™„åœ¨URLä¸Šï¼› postæäº¤æ•°æ®æ”¾åœ¨httpåŒ…ä½“ä¸­\n\nâ€‹\tgetå­—èŠ‚é™åˆ¶ï¼ˆ1024ï¼‰ å®è´¨æ˜¯æµè§ˆå™¨ï¼ˆå’ŒæœåŠ¡å™¨ï¼‰çš„é™åˆ¶ ï¼› postç†è®ºæ²¡æœ‰é™åˆ¶\n\nâ€‹\tpost å®‰å…¨ï¼ˆsecurityï¼‰æ€§æ¯” getå®‰å…¨ï¼ˆsecurityï¼‰æ€§é«˜\n\n\n\n\n\n## tpc/udp ä¼ è¾“å±‚\n\nè§„å®šçš„æ˜¯æ•°æ®åº”è¯¥æ€ä¹ˆä¼ è¾“æ‰èƒ½ç¨³å®šä¸”é«˜æ•ˆçš„ä¼ é€’ä¸è®¡ç®—æœºä¹‹é—´ã€‚\n\n\n\n| \\          | TCP                                    | UDP                                  |\n| ---------- | -------------------------------------- | ------------------------------------ |\n| æ˜¯å¦è¿æ¥   | é¢å‘è¿æ¥                               | é¢å‘éè¿æ¥                           |\n| ä¼ è¾“å¯é æ€§ | å¯é                                    | ä¸å¯é                                |\n| åº”ç”¨åœºåˆ   | ä¼ è¾“å¤§é‡çš„æ•°æ®ï¼Œå¯¹å¯é æ€§è¦æ±‚è¾ƒé«˜çš„åœºåˆ | ä¼ é€å°‘é‡æ•°æ®ã€å¯¹å¯é æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯ |\n| é€Ÿåº¦       | æ…¢                                     | å¿«                                   |\n\n\n\n## https\n\nHTTPSåè®®æ˜¯ç”±SSL+HTTPåè®®æ„å»ºçš„å¯è¿›è¡ŒåŠ å¯†ä¼ è¾“ã€èº«ä»½è®¤è¯çš„ç½‘ç»œåè®®","tags":["tcp","http"],"categories":["network"]},{"title":"npmåˆå§‹","url":"/lang/npm/npmåˆå§‹/","content":"\n\n\n## æºåŠ é€Ÿ\n\nè®¾ç½®\n\n```\necho \"registry = https://registry.npm.taobao.org\">>~/.npmrc\n```\n\næŸ¥çœ‹å½“å‰æº\n\n```\nnpm config get registry\n```\n\n<!--more-->\n\n## ä½¿ç”¨\n\n### å…¨å±€å®‰è£…(-g)\n\n typescript\n\n```\nnpm install -g typescript\n```\n\n>/opt/node/bin/tsc -> /opt/node/lib/node_modules/typescript/bin/tsc\n>/opt/node/bin/tsserver -> /opt/node/lib/node_modules/typescript/bin/tsserver\n>+ typescript@4.7.3\n>added 1 package from 1 contributor in 2.252s\n>\n\n\n\n### å¸è½½\n\n```\nnpm uninstall -g  typescript\n```\n\n\n\n- **`i`** æ˜¯ **`install`** çš„ç®€å†™\n- **`-g`** æ˜¯å…¨å±€å®‰è£…ï¼Œä¸å¸¦ **`-g`** ä¼šå®‰è£…åœ¨ä¸ªäººæ–‡ä»¶å¤¹\n- **`-S`** ä¸ **`--save`** çš„ç®€å†™ï¼Œå®‰è£…åŒ…ä¿¡æ¯ä¼šå†™å…¥ **`dependencies`** ä¸­;ç”Ÿäº§é˜¶æ®µ,é¡¹ç›®è¿è¡Œæ—¶çš„ä¾èµ–\n- **`-D`** ä¸ **`--save-dev`** çš„ç®€å†™ï¼Œå®‰è£…åŒ…å†™å…¥ **`devDependencies`** ä¸­;å¼€å‘é˜¶æ®µ,åªåœ¨å¼€å‘é˜¶æ®µèµ·ä½œç”¨,ä¾‹å¦‚ä»£ç æç¤ºå·¥å…·\n","tags":["æº"],"categories":["lang","npm"]},{"title":"vi/vimåŸºæœ¬å‘½ä»¤","url":"/linux/shell/vim/","content":"\n\n\n![](/pics/vim-4855.png)\n\necs é€€å‡º **ç¼–è¾‘çŠ¶æ€**  åˆ°  **å‘½ä»¤çŠ¶æ€** \n\n### æ’å…¥\n\nåœ¨å…‰æ ‡å‰ `i`\n\nç§»åˆ°åœ¨è¡Œé¦– `I`\n\nå…‰æ ‡å `a`\n\nå½“å‰è¡Œå°¾ `A`\n\nå½“å‰è¡Œä¹‹ä¸‹å¦èµ·ä¸€è¡Œ `o` è¿›å…¥ç¼–è¾‘çŠ¶æ€\n\nå½“å‰è¡Œä¹‹ä¸Šå¦èµ·ä¸€è¡Œ `O`\n\n##### æ›¿æ¢\n\nå½“å‰å­—ç¬¦ `r`\n<!--more-->\n\nå½“å‰åŠå…¶å,ç›´åˆ°æŒ‰Esc `R`\n\n#####  ç²˜è´´\n\n å‰ªåˆ‡  `dd`å½“å‰è¡Œ  ,ç§»åŠ¨åˆ°ç›®æ ‡è¡Œ `p`ç²˜è´´\n\nå¤åˆ¶  `yy`å½“å‰è¡Œ  ,`p`ç²˜è´´  \n\nå¤åˆ¶2ä¸ªå•è¯ `y2w`  å‘ä¸‹2è¡Œ `y2j`  å‘ä¸Š2è¡Œ `y2k`\n\nå¯„å­˜å™¨ `:reg [args]`  **+**å‰ªåˆ‡æ¿\n\nå¤åˆ¶å½“å‰è¡Œ `\"+yy`   `\"+nyy`\n\nå‰ªåˆ‡æ¿å†…å®¹ç²˜è´´åˆ°å…‰æ ‡å `\"+p`\n\n\n\n##### æœç´¢\n\nè·³åˆ°æŒ‡å®šè¡Œ(21è¡Œ) `:21`  æˆ– `21G`   \n\nè¿”å›åŸå…‰æ ‡å¤„ ` ``  `\n\n##### ç§»åŠ¨\n\nå·¦`j` ä¸‹`j` ä¸Š`k` å³`l`\n\nå•è¯æœ«å°¾ `e`\n\n2ä¸ªå•è¯   å‰ç§»  `2b`  åç§» `2w`\n\nè¡Œé¦–  `0` æˆ– `^`           è¡Œå°¾ `$`  2è¡Œè¡Œå°¾ `2$`\n\nä¸Šè¡Œ(å‡å·)  `-`   ä¸‹è¡Œ  `+`\n\n\n\nè·³åˆ°å¯¹åº”æ‹¬å·(ä»£ç å—)  `%`\n\n### æ¢å¤\n\næ’¤é”€(æœ¬æ¬¡ç¼–è¾‘æ¨¡å¼æ²¡æœ‰æ”¹åŠ¨) `u`\n\næ¢å¤ä¸Šä¸€æ­¥æ’¤é”€  `ctrl+r`\n\n### åˆ é™¤\n\nåˆ é™¤å­—ç¬¦ `x`\n\nåˆ é™¤å½“å‰è¡ŒåŠåé¢n-1è¡Œ  `ndd` \n\n\n\n### é€€å‡º\n\nä¿å­˜ `:wq` æˆ– `:x`\n\nå¼ºåˆ¶é€€å‡º `:q!`\n\n\n\n\n\n### ç¼–è¾‘å‹ç¼©åŒ…å†…æ–‡ä»¶\n\n æ‰“å¼€å‹ç¼©åŒ… è¿›å…¥æ–‡ä»¶å¯ä»¥ç¼–è¾‘  ï¼ˆ/name ï¼‰  **å¾…éªŒè¯**\n\n\n\n\n\nLANG=â€Zn_CN.UTF-8â€  #ä¸´æ—¶è®¾ç½®è¯­è¨€\n\necho $LANG #å½“å‰ç³»ç»Ÿè®¾ç½®ç¼–ç  \n","tags":["vim"],"categories":["linux","shell"]},{"title":"findæŸ¥æ‰¾æœç´¢","url":"/linux/shell/find/","content":"\n\n\næŸ¥æ‰¾\n\n> find [OPTIONS] [æŸ¥æ‰¾èµ·å§‹è·¯å¾„] [æŸ¥æ‰¾æ¡ä»¶] [å¤„ç†åŠ¨ä½œ]\n\n[OPTIONS]  å¿½ç•¥\n\n\n\n#### è·¯å¾„\n\n  ç›¸å¯¹    `./`\n\n  ç»å¯¹   `/`\n\n#### æ¡ä»¶\n\nåç§°\n\n**name**    `find  /  -name   mysql`\n\n**iname**   `find  /  -iname  cmake`   *å¿½ç•¥å¤§å°å†™*\n\n**regex**  `find / -regex  /docker*`  æ­£åˆ™æ¨¡ç³ŠæŸ¥è¯¢\n\nå¤§å°\n<!--more-->\n\n**size**   `find  / -size  +20M` \n\n *+* å¤§äº    *-*å°äº    *K*  *M*  *G*\n\n`   20M`       (20-1,20]\n\n`-  20M`    [0,20-1]\n\n`+ 20M`    (20,+âˆ]\n\næ—¶é—´\n\n**atime**  æ–‡ä»¶æœ€åè®¿é—®  \n\n*  [#, #-1) ï¼šæœ€åè®¿é—®æ—¶é—´åœ¨#å¤©å‰ï¼ˆå¤§äºç­‰äº#å¤©å‰ï¼Œå°äº#-1å¤©å‰ï¼‰\n\n  ç­‰ä»·äºæœ€åè®¿é—®æ—¶é—´ä¸å½“å‰çš„æ—¶é—´å·® å¤§äº (#-1)*24å°æ—¶ï¼Œå°äºç­‰äº #*24å°æ—¶\n\n\n*  (#, 0] ï¼šæœ€åè®¿é—®æ—¶é—´åœ¨#å¤©ä»¥å†…ï¼Œä¸åŒ…æ‹¬24å°æ—¶å‰çš„é‚£ä¸€åˆ»ã€‚\n\nç­‰ä»·äºæœ€åè®¿é—®æ—¶é—´ä¸å½“å‰çš„æ—¶é—´å·®å°äº #*24å°æ—¶\n\n*  (oo, #-1] ï¼šæœ€åè®¿é—®æ—¶é—´åœ¨#-1å¤©ä»¥å‰çš„ã€‚åŒ…æ‹¬#-1å¤©å‰\n\nç­‰ä»·äºæœ€åè®¿é—®æ—¶é—´ä¸å½“å‰çš„æ—¶é—´å·®å¤§äºç­‰äº #*24å°æ—¶\n\n```\n#æŸ¥æ‰¾æœ€è¿‘10å¤©å†…è¢«è®¿é—®è¿‡çš„æ‰€æœ‰æ–‡ä»¶\n[root@centos7 ~]# find . -type f -atime -10\n \n#æŸ¥æ‰¾è¶…è¿‡10å¤©å†…è¢«è®¿é—®è¿‡çš„æ‰€æœ‰æ–‡ä»¶\n[root@centos7 ~]# find . -type f -atime +10\n \n#æŸ¥æ‰¾è®¿é—®æ—¶é—´è¶…è¿‡20åˆ†é’Ÿçš„æ‰€æœ‰æ–‡ä»¶\n[root@centos7 ~]# find . -type f -amin +20\n \n#æ‰¾å‡ºæ¯”mingonggeä¿®æ”¹æ—¶é—´æ›´é•¿çš„æ‰€æœ‰æ–‡ä»¶\n[root@centos7 ~]# find . -type f -newer mingongge\n```\n\n**mtime**  æ–‡ä»¶æœ€åä¿®æ”¹\n\n**ctime**  æ–‡ä»¶æœ€åæ”¹å˜\n\n\n\n```\n\nsudo find /boot/burg/themes/  -name '[^Metro]*' | xargs rm -rf\n\n```\n\n-path  æ’é™¤è·¯å¾„\n\n-type  ç±»å‹  d ç›®å½•  fæ–‡ä»¶     \n\n-o  or \n\n-a and\n\n-prune é…å¤‡åˆ°pathè·¯å¾„ï¼Œåˆ™è·³è¿‡è¯¥ç›®å½•\n\n```\n\nsudo find  /  -path \"/home/cs/lua-5.3.4\"  -prune -o -type f    -name  lua*\n\n```","tags":["find"],"categories":["linux","shell"]},{"title":"topæ’æŸ¥æœåŠ¡å™¨","url":"/linux/shell/top/","content":"\n\n\ntop -M  \n\ntop -c \n\ntop -p $pid\n\n![](/pics/top-4834.png)\n\n>æ’åºé»˜è®¤ä»å¤§åˆ°å°,Råå‘æ’åº\n>\n>Mï¼šæ ¹æ®å†…å­˜æ’åº\n>\n>Pï¼šæ ¹æ®CPUä½¿ç”¨æ’åº\n>\n>Tï¼šæ ¹æ®ä½¿ç”¨æ—¶é—´æ’åº\n>\n>\\>ï¼šå‘å³ç§»åŠ¨ä¸€åˆ—æ’åº\n>\n><:å‘å·¦ç§»åŠ¨ä¸€åˆ—æ’åº\n\nç•Œé¢shift+m (æ ¹æ®å†…å­˜æ’åº)\n\n![](/pics/top-M-5210.png)\n\n\n\n### ç¬¬ä¸€è¡Œtop\n\nç­‰åŒå‘½ä»¤uptime\n\n```\ncs@debian:~/go$ uptime\n 22:00:22 up  8:59,  1 user,  load average: 0.13, 0.32, 0.36\n```\n\n<!--more-->\n\n>ç³»ç»Ÿå½“å‰æ—¶é—´ up ç³»ç»Ÿåˆ°ç›®å‰ä¸ºæ­¢è¿è¡Œçš„æ—¶é—´ï¼Œ\n>\n> å½“å‰ç³»ç»Ÿçš„ç™»é™†ç”¨æˆ·æ•°é‡ï¼Œ\n>\n>load averageåé¢çš„ä¸‰ä¸ªæ•°å­—åˆ†åˆ«è¡¨ç¤ºè·ç¦»ç°åœ¨ä¸€åˆ†é’Ÿï¼Œäº”åˆ†é’Ÿï¼Œåäº”åˆ†é’Ÿçš„è´Ÿè½½æƒ…å†µ\n\nload averageæ•°æ®æ˜¯æ¯éš”5ç§’é’Ÿæ£€æŸ¥ä¸€æ¬¡æ´»è·ƒçš„è¿›ç¨‹æ•°ï¼Œç„¶åæŒ‰ç‰¹å®šç®—æ³•è®¡ç®—å‡ºçš„æ•°å€¼ã€‚å¦‚æœè¿™ä¸ªæ•°é™¤ä»¥é€»è¾‘CPUçš„æ•°é‡ï¼Œç»“æœé«˜äº5çš„æ—¶å€™å°±è¡¨æ˜ç³»ç»Ÿåœ¨è¶…è´Ÿè·è¿è½¬äº†\n\n\n\n\n\n\n\n### ç¬¬äºŒè¡Œ Tasks\n\n```\nTasks: 241 total,   1 running, 240 sleeping,   0 stopped,   0 zombie\n```\n\n>tasksè¡¨ç¤ºä»»åŠ¡ï¼ˆè¿›ç¨‹ï¼‰ï¼Œ214åˆ™è¡¨ç¤ºç°åœ¨æœ‰241ä¸ªè¿›ç¨‹ï¼Œ\n>\n>running  å…¶ä¸­å¤„äºè¿è¡Œä¸­çš„æœ‰1ä¸ªï¼Œ\n>\n>sleeping  240ä¸ªåœ¨ä¼‘çœ (æŒ‚èµ·)ï¼Œ\n>\n>stopped  åœæ­¢çš„è¿›ç¨‹æ•°ä¸º0ï¼Œ\n>\n>zombie   åƒµå°¸çš„è¿›ç¨‹æ•°ä¸º0ä¸ª\n\n\n\n### ç¬¬ä¸‰è¡Œ%Cpu\n\n```\n%Cpu(s):  3.6 us,  0.6 sy,  0.0 ni, 95.8 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st\n```\n\n>usâ€”â€”ç”¨æˆ·ç©ºé—´(user)å ç”¨cpuçš„ç™¾åˆ†æ¯”\n>syâ€”â€”å†…æ ¸ç©ºé—´(system)å ç”¨cpuçš„ç™¾åˆ†æ¯”\n>niâ€”â€”æ”¹å˜è¿‡ä¼˜å…ˆçº§(niced)çš„è¿›ç¨‹å ç”¨cpuçš„ç™¾åˆ†æ¯”\n>idâ€”â€”ç©ºé—²ï¼ˆidoltï¼‰CPUç™¾åˆ†æ¯”\n>waâ€”â€”IOç­‰å¾…(wait)å ç”¨cpuçš„ç™¾åˆ†æ¯”\n>hiâ€”â€”IRQ ç¡¬ä¸­æ–­(Hardware)å ç”¨cpuçš„ç™¾åˆ†æ¯”\n>siâ€”â€”è½¯ä¸­æ–­ï¼ˆsoftwareï¼‰å ç”¨cpuçš„ç™¾åˆ†æ¯”\n>stâ€”â€”è¢«hypervisorå·å»çš„æ—¶é—´\n\n\n\n### ç¬¬å››äº”è¡Œ kibå†…å­˜\n\n```\nKiB Mem : 16257204 total, 12933272 free,  1288736 used,  2035196 buff/cache\nKiB Swap:  7812092 total,  7812092 free,        0 used. 14425716 avail Mem \n```\n\n>Memï¼šç‰©ç†å†…å­˜æ€»é‡ï¼ˆ16Gï¼‰\n>free: ç©ºé—²å†…å­˜æ€»é‡(1G)\n>used: ä½¿ç”¨ä¸­çš„å†…å­˜æ€»é‡\n>buff/cache: ç”¨ä½œå†…æ ¸ç¼“å­˜çš„å†…å­˜é‡\n\n>Swapï¼š äº¤æ¢åŒºæ€»é‡\n>freeï¼šç©ºé—²äº¤æ¢åŒºæ€»é‡\n>usedï¼š ä½¿ç”¨çš„äº¤æ¢åŒºæ€»é‡\n>avail Memï¼šè¡¨ç¤ºå¯ç”¨äºè¿›ç¨‹ä¸‹ä¸€æ¬¡åˆ†é…çš„ç‰©ç†å†…å­˜æ•°é‡ï¼Œè¿™ä¸ªå¤§å°ä¸€èˆ¬æ¯”freeå¤§ä¸€ç‚¹ï¼Œå› ä¸ºé™¤äº†freeçš„ç©ºé—´å¤–ï¼Œç³»ç»Ÿè¿˜èƒ½ç«‹å³é‡Šæ”¾å‡ºä¸€äº›ç©ºé—´æ¥\n\n\n\n\n\n### ç¬¬ä¸ƒè¡Œ è¿›ç¨‹ä¿¡æ¯åŒº\n\n```\n PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND  \n```\n\n>PID â€” è¿›ç¨‹id\n>USER â€” è¿›ç¨‹æ‰€æœ‰è€…\n>PR â€” è¿›ç¨‹ä¼˜å…ˆçº§\n>NI â€” niceå€¼ã€‚è´Ÿå€¼è¡¨ç¤ºé«˜ä¼˜å…ˆçº§ï¼Œæ­£å€¼è¡¨ç¤ºä½ä¼˜å…ˆçº§\n>VIRT â€” è¿›ç¨‹ä½¿ç”¨çš„`è™šæ‹Ÿå†…å­˜`æ€»é‡ï¼Œå•ä½kbã€‚VIRT=SWAP+RES\n>RES â€” `å¸¸é©»å†…å­˜`,è¿›ç¨‹ä½¿ç”¨çš„ã€æœªè¢«æ¢å‡ºçš„ç‰©ç†å†…å­˜å¤§å°ï¼Œå•ä½kbã€‚RES=CODE+DATA\n>SHR â€” `å…±äº«å†…å­˜`å¤§å°ï¼Œå•ä½kb\n>S â€” è¿›ç¨‹çŠ¶æ€ã€‚D=ä¸å¯ä¸­æ–­çš„ç¡çœ çŠ¶æ€ R=è¿è¡Œ S=ç¡çœ  T=è·Ÿè¸ª/åœæ­¢ Z=åƒµå°¸è¿›ç¨‹\n>%CPU â€” ä¸Šæ¬¡æ›´æ–°åˆ°ç°åœ¨çš„CPUæ—¶é—´å ç”¨ç™¾åˆ†æ¯”\n>%MEM â€” è¿›ç¨‹ä½¿ç”¨çš„ç‰©ç†å†…å­˜ç™¾åˆ†æ¯”\n>TIME+ â€” è¿›ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´æ€»è®¡ï¼Œå•ä½1/100ç§’\n>COMMAND â€” è¿›ç¨‹åç§°ï¼ˆå‘½ä»¤å/å‘½ä»¤è¡Œï¼‰\n\n\n\n### å…¶ä»–\n\n```\ncs@debian:~/go$ sudo netstat -anp|grep 12347\ntcp        0      0 0.0.0.0:4000            0.0.0.0:*               LISTEN      12347/hexo \n```\n\n\n\n```\ncs@debian:~/go$ lsof -i:4000\nCOMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME\nhexo    12347   cs   21u  IPv4 324187      0t0  TCP *:4000 (LISTEN)\ncs@debian:~/go$ ps -ef|grep 12347\ncs       12347  1640  0 21:56 pts/2    00:00:03 hexo\ncs       13306  1622  0 22:23 pts/0    00:00:00 grep 12347\n```\n\n\n\nåˆ—å‡ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„javaè¿›ç¨‹\n\n```\ncs@debian:~/go$ jps\n13600 Jps\n```\n\n>| å‚æ•° | è¯´æ˜                            |\n>| ---- | ------------------------------- |\n>| `-l` | è¾“å‡ºä¸»ç±»å…¨åæˆ–jarè·¯å¾„           |\n>| `-q` | åªè¾“å‡ºLVMID                     |\n>| `-m` | è¾“å‡ºJVMå¯åŠ¨æ—¶ä¼ é€’ç»™main()çš„å‚æ•° |\n>| `-v` | è¾“å‡ºJVMå¯åŠ¨æ—¶æ˜¾ç¤ºæŒ‡å®šçš„JVMå‚æ•°  |\n\n\n\n\n\n\n","tags":["shell"],"categories":["linux","shell"]},{"title":"åˆè¯†jvm","url":"/lang/gc/","content":"\n## è°ƒä¼˜å‚æ•°\n\né€‰é¡¹ Xms,Xmx,newSize,MaxSize ,PermSize, MaxPermSize\n\nXms(youngå’ŒoldåŒºä½¿ç”¨å¤§å°)\n\nXmx(youngå’ŒoldåŒºæœ€å¤§æ‰¿å—å¤§å°)\n\nnewSize(youngåŒºä½¿ç”¨å¤§å°)\n\nMaxSize(youngåŒºæœ€å¤§æ‰¿å—å¤§å°)\n\nPermSize(æŒä¹…åŒºä½¿ç”¨å¤§å°)\n\nMaxPermSize(æŒä¹…åŒºæœ€å¤§ä½¿ç”¨å¤§å°)\n\n<!--more-->\n\nsuivivorRatio(è®¾ç½®Edenå’Œsurvivoræ¯”ä¾‹  é»˜è®¤æ˜¯8:1)\n\n-Xmsï¼šè¡¨ç¤ºjavaè™šæ‹Ÿæœºå †åŒºå†…å­˜åˆå§‹å†…å­˜åˆ†é…çš„å¤§å°ï¼Œé€šå¸¸ä¸ºæ“ä½œç³»ç»Ÿå¯ç”¨å†…å­˜çš„1/64å¤§å°å³å¯ï¼Œä½†ä»éœ€æŒ‰ç…§å®é™…æƒ…å†µè¿›è¡Œåˆ†é…ã€‚\n-Xmxï¼šè¡¨ç¤ºjavaè™šæ‹Ÿæœºå †åŒºå†…å­˜å¯è¢«åˆ†é…çš„æœ€å¤§ä¸Šé™ï¼Œé€šå¸¸ä¸ºæ“ä½œç³»ç»Ÿå¯ç”¨å†…å­˜çš„1/4å¤§å°ã€‚\n\n-XX:newSizeï¼šè¡¨ç¤ºæ–°ç”Ÿä»£åˆå§‹å†…å­˜çš„å¤§å°ï¼Œåº”è¯¥å°äº-Xmsçš„å€¼ï¼›\n-XX:MaxnewSizeï¼šè¡¨ç¤ºæ–°ç”Ÿä»£å¯è¢«åˆ†é…çš„å†…å­˜çš„æœ€å¤§ä¸Šé™ï¼›å½“ç„¶è¿™ä¸ªå€¼åº”è¯¥å°äº-Xmxçš„å€¼ï¼›\n\n-XX:PermSizeï¼šè¡¨ç¤ºéå †åŒºåˆå§‹å†…å­˜åˆ†é…å¤§å°ï¼ˆæ–¹æ³•åŒºï¼‰\n-XX:MaxPermSizeï¼šè¡¨ç¤ºå¯¹éå †åŒºåˆ†é…çš„å†…å­˜çš„æœ€å¤§ä¸Šé™ï¼ˆæ–¹æ³•åŒºï¼‰ã€‚\n\n\n\n## å·¥ä½œæµç¨‹\n\n![](/pics/jvm-work-4037.png)\n\n1ã€ç¼–è¯‘é˜¶æ®µï¼šé¦–å…ˆ.javaç»è¿‡javacç¼–è¯‘æˆ.classæ–‡ä»¶\n\n2ã€åŠ è½½é˜¶æ®µï¼šç„¶å.classæ–‡ä»¶ç»è¿‡ç±»çš„åŠ è½½å™¨åŠ è½½åˆ°JVMå†…å­˜ã€‚(è£…è½½ã€è¿æ¥ã€åˆå§‹åŒ–)\n\n-  å…ˆæŠŠclassçš„ä¿¡æ¯è¯»åˆ°å†…å­˜æ¥\n-  ä¼šå¯¹classçš„ä¿¡æ¯è¿›è¡ŒéªŒè¯ã€ä¸ºç±»å˜é‡åˆ†é…å†…å­˜ç©ºé—´å¹¶å¯¹å…¶èµ‹é»˜è®¤å€¼\n-  æ‰§è¡Œåˆå§‹åŒ–é™æ€å—å†…å®¹ï¼Œå¹¶ä¸”ä¸ºé™æ€å˜é‡è¿›è¡ŒçœŸæ­£çš„èµ‹å€¼æ“ä½œ\n\n3ã€è§£é‡Šé˜¶æ®µï¼šclasså­—èŠ‚ç ç»è¿‡å­—èŠ‚ç è§£é‡Šå™¨è§£é‡Šæˆç³»ç»Ÿå¯è¯†åˆ«çš„æŒ‡ä»¤ç ã€‚\n\n4ã€æ‰§è¡Œé˜¶æ®µï¼šç³»ç»Ÿå†å‘ç¡¬ä»¶è®¾å¤‡å‘é€æŒ‡ä»¤ç æ‰§è¡Œæ“ä½œã€‚\n\n\n\n\n\n## æ•°æ®åŒºåŸŸ\n\n![](/pics/jvm-area-4346.png)\n\n Matespace(å…ƒç©ºé—´)åœ¨æœ¬åœ°å†…å­˜åŒºåŸŸ\n\n> -XX:MetaspaceSizeï¼Œåˆå§‹ç©ºé—´å¤§å°\n>\n> -XX:MaxMetaspaceSizeï¼Œæœ€å¤§ç©ºé—´ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰é™åˆ¶çš„\n\n\n\n## åƒåœ¾å›æ”¶åŒºåŸŸ\n\n![](/pics/gc-area-4008.png)\n\n### Yong Generation\n\nè´Ÿè´£æ–°æ¥æ”¶çš„å¯¹è±¡\n\né»˜è®¤åŒºåŸŸåˆ’åˆ†8:1\n\n#### Eden   80%\n\nEdenåŒºåŸŸè§¦å‘ç¬¬ä¸€æ¬¡GC\n\n#### Survivor \n\n##### From 10%\n\nä¸Šä¸€æ¬¡MinorGCå­˜æ´»è€…,ç­‰å¾…ä¸‹æ¬¡æ‰«æ\n\n##### To 10%\n\nä¸€æ¬¡MinorGCè¿‡ç¨‹åçš„å­˜æ´»è€…\n\nMinorGCè¿‡ç¨‹\n\n1. eden,survivorFromå¤åˆ¶åˆ°survivorTo,å¹´é¾„åŠ 1\n2. æ¸…ç©º(eden,survivorFrom) \n3. survivorTo ä¸survivorFromäº’æ¢\n\nGCè¿‡ç¨‹ä¸­toåŒºæ»¡å(æˆ–è€…è¾¾åˆ°å¹´é¾„æ ‡å‡†,æ— æ³•å‚¨å­˜çš„æŸä¸ªå¯¹è±¡)å°±ç§»åˆ°oldåŒº\n\n### Old Generation\n\nå­˜æ”¾yongå¤šæ¬¡GCåä»å­˜æ´»çš„å¯¹è±¡\n\noldç©ºé—´ä¸è¶³æ—¶ä¼šè§¦å‘MajorGC(Full GC)\n\nMajorGCè¿‡ç¨‹\n\n- å…ˆæ‰«æå…¨éƒ¨,æ ‡è®°å­˜æ´»å¯¹è±¡,æ¸…é™¤æ²¡æœ‰æ ‡è®°çš„å¯¹è±¡\n\n### Permanent Generation\n\né™æ€æ–‡ä»¶(javaç±»,æ–¹æ³•,å…ƒæ•°æ®)\n\n\n\n## åƒåœ¾å›æ”¶ç®—æ³•\n\n![](/pics/gc-yg-3223.png)\n\n\n\nhttps://zhuanlan.zhihu.com/p/343746128\n\n\n\n\n\n\n\n![](/pics/new-area-3239.png)\n\n","tags":["jvm"],"categories":["lang","gc"]},{"title":"mdæµç¨‹å›¾","url":"/markdown/flow/","content":"\n```flow\nstart=>start: æ¥æ”¶åˆ°æ¶ˆæ¯\ninfo=>operation: è¯»å–ä¿¡æ¯\ncd=>condition: æ˜¯å¦å­˜åœ¨\nsetC=>subroutine: è®¾ç½®ç¼“å­˜\ngetC=>operation: è¯»å–ç¼“å­˜\nxx=>inputoutput: è¿”å›ä¿¡æ¯\nend=>end: å¤„ç†ç»“æŸ\n\nstart->info->cd\ncd(yes)->getC->xx\ncd(no)->setC->xx\nxx->end\n```\n\n<!--more-->\n\n![md_flow](/pics/md_flow.png)\n\n\n>åŸºæœ¬è¯­æ³•ï¼šå®šä¹‰æ¨¡å— id=>å…³é”®å­—: æè¿° ï¼ˆâ€œæè¿°â€çš„å‰é¢å¿…é¡»æœ‰ç©ºæ ¼ï¼Œâ€œ=>â€ ä¸¤ç«¯ä¸èƒ½æœ‰ç©ºæ ¼ï¼‰\n>\n>å…³é”®å­—ï¼š\n>\n>start æµç¨‹å¼€å§‹ï¼Œä»¥åœ†è§’çŸ©å½¢ç»˜åˆ¶\n>\n>operation æ“ä½œï¼Œä»¥ç›´è§’çŸ©å½¢ç»˜åˆ¶\n>\n>condition åˆ¤æ–­ï¼Œä»¥è±å½¢ç»˜åˆ¶\n>\n>subroutine å­æµç¨‹ï¼Œä»¥å·¦å³å¸¦ç©ºç™½æ¡†çš„çŸ©å½¢ç»˜åˆ¶\n>\n>inputoutput è¾“å…¥è¾“å‡ºï¼Œä»¥å¹³è¡Œå››è¾¹å½¢ç»˜åˆ¶\n>\n>end æµç¨‹ç»“æŸï¼Œä»¥åœ†è§’çŸ©å½¢ç»˜åˆ¶\n>\n>å®šä¹‰æ¨¡å—é—´çš„æµå‘ï¼š\n>\n>æ¨¡å—1 id->æ¨¡å—2 id ï¼š\n>\n>ä¸€èˆ¬çš„ç®­å¤´æŒ‡å‘æ¡ä»¶æ¨¡å—id (æè¿°)->æ¨¡å—id(direction) ï¼šæ¡ä»¶æ¨¡å—è·³è½¬åˆ°å¯¹åº”çš„æ‰§è¡Œæ¨¡å—ï¼Œå¹¶æŒ‡å®šå¯¹åº”åˆ†æ”¯çš„å¸ƒå±€æ–¹å‘\n\n\n","tags":["æµç¨‹å›¾","flow"],"categories":["markdown"]},{"title":"zké€‰ä¸¾","url":"/services/zookeeper/é€‰ä¸¾æœºåˆ¶/","content":"\n#### æ ¸å¿ƒæœºåˆ¶\n\n- é€»è¾‘æ—¶é—´ epoch ,åˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€è½®æŠ•ç¥¨(ç½‘ç»œåŸå› å¯¼è‡´æŠ•ç¥¨å¹¿æ’­ä¿¡æ¯æ»å)\n- äº‹ç‰©ID(Zxid),äº‹ç‰©IDæœ€å¤§çš„æ•°æ®æœ€æ–°  \n- æœåŠ¡å™¨ID(myid),æ•°å€¼å¤§çš„æƒé‡å¤§  \n\n<!--more-->\n\n```flow\nstart=>start: é€‰self\ninfo=>operation: å¹¿æ’­ä¿¡æ¯\nj1=>condition: æŠ•ç¥¨ç»“æœçŠ¶æ€\n\nj2=>condition:  æ˜¯å¦è¿‡æ—¶\nyj2=>operation: æ¸…ç©ºæŠ•ç¥¨ä¿¡æ¯\nnj2=>operation: æ›´æ–°æŠ•ç¥¨ä¿¡æ¯\n\nj3=>condition: æ˜¯å¦åŒä¸€è½®\nyj3=>operation: æ¯”è¾ƒæŠ•ç¥¨ä¿¡æ¯\nnj3=>operation: å·²å®ŒæˆæŠ•ç¥¨ä¿¡æ¯\n\nj=>condition:  æ˜¯å¦å½¢æˆå…±è¯†\nend=>end: é€€å‡º\n\nstart->info->j1\nj1(yes)->j3\nj1(no)->j2\n\nj2(yes)->yj2(right)->nj2\nj2(no)->nj2\n\nj3(yes)->yj3->j\nj3(no)->nj3->j\n\nnj2->yj3->j\nj(no)->info\nj(yes)->end\n\n```\n\n\n\n\n\n####  æ¯”è¾ƒé€»è¾‘\n\n![](/pics/zk_flow_2232.png)\n\n\n\nåŒä¸€è½®,å¯¹æŠ•ç¥¨ä¿¡æ¯(epoch,zxid,myid)è¿›è¡Œæ¯”è¾ƒ(zxid,myid)\n\næ˜¯å¦è¿‡æ—¶:\n\n*è¿‡æ—¶*(å°äº),æ›´æ–°ä½¿ç”¨selfä¿¡æ¯(epoch,zxid,myid)\n\néè¿‡æ—¶(å¤§äº),æ¸…ç©ºä¿¡æ¯,æ›´æ–°(epoch)è¿›è¡Œæ¯”è¾ƒ(zxid,myid)\n\n  \n\næ ¹æ®ä»¥ä¸‹è§„åˆ™,è¶…è¿‡åŠæ•°æ”¶åˆ°ç›¸åŒæŠ•ç¥¨é€‰å‡ºleader\n\n> é€»è¾‘æ—¶é’Ÿå°çš„é€‰ä¸¾ç»“æœè¢«å¿½ç•¥ï¼Œé‡æ–°æŠ•ç¥¨\n>\n> ç»Ÿä¸€é€»è¾‘æ—¶é’Ÿåï¼Œäº‹ç‰©IDå¤§çš„èƒœå‡º\n>\n> äº‹ç‰©IDç›¸åŒçš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨IDå¤§çš„èƒœå‡º\n\n","tags":["æœåŠ¡å‘ç°","é€‰ä¸¾"],"categories":["services","zookeeper"]},{"title":"streamå†™æ³•","url":"/lang/java/stream/","content":"\n\n\n\n\n\n\n\n\n\n\n```\n  public static void main(String[] args) {\n    ArrayList<String> list = new ArrayList<>(Arrays.asList(\"I\", \"love\", \"you\", \"too\"));\n    for(String str : list){\n        if(str.length()>3)\n            System.out.println(str);\n    }\n    list.forEach(str->System.out.println(str));\n    list.stream().filter(str->str.length()>3).forEach(System.out::println);\n  }\n```\n\n>ç”¨streamçš„filteræ¥æ›¿ä»£if/elseä¸šåŠ¡é€»è¾‘\n\n\n\n```\nfor(int i=0;i<10;i++){\n    if(....){\n      //...........\n    }else{\n        //.......\n    }\n}\n\nlist.stream().filter().limit(10).foreach();\n```\n\n\n\n## Stream\n\n![](/pics/stream-1.png)\n\n<!--more-->\n\n### æµåˆ›å»º\n\n```\n\nList<String> list = Arrays.asList(\"hello\",\"world\",\"stream\");\n//åˆ›å»ºé¡ºåºæµ\nStream<String> stream = list.stream();\n//åˆ›å»ºå¹¶è¡Œæµ\nStream<String> parallelStream = list.parallelStream();\n```\n\n\n\n#### é™æ€æ–¹æ³•\n\n**`of()ã€iterate()ã€generate()`**\n\n```\nStream<String> stream1 = Stream.of(\"I\", \"love\", \"you\", \"too\");\nstream1.forEach(System.out::println);\n\nStream<Integer> stream2 = Stream.iterate(0, i -> i + 2).limit(3);\nstream2.forEach(System.out::println);\n\nStream<Boolean> stream3 = Stream.generate(new Random()::nextBoolean).limit(3);\nstream3.forEach(System.out::println);\n```\n\n\n\nå¹¶è¡Œæµ  å¤šçº¿ç¨‹  æŠŠä¸€ä¸ªå†…å®¹åˆ†æˆå¤šä¸ªæ•°æ®å— ä¸åŒçº¿ç¨‹åˆ†åˆ«å¤„ç†æ¯ä¸ªæ•°æ®å—çš„æµ,æœ€ååˆå¹¶(*æ— åºæ•°æ®å¤„ç†*)\n\n```\nOptional<Integer> findFirst = list.stream().parallel().filter( x -> x>4 ).findFirst();\n```\n\n> å¯ä»¥é€šè¿‡`parallel()`æŠŠé¡ºåºæµè½¬æ¢æˆå¹¶è¡Œæµ\n\n![](/pics/stream-type2.png)\n\n\n\n### ä¸­é—´æ“ä½œ\n\n#### æ— çŠ¶æ€ï¼ˆStatelessï¼‰\n\næŒ‡å…ƒç´ çš„å¤„ç†ä¸å—ä¹‹å‰å…ƒç´ çš„å½±å“\n\n##### filter\n\n**ç­›é€‰ï¼Œæ˜¯æŒ‰ç…§ä¸€å®šçš„è§„åˆ™æ ¡éªŒæµä¸­çš„å…ƒç´ ï¼Œå°†ç¬¦åˆæ¡ä»¶çš„å…ƒç´ æå–åˆ°æ–°çš„æµä¸­çš„æ“ä½œ**\n\n```\nlist.stream().filter(str->str.length()>3).forEach(System.out::println);\n```\n\nç›¸å½“äºif\n\n##### æ˜ å°„(mapã€flatMapã€peek)\n\n###### map\n\n```\n List<String> out =  list.stream().\n        map(String::toUpperCase).\n        collect(Collectors.toList());\n System.out.println(out);//[I, LOVE, YOU, TOO]\n```\n\n\n\n```\n    List<Product> list = new ArrayList<>();\n    Test t = new Test();\n\n    list.add(t.new Product(1, \"domestic phone\", new BigDecimal(6899.99)));\n    list.add(t.new Product(2, \"overseas notebook\", new BigDecimal(14989.98)));\n\n    String out =  list.stream().\n     //map(a->a.name.split(\" \")[1]).//phone&&notebook\n    map(a->a.name.replaceAll(\" \", \"-\")).//domestic-phone&&overseas-notebook\n    collect(Collectors.joining(\"&&\"));\n    System.out.println(out);\n```\n\n###### flatMap\n\n```\n    List<String> list = Arrays.asList(\"a:b:c\", \"1:3:5\");\n    List<String> listNew = list.stream().\n            flatMap(s -> Arrays.stream(s.split(\":\")) ).\n            collect(Collectors.toList());\n \n    System.out.println(\"å¤„ç†å‰çš„é›†åˆï¼š\" + list);\n    System.out.println(\"å¤„ç†åçš„é›†åˆï¼š\" + listNew);\n```\n\n>å¤„ç†å‰çš„é›†åˆï¼š[a:b:c, 1:3:5]\n>å¤„ç†åçš„é›†åˆï¼š[a, b, c, 1, 3, 5]\n\n\n\n###### peek\n\n```\n    Stream<String> stream = Stream.of(\"hello\", \"world\");\n    stream.peek(System.out::println).collect(Collectors.toList());\n```\n\n\n\nç»ˆç«¯æ“ä½œã€‚é€šå¸¸åˆ†ä¸º **æœ€ç»ˆçš„æ¶ˆè´¹** ï¼ˆ`foreach` ä¹‹ç±»çš„ï¼‰å’Œ **å½’çº³** ï¼ˆ`collect`ï¼‰ä¸¤ç±»ã€‚\n\n\n\n#### æœ‰çŠ¶æ€ï¼ˆStatefulï¼‰\n\næŒ‡è¯¥æ“ä½œåªæœ‰æ‹¿åˆ°æ‰€æœ‰å…ƒç´ ä¹‹åæ‰èƒ½ç»§ç»­ä¸‹å»\n\n###### distinct\n\nä½¿ç”¨hashCodeï¼ˆï¼‰å’Œequalsï¼ˆï¼‰æ–¹æ³•æ¥è·å–ä¸åŒçš„å…ƒç´ \n\n```\nStream<String> stream = Stream.of(\"1\", \"3\",\"4\",\"10\",\"4\",\"6\",\"23\",\"3\");\nstream.distinct().forEach(System.out::println);\n\n```\n\n\n\n###### sorted\n\n```\n    HashMap<Integer, String> map = new HashMap<>();\n    map.put(1,\"phone\");\n    map.put(2,\"notebook\");\n    map.entrySet().stream().sorted(\n                    Collections.reverseOrder(Map.Entry.comparingByKey())//å€’åº\n                    //Comparator.comparing(e -> e.getKey())//æ­£åº\n            ).forEach(System.out::println);\n```\n\n\n\n###### skip\n\n```\n    Stream<Integer> stream = Stream.of(3,1,10,16,8,4,9);\n    stream.limit(3).skip(2).forEach(System.out::print);\n```\n\n>limit(3)  Iloveyou\n>\n>skip(2)  you\n\n\n\n### ç»ˆç»“æ“ä½œ\n\n#### çŸ­è·¯ï¼ˆShort-circuitingï¼‰\n\næŒ‡é‡åˆ°æŸäº›ç¬¦åˆæ¡ä»¶çš„å…ƒç´ å°±å¯ä»¥å¾—åˆ°æœ€ç»ˆç»“æœ\n\n\n\n###### anyMatch\n\nStream ä¸­åªè¦æœ‰ä¸€ä¸ªå…ƒç´ ç¬¦åˆä¼ å…¥çš„ predicateï¼Œè¿”å› true\n\n```\nstream.anyMatch(s->s==2)\n```\n\n###### allMatch\n\nStream ä¸­å…¨éƒ¨å…ƒç´ ç¬¦åˆä¼ å…¥çš„ predicateï¼Œè¿”å› true\n\n\n\n###### noneMatch\n\nStream ä¸­æ²¡æœ‰ä¸€ä¸ªå…ƒç´ ç¬¦åˆä¼ å…¥çš„ predicateï¼Œè¿”å› true\n\n\n\n###### findFirst\n\nç”¨äºè¿”å›æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ \n\n```\nArrayList<String> list = new ArrayList<>(Arrays.asList(\"I\", \"love\", \"you\", \"too\"));\nSystem.out.println(\n\tlist.stream().filter(s-> s.length()>2).findFirst().get()\n);\n\n```\n\n###### findAny\n\nè¿”å›æµä¸­çš„ä»»æ„å…ƒç´ \n\n```\n    System.out.println(\n            list.parallelStream().filter(s-> s.length()>2).findAny().get()\n    );\n```\n\n>love æˆ– you\n\nå¹¶è¡Œæ•°æ®å¤šè¿”å›æ»¡è¶³ç¬¬ä¸€ä¸ª\n\n\n\n#### éçŸ­è·¯ï¼ˆUnshort-circuitingï¼‰\n\næŒ‡å¿…é¡»å¤„ç†å®Œæ‰€æœ‰å…ƒç´ æ‰èƒ½å¾—åˆ°æœ€ç»ˆç»“æœ\n\n\n\n###### reduce\n\nreduceæ“ä½œæ•ˆç‡ä¸é«˜ï¼Œå› ä¸ºå®ƒåˆ›å»ºäº†å¤§é‡çš„ä¸­é—´`String`å’Œ`StringBuilder`\n\n```\n list.stream().\n \t \tmap(a->a.name.replaceAll(\" \", \"-\")).\n\t\treduce((str1, str2) -> str1 + \"&&\" + str2).get();\n```\n\n>ç­‰ä»· collect(Collectors.joining(\"&&\"))\n\n\n\n###### toArray\n\n```\n    Product[] array = list.stream().toArray(Product[]::new);\n   //Arrays.stream(array).sorted(Comparator.comparing(s>s.getId())).forEach(System.out::println);\n    Arrays.stream(array).filter(s->s.id>1).forEach(System.out::println);\n```\n\n","tags":["stream"],"categories":["lang","java"]},{"title":"goè¯­æ³•è§„åˆ™","url":"/lang/go/","content":"\n\n\n###  å£°æ˜èµ‹å€¼\n\n**:=**  ä¸´æ—¶,å±€éƒ¨å˜é‡\n\n###  æ–¹æ³•é¦–å­—æ¯\n\nç±»ä¼¼java,ä¸ç­‰åŒ(private åªèƒ½å½“å‰ç±»è®¿é—®)\n\n**public** å¤§å†™ è·¨åŒ…è°ƒç”¨\n\n**private**å°å†™ åŒ…å†…è°ƒç”¨\n\n<!--more-->\n\n```go\n##f2.go\npackage t1\n\nimport (\n\t\"fmt\"\n)\n\nvar gloal string = \" å…¨å±€\"\n//...å¯å˜å‚å‡½æ•°\nfunc Tfun2(a ...string) (string, string) {\n\ttemp := \" å±€éƒ¨\"\n\tnf(a)\n\treturn a[0] + gloal, a[1] + temp\n}\n\nfunc nf(a []string) {\n    //for i := range a \n    //for _, v := range a \n\tfor i, v := range a {\n\t\tif a[i] == \"dd\" {\n\t\t\tfmt.Println(a, v)\n\t\t}\n\t}\n}\n##f1.go\npackage t1\n\nimport (\n\t\"fmt\"\n)\n\nfunc Tfun1() {\n\ta, b := Tfun2(\"a is\", \"b is\", \"dd\")\n\tfmt.Println(a, b)\n}\n\n##main.go\npackage main\n\nimport (\n\t\"fmt\"\n\tt1 \"go_learn/test\"\n)\n\nfunc main() {\n\tmf()\n}\n\nfunc mf() {\n\tfmt.Println(\"mainè°ƒç”¨åŒ…test fun1\")\n\tt1.Tfun1() //ä¸¤ä¸ªè¿”å›å€¼\n}\n```\n\n\n\n","tags":["è§„åˆ™","è¯­æ³•"],"categories":["lang","go"]},{"title":"ps","url":"/linux/shell/ps/","content":"\nps (process status) å‘½ä»¤ç”¨äºæ˜¾ç¤ºå½“å‰è¿›ç¨‹çš„çŠ¶æ€ï¼Œç±»ä¼¼äº windows çš„ä»»åŠ¡ç®¡ç†å™¨\n\n\n\n### æŸ¥æ‰¾æŒ‡å®šè¿›ç¨‹\n\n```\n$ ps -ef | grep  key\ncs        4565  4533  0 21:14 pts/2    00:00:00 /opt/ELK/elasticsearch-7.17.1/modules/x-pack-ml/platform/linux-x86_64/bin/controller\n```\n\n> key è¿è¡Œè¿›ç¨‹çš„å…³é”®å­— (å¦‚:ps -ef | grep  tomcat)\n>\n> UID å¯åŠ¨è¿›ç¨‹çš„ç”¨æˆ·å\n>\n> PID  è¿›ç¨‹pid\n>\n> PPID \n>\n> C \n>\n> STIME å¼€å§‹å¯åŠ¨æ—¶é—´ \n>\n> TTY  ç»ˆç«¯å·\n>\n> TIME  è¿è¡Œæ—¶é—´\n>\n> CMD   å¯åŠ¨è¿›ç¨‹çš„å‘½ä»¤\n\n<!--more-->\n\n### æŸ¥æ‰¾è¿›ç¨‹ä½¿ç”¨æƒ…å†µ\n\n```\nps -aux | grep Typora\nUSER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND\ncs  7458  1.2  0.8 4913400 139224 ?      Sl   15:11   0:08 /usr/share/typora/Typora /home/cs/go/ps.md\n\n```\n\n- USER: è¡Œç¨‹æ‹¥æœ‰è€…\n- PID: pid\n- %CPU: å ç”¨çš„ CPU ä½¿ç”¨ç‡\n- %MEM: å ç”¨çš„è®°å¿†ä½“ä½¿ç”¨ç‡\n- VSZ: å ç”¨çš„è™šæ‹Ÿè®°å¿†ä½“å¤§å°\n- RSS: å ç”¨çš„è®°å¿†ä½“å¤§å°\n- TTY: ç»ˆç«¯çš„æ¬¡è¦è£…ç½®å·ç  (minor device number of tty)\n- STAT: è¯¥è¡Œç¨‹çš„çŠ¶æ€:\n  - D: æ— æ³•ä¸­æ–­çš„ä¼‘çœ çŠ¶æ€ (é€šå¸¸ IO çš„è¿›ç¨‹)\n  - R: æ­£åœ¨æ‰§è¡Œä¸­\n  - S: é™æ­¢çŠ¶æ€\n  - T: æš‚åœæ‰§è¡Œ\n  - Z: ä¸å­˜åœ¨ä½†æš‚æ—¶æ— æ³•æ¶ˆé™¤\n  - W: æ²¡æœ‰è¶³å¤Ÿçš„è®°å¿†ä½“åˆ†é¡µå¯åˆ†é…\n  - <: é«˜ä¼˜å…ˆåºçš„è¡Œç¨‹\n  - N: ä½ä¼˜å…ˆåºçš„è¡Œç¨‹\n  - L: æœ‰è®°å¿†ä½“åˆ†é¡µåˆ†é…å¹¶é”åœ¨è®°å¿†ä½“å†… (å®æ—¶ç³»ç»Ÿæˆ–æ±A I/O)\n- START: è¡Œç¨‹å¼€å§‹æ—¶é—´\n- TIME: æ‰§è¡Œçš„æ—¶é—´\n- COMMAND:æ‰€æ‰§è¡Œçš„æŒ‡ä»¤\n\n\n\n#### å†…å­˜\n\n```\n$ ps -aux | sort -k4nr | head -3\nUSER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND\ncs   2119  4.8  1.6 1183553740 265420 ?   Sl   14:02   4:06 /opt/google/chrome/chrome -- ...\ncs   1660  5.1  1.5 34393500 254380 ?     SLl  13:59   4:30 /opt/google/chrome/chrome --...\ncs   1753  1.0  1.4 1179343396 242272 ?   Sl   13:59   0:57 /opt/google/chrome/chrome --...\n```\n\n>a allæ‰€æœ‰\n>\n>u userid,è¯¥è¿›ç¨‹ç”¨æˆ·id\n>\n>x æ‰€æœ‰ç¨‹åº,ä¸å·²ç»ˆç«¯åŒºåˆ†\n>\n>sort æ’åº\n>\n>k ä»£è¡¨ä»ç¬¬å‡ åˆ—å¼€å§‹\n>\n>4n 4åˆ—(%MEM)å¼€å§‹\n>\n>r åå‘(reverse) ,é»˜è®¤ä»å°åˆ°å¤§\n>\n>head  å¤´å‡ åˆ—(-3 ,æ˜¾ç¤ºå‰3åˆ—)\n\n\n\n#### cpu\n\n```\n$ ps -aux | sort -k3nr | head -3\n```\n\n","tags":["shell"],"categories":["linux","shell"]},{"title":"mdè¯­æ³•","url":"/markdown/mdgrammar/","content":"\n\n\n/hexo/_config.yml<a id=\"id-sample\" style=\"display:none\"/>\n\n```\npermalink: :title/\n```\n\n### ç«™å†…æ–‡ç« é“¾æ¥\n\n#### ç»å¯¹è·¯å¾„\n\n/_posts\n\n```\n$ tree -L 2 ./_posts/\n./_posts/\nâ”œâ”€â”€ linux\nâ”‚Â Â  â”œâ”€â”€ debian\nâ”‚Â Â  â”œâ”€â”€ k8s\nâ”‚Â Â  â””â”€â”€ shell\nâ”œâ”€â”€ markdown\nâ”‚Â Â  â”œâ”€â”€ flow.md\nâ”‚Â Â  â”œâ”€â”€ formula.md\nâ”‚Â Â  â””â”€â”€ mdgrammar.md\n\n```\n\n\n\n```\n[ç‚¹å‡»æŸ¥çœ‹mdå†™flowæ–‡ç« ](/markdown/flow)\n```\n\n>[ç‚¹å‡»æŸ¥çœ‹mdå†™flowæ–‡ç« ](/markdown/flow)\n>\n>[] è‡ªå®šä¹‰é“¾æ¥æ ‡é¢˜\n>\n>()ç»å¯¹åœ°å€,permalinkçš„å€¼\n\n#### post_link\n\n```\n{% post_link markdown/flow 'ç‚¹å‡»æŸ¥çœ‹mdå†™flowæ–‡ç« ' %}\n```\n\n> {% post_link markdown/flow 'ç‚¹å‡»æŸ¥çœ‹mdå†™flowæ–‡ç« ' %}\n>\n> post_link ç›¸å¯¹è·¯å¾„ 'æ ‡é¢˜' \n\n\n\n### è·³è½¬\n\n#### é¡µå†…è·³è½¬æŒ‡å®šä½ç½®\n\né”šç‚¹é“¾æ¥\n\n```\n[è·³åˆ°æœ¬é¡µçš„å¼€å¤´](#id-sample)\n```\n\n[è·³åˆ°å¼€å¤´](#id-sample)\n\n#### å…¶ä»–é¡µé¢è·³è½¬åˆ°æŒ‡å®šä½ç½®\n\né”šç‚¹é“¾æ¥\n\n```\n[è·³åˆ°å…¶ä»–é¡µæŒ‡å®šä½ç½®](permalinkçš„å€¼#id-sample)\n```\n\n\n\n#### è®¾ç½®é”šç‚¹\n\n```\né”šç‚¹<a id=\"id-sample\" style=\"display:none\"/>\n```\n\n","tags":["grammar"],"categories":["markdown"]},{"title":"åˆè¯†K8S","url":"/linux/k8s/åˆè¯†K8S/","content":"\n### MasteræœåŠ¡\n\n#### å®‰è£…kubernetes\n\n[å®˜ç½‘ä¸‹è½½kubernetes](https://kubernetes.io/docs/setup/release/notes/)\n\n```\ntar -xvf kubernetes.tar.gz  -C /opt/\n```\n\nä¸‹è½½ Client Binariesï¼ŒServer Binaries\n\n```\nuname -s -m  #è·å–ç‰ˆæœ¬å®˜ç½‘ä¸‹è½½æˆ–æ‰§è¡Œä¸‹é¢å‘½ä»¤ä¸‹è½½\nbash /opt/kubernetes/cluster/get-kube-binaries.sh\n```\n\n <!--more--> \n\n> Kubernetes release: v1.11.0\n>\n> Server: linux/amd64 (to override, set KUBERNETES_SERVER_ARCH)\n>\n> Client: linux/amd64 (autodetected)\n>\n> Will download **kubernetes-server-linux-amd64.tar.gz** from https://dl.k8s.io/v1.11.0\n>\n> Will download and extract **kubernetes-client-linux-amd64.tar.gz** from https://dl.k8s.io/v1.11.0\n>\n> Is this ok? [Y]/n\n\nkubernetes-server\n\n```\ntar -tf   kubernetes-server-linux-amd64.tar.gz  #æŸ¥çœ‹æ–‡ä»¶\ntar -xvf   kubernetes-server-linux-amd64.tar.gz  -C /opt/kubernetes/   --strip-components 1\n```\n\n\n\nkubernetes-client\n\n```\ntar -tf   kubernetes-client-linux-amd64.tar.gz\ntar -xvf   kubernetes-client-linux-amd64.tar.gz  -C /opt/kubernetes/   --strip-components 1\n```\n\n\n\næ‰§è¡Œæ–‡ä»¶(é…ç½®æ–‡ä»¶å¯ä»¥ç›´æ¥è·¯å¾„)\n\n```\nsudo ln -s /opt/kubernetes/server/bin/kube-apiserver  /usr/bin/\nsudo ln -s /opt/kubernetes/server/bin/kube-controller-manager  /usr/bin/\nsudo ln -s /opt/kubernetes/server/bin/kube-scheduler  /usr/bin/\n```\n\n\n\n#### å‡†å¤‡ä¾èµ–æœåŠ¡ etcd\n\n[etcd releasesä¸‹è½½](https://github.com/etcd-io/etcd/releases) å¦‚æœs3.amazonaws.comä¸‹ä¸åŠ¨ã€‚ã€‚ã€‚\n\nè¢«å¢™äº† è¢«å¢™äº† è¢«å¢™äº†\n\ngo ç¼–è¯‘\n\n```\n#mkdir -p $GOPATH/src/go.etcd.io/ \n#cd $GOPATH/src/go.etcd.io/\n#git https://github.com/etcd-io/etcd.git\ncs@debian:~/gopath/etcd$ ./bulid\n```\n\n\n\n> canâ€™t load package: package go.etcd.io/etcd: cannot find package â€œgo.etcd.io/etcdâ€ in any of:\n>\n> /opt/go/src/go.etcd.io/etcd (from $GOROOT)\n>\n> /home/cs/gopath/src/go.etcd.io/etcd (from $GOPATH)\n\n```\n$GOPATH/bin/etcd   #è¿è¡Œ\n$ ETCDCTL_API=3 ./bin/etcdctl put foo bar\nOK\n```\n\n##### åˆ›å»ºç”¨æˆ·\n\n```\nsudo groupadd  -g 995 etcd\nsudo useradd -s /sbin/nologin -M -c \"etcd user\" -u 995 etcd -g  etcd\nsduo mkdir -p /etc/etcd \nsudo mkdir -p /var/lib/etcd \nsudo chown -R etcd.etcd /var/lib/etcd\n```\n\n##### etcd.service\n\n```\n[Unit] \nDescription=Etcd Server \nAfter=network.target \nAfter=network-online.target \nWants=network-online.target \n \n[Service] \nType=notify \nWorkingDirectory=/var/lib/etcd/ \nEnvironmentFile=-/etc/etcd/etcd.conf \nUser=etcd \n# set GOMAXPROCS to number of processors \nExecStart=/bin/bash -c \"GOMAXPROCS=$(nproc) /usr/bin/etcd --name=\\\"${ETCD_NAME}\\\" --data-dir=\\\"${ETCD_DATA_DIR}\\\" --listen-client-urls=\\\"${ETCD_LISTEN_CLIENT_URLS}\\\"\" \nRestart=on-failure \nLimitNOFILE=65536 \n \n[Install] \nWantedBy=multi-user.target\n```\n\n> sudo systemctl start etcd.service\n>\n> è¯¥å‘½ä»¤å¯åŠ¨ä¸äº† /bin/bash -c â€œGOMAXPROCS=$(nproc) /usr/bin/etcd â€“name=\\â€${ETCD_NAME}\\â€ â€“data-dir=\\â€${ETCD_DATA_DIR}\\â€ â€“listen-client-urls=\\â€${ETCD_LISTEN_CLIENT_URLS}\\â€â€\n>\n> sudo systemctl status etcd.service\n>\n> **bash[9841]: run the stateless etcd v3 gRPC L7 reverse proxy\n>\n> debian systemd[1]: etcd.service: main process exited, code=exited, status=2/INVALIDARGUMENT\n>\n> debian systemd[1]: Failed to start Etcd Server.\n> **\n\nè®¾ç½®etcd\nExecStart=/opt/etcd-v3.3.9/etcd\n\n##### å¯åŠ¨etcdæœåŠ¡\n\n```\ntemp=\"etcd.service\"\nsudo cp $temp /lib/systemd/system\nsudo systemctl daemon-reload\nsudo systemctl enable $temp\nsudo systemctl start $temp\nsudo systemctl status $temp\n```\n\n> â— etcd.service - Etcd Server\n>\n> Loaded: loaded (/lib/systemd/system/etcd.service; enabled)\n>\n> Active: active (running) since å…­ 2018-09-08 14:53:26 CST; 5min ago\n> Main PID: 804 (etcd)\n>\n> CGroup: /system.slice/etcd.service\n>\n> â””â”€804 /opt/etcd-v3.3.9/etcd\n\n```\n./etcdctl cluster-health\n```\n\n> member 8e9e05c52164694d is healthy: got healthy result from [http://localhost:2379](http://localhost:2379/)\n>\n> cluster is healthy\n\n#### kube-apiserver\n\n##### åˆ›å»ºç”¨æˆ·\n\n```\nsudo groupadd -g 996 kube\nsudo useradd -s /sbin/nologin -M -c \"kube user\" -u 996 kube -g kube\nsudo mkdir -p /etc/kubernetes\nsudo mkdir -p /usr/libexec/kubernetes\nsudo chown -R kube.kube /usr/libexec/kubernetes\nsudo chown -R kube.kube /var/run/kubernetes\n```\n\n##### kube-apiserver.service\n\n```\n[Unit]\nDescription=Kubernetes API Server\nDocumentation=https://github.com/kubernetes\n#Dependent service\nAfter=etcd.service\n\n[Service]\nEnvironmentFile=-/etc/kubernetes/apiserver\nExecStart=/opt/kubernetes/server/bin/kube-apiserver $KUBE_API_ARGS\nRestart=on-failure\nType=notify\nLimitNOFILE=65536\n\n[Install]\nWantedBy=multi-user.target\n```\n\n> 1.error creating self-signed certificates: mkdir /var/run/kubernetes: permission denied\n>\n> 2.error: â€“[etcd](https://chengshea.github.io/linux/debian/docker/install-kubernetes/#etcd)-servers must be specified\n\né…ç½®\n\n```\nsudo cat>/etc/kubernetes/apiserver<<EOF\nKUBE_API_ARGS=\"--etcd-servers=http://localhost:2379 --insecure-bind-address=0.0.0.0 --insecure-port=8080 --service-cluster-ip-range=169.169.0.0/16 --service-node-port-range=1-65535 --admission-control=NamespaceLifecycle,LimitRanger,SecurityContextDeny,ResourceQuota --logtostderr=false --log-dir=/var/log/kubernetes --v=2\"\nEOF\n```\n\n\n\n> â€“etcd-serversï¼šå°±æ˜¯etcdçš„åœ°å€ã€‚\n>\n> â€“insecure-bind-addressï¼šapiserverç»‘å®šä¸»æœºçš„éå®‰å…¨IPåœ°å€ï¼Œè®¾ç½®0.0.0.0è¡¨ç¤ºç»‘å®šæ‰€æœ‰IPåœ°å€ã€‚\n>\n> â€“insecure-portï¼šapiserverç»‘å®šä¸»æœºçš„éå®‰å…¨ç«¯å£ï¼Œé»˜è®¤ä¸º8080ã€‚\n>\n> â€“service-cluster-ip-rangeï¼šKubernetesé›†ç¾¤ä¸­Serviceçš„è™šæ‹ŸIPåœ°å€æ®µèŒƒå›´ï¼Œä»¥CIDRæ ¼å¼è¡¨ç¤ºï¼Œè¯¥IPèŒƒå›´ä¸èƒ½ä¸ç‰©ç†æœºçœŸå®IPæ®µæœ‰é‡åˆã€‚\n>\n> -service-node-port-rangeï¼šKubernetesé›†ç¾¤ä¸­Serviceå¯æ˜ å°„çš„ç‰©ç†æœºç«¯å£èŒƒå›´ï¼Œé»˜è®¤ä¸º30000~32767.\n>\n> â€“admission-controlï¼š Kubernetesé›†ç¾¤çš„å‡†å…¥æ§åˆ¶è®¾ç½®ï¼Œå„æ§åˆ¶æ¨¡å—ä»¥æ’ä»¶å½¢å¼ä¾æ¬¡ç”Ÿæ•ˆã€‚\n>\n> â€“logtostderrï¼šè®¾ç½®ä¸ºfalseè¡¨ç¤ºå°†æ—¥å¿—å†™å…¥æ–‡ä»¶ï¼Œä¸å†™å…¥stderrã€‚\n>\n> â€“log-dirï¼š æ—¥å¿—ç›®å½•ã€‚\n>\n> â€“vï¼šæ—¥å¿—çº§åˆ«ã€‚\n>\n> [æ›´å¤šå‚æ•°æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£](https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/)\n\n##### å¯åŠ¨\n\n```\ntemp=\"kube-apiserver.service\"\nsudo cp $temp /lib/systemd/system\nsudo systemctl daemon-reload\nsudo systemctl enable $temp\nsudo systemctl start $temp\nsudo systemctl status $temp\n```\n\n> â— kube-apiserver.service - Kubernetes API Server\n>\n> Loaded: loaded (/lib/systemd/system/kube-apiserver.service; disabled)\n>\n> Active: active (running) since å…­ 2018-09-08 15:42:02 CST; 2s ago\n> Docs: https://github.com/GoogleCloudPlatform/kubernetes\n>\n> Main PID: 3560 (kube-apiserver)\n>\n> CGroup: /system.slice/kube-apiserver.service\n>\n> â””â”€3560 /opt/kubernetes/server/bin/kube-apiserver â€“etcd-servers=[http://localhost:2379](http://localhost:2379/) â€¦â€¦.\n\n#### kube-controller-manager\n\n##### kube-controller-manager.service\n\n```\n[Unit]\nDescription=Kubernetes Scheduler Plugin\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=kube-apiserver.service\nRequires=kube-apiserver.service\n\n[Service]\nEnvironmentFile=-/etc/kubernetes/controller-manager\nUser=kube\nExecStart=/opt/kubernetes/server/bin/kube-controller-manager $KUBE_CONTROLLER_MANAGER_ARGS\nRestart=on-failure\nLimitNOFILE=65536\n\n[Install]\nWantedBy=multi-user.target\n```\n\né…ç½®\n\n```\nsudo touch /etc/kubernetes/controller-manager && sudo  chmod 757 /etc/kubernetes/controller-manager\ncat>/etc/kubernetes/controller-manager<<EOF\nKUBE_CONTROLLER_MANAGER_ARGS=\"--master=http://192.168.56.101:8080 --logtostderr=false --log-dir=/var/log/kubernetes --v=2\" \nEOF\n```\n\n\n\n##### å¯åŠ¨\n\n```\ntemp=\"kube-controller-manager.service\"\nsudo cp $temp /lib/systemd/system\nsudo systemctl daemon-reload\nsudo systemctl enable $temp\nsudo systemctl start $temp\nsudo systemctl status $temp\n```\n\n> â— kube-controller-manager.service - Kubernetes Scheduler Plugin\n>\n> Loaded: loaded (/lib/systemd/system/kube-controller-manager.service; disabled)\n>\n> Active: active (running) since å…­ 2018-09-08 16:54:32 CST; 2s ago\n>\n> Docs: https://github.com/GoogleCloudPlatform/kubernetes\n>\n> Main PID: 5980 (kube-controller)\n>\n> CGroup: /system.slice/kube-controller-manager.service\n>\n> â””â”€5980 /opt/kubernetes/server/bin/kube-controller-manager â€“master=[http://localhost:8080](http://localhost:8080/) â€¦â€¦\n\n#### kube-scheduler\n\n##### kube-scheduler.service\n\n```\n[Unit]\nDescription=Kubernetes Scheduler Manager\nDocumentation=https://github.com/kubernetes\nAfter=kube-apiserver.service\nRequires=kube-apiserver.service\n\n[Service]\nEnvironmentFile=/etc/kubernetes/scheduler\nExecStart=/opt/kubernetes/server/bin/kube-scheduler $KUBE_SCHEDULER_ARGS\nRestart=on-failure\nLimitNOFILE=65536\n\n[Install]\nWantedBy=multi-user.target\n```\n\né…ç½®\n\n```\nsudo touch /etc/kubernetes/scheduler && sudo  chmod 757 /etc/kubernetes/scheduler\ncat>/etc/kubernetes/scheduler<<EOF\nKUBE_SCHEDULER_ARGS=\"--master=http://localhost:8080 --logtostderr=false --log-dir=/var/log/kubernetes --v=2\"\nEOF\n```\n\n\n\n##### å¯åŠ¨\n\n```\ntemp=\"kube-scheduler.service\"\nsudo cp $temp /lib/systemd/system\nsudo systemctl daemon-reload\nsudo systemctl enable $temp\nsudo systemctl start $temp\nsudo systemctl status $temp\n```\n\n> â— kube-scheduler.service - Kubernetes Scheduler Manager\n>\n> Loaded: loaded (/lib/systemd/system/kube-scheduler.service; disabled)\n>\n> Active: active (running) since å…­ 2018-09-08 17:02:09 CST; 7s ago\n>\n> Docs: https://github.com/kubernetes\n> Main PID: 6340 (kube-scheduler)\n>\n> CGroup: /system.slice/kube-scheduler.service\n>\n> â””â”€6340 /opt/kubernetes/server/bin/kube-scheduler â€“master=[http://localhost:8080](http://localhost:8080/) â€¦â€¦\n\n### NodeèŠ‚ç‚¹æœåŠ¡\n\n#### kubelet\n\n##### kubelet.service\n\n```\n[Unit]\nDescription=Kubernetes Kubelet Server\nDocumentation=https://github.com/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nWorkingDirectory=-/var/lib/kubelet\nEnvironmentFile=-/etc/kubernetes/kubelet\nExecStart=/opt/kubernetes/server/bin/kubelet $KUBELET_ARGS  \nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\n```\n\n> kubelet.service holdoff time over, scheduling restart\n\né…ç½®\n\n```\nsudo mkdir -p /var/lib/kubelet\nsudo touch /etc/kubernetes/kubelet && sudo  chmod 757 /etc/kubernetes/kubelet\ncat>/etc/kubernetes/kubelet<<EOF\nKUBELET_ARGS=\"--kubeconfig=/etc/kubernetes/kubeconfig --hostname-override=127.0.0.1 --logtostderr=false --log-dir=/var/log/kubernetes --v=2\"\nEOF\n```\n\n\n\n> [â€“kubeconfigä»£æ›¿äº†â€“api-servers](https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/)\n>\n> \n> â€“[require-kubeconfig 1.7ç‰ˆå¼€å§‹é»˜è®¤true ](https://github.com/kubernetes/kubernetes/issues/36745)\n>\n> Kubernetes 1.8å¼€å§‹è¦æ±‚å…³é—­ç³»ç»Ÿçš„Swap\n\n##### å¯åŠ¨\n\n```\ntemp=\"kubelet.service\"\nsudo cp $temp /lib/systemd/system\nsudo systemctl daemon-reload\nsudo systemctl enable $temp\nsudo systemctl start $temp\nsudo systemctl status $temp\n```\n\n> â— kubelet.service - Kubernetes Kubelet Server\n>\n> Loaded: loaded (/lib/systemd/system/kubelet.service; disabled)\n>\n> Active: active (running) since äºŒ 2018-09-11 18:34:48 CST; 29ms ago\n>\n> Docs: https://github.com/kubernetes\n> Main PID: 9018 (kubelet)\n>\n> CGroup: /system.slice/kubelet.service\n>\n> â””â”€9018 /opt/kubernetes/server/bin/kubelet â€“kubeconfig=/etc/kubernetes/kubeconfig â€“hostname-override=127.0.0.1 â€“logtostderr=false â€“log-dir=/var/log/kubernetes â€“v=2 â€“cgroup-driver=systemd\n\n#### kube-proxy\n\n##### kube-proxy.service\n\n```\n[Unit]\nDescription=Kubernetes Kube-Proxt Server\nDocumentation=https://github.com/kubernetes\nAfter=network.target\nRequires=network.target\n\n[Service]\nEnvironmentFile=-/etc/kubernetes/proxy\nExecStart=/opt/kubernetes/server/bin/kube-proxy $KUBE_PROXY_ARGS\nRestart=on-failure\nLimitNOFILE=65536\n\n[Install]\nWantedBy=multi-user.target\n```\n\né…ç½®\n\n```\nsudo touch /etc/kubernetes/proxy && sudo  chmod 757 /etc/kubernetes/proxy\ncat>/etc/kubernetes/proxy<<EOF\nKUBE_PROXY_ARGS=\"--master=http://localhost:8080  --logtostderr=false --log-dir=/var/log/kubernetes --v=2\"\nEOF\n```\n\n\n\n##### å¯åŠ¨\n\n```\ntemp=\"kube-proxy.service\"\nsudo cp $temp /lib/systemd/system\nsudo systemctl daemon-reload\nsudo systemctl enable $temp\nsudo systemctl start $temp\nsudo systemctl status $temp\n./kubectl get cs\n./kubectl get node\n```","tags":["docker","k8s"],"categories":["linux","docker"]},{"title":"å†…ç½‘ç©¿é€","url":"/network/å†…ç½‘ç©¿é€/","content":"\n### ngrok\n\næä¾›å†…ç½‘ç©¿é€æœåŠ¡ï¼Œå¯ä»¥åœ¨è‡ªå·±ä¸»æœºéƒ¨ç½²æœåŠ¡ä¾›å¤–ç½‘è®¿é—®\n\nåŒç±»äº§å“ï¼š [èŠ±ç”Ÿå£³](https://hsk.oray.com/download/) ï¼Œ[nat123](http://www.nat123.com/Pages_2_32.jsp)\n\nå®˜ç½‘ https://ngrok.com/\n\ngithub https://github.com/inconshreveable/ngrok\n\n### å®‰è£…\n\nå®˜ç½‘æ³¨å†Œ[è·å–authtoken](https://dashboard.ngrok.com/get-started)\n\nç”Ÿæˆé…ç½®\n\n```\n./ngrok authtoken   ********\n`\n```\n\n <!--more--> \n\n> Authtoken saved to configuration file:***.ngrok2/ngrok.yml\n>\n> é»˜è®¤è·¯å¾„ https://ngrok.com/docs#default-config-location\n>\n> è¿è¡Œ\n>\n> ```\n> ./ngrok http 8010\n> ```\n>\n> \n>\n> è®¿é—® http://localhost:4040/\n\n### è‡ªå®šä¹‰\n\néš§é“å®šä¹‰å‚æ•°è¯¦è§£ https://ngrok.com/docs#tunnel-definitions\n\næ¯ä¸ªéš§é“éƒ½å¿…é¡»å®šä¹‰\n\n- proto éœ€è¦ æ‰€æœ‰ éš§é“åè®®åç§°ï¼Œä¸­çš„ä¸€ä¸ªhttpï¼Œtcpï¼Œtls\n- addr éœ€è¦ æ‰€æœ‰ è½¬å‘æµé‡åˆ°è¿™ä¸ªæœ¬åœ°ç«¯å£å·æˆ–ç½‘ç»œåœ°å€\n\nç¤ºä¾‹é…ç½® https://ngrok.com/docs#config-examples\n\n**ngrok.cfg**\n\n```\nauthtoken: **************\ntunnels:\n  httpbin:\n    proto: http\n    addr: 8090\n    #subdomain: dev.com #å­åŸŸåè¯·æ±‚ æ”¶è´¹\n```\n\n\n\nå¯åŠ¨\n\n```\n#é»˜è®¤é…ç½®\n./ngrok start httpbin\n#æŒ‡å®šé¢å¤–é…ç½®æ–‡ä»¶\n./ngrok start  -config ./ngrok.cfg   httpbin\n```","tags":["ngrok","å†…ç½‘ç©¿é€"],"categories":["other","network"]},{"title":"è¯„è®º","url":"/lang/node/npm/hexo/è¯„è®º/","content":"\n### ç”±æ¥\n\n[gitment](https://github.com/imsun/gitment)ä½¿ç”¨ **github issue** ä¿å­˜è¯„è®º\n\n### å‡†å¤‡\n\nå³é”®æ–°æ ‡ç­¾é¡µæ‰“å¼€ https://github.com/settings/applications/new\n\nåˆ›å»º\n![app-id](http://ojtd6k176.bkt.clouddn.com/github-new-app.png)\n\nè·å– id secret\n![å‚æ•°](http://ojtd6k176.bkt.clouddn.com/github-app-id.png)\n\n### hexo Theme\n\næ ¹æ® *ä¸ªäººä¸»é¢˜* æ·»åŠ \n\n#### æ ·å¼\n\nsource/css/gitment.css\n\n- css [è¯¦æƒ…å³é”®æ–°æ ‡ç­¾é¡µ](https://github.com/chengshea/record/blob/master/issue/gitment.css)\n\nsource/js/gitment.js\n\n- js [è¯¦æƒ…å³é”®æ–°æ ‡ç­¾é¡µ](https://github.com/chengshea/record/blob/master/issue/gitment.js)\n\n#### å¸ƒå±€è°ƒç”¨\n <!--more--> \nè°ƒç”¨è®¤è¯\n/layout/_partial/comments/gitment.ejs\n\n```\n<div id=\"gitment\"></div>\n<!-- ä¸»é¡µä¸è¦åŠ è½½gitment -->\n<%if (!index){ %>\n<script>\nvar gitment = new Gitment({\nowner: 'chengshea',\nrepo: 'chengshea.github.io',\noauth: {\nclient_id: '3478952f5e3ade06xxxxx',\nclient_secret: '3ca8b3ada58c7993cbb385839f83ba8xxxxxx',\n },\n})\ngitment.render('gitment')\n</script>\n<% } %>\n```\n\n\n\næ·»åŠ è¯„è®º\n/layout/_partial/article.ejs\n\n```\n<% if (!index && post.comments){ %>\n    <%  if (theme.gitment.on) { %>\n        <%- partial('comments/gitment') %>\n    <% } else if (theme.disqus.on) { %>\n        <%- partial('comments/disqus', {\n            shortname: theme.disqus.shortname\n          }) %>\n    <% } else if (config.disqus_shortname) { %>\n        <%- partial('comments/disqus', {\n            shortname: config.disqus_shortname\n          }) %>\n    <% } %>\n<% } %>\n```\n\n\n\n**_config.yml** é…ç½®æ·»åŠ gitmentå¼€å¯\n\n```\ngitment:\n       on: true\n       enable: true\n       owner: chengshea\n       repo: chengshea.github.io\n       client_id: 3478952f5e3adexxxxx\n       client_secret: 3ca8b3ada58c7993cbb385839f83bxxxxx\n```\n\n\n\nç®¡ç†OAuth Apps\n\nhttps://github.com/settings/developers","tags":["issues"],"categories":["other"]},{"title":"ä¸Šç½‘","url":"/network/on-line/","content":"\n### å‡†å¤‡\n  æœ‰æ—¶å€™å› å·¥ä½œéœ€è¦ï¼ŒæŸ¥è¯¢èµ„æ–™ï¼Œä¸‹è½½ï¼Œå°±éœ€è¦ä¸Šç½‘\n\n  **linux ç¯å¢ƒä¸‹**\n  * pip \n  * shadowsocks\n\n\n### å®‰è£…\npip\n```\nwget https://bootstrap.pypa.io/get-pip.py\npython get-pip.py\n```\nshadowsocks\n```\n$sudo pip install shadowsocks \n```\n <!--more--> \n### é…ç½®\n####  æœåŠ¡ç«¯\nss.json\n```json\n{\n    \"server\":\"server_ip\",\n    \"server_port\":8888,\n    \"local_address\": \"127.0.0.1\",\n    \"local_port\":1080,\n    \"password\":\"mypassword\",\n    \"timeout\":300,\n    \"method\":\"aes-256-cfb\",\n    \"fast_open\": false\n}\n```\nå¤šå·\n```json\n{\n    \"server\": \"server_ip\",\n    \"local_address\": \"127.0.0.1\",\n    \"local_port\": 1080,\n    \"port_password\": {\n        \"8881\": \"aaaa81\",  \n        \"8882\": \"aaaa82\",\n        \"8883\": \"aaaa83\",\n        \"8884\": \"aaa84\"\n    },\n    \"timeout\": 300,\n    \"method\": \"aes-256-cfb\",\n    \"fast_open\": false\n}\n```\n\n\n**ssserver --help**\n\n` -d start/stop/restart`\n```\nssserver  -c  /xx/ss.json  -d start\n```\n\n#### å®¢æˆ·ç«¯\nss.json\n```\n$cat  /xx/ss.json\n{\n    \"server\": \"server_ip\",\n    \"server_port\": 443,\n    \"password\": \"mypassword\",\n    \"method\": \"aes-256-cfb\",\n    \"remarks\": \"\"\n}\n```\n\n**sslocal --help**\n```\nsslocal -c  /xx/ss.json\n```\n\n### è¿è¡ŒåŸç†\n![proxy](http://ojtd6k176.bkt.clouddn.com/proxy-12.56.png)\n* é¦–å…ˆé€šè¿‡SS Localå’ŒVPSè¿›è¡Œé€šä¿¡ï¼Œé€šè¿‡Socks5åè®®è¿›è¡Œé€šä¿¡ <br/>\n* SS Localè¿æ¥åˆ°VPSï¼Œ å¹¶å¯¹Socks5ä¸­ä¼ è¾“çš„æ•°æ®è¿›è¡Œå¯¹ç§°åŠ å¯†ä¼ è¾“ï¼Œä¼ è¾“çš„æ•°æ®æ ¼å¼æ˜¯SSçš„åè®®\n* SS Serveræ”¶åˆ°è¯·æ±‚åï¼Œå¯¹æ•°æ®è§£å¯†ï¼ŒæŒ‰ç…§SSåè®®æ¥è§£ææ•°æ®ã€‚\n* SS Serveræ ¹æ®åè®®å†…å®¹è½¬å‘è¯·æ±‚ã€‚\n* SS Serverè·å–è¯·æ±‚ç»“æœåå›ä¼ ç»™SS Local\n* SS Localè·å–ç»“æœå›ä¼ ç»™åº”ç”¨ç¨‹åº\nä¸‹é¢2è€…å¿…é¡»åŒæ—¶æ»¡è¶³\n\n1.ä»£ç†æœåŠ¡å™¨æœ¬åœ°å¯ä»¥è®¿é—®åˆ°;\n\n2.ä»£ç†æœåŠ¡å™¨å¯ä»¥è®¿é—®ç›®æ ‡ç½‘ç«™ã€‚\n\n### å¯åŠ¨\nå°è„šæœ¬ï¼Œå†æ¬¡åæ§½qtå®¢æˆ·ç«¯ï¼Œå¤ªé‡äº†\n```\n#!/bin/bash\n\nvar=''\ncd /opt/Shadowsocks\nname=`whoami`\n\nif [ ! -d '/home/$name/ss' ];then\n   mkdir ~/ss\nfi\n \nfunction state(){\n  var=$(ps -ef | grep sslocal | grep -v grep | awk '{print $2}')\n}\n\nstate\n\nif test -z $var ;then\n  sslocal -c  $PWD/ss.json >>~/ss/log 2>&1 &\nelse\n  echo \"kill ---$var\"\n  kill -9 $var\n  state\n  if test -z $var ;then rm -r ~/ss ;fi\nfi  \n```\n\n","tags":["online"],"categories":["other"]},{"title":"shield","url":"/services/elk/es-shield/","content":"\n### ç®€ä»‹\n  **Shield**æ‹¦æˆªæ‰€æœ‰å¯¹ElasticSearchçš„è¯·æ±‚ï¼Œå¹¶åŠ ä¸Šè®¤è¯ä¸åŠ å¯†ï¼Œä¿éšœElasticSearchåŠç›¸å…³ç³»ç»Ÿçš„å®‰å…¨æ€§\n  \n  [<span id='top'>å®‰è£… doc</span>]( https://www.elastic.co/guide/en/shield/2.4/installing-shield.html)\n \n### å‡†å¤‡\n\nç‰ˆæœ¬2.4.2{% post_link å®‰è£…ElasticSearch å®‰è£…ElasticSearch %}\n <!--more--> \n**ä»¥ä¸‹æ“ä½œéœ€è¦ä½ å®‰è£…äº†elasticsearchä¸ºå‰æ**\n\n\n\n* [license-2.4.2](https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/license/2.4.2/license-2.4.2.zip)\n* [shield-2.4.2](https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/shield/2.4.2/shield-2.4.2.zip)\n\n### å®‰è£…\n**ä»¥esï¼Œæ’ä»¶ä¸º<span id='custom'>è‡ªå®šä¹‰</span>ç›®å½•ä¸ºèƒŒæ™¯**\n\nesè‡ªå®šä¹‰ç›®å½•**/opt/elasticsearch**\n\nå®‰è£…è„šæœ¬**plugin**æ³¨æ„ä¸‹é¢å˜é‡å€¼\n\n* CONF_DIR (elasticsearch.ymlç›®å½•)\n `CONF_DIR=\"/opt/elasticsearch/config\"`\n* ES_ENV_FILE (elasticsearchç›®å½•)\n `ES_ENV_FILE=\"/opt/elasticsearch/config/default/elasticsearch\"`\n\nlicense\n```\ncs@debian:/opt/elasticsearch$ bin/plugin install file:///home/cs/Download/license-2.4.2.zip\n```\n>Installed license into /home/cs/Download/es/plugins/license\n\n\nshield\n```\ncs@debian:/opt/elasticsearch$ bin/plugin install file:///home/cs/Download/shield-2.4.2.zip\n```\n >Installed license into /home/cs/Download/es/plugins/shield\n \nå®‰è£…æˆåŠŸç›®å½•ï¼ˆéƒ¨åˆ†ï¼‰\n```\ncs@debian:/opt/elasticsearch$ tree -L 3 /opt/elasticsearch\n/opt/elasticsearch\nâ”œâ”€â”€ bin\nâ”‚   â”œâ”€â”€ elasticsearch\nâ”‚   â”œâ”€â”€ elasticsearch.in.sh\nâ”‚   â”œâ”€â”€ elasticsearch-systemd-pre-exec\nâ”‚   â”œâ”€â”€ plugin\nâ”‚   â”œâ”€â”€ shield\nâ”‚   â”‚   â”œâ”€â”€ esusers  æ·»åŠ è§’è‰²å¯†ç è„šæœ¬\nâ”‚   â”‚   â”œâ”€â”€ esusers.bat\nâ”‚   â”‚   â”œâ”€â”€ migrate\nâ”‚   â”‚   â”œâ”€â”€ migrate.bat\nâ”‚   â”‚   â”œâ”€â”€ syskeygen\nâ”‚   â”‚   â””â”€â”€ syskeygen.bat\nâ”‚   â””â”€â”€ watcher\nâ”‚       â”œâ”€â”€ croneval\nâ”‚       â””â”€â”€ croneval.bat\nâ”œâ”€â”€ config\nâ”‚   â”œâ”€â”€ default\nâ”‚   â”‚   â””â”€â”€ elasticsearch\nâ”‚   â”œâ”€â”€ elasticsearch.yml\nâ”‚   â”œâ”€â”€ logging.yml\nâ”‚   â”œâ”€â”€ scripts\nâ”‚   â””â”€â”€ shield\nâ”‚       â”œâ”€â”€ logging.yml\nâ”‚       â”œâ”€â”€ role_mapping.yml\nâ”‚       â”œâ”€â”€ roles.yml\nâ”‚       â”œâ”€â”€ users\nâ”‚       â””â”€â”€ users_roles\nâ”œâ”€â”€ lib\n```\n\n### æ·»åŠ æ–°ç”¨æˆ·\n\næ‰§è¡Œè„šæœ¬**esusers**éœ€è¦æ³¨æ„å‚æ•°\n* CONF_DIR ( åˆ¤æ–­ $CONF_DIR/shield ç›®å½•)\n   åé¢å¯†ç ä¼šå†™å…¥åˆ°é…ç½®æ–‡ä»¶ï¼ˆusersusers_rolesï¼‰å†…\n* ES_CLASSPATH (shield ç”Ÿæˆå¯†ç çš„æ‰§è¡Œç±»)\n  ```\n  java -cp org.elasticsearch.shield.authc.esusers.tool.ESUsersTool\n  ```\n  \nESUsersToolç±»åœ¨shieldæ’ä»¶ç›®å½•**shield-2.4.2.jar**\n  \n  **æ³¨æ„** [è‡ªå®šä¹‰ç›®å½•](#custom)å³ *plugins* ä¸å† *ES_HOME* ç›®å½•ä¸‹ï¼Œæ‰§è¡Œè„šæœ¬éœ€è¦ç¡®è®¤**ES_CLASSPATH**ä½ç½®æ­£ç¡®\n  \n  1.æ·»åŠ å˜é‡ ES_PLUGIN\n  ```shell\n  ES_PLUGIN=`dirname $(sed -n 's/path.plugins://p'  $ES_HOME/config/elasticsearch.yml)`\n```\n   2.ä¿®æ”¹\n  ```shell\n#ES_CLASSPATH=\"$ES_CLASSPATH:$ES_HOME/plugins/shield/*\"\nES_CLASSPATH=\"$ES_CLASSPATH:$ES_PLUGIN/plugins/shield/*\"  \n```\n\n<br/>\n\næ‰§è¡Œæ·»åŠ å‘½ä»¤[æ–‡æ¡£](#top)\n```\ncs@debian:/opt/elasticsearch$ ./bin/shield/esusers useradd cs -p cs@121 -r admin\n```\n>useradd æ·»åŠ çš„æ–°ç”¨æˆ·å cs <br/>\n-p  å¯†ç    cs@121    <br/>\n-r  è§’è‰²ï¼ˆroleï¼‰ admin  <br/>\n\nå¯åŠ¨\n```\ncs@debian:/opt/elasticsearch$ ./bin/elasticsearch -d\n```\n>cs@debian:`$ curl -u cs  \"http://localhost:9200/?pretty\"  <br/>\nEnter host password for user 'cs': <br/>\n{ <br/>\n  \"name\" : \"Sepulchre\",<br/>\n  \"cluster_name\" : \"elasticsearch\",<br/>\n  \"cluster_uuid\" : \"Ey7sWEIPRZGstn2LSKCCTQ\",<br/>\n  \"version\" : {<br/>\n    \"number\" : \"2.4.2\",<br/>\n    \"build_hash\" : \"161c65a337d4b422ac0c805f284565cf2014bb84\",<br/>\n    \"build_timestamp\" : \"2016-11-17T11:51:03Z\",<br/>\n    \"build_snapshot\" : false,<br/>\n    \"lucene_version\" : \"5.5.2\"<br/>\n  },<br/>\n  \"tagline\" : \"You Know, for Search\"<br/>\n}\n\n\n### æ€»ç»“\næ³¨æ„è„šæœ¬è¿è¡Œï¼Œä¸»è¦å‚æ•°ï¼ˆå˜é‡ï¼‰å€¼\n","tags":["auth","safe"],"categories":["ELK","elasticsearch"]},{"title":"git server æ­å»º","url":"/tool/git-server/","content":"## å‡†å¤‡\n*    ssh\n*    git \n\n\n## gitosis\n### æ·»åŠ ç”¨æˆ·\nä»“åº“æœåŠ¡å™¨æ‰§è¡Œ\n```\nuseradd git\nmkdir -p /home/git\nchown -R git:git /home/git\n```\n\nå¯†é’¥\n```\ncp  ~/.ssh/id_rsa.pub   /tmp/git.pub\n```\n <!--more--> \n### å®‰è£…\n\n```\ngit clone git://github.com/res0nat0r/gitosis.git\ncd gitosis\npython setup.py install\n```\n\nåˆå§‹åŒ–\n```\nsu  git\ngitosis-init < ~/.ssh/id_rsa.pub\n```\n\n### ç®¡ç†\næ‹‰å–\n```\n$git clone git@192.168.16.232:repositories/gitosis-admin.git\n$ tree -L 2 gitosis-admin\ngitosis-admin\nâ”œâ”€â”€ gitosis.conf\nâ””â”€â”€ keydir\n    â””â”€â”€ git@ubuntu.pub\n```\né…ç½®å¯†é’¥\n```\ncp ~/.ssh/id_rsa.pub  gitosis-admin/keydir/cs.pub\n```\næ·»åŠ æƒé™ **gitosis.conf**\n```\n[group dev]  \nmembers = cs #è¿™é‡Œçš„cså¯¹ä¸Šé¢å…¬åŒ™cs.pubæ–‡ä»¶åcs  \nwritable = test #é¡¹ç›®åtest\n```\n\n### <span id=\"pull\">æµ‹è¯•æ‹‰å–</span>\n\n```\nmkdir  test && cd test\necho \"æµ‹è¯•testä»“åº“\">rep\ngit init\ngit add .\ngit  commit -am \"add test\"\ngit remote add origin git@192.168.16.232:test.git\ngit  push origin master\n```\n> æç¤ºè¦å¯†ç  <br />\nè®¾ç½®å¯†ç ï¼ˆrootç”¨æˆ·æ“ä½œï¼‰\n```\npasswd gits\n2æ¬¡ 123456\n```\næˆ–\n```\nsu gits\necho \"ä½ çš„å¯†é’¥\">>~/.ssh/authorized_keys\n```\n\n\n## gitolite\n### æ·»åŠ ç”¨æˆ·\nä»“åº“æœåŠ¡å™¨æ‰§è¡Œ\n```\nuseradd gits\nmkdir -p /home/gits\nchown -R gits:gits  /home/gits\n```\n\nåˆå§‹åŒ–\n```\n$ cp  ~/.ssh/id_rsa.pub   /tmp/git.pub\n$ su gits\n$ git clone https://github.com/sitaramc/gitolite\n$ gitolite/install -to $HOME/bin\n$ ~/bin/gitolite setup -pk /tmp/git.pub\n```\n\n**å¯†ç **\n\nè§gitosisæµ‹è¯•[æ‹‰å–](#pull)çš„æ“ä½œ\n\n\n### ç®¡ç†\næœ¬åœ°æ‹‰å–\n```shell\ngit clone gits@192.168.16.232:repositories/gitolite-admin\n```\n> æ­£å…‹éš†åˆ° 'gitolite-admin'...  <br />\ngits@192.168.16.232's password:  <br />\nremote: Counting objects: 6, done. <br />\nremote: Compressing objects: 100% (4/4), done. <br />\nremote: Total 6 (delta 0), reused 0 (delta 0)\næ¥æ”¶å¯¹è±¡ä¸­: 100% (6/6), å®Œæˆ. <br />\næ£€æŸ¥è¿æ¥... å®Œæˆã€‚ <br />\n\næŸ¥çœ‹ç›®å½•\n```\n$ tree -L 2  gitolite-admin\ngitolite-admin\nâ”œâ”€â”€ conf\nâ”‚   â””â”€â”€ gitolite.conf\nâ””â”€â”€ keydir\n    â””â”€â”€ git.pub\n```\ncpå¯†é’¥ï¼Œé…ç½®æƒé™\n```\n$ cat  gitolite-admin/conf/gitolite.conf \nrepo gitolite-admin\n    RW+     =   git\n\nrepo testing\n    RW+     =   @all\n```\n> RW+  æ‰€æœ‰æƒé™  <br />\ndoc: https://github.com/sitaramc/gitolite#access-rule-examples <br />\n\n\næœ€å\n```\ngit add .\ngit commit -am \"add new user xx\"\ngit push origin master\n```\n>æ›´å¤šé«˜çº§é…ç½®åœ¨/home/gits/.gitolite.rc\n\n\n## gogs\nå®˜ç½‘ https://try.gogs.io/\n\nå¸¦**UI**çš„æœåŠ¡ï¼Œéƒ¨ç½²æ–¹ä¾¿ï¼Œè½»é‡çº§\n\ngitlabå¤ªå å†…å­˜äº†ï¼Œäº‘æœåŠ¡å™¨è·‘æˆæœ¬é«˜å‘€\n```\n# Pull image from Docker Hub.\n$ docker pull gogs/gogs\n\n# Create local directory for volume.\n$ mkdir -p /var/gogs\n\n# Use `docker run` for the first time.\n$ docker run --name=gogs -p 10022:22 -p 10080:3000 -v /var/gogs:/data gogs/gogs\n\n# Use `docker start` if you have stopped it.\n$ docker start gogs\n```\n>doc https://github.com/gogits/gogs/tree/master/docker#usage\n","tags":["git"],"categories":["tools"]},{"title":"git pull","url":"/tool/git-pull/","content":"### pull\nç¨€ç–æ£€å‡º*sparse checkout*\n <!--more--> \n```\n#!/bin/bash\n\nprint_help() {\n  cat <<EOF\n  use params \n   -h , --help   è¯´æ˜   ä¸æ”¯æŒåˆ†æ”¯\n   -u , --url   *å¿…é¡»ï¼Œä¸‹è½½æ–‡ä»¶çš„é“¾æ¥ï¼ˆå¦‚https:://github.io/xx/tree/master/a/b ,ä¸‹è½½bï¼‰\n  \n\nEOF\n}\n\nfunction src(){\n   if [[ \"$1\" =~ \"github.com\" ]] || [[ \"$1\" =~ \"gitee.com\" ]];then\n     echo \"downloadUrl--> $1\"\n   else \n     echo \"ä¸æ”¯æŒ\"\n     exit 1\n   fi\n}\n\nwhile [ $# -ge 0 ]; do\n    case $1 in\n        -h|--help)\n           print_help  \n           exit 1\n            ;;\n        -u|--url)\n              src $2\n              break \n            ;;\n         *  )\n           echo \"use param -h or --help !\"  \n           exit 1\n            ;;\n    esac\ndone\nfunction type(){\n   uri=$(echo $1 | grep \"/tree/master/\" | grep -v grep)\n   echo \"---$uri\"\n   if [[ $uri != \"\" ]];then\n     echo \"-------/tree/master\"\n     uri=${url%/tree/master*}\".git\"\n     down=${url#*/tree/master/}\n   else\n     echo \"-------/blob/master\"\n     uri=$(echo $1 |grep -v grep | grep \"/blob/master/\")\n     if [[ $uri != \"\" ]];then\n       uri=${url%/blob/master*}\".git\"\n       down=${url#*/blob/master/}\n     else\n       echo \"åªæ”¯æŒæ‹‰å–masteræ–‡ä»¶ä¸‹è½½\"\n       exit 1\n     fi\n   fi \n}\n\nurl=$2\n\nfile=${url##*/}\n\nuri=\ndown=\ntype $2\n \n\nif [ ! -f \"$file\" ];then\n\tmkdir $file\nfi\ncd $file\n\ngit init\necho \"==================æ·»åŠ  æº===================\"\ngit remote add -f origin $uri \n#ç¨€ç–æ£€å‡º\ngit config core.sparsecheckout true\n#æ‹‰å–æ–‡ä»¶\necho \"$down\">>.git/info/sparse-checkout\necho \"==================å¼€å§‹æ‹‰å–===================\"\ngit pull origin master\n \nrm -rf .git\nmv $file/*  . && rm -r $file\n\n\necho \"==================$PWD===================\"\t\n```\n>åˆ©ç”¨gitç¨€ç–æ£€å‡ºæ‹‰å–éƒ¨åˆ†æ–‡ä»¶\n\n### jså®ç°ä¸‹è½½\n[kinolien gitzip ](http://kinolien.github.io/gitzip/)","tags":["git"],"categories":["tools"]},{"title":"avd","url":"/other/avd/","content":"\n### åˆ›å»ºAVDå¤±è´¥\n \n see log æŸ¥çœ‹æ—¥å¿—\n ```\n WARN - vdmanager.AvdManagerConnection - Failed to create the SD card. \n WARN - vdmanager.AvdManagerConnection - Failed to create sdcard in the     AVD folder.\n ```\n \n#### ç›®å½•æƒé™\n```\ncs@debian:~/repository/Android/sdk$ chmod +x tools/*\ncs@debian:~/repository/Android/sdk$ chmod +x platform-tools/*\n```\n\n#### å®‰è£…\n```\nsudo apt-get install  lib32z1 lib32ncurses5 #ä»£æ›¿ia32-libs  \n```\nåˆ›å»ºæç¤º\n>/sdk/emulator/mksdcard: error while loading shared libraries: libgcc_s.so.1: cannot open shared object file: No such file or directory \n\n```\ncs@debian:~$ locate libgcc_s.so.1\n/lib/x86_64-linux-gnu/libgcc_s.so.1\n```\n å¯ä»¥çœ‹åˆ°ç³»ç»Ÿx86_64 ä¸æ”¯æŒ32\n> WARN - vdmanager.AvdManagerConnection - /home/cs/repository/Android/sdk/emulator/mksdcard: error while loading shared libraries: libgcc_s.so.1: cannot open shared object file: No such file or directory \nerror while loading shared libraries: libgcc_s.so.1: wrong ELF class: ELFCLASS64 \n\n <!--more--> \n\næœç´¢[libgcc_s.so.1](https://pkgs.org/download/libgcc_s.so.1)\n\næ²¡æœ‰æ‰¾åˆ°deb,ä¸‹è½½çš„rpm\n```\nrpm2cpio  libgcc-4.1.2-55.el5.i386.rpm  | cpio -div\n```\nè§£å‹å\n```\nsudo ln -s /home/cs/repository/Android/sdk/lib32/libgcc_s.so.1  /lib/\n```\nåˆ›å»ºAVDæˆåŠŸ**ç­‰å¾…è¿‘2åˆ†é’Ÿåå‡ºç°**\n>Error while waiting for device: Timed out after 300seconds waiting for emulator to come online.\n\n#### æœ€ç»ˆè§£å†³æ–¹æ³•\n**SDK tools > SDK Tools** å‹¾é€‰ **Android Emulator** \n\n**è™šæ‹ŸåŒ–åº”ç”¨** *VirtualBox* *docker* ç­‰ï¼Œä¸avdä¸èƒ½åŒæ—¶å¼€å¯\n\n **Tools - Android** å‹¾é€‰å–æ¶ˆ *Enable ADB Integration* ï¼ˆå¯¹æˆ‘æ— ç”¨ï¼‰\n \nGraphicsé€‰é¡¹ï¼Œ**Software**è€Œä¸æ˜¯Automaticæˆ–Hardware","tags":["android","Simulator"],"categories":["linux","install"]},{"title":"docker-compose","url":"/linux/k8s/compose/","content":"#### å®‰è£… \ngitä¸‹è½½åœ°å€:https://github.com/docker/compose/releases\n\næ¨èpipå®‰è£…\n```\nsudo pip install -U docker-compose\nchmod +x /usr/local/bin/docker-compose\ndocker-compose -version\n```\n  <!--more--> \n#### ä½¿ç”¨\n>build\n\næŒ‡å®šDockerfile æ–‡ä»¶,composeä¼šåˆ©ç”¨å®ƒè‡ªåŠ¨æ„å»º\n```\nbuild: /path\n```\n> command\n\nè¦†ç›–å®¹å™¨å¯åŠ¨åé»˜è®¤å‘½ä»¤\n```\ncommand:\n       - \"python\" \n       - \"neural_style.py\" \n       - \"--content\" \n       - \"/neural/input.jpg\" \n```\n> links\n\né“¾æ¥å…¶å®ƒæœåŠ¡çš„å®¹å™¨\n```\nlinks:\n    - redis\n```\n> ports\n\næš´éœ²ç«¯å£ä¿¡æ¯ç»™å®¿ä¸»æœº,ä½¿ç”¨(host:container) å¿…é¡»å­—ç¬¦ä¸²æ ¼å¼,yamlè§£ææ¶‰åŠè¿›åˆ¶\n```\nports:\n      - \"8888:8888\"\n      - \"127.0.0.1:8001:8001\"\n```\n\n> volumes\n\næŒ‚è½½è·¯å¾„,å®¿ä¸»æœº(host:container);ä¸Šè®¿æ¨¡å¼(host:container:ro)\n``` \nvolumes:\n    - ~/tmp:/tmp/dir\n    - \n```\n> volumes_from\n\næŒ‚è½½å®¹å™¨æˆ–æœåŠ¡\n```\nvolumes_from:\n    - jupyter\n    - service_name\n```\n> devices\n\nè®¾é…æ˜ å°„åˆ—è¡¨\n```\ndevices:\n    - \"/dev/nivida0:/dev/nivida0\"\n    - \"/dev/nivida1:/dev/nivida1\"\n```\n> depends_on\n\nexpressä¹‹é—´ä¾èµ–å…³ç³»,\n * `docker-compose up` æŒ‰ç…§ä¾èµ–é¡ºåºå¯åŠ¨\n\n```\n depends_on:\n     - elasticsearch\n```\n\n> labels\n\nå‘dockerå®¹å™¨æ·»åŠ å…ƒæ•°æ®\n```\nlabels:\n   - aliyun.gpu=2\n\n```\n>å…¶å®ƒ\n\ndocker run æ”¯æŒ\n```\ncpu_shares: 73\n#æŒ‡å®šå·¥ä½œç›®å½•\nworking_dir: /code  \n\nentrypoint: /code/entrypoint.sh\nuser: postgresql\nhostname: foo\ndomainname: foo.com\nmem_limit: 1000000000\nprivileged: true\nrestart: always\nstdin_open: true\ntty: true\n```\n\n#### ç¤ºä¾‹\n\n\n\n```\nversion: '2'\nservices:\n  jupyter:\n    image: registry.cn-hangzhou.aliyuncs.com/denverdino/tensorflow:1.0.0\n    container_name: jupyter\n    ports:\n      - \"8888:8888\"\n    environment:\n      - PASSWORD=tensorflow\n    volumes:\n      - \"/tmp/tensorflow_logs\"\n      - \"./notebooks:/root/notebooks\"\n    command:\n      - \"/run_jupyter.sh\"\n      - \"/root/notebooks\"\n  tensorboard:\n    image: registry.cn-hangzhou.aliyuncs.com/denverdino/tensorflow:1.0.0\n    container_name: tensorboard\n    ports:\n      - \"6006:6006\"\n    volumes_from:\n      - jupyter\n    command:\n      - \"tensorboard\"\n      - \"--logdir\"\n      - \"/tmp/tensorflow_logs\"\n      - \"--host\"\n      - \"0.0.0.0\"\n```\n\n\n\nlogstash\n\n```\nlogstash:\n  image: logstash:2.4.1\n  command: /opt/logstash/bin/logstash -f /etc/logstash/conf.d/logstash.conf\n  privileged: false\n  restart: always\n  ports:\n  - 21020:21020\n  volumes:\n  - /mnt/tinkle_data/logstash/logstash.conf:/etc/logstash/conf.d/logstash.conf\n```\n\nkibana\n\n```\nkibana:\n  image: daocloud.io/library/kibana:4.6.1\n  privileged: false\n  restart: always\n  ports:\n  - 5601:5601\n  volumes:\n  - /mnt/tinkle_data/kibana/kibana.yml:/opt/kibana/config/kibana.yml\n```\n\nelasticsearch\n\n```\nes:\n  restart: always\n  ports:\n    - '9200:9200/tcp'\n    - '9300:9300/tcp'\n  environment:\n    - LANG=C.UTF-8\n    - JAVA_HOME=/docker-java-home/jre\n    - TZ=Asia/ShangHai\n  memswap_limit: 0\n  labels:\n    aliyun.scale: '1'\n  shm_size: 0\n  image: 'elasticsearch:2.4.1'\n  memswap_reservation: 0\n  volumes:\n    - '/home/data/es:/usr/share/elasticsearch/data:rw'\n    - '/mnt/elasticsearch/plugins:/usr/share/elasticsearch/plugins:rw'\n  kernel_memory: 0\n  mem_limit: 0\n```\n\nredis\n\n```\nredis:\n  image: redis:3.2.5\n  command: \n     -  /etc/redis/6379.conf\n  privileged: false\n  restart: always\n  ports:\n  - 6379:6379\n  volumes:\n  - /mnt/tinkle_data/redis/data:/data/\n  - /mnt/tinkle_data/redis/conf/6379.conf:/etc/redis/6379.conf\n```\n\n\n\n```\nmysql:\n  image: 'mysql:5.7.17'\n  ports:\n    - '3306:3306'\n  restart: always\n  environment:\n    - MYSQL_ROOT_PASSWORD=19930221\n  labels:\n    aliyun.scale: '1'\n  volumes:\n    - '/home/data/mysql/mysql:/var/lib/mysql'\n    - '/home/data/mysql/conf/mysql.cnf:/etc/mysql/conf.d/mysql.cnf'\n```\n\n\n\n```\n#docker-compose services  mysqlçš„æœåŠ¡å\njdbc_url=jdbc:mysql://æœåŠ¡å:3306/databasename\n```\n\n","tags":["install","docker-engine","docker compose"],"categories":["linux","k8s","docker"]},{"title":"docker","url":"/linux/k8s/docker/","content":"#### å®‰è£… engine\nå¸è½½æ—§ç‰ˆ\n`sudo apt-get purge docker.io*`\n\nç¼–è¾‘ ` /etc/apt/sources.list.d/docker.list`\n```\necho 'deb https://apt.dockerproject.org/repo debian-jessie main'> /etc/apt/sources.list.d/docker.list\n```\nå®‰è£…ä¾èµ–ï¼š` apt-transport-https`\n\n```\nsudo apt-get install docker-engine\ndocker version\n...permissioné—®é¢˜\n```\nåˆ›å»ºç»„\n```\n cat /etc/group | grep ^docker  #ä¸å­˜åœ¨\n sudo groupadd docker  #å­˜åœ¨å¿½ç•¥ï¼Œåˆ›å»ºç»„\nsudo gpasswd -a ${USER} docker   #æ·»åŠ å½“å‰ç”¨æˆ·åˆ°ç»„\nsudo restart  #é‡å¯ç”Ÿæ•ˆ\n```\n <!--more--> \n#### å®‰è£… compose\nå®˜æ–¹æ–‡æ¡£ https://docs.docker.com/compose/install/#alternative-install-options\n\n##### æ–¹æ³•ä¸€\ncurl å®‰è£…\n```\nsudo apt-get install curl\n```\n/usr/local/bin éœ€è¦æƒé™\n```\nsudo curl -L \"https://github.com/docker/compose/releases/download/1.11.1/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\n..... \ncurl: (56) SSL read: error:00000000:lib(0):func(0):reason(0), errno 104\nç½‘ç»œä¸­æ–­næ¬¡ï¼Œæ¨èç¦»çº¿\n```\n[ç¦»çº¿ä¸‹è½½](https://dl.bintray.com/docker-compose/master/)\n```\nsudo mv docker-compose-Linux-x86_64 /usr/local/bin/docker-compose\nchmod +x /usr/local/bin/docker-compose\ndocker-compose --version\n```\n\n##### æ–¹æ³•äºŒ\npipå®‰è£…`pip install docker-compose`\n**å¼ºçƒˆå»ºè®®æ‚¨ä½¿ç”¨ virtualenvï¼Œå› ä¸ºè®¸å¤šæ“ä½œç³»ç»Ÿæœ‰pythonç³»ç»ŸåŒ…ä¸docker-composeä¾èµ–å…³ç³»å†²çª**\n\n\n####  å›½å†…æº\n`docker search  xxxx` \n**error response from daemon: Get https://index.docker.io**\nè¢« GFWå¼ºäº†\nDockeré…ç½®æ–‡ä»¶`/etc/default/docker`\n```\nsudo mousepad /etc/default/docker\n\n#æ·»åŠ  é˜¿é‡Œæº\nDOCKER_OPTS=\"--registry-mirror=http://mirrors.aliyun.com\"\n```\nåŠ é€Ÿåœ°å€\n```\nsudo mkdir -p /etc/docker\nsudo tee /etc/docker/daemon.json <<-'EOF'\n{\n  \"registry-mirrors\": [\"https://è‡ªå·±ä¸“å±.mirror.aliyuncs.com\"]\n}\nEOF\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n```\n#### docker-compose.yml\nå¸¸ç”¨é…ç½®{% post_link  compose %}\n\n#### å¸è½½\n```\n#docker-engine\nsudo apt-get remove docker-engine\n\n# docker-compose \n#curl\n$ rm /usr/local/bin/docker-compose\n# pip\n$ pip uninstall docker-compose\n```\n\n\n\ndocker.service\n\n```\ncat >/usr/lib/systemd/system/docker.service <<EOF\n[Unit]\nDescription=Docker Application Container Engine\nDocumentation=http://docs.docker.com\nAfter=network.target docker.socket\n[Service]\nType=notify\nEnvironmentFile=$BASE/flanneld/subnet.env\nWorkingDirectory=/usr/local/bin\nExecStart=/usr/bin/dockerd \\\n                \\$DOCKER_NETWORK_OPTIONS \\\n                -H unix:///var/run/docker.sock \nExecReload=/bin/kill -s HUP $MAINPID\n# Having non-zero Limit*s causes performance problems due to accounting overhead\n# in the kernel. We recommend using cgroups to do container-local accounting.\nLimitNOFILE=infinity\nLimitNPROC=infinity\nLimitCORE=infinity\nTimeoutStartSec=0\n# set delegate yes so that systemd does not reset the cgroups of docker containers\nDelegate=yes\n# kill only the docker process, not all processes in the cgroup\nKillMode=process\nRestart=on-failure\n[Install]\nWantedBy=multi-user.target\nEOF\n```\n\n","tags":["install","docker-engine","docker compose"],"categories":["linux","debian","docker"]},{"title":"dpkg","url":"/linux/debian/dpkg/","content":"#### dpkg\n\n\n\n```\napt-get install xxx\n....\nCould not exec dpkg!\nE: Sub-process /usr/bin/dpkg returned an error code (100)\n```\n\n\n```\n ls -l /usr/bin/dpkg #ä»€ä¹ˆæ²¡æœ‰å‘€ï¼ï¼ï¼\n find /usr -type f -name dpkg\n .....\n```\n  <!--more--> \n é‚£æ‰§è¡Œ\n```\n apt-get install dpkg  \n ....\n æ˜¾ç¤ºå·²å®‰è£… **ä½¿ç”¨æ–¹æ³•ä¸€**\n```\n\n æœç´¢ **dpkg debian download **\n [download](https://packages.debian.org/jessie/dpkg)\n\n\n##### æ–¹æ³•ä¸€\n```\n ar x  ~/æ–‡æ¡£/dpkg_1.17.27_amd64.deb data.tar.gz\n \n mkdir /tmp/dpkg\n cp data.tar.gz /tmp/dpkg\n cd /tmp/dpkg\n \n tar xfvz data.tar.gz ./usr/bin/dpkg\n \nsudo cp ./usr/bin/dpkg /usr/bin/\nsudo apt-get update\n```\n#####  æ–¹æ³•äºŒ\n\n`./configure`\nconfigure: error: libbz2 library or header not found\nSee `config.log' for more details\nå®‰è£… **libbz2**\nhttps://packages.debian.org/jessie/libbz2-1.0\n\nconfigure: error: liblzma library or header not found\nSee `config.log' for more details\nå®‰è£… **liblzma**\nhttps://packages.debian.org/jessie/liblzma5\n\nconfigure: error: no curses library found\nå®‰è£… ** curses  **\nhttps://packages.debian.org/jessie/libncurses5-dev\n\n\n\n#### è§£å‹deb\n\n \n\n```\nar x   fileName.deb\n```\n\n\n\n```\nxz -d  data.tar.xz\n```\n\n\n\n```\ntar -zxvf   data.tar.gz\ntar -xvf   data.tar\n```\n\n","tags":["install","dpkg"],"categories":["linux","debian","tools"]},{"title":"live","url":"/tool/redis-live/","content":"Redis live\n Redis Liveæ˜¯ä¸€ä¸ªç”¨æ¥ç›‘æ§rediså®ä¾‹,åˆ†ææŸ¥è¯¢è¯­å¥å¹¶ä¸”æœ‰webç•Œé¢çš„ç›‘æ§å·¥å…·,ä½¿ç”¨pythonç¼–å†™\n#### Install Dependencies\n* **tornado** pip install tornado\n* **redis.py** pip install redis\n* **python-dateutil** pip install python-dateutil\n if you're running Python < 2.7:\n*  ** argparse** pip install argparse\nå®˜æ–¹è¯´æ˜ï¼š http://www.nkrode.com/article/real-time-dashboard-for-redis\n <!--more--> \n#### pip\nä¸‹è½½åœ°å€:  https://pypi.python.org/pypi/pip#downloads\npip ä¾èµ– setuptools\nFinished processing dependencies for setuptools==32.3.1\n\n```bash\n$tar -zxvf  pip-9.0.1.tar.gz\n$python setup.py build \n$sudo python setup.py install\nFinished processing dependencies for pip==9.0.1\n```\n\n\n\nFinished processing dependencies for python-dateutil==2.6.0\n\n\nFinished processing dependencies for redis==2.10.5\n\n```\n$sudo apt-get install build-essential python-dev\n```\nDpkg: Warning: ** ldconfig ** could not be found in the PATH environment variable or no executable privileges\nTip: The root PATH environment variable should normally contain ** / usr / local / sbin, / usr / sbin, and / sbin **\n```bash\n$locate ldconfig   #sbinç›®å½•å­˜åœ¨ ldconfig\n$sudo mousepad ~/.bashrc\nexport PATH=/usr/loca/sbin:/usr/sbin:/sbin:$PATH\n$source ~/.bashrc\n```\n\nFinished processing dependencies for tornado==4.5.dev1\n\nåˆ—å‡ºå®‰è£…çš„packages\n```\n$ sudo pip freeze\n```\n\n####  redislive\n```\ngit clone https://github.com/kumarnitin/RedisLive.git\n```\né…ç½®æ–‡ä»¶**redis-live.conf**ã€redis-live.conf.exampleã€‘\n```\n{\n\t\"RedisServers\":\n\t[ \n\t\t{\n  \t\t\t\"server\": \"154.17.59.99\",\n  \t\t\t\"port\" : 6379\n\t\t},\n\t\t\n\t\t{\n  \t\t\t\"server\": \"localhost\",\n  \t\t\t\"port\" : 6380,\n  \t\t\t\"password\" : \"some-password\"\n\t\t}\t\t\n\t],\n\n\t\"DataStoreType\" : \"redis\",\n\n\t\"RedisStatsServer\":\n\t{\n\t\t\"server\" : \"ec2-184-72-166-144.compute-1.amazonaws.com\",\n\t\t\"port\" : 6385\n\t},\n\t\n\t\"SqliteStatsStore\" :\n\t{\n\t\t\"path\":  \"to your sql lite file\"\n\t}\n}\n```\nå¯åŠ¨æœåŠ¡\n```\n./redis-monitor.py --duration=30     //å¯åŠ¨ç›‘æ§ï¼Œdurationæ˜¯å¿ƒè·³æ—¶é—´\n./redis-live.py                    //å¯åŠ¨webæœåŠ¡ï¼Œé»˜è®¤ç›‘å¬8888ç«¯å£\n```\n**env: ...py æƒé™ä¸å¤Ÿ**\nç»™äºˆæ‰§è¡Œæƒ\n```\nchmod +x  redis-monitor.py\nchmod +x  redis-live.py \n```\næ‰“å¼€ http://localhost:8888/index.html","tags":["redis","ç›‘æ§å·¥å…·","install"],"categories":["nosql","redis"]},{"title":"kibana","url":"/services/elk/kibana/","content":"\n#### debian\n```\n$>sudo dpkg -i kibana-4.6.1-amd64.deb\n$>dpkg -L  kibana \n```\n \n#### win\n[nssm](#)\n\n#### åˆ›å»ºç´¢å¼•\n** logstash.conf **  \n <!--more--> \n```\noutput {\n    elasticsearch {\n        hosts => [\"127.0.0.1:9200\"]\n        index => \"logstash-nginx-json-%{+YYYY.MM}\"\n    }\n   stdout {codec => rubydebug}\n}\n```\n* åªæœ‰æ—¥å¿—è¾“å…¥åˆ°esï¼Œæ‰ä¼šè§¦å‘åˆ›å»ºç´¢å¼•","tags":["install","win"],"categories":["ELK","kibana"]},{"title":"logstash","url":"/services/elk/logstash/","content":"\n#### debianå®‰è£…\n```\n $>sudo dpkg -i logstash-2.4.1_all.deb\n$> dpkg -L  logstash\n```\n#### winå®‰è£…\nserviceå·¥å…· [nssm](#)\n <!--more--> \n#### é…ç½®\nlogstash.conf\n```\ninput {\n    file {\n        path => [ \"F:/ELK/nginx-1.10.2/logs/access.log\" ]\n\t\ttype => \"nginx_access\"\n        start_position => \"beginning\"\n        ignore_older => 0\n    }\n\tfile {\n        path => [ \"F:/ELK/nginx-1.10.2/logs/access_json.log\" ]\n\t\t#codec => \"json\"\n\t\ttype => \"nginx_json\"\n        start_position => \"beginning\"\n        ignore_older => 0\n    }\n}\n\nfilter {\n if [type] == \"nginx_access\" {\n    grok {\n\t    patterns_dir => \"F:/ELK/logstash-2.4.1/patterns\"        #è®¾ç½®è‡ªå®šä¹‰æ­£åˆ™è·¯å¾„\n        match => { \"message\" => \"%{NGINXACCESS}\" }\n    }\n\n\n    date {\n      match => [ \"log_timestamp\",\"dd/MMM/yyyy:HH:mm:ss Z\"]\n\n    }\n   \n  }\n  \n  if [type] == \"nginx_json\" {\n        json {\n            source => \"message\"\n            #target => \"doc\"\n            remove_field => [\"message\"]\n        }\n\t\tif [@fields][ip] != \"-\" {\n\t\t\tgeoip {\n\t\t\t\t\tsource => \"[@fields][ip]\"\n \t\t\t\t\ttarget => \"geoip\"\n\t\t\t\t\tfields => [\"city_name\", \"continent_code\", \"country_code3\", \"country_name\", \"ip\", \"postal_code\", \"region_name\"]\n\t\t\t\t\tdatabase => \"F:/ELK/logstash-2.4.1/ip/GeoLiteCity.dat\"\n\t\t\t\t\tadd_field => [ \"[geoip][coordinates]\", \"%{[geoip][longitude]}\" ]\n\t\t\t\t\tadd_field => [ \"[geoip][coordinates]\", \"%{[geoip][latitude]}\"  ]\n\t\t\t}\n\t\t\n\t\t\tmutate {\n\t\t\t\t\tconvert => [ \"[geoip][coordinates]\", \"float\"]\n\t\t\t\t\t\n\t\t\t}\n   \n\t\t}\n \t}\n \n}\noutput {\n if [type] == \"nginx_access\" {\n    elasticsearch {\n        hosts => [\"127.0.0.1:9200\"]\n        index => \"logstash-nginx-access-%{+YYYY.MM}\"\n    }\n   stdout {codec => rubydebug}\n  }\n  if [type] == \"nginx_json\" {\n    elasticsearch {\n        hosts => [\"127.0.0.1:9200\"]\n        index => \"logstash-nginx-json-%{+YYYY.MM}\"\n    }\n   stdout {codec => rubydebug}\n  }\n \n}\n```","tags":["install","win","log"],"categories":["ELK","logstash"]},{"title":"å®‰è£…elasticsearch","url":"/services/elk/å®‰è£…ElasticSearch/","content":"## elasticsearch ç›®å½•ç»“æ„\n\n|type | description | location |\n|-------|---------------------|-------|\n|home | Home of elasticsearch installation |\t/usr/share/elasticsearch \n| bin\t| Binary scripts including elasticsearch to start a node |\t/usr/share/elasticsearch/bin\n|conf\t| Configuration files elasticsearch.yml and logging.yml\t|/etc/elasticsearch\n|conf |Environment variables including heap size,file descriptors\t|/etc/default/elasticsearch\n|data\t| The location of the data files\t|/var/lib/elasticsearch/\n|logs\t| Log files location\t|/var/log/elasticsearch\n|plugins\t| Plugin files location\t|/usr/share/elasticsearch/plugins\n\nä¸‹è½½åœ°å€\n\n####  window7\nbinç›®å½•æ‰§è¡Œå®‰è£…\n```\nF:\\ELK\\elasticsearch-2.4.1\\bin>service install\nInstalling service      :  \"elasticsearch-service-x64\"\nUsing JAVA_HOME (64-bit):  \"F:\\java\\jdk8\"\nThe service 'elasticsearch-service-x64' has been installed.\n```\nå®‰è£…æˆåŠŸï¼Œå¦‚æœå¯åŠ¨å¤±è´¥ï¼ˆè¿›logsç›®å½•ï¼ŒæŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼‰\n <!--more--> \n```\n[error] [ 6376] Failed creating java %JAVA_HOME%\\jre\\bin\\server\\jvm.dll\n [error] [ 6376] ç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šçš„è·¯å¾„ã€‚\n ```\n ç›´æ¥åˆ©ç”¨ç®¡ç†æœåŠ¡\n ```\n #è¿è¡Œ service manager ä¼šå¼¹å‡ºæœåŠ¡ç®¡ç†ç•Œé¢ ä¿®æ”¹jvmæŒ‡å®šè·¯å¾„\nF:\\ELK\\elasticsearch-2.4.1\\bin>service manager\n```\n\n#### debian8\n```\nsudo dpkg -i  elasticsearch-2.4.2.deb\nbin$> ./elasticsearch   #å¯åŠ¨æç¤ºæ²¡æœ‰æƒé™\n```\néœ€è¦æˆæƒæ‰§è¡Œå‘½ä»¤** chmod +x bin/elasticsearch  ** \nå†æ¬¡æ‰§è¡Œ** ./elasticsearch -d **å³å¯åå°å¯åŠ¨ \nä½¿ç”¨** ps aux|grep elasticsearch **å¯ä»¥æŸ¥çœ‹æ˜¯å¦å¯åŠ¨\n\n**è®¾ç½®å¼€æœºå¯åŠ¨**\nåˆ›å»ºè„šæœ¬ start.sh\n```\n#!bin/bash\nexport JAVA_HOME=/usr/bin/java\nexport JRE_HOME=${JAVA_HOME}/jre\nexport CLASSPATH=.:${JAVA_HOME}/lib:${JRE_HOME}/lib\nexport PATH=${JAVA_HOME}/bin:$PATH\n #åˆ‡æ¢åˆ°csç”¨æˆ·ï¼ˆå¸¦ç¯å¢ƒå˜é‡ï¼‰\nsu -cs<<!\ncd /opt/elasticsearch/bin\n./elasticsearch &\nexit\n!\n```\nä¿®æ”¹å¯åŠ¨æ–‡ä»¶ mousepad /etc/init.d/elasticsearch\n```\n#!bin/bash\n### BEGIN INIT INFO\n# Provides:          elasticsearch\n# Required-Start:    $all\n# Required-Stop:     $all\n# Default-Start:     2 3 4 5\n# Default-Stop:      0 1 6\n# Short-De.ion: starts the elasticsearch  server\n# De.ion:       starts elasticsearch using start-stop-daemon\n### END INIT INFO\nsh /opt/elasticsearch/start.sh\n```\n","tags":["install","win","search"],"categories":["ELK","elasticsearch"]},{"title":"æ­å»ºhexo","url":"/lang/node/npm/hexo/æ­å»ºhexo/","content":"\n\n\n\n\n### å‡†å¤‡å·¥å…·\n\nnode\ngit\nhexo\n\n### node å®‰è£…\n``` bash\n$tar  -zxvf  node.tar.gz\n$cd node\n$./config  --prefix=/opt/node\n$sudo make\n$sudo make install\n```\næ·»åŠ ç¯å¢ƒå˜é‡\n```bash\n#set nodejs\nexport NODE_HOME=/opt/node\nexport PATH=$NODE_HOME/bin:$PATH\n$node -v #æ˜¾ç¤ºç‰ˆæœ¬å·\n$sudo node -v #å½“ç”¨rootæ‰§è¡Œï¼Œcommond not found\n#mousepad  ~/.bashrc\nalias sudo='sudo env PATH=$PATH'\n```\n <!--more--> \n### git\n\n\n``` bash\n$cd ~/.ssh #æŸ¥çœ‹æ²¡æœ‰å¯†é’¥\n$ ssh-keygen -t rsa -C \"ä½ gitçš„user.email\"\n```\nè·¯å¾„é»˜è®¤ æœ€å¥½è¾“å…¥å¯†ç \næœ€åå¾—åˆ°ä¸¤ä¸ªæ–‡ä»¶ï¼šid_rsaå’Œid_rsa.pub\n\n``` bash\n$ cat ~/.ssh/id_rsa.pub #å¤åˆ¶åˆ°github ssh key \n$ssh git@github.com  \n```\n\n### hexo\nåœ¨æŒ‡å®šç›®å½•ä¸‹æ‰§è¡Œç»ˆç«¯\n```bash\n$sudo npm install hexo-cli -g #å®‰è£…åœ¨å½“å‰ç›®å½•\n#å¿½ç•¥warn\n$sudo npm install hexo --save\n$hexo -v\n```\nç»™äºˆæ–‡ä»¶å¤¹æƒé™\nåˆå§‹åŒ– ï¼Œå®‰è£…ç»„ä»¶\n```\n$hexo init\n$npm install\n```\n### éƒ¨ç½²\næœ¬åœ°éƒ¨ç½²\n```\n$hexo g  #generate ç®€å†™\n$hexo s #server  é»˜è®¤ç«¯å£4000\n```\npush \n\n```\n$hexo d #deploy\n```\n\n\n\n### themes\n\néƒ¨åˆ†ä¸»é¢˜æ˜¯18,19å¹´,nodeç‰ˆæœ¬å¤ªé«˜,**ç‰ˆæœ¬ä¸ä¸€è‡´**\n\nä¼šå¯¼è‡´hexo server æ­£å¸¸,ä½†hexo generate ç”Ÿæˆçš„publicç›®å½•æ–‡ä»¶**å…¨ä¸ºä¸º0kb**\n\nä¼šå¯¼è‡´\"<%= config.root %>\"å†™æ³•åªèƒ½è·å–åˆ°/,è·³è½¬é“¾æ¥ä¸æ­£å¸¸\n\nç­‰ä¸€ç³»åˆ—é—®é¢˜,**æ³¨æ„ç‰ˆæœ¬**\n\n\n\nnodeç‰ˆæœ¬é—®é¢˜https://nodejs.org/zh-cn/download/releases/\n\nhttps://www.npmjs.com/package/hexo-cli\n\n```\nnpm ls --depth 0\n\nhexo g --debug\n```\n\n","tags":["install","hexo"],"categories":["other"]},{"title":"httpsç­¾å","url":"/network/httpsè‡ªå·±ç­¾å/","content":"#### ä¸ºæœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯å‡†å¤‡å…¬é’¥ã€ç§é’¥\n```\n#ç§é’¥\n>openssl genrsa -out server.key 1024 -config E:\\Git\\mingw64\\ssl\\openssl.cnf\n```\n```\n#å…¬é’¥\n>openssl rsa -in server.key -pubout -out server.pem\n```\n#### ç”Ÿæˆ CA è¯ä¹¦\n```\n <!--more--> \n#caç§é’¥\n>openssl genrsa -out ca.key 1024 -config E:\\Git\\mingw64\\ssl\\openssl.cnf\n```\n **ç¬¬ä¸€æ¬¡å¡«å†™ä¿¡æ¯**\n```\n>openssl req -new -key ca.key -out ca.csr -config E:\\Git\\mingw64\\ssl\\openssl.cnf\n```\n\nCountry Name (2 letter code) [AU]:\nState or Province Name (full name) [Some-State]:\nLocality Name (eg, city) []:\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:\nOrganizational Unit Name (eg, section) []:\n**Common Name** (e.g. server FQDN or YOUR name) []:localhost\nEmail Address []:\n\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:12345678\nAn optional company name []:cs\n\n```\n>openssl x509 -req -in ca.csr -signkey ca.key -out ca.crt -days 365\n```\n\n#### ç”ŸæˆæœåŠ¡å™¨ç«¯è¯ä¹¦\næœåŠ¡å™¨ç«¯éœ€è¦å‘ CA æœºæ„ç”³è¯·ç­¾åè¯ä¹¦ï¼Œåœ¨ç”³è¯·ç­¾åè¯ä¹¦ä¹‹å‰ä¾ç„¶æ˜¯åˆ›å»ºè‡ªå·±çš„ CSR æ–‡ä»¶  **ä¸ç¬¬ä¸€æ¬¡ä¿¡æ¯å¡«å†™ä¸€æ ·**\n```\n>openssl req -new -key server.key -out server.csr -config E:\\Git\\mingw64\\ssl\\openssl.cnf\n```\nå‘è‡ªå·±çš„ CA æœºæ„ç”³è¯·è¯ä¹¦ï¼Œç­¾åè¿‡ç¨‹éœ€è¦ CA çš„è¯ä¹¦å’Œç§é’¥å‚ä¸ï¼Œæœ€ç»ˆé¢å‘ä¸€ä¸ªå¸¦æœ‰ CA ç­¾åçš„è¯ä¹¦\n```\n>openssl x509 -req -CA ca.crt -CAkey ca.key -CAcreateserial -in server.csr -out server.crt\n```\nSignature ok\nsubject=/C=AU/ST=Some-State/O=Internet Widgits Pty Ltd/CN=localhost\nGetting CA Private Key\n\n\n#### ç”Ÿæˆceræ–‡ä»¶\nä½¿ç”¨openssl è¿›è¡Œè½¬æ¢\n```\n>openssl x509 -in server.crt -out server.cer -outform der\n```\n\n ç”Ÿæˆp12\n```\nF:\\logs\\http>openssl pkcs12 -export -clcerts -in server.crt -inkey server.key -out client.p12\nWARNING: can't open config file: /usr/local/ssl/openssl.cnf\nLoading 'screen' into random state - done\nEnter Export Password:12345678\nVerifying - Enter Export Password:12345678\n```\n\n","tags":["https","ç­¾å"],"categories":["httpåè®®","https"]},{"title":"404","url":"/404.html","content":"<html>\n<head>\n<!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset=\"utf-8\">\n<title>404é¡µé¢</title>\n<style>\n*{margin:0;padding:0;outline:none;font-family:\\5FAE\\8F6F\\96C5\\9ED1,å®‹ä½“;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-khtml-user-select:none;user-select:none;cursor:default;font-weight:lighter;}\n.center{margin:0 auto;}\n.whole{width:100%;height:100%;line-height:100%;position:fixed;bottom:0;left:0;z-index:-1000;overflow:hidden;}\n.whole img{width:100%;height:100%;}\n.mask{width:100%;height:100%;position:absolute;top:0;left:0;background:#000;opacity:0.6;filter:alpha(opacity=60);}\n.b{width:100%;text-align:center;height:400px;position:absolute;top:50%;margin-top:-230px}.a{width:150px;height:50px;margin-top:30px}.a a{display:block;float:left;width:150px;height:50px;background:#fff;text-align:center;line-height:50px;font-size:18px;border-radius:25px;color:#333}.a a:hover{color:#000;box-shadow:#fff 0 0 20px}\np{color:#fff;margin-top:40px;font-size:24px;}\n#num{margin:0 5px;font-weight:bold;}\n</style>\n<script type=\"text/javascript\">\n\tvar num=4;\n\tfunction redirect(){\n\t\tnum--;\n\t\tdocument.getElementById(\"num\").innerHTML=num;\n\t\tif(num<0){\n\t\t\tdocument.getElementById(\"num\").innerHTML=0;\n\t\t\tlocation.href=\"https://cheng.vercel.app\";\n\t\t\t}\n\t\t}\n\tsetInterval(\"redirect()\", 1000);\n</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->\n</head>\n\n<body onload=\"redirect();\">\n<!-- hexo-inject:begin --><!-- hexo-inject:end --><div class=\"whole\">\n\t<img src=\"http://7xowaa.com1.z0.glb.clouddn.com/back.jpg\">\n    <div class=\"mask\"></div>\n</div>\n<div class=\"b\">\n\t\t<img src=\"http://7xowaa.com1.z0.glb.clouddn.com/404.png\" class=\"center\">\n\t\t<p>\n\t\t\tæš‚æ—¶æœªèƒ½æ‰¾åˆ°æ‚¨æŸ¥æ‰¾çš„é¡µé¢<br>\n\t\t\tå¯èƒ½è¾“å…¥çš„ç½‘å€é”™è¯¯æˆ–æ­¤é¡µé¢ä¸å­˜åœ¨<br>\n            <span id=\"num\"></span>ç§’åè‡ªåŠ¨è·³è½¬åˆ°ä¸»é¡µ\n\t\t</p>\n\t</div><!-- hexo-inject:begin --><!-- hexo-inject:end -->\n\n</body>\n</html> "},{"title":"categories","url":"/categories/index.html"},{"title":"åˆ†ç±» & æ ‡ç­¾","url":"/tags/index.html"},{"title":"å…¶ä»–","url":"/other/index.html"}]